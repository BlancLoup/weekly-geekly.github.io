<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sourcebuster JS: JavaScript Site Sourcing Module</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This story began about 6 months ago. I then wrote my first meaningful Rails module, Sourcebuster. And at the same time I got an invite to habr for the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sourcebuster JS: JavaScript Site Sourcing Module</h1><div class="post__text post__text-html js-mediator-article">  This story began about 6 months ago.  I then wrote my first meaningful Rails module, Sourcebuster.  And at the same time I got an invite to habr for the <a href="http://habrahabr.ru/post/208112/">post about this module</a> .  In fact, most of the theory is already set out by reference, and I do not want to copy-paste the old one.  Instead, I suggest that you read the previous one before reading this post. <br><br>  For those who are lazy - literally a paragraph of the summary of the previous series.  6 months ago I wrote a module for Ruby on Rails, which helps to determine the sources of site visitors and use the data for various marketing and analytical media.  Now I decided to get acquainted with JS and ported it to JavaScript, and I‚Äôm going to talk about it in this post. <br><a name="habracut"></a><br><h4>  Basic Theses </h4><br><ul><li>  the script determines the parameters of the sources of visitors to the site and stores the data in cookies </li><li>  the logic of identifying and rewriting sources completely repeats the logic of Google Analytics </li><li>  the script is completely autonomous in terms of receiving data and has no dependencies on third-party pieces (such as cookies _utmz) </li><li>  written in pure JavaScript, without dependencies on third-party libraries </li><li>  The obtained data can be used: <br><ul><li>  for changing phone numbers </li><li>  Substitution of content on the site (for example, headers) </li><li>  save with forms sent from site </li><li>  export to your CRM or analytics systems. </li></ul><br></li></ul><br><h4>  Links </h4><br>  <a href="https://github.com/alexfedoseev/sourcebuster-js">Github</a> ¬∑ <a href="">Download from GitHub</a> ¬∑ <a href="">Changelog</a> ¬∑ <a href="http://statica.alexfedoseev.com/sourcebuster-js/">Test page</a> <br><br>  Further documentation will be updated on <a href="http://sbjs.rocks/">sbjs.rocks</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Installation and Setup </h4><br>  Since the module is written in pure JavaScript, it does not have dependencies on third-party libraries, and it is put on the actual contents of DOM, it can be invoked as early as you see fit.  The higher you put it in <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt; </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code></code> <h5> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt; </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </h5> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt; </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']); </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']); </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="javascript"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> _sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]); </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h4> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h4> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="bash"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="bash"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/ </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="bash"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ref=http://habrahabr.ru </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code class="bash"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36 </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <ul><li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> <li> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </li> </ul> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <pre> <code class="hljs pgsql"><code><code class="html"> ,     ,          DOM<span class="hljs-string"><span class="hljs-string">'. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br></code><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">   : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   , : </span></span><br><span class="hljs-string"><span class="hljs-string">               (  ‚Äî  /  /   ) </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string">            Google.   : 30 .     ,      .          . . ip     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´   ¬ª </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]); _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>statica.alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>plus.url.google.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>plus.google.com<span class="hljs-string"><span class="hljs-string">']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          </span></span><code><span class="hljs-string"><span class="hljs-string">_sbjs.push</span></span></code><span class="hljs-string"><span class="hljs-string">       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   7   : </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setSessionLength </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setSessionLength<span class="hljs-string"><span class="hljs-string">', 15]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      . </span></span><br><span class="hljs-string"><span class="hljs-string">           / -  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     .        ,      .          ,       ,    .      Google Analytics: </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setBaseHost </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>alexfedoseev.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,         ( ) .   ,        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 1</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     : </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .     : </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> .   ,           :    </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string">        .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> (   </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),           </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/about</span></span></i><span class="hljs-string"><span class="hljs-string">  </span></span><i><span class="hljs-string"><span class="hljs-string">site.com/contacts</span></span></i><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> 2</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    :           .    ( </span></span><b><span class="hljs-string"><span class="hljs-string">site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> )    ( </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ),       ( </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ).     </span></span><b><span class="hljs-string"><span class="hljs-string">blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">  </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string">   ,         ‚Äî .  : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//     _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>blog.site.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">     .      ,  -        .   ,        ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">                 .          ,      ,    : </span></span><b><span class="hljs-string"><span class="hljs-string">alex.blog.site.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ( : </span></span><i><span class="hljs-string"><span class="hljs-string">referral</span></span></i><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setBaseHost</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">false</span></span></code><span class="hljs-string"><span class="hljs-string">    ,    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">// :   site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //   :   blog.site.com _sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,       -. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setBaseHost<span class="hljs-string"><span class="hljs-string">', '</span></span>site.com<span class="hljs-string"><span class="hljs-string">', false]); //=&gt;      site.com  </span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setTimeZoneOffset </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setTimeZoneOffset<span class="hljs-string"><span class="hljs-string">', 4]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   . </span></span><br><span class="hljs-string"><span class="hljs-string">      UTC.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setCampaignParam </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setCampaignParam<span class="hljs-string"><span class="hljs-string">', '</span></span>custom_campaign<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  GET-,       </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> (      </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> ).       -  Google AdWords </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       Google AdWords,     </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom"><span class="hljs-string"><span class="hljs-string">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><br><span class="hljs-string"><span class="hljs-string"> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string"></span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      utm- (utm_source, utm_medium, utm_campaign),   </span></span><code><span class="hljs-string"><span class="hljs-string">gclid</span></span></code><span class="hljs-string"><span class="hljs-string">  ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> ,  .      ,   </span></span><code><span class="hljs-string"><span class="hljs-string">_setCampaignParam</span></span></code><span class="hljs-string"><span class="hljs-string"> , Sourcebuster     utm-. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addOrganicSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>yahoo.com<span class="hljs-string"><span class="hljs-string">', '</span></span>p<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addOrganicSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>bing.com<span class="hljs-string"><span class="hljs-string">', '</span></span>q<span class="hljs-string"><span class="hljs-string">', '</span></span>bing<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,       </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string"> ‚Äî  .        ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing.com<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> .   .            ( </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>bing<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,    </span></span><b><span class="hljs-string"><span class="hljs-string">bing.com</span></span></b><span class="hljs-string"><span class="hljs-string">       (, </span></span><i><span class="hljs-string"><span class="hljs-string">¬´apple¬ª</span></span></i><span class="hljs-string"><span class="hljs-string"> ).          : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><a href="http://www.bing.com/search"><span class="hljs-string"><span class="hljs-string">www.bing.com/search</span></span></a><span class="hljs-string"><span class="hljs-string"> ? </span></span><b><span class="hljs-string"><span class="hljs-string">q=apple</span></span></b><span class="hljs-string"><span class="hljs-string"> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    ‚Äî </span></span><code><span class="hljs-string"><span class="hljs-string">'</span></span>q<span class="hljs-string"><span class="hljs-string">'</span></span></code><span class="hljs-string"><span class="hljs-string"> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _addReferralSource </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>facebook.com<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">']); _sbjs.push(['</span></span>_addReferralSourc<span class="hljs-string"><span class="hljs-string">e', '</span></span>t.co<span class="hljs-string"><span class="hljs-string">', '</span></span>social<span class="hljs-string"><span class="hljs-string">', '</span></span>twitter.com<span class="hljs-string"><span class="hljs-string">']);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . ,   ,  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string">     </span></span><b><span class="hljs-string"><span class="hljs-string">facebook.com</span></span></b><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> ,     .          (, </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium=social</span></span></code><span class="hljs-string"><span class="hljs-string"> ),        </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> .   ‚Äî   ,  ‚Äî   </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">           (,  Twitter   ‚Äî </span></span><b><span class="hljs-string"><span class="hljs-string">t.co</span></span></b><span class="hljs-string"><span class="hljs-string"> ).            .              . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> _setUserIP </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">_sbjs.push(['</span></span>_setUserIP<span class="hljs-string"><span class="hljs-string">', &lt;%= request.remote_ip %&gt;]);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ip- .        ,     </span></span><code><span class="hljs-string"><span class="hljs-string">_setUserIP</span></span></code><span class="hljs-string"><span class="hljs-string"> ,   .   ,     Ruby. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> Cookies </span></span><br><span class="hljs-string"><span class="hljs-string"> ,    .          : </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_current </span></span><br><span class="hljs-string"><span class="hljs-string">     . </span></span><br><span class="hljs-string"><span class="hljs-string">       (1-2-3- ),        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">typ</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  : </span></span><code><span class="hljs-string"><span class="hljs-string">utm</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">organic</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">referral</span></span></code><span class="hljs-string"><span class="hljs-string"> , </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> .   . </span></span><b><span class="hljs-string"><span class="hljs-string">src</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .    </span></span><code><span class="hljs-string"><span class="hljs-string">utm_source</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">mdm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_medium</span></span></code><span class="hljs-string"><span class="hljs-string"> .    utm-  </span></span><code><span class="hljs-string"><span class="hljs-string">_addReferralSource</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cmp</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_campaign</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">cnt</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_content</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">trm</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  .  </span></span><code><span class="hljs-string"><span class="hljs-string">utm_term</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="python"><span class="hljs-string"><span class="hljs-string">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">sbjs_current</span></span></code><span class="hljs-string"><span class="hljs-string"> ,         .         . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_first_add </span></span><br><span class="hljs-string"><span class="hljs-string">      : /   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">fd</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         .    </span></span><code><span class="hljs-string"><span class="hljs-string">yyyy-mm-dd hh:mm:ss</span></span></code><span class="hljs-string"><span class="hljs-string"> .    UTC.      </span></span><code><span class="hljs-string"><span class="hljs-string">_setTimeZoneOffset</span></span></code><span class="hljs-string"><span class="hljs-string"> . </span></span><b><span class="hljs-string"><span class="hljs-string">ep</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_session </span></span><br><span class="hljs-string"><span class="hljs-string"> -,     .  : 30      </span></span><code><span class="hljs-string"><span class="hljs-string">_setSessionLength</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_referer </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">ref=http://habrahabr.ru</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">ref</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´¬ª ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> sbjs_udata </span></span><br><span class="hljs-string"><span class="hljs-string">    : ip  user-agent. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"> </span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="bash"><span class="hljs-string"><span class="hljs-string">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><i><span class="hljs-string"><span class="hljs-string"></span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b><span class="hljs-string"><span class="hljs-string">uip</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ip- . </span></span><b><span class="hljs-string"><span class="hljs-string">uag</span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  user-agent () . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string"> : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">          . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string">       .    ,   </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">  .       ,    , </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == '</span></span>loaded<span class="hljs-string"><span class="hljs-string">' || script.readyState == '</span></span>completed<span class="hljs-string"><span class="hljs-string">') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('</span></span>data-<span class="hljs-type"><span class="hljs-type">box</span></span><span class="hljs-string"><span class="hljs-string">').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== '</span></span>undefined<span class="hljs-string"><span class="hljs-string">') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('</span></span><span class="hljs-keyword"><span class="hljs-keyword">load</span></span><span class="hljs-string"><span class="hljs-string">', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   https  http </span></span><br><span class="hljs-string"><span class="hljs-string">       </span></span><code><span class="hljs-string"><span class="hljs-string">https</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">http</span></span></code><span class="hljs-string"><span class="hljs-string">    ,        </span></span><code><span class="hljs-string"><span class="hljs-string">typein</span></span></code><span class="hljs-string"><span class="hljs-string"> (   ). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  ¬´|¬ª  utm- </span></span><br><span class="hljs-string"><span class="hljs-string">    ,    </span></span><code><span class="hljs-string"><span class="hljs-string">get_sbjs</span></span></code><span class="hljs-string"><span class="hljs-string">   .  . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">        .    ,   . ,     ,     .   ,        </span></span><a href="https://github.com/alexfedoseev/sourcebuster-js/issues"><span class="hljs-string"><span class="hljs-string">issue  Github</span></span></a><span class="hljs-string"><span class="hljs-string"> . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   ,     .</span></span></code> </pre> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h5> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h6> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> <h4> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </h4> <code><code><code class="html"> ,     ,          DOM'. <br> <br></code>   <br>   : <br> <br> &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>   , : <br>               (  ‚Äî  /  /   ) <br>      <br>            Google.   : 30 .     ,      .          . . ip     . <br> <br>  ¬´   ¬ª <br> <code class="javascript">&lt;script&gt; var _sbjs = _sbjs || []; _sbjs.push(['_setSessionLength', 15]); _sbjs.push(['_setBaseHost', 'statica.alexfedoseev.com']); _sbjs.push(['_setTimeZoneOffset', 4]); _sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']); _sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']); _sbjs.push(['_addReferralSource', 'plus.url.google.com', 'social', 'plus.google.com']); &lt;/script&gt; &lt;script src="/path/to/sourcebuster.min.js" id="sbjs"&gt;&lt;/script&gt;</code> <br> <br>          <code>_sbjs.push</code>       . <br> <br>   7   : <br> _setSessionLength _setBaseHost _setTimeZoneOffset _setCampaignParam _addOrganicSource _addReferralSource _setUserIP <br>   . <br> <br> _setSessionLength <br> <code class="javascript">_sbjs.push(['_setSessionLength', 15]);</code> <br>      . <br>           / -  . <br> <br>     .        ,      .          ,       ,    .      Google Analytics: <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/1bc/575/930/1bc575930757ba450f27f4bf8292aee2.jpg"> <br> <br>   utm-     (  ).      ‚Äî    .       .          ,          .         ,         .  ‚Äî   :            ,      ‚Äî    ,        . <br> <br> _setBaseHost <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'alexfedoseev.com']);</code> <br>   ,         ( ) .   ,        . <br> <br> <i> 1</i> <br>     : <b>site.com</b> .     : <b>blog.site.com</b> .   ,           :    <b>blog.site.com</b>    <i>referral</i>        .          : <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com']);</code> <br>   ,     <b>blog.site.com</b>  <b>site.com</b> (   <b>alex.blog.site.com</b>  <b>site.com</b> ),           <i>site.com/about</i>  <i>site.com/contacts</i> . <br> <br> <i> 2</i> <br>    :           .    ( <b>site.com</b> )    ( <b>blog.site.com</b> ),       ( <b>alex.blog.site.com</b> ).     <b>blog.site.com</b>  <b>alex.blog.site.com</b>   ,         ‚Äî .  : <br> <br> <code class="javascript">//     _sbjs.push(['_setBaseHost', 'site.com', false]); //    blog.site.com  alex.blog.site.com _sbjs.push(['_setBaseHost', 'blog.site.com']);</code> <br>      <code>false</code>     .      ,  -        .   ,        ,   . <br> <br>                 .          ,      ,    : <b>alex.blog.site.com</b> ( : <i>referral</i> ). <br> <br>   ,    ,    <code>false</code> . <br> <br>  ,     <code>_setBaseHost</code>   <code>false</code>    ,    . <br> <br> <code class="javascript">// :   site.com _sbjs.push(['_setBaseHost', 'site.com', false]); //   :   blog.site.com _sbjs.push(['_setBaseHost', 'site.com', false]);</code> <br> <br>     ,       -. <br> <br> <code class="javascript">_sbjs.push(['_setBaseHost', 'site.com', false]); //=&gt;      site.com  </code> <br> <br> _setTimeZoneOffset <br> <code class="javascript">_sbjs.push(['_setTimeZoneOffset', 4]);</code> <br>   . <br>      UTC.      . <br> <br> _setCampaignParam <br> <code class="javascript">_sbjs.push(['_setCampaignParam', 'custom_campaign']);</code> <br>  GET-,       <code>utm_campaign</code> (      <code>utm_campaign</code> ).       -  Google AdWords <code>gclid</code> . <br> <br> <i> </i> <br>       Google AdWords,     <code>gclid</code> ,    ,  utm-. Sourcebuster   ,   utm-  Google AdWords. <br> <br>       <code>gclid</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: google_cpc utm_content: (none) utm_term: (none) <br>     <code>utm_campaign</code>  <code>_setCampaignParam</code> : <br> <a href="http://statica.alexfedoseev.com/sourcebuster-js/%3Fgclid%3DsMtH%26custom_campaign%3Dtest_custom">http://statica.alexfedoseev.com/sourcebuster-js/?gclid=sMtH&amp;custom_campaign=test_custom</a> <br> <br>    : <br> Traffic type: utm utm_source: google utm_medium: cpc utm_campaign: test_custom utm_content: (none) utm_term: (none) <br> <b></b> <br>      utm- (utm_source, utm_medium, utm_campaign),   <code>gclid</code>  ,   <code>_setCampaignParam</code> ,  .      ,   <code>_setCampaignParam</code> , Sourcebuster     utm-. <br> <br> _addOrganicSource <br> <code class="javascript">_sbjs.push(['_addOrganicSource', 'yahoo.com', 'p']); _sbjs.push(['_addOrganicSource', 'bing.com', 'q', 'bing']);</code> <br>    . <br> <br>   ,       <b>bing.com</b> ‚Äî  .        ‚Äî <code>'bing.com'</code> ,     ‚Äî <code>'q'</code> .   .            ( <code>'bing'</code> ). <br> <br>     ,    <b>bing.com</b>       (, <i>¬´apple¬ª</i> ).          : <br> <i><a href="http://www.bing.com/search">www.bing.com/search</a> ? <b>q=apple</b> &amp;go=&amp;qs=n&amp;form=QBLH&amp;pq=apple&amp;sc=8-5&amp;sp=-1&amp;sk=&amp;cvid=718ad07527244c319ecebf44aa261f64</i> <br> <br>    ‚Äî <code>'q'</code> ‚Äî    ¬´?¬ª ( ¬´&amp;¬ª        )  ¬´=apple¬ª     . <br> <br> _addReferralSource <br> <code class="javascript">_sbjs.push(['_addReferralSource', 'facebook.com', 'social']); _sbjs.push(['_addReferralSource', 't.co', 'social', 'twitter.com']);</code> <br>    . ,   ,  <code>utm_medium</code>     <b>facebook.com</b>    <code>referral</code> ,     .          (, <code>utm_medium=social</code> ),        <code>_addReferralSource</code> .   ‚Äî   ,  ‚Äî   <code>utm_medium</code> . <br> <br>           (,  Twitter   ‚Äî <b>t.co</b> ).            .              . <br> <br> _setUserIP <br> <code class="javascript">_sbjs.push(['_setUserIP', &lt;%= request.remote_ip %&gt;]);</code> <br>      ip- .        ,     <code>_setUserIP</code> ,   .   ,     Ruby. <br> <br>  <br> Cookies <br> ,    .          : <br> sbjs_current sbjs_first sbjs_first_add sbjs_session sbjs_referer sbjs_udata <br> sbjs_current <br>     . <br>       (1-2-3- ),        . <br> <br> <i> </i> <br> <code class="bash">typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <i></i> <br> <b>typ</b> <br>  .  : <code>utm</code> , <code>organic</code> , <code>referral</code> , <code>typein</code> .   . <b>src</b> <br> .    <code>utm_source</code> . <b>mdm</b> <br> .  <code>utm_medium</code> .    utm-  <code>_addReferralSource</code> . <b>cmp</b> <br>  .  <code>utm_campaign</code> . <b>cnt</b> <br>   .  <code>utm_content</code> . <b>trm</b> <br>  .  <code>utm_term</code> . <br> <i> </i> <br> <code class="python">#     typ=utm|src=yandex|mdm=cpc|cmp=my_adv_campaign|cnt=banner_1|trm=buy_my_stuff #    typ=organic|src=google|mdm=organic|cmp=(none)|cnt=(none)|trm=(none) #      typ=referral|src=site.com|mdm=referral|cmp=(none)|cnt=(none)|trm=(none) #   facebook     _addReferralSource typ=referral|src=facebook.com|mdm=social|cmp=(none)|cnt=(none)|trm=(none) #   typ=typein|src=typein|mdm=typein|cmp=(none)|cnt=(none)|trm=(none)</code> <br> <br> sbjs_first <br>      <code>sbjs_current</code> ,         .         . <br> <br> sbjs_first_add <br>      : /   . <br> <br> <i> </i> <br> <code class="bash">fd=2014-06-11 17:28:26|ep=http://statica.alexfedoseev.com/sourcebuster-js/</code> <br> <i></i> <br> <b>fd</b> <br>         .    <code>yyyy-mm-dd hh:mm:ss</code> .    UTC.      <code>_setTimeZoneOffset</code> . <b>ep</b> <br>    . <br> <br> sbjs_session <br> -,     .  : 30      <code>_setSessionLength</code> (   ). <br> <br> sbjs_referer <br> ,       . <br> <br> <i> </i> <br> <code class="bash">ref=http://habrahabr.ru</code> <br> <i></i> <br> <b>ref</b> <br>  ¬´¬ª ,      . <br> <br> sbjs_udata <br>    : ip  user-agent. <br> <br> <i> </i> <br> <code class="bash">uip=80.20.123.77|uag=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36</code> <br> <i></i> <br> <b>uip</b> <br>  ip- . <b>uag</b> <br>  user-agent () . <br> <br>   <br>    <code>get_sbjs</code> : <br> <br> <code class="javascript">get_sbjs.____sbjs_.___ // ,    utm_source get_sbjs.current.src //  utm_medium get_sbjs.first.mdm //   get_sbjs.first_add.ep // user-agent  get_sbjs.udata.uag //  ..</code> <br>          . <br> <br>   <br>       .    ,   <code>get_sbjs</code>  .       ,    , <code>get_sbjs</code>    ,       (sourcebuster),      ,    .   IE8              (  sourcebuster). <br> <br> <code class="javascript">//       &lt;div id="data-box"&gt;&lt;/div&gt; &lt;script type="text/javascript"&gt; // /  IE,  callback-      //    callback -  ,    ,    -  sourcebuster function ie_load_bug_fix(script, callback) { if (script.readyState == 'loaded' || script.readyState == 'completed') { callback(); } else { setTimeout(function() { ie_load_bug_fix(script, callback); }, 100); } } // ,     function place_data() { document.getElementById('data-box').innerHTML = get_sbjs.current.src; } // : //       get_sbjs //   ,      //  ,           sourcebuster if (typeof get_sbjs !== 'undefined') { place_data(); } else { if (window.addEventListener) { sbjs.addEventListener('load', place_data, false); } else if (window.attachEvent) { ie_load_bug_fix(sbjs, place_data); } } &lt;/script&gt;</code> <br> <br>  <br> <br>   https  http <br>       <code>https</code>  <code>http</code>    ,        <code>typein</code> (   ). <br> <br>  ¬´|¬ª  utm- <br>    ,    <code>get_sbjs</code>   .  . <br> <br>  <br>        .    ,   . ,     ,     .   ,        <a href="https://github.com/alexfedoseev/sourcebuster-js/issues">issue  Github</a> . <br> <br>   ,     .</code> </div><p>Source: <a href="https://habr.com/ru/post/227665/">https://habr.com/ru/post/227665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227653/index.html">Start of construction in the village of programmers</a></li>
<li><a href="../227655/index.html">Tools of IT departments of large companies: how to get rid of chaos and count every penny</a></li>
<li><a href="../227657/index.html">Authorities in the Irkutsk region banned from using Google</a></li>
<li><a href="../227659/index.html">How we provided communication "Sapsan" and "Allegro"</a></li>
<li><a href="../227661/index.html">The State Duma is going to impose restrictions on payment systems</a></li>
<li><a href="../227667/index.html">Developing (soccer) games using MonoGame</a></li>
<li><a href="../227669/index.html">Mars rover Curiosity completed the main scientific mission</a></li>
<li><a href="../227671/index.html">We Are the Dwarves! - domestic tactical action on Kickstarter</a></li>
<li><a href="../227675/index.html">IPega PG-9025 Gamepad Review: Turning an Android-Smartphone into a Portable Console</a></li>
<li><a href="../227679/index.html">The fall of the last intellectual bastion: is a computer chess player really stronger than a man?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>