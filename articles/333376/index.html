<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Database as Code. Digging deeper</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In IT projects, code is written by everyone. Engineers manage Kubernetes clusters with a few lines, disperse clouds with Terraform, and roll tons of c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Database as Code. Digging deeper</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/zi/bo/xq/ziboxqarl3txhikufej2nvqua2c.jpeg"></p><br><p>  In IT projects, code is written by everyone.  Engineers manage Kubernetes clusters with a few lines, disperse clouds with Terraform, and roll tons of configurations on Ansible, Chef, and Puppet.  QA write understandable business test scenarios on Spock and Cucumber.  Analysts are fluent, often better than developers, talking in SQL.  Project documentation in Markdown, AsciiDoc or LaTEX formats is "compiled" into the required format on the build server.  Well, the developers themselves, these code tamers, immediately speak a lot of languages ‚Äã‚Äãfor every life situation - client, server, script, functional, etc. </p><br><p>  The code has long ceased to be mysterious gibberish and is now in one form or another accessible and understandable to many, <a href="https://habr.com/post/365479">even the prime ministers</a> .  And all this code is involved in the standard life cycle - is under the control of VCS, subjected to code review, automated testing, CI, CD.  Common tools and approaches, performance and quality metrics are used.  And all together it has a proud name - "Everything as code". </p><br><p>  However, the world of database traditionally stands apart from this extravaganza of progress and technology.  The process of developing and maintaining a database does not change for years and continues to instill horror and fear in developers, administrators and users around the world.  But is it possible to present the database in the form of a regular code?  Get closer to the basic development process, use common tools and approaches?  About this under the cut. </p><a name="habracut"></a><br><h1 id="tipichnyy-proekt">  Typical project </h1><br><p>  Most of us every day, whether we like it or not, have to deal with a variety of databases.  Design, develop, administer, solve problems with performance, competitive access and that's it.  At the same time, requirements for collecting, processing and storing data are constantly being tightened - for some, 100% consistency is needed, for others it is not.  Some are stored for years, others a few seconds.  The loss of one will lead to millions in losses, while the loss of others will not be noticeable to the business. </p><br><p>  In this regard, the <a href="https://martinfowler.com/bliki/PolyglotPersistence.html">Polyglot Persistence</a> approach has appeared and is being used successfully for a long time, as a result of which to meet one single DBMS on any project today will be a great success.  Instead, for each specific task, the most suitable base is selected, without trying to somehow get out and solve all their problems in the good old relational.  And, for example, the microservice architecture allows you to isolate work from a specific DBMS within one service and squeeze the maximum benefit out of it, without harming the cleanliness of the architecture of the entire project.  As a result, " <strong><em>Relational</em></strong> " (where to go without it) + " <strong><em>Key-value DB</em></strong> " + " <strong><em>Wide Column DB</em></strong> " + " <strong><em>Document-oriented DB</em></strong> " + " <strong><em>Search engine DB</em></strong> " + " <strong><em>Graph DB</em></strong> " + " <strong><em>Something else DB</em></strong> " = " <strong><em>SUCCESS!</em></strong> ".  In addition, the number of instances of these databases ‚Äî sharding, replication, distributed DBMS ‚Äî is increasing.  Plus, all this must be "stretched" and maintained in different environments - development, test, food, etc. </p><br><p>  Not to be unsubstantiated, I‚Äôll give a few excerpts from a fresh poll from the giant company on database management and development solutions Quest Software - <a href="https://www.quest.com/whitepapert/dbas-face-new-challenges-trend-in-database-administration-8130482/%3Fparam%3DAtii%252FfmTEZXy3nsJCa8V2slf6pUG3GyWRs4yK0H%252BV6eEA3JvCMN6imQzO6W2bLiUWqUKi%252BW%252FcZDlHt9xcpineQe34qfhI%252FxmFNM%252BR1Lye3mqBj%252BAUJ%252BlCEyy6ElMpd0V9TsUl2jmB%252Bus2JWKueJPKpfOTZwfIQIph%252FKKTtJodIaxNKDJEO78PNp9lNVT31hOyl1BapipycPunpxrcTDM8VtEfl%252BWl3gsXbaH2V5Dk24%253D">DBA Problems: Trends in Database Administration</a> (to download, you have to go through a simple registration, but it's worth it): </p><br><ul><li>  Question number 2: ‚Äú <strong>How many instances of relational databases are running in your company?</strong> ‚Äù - according to the results, 24% of respondents use from 100 to 500 instances, and 19% use more than 500. </li><li>  Question 4: ‚Äú <strong>How many different DBMS (SQL and NoSQL) are used in your company?</strong> ‚Äù - 56% use from 2 to 3 different DBMS, 40% use more than 5, and only 4% of respondents have the only one DBMS. </li><li>  Question 18: ‚Äú <strong>What happens to the number of database instances in your projects?</strong> ‚Äù - 2/3 of respondents mark their annual increase. </li><li>  Question # 30 (as a result): " <strong>What are the main problems the DBA will face in the next 3 years?</strong> " <br><ol><li>  51% - " <em>Increasing the number of DBMS instances</em> " </li><li>  40% - "The <em>ability to administer new non-relational databases</em> " </li><li>  32% - " <em>Reducing IT-budget" (which, as expected, swells due to the first two problems)</em> </li></ol></li></ul><br><h1 id="a-my-gotovy-k-etomu">  Are we ready for this? </h1><br><p>  It is no secret that in order to work effectively with a particular DBMS, specialized tools are needed, such as IDE and DB managers, monitoring tools, modeling tools, migration schemes, and much more.  However, most of these tools and environments were invented and developed back in those glorious times when a single relational DBMS was enough for any project, and such buzz words as " <em>Agile</em> ", " <em>DevOps</em> " and " <em>CI / CD</em> ", not invented.  And since then, little has changed, because  the area of ‚Äã‚Äãdevelopment and maintenance of the database has always been fairly closed and conservative, and most developers associate with something ancient, complex and incomprehensible.  Today, when practically the most disparate DBMS and dozens / hundreds of their instances work in almost any project management, the usual everyday problems of developers and DBA become even more acute. </p><br><p>  Traditionally, all kinds of IDEs are the most popular and indispensable tool for working with databases.  Usually this is a complex solution that combines a variety of functions for developing and administering into a single working environment under its interface, mainly graphical, making our work with the database more productive and comfortable - all that remains is to click on the desired menu item.  And indeed, few of us do without such cool things as <a href="https://www.sqlmanager.net/ru/products/manager">EMS SQL Manager</a> , <a href="https://www.quest.com/toad">Toad</a> , <a href="https://www.devart.com/dbforge">dbForge,</a> and <a href="https://github.com/mgramin/awesome-db-tools">many others</a> . </p><br><p>  One of the main problems of such "boxes" is that under the pressure of new features and new DBMS (which do not cease to appear on the market) they turn out to be quite complex and continue to become more complex each time.  And both in use (often people have to learn not the features of a particular DBMS, but the tricks and features of the IDE itself), and in their implementation (therefore, such systems are usually closed and very paid).  Even many (including me), the favorite <a href="https://github.com/dbeaver/dbeaver">DBeaver</a> , the flagship among the open sourse DB IDE, provides support for NoSQL solutions (and which project is now without them) <a href="https://dbeaver.com/edition">only in its Enterprise version</a> .  In addition to all this, there is a non-illusory risk that the support of any very necessary and interesting functionality of the DBMS can not be expected soon, until the IDE developers consider it necessary (or they may not consider it at all). </p><br><p>  In response to the current situation, users themselves often do not wait until the necessary feature or support of the new DBMS appears, but they solve the incoming problems on their own and in the most appropriate way for themselves and their project.  GitHub just teems with such solutions of varying degrees of complexity.  Basically, these are sql-scripts for all occasions ( <a href="https://github.com/dataegret/pg-utils">dataegret / pg-utils</a> , <a href="https://github.com/NikolayS/postgres_dba">NikolayS / postgres_dba</a> , <a href="https://github.com/gwenshap/Oracle-DBA-Scripts">gwenshap / Oracle-DBA-Scripts</a> , <a href="https://github.com/ktaranov/sqlserver-kit">ktaranov / sqlserver-kit</a> , <a href="https://github.com/lestatkim/opensql">lestatkim / opensql</a> ).  Or console utilities, such as top-like <a href="https://github.com/julmon/pg_activity">pg_activity</a> and <a href="https://github.com/lesovsky/pgcenter">pgcenter</a> .  As well as all sorts of web-based tools, ranging from completely independent clients and monitoring tools ( <a href="https://github.com/sosedoff/pgweb">pg_web</a> , <a href="https://github.com/ankane/pghero">pg_hero</a> ) to, for example, just html wrappers over system tables ( <a href="https://github.com/kirs/pg_web_stats">pg_web_stats</a> , <a href="https://github.com/nordicdyno/pg_stats_viewer">pg_stats_viewer</a> ).  As a result, a whole class of solutions of the form "programmers-for-programmers", "DBA-for-DBA" is formed, with the help of which simple, and not so much, DBMS users share their experiences with each other directly. </p><br><h1 id="everything-as-code">  Everything as code </h1><br><p>  A similar picture was once observed long ago in the area of ‚Äã‚Äãserver administration and software configuration management.  Then, with the constant emergence of new requirements and technologies, the infrastructure of projects became noticeably more complex, the number of servers and software running on it increased dramatically.  And there was also a need for more frequent, and then continuous, delivery of software with new business features to the customer.  Existing tools for configuring and managing all these facilities did not cope well, resulting in the ‚ÄúInfrastructure as Code‚Äù approach and such tools as Ansible, Chef, Salt, Puppet, and others, where infrastructure configuration is performed on a special DSL.  That gives more flexibility and freedom of creativity.  And the code on such DSL participates in the standard life cycle along with the main application code (in Java, C #, Ruby, or any other programming language), namely, it is stored in the version control system (with all the attendant problems - branch, fork, code review), going to builds on the build server, running automatic tests, etc. </p><br><p>  In the future, the impact of this approach has become noticeable in other areas: </p><br><ul><li>  " <strong>Test as Code</strong> " - <a href="http://spockframework.org/">Spock</a> , <a href="https://cucumber.io/">Cucumber</a> , <a href="https://gatling.io/">Gatling</a> , <a href="http://blog.getpostman.com/2017/10/25/writing-tests-in-postman">Postman</a> </li><li>  " <strong>Pipeline as Code</strong> " - <a href="https://jenkins.io/doc/book/pipeline">Jenkins pipeline</a> </li><li>  " <strong>Documentation as code</strong> " - Markdown, AsciiDoc, LaTeX </li><li>  " <strong>Diagram as Code</strong> " - <a href="http://en.plantuml.com/">PlantUML</a> , <a href="https://www.graphviz.org/">Graphviz</a> , <a href="https://github.com/knsv/mermaid">Mermaid</a> , <a href="">flowchart.js</a> </li><li>  " <strong>DNS as code</strong> " - <a href="https://github.com/StackExchange/dnscontrol">DNSControl</a> , <a href="https://github.com/github/octodns">OctoDNS</a> </li><li>  " <strong>Presentation as code</strong> " - <a href="">reveal.js</a> </li></ul><br><p>  More and more people are no longer afraid to write code, this is becoming the norm.  This allows a more flexible configuration, and also allows the use of common tools (version control, metrics, visualization, reports, testing, etc.) in the general flow.  In many specialized tools, the graphical interface is replaced or supplemented by a more flexible software interface, various DSL and configuration files. </p><br><p>  More information on this topic can be found in the report by Alexander Tarasov ( <a href="https://habr.com/users/aatarasoff/" class="user_link">aatarasoff</a> ) <a href="https://youtu.be/_Zm8ORdNT0Y">"Everything as a Code"</a> . </p><br><h1 id="database-as-code">  Database as code </h1><br><p>  And what about this in the vast world of databases?  Having typed in Google a simple phrase " <a href="https://www.google.ru/search%3Fq%3DDatabase%2Bas%2Bcode">Database as code</a> ", I did not find anything interesting, except for a single (but what!) Post on DZone - " <a href="https://dzone.com/articles/database-as-code-a-novel-concept">Database as Code: a Novel Concept</a> ". </p><br><blockquote> We talk a lot about the database-first approach.  We talk a lot about the fact that data is the most valuable asset of an enterprise.  But what about the concept presented by <a href="https://twitter.com/tastapod">Dan North</a> on the third slide of his <a href="https://speakerdeck.com/tastapod/arent-we-forgetting-someone%3Fslide%3D1">presentation</a> ?  What if you treat a database like code? </blockquote><p>  It sounds tempting, and on slides # 5 and # 6 (unfortunately, I did not find the video) 2 approaches to managing the database schema "through code" are described - through incremental migrations (Liquibase, Flyway) and idempotent DDL scripts ( <a href="https://www.red-gate.com/products/sql-development/sql-compare">Redgate</a> ).  Thus, the scheme is also code, it is under the control of VCS, builds on a build server, automatic tests are performed and so on. </p><br><blockquote>  What do we need to change our way of working with databases?  We must stop treating our database as a magical artifact or as a unique scenario and look at it from the same angle as we look at the usual code of our application. </blockquote><p>  Powerfully said again, I already have tears in my eyes.  Unfortunately, both in the report and in the post itself, ‚Äúas a code‚Äù, <strong><em>only changes to the database schema</em></strong> (migration of the database schemas) are considered: </p><br><blockquote>  We treat the source code of our application as a treasure.  And this is absolutely true, the code is the heart of any application.  But shouldn't <strong><em>the database changes</em></strong> also be under control of the version control system, be automated, be ready for release on demand and obey the ‚ÄúDevOps-laws‚Äù, like the main code? </blockquote><p>  But wait a minute ... </p><br><h1 id="bd---eto-ne-tolko-shema">  DB is not only a schema! </h1><br><p>  Most modern DBMSs provide their own query language, with which we can not only receive and modify the data stored in it (the so-called DML) and operate on its schema (the so-called DDL), but generally get it (I'm not afraid of this word) <em>Any</em> meta information about the current database and its state (from system tables and views) and perform almost any operations on it (start the database, stop, convert to read only, collect statistics, manage memory, etc.).  And such code is also quite suitable for the concept described in the previous paragraph. </p><br><p>  And when it comes to the database and query language, the first to come to mind is, of course, the good <em>old</em> SQL.  But can we count on it (and at the same time on relational databases, with which the majority is closely associated) now and in the near future, given the huge growth in demand for NoSQL solutions? </p><br><h1 id="ved-sql-uzhe-vsyo-">  "After all, is SQL already everything? ..." </h1><br><p>  You can rightly ask me what kind of SQL I am talking about here in the era of NoSQL and schemaless databases, when " <em>dusty relationals live their life only in the bloody legacy of Interprise</em> ".  Early Habr (as a litmus test of trends in the technology world) was also once filled with a negative attitude towards SQL and relationals and foreshadowed their early death (the number of votes is shown in parentheses, and the number of comments is indicated through a slash): </p><br><ul><li>  2009 - <a href="https://habr.com/post/74144">‚ÄúMongoDB or how to stop loving SQL‚Äù</a> ( <strong>+115</strong> / <em>99</em> ) </li><li>  2010 - <a href="https://habr.com/post/102532">‚ÄúNoSQL Collection Point‚Äù</a> ( <strong>+53</strong> / <em>45</em> ) </li><li>  2011 - <a href="https://habr.com/post/103021">‚ÄúAre relational databases doomed?‚Äù</a> ( <strong>+77</strong> / <em>131</em> ) </li><li>  2012 - <a href="https://habr.com/post/152477">"NoSQL database: we understand the essence"</a> ( <strong>+129</strong> / <em>75</em> ) </li></ul><br><p>  However, from about the 12th year, the mood on Habr√© changes noticeably: </p><br><ul><li>  2012 - <a href="https://habr.com/post/153859">‚ÄúThink 1000 times before using noSQL‚Äù</a> ( <strong>+109</strong> / <em>130</em> ) </li><li>  2013 - <a href="https://habr.com/company/jelastic/blog/166845">‚ÄúNoSQL and Big Data - deception of workers?‚Äù</a> ( <strong>+75</strong> / <em>286</em> ) </li><li>  2014 - <a href="https://habr.com/post/231213">‚ÄúWhy you should never use MongoDB‚Äù (+143/245)</a> ( <strong>+143</strong> / <em>245</em> ) </li><li>  2017 - <a href="https://habr.com/company/alconost/blog/340372">‚ÄúWhy SQL prevails over NoSQL, and where it will lead in the future‚Äù</a> ( <strong>+22</strong> / <em>105</em> ) </li><li>  2018 - <a href="https://habr.com/post/417581">"No, you do not need machine learning. You need SQL"</a> ( <strong>+102</strong> / <em>417</em> ) </li></ul><br><p>  At the same time, anti-sql and anti-relational moods continue to take place, but the community‚Äôs reaction to them is already completely different: </p><br><ul><li>  2014 - <a href="https://habr.com/post/236523">‚ÄúDisadvantages of RDBMS or RDBMS vs NoSQL‚Äù</a> ( <strong>-34</strong> / <em>79</em> ) </li><li>  2015 - <a href="https://habr.com/post/267079">‚ÄúIsn't it time for relational databases to be dumped in history?‚Äù</a> ( <strong>-7</strong> / <em>309</em> ) </li></ul><br><p>  Confirmation of these attitudes can be found in the recent reports by Konstantin Osipov ( <a href="https://habr.com/users/kostja/" class="user_link">kostja</a> ) <a href="https://youtu.be/_8OZcgOKUyk">"NewSQL: SQL does not go anywhere"</a> and Andrei Nikolayenko <a href="http://www.highload.ru/2017/abstracts/3069.html">"Non-relational SQL"</a> .  I take the responsibility to bring a brief summary of both presentations: </p><br><ul><li>  " <strong>SQL in NoSQL</strong> " - SQL (as it is not strange) feels pretty comfortable in <strong>NoSQL as</strong> well.  Practically in all NoSQL databases, it is possible to use any sql-like query language, such as <a href="http://cassandra.apache.org/doc/latest/cql/index.html">CQL</a> in Cassandra and ScyllaDB, <a href="https://www.aerospike.com/docs/tools/aql/">AQL</a> in Aerospike and <a href="https://www.couchbase.com/products/n1ql">N1QL</a> in Couchbase, and in some cases a full (or as close as possible to it) ANSI SQL - as in <a href="https://tarantool.io/en/doc/2.0/tutorials/sql_tutorial">Tarantool</a> , <a href="https://clickhouse.yandex/docs/en/query_language">ClickHouse</a> and <a href="https://crate.io/docs/crate/reference/en/2.0/sql/index.html">CrateDB</a> . </li><li>  " <strong>SQL in the clouds</strong> " - Cloud giants provide support for a variety of SQL storage: <a href="https://aws.amazon.com/ru/rds/">Amazon RDS</a> , <a href="https://aws.amazon.com/ru/rds/aurora/">Amazon Aurora</a> , <a href="https://cloud.oracle.com/database">Oracle Cloud</a> , <a href="https://cloud.google.com/sql/docs/">Google Cloud SQL</a> , <a href="https://azure.microsoft.com/ru-ru/services/sql-database/">Microsoft SQL Azure</a> , <a href="https://www.alibabacloud.com/product/apsaradb-for-rds">Alibaba Cloud ApsaraDB</a> , <a href="https://cloud.yandex.ru/services/mdb">Yandex Managed Databases</a> . </li><li>  " <strong>SQL in BigData</strong> " - SQL has long been tightly integrated into the Hadoop infrastructure.  Back in 2009, <a href="https://hive.apache.org/">Hive</a> appeared with its HiveQL, and then, year after year, solutions began to appear that directly support SQL - <a href="https://impala.apache.org/">Impala</a> (2011), <a href="https://spark.apache.org/">Spark</a> (2013), <a href="https://kudu.apache.org/">Kudu</a> (2014), <a href="https://prestodb.io/">Presto</a> (2015), <a href="https://phoenix.apache.org/">Phoenix</a> (2017) . </li><li>  " <strong>SQL in Potochnikov</strong> " - SQL has become almost the standard for stream data handlers: <a href="https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/sql.html">Flink</a> , <a href="https://samza.apache.org/learn/tutorials/latest/samza-sql.html">Samza</a> , <a href="http://storm.apache.org/releases/current/storm-sql.html">Storm</a> , <a href="https://apex.apache.org/docs/malhar/apis/calcite/">Apex</a> , and more recently, <a href="https://www.confluent.io/blog/ksql-open-source-streaming-sql-for-apache-kafka">Kafka</a> . </li><li>  " <strong>SQL in NewSQL</strong> " - Many modern DBMSs are actively developing towards <em>NewSQL</em> , where they combine the advantages of both NoSQL and classic relational solutions, including extensive SQL support ( <a href="https://www.cockroachlabs.com/">CockroachDB</a> , <a href="https://www.foundationdb.org/">FoundationDB</a> , <a href="https://www.memsql.com/">MemSQL</a> ). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Need more arguments with pictures!</b> <div class="spoiler_text"><blockquote>  I will give some more arguments further, but if everything is clear, then we can safely proceed to the next paragraph. <br><br><a href="https://blog.jooq.org/2013/11/15/a-history-of-databases-in-no-tation"></a>  <a href="https://blog.jooq.org/2013/11/15/a-history-of-databases-in-no-tation">Database history in "No notations":</a> <br><img src="https://habrastorage.org/webt/p9/y3/8f/p9y38f9qglzusht-lxpeek8hwdk.jpeg"><br><br>  Also recently, there are many new and trendy DBMSs that are ‚Äúadd-ons‚Äù over well-known and proven relational DBMSs.  For example, Postgres-based ( <a href="https://www.timescale.com/">Timescale</a> and <a href="https://www.torodb.com/">ToroDB</a> ), MySQL-based ( <a href="https://github.com/radondb/radon">RadonDB</a> ) and even based on sqllite (which has always been positioned as a simple and reliable embedded database) appeared <a href="https://github.com/rqlite/rqlite">rqlite</a> - ‚Äúlight distributed relational storage‚Äù.  Or implement the interface of a popular database (for example, MySQL for <a href="http://infinidb.co/">InfiniDB</a> and <a href="https://github.com/pingcap/tidb">TiDB</a> ).  This approach is good because with the new data model we remain on the same familiar platform that we know how to configure and administer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, for the very ‚Äúuncirculated‚Äù guys, there are also attempts to create a common universal language ‚Äúa la SQL‚Äù, such as <a href="https://dzone.com/articles/using-domain-specific-language-to-manipulate-nosql">Eclipse JNoSQL</a> , or rather its <a href="https://github.com/eclipse/jnosql-aphrodite">JNoSQL Aphrodite</a> subproject. <br><br>  Google, which is one of the pioneers of the NoSQL movement, is also making more and more emphasis on SQL.  At first it was <a href="https://cloud.google.com/spanner">Spanner</a> , and now <a href="https://ai.googleblog.com/2018/07/machine-learning-in-google-bigquery.html">BigQuery</a> is actively developing: <br><img src="https://habrastorage.org/getpro/habr/post_images/0ac/f05/9d6/0acf059d688ee90b4f21418ee8f536c4.gif"><br><br>  SQL interfaces acquire not only data warehouses and data handlers.  For example, using <a href="https://osquery.io/">osquery</a> (from Facebook itself) and <a href="https://github.com/kshvmdn/fsql">fsql</a> in SQL, you can get a lot of useful information from any OS or perform various operations with file systems. <br><br><img src="https://habrastorage.org/webt/lm/ij/5y/lmij5y7bfgvhwx-tmtqfki68txy.jpeg"></blockquote></div></div><br><p>  In general, SQL feels quite comfortable in modern conditions, including far beyond the boundaries of relationals.  With virtually any data source, you can "talk" in the SQL or SQL-like language, get the necessary information about the data or metadata of the repository and perform some operations (for example, create something, delete, start, stop, etc.) </p><br><p>  <em>Hereinafter (for convenience and with your permission), by ‚ÄúSQL‚Äù I will mean not only the ‚Äúsame‚Äù standard relational SQL, but also all its subspecies (including far from relational ones), and indeed any embedded in DB QL, with which you can do something useful.</em> </p><br><h1 id="k-chemu-vse-eto">  Why all this? </h1><br><p>  And the fact that in the distant 92nd year, a wonderful <a href="https://en.wikipedia.org/wiki/SQL-92">ANSI standard appeared</a> , according to which any relational DBMS must be able to describe its internal structure in a special scheme - the <a href="https://en.wikipedia.org/wiki/Information_schema">Information schema</a> .  So  using the standard query language for service tables / views, you can get the metadata of any database - as it contains charts, tables, indexes, columns, etc. But in fact it is not limited to the same data scheme in the same way (even if outside the standard) you can get information about processes, sessions, query execution plans, disk subsystem, memory utilization and much more. </p><br><p>  Despite the fact that this standard appeared almost a quarter of a century ago and only for relational databases, almost all modern NoSQL and NewSQL databases also implement something similar.  For example, in Cassandra there are <a href="https://docs.datastax.com/en/dse/6.0/cql/cql/cql_using/useQuerySystem.html">several system schemes</a> (or rather keyspaces - system, system_auth, system_schema, system_traces), which can be accessed using the already mentioned CQL.  ClickHouse has a <a href="https://clickhouse.yandex/docs/en/system_tables">special ‚Äúsystem‚Äù scheme</a> .  The developers at CockroachDB generally swung to the <a href="https://www.cockroachlabs.com/docs/stable/information-schema.html">implementation of standard information_schema</a> .  And even document Mongo pleases us with <a href="https://docs.mongodb.com/manual/reference/system-collections">system collections</a> . </p><br><blockquote>  At the same time, there is a constant increase in the number and expansion of such system representations.  For example, in Postgresql (as a database with one of the most active communities), in addition to implementing the information_schema itself, the pg_catalog native scheme and pg_stat representations have several official extensions in the form of the <a href="https://www.postgresql.org/docs/current/static/pgstatstatements.html">pg_stat_statements</a> and <a href="https://www.postgresql.org/docs/current/static/pgbuffercache.html">pg_buffercache presentations</a> .  As well as additional third-party views, such as <a href="https://github.com/pgsentinel/pgsentinel">pg_active_session_history</a> , <a href="https://github.com/ossc-db/pg_store_plans">pg_store_plans</a> and <a href="https://github.com/powa-team/pg_stat_kcache">pg_stat_kcache</a> . </blockquote><p>  Almost any node corresponds to any system table that displays its structure and / or state.  That is, it can tell about its internal structure and the state of the database itself through its query language.  In addition, many DBMS provides the ability to not only get useful metadata using their query language, but also to perform maintenance operations ‚Äî stop, start, clear, collect statistics, etc. Some things are possible. In some DBMS, the "ALTER" command can be applied not only to tables or columns, but also to other objects, for example, to a session (" <em>alter session set sql_trace = true</em> "), data files (" <em>alter tablespace add datafile</em> ") or the entire system (" <em>alter system kill session</em> "). </p><br><p>  Knowledge of these tables and queries will help both in the development and administration, and in mastering the next new DBMS.  It is clear that in some bases such capabilities are highly developed, and the ‚Äúcode‚Äù can do almost everything, while in others it is much more modest, but there is definitely a tendency that more and more DBMS developers will develop such capabilities in their products, and we can to operate them effectively. </p><br><h2 id="vmesto-vyvodov-i-rezyume">  Instead of conclusions and summaries </h2><br><p>  Unfortunately, SQL has long been firmly perceived by many as a "low-level" language, a kind of "bytecode" for the database.  Which is not accepted, and in some societies it is even deeply indecent to "write with your hands" and in general to contact him in any way.  We have long been accustomed to, that numerous DB-tools and frameworks themselves generate and execute for us " <em>tricky and complex</em> " SQL queries to the system, and this process can only be observed.  But let's get out of the comfort zone of warm tube-based graphical interfaces and code generators and look at our DBMS from the point of view of regular <strong>code</strong> .  Moreover, we have everything necessary for this. </p><br><p>  Now in the case.  Users of any DBMS have the ability to describe almost all aspects of working from their database in the form of a code, in a simple, understandable and familiar to many language.  This may not be ANSI SQL, but any SQL-like dialect, or even its own built-in QL or API, depending on the database used.  How is this useful? </p><br><ul><li>  Without being tied to any tool, you can get any information about the database in the required form, or perform any operation on the database; </li><li>  Since  this is still ordinary <em>code</em> , then it should be treated as any other "real" code.  Namely, it should be clear, structured and formatted according to an accepted standard, as well as participate in all stages of the standard code life cycle - be under the control of VCS, undergo Code review, participate in CI / CD pipeline, etc. (and not " lying "somewhere in a folder called" SQL-tricks ").  That will increase its quality and value in the team. </li></ul><br><p>  I am interested in your opinion on this subject, write in the comments - we will discuss. </p><br><blockquote>  <em>In the next post, I plan to illustrate the ideas described above with specific examples, and also tell you how we at CROC will try to apply them in an experimental open source graphical DB-manager that is being developed as part of a research project.</em> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/333376/">https://habr.com/ru/post/333376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333364/index.html">Identify numbers with CallKit</a></li>
<li><a href="../333366/index.html">How much is your company worth? Brief on business valuation</a></li>
<li><a href="../333368/index.html">Startup cycle: how (in general) venture investment works</a></li>
<li><a href="../333372/index.html">Reverse engineering one line javascript</a></li>
<li><a href="../333374/index.html">Security Week 28: Petya was difficult to open, the Broadcomm chipset bug was closed in Android, Copycat infected 14 million devices</a></li>
<li><a href="../333378/index.html">IBM and the US Air Force are developing a new generation neuromorphous supercomputer</a></li>
<li><a href="../333380/index.html">AWS DeepLearning AMI - why (and how) is it worth using</a></li>
<li><a href="../333382/index.html">Non-productive training of a single-layer perceptron. Classification task</a></li>
<li><a href="../333384/index.html">How large companies monitor employees</a></li>
<li><a href="../333386/index.html">LibGDX + Scene2d (we program on Kotlin). Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>