<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for an explicit pointer to a 32-bit type</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Visual Studio C ++ compiler has a warning C4311 ('variable': pointer truncation from 'type' to 'type') designed to detect pointer casting errors t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for an explicit pointer to a 32-bit type</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B8%25D1%2585%25D0%25BE%25D1%2585%25D0%25BE%25D0%25B4%25D0%25BA%25D0%25B8"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/164/548/8b2/1645488b2053f4559a81b7520a9af629.jpg" alt="Sluggish (lat. Tardigrada)"></a> <br>  The Visual Studio C ++ compiler has a warning <a href="http://www.viva64.com/go.php%3Furl%3D408">C4311</a> ('variable': pointer truncation from 'type' to 'type') designed to detect pointer casting errors to 32-bit data types.  In Intel C ++, this warning corresponds to warning # 810.  An example of a defect detected: <br><br><pre>  void * ptr = x;
 int y = (int) ptr; </pre><br>  In Win64, the pointer size was 64-bit, and the int size was still 32 bits.  Explicit type casting cuts the pointer value, which will lead to an error if the pointer refers to an object outside the lower 4 GB of memory (0x00000000FFFFFFFF). <br><br>  Such errors are insidious because they can manifest irregularly.  However, they can be easily detected by reviewing all the compiler warnings with the number C4311.  But using this check itself there is some unpleasant nuance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  If you simply create a 64-bit project in Visual Studio 2008/2010, and write the code above, you will not receive warnings C4311.  We will understand the reasons for this unexpected situation. <br><br>  In Visual Studio 2003/2005, there is a <a href="http://www.viva64.com/terminology/Wp64_rus.html">/ Wp64</a> switch designed to identify some problems the programmer will encounter when building his code in the 64-bit version.  The warning group C4311 also belongs to the group of warnings.  If you create a project in Visual Studio 2005, then even in the 32-bit configuration for the string ‚Äúint y = (int) ptr;‚Äù a warning will be generated: <br><br><pre>  warning C4311: 'type cast': 
 pointer truncation from 'void *' to 'int'. </pre><br>  The / Wp64 key was designed to somehow prepare applications for a 64-bit platform without the need to create a 64-bit configuration.  However, the time to "prepare" has passed.  Starting with Visual Studio 2005, there is a 64-bit compiler.  If there is a desire to support the Win32 and Win64 platform, then you need to have two project configurations.  In the x64 configuration, using the / Wp64 key is meaningless, which is why it is deprecated in Visual Studio 2008/2010. <br><br>  Everything would be fine, but I think the developers of Visual Studio made a logical error.  If you create a new project in Visual Studio 2008/2010 or convert an old project to a new one, then the / Wp64 switch will not be installed.  It is right.  Even if you specifically register / Wp64 in the Additional Options of the project, you will get the message: <br><br><pre>  Command line warning D9035: 
 option 'Wp64' has been removed. </pre><br>  The humor of the situation is that such warnings as <a href="http://www.viva64.com/go.php%3Furl%3D408">C4311</a> , <a href="http://www.viva64.com/go.php%3Furl%3D411">C4312</a> , <a href="http://www.viva64.com/go.php%3Furl%3D410">C4313</a> for some reason are still associated with the / Wp64 key.  And if it is not, then there are no these warnings, although their level of danger is <b>Level 1</b> . <br><br>  These warnings will return if you enable / Wp64 and receive D9035 warnings about an obsolete option.  Another option is to enable / Wall.  Messages will be issued, but this is the way, as you understand, only for the brave.  Apparently the most reasonable option is to use <a href="http://www.viva64.com/go.php%3Furl%3D409">#pragma warning</a> in stdafx.h. <br><br>  We now turn to Intel C ++.  Starting the study of the question, I expected that in my behavior relative to / Wp64 it is equivalent to Visual C ++.  It turned out that he had everything in his own way.  An error of casting the form ‚Äúint y = (int) ptr;‚Äù he found without the / Wp64 key, issuing warning # 810.  But warning # 967 (equivalent to C4312) already requires / Wp64.  It turns out that the Intel C ++ compiler also has a set of warnings associated with / Wp64, but this set itself is different.  Since it has historically developed that the documentation on the exotic features of Intel C ++ is tight, I did not find out what exactly / Wp64 includes. <br><br>  After all this stream of thoughts, the reader may ask: <br><br><table><tbody><tr><td>  <b>And in what all the same zakovyrka that?</b>  <b>Please briefly again.</b> <br><br>  Answer.  If you have a project for Visual Studio 2008/2010 and create a 64-bit configuration, then you will not see warnings for such trivial errors as: <br><br><pre>  void * ptr = x;
 int y = (int) ptr;  // S4311

 int i = x;
 return (void *) i;  // C4312

 int * pI = 0;
 printf ("% d", pI);  // C4313 </pre><br>  And apparently some others.  By compiling the same project using Intel C ++, you will not see another set of errors. <br><br>  To get all these salutary warnings you must explicitly enable them yourself!  It is not difficult to do, provided that you know about it.  I haven't known for a long time, although I am interested in the subject of developing 64-bit applications. <br></td></tr></tbody></table><br>  I emphasize that a victory over these warnings does not at all mean the correctness of a 64-bit program.  This only means that the most obvious defects have been corrected.  So to say "who did not hide, I am not guilty."  But to detect ‚Äúthose who hid‚Äù in a large project, it makes sense to use specialized tools ( <a href="http://www.viva64.com/ru/viva64-tool/">Viva64</a> ). <br><br>  Of course, I was not the first to notice this flaw regarding 64-bit warnings.  Most recently <a href="http://www.viva64.com/go.php%3Furl%3D413">, a</a> comment was posted <a href="http://www.viva64.com/go.php%3Furl%3D413">here</a> on this topic.  Please note that the criticism is quite fresh. <br><br>  From all this, I can conclude that people are just beginning to be interested in creating Win64 applications.  I wrote this phrase a year ago, and now I‚Äôve repeated it again.  It is very strange.  I do not believe that it is possible to develop normal programs, without being interested even in where the pointer is pushed into int.  The absence of mass discussions on the Internet of such issues confuses me greatly.  I do not understand how the world works. </div><p>Source: <a href="https://habr.com/ru/post/106411/">https://habr.com/ru/post/106411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106402/index.html">Free Android - Goldmine for Google</a></li>
<li><a href="../106405/index.html">Ethernet lamp for continuous integration and not only</a></li>
<li><a href="../106406/index.html">Well, a very simple idea that increases the effectiveness of testing at times</a></li>
<li><a href="../106407/index.html">The first official results of the tests W3C CSS 2.1 Test Suite</a></li>
<li><a href="../106408/index.html">Apple (AAPL): Fourth Quarter 2010 (July-September)</a></li>
<li><a href="../106412/index.html">Japanese carrier KDDI announced a partnership with Skype</a></li>
<li><a href="../106413/index.html">Hyundai IT introduced a 70-inch convertible table with a touchscreen display.</a></li>
<li><a href="../106414/index.html">Good user interface, clarity and relevance of information</a></li>
<li><a href="../106415/index.html">Create banners online</a></li>
<li><a href="../106420/index.html">How I did a USB device</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>