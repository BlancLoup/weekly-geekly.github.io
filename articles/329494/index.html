<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About generics in PHP and why we need them</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will look at some common problems associated with arrays in PHP. All problems can be solved with the help of RFC, which adds generi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About generics in PHP and why we need them</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/b76/ba0/efd/b76ba0efd41746628a098a65f996fbe2.jpg"></p><br><p>  In this article we will look at some common problems associated with arrays in PHP.  All problems can be solved with the help of RFC, which adds generics to PHP.  We will not go deep into what generics are, but by the end of the article you should understand why they are useful and why many people are waiting for their appearance in PHP. </p><a name="habracut"></a><br><p>  Suppose you have a set of blog posts downloaded from some data source. </p><br><pre><code class="php hljs">$posts = $blogModel-&gt;find();</code> </pre> <br><p>  You need to cycle through all the posts and do something with their data.  For example, with <code>id</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post) { $id = $post-&gt;getId(); <span class="hljs-comment"><span class="hljs-comment">// -  }</span></span></code> </pre> <br><p>  This is a common scenario, on the basis of which we will discuss the role of generics and why the community needs them so much.  Consider the problems that arise in this scenario. </p><br><h2 id="celostnost-struktury-dannyh-data-integrity">  Data Integrity </h2><br><p>  In PHP, an array is a collection of <code>...</code> elements. </p><br><pre> <code class="php hljs">$posts = [ <span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAR, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Post(<span class="hljs-string"><span class="hljs-string">'Lorem'</span></span>), ];</code> </pre> <br><p>  If we cycle through our set of posts, as a result, we get a critical error. </p><br><pre> <code class="php hljs">PHP Fatal error: Uncaught Error: Call to a member <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span></code> </pre> <br><p>  Call <code>-&gt;getId()</code> with reference to the string <code>'foo'</code> .  Not a ride.  When cycling through an array, we want to be sure that all values ‚Äã‚Äãbelong to a particular type.  You can do this: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$post <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Post) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $id = $post-&gt;getId(); <span class="hljs-comment"><span class="hljs-comment">// -  }</span></span></code> </pre> <br><p>  This will work, but if you have already written the PHP code for production, then you know that such checks sometimes grow quickly and pollute the code base.  In our example, you can check the type of each entry in the method <code>-&gt;find()</code> in <code>$blogModel</code> .  But this only transfers the problem from one place to another.  Although the situation has improved slightly. </p><br><p>  There is another difficulty with the integrity of the data structure.  Suppose you have a method that needs an array of blog posts: </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handlePosts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $posts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post) { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br><p>  Again we can add additional checks to the loop, but this does not guarantee that <code>$posts</code> contains only the Posts collection of Posts. </p><br><p>  <a href="http://php.net/manual/en/functions.arguments.php">Starting in PHP 7.0,</a> you can use the <code>...</code> operator to solve this problem: </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handlePosts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Post ...$posts)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post) { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre> <br><p>  But this approach has a reverse side: you have to call the function as applied to the unpacked array. </p><br><pre> <code class="php hljs">handlePosts(...$posts);</code> </pre> <br><h2 id="proizvoditelnost">  Performance </h2><br><p>  It can be assumed that it is better to know in advance whether the array contains only elements of a certain type than to manually check the types in each cycle each time. </p><br><p>  We can not drive away on the generics of the benchmark, because they are not there yet, so we can only guess how they will affect the performance.  But it is not insane to assume that the optimized behavior of PHP written in C is the best way to solve the problem compared to creating a heap of code for the user space. </p><br><h2 id="avtozavershenie-code-completion">  Auto completion (Code completion) </h2><br><p>  I do not know about you, but when writing PHP code, I resort to the IDE.  Autocompletion greatly increases productivity, so I would like to use it here too.  When looping through posts, we need the IDE to treat each <code>$post</code> a <code>Post</code> instance.  Let's look at a simple PHP implementation: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># BlogModel public function find() : array { //  ... }</span></span></code> </pre> <br><p>  Starting with PHP 7.0, return types appeared, and in PHP 7.1 they were improved using void and null-type types.  But we can not tell the IDE that is contained in the array.  Therefore, we return to PHPDoc. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Post[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ... }</span></span></code> </pre> <br><p>  When using the generic implementation, for example, the model class (model class), the prompting method <code>-&gt;find()</code> not always possible.  So in our code, we‚Äôll have to limit the $ posts variable. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Blog[] $posts */</span></span> $posts = $blogModel-&gt;find();</code> </pre> <br><p>  The lack of confidence in the contents of the array and the effect of code scatter on performance and maintainability, as well as the inconvenience of writing additional checks, forced me to look for a better solution for a long time. </p><br><h2 id="--">  * * * </h2><br><p>  In my opinion, this solution is <a href="https://wiki.php.net/rfc/generics">generics</a> .  I will not describe in detail what they are doing, you can read about it in the RFC.  But I will give an example of how generics can help in solving the problems described above, always ensuring that the collection contains correct data. </p><br><p>  <strong>Important note</strong> : generics are not yet in PHP.  The RFC is for PHP 7.1, there is no further information about its future.  The code below is based on the <a href="http://php.net/manual/en/class.iterator.php">Iterator</a> and <a href="http://php.net/manual/en/class.arrayaccess.php">ArrayAccess</a> interfaces that exist with PHP 5.0.  In the end, we will examine the generic example, which is a dummy code. </p><br><p>  First, create a <code>Collection</code> class that works in PHP 5.0+.  This class implements <code>Iterator</code> so that it can cycle through its elements, as well as <code>ArrayAccess</code> , so that you can use an ‚Äúarray-like‚Äù syntax to add and access elements of the collection. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Collection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAccess</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $position; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $array = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ++<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">valid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rewind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset]) ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset] : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null($offset)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[] = $value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset] = $value; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetUnset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset]); } }</code> </pre> <br><p>  Now we can use this class: </p><br><pre> <code class="php hljs">$collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Collection(); $collection[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Post(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($collection <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"{$item-&gt;getId()}\n"</span></span>; }</code> </pre> <br><p>  Note: there is no guarantee that <code>$collection</code> contains only <code>Posts</code> .  If we add, for example, a string value, it will work, but our cycle will break. </p><br><pre> <code class="php hljs">$collection[] = <span class="hljs-string"><span class="hljs-string">'abc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($collection <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-comment"><span class="hljs-comment">// This fails echo "{$item-&gt;getId()}\n"; }</span></span></code> </pre> <br><p>  At the current level of PHP development, we can solve this problem by creating a <code>PostCollection</code> class.  Note: return types that allow null are available only with PHP 7.1. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostCollection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Collection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::current(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> : ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::offsetGet($offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$value <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Post) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">"value must be instance of Post."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::offsetSet($offset, $value); } }</code> </pre> <br><p>  Now only <code>Posts</code> can be added to our collection. </p><br><pre> <code class="php hljs">$collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostCollection(); $collection[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Post(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// This would throw the InvalidArgumentException. $collection[] = 'abc'; foreach ($collection as $item) { echo "{$item-&gt;getId()}\n"; }</span></span></code> </pre> <br><p>  Works!  Even without generics!  There is only one problem: the solution is not scalable.  You need separate implementations for each type of collection, even if the classes differ only in type. </p><br><p>  It is likely that subclasses can be created with greater convenience by ‚Äúabusing‚Äù <a href="http://php.net/manual/en/language.oop5.late-static-bindings.php">late static binding</a> and the reflective PHP API.  But in any case, you will need to create classes for each available type. </p><br><h2 id="velikolepnye-dzheneriki">  Gorgeous generics </h2><br><p>  Considering all this, let's consider the code that we could write if the generics were implemented in PHP.  This can be a <strong>single class</strong> used for all types.  For the sake of convenience, I will cite only changes from the previous <code>Collection</code> class, keep this in mind. </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenericCollection</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAccess</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;position]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset)</span></span></span><span class="hljs-function"> : ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset]) ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset] : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($offset, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$value <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> T) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">"value must be instance of {T}."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null($offset)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[] = $value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;array[$offset] = $value; } } <span class="hljs-comment"><span class="hljs-comment">// public function __construct() ... // public function next() ... // public function key() ... // public function valid() ... // public function rewind() ... // public function offsetExists($offset) ... } $collection = new GenericCollection&lt;Post&gt;(); $collection[] = new Post(1); // This would throw the InvalidArgumentException. $collection[] = 'abc'; foreach ($collection as $item) { echo "{$item-&gt;getId()}\n"; }</span></span></code> </pre> <br><p>  And that's it!  We use <code>&lt;T&gt;</code> as a dynamic type that can be checked before runtime.  And again, the <code>GenericCollection</code> class could be taken for any type. </p><br><p>  If you are as impressed with generics as I am (and this is just the tip of the iceberg), conduct community education and share the RFC: <a href="https://wiki.php.net/rfc/generics">https://wiki.php.net/rfc/generics</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329494/">https://habr.com/ru/post/329494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329480/index.html">The online store's productivity is sketchy or where to start improving it</a></li>
<li><a href="../329482/index.html">A selection of free veeam tools</a></li>
<li><a href="../329484/index.html">Autopilot on your own: sensor fusion from the phone and open training data</a></li>
<li><a href="../329488/index.html">Visual editor of letters on React + Redux. Overview, example of use and expansion</a></li>
<li><a href="../329492/index.html">Industrial mitap # 3: safe process automation is in focus</a></li>
<li><a href="../329498/index.html">Autoboxing and unboxing in Java</a></li>
<li><a href="../329500/index.html">How we won the hackathon in New York</a></li>
<li><a href="../329506/index.html">What to do if PK Identity runs out of values?</a></li>
<li><a href="../329510/index.html">How to achieve the reuse of React components (Translation)</a></li>
<li><a href="../329512/index.html">Results WannaCry: a selection of basic materials on the "Habrahabr" and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>