<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel developers govodayat too</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, talking about checking the next project, I kept repeating that this is a very high-quality code and almost no errors were found in it. An ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel developers govodayat too</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/e4f/f39/3c6/e4ff393c6c9c55b00d99c50f7c6784b9.png" alt="PVS-Studio vs IEC SDK"><br>  Recently, talking about checking the next project, I kept repeating that this is a very high-quality code and almost no errors were found in it.  An example is the analysis of such projects as <a href="http://www.viva64.com/ru/b/0105/">Apache</a> , <a href="http://www.viva64.com/go.php%3Furl%3D707">MySQL</a> , <a href="http://www.viva64.com/ru/a/0074/">Chromium</a> .  Why we choose such applications, I think it is clear.  Everyone knows about them and nobody cares what horrors can be found in the student work of Vasya.  However, sometimes we trust those projects that just happened to be on hand.  Some such projects leave heavy impressions in my thin and vulnerable soul.  This time we checked the Intel¬Æ Energy Checker SDK (IEC SDK). <br><a name="habracut"></a><br>  <a href="http://www.viva64.com/go.php%3Furl%3D709">The Intel Energy Checker SDK</a> is a small C project containing just 74500 lines of code.  For comparison, the size of the WinMerge project is 186,000 lines of code, and the size of the Miranda IM project with plug-ins is about 950,000 lines of code. <br><img src="https://habrastorage.org/getpro/habr/post_images/51b/d7a/077/51bd7a0776cbccb87666ae1829d7786f.jpg" alt="Intel Energy Checker SDK"><br>  By the way, while we are at the beginning of the article, try to guess how many ' <b>goto</b> ' operators can be in this project.  Guess the number?  If yes, then continue. <br><br>  In general, it is one of the small, unknown to the general public, projects.  You will look at the code of such a project, and the following analogy arises.  You can walk for a long time on famous good streets and hardly see puddles.  But it is necessary to turn off the street and look into the courtyard, as a puddle is not only immediately located, it is not clear how you can walk without wetting your feet. <br><br>  IEC SDK can be quite attributed to the projects, considering the text of which, the word ‚Äú <a href="http://www.viva64.com/go.php%3Furl%3D710">govnokod</a> ‚Äù pops up in my head.  I will not say that the code is terrible, it is much worse.  But see for yourself.  In the whole project there are 247 functions.  Say a little?  Of course, not enough.  But the size of some of them is shocking.  Four functions generally have a size of more than 2000 lines: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://www.viva64.com/ru/d/0144/">V553</a> The length of 'pl_open' function's body is more than 2000 lines long.  You should consider refactoring the code.  pl_csv_logger productivity_link.c 379 <br><br>  V553 The length of 'pl_attach' function's body is more than 2000 lines long.  You should consider refactoring the code.  pl_csv_logger productivity_link.c 9434 <br><br>  V553 The length of the main function is more than 2000 lines long.  You should consider refactoring the code.  cluster_energy_efficiency cee.c 97 <br><br>  V553 The length of the main function is more than 2000 lines long.  You should consider refactoring the code.  pl2ganglia pl2ganglia.c 105 <br><br>  Indicative and here is a way to get the length of the directory name: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_FOLDER_STRING </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C:\\productivity_link"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_PATH_SEPARATOR_STRING </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\\"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_APPLICATION_NAME_SEPARATOR_STRING </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"_"</span></span></span><span class="hljs-meta"> ... pl_root_name_length = strlen(PL_FOLDER_STRING); pl_root_name_length += strlen(PL_PATH_SEPARATOR_STRING); pl_root_name_length += application_name_length; pl_root_name_length += strlen(PL_APPLICATION_NAME_SEPARATOR_STRING); pl_root_name_length += PL_UUID_MAX_CHARS; pl_root_name_length += strlen(PL_PATH_SEPARATOR_STRING);</span></span></code> </pre> <br>  I understand that this place is not critical for speed and it makes no sense to optimize the calculation of the length of the lines.  But just for the love of art, one could have such a macro "# define STRLEN (s) (sizeof (s) / sizeof (* s) - 1)" for this purpose).  Even more my sense of beauty suffers from the fact that I see a line containing "C: \\".  I am concerned about these macros: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_INI_WINDOWS_FOLDER </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C:\\productivity_link"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_INI_WINDOWS_LC_FOLDER </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"c:\\productivity_link"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PLH_FOLDER_SEARCH _T(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C:\\productivity_link\\*"</span></span></span><span class="hljs-meta">)</span></span></code> </pre> <br><br>  However, this code does what is needed and we will not focus on the programming style.  The number of errors that PVS-Studio found in a project of such a small size is much more scary.  It should be borne in mind that not 74,000 lines of code have been verified.  About a third of the code is intended for LINUX / SOLARIS / MACOSX and is located in #ifdef # endif code branches that were not checked.  The impassable forest from # ifdef / # endif is a separate topic, but I promised not to talk about code design anymore.  Those interested can take a look at the <a href="http://www.viva64.com/go.php%3Furl%3D708">source codes</a> themselves. <br><br>  The IEC SDK compiles a heterogeneous bunch of errors that can be made by operating with low-level arrays.  However, errors of this kind are very typical of the C language. <br><br>  There is a code that accesses memory outside the array: <br><br>  <a href="http://www.viva64.com/ru/d/0148/">V557</a> Array overrun is possible.  The '255' index is pointing beyond array bound.  pl2ganglia pl2ganglia.c 1114 <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_MAX_PATH 255 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL2GANFLIA_COUNTER_MAX_LENGTH PL_MAX_PATH char name[PL_MAX_PATH]; int main(int argc, char *argv[]) { ... p-&gt;pl_counters_data[i].name[ PL2GANFLIA_COUNTER_MAX_LENGTH ] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\0'</span></span></span><span class="hljs-meta">; ... }</span></span></code> </pre> <br>  We are dealing with a classic defect of writing a terminal zero outside the array.  It should be: <br><pre> <code class="cpp hljs">p-&gt;pl_counters_data[i].name[ PL2GANFLIA_COUNTER_MAX_LENGTH - <span class="hljs-number"><span class="hljs-number">1</span></span> ] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>;</code> </pre> <br>  There are errors of zeroing structures. <br><br>  <a href="http://www.viva64.com/ru/d/0163/">V568</a> It's odd that the operator of the sizeof () operator is the '&amp; file_data' expression.  pl_csv_logger productivity_link_helper.c 1667 <br><br>  V568 It's odd that the operator of the sizeof () operator is the '&amp; file_data' expression.  pl_csv_logger productivity_link_helper.c 1831 <br><br>  <a href="http://www.viva64.com/ru/d/0101/">V512</a> A call of the memset function will lead to underflow of the buffer pconfig.  pl_csv_logger productivity_link_helper.c 1806 <br><br>  An example of such incorrect zeroing: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plh_read_pl_folder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PPLH_PL_FOLDER_INFO pconfig)</span></span></span><span class="hljs-function"> </span></span>{ ... WIN32_FIND_DATA file_data; ... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>( &amp;file_data, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(&amp;file_data) ); ... }</code> </pre> <br>  The job of finding files will go badly if you use the WIN32_FIND_DATA structure with garbage inside.  However, there is a suspicion that the Windows version of this piece of programmer's art is of little interest to anyone.  For example, the code is compiled in the ‚ÄúUse Unicode Character Set‚Äù mode, although it is not designed for this until the end.  Apparently, no one thought.  We created a project for Visual Studio, and the default setting "Character Set" just sets the use of UNICODE. <br><br>  As a result, we have c dozens of places where lines are only partially cleared.  I will give only one piece of similar code: <br><br>  <a href="http://www.viva64.com/ru/d/0101/">V512</a> A call of the memset function will lead to underflow of the buffer (pl_cvt_buffer) '.  pl_csv_logger productivity_link_helper.c 683 <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PL_MAX_PATH 255 typedef WCHAR TCHAR, *PTCHAR; TCHAR pl_cvt_buffer[PL_MAX_PATH] = { </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\0'</span></span></span><span class="hljs-meta"> }; int plh_read_pl_config_ini_file(...) { ... ZeroMemory( pl_cvt_buffer, PL_MAX_PATH ); ... }</span></span></code> </pre> <br>  However, there are places where disabling UNICODE does not help.  Here, instead of the text, something incomprehensible will be printed: <br><br>  <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider the second argument of the wprintf function.  Wchar_t type symbols is expected.  producer producer.c 166 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; ... <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __PL_WINDOWS__ wprintf( _T(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Using power link directory: %s\n"</span></span></span><span class="hljs-meta">), p ); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// __PL_WINDOWS__ ... }</span></span></span></span></code> </pre> <br>  I will explain.  The wprintf function expects a string of type ‚Äúwchar_t *‚Äù, and it will be passed to it strings of type ‚Äúchar *‚Äù. <br><br>  There are other bugs, and small bloopers like this: <br><br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (ret == PL_FAILURE)' condition was already verified in line 1008. pl_csv_logger pl_csv_logger.c 1009 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ret == PL_FAILURE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ret == PL_FAILURE) { pl_csv_logger_error( PL_CSV_LOGGER_ERROR_UNABLE_TO_READ_PL );</code> </pre> <br>  I do not see any point in trying to enumerate all the noticed flaws.  If someone wants, I can provide a key for checking the project and analyzing the messages.  I will also send an error description to the SDK authors. <br><br><h2>  And now dessert </h2><br>  Remember, at the beginning, I asked to guess how many 'goto' operators can be found in the project.  So, I think your number is far from the truth.  In total, the project uses <b>1198</b> goto operators.  One goto statement with 60 lines of code.  And I thought that this style has already sunk into oblivion. <br><br><h2>  Conclusion </h2><br>  And what exactly did the author want to say with this article?  Intel URGENTLY needs to look closely at PVS-Studio.  :-) </div><p>Source: <a href="https://habr.com/ru/post/125120/">https://habr.com/ru/post/125120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125112/index.html">Do you have a rutted smartphone?</a></li>
<li><a href="../125114/index.html">New way to transfer funds to QIWI Wallet: by email</a></li>
<li><a href="../125115/index.html">30 years old MS-DOS</a></li>
<li><a href="../125116/index.html">Loginza - authorization through Vkontakte, Facebook, etc. OpenID servers</a></li>
<li><a href="../125118/index.html">First introduction to the Google Maps Javascript API</a></li>
<li><a href="../125122/index.html">How often on sites do you use the icons of ‚Äúhouse‚Äù, ‚Äúmagnifying glass‚Äù and ‚Äúenvelope‚Äù?</a></li>
<li><a href="../125123/index.html">Do you use the "sealed" modifier?</a></li>
<li><a href="../125126/index.html">WM> Bank = Technical Overdraft</a></li>
<li><a href="../125129/index.html">The final version of symfony2 has been released. Hooray!</a></li>
<li><a href="../125131/index.html">Dropbox rented a huge office for 400 employees</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>