<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Banking Trojan Carberp acquires bootkit functionality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we are publishing a part of our investigation into the Carberp malware, which is aimed at remote banking services (RB). 

 This month we managed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Banking Trojan Carberp acquires bootkit functionality</h1><div class="post__text post__text-html js-mediator-article">  Today we are publishing a part of our investigation into the Carberp malware, which is aimed at remote banking services (RB). <br><br>  This month we managed to collect interesting information about the new modification of the Trojan from the Win32 / TrojanDownloader.Carberp family.  This is one of the most common malicious programs in Russia, which is engaged in the theft of funds in remote banking systems and is aimed primarily at the attacks of companies that carry out a large number of cash transactions every day.  We already talked about this Trojan in our presentation <a href="http://go.eset.com/us/resources/white-papers/CARO_2011.pdf">‚ÄúCybercrime in Russia: Trends and issues‚Äù</a> .  The developers of this malware are one of the most active cybercrime groups in Russia and nearby countries, which is involved in stealing money from RBS.  The first incidents with the Carberp Trojan were recorded by us at the beginning of 2010, and the peak of its activity this year falls at the end of spring and summer, and the number of incidents related to this program has increased again since the beginning of autumn. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7e/7ce/12c/c7e7ce12cf6d7b86829978b82222471f.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The absolute leader in the number of recorded incidents is Russia, which is confirmed by our statistics by region: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/224/205/38c/22420538c06a83f7b3210dcd2c9bcf64.png" alt="image"><br><br>  The cash profits of a cybercrime group are estimated at millions of dollars a week, and, as our monitoring shows, attackers do not stint investing money in the development of their malicious technologies.  In particular, it shows the evolution of the Hodprot <a href="http://go.eset.com/us/resources/white-papers/Hodprot-Report.pdf">dropper</a> , which was seen in the installations of Carberp, RDPdoor and <a href="http://blog.eset.com/2011/01/14/sheldor-shocked">Sheldor</a> .  Moreover, in order to open the backdoor in the system and manually carry out monetary transactions manually, Carberp can also set up RDPdoor.  At the moment, we have established that these malicious programs are the result of the activity of one cybercriminal group. <br><br>  At the beginning of this year, information on the sale of the bootkit builder, not detectable by anti-virus tools, began to appear on various closed cybercriminal forums.  The cost of this builder was estimated at several tens of thousands of dollars and seemed fantastic in comparison, for example, with prices for the same SpyEye and Zeus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a12/75e/837/a1275e83707272d6a6df514a1f5e51d1.png" alt="image"><br><br>  How many total cybercriminal groups managed to acquire this toolkit - we do not know.  But we had a sample of the installer of the bootkit part compiled, which loaded the driver stub.  We were able to detect the identity of this code with some other malware.  At the moment, its use is known only in the Rovnix <a href="http://blog.eset.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr">bootkit</a> , which was the first to massively apply this functionality.  And from the end of the summer, testing began (distribution in very limited quantities) of the special version of Carberp with bootkit-part.  The fact that the bot is working in test mode was indicated by two factors: a large number of debugging messages about the installation process and a very low prevalence.  We managed to get access to the logs on the command center of bots with the bootkit-part and confirm the fact of the active testing process: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/112/61c/fd0/11261cfd0d506fccc6c8efc37df2dbfb.jpg" alt="image"><br><br>  <i>C &amp; C for the test version of the bot</i> <br><br>  A large number of debug messages were found in the installer of the new version of Carberp: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6af/e93/f1c/6afe93f1cf8e6760527af64629725774.png" alt="image"><br><br>  <i>Lines inside unpacked Carberp code</i> <br><br>  The bootkit part itself was left without significant modifications and is almost completely identical with what we have already seen in Rovnix.  Technical details on the work of the bootkit can be seen on the slides of our report <a href="http://go.eset.com/us/resources/white-papers/Ekoparty2011_preso.pdf">‚ÄúDefeating x64: Modern Trends of Kernel-Mode Rootkits‚Äù</a> , which we presented at the Ekoparty conference this fall. <br><br>  But the installer has undergone significant modifications.  In addition to installing Carberp‚Äôs bootkit functionality into the system, a number of vulnerabilities are being exploited to enhance privileges.  First of all, this is due to the fact that installing a bootkit requires administrator or system privileges.  During an attack on corporate users (namely, this is the goal of attackers) who have access to RBS, they may simply not have rights to run the executable file with high privileges, and then an attack using social engineering methods will not help.  Therefore, the installer is now operating four different vulnerabilities to increase local privileges in the system: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e51/4de/8ae/e514de8ae875d4340cd42f63234ffa6c.png" alt="image"><br><br>  ‚Ä¢ MS10-073 (win32k.sys KeyboardLayout vuln) <br>  ‚Ä¢ MS10-092 (Task Scheduler vuln) <br>  ‚Ä¢ MS11-011 (win32k.sys SystemDefaultEUDCFont vuln) <br>  ‚Ä¢ <a href="http://osvdb.org/show/osvdb/71013">.NET Runtime Optimization vuln</a> <br><br>  Another interesting point of the dropper is the removal of various hooks and splits from the following system functions before directly launching the bootkit installer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/978/80c/3ff/97880c3ff3317e9870609e3354c0416f.png" alt="image"><br><br>  This is a kind of bypass of various sandboxes and monitoring tools that use hooks in user mode. <br><br>  In the process of working, the bootkit code bypasses the digital signature checks and other defense mechanisms by loading a malicious driver.  The task of this driver is to inject the payload into the address space of user-mode processes. <br><br>  After unpacking the original driver file, you can find the build date and version of the compiler: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d7/baa/c5c/6d7baac5c9cd07ab05afc75a7fea6da8.png" alt="image"><br><br>  From these data, it is clear that the file was compiled at the beginning of this month, and now, apparently, it is running in for stability.  After the compilation, an interesting line remained in the driver, pointing to the source directory on the developers computer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5b/be4/49e/c5bbe449e6f2f597c8ae7f1bc383ceaf.png" alt="image"><br><br>  Apparently, this is not the first and not the latest version for tests, which has appeared recently.  We also do not exclude the possibility that the author, who previously offered it for sale, is further supporting this code.  Since, besides Rovnix and this version of Carberp, malware based on this code is unknown to us, and there has never been a low-level part in any version of Carberp, this suggests that they did not have developers of this qualification. <br>  The main task of this driver is to introduce a dynamic library with a payload into the address space of user processes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e81/08a/0cc/e8108a0cc0c5a057cb7f9aa870d9fed4.png" alt="image"><br><br>  After unpacking a dynamic library with a payload, you can also see the compilation date, from which it becomes clear that it was compiled at different times when compared with the driver. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99f/3c7/246/99f3c72462edfad6d240f836e0ba55d2.png" alt="image"><br><br>  Inside there was an interesting string constant pointing to a completely different directory with the project and interesting root directory called ‚ÄúGSVSoft‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ea/79d/600/5ea79d600482569193cc3b82c31a6384.png" alt="image"><br><br>  Interestingly, compilation dates and paths to project directories are different, which indirectly indicates that two different development teams were working.  In addition, with the name "GSVSoft" there is a very real domain (gsvsoft.ru), but it is impossible to draw any conclusions based only on this. <br><br>  The main functionality of the dynamic library is in many respects similar to the previous version of Carberp.  The main objective of this module is the introduction of JS scripts to pages with Internet banking, the loading of additional plug-ins and interaction with the command center. <br><br>  All of the above suggests that the current methods of concealment in the Carberp Trojan system do not suit its developers, and they are ready to invest in the development of their own technologies to bypass the security software.  So the evolution of this malicious program over the past two years has made it number one in terms of the number of incidents with clients of Russian banks, and not only commercial organizations suffer from it - there are incidents in state institutions.  With the new bootkit, Carberp comes one step further in analysis complexity and detection, with threats like TDL4 and Rovnix. <br><br>  Despite the fact that now the main purpose of Carberp are the clients of Russian banks, this situation can quickly change, as there are no technological obstacles for attacks on banks in other countries in this cybercriminal group.  And access to other regions does not occur, most likely due to the fact that they are satisfied with everything so far and in this form.  But in the near future they may find partners in attacks in other regions.  Last year, Carberp was already active in European countries, but then it began to decline. </div><p>Source: <a href="https://habr.com/ru/post/133173/">https://habr.com/ru/post/133173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133167/index.html">Send your mobile app idea and win a toaster ticket!</a></li>
<li><a href="../133169/index.html">Come meet Richard Stallman</a></li>
<li><a href="../133170/index.html">Ask Richard Stallman a question</a></li>
<li><a href="../133171/index.html">Improvements in Youtube HTML5 player</a></li>
<li><a href="../133172/index.html">About USB Mass Storage Support in Ice Cream Sandwich</a></li>
<li><a href="../133174/index.html">Future plans for Enot tablets</a></li>
<li><a href="../133175/index.html">Startup Battle is waiting for its members!</a></li>
<li><a href="../133176/index.html">WebService with gzip C support</a></li>
<li><a href="../133179/index.html">Startup Weekend Report in Haifa</a></li>
<li><a href="../133183/index.html">Visitor pattern. Advanced use</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>