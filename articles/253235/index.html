<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About installing Crashplan in FreeNAS (and solving the Cyrillic problem)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="annotation 
 I always considered Habr as a storehouse of valuable information in solving many problems. Therefore, faced with a problem and finding an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About installing Crashplan in FreeNAS (and solving the Cyrillic problem)</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>annotation</b> </h4><br>  I always considered Habr as a storehouse of valuable information in solving many problems.  Therefore, faced with a problem and finding an adequate solution, I decided to share <i>my experience</i> .  I did not try to write a manual, but rather a guide to action, but from my point of view and based on my needs.  I hope someone will come in handy. <br><div class="spoiler">  <b class="spoiler_title">What is Crashplan (and why is it needed)</b> <div class="spoiler_text">  <a href="http://habrahabr.ru/sandbox/40774/">Crashplan Backup 2 years of use</a> <br>  <a href="http://it-world.ru/reviews/soft/43611.html">CrashPlan: transcendental backup</a> <br>  <a href="https://ru.intel.com/business/community/%3Fautomodule%3Dblog%26blogid%3D10662%26showentry%3D4060">CrashPlan Backup - if you need to quickly make a backup (a lot of pictures)</a> <br>  <a href="https://ru.wikipedia.org/wiki/CrashPlan">From wikipedia</a> <br></div></div><br><a name="habracut"></a><br><h4>  <b>Prehistory</b> </h4><br>  There are many solutions for self-assembled NAS, but I stopped at FreeNAS for several reasons: <br><ul><li>  Native ZFS support; </li><li>  Good integration with AD, LDAP and other directory services; </li><li>  The system is built on FreeBSD, which means there are jails and ports. </li></ul><br>  So far I have no regrets about my decision, as I use it not only at home, but also at work. <br><br>  I have been using Crashplan for a long time and have a paid subscription.  I use both cross-archiving and archiving to the cloud.  Used before the described events only under Linux and Windows. <br><br>  Therefore, when I deployed FreeNAS (9.3), the second thing I tried to do after installing VirtualBox was to deploy Crashplan.  And here I was waiting for a few surprises.  When I first encountered the problem of installing Crashplan, I remembered about the old Fido's rake joke: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Classification okologabelnyh characters</b> <div class="spoiler_text">  User - a person advancing on a rake. <br>  The kettle is a beginner user, who has never attacked rakes and therefore is confident that the rabbits do not exist. <br>  Lamer is a user, regularly advancing on the rails, but still confident that the rabbits do not exist. <br>  Narrow specialist - user, in complete possession of the attack on the same treads. <br>  A broad specialist is a user with more than two cones on his forehead. <br>  The programmer is the one for whom the result is most important in the attack on the rakes.  Charter tread on other people's treads, manufactures their own. <br>  An advanced programmer is a program that advances on each weight no more than two times. <br>  Copywriting is a concept that limits the amount of available financial capabilities of the user. <br>  The gamer is the one for whom the process is the most important in the attack on the rakes.  Usually not able to make their own treads. <br>  Cheater is a type of gamer;  comes only on the rails with half-nozzles on the handle and usually no more than one time. <br>  Hacker - the one who is able to step on the rails, even if they are hidden in a sarai and locked up. <br>  A hacker-idealist is a benevolent warrior, for every one of them, to attack an unlimited number of rakes. <br>  Microsoft - the corporation, the world leader in the production of rakes <br>  Bill Gates is a mythical creature from programmer folklore;  evil spirit - patron of rabbits. <br>  Upgrade - a process of permanently spending money on the purchase of all new rakes, each of which beats more painfully than the previous ones. <br>  Beta-version - a version in which the rakes are visible to the unaffected eye. <br>  The release is a version in which the pile is covered with leaves. <br>  Versatility is a principle that allows new treads to fall exactly on the bump from previous ones. <br>  Assembler is a programming language that allows you to attack several millions of times per second. <br>  A local network is a technology that allows you to get on your forehead, even when someone else comes on the ramp. <br>  The Internet is a technology that allows you to step on the rails located on the other side of the globe. <br>  A network conference is a technology that allows everyone to step not only on their own, but also on other people's profits. <br>  Russian codings are an optional set of tolls for Internet users. <br>  The interface is a rubber pad on the rake handle. <br>  Flexible (adjustable) interface - pad on the handle with rakes, which can be moved, adjusting to the height of its forehead. <br>  Graphic interface - the rake, allowing to regulate color and intensity of sparks after striking the forehead. <br>  An unreliable system is a rake that hits you even when you do not step on them. <br>  Reliable system - the raids that beat you on the forehead, even when you stand with their backs to them. <br>  Multitasking is a concept that allows you to attack several rakes simultaneously. <br>  Object-oriented programming is the method of making rakes on the basis of a matryoshka. <br>  The manual is a book describing the various ways of attacking a rake.  Never used by lamers and hackers.  The advanced programmers use it after they step on the same treads a second time. <br>  Tech support is a service that gives advice on what to do after stepping on rakes.  Usually her first advice is to step on the rails once more and compare the sensations. <br></div></div><br>  And there were several rakes (as well as bumps from them). <br><br><h4>  <b>The first bump (or everything is so bad with Cyrillic)</b> </h4><br>  Looking at <div class="spoiler">  <b class="spoiler_title">list of plugins</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/17c/9c3/24e/17c9c324e9e54effa366b0cdbce3d5ee.PNG"><br></div></div>  We see that there is a Crashplan plugin available.  So we try to put it. <br><br>  We take <a href="https://github.com/sirkkalap/freenas-crashplan-howto">‚ÄúHow-to: Crashplan &amp; Freenas‚Äù</a> as a basis, shamanim and dance with a tambourine - <a href="http://forums.freenas.org/index.php%3Fthreads/crashplan-3-6-3.18416/">Update Crashplan</a> , that is, do not forget about the need for the /usr/pbi/crashplan-amd64/share/crashplan/bin/run.conf file both lines <div class="spoiler">  <b class="spoiler_title">such a parameter</b> <div class="spoiler_text">  <b>-Djava.nio.channels.spi.SelectorProvider = sun.nio.ch.PollSelectorProvider</b> <br>  the file will look something like this <br>  <i>SRV_JAVA_OPTS = " <b>-Djava.nio.channels.spi.SelectorProvider = h.xio.ch.PollSelectorProvider</b> -Dfile.encoding = UTF-8 -Dapp = CrashPlanService -DappBaseName = CrashPlan -Xms20m-hr-hr-hr-off, 5 hr-rshPlanService Dsun.net.inetaddr.ttl = 300 -Dnetworkaddress.cache.ttl = 300 -Dsun.net.inetaddr.negative.ttl = 0 -Dnetworkaddress.cache.negative.ttl = 0 -Dc42.native.md5.enabled = false "</i> <i><br></i>  <i>GUI_JAVA_OPTS = " <b>-Djava.nio.channels.spi.SelectorProvider = sun.h.pl.P.</b> Dsun.net.inetaddr.ttl = 300 -Dnetworkaddress.cache.ttl = 300 -Dsun.net.inetaddr.negative.ttl = 0 -Dnetworkaddress.cache.negative.ttl = 0 -Dc42.native.md5.enabled = false "</i> </div></div><br>  Connect and see that Cyrillic is incorrectly displayed: <br><div class="spoiler">  <b class="spoiler_title">we see kryakozyabry</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f8d/031/9a6/f8d0319a66504458b54363156cfa6e08.PNG"><br></div></div><br>  Here is our "bump". <br><br><h4>  <b>Finding a solution</b> </h4><br>  Finding a solution to the forehead (with the help of Google) led to the fact that I am not alone in my problem: <a href="http://forum.lissyara.su/viewtopic.php%3Ft%3D39291">"FreeBSD + CrashPlan + / compat / linux = krakozyabry</a> . <a href="http://forum.lissyara.su/viewtopic.php%3Ft%3D39291">"</a> <br>  There were several possible solutions: <br><ol><li>  Try to set the correct Cyrillic display in the plugin. <div class="spoiler">  <b class="spoiler_title">Discarded</b> <div class="spoiler_text">  Plugines are made as pbi-files, which, when deployed, do not use standard jail directories, but build additional ones.  Attempting to sort things out did not lead to anything, I was drowned in the complexities of the structure and decided not to continue. </div></div></li><li>  Install linux-jail from templates. <div class="spoiler">  <b class="spoiler_title">Discarded</b> <div class="spoiler_text">  In version 9.3, templates from 9.2 did not work normally (I tried Debian and CentOS) - the network in jails did not want to work at all, which is a pity. </div></div></li><li>  Run in VirtualBox Linux (for example, Debian). <div class="spoiler">  <b class="spoiler_title">Postponed</b> <div class="spoiler_text">  In VirtualBox of FreeNAS, you can run only a 32-bit kernel.  This is not a hindrance, but somehow mounting directories to a virtual machine is necessary.  There are several options: nfs (problem with nested datasets), smb / cifs (most working solution, but smb-balls require, but this is not always possible), VirtualBox share-resources (for some reason, they do not always work).  Postponed this decision in case of emergency. </div></div></li><li>  Install a clean jail and run Crashplan in it through a BSD-Linux emulator. </li></ol><br>  <i>Honestly, I tried all the options (and in that order as indicated).</i>  <i>Defeated clause 4, about which I will tell.</i> <br><br><h4>  <b>So is there a light at the end of the tunnel?</b>  <b>(new rake)</b> </h4><br>  The search for a solution led me to the article <a href="https://forums.freenas.org/index.php%3Fthreads/how-to-crashplan-in-freenas-9-1-jail-tested-on-32bit.14099/">[How-To] CrashPlan in FreeNAS 9.1 Jail (tested on 32bit)</a> , which was taken as a basis. <br>  And so they went (or flew, as you like). <br><br><h5>  <b><i>Preparatory work</i></b> </h5><br>  All the moments of FreeNAS initial setup, after the first launch, I will omit, a lot has been written about this. <br><ol><li>  Connect to FreeNAS via ssh. </li><li>  Check if the kernel module for Linux is loaded: <br><pre><code class="bash hljs">kldstat | grep linux</code> </pre> <br>  If we see something like this: <br><pre> <code class="bash hljs">22 2 0xffffffff81d09000 46855 linux.ko</code> </pre><br>  then we have already downloaded it, if not, then: <br><pre> <code class="bash hljs">kldload linux</code> </pre></li><li>  Enable linux-compat in the system <br><div class="spoiler">  <b class="spoiler_title">in the web interface</b> <div class="spoiler_text">  Enabling linux-compat causes the linux.ko kernel module to automatically load, so the linux_load parameter can be omitted. <br><img src="https://habrastorage.org/files/9a5/5f3/4d2/9a55f34d2ed94324a9dd4742829a97d4.PNG"><br></div></div></li><li>  Create a jail. <br><div class="spoiler">  <b class="spoiler_title">creature</b> <div class="spoiler_text">  The default settings, you can not change.  Parameter ¬´VIMAGE¬ª leave enabled. <br><img src="https://habrastorage.org/files/174/404/84d/17440484ddd1420bb9cce91e798c6c61.PNG"><br><img src="https://habrastorage.org/files/fe1/ffe/f70/fe1ffef704784663a482dfc2ee126969.PNG"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">And wait for the end of the installation</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/124/d81/78e/124d8178eaff472e8b7a349e2c2c5e90.PNG"><br><img src="https://habrastorage.org/files/490/9c2/128/4909c21288c84872bc912ac0e5bf5b83.PNG"><br></div></div><br>  The process takes 10-45 minutes. <br></li></ol><br><br><h5>  <b><i>Installing Crashplan and everything you need in jail</i></b> </h5><br>  Actions are performed in FreeNAS ssh (unless otherwise noted). <br><ol><li>  Determine ID of our jail <pre> <code class="bash hljs">jls</code> </pre><br><div class="spoiler">  <b class="spoiler_title">We get this answer</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/197/1fa/d0b/1971fad0b5554972b991826ccb2c4ea8.PNG"><br></div></div><br>  From where it is clear that ID jail'a = 2. <br></li><li>  Connect to jail. <br><pre> <code class="bash hljs">jexec 2 /bin/tcsh</code> </pre><br></li><li>  Update packages and ports in jail <br><pre> <code class="bash hljs">pkg update pkg upgrade portsnap fetch extract</code> </pre><br>  We are waiting for completion. <br></li><li>  Install the nano editor (vi lovers skip this item) <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/editors/nano make install clean</code> </pre><br></li><li>  Install the fedora-linux emulator <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/emulators/linux_base-f10/ make install clean</code> </pre><br></li><li>  Install the procfs emulator <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/sysutils/linux-f10-procps/ make install clean</code> </pre><br></li><li>  Install JRE for linux <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/java/linux-sun-jre17 make install clean</code> </pre><br>  and get <div class="spoiler">  <b class="spoiler_title">an error</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5bf/399/5ce/5bf3995ce0d2476b862a361a372d5154.PNG"><br></div></div><br>  This is due to the fact that Orakl has forbidden to download this file directly.  Therefore, go to this <a href="http://www.oracle.com/technetwork/java/javase/downloads/jre7-downloads-1880261.html">link</a> and download the file <b>jre-7u75-linux-i586.tar.gz</b> (do not forget to agree with their license).  The downloaded file must be placed in the <b><i>/ usr / ports / distfiles directory</i></b> ( <b><i>jail</i></b> path) or in FreeNAS in the <b><i>/ &lt;jail path&gt; / &lt;jail name&gt; / usr / ports / distfiles directory</i></b> (for example, I have <b><i>/ mnt / poolz / jail / crashplan / usr / ports / distfiles</i></b> ) <br>  And repeat <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/ports/java/linux-sun-jre17 make install clean</code> </pre><br>  And wait for the end of the installation. <br></li><li>  Mounting procfs for linux in FreeNAS <br>  We leave from jail'a <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>  We fall into the FreeNAS command line.  Remount the root filesystem in write mode: <br><pre> <code class="bash hljs">mount -uw /</code> </pre><br>  Create a procfs mount script: <br><pre> <code class="bash hljs">nano /conf/base/etc/rc.d/mountproc</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Script text (subject to change)</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # PROVIDE mountproc # REQUIRE LOGIN # BEFORE: ix-jail . /etc/rc.subr name=mountproc rcvar=mountproc_enable start_cmd="${name}_start" stop_cmd="${name}_stop" mountproc_start () { /sbin/mount -t linprocfs linproc /mnt/poolz/jail/crashplan/compat/linux/proc/ } mountproc_stop() { echo "--- mountproc stopped ---" } load_rc_config $name run_rc_command "$1"</span></span></code> </pre><br></div></div><br>  <b>Important!</b>  Check that the <b>mountproc_start</b> command starts from the first position in the line! <br>  <b><i>You change the</i></b> path <b><i>/ mnt / poolz / jail / crashplan / compat / linux / proc /</i></b> to your own (as in the previous paragraph). <br>  Making the script executable: <br><pre> <code class="bash hljs">chmod +x /conf/base/etc/rc.d/mountproc</code> </pre><br>  And turn on the autorun script <br><div class="spoiler">  <b class="spoiler_title">how to turn on</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/3fd/cb3/b2d/3fdcb3b2d40e4784a585bdfd33f26391.PNG"><br></div></div><br></li><li>  Whether we check everything is done correctly (first of all, the text of the script) and overload FreeNAS. <br></li><li>  After reboot, check if our settings are enabled: <br><pre> <code class="bash hljs">kldstat | grep linux mount | grep linprocfs</code> </pre><br>  If after the second command we do not see a line like this: <br><pre> <code class="bash hljs">linprocfs on /mnt/poolz/jail/crashplan/compat/linux/proc (linprocfs, <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>)</code> </pre><br>  then go back to the script creation item and look for the error. <br>  If all is well, then continue. <br></li><li>  We put Crashplan <br>  Go to jail (similar to the first two points): <br><pre> <code class="bash hljs">jls jexec &lt;jail_id&gt; /bin/tcsh</code> </pre><br>  Go to the directory <b><i>/ compat / linux</i></b> , download Crashplan, unpack and install: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /compat/linux fetch http://download1.us.code42.com/installs/linux/install/CrashPlan/CrashPlan_3.7.0_Linux.tgz tar -xzf CrashPlan_3.7.0_Linux.tgz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> CrashPlan-install /compat/linux/bin/bash /compat/linux/CrashPlan-install/install.sh</code> </pre><br>  We read the license agreement and agree with it. <br>  In principle, you can leave everything by default.  If you want to change something - change it, only carefully! <br>  After installation, the <b><i>CrashPlan_3.7.0_Linux.tgz</i></b> file and the <b><i>CrashPlan-install</i></b> directory from the <b><i>/ compat / linux</i></b> directory can be deleted, they are no longer needed. <br></li><li>  We edit run.conf Crashplan'a. <br><pre> <code class="bash hljs">nano /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/bin/run.conf</code> </pre><br>  At the beginning of each line, after the characters <b>SRV_JAVA_OPTS = "</b> and <b>GUI_JAVA_OPTS ="</b> insert <br>  <i>-Djava.nio.channels.spi.SelectorProvider = sun.nio.ch.PollSelectorProvider</i> . <br>  As a result, should receive: <br><pre> <code class="bash hljs">SRV_JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"-Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.PollSelectorProvider -Dfile.encoding=UTF-8 -Dapp=CrashPlanService -DappBaseName=CrashPlan -Xms20m -Xmx1024m -Djava.net.preferIPv4Stack=true -Dsun.net.inetaddr.ttl=300 -Dnetworkaddress.cache.ttl=300 -Dsun.net.inetaddr.negative.ttl=0 -Dnetworkaddress.cache.negative.ttl=0 -Dc42.native.md5.enabled=false"</span></span> GUI_JAVA_OPTS=<span class="hljs-string"><span class="hljs-string">"-Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.PollSelectorProvider -Dfile.encoding=UTF-8 -Dapp=CrashPlanDesktop -DappBaseName=CrashPlan -Xms20m -Xmx512m -Djava.net.preferIPv4Stack=true -Dsun.net.inetaddr.ttl=300 -Dnetworkaddress.cache.ttl=300 -Dsun.net.inetaddr.negative.ttl=0 -Dnetworkaddress.cache.negative.ttl=0 -Dc42.native.md5.enabled=false"</span></span></code> </pre><br></li><li>  Fix the path to java to the correct one. <br>  By default, Crashplan uses the path <b><i>/ usr / local / crashplan / jre / bin / java</i></b> <br>  We will change to the java path installed from the ports <b><i>/usr/local/linux-sun-jre1.7.0/bin/java</i></b> <br><pre> <code class="bash hljs">nano /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/install.vars</code> </pre><br>  In the variable <b>JAVACOMMON,</b> we change the path to <b><i>/usr/local/linux-sun-jre1.7.0/bin/java</i></b> <br><div class="spoiler">  <b class="spoiler_title">It should be like this</b> <div class="spoiler_text"><pre> <code class="bash hljs">TARGETDIR=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan BINSDIR=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin MANIFESTDIR=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/var/crashplan INITDIR=/etc/init.d RUNLVLDIR=/etc/rc.d INSTALLDATE=20150314 APP_BASENAME=CrashPlan DIR_BASENAME=crashplan JRE_X64_DOWNLOAD_URL=http://download.code42.com/installs/proserver/jre/jre-7u45-linux-x64.tgz JRE_I586_DOWNLOAD_URL=http://download.code42.com/installs/proserver/jre/jre-7u45-linux-i586.tgz JAVACOMMON=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/linux-sun-jre1.7.0/bin/java</code> </pre><br></div></div><br></li><li>  We check the performance. <br>  From jail <br><pre> <code class="bash hljs">/compat/linux/bin/bash /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/bin/CrashPlanEngine start /compat/linux/bin/bash /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/bin/CrashPlanEngine status</code> </pre><br>  From FreeNAS <br><pre> <code class="bash hljs">jexec &lt;jail_id&gt; /compat/linux/bin/bash /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/bin/CrashPlanEngine start jexec &lt;jail_id&gt; /compat/linux/bin/bash /compat/linux/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/crashplan/bin/CrashPlanEngine status</code> </pre><br>  If at startup we received "ok" and we see a lot of PIDs when checking the status, then everything works. <br></li><li>  Setting up Crashplan autorun <br>  Go to jail: <br><pre> <code class="bash hljs">jexec &lt;jail_id&gt; /bin/tcsh</code> </pre><br>  Create an autorun script: <br><pre> <code class="bash hljs">nano /etc/rc.d/crashplan</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Script text</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # PROVIDE crashplan # REQUIRE LOGIN . /etc/rc.subr name=crashplan rcvar=crashplan_enable start_cmd="${name}_start" stop_cmd="${name}_stop" crashplan_start() { /compat/linux/bin/bash /compat/linux/usr/local/crashplan/bin/CrashPlanEngine start } crashplan_stop() { /compat/linux/bin/bash /compat/linux/usr/local/crashplan/bin/CrashPlanEngine stop } load_rc_config $name run_rc_command "$1"</span></span></code> </pre><br>  We check that the <b>crashplan_start</b> and <b>crashplan_stop commands</b> are in the first position of the line! <br></div></div><br>  Making the script executable: <br><pre> <code class="bash hljs">chmod +x /etc/rc.d/crashplan</code> </pre><br>  We edit the rc.conf script. <br><pre> <code class="bash hljs">nano /etc/rc.conf</code> </pre><br>  Add a string <br><pre> <code class="bash hljs">crashplan_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span></code> </pre><br>  Along the way we rule <br><pre> <code class="bash hljs">sshd_enable=<span class="hljs-string"><span class="hljs-string">"YES"</span></span> hostname=<span class="hljs-string"><span class="hljs-string">"crashplan"</span></span></code> </pre><br>  to enable SSH and set the host name for us. <br></li><li>  Connection of storage folders in jail. <br>  How to connect folders in jail is well described in the <a href="http://doc.freenas.org/9.3/freenas_jails.html">documentation</a> . <br>  It is important to remember that the root file system for Crashplan is not the jail root ( <b><i>/</i></b> directory), but the <b><i>/ compat / linux</i></b> directory !!! <br>  That is, it is necessary to connect, for example, not to the <b><i>/ mnt</i></b> directory, but to the <b><i>/ compat / linux / mnt</i></b> directory, otherwise Crashplan will not see your directories. <br>  And do not forget that nested datasets must also be registered! <br></li><li>  The final touch for ssh. <br>  Set a password for root: <br><pre> <code class="bash hljs">passwd</code> </pre><br>  <b>Important!</b>  On FreeBSD (and FreeNAS jail), root login via ssh is prohibited.  To log in via ssh, you need to either add a user (by including him in the <b>wheel</b> group, allow him to <b>su</b> ) or edit the <b><i>/ etc / ssh / sshd_config</i></b> file.  In terms of security, the first option is more literate. <br>  I will not tell you how to use the <b><i>adduser</i></b> command, but will talk about the second option. <br>  Editing the sshd_config file: <br><pre> <code class="bash hljs">nano /etc/ssh/sshd_config</code> </pre><br>  Looking for the string <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#PermitRootLogin no #PasswordAuthentication no</span></span></code> </pre><br>  and change to <br><pre> <code class="bash hljs">PermitRootLogin yes PasswordAuthentication yes</code> </pre><br>  Save and run SSH: <br><pre> <code class="bash hljs">service sshd start</code> </pre><br>  or restart: <br><pre> <code class="bash hljs">service sshd restart</code> </pre><br></li></ol><br><br><h5>  <b><i>Crashplan setup</i></b> </h5><br>  Check whether Crashplan is running, if not, then run. <br>  The connection and setup itself is well described in <a href="http://support.code42.com/CrashPlan/Latest/Configuring/Using_CrashPlan_On_A_Headless_Computer">USING CRASHPLAN ON A HEADLESS COMPUTER</a> . <br>  If it is necessary for someone, I can paint. <br><br>  And after connecting, we look at the result. <div class="spoiler">  <b class="spoiler_title">Hooray!</b>  <b class="spoiler_title">Earned!</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/901/954/e10/901954e10b47412d8b92a09094bd7dcc.PNG"><br></div></div><br><br>  After rebooting, everything works! <br><br>  <b><i>PS I would like to hear constructive criticism.</i></b> <br><br>  <b>PPS Fixed errors in scripts</b> </div><p>Source: <a href="https://habr.com/ru/post/253235/">https://habr.com/ru/post/253235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253223/index.html">Charting and graphing with Doxygen</a></li>
<li><a href="../253225/index.html">MailChimp UX Team: Design [Part 4 of the Book]</a></li>
<li><a href="../253227/index.html">Deep Learning, NLP, and Representations</a></li>
<li><a href="../253229/index.html">Weekly assembly Vivaldi 1.0.129.2</a></li>
<li><a href="../253233/index.html">Boost C ++ libraries on Android</a></li>
<li><a href="../253237/index.html">Easy weekend or "wheelbarrow for pumping"</a></li>
<li><a href="../253238/index.html">Installing and running Android applications on Linux</a></li>
<li><a href="../253240/index.html">Self assembly or purchase of ready equipment for design. 3d printer. Part 1</a></li>
<li><a href="../253246/index.html">The power of minimalism: how we changed the design of Yelp</a></li>
<li><a href="../253248/index.html">Cognitoys: IBM's Intelligent Intelligent Intelligent Toy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>