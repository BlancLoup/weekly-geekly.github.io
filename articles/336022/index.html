<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Say no to solidity: how we made the CPA platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Under the cut - a story about how we implemented the modular architecture of the CPA-platform (Content Provider Access) for the telecom operator on Fu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Say no to solidity: how we made the CPA platform</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/3b3/bcb/a44/3b3bcba4415e4e258b8618f2ff5d1f4b.jpg"></div><br><br>  Under the cut - a story about how we implemented the modular architecture of the CPA-platform (Content Provider Access) for the telecom operator on Fuse Fabric.  At the same time, we will explain why we made such a decision, rather than using the standard J2EE technology stack to create a monolithic application. <br><a name="habracut"></a><br><h2>  What is CPA? </h2><br>  CPA is a platform for organizing interaction with content providers that provide various services to subscribers of their partners, telecom operators. <br><br>  As the simplest scenario, let's consider the situation when a subscriber wants to know the weather for tomorrow: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  the subscriber sends an SMS message to a short number to receive the weather forecast; </li><li>  The SMS message is received by the SMS center of the telecom operator; </li><li>  SMS center sends a message to the CPA platform; </li><li>  The CPA platform determines the service associated with the short number, determines its cost, checks the subscriber‚Äôs account with enough money, requests the weather forecast from the partner providing the service, writes off the subscriber‚Äôs account, logs the business transaction and sends the data to the SMS center for sending to the subscriber; </li><li>  The SMS center sends an SMS to the subscriber with the weather for tomorrow; </li><li>  the subscriber receives an SMS message. </li></ul><br>  This scenario illustrates well how different processes can be built on the basis of the interaction chains of various modules.  In particular, they involve: the module of interaction with the SMS center, the service catalog, the catalog of partners, the module of work with the billing system, the module of logging business operations, the module of interaction with a partner, and so on. <br><br>  Even this simplest scenario consists of more than a dozen operations.  At the same time, telecom operators can have dozens of much more complex scenarios, during which the most diverse systems interact.  For example, a request may come from the USSD center, IVR center, web portal, and so on.  In addition, it may not be a one-time request, but a subscription to the service (including in installments), unsubscribe from it, and so on. <br><br><h2>  Choice of approach </h2><br>  When we started the project to create a CPA system, we chose from several options for the platform architecture.  When designing applications of this scale, first of all you need to consider the following aspects: <br><br><ul><li>  This will be a priori high-load system, which should handle hundreds of fairly complex business scenarios per second.  As the load increases, the system should scale easily horizontally. </li><li>  Such systems are subject to very stringent requirements for downtime.  It should be minimal even when the system configuration changes, for example, in the case of adding new functionality or changing current components. </li><li>  It is necessary to provide a simple centralized management of the system, with the display of metrics that allow unambiguously assess the current state. </li><li>  The telecom sector requires a very quick response to changes in the market and technology pool, so the system architecture must allow for the rapid replacement of components. </li><li>  It is extremely important to shorten the time to introduce the product as much as possible, therefore the development and testing cycle for new functionality should be as short as possible. </li></ul><br>  Given all this, we quickly realized that the traditional monolithic J2EE architecture does not suit us, because it does not provide the required flexibility and does not cover all customer needs.  Therefore, we chose a modular architecture based on <a href="https://ru.wikipedia.org/wiki/OSGi">OSGi</a> ‚Äî Red Hat Jboss Fuse in the Fuse Fabric configuration. <br><br>  Our architecture was to be based on stand-alone modules that interact based on well-defined interfaces.  Today, this is described by the term ‚Äúmicroservice architecture‚Äù, but at the time of the beginning of the creation of the CPA platform, the word ‚Äúmicroservices‚Äù was known to few. <br><br>  Note that the wrong choice of architecture for systems of this level can lead to literally catastrophic consequences both at the stage of development and operation, and at the stages of further development of the system to expand its functionality.  But we needed as soon as possible to show the customer a prototype proving the viability of the chosen idea.  This is where OSGi modularity support came to the rescue. <br><br>  In designing the system, we relied on the API modules of which it was supposed to consist, and BPM processes (business processes described using standard <a href="https://ru.wikipedia.org/wiki/BPMN">BPMN notation</a> ).  These processes described the business scenarios that the CPA platform performs by calling the API modules.  That is, at the initial stage, we had modules (OSGi-sets), which were essentially microservices- ‚Äústubs‚Äù that performed primitive operations, and BPM-processes that described the sequence of calls to OSGi-services as close as possible to the business scenarios of the telecom operator to achieve the desired result. <br><br>  At the same time, we understood that the OSGi-sets created by us will be called both in BPM scripts and from other places.  For example, a service for working with a service catalog is not only directly called from BPM processes, but is also used in back-office systems so that content managers can start, delete, and edit services.  Also, the service catalog API is used to provide a list of services on the telecom-operator site.  The billing system service was first used only in the CPA platform, but now it is also available as a REST service, therefore other systems in the infrastructure of the telecom operator use its services. <br><br><h2>  Implementation </h2><br>  When creating an architecture in the form of modules with a clearly specified API, we very quickly became convinced of its effectiveness and efficiency. <br><br>  Since the OSGi-APIs were agreed and approved, we were able to parallelize the development process of individual OSGi-sets for different development teams.  At the same time, the teams did not influence each other in any way, because they all worked with their code bases and subject areas.  The main thing - do not violate the agreed API-set.  One team could focus on developing a partner directory, another on developing a business-logging service, and so on.  In this case, the architect monitored the integrity of the system based on the agreed API. <br><br>  For easy tracking of API changes, we have adopted semantic versioning of OSGi sets.  This implies assigning versions of components in XYZ format, where X is the major version, Y is the minor version, Z is the patch version.  The versions are iterated according to the following rules: <br><br><ul><li>  the major version is incremented when incompatible API changes are made; </li><li>  we increase the minor version when new functionality is added that does not violate backward compatibility; </li><li>  We increase the patch version when backward-compatible fixes are added that do not affect the API. </li></ul><br>  Thanks to this, we easily tracked changes to the API services across the entire system and accurately managed them when building together the services together. <br><br>  When developing complex systems, it is necessary to write tests for the implemented functionality.  Since the components in the OSGi environment interact by invoking interfaces, this greatly simplifies unit testing.  If any service in our application refers to another service, then at the testing stage we can easily replace with a ‚Äústub‚Äù the service that is being accessed.  And when testing each module, it is necessary to take into account the specifics of its work. <br><br>  We understood that in a high-load system, any service, depending on the nature of the load, could become a bottleneck in the entire application.  Therefore, for each API call of an OSGi set, metrics that were available via the JMX interface were removed.  This made it possible to record the maximum duration of a call to any service method, the average value over a period of time, and the dynamics of changes in the metric.  The captured data helped us during the load testing to immediately identify the bottlenecks of the application, and also made it possible to monitor the production system in the online mode.  So with the degradation of performance, we could quickly take measures to stabilize the system.  For example, you can transfer the service to another node of the runtime environment, or move it to a separate JVM.  In this case, OSGi allows us to perform all these actions on a running system without affecting the rest of the application components. <br><br>  When adding new functionality to an existing system, we can explicitly track changes in the code base (new sets or later versions) and optimize the testing process.  If we see that in the next delivery the version of the component has not changed, then it does not need to develop new tests and re-test it carefully.  It is better to focus on the new functionality added to the system. <br><br>  Of course, no one is immune from errors that may occur in the production-environment.  But OSGi allows you to quickly make changes to a running system.  It is enough to correct the error in the component, increment its patch version and install it into the OSGi runtime environment.  This is an important advantage in conditions when the system downtime significantly affects both the quality of the service provided and the company's profit. <br><br>  It is also worth noting that when an error is detected in a monolithic architecture, in contrast to a modular architecture, you have to rebuild the entire application and restart it.  And restarting a traditional J2EE application usually takes a lot of time, which is tantamount to financial losses for a company. <br><br>  <i>Development department of the Center for software solutions of Jet Infosystems</i> </div><p>Source: <a href="https://habr.com/ru/post/336022/">https://habr.com/ru/post/336022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336010/index.html">React Native: from simple animation to interactive at 60 FPS</a></li>
<li><a href="../336012/index.html">Support for system errors in C ++</a></li>
<li><a href="../336016/index.html">CrowdSourcing Accelerator</a></li>
<li><a href="../336018/index.html">Change of consumer preferences: in search of the ideal drive with support for the NVMe protocol</a></li>
<li><a href="../336020/index.html">30+ tools for professional development of Android applications</a></li>
<li><a href="../336024/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ276 (August 14 - 20, 2017)</a></li>
<li><a href="../336026/index.html">On the quality of requirements in IT projects, to be honest (from the standpoint of the development team). Part 3</a></li>
<li><a href="../336028/index.html">Parsing: can hackers actually hack the stock exchange</a></li>
<li><a href="../336030/index.html">Unit tests. The first step to quality</a></li>
<li><a href="../336034/index.html">Retrofit on Android with Kotlin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>