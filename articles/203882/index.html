<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex now supports encryption of outgoing and incoming mail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week, we included in Yandex.Mail mail encryption for cross-server SMTP connections using STARTTLS - both for receiving and sending emails. Now al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex now supports encryption of outgoing and incoming mail</h1><div class="post__text post__text-html js-mediator-article">  Last week, we included in Yandex.Mail mail encryption for cross-server SMTP connections using STARTTLS - both for receiving and sending emails.  Now all emails from our mail system to users of other services that support such encryption (for example, Gmail) are transmitted in encrypted form, and no one will be able to read them on the way.  On this occasion, I will talk a little bit about the protocols that are used when sending email in encrypted form. <br><br>  Despite the fact that the encryption of the connection between the user and the mail interface is already quite common among mass services, the correspondence between the mail systems often went unprotected.  And the security of correspondence is a very important thing for us (although it is not very noticeable to the average user). <br><br> <a href="http://habrahabr.ru/company/yandex/blog/203882/"><img src="https://habrastorage.org/getpro/habr/post_images/698/055/54e/69805554e643e0c0eb00f411fc368b37.jpg" alt="image"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Researchers have yet to find the cause of the true love of Internet technologists for abbreviations.  Since the days of <a href="http://en.wikipedia.org/wiki/ARPANET">ARPANET,</a> all networks, protocols, standards, etc.  prefer to call letter abbreviations.  This simple and clear way of word formation leads to the appearance of sentences like: "IETF published <a href="http://tools.ietf.org/html/rfc6594">RFC6594</a> by CZ.NIC on the use of SHA-256 with RSA, DSA and ECDSA in SSHFP".  As you can see, there are especially many such cuts in cryptography. <br><br><a name="habracut"></a><br><br><h4>  What is SSL and TLS? </h4><br>  In the nineties of the last century, one of the ‚Äúincubators‚Äù where all interesting ideas from the academic environment were translated into reality was the company <a href="http://en.wikipedia.org/wiki/Netscape">Netscape</a> .  At the beginning of the previous year, its employees realized the ability to encrypt connections, published a protocol and named it Secure Sockets Layer (SSL).  Its first public version was SSL v2, in which a <a href="https://www.schneier.com/paper-ssl.pdf">number of vulnerabilities were</a> quickly <a href="https://www.schneier.com/paper-ssl.pdf">found</a> .  It was followed by the last currently SSL v3.  <a href="http://home.netscape.com/eng/ssl3/ssl-toc.html">The original description</a> on the Netscape website sank into oblivion at the time of the acquisition of Netscape by AOL, but in 2011 it was nevertheless <a href="https://www.rfc-editor.org/info/rfc6101">published for history as RFC6101</a> . <br><br>  Then the first free implementation of SSL appeared.  Enthusiast Eric Young began publishing the <a href="http://en.wikipedia.org/wiki/SSLeay">SSLeay</a> library (this time the combined abbreviation: SSL + Eric A. Young) under a <a href="http://en.wikipedia.org/wiki/BSD_licenses">BSD-like license</a> .  A few years later SSLeay will turn into the <a href="http://en.wikipedia.org/wiki/OpenSSL">OpenSSL</a> library known to all specialists. <br><br>  What is important to know about SSL v2 and v3?  First, these protocols are designed to work on top of the transport protocol with reliable delivery and connections (for example, TCP).  Secondly, SSL v2 can no longer be used - it is officially considered to be too vulnerable and in the current environment can only give the illusion of security. <br><br>  Based on SSL v3, a team of scientists and engineers within the <a href="http://en.wikipedia.org/wiki/IETF">IETF has</a> created a Transport Layer Security ( <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS)</a> protocol.  In fact, TLS v1.0 is a small (but incompatible) reworking of SSL v3, which includes all of its features and adds some details. <br><br>  The end of the nineties and the beginning of zero were marked by the widespread use of HTTPS (and this, I remind you, just HTTP over SSL / TLS - HTTP with encryption), and therefore more careful attention to these protocols by computer security specialists <a href="https://en.wikipedia.org/wiki/Hacker_%2528computer_security%2529">in hats of both colors</a> .  As a result, a <a href="https://www.openssl.org/~bodo/tls-cbc.txt">whole class of vulnerabilities</a> was discovered when using SSL v3 or TLS 1.0 with block encryption algorithms in CBC mode (and other modes of block algorithms were not used in SSL).  In 2006, as early as 7 years later, an updated version of TLS 1.1 was released, eliminating these vulnerabilities.  However, engineers were not in a hurry to implement TLS 1.1 right up to 2011, when there was a loud attack on browsers using TLS 1.0, called <a href="http://habrahabr.ru/company/xakep/blog/132344/">BEAST</a> , all over the Internet.  Several crutches were immediately invented (for example, switching to a stream cipher), and priorities for upgrading everything and everyone to TLS 1.1+ were also raised. <br><br>  In 2008, the most recent TLS version 1.2 was released.  It appeared a lot of innovations.  First, it became mandatory to use the <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> encryption algorithm, and a new encryption mode appeared in addition to CBC - <a href="http://en.wikipedia.org/wiki/Galois/Counter_Mode">GCM</a> .  Secondly, support for obsolete <a href="http://en.wikipedia.org/wiki/Data_Encryption_Standard">DES</a> and <a href="http://en.wikipedia.org/wiki/International_Data_Encryption_Algorithm">IDEA</a> algorithms was excluded.  Third, the protocol abandoned the use of HMAC based on the MD5 hashing algorithm and switched to more robust SHA256 and SHA384.  Fourthly, the TLS extensions extension mechanism has appeared, allowing to enable new features without a complete processing of the protocol.  One of these extensions is <a href="http://tools.ietf.org/html/rfc3546">SNI</a> , which is actively used in Yandex services.  Finally, so that all innovations do not turn out to be useless, in the protocol the possibility of a downgrade on SSLv3 was declared obsolete and not recommended. <br><br>  So, summing up: <br><ol><li>  SSL is a secure connection protocol over TCP.  New versions of SSL does not happen.  TLS ‚îÄ this is the new SSL, with new version numbering. </li><li>  There is an old SSL v2.  It is useless - if it is supported, it must be disabled.  There is SSL v3, which is everywhere supported for many years.  But it found flaws that may adversely affect security.  There is TLS v1.0, SSL v3 vulnerabilities are preserved in it, and it would be better to use it only with the streaming <a href="http://en.wikipedia.org/wiki/RC4">RC4</a> encryption <a href="http://en.wikipedia.org/wiki/RC4">algorithm</a> (which is separately considered theoretically vulnerable).  Therefore, it is best to use TLS v1.1 or v1.2 and disable the RC4 cipher. </li></ol><br><h4>  Email Protocols </h4><br>  We can confidently say that the main user-defined protocol for sending email is HTTP.  This may sound unusual, but the vast majority of users read and send their emails in 2013 in this way. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/116/ab4/e08/116ab4e084e687513170d7193958d85f.png" alt="image"><br><br>  The mail programs, though relegated to the background, are still widely used and work on three protocols: the old POP3, a slightly newer IMAP and universal SMTP.  About the history of POP3 and IMAP, I <a href="http://habrahabr.ru/company/yandex/blog/182140/">told a</a> little bit <a href="http://habrahabr.ru/company/yandex/blog/182140/">earlier</a> , and now I‚Äôll add a little bit about SMTP. <br><br>  E-mail is rightly called the first <a href="http://www.merriam-webster.com/dictionary/killer%2Bapp">killerpp of</a> computer networks.  The roots of modern SMTP (Simple Mail Transfer Protocol) goes very deep into ARPANET, in the pre-TCP / IP era of transferring files between computers of American universities with the money of the US Department of Defense.  These were naive beautiful times of widespread mutual trust, when not only encryption was required, but even the simplest authentication.  Than to us it was backfired years later, by the way, you can see it in your own ‚ÄúSpam‚Äù folder. <br><br>  See, the first version of SMTP for the Internet (with a capital letter!) Is specified in <a href="https://tools.ietf.org/html/rfc788">RFC 788</a> at the end of 1981.  Already then it was the result of more than a decade of e-mail development in ARPANET.  And only almost 20 years later, in 1999, the <a href="http://tools.ietf.org/html/rfc2554">official standard for authentication appeared</a> , that is, logins and passwords in SMTP.  All this time, sending mail via SMTP was possible immediately after connecting to anyone, anyone.  This mode, of course, was suitable for inter-server communication on a network with a large number of hops ‚îÄ in this case, the hosts can serve as relays for someone else's mail.  But the initial sending, the so-called submission, without authentication led to the appearance of spam, and then to the invention of SMTP AUTH.  By the way, old-timers can still remember the ‚ÄúPOP3 before SMTP‚Äù mode, which used POP3 as an authenticating crutch to SMTP. <br><br>  As soon as passwords appear in the protocol, they immediately begin to think about encryption.  In 2002, a standard was released to support the upgrade of an open SMTP session to TLS mode ‚îÄ <a href="https://tools.ietf.org/html/rfc3207">RFC3207</a> .  It was an attempt to fix and improve the defacto situation ‚îÄ SMTP encryption on a separate port 465 had already been used for several years. <br><br>  The <a href="http://en.wikipedia.org/wiki/STARTTLS">STARTTLS</a> operation scheme is of separate interest.  This is a universal extension for any text protocol.  In reality, it gained distribution for SMTP, IMAP / POP3 and a little bit for FTP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/918/d4f/a0c/918d4fa0c7ab2e6bdb0c8ad22aee2a4b.png" alt="image"><br><br>  At the moment when the client and the server in the already established open connection realize that there is an opportunity and desire on both sides to encrypt the data transfer, the client gives the STARTTLS command and immediately starts the TLS handshake. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f60/e27/01c/f60e2701c30751ca8f69cf9e3adaa071.png" alt="image"><br><br>  The only thing that depends on the application protocol is to ensure that TLS is mutually supporting before encryption starts.  In the case of SMTP, this happens through the ESMTP extension mechanism ‚îÄ <a href="https://tools.ietf.org/html/rfc3207">there</a> are more details about this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/253/926/807/2539268073503eb69ed7d7c6b801d913.png" alt="image"><br><br>  SMTP encryption via STARTTLS on standard ports (recall, 25 and second 587, which is often forgotten) or port 465 immediately began to gain popularity.  TLS allows a lot: both certificate authentication and server authentication ‚îÄ all of these are interesting, necessary, and hitherto inaccessible features.  Now, it seems, there are no mail systems that do not accept mail from users over an encrypted connection.  Another thing is interserver communication. <br><br>  SMTP is not just an email workhorse, it is also a two-headed horse. <br><br>  The entire exchange of letters between servers of different mail systems also takes place via SMTP.  Of course, there is no longer password authentication ‚îÄ instead, verification of the address of the recipient of the letter at the application level is used.  If it doesn‚Äôt exist, it turns out Open Relay, for which your IP address will necessarily be punished with a negative reputation by all the anti-spam systems in the world.  Usually there is no encryption.  There are several reasons for this.  First, it is believed that the communication channels between the servers of the postal systems themselves are quite safe.  And indeed, during transmission between servers, letters usually do not descend into the ‚Äúlast mile‚Äù, where small, ‚Äúcasual‚Äù traffic interception usually occurs.  Secondly, this transfer is asynchronous and non-interactive, due to which there is no possibility to clarify with the person what to do in case of inconsistency or overdueness of the certificate of the receiving side of the connection. <br><br>  All these arguments, however, prove to be untenable.  The receiving server may not be in the rack of a large secure data center, but anywhere.  Government organizations around the world are launching wiretapping programs on all channels of communication.  Verification of certificates, although useful, is not at all necessary in order to secure the transfer of information.  Therefore, more and more, we find emails that are sent in encrypted form all the way ‚îÄ from the user's browser via HTTPS to the mail system server, then to the recipient's server via SMTP over TLS, and then the encrypted IMAP to the phone of the person to whom message.  And this is good. <br><br><h4>  Encryption support in Yandex Mail protocols </h4><br>  In 2009, <a href="http://company.yandex.ru/press_releases/2009/0528/">simultaneously with the launch of IMAP,</a> we added SSL / TLS support to our POP3 interface.  At about the same time, encryption in SMTP for receiving emails from mail programs appeared.  Today, more than 4 years later, our servers still allow you to open unprotected connections from mail programs, although we do not recommend using them and even, if possible, do not document them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f68/c55/5db/f68c555db55ebeaaf8300e3dc9ae078e.png" alt="image"><br><br>  Yandex.Mail mobile applications always use SSL / TLS connections, and inside they use the XMPP protocol. <br><br>  In 2011, <a href="">we enabled HTTPS</a> in the web interface <a href="https://mail.yandex.ru/">mail.yandex.ru</a> and covered in this way all the basic ways to transfer user information to the cloud.  This year, we made HTTPS mandatory when accessing the Mail, and this week we turned off any opportunities to connect to it via an unprotected protocol. We also did a great job of protecting user passwords in the authentication system - Yandex.Passport - and be sure to tell about it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b5/6ae/385/1b56ae385d18e23939dde37cfc99a609.png" alt="image"><br><br>  This is what the ratio of encrypted and regular traffic on our SMTP communication servers with the outside world looks like now. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/657/279/d85/657279d85a1b46adc9823d9742db240e.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/0ce/800/4f0/0ce8004f0c5986be68564dca909e5fea.png" alt="image"><br><br>  The end of 2013 can be confidently called the year of high-profile scandals associated with mass tapping of data by government organizations, and the first year of widespread cloud encryption.  We urge all of our industry colleagues to join the trend and set a course for one hundred percent encryption of all user data on the network.  So it goes. <br><br>  PS: Edward, hello!  :) <br>  PPS: Edward Snowden does not work and never got a job at Yandex. </div><p>Source: <a href="https://habr.com/ru/post/203882/">https://habr.com/ru/post/203882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203868/index.html">Object-Oriented Business: How a Franchise Works</a></li>
<li><a href="../203872/index.html">Microsoft has released a program for seamless looping animation.</a></li>
<li><a href="../203874/index.html">Key indicators of customer service quality in the retail and service industries</a></li>
<li><a href="../203876/index.html">Curiosity rover fully recovered after electrical system failure</a></li>
<li><a href="../203878/index.html">How to become a "big fish" in the sea of ‚Äã‚Äãmobile applications</a></li>
<li><a href="../203884/index.html">Creating a convenient OpenFileDialog for Android</a></li>
<li><a href="../203886/index.html">We collect "bad data" (bad data)</a></li>
<li><a href="../203890/index.html">JohnSmith - a simple and lightweight JavaScript framework for building UI</a></li>
<li><a href="../203892/index.html">School open data. First 7 lessons and feedback</a></li>
<li><a href="../203904/index.html">Bitcoin rate exceeded $ 1000 for 1 BTC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>