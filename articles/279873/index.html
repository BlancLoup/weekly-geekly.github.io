<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From document to project: how Wrike created an add-in for Office 365</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Productivity surely enters the top trends of recent years and is even more in demand in 2016, and includes such areas as Collaborative Software, Smart...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From document to project: how Wrike created an add-in for Office 365</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <em>Productivity surely enters the top trends of recent years and is even more in demand in 2016, and includes such areas as Collaborative Software, Smart Virtual Personal Assistants, Bots and many others ...</em> <em><br></em>  <em>In this article, we will talk about how Wrike expanded its solution and implemented the Add-In for Office, as well as share its development experience.</em> <em><br></em>  <em>I want to thank for the preparation of the article by Arkady Rushkevich (Lead Product Manager) and Vladimir Dupelev (Head of Software Development Group)</em> </blockquote><br>  Recently, the project management service Wrike announced several integrations with Microsoft products.  Now you can log in to the service with the <a href="https://azure.microsoft.com/en-us/documentation/articles/active-directory-whatis/">Azure Active Directory</a> corporate login, add files from OneDrive for Business to tasks and install the <a href="https://store.office.com/WA104379841.aspx">Wrike</a> add- <a href="https://store.office.com/WA104379841.aspx">on in Office</a> 365. <br><br>  The latter is perhaps the most important in terms of productivity in the workplace.  We decided to talk about why the project management system needed integration with office applications, and to share experience in developing an <a href="http://dev.office.com/getting-started/addins">add-in for Office</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/630/295/6e0/6302956e07504d6fa3567de22662aa6c.jpg"></div><br><a name="habracut"></a><br><h3>  Productive bundle </h3><br>  <a href="https://www.wrike.com/ru%3Futm_source%3Dhabrahabr%26utm_medium%3Dblogposts%26utm_campaign%3Dms_office_addin">Wrike</a> was able to make over 10,000 companies, including PayPal and HTC, in its highly competitive market.  Service is allocated, above all, a special attention to teamwork.  It is designed not only for project managers, but also for performers.  Users can conduct discussions right under the tasks, simultaneously edit texts, ‚Äúcall‚Äù colleagues into the discussion by mentioning the type @ employee_name, subscribe to the news line of the department, project, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another feature is that, unlike some other systems, Wrike does not preach the complete abandonment of traditional working tools: email, instant messengers, file storages, online editors, etc., and the transfer of all joint work activity and content to a new system.  This is possible, but not necessary.  Instead, users can use the numerous integrations and add-ons offered by Wrike to work comfortably with familiar applications without switching between them.  The service itself in this case acts as a connecting hub where project planning and monitoring is conducted, as well as coordination of team work on tasks. <br><br>  Given these features of Wrike, integration with such a common solution as <a href="https://products.office.com/ru-ru/home">Office 365</a> , suggested itself.  The basic idea is to create a direct ‚Äúcommunication channel‚Äù between individual user tools, such as Word and PowerPoint, and a command service for scheduling work. <br><br>  The add-on for Office 365 allowed users to download documents and presentations directly from office applications into Wrike, without switching between windows, tabs and file search.  There in Wrike you can add a document to a task that is being created or already existing.  For example, a PR manager, after receiving the task of writing a press release, can do this in Word, immediately attach the finished document to the task in Wrike and appoint the email marketing manager as the next executive to distribute to the journalists. <br><br>  Also, right from Office 365, you can change the description, status and deadlines of tasks, view and add comments to them.  This allows you to save working time that was spent on the routine, and makes communication within the team more transparent. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/318/ed9/921/318ed99212c6405e96f51a29c8df7117.jpg"></div><br><h3>  Technical details </h3><br>  The add-in for Office 365 is a web application that opens in the sidebar of an office application, with access to the document and functions through the <a href="https://msdn.microsoft.com/en-us/library/office/jj220082.aspx">Office 365 JS API</a> .  It looks tempting and easy to implement, but we also had very tight deadlines, due to the workload of developers, for everything about a month and a half.  However, preliminary estimates have shown that it‚Äôs realistic to develop and launch an application at such a time taking into account the capabilities of the Office 365 infrastructure.  The devil was in the details, but more on that later. <br><br>  Superstructure is almost completely located on the Web.  Locally (if this word is applicable to Office Online), only the manifest is loaded, which is an XML file with the address information of the web application, as well as additional information, such as a set of compatible Office applications, a version, a link to favicon, etc.  The application opens as an iframe in Office Online and native <a href="https://products.office.com/en/mobile/office">Office</a> applications <a href="https://products.office.com/en/mobile/office">for iOS and Android</a> , and as an independent embedded browser window in Office 2013/2016. <br><br>  This ‚Äúarchitecture‚Äù has defined the development environment.  Wrike is written mainly on <a href="https://www.dartlang.org/">Dart</a> using <a href="https://www.polymer-project.org/1.0/">Project Polymer</a> .  It was also used for our add-in for Office 365. This allowed us to reuse a significant part of the code, and also to write not a standalone application that works with Wrike through the API, but an alternative web representation of the main system.  <a href="https://www.visualstudio.com/en-us/products/vs-2015-product-editions.aspx">Microsoft Visual Studio was</a> used only for writing and validating the manifest (Community Edition is quite suitable for this purpose).  Everything else is traditional in Webstorm. <br><br><h3>  P3P certification </h3><br>  For successful operation of the application, it was necessary to receive and accept cookies with the secure attribute.  Browser internet explorer 10, 11 and Edge still uses special p3p header information that allows saving and sending any cookies, and especially handles the case with a secure cookie ( <a href="https://www.w3.org/Protocols/rfc2109/rfc2109">www.w3.org/Protocols/rfc2109/rfc2109</a> , the ‚Äúsecure‚Äù attribute ). <br><br>  How to connect a digital version of security policies and data about processed and stored user information (p3p) to a project is described on <a href="https://www.w3.org/P3P/usep3p.html">the W3C website</a> .  Without the support of the p3p protocol, the site will run in the sandbox.  The restrictions are imposed by the ‚ÄúDangerous Sites‚Äù zone, prohibiting the storage and transmission of cookies. <br><br>  The p3p protocol artifacts are a manifest manifest file (p3p.xml), the <a href="https://www.w3.org/TR/P3P/">manifest</a> itself, which describes the security policy of working with your site data in a machine-readable format (usually policy1.xml), as well as a <a href="https://www.w3.org/TR/P3P/">shortened version of the</a> described policy.  It can be used in the header returned with each request (three-letter combinations describing different policies). <br><br>  Difficulties start from the moment that W3C documentation item 3 lists the tools whose pages no longer open, and it‚Äôs almost impossible to find a free wizard to create policy.xml.  When filling out the manifest manually, it is necessary to understand which sections are important for the operation of the site, and which are not mandatory, but are necessary from a legal point of view. <br><br>  Internet Explorer, which is built into the offline Office application, by default ignores the notion of a manifest (which should be along the path /w3c/p3p.xml) and the contents of the tags in the pages.  The only thing that includes the ability to save and send a security cookie is the <a href="https://www.w3.org/2002/04/P3Pv1-header.txt">HTTP header of the</a> form: <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">policyref</span></span>="/<span class="hljs-selector-tag"><span class="hljs-selector-tag">w3c</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">p3p</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xml</span></span>", <span class="hljs-selector-tag"><span class="hljs-selector-tag">CP</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">CAO</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DSP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COR</span></span> ...".</code> </pre> <br>  Again, there is a nuance.  If you fill in the rule that your site has ‚ÄúPhysical contact information‚Äù or CP = ‚ÄùPHY‚Äù, then support for cookies with the secure attribute will immediately be disabled, and everything will stop working again. <br><br>  You can go the way of Amazon and do <a href="">so</a> , but if there is policy.html on the site, it‚Äôs not difficult to specify the necessary contact information right there. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b5d/f40/117/b5df4011717d4c588a081600af6fa5c3.jpg"></div><br><br><h1>  Implementation details </h1><br><h3>  Initialization </h3><br>  We realized that you should never connect two times the code of the <a href="https://msdn.microsoft.com/en-us/library/office/fp160953.aspx">office.js</a> library in one HTML file - you will get an error at the stage of receiving the content of files and not earlier.  This can happen if you have a header template for each page, and you additionally mentioned office.js in the main page code. <br><br>  Initialization is not the most obvious way.  Instead of calling <i>office.init ()</i> with passing the callback function or the popular future pattern, we found the <font color="green"><i>initialize</i></font> property, which needs to set its <i>callback</i> function. <br><br>  <font color="blue">Dart initialization code:</font> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> initOfficeDocument() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> office = context[<span class="hljs-string"><span class="hljs-string">'Office'</span></span>]; office[<span class="hljs-string"><span class="hljs-string">'initialize'</span></span>] = (_) { ‚Ä¶ }; }</code> </pre><br><br>  Once this is done, the internal <a href="https://msdn.microsoft.com/en-us/library/office/fp160953.aspx">office.js</a> timer will catch this event and start initiating the document: <br><br><pre> <code class="javascript hljs">g.waitForFunction(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Microsoft.Office.WebExtension.initialize!=<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>},...  <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Office=Microsoft.Office.WebExtension</code> </pre><br><br>  That is, the initialization is asynchronous and implemented with an unusual pattern.  If for some reason the contents of your anonymous function passed to the initialization is empty, and someone subsequently deletes it, the add-in will stop working.  So our advice to developers is to provide sufficient comments for this place. <br><br><h3>  Data provider </h3><br>  Document data can be obtained using <i>getFileAsync</i> method.  Read more about this in the Microsoft documentation.  However, the method will not work until it is requested to read the entire document in the manifest. <br><br><pre> <code class="javascript hljs"> &lt;Permissions&gt;ReadAllDocument&lt;<span class="hljs-regexp"><span class="hljs-regexp">/Permissions&gt;</span></span></code> </pre><br><br>  The <i>getFileAsync ()</i> method returns a file object in which you can extract pieces of a file and glue them together for transfer to the server, converting them into a Uint8List type.  Slices are transmitted in javascript array format.  An interesting and not very noticeable feature in the documentation is that you can‚Äôt request slices larger than 65536 bytes.  Otherwise, this method will not work on all platforms. <br><br>  Also pay attention to the Remarks section in the <i>getFileAsync</i> method <i>description</i> .  The resulting array can be completely sent to the server via the http request POST method. <br><br><h3>  Difficulties </h3><br>  We encountered the first and main difficulty almost at the beginning of development.  The problem appeared in the HTTP header X-Frame-Options.  Since by default we work with the value Deny, attempts to log in to the same window were impossible.  There was an idea to do everything in popapa.  However, we remembered that there is an offline platform.  We looked at how our cropped offline browser reacts to such attempts - it blocked everything that pops up.  So, our own and Google-authorization could be performed only inside the window.  Then we remembered that there is an online mode, and there x-frame-options deny is already on the Google Auth page.  Conclusion: you have to do various login methods for online and offline platforms. <br><br>  Another nontrivial task was debugging the application.  <a href="https://msdn.microsoft.com/en-us/library/office/dn356576.aspx">According to the requirements of the Office Store, the</a> application should work in IE 11 browsers (you can refuse to support IE 9 and 10 by making a blank page for them), Chrome, Safari and Firefox of the current versions for Office Online and in IE 11 for Office 2013/2016.  There were no problems with debugging in browsers, but the built-in browser in the Office desktop does not have a debugging console.  since there were errors specific to the offline version, I had to catch them sending fake requests to the server, passing debugging information in the request arguments. <br><br>  You can view messages by proxy monitor.  If your server does not respond, hangs on the output of the add-in page or takes a long time to prepare the data, then most likely the offline Office application will hang.  It seems that the loading of the site for the add-in occurs in the main UI stream of the application, which makes it difficult to debug. <br><br>  Another nasty bug is the pop-up warning ‚ÄúAn add-on for this website failed to run.  Check the security settings in Internet Options. ‚Äù <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/92d/dcf/20a/92ddcf20ac82446f8a6df4f50ef09a93.png"></div><br><br>  When testing by the Microsoft team, this is interpreted as a violation of the requirement that the entire add-in site should work on the HTTPS protocol.  Information that the HTTPS site can be found in the Security Info sidebar, SSL: On. <br>  It turned out that the security error pops up at the moment when the ActiveX object appears in the DOM or the Javascript code generates it.  Nobody specifically created the ActiveX component, although I really wanted to.  To open links in the default browser, you could create a new ActiveXObject object (‚Äúwscript.shell‚Äù) and call the Run method (‚Äúlink‚Äù) on it, so as not to surprise the user by opening links only in Internet Explorer. <br><br>  The error is caused by the webComponents library used in Dart Polymer (0.5), and jquery lower versions (1.3).  Both libraries at the initialization stage try to attach to the document ‚Äú‚Äù to check the capabilities and version of the browser.  In Internet Explorer, HTMLObjectElement is an ActiveX object, which results in an undocumented and undocumented error.  For jquery, you need to upgrade, and version 1.9 no longer creates an object on connection.  For webComponents, I had to create my own ‚Äúimproved‚Äù version. <br><br>  The <i>little thing</i> that cost us time and nerves because of inattention is the restriction of the Office 365 API. The main method that provides access to the file is <i>getFileAsync ()</i> .  Currently, the method is supported in Word desktop and online versions, in Excel Online and PowerPoint Desktop (in PP Online, add-ins could not be run until recently).  What is the reason for the lack of support for the method in Excel Desktop is unknown.  We were looking for a bug that prevented files from loading into Excel for more than a week, because it was necessary to read the documentation more carefully, and we, as a joke, are more like writers.  After we figured out, we had to remove Excel Online support, because you cannot specify an arbitrary matrix of applications in the manifest, only Word / Excel / PP and Online / Desktop alone. <br><br>  According to Wrike customers who agreed to participate in beta testing, such an application would be very useful in Excel, so we are really <i>looking</i> forward to Microsoft's support for <i>getFileAsync ()</i> in Excel. <br><br>  In general, some problems of ecosystem integrity are still present.  So, at some point, when testing was already underway, add-on support for Office Online in Safari disappeared for several weeks without warning.  Fortunately, after the restoration of work, I didn‚Äôt have to correct anything - nothing broke. <br><br>  One more thing - as mentioned above, until the publication of the add-in was not supported in Powerpoint Online, and appeared, again without warning, after sending the application for testing.  It is clear that the ecosystem is young and is actively developing, and we hope that in the future there will be more clear information about technical changes. <br><br>  Actually, all this led to the fact that it took us longer to debug and publish (about a month) than to develop it (about three weeks). <br><br><h3>  Publication </h3><br>  The publishing process was quite simple, and is similar to similar processes in other app stores.  An application is created through <a href="https://msdn.microsoft.com/en-us/library/office/jj220033.aspx">Seller Dashboard</a> , information is displayed for display in the store, a manifest is loaded, and all of this is sent for publication.  The application passes a manual test, after which, if everything is in order, it is automatically laid out in the store during the day specified when sending. <br><br>  We must pay tribute to the Microsoft testing team - usually no more than a working day passed from sending to validation until the report was received.  And the application is being tested in sufficient detail - in particular, we received the first refusal in connection with a pair of hard-to-catch bugs, which manifested themselves only in a specific combination of the browser and the Office application. <br><br>  For the second dispatch, we corrected the technical component and ... were surprised to see a report with such reasons for refusal as a mismatch of the brief description of the application‚Äôs functionality in the store and the lack of understanding of the application‚Äôs tasks in terms of its first page.  For a satellite application, such as Wrike Add-in for Office, this obviousness is not necessary in principle - the target audience is already existing users of Wrike, who understand why we need our add-in for Office.  But you can't argue with the guidelines, so I had to add a few lines about key functions to the login page. <br><br>  It is interesting, by the way, that after a successful publication, any application update that does not require modification of the manifest, in principle, can take place without validation in the store. <br><br>  There were also minor difficulties with the report format itself.  He report is available only in PDF, while the screenshots in it are given in such a resolution that, for example, the text of the error is not visible. <br><br><h3>  Results </h3><br>  From the third time, the validation was completed, and the application appeared in the store.  The collection of feedback from users has just begun, and it is difficult to say something about real efficiency, but the first numbers in the number of downloads are encouraging. <br><br>  We managed to create a rather popular and interesting application that copes with its tasks.  We have already received positive feedback from users who work a lot with different types of documents - copywriters, technical and marketing writers, etc., so there is a feeling that the work has not been done in vain.  We hope that our experience will be useful to other developers who are thinking about creating an add-in for Office 365. </div><p>Source: <a href="https://habr.com/ru/post/279873/">https://habr.com/ru/post/279873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279861/index.html">We suggest the details of the companies according to the Federal Tax Service of the Russian Federation and are looking for a double</a></li>
<li><a href="../279863/index.html">The name of the new Active Directory domain</a></li>
<li><a href="../279867/index.html">Several useful cases when working with arrays in javascript</a></li>
<li><a href="../279869/index.html">Battle of robots on the Hackathon Yandex.Money</a></li>
<li><a href="../279871/index.html">Greentask - a free service to quickly create tasks and facilitate the work with freelancers</a></li>
<li><a href="../279875/index.html">NetApp virtual storage appliance: Data ONTAP-v</a></li>
<li><a href="../279877/index.html">Circle "crazy hands": 4 life hacking about how to rationally fill the server with disks</a></li>
<li><a href="../279879/index.html">Using ClickOnce and Proxy</a></li>
<li><a href="../279881/index.html">Microsoft DevCon 2016 - Introducing the First Wave of Community Track Speakers</a></li>
<li><a href="../279883/index.html">#FailOverConf April 8th! Free, without SMS, but with registration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>