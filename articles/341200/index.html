<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>2.Check Point to the maximum. HTTPS Inspection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous lesson, we touched upon the problem of human factors in Information Security. As a result, we concluded that it does not matter how hi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>2.Check Point to the maximum. HTTPS Inspection</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/hx/mx/ns/hxmxnswenhkd3vumj3t6riu0rbe.png"><br>  In the <a href="https://habrahabr.ru/company/tssolution/blog/334052/">previous lesson,</a> we touched upon the problem of human factors in Information Security.  As a result, we concluded that it does not matter how high-quality and expensive equipment you use, because  everything ‚Äúrests‚Äù in the setting that needs to be done correctly.  In this lesson we will look at the <b>https inspection</b> .  Quite a few underestimate the importance of this feature without which modern network protection is unthinkable.  But first things first. <br><br><h3>  Web traffic protection </h3><br>  Almost all modern NGFW or UTM solutions have the functionality of checking web traffic.  This categorization of sites and verification of downloadable content and the definition of web applications.  And the last item (web applications) is very important, because  A huge number of services can work through the same port.  And if with verification of HTTP traffic almost all vendors have no problems, then HTTPS is a real challenge for modern security tools. <a name="habracut"></a><br><br><h3>  Https </h3><br>  I think that there is not much point in telling what HTTPS is and how important it is for the organization of a secure Internet.  Thanks to HTTPS, you can be sure that it is impossible to intercept or change the transmitted information between the client (browser) and the server (web-server).  According to statistics for 2017, the share of HTTPS traffic exceeded 50%. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/us/na/2i/usna2idqnq-o2qxktplv3-iqfic.png"><br><br>  Moreover, modern browsers (for example, google chrome) will mark http-sites with authorization form as untrusted, and google will lower them in search results.  All this will provoke an even more rapid increase in the proportion of HTTPS traffic. <br><br>  As mentioned earlier, HTTPS is used for secure communication between two nodes on the Internet.  At the same time, HTTPS is not some kind of new protocol; in general, this is plain HTTP, but SSL or TLS is used as a transport protocol to protect traffic.  It is these protocols that are responsible for the authentication, encryption and integrity of the traffic.  We will not consider in detail the work of these protocols, but I highly recommend <a href="https://habrahabr.ru/post/258285/">this article</a> to anyone interested.  In a rough approximation, the work of HTTPS is as follows: <br><br><img src="https://habrastorage.org/webt/d3/ni/yf/d3niyfk6siimbuxgsxtc74r66uk.png"><br><br>  Those.  the client initiates a TLS request to the Web server and receives a TLS response, and also sees a digital certificate, which naturally must be trusted.  An example of a certificate when accessing the site vk.com is shown above.  It contains the secure connection settings and the public key.  In addition, the browser can ‚Äútell‚Äù which version of TLS is being used.  I repeat that this is a very simplified description of how TLS works. <br><br>  After a successful TLS Handshake, data transfer begins in encrypted form.  It would seem that this is very good (the way it is).  However, for the "bezopasnik" in the company is a real headache.  Since he does not ‚Äúsee‚Äù this traffic and cannot check its contents either by antivirus, intrusion prevention system (IPS), or DLP system, nothing ... And this in turn represents a very serious vulnerability.  Since  most sites switch to HTTPS, then without an HTTPS inspection, your Internet gateway cannot check most of the Web traffic (because it is encrypted).  In addition, attackers are increasingly using cloud file storage to spread viruses, which also work over HTTPS.  Thus, no matter how high-quality and expensive your firewall is (whether it is a UTM or NGFW solution), it will skip absolutely all viruses and malware without HTTPS inspection enabled.  Even the notorious test virus EICAR, which is detected by any antivirus, will successfully pass your protection through HTTPS.  We will consider it by example. <br><br><h3>  HTTPS Inspection </h3><br>  The HTTPS inspection technology is designed to solve the problem of security.  Its essence to ugliness is simple.  In fact, the device that organizes the HTTPS inspection performs a <b>man-in-the-middle attack</b> .  It looks something like this: <br><br><img src="https://habrastorage.org/webt/yz/si/_p/yzsi_p2iopp9pklegzysv7i8ejg.png"><br><br>  Those.  Check Point intercepts the user's request, picks up an HTTPS connection with it, and from itself picks up an HTTPS session with the resource the user has accessed.  In this case, the client is presented with a certificate that Check Point has released himself.  Of course, this certificate must be trusted.  To do this, Check Point has the ability to import a certificate from a trusted CA (subordinate certificate).  When importing, make sure that the certificate has a signature algorithm not lower than <b>sha256</b> , since  if it is for example <b>sha1</b> , then modern browsers will ‚Äúswear‚Äù on such certificates.  Or, you can generate a self-signed certificate, which you must then make trusted for all computers.  This is the way we look at an example. <br><br>  Thus, being in the middle between two encrypted connections, Check Point is able to check the traffic and all files, both with the help of antivirus and with other blades (IPS, Threat Emulation, etc.).  You can read more about Check Point HTTPS Inspections <a href="https-inspection/">here</a> . <br><br><h3>  Limitations of HTTPS Inspection </h3><br>  However, not all so simple.  The <b>man-in-the-middle</b> method does not always work.  There are cases when it is simply impossible to decrypt https traffic.  Here are some examples: <br><br>  <b>1) Domestic cryptoalgorithms (GOST) are used instead of standard SSL / TLS.</b> <br>  At the moment, no foreign solution can provide the correct decryption of such HTTPS traffic (although I personally don‚Äôt know any domestic solutions that can do this https inspection).  As a solution, you can configure exceptions in the HTTPS inspection for sites in this category. <br><br>  <b>2) Certificate Pinnig is used.</b> <br>  Those.  The client application knows in advance the certificate of the server to which it is accessing.  Usually, the certificate‚Äôs serial number is checked.  In this case, the application will simply not look into the local trust store, and naturally, an attempt will be made when attempting to spoof.  Most often this problem applies to fat clients (such as Skype, Telegram) that use SSL / TLS as a transport.  In addition, just the other day I discovered that the updated version of google chrome also began to use certificate pinning technology for its services (youtube, google drive, gmail, and so on).  This makes it impossible to use https inspections.  Google is actively concerned about user safety, but it makes life safer for people.  In this case there are two ways out: <br><br><ul><li>  Set exceptions in https inspections for Google services.  I am sure that this is highly undesirable for companies. </li><li>  Use another browser ... For example, Firefox. </li></ul><br>  I am sure that many are interested in the problem of such applications as a telegram, etc.  Unfortunately (or fortunately) at the moment it is not possible to decrypt this traffic.  Either you block these applications, because  at the network level, it is impossible to ‚Äúsee‚Äù this traffic, or use an additional level of protection in the form of some agents on users' computers, for example, the <b>CheckPoint SandBlast Agent</b> , which can check already decrypted traffic for malware (for example, received files via instant messenger). <br><br>  <b>3) Authentication is used not only the server but also the client.</b> <br>  This is typical of websites from the financial services category, when a client uses a special key or token to access any portal portal.  Naturally, in this case, the device that performs the HTTPS inspection will simply not be able to organize the https connection to the server, since  does not possess the necessary key.  The problem is solved only by setting exceptions in the HTTPS inspection. <br><br>  <b>4) A protocol other than SSL / TLS is used.</b> <br>  In this case, it's not about GOST encryption, but about a relatively new protocol from google - <b>quic</b> .  The Google company is beginning to actively transfer its services to this protocol.  At the same time, it is currently impossible to decrypt it.  The only solution in this case is to block the protocol quic, after which google services begin to use standard SSL / TLS. <br><br><h3>  Customization </h3><br>  Describing the setting in text format is quite time consuming, so we made a short video.  The first part describes the above theory, and in the second part we try to download the virus via HTTPS, and then we will configure the HTTPS inspection and compare the result. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kuvjsirrkd0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  Conclusion </h3><br>  The most important thing to take out of this lesson is that the HTTPS inspection is a MANDATORY component of modern security.  Without this feature, your network has a huge black hole in terms of security.  And this applies not only to Check Point, but to all other solutions.  Be sure to test your network in this way.  All that is needed is some kind of test virus and client machine, preferably without an antivirus, so that it cannot block the download of the file (for the purity of the experiment). <br>  This concludes the second lesson, thank you for your attention! <br><br>  PS I would like to thank <a href="https://www.linkedin.com/in/aleksey-b-867b4627/">Alexey Beloglazov</a> for help in preparing the lesson. </div><p>Source: <a href="https://habr.com/ru/post/341200/">https://habr.com/ru/post/341200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341182/index.html">Virtual Infrastructure Provider Development: 1cloud Experience</a></li>
<li><a href="../341192/index.html">Localization of comments in the code. Yandex lecture</a></li>
<li><a href="../341194/index.html">About backups, black friday and communication between people: how we messed up and learned not to do it anymore</a></li>
<li><a href="../341196/index.html">Transfer of tasks and schedules from one instance of MS SQL Server to another using T-SQL</a></li>
<li><a href="../341198/index.html">Some features of programming time events in games</a></li>
<li><a href="../341202/index.html">MockK - library for mocking in Kotlin</a></li>
<li><a href="../341206/index.html">The digest of interesting materials for the mobile developer # 227 (October 23 - October 29)</a></li>
<li><a href="../341208/index.html">Barnes-Hut t-SNE and LargeVis: visualization of large amounts of data</a></li>
<li><a href="../341212/index.html">Hacking Bitcoin on TV: obfuskuy, not obfuskuy, still get QR</a></li>
<li><a href="../341216/index.html">How to create multiple VMFS datastores on a single disk device</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>