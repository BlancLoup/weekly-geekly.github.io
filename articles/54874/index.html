<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Open replacement ati-drivers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The news ‚ÄúAMD stops supporting R300-R500 chips‚Äù and the policy of ati-drivers made me think about switching to a free driver. 
 Therefore, I want to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Open replacement ati-drivers</h1><div class="post__text post__text-html js-mediator-article"> The news <a href="http://www.oslinux.ru/node/330">‚ÄúAMD stops supporting R300-R500 chips‚Äù</a> and the policy of ati-drivers made me think about switching to a free driver. <br>  Therefore, I want to tell you how I did it in gentoo, because on the gentoo-wiki I did not find similar how-to, and in the docs section on gentoo.org, the information requires serious corrections. <br>  After some effort, I managed to get a working system on xf86-video-ati with 3D and compositing. <br><a name="habracut"></a><br>  <b>So, what did not suit me?</b> <br>  1) fglrx makes disable the RCU preemption in the kernel.  And I want to use it, because RCU has a positive effect on system performance and scalability. <br>  2) fglrx conflicts with virtualization going with the kernel, and I would like to play with kvm. <br>  3) fglrx is closed, as a consequence of ‚Äúruntime text relocations‚Äù in its libraries;  and in general, in my opinion, it somehow gets out of the linux ideology, because the driver dictates some of its own conditions. <br>  4) it is also worth noting that fglrx is ‚Äúfriendly‚Äù by no means with all the cores, for example, it often ‚Äúlags behind‚Äù the latest versions. <br><br>  <b>What do we have?</b> <br>  Device: Radeon X850 PRO (R480) (PCIE) <br>  Gentoo Linux ~ amd64 <br><br>  It‚Äôs just to change head-to-head to change to xorg.conf fglrx with ati, remove the necessary modules and make eselect opengl set xorg-x11 not successful.  Need more fine-tuning X + as it turned out, the latest versions of libraries x11. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>What needs to be done to make it work?</b> <br>  <u>1) /etc/make.conf</u> <br> <code>USE="... dri xcomposite ... " <br> VIDEO_CARDS="radeon" <br></code> <br>  In the kernel we assemble (built-in or modular) agpgart and DRM -&gt; Radeon (for example) <br><br>  <u>2) then</u> through layman (if not installed, then emerge layman), <u>turn on x11 overlay:</u> <br> <code>layman -a x11 <br></code> <br>  and unmask the packages: <br> <code>ln -s /usr/portage/layman/x11/profiles/package.mask /etc/portage/package.unmask/x11 <br></code> <br>  after which we do: <br> <code>emerge -uDN world <br></code> <br>  However, it is worth noting that the builds from this overlay are not exactly perfect. <br>  I, for example, did not want to pack a pixman package. <br>  Therefore, such non-critical packages can be excluded from <br>  /etc/portage/package.unmask/x11 <br>  Although with the help of a crutch I put it exactly pixman-9999 (to whom I can be interested to tell how, but in general it is not essential, for everything works with the old version of pixman). <br>  This is perhaps the only negative point that I met, and I think <br>  these are temporary ebuild issues that will be fixed in the near future. <br>  So, the system is assembled, it is time to tune xorg. <br><br>  <u>3) xorg.conf</u> <br> <code>Section "ServerFlags" <br> Option "AllowMouseOpenFail" "true" <br> Option "IgnoreABI" "on" <br> Option "AIGLX" "true" <br> EndSection <br> <br> Section "Module" <br> Load "glx" <br> Load "extmod" <br> Load "dbe" <br> Load "freetype" <br> Load "dri" <br> Load "drm" <br> Load "ddc" <br> Load "vbe" <br> EndSection <br> <br> Section "Device" <br> BoardName "Radeon X850 PRO (R480) (PCIE)" <br> Driver "ati" <br> Identifier "Device[0]" <br> Screen 0 <br> VendorName "ATI" <br> Option "XAANoOffscreenPixmaps" "true" <br> Option "ColorTiling" "on" <br> Option "AccelMethod" "EXA" <br> Option "DMAForXv" "true" <br> Option "EnablePageFlip" "on" <br> #Option "AGPFastWrite" "yes" <br> Option "DynamicClocks" "on" <br> EndSection <br> <br> Section "DRI" <br> Mode 0666 <br> EndSection <br> <br> Section "Extensions" <br> Option "Composite" "true" <br> Option "DAMAGE" "true" <br> Option "RENDER" "true" <br> EndSection <br> <br></code> <br>  If you have not yet removed ati-drivers, then do <br> <code>eselect opengl set xorg-x11 <br></code> <br><br>  Run X's and enjoy the working driver!  :) <br>  <i>glxinfo:</i> <br> <code>name of display: :0.0 <br> display: :0 screen: 0 <br> direct rendering: Yes <br></code> <br>  <i>/var/log/Xorg.0.log:</i> <br> <code>(**) AIGLX enabled <br> (II) AIGLX: enabled GLX_MESA_copy_sub_buffer <br> (II) AIGLX: enabled GLX_SGI_make_current_read <br> (II) AIGLX: enabled GLX_SGI_swap_control and GLX_MESA_swap_control <br> (II) AIGLX: enabled GLX_texture_from_pixmap with driver support <br> (II) AIGLX: Loaded and initialized /usr/lib64/dri/r300_dri.so <br> ... <br> (II) Loading extension XFree86-DRI <br> (II) Loading extension DRI2 <br> (II) RADEON(0): [dri] Found DRI library version 1.3.0 and kernel module version1.29.0 <br> (II) RADEON(0): [DRI] installation complete <br></code> <br>  <i>glxgears:</i> <br> <code>23590 frames in 5.0 seconds = 4717.968 FPS <br></code> <br>  In conclusion, I note that yes, the number of fps is slightly worse than in the drivers from amd, but this card + open-source driver can do quite well with the tasks that I need. <br>  Yes, and xf86-video-ati will develop further, and support for my card with ati-drivers will stop. <br>  So I have already made my choice towards fully open source software. </div><p>Source: <a href="https://habr.com/ru/post/54874/">https://habr.com/ru/post/54874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../54864/index.html">Tunto - wooden led lamp</a></li>
<li><a href="../54865/index.html">Startup Syndicate</a></li>
<li><a href="../54866/index.html">ASP.NET MVC 1.0 released</a></li>
<li><a href="../54870/index.html">Writing texts for websites: do not overdry, do not oversalt</a></li>
<li><a href="../54871/index.html">The Microsoft Business Start program. 3rd year. Or "41 start-up companies have just received a grant!"</a></li>
<li><a href="../54878/index.html">Silverlight Development on Mac</a></li>
<li><a href="../54879/index.html">Registration for KIBORIF is open.</a></li>
<li><a href="../54880/index.html">VSTO and CAB: Integrating .NET applications in Microsoft Word</a></li>
<li><a href="../54881/index.html">Project Idea Generator</a></li>
<li><a href="../54882/index.html">Do you model classes (UML) before you start developing? (PHP only please!)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>