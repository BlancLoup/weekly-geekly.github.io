<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we taught self-help cash desks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our company has been engaged in self-service cash registers for about two years, and we have followed this path iteratively. In one of my previous pos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we taught self-help cash desks</h1><div class="post__text post__text-html js-mediator-article">  Our company has been engaged in self-service cash registers for about two years, and we have followed this path iteratively.  In <a href="https://habr.com/company/crystal_service/blog/236811/">one of my previous posts,</a> I told you what difficulties arose during our first launches of two stores in Kaliningrad.  At the same time, both there and in several subsequent stores, we established cash desks that accept payment only by credit card.  This solution had advantages both for us (such a solution was faster to launch) and for stores (they were able to divide the flow of customers according to the type of payment).  But we understood that sooner or later we would have to take up the connection of the cash module to the self-service checkout.  Everyone who is interested to know how it was, welcome under the cat. <br><br><img src="https://habrastorage.org/files/20d/8a0/2cd/20d8a02cd1f54f9c9bc1905a16f53022.jpg"><br><a name="habracut"></a><br>  The main complex for accepting cash for cash desks of the Swedish company ITAB, under which we are developing, is the complex of the Japanese company Glory with the pathetic name Cash Infinity 10. <br><br><img src="https://habrastorage.org/files/f4a/e97/007/f4ae9700764a44caa3c621dcdb114d05.png"><br>  It consists of two separate devices - banknotes and coin acceptors connected to the controller. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The coin acceptor</b> is a device with points of input and output of coins, a conveyor, a validator and 8 identical coin boxes.  After the coin is accepted, it is delivered to the validator by the conveyor, which determines its denomination and sends it to the corresponding coin box.  If the denomination is not determined, the coin is returned through the point of withdrawal of coins.  Similarly, any garbage is returned - paper clips, keys.  The coins themselves can be safely deposited in a handful - the coin acceptor quite calmly processes a large number of coins of different denominations.  Coins operate on both input and output, respectively, the delivery is issued to the buyer by the same coins that previous buyers made to the cashier. <br><br>  <b>Bill acceptor</b> is arranged differently.  A bill is a thin piece of paper, and if it is folded somewhere, then it will not be possible to pick it up, which means it is more difficult to implement the input / output system for bills.  More difficult, but possible.  To do this, special drums are placed in the bill acceptor: the recognized bill is wound on such a drum and can be removed in the same way for delivery.  The only problem is that the space in the device is limited, so there are only 3 reels in it, on which it is logical to install the most popular notes.  All other bills (as well as running bills in case of overflow of the corresponding drum) get into the cassette, which the employee at any time can withdraw in closed form and deposit all its contents into the main cash register. <br><br>  We had to connect to the <b>controller</b> : it combines the work of two independent devices, through its API it receives commands from external systems (in our case from the self-service cash desk) and returns the statuses of the requested operations, as well as its current state.  It sounds quite understandable, and at some point I personally even thought that connecting one unit, which was responsible for all the work with cash, should not be much more difficult than connecting a bank terminal.  Of course, it was just an illusion, and at the very beginning of our work we faced a number of big tasks: <br><br><h2>  1. Buyer interface for payment </h2><br>  The tip of the iceberg (and as it turned out later, one of the most understandable tasks) was to create a customer interface for receiving cash.  Choosing cash as a payment method transfers devices from sleep mode (IDLE) to cash reception mode (WAIT INTSERTATION), information on all entered face values ‚Äã‚Äãis transmitted to our cash program. <br><br><img src="https://habrastorage.org/files/ba0/523/6cd/ba05236cd55a401bb78e213d62e4f3c6.png"><br><br>  We faced a difficulty - at the moment when the amount paid was greater than the amount of the check, we could not send a change issue command for the required amount: there is simply no such command in the API.  This is done because the processing of the deposited banknote and its transfer to the external system is a long process, which means that at the moment when the external system has learned about the sufficiency of the amount, part of the bills or coins can still be processed.  Accordingly, we send the CASH REQUEST command to the controller, which tells the controller that when all the bills have been entered and processed, it will be possible to proceed to issue the change.  And the controller itself returns us the WAIT FOR CHANGE event, after which we show the delivery screen. <br><br><img src="https://habrastorage.org/files/80f/8de/cd0/80f8decd088e439bafc3ddf558a6f793.png"><br><br><h2>  2. Setting capacities for all denominations </h2><br>  With coins, everything seems simple: 8 containers, and just 8 coins of value in the course.  True, Glory does not accept the penny, as it does not accept large 10-ruble coins.  The remaining capacity can either be given under one of the running values, or give it under the excess coins.  We chose the second option.  The surplus or mixer collects coins of different denominations in case of overflow of their containers.  For notes, everything is a little simpler: it was necessary to choose which 3 values ‚Äã‚Äãto place on the reels.  After consulting with a client, we chose banknotes of 50, 100, and 500 rubles.  Accordingly, the cash register does not give a change in the thousandth bills. <br><br>  One of the key questions of customization: at what values ‚Äã‚Äãto block payment in cash at the self-service checkout?  I don‚Äôt want to allow a situation where we once again send the CASH REQUEST command to the controller, but it will not be able to issue a change due to the lack of the necessary nominal values.  I didn‚Äôt want to block the payment much in advance, but I didn‚Äôt even want to approach very close to the problem situation.  As a result, due to fears and a simpler implementation, we chose a more advanced solution: cash payment is blocked if at least one nominal is no longer able to give a change when you make the next one by value.  That is, if the 500-ruble bills on the drum remain less than 9 (that is exactly how many bills will be required to issue change on a small purchase when making a five-thousandth note) or 100-ruble bills will be less than 4, then cash payment will automatically be blocked and the buyer will be notified about it on the start screen and on the screen for choosing payment methods. <br><br><img src="https://habrastorage.org/files/43d/e57/83b/43de5783b1ca4144b4e15cb61adda958.png"><br><br><img src="https://habrastorage.org/files/106/63a/844/10663a844f1e4367816303fd7fb20543.png"><br><br>  In addition, cash payment is automatically blocked when approaching overflow of a cassette with cash or excess coins. <br><br><h2>  3. Indication of a shortage or excess of bills and coins </h2><br>  The task of the display system is to notify the store employee of the upcoming problem situation.  We have two notification mechanisms: a flashlight above the cashier and the status of cash at the cashier in the interface of the store employee.  The logic is this: as soon as the assistant sees that the lamp starts flashing green between purchases at the checkout, you need to check the status of cash.  He can look at more detailed information in a mode of work with cash. <br><br><img src="https://habrastorage.org/files/b0c/432/282/b0c432282a184a09aa855897e489c7ea.png"><br><br>  In the status indication system, those that do not require attention are displayed in gray, close to the problem state - pink, and critical ones (as a result of which cash payments will be blocked) - red.  It seems that the traffic light with green, yellow and red states was asking for it, but in this motley combination it is more difficult to isolate something most significant. <br><br>  Color depends on the type of container.  For example, the overflow of the coin box is bad, because now all the coins will pour in the excess, and its capacity is quite small.  Therefore, the 10-ruble coin box is highlighted in pink.  Overflow drum opposite - a very good situation, because there is something to give change.  Yes, the extra bills will be sent to the cassette, but the capacity of the cassette is sufficient to hold them. <br><br>  There were a lot of private questions when setting the border: for example, at what volume of a cassette should it be highlighted in pink?  After several brainstorming sessions, we set this value to 75 percent.  Accordingly, at the same time, the flashlight above the cash register begins to flash.  Similar decisions were required to take on all the containers for bills and coins. <br><br><h2>  4. A huge block of work with cash discipline </h2><br>  The introduction and withdrawal of the listed features of the equipment turned out to be not at all simple tasks.  Even in spite of the fact that in all cash decisions of our company, deposit and withdrawal are present, here many of the principles had to be almost completely rethought. <br><br>  With the introduction of everything as a whole is quite clear: after entering the mode of depositing, the bill and coin acceptors are ready to accept cash.  The denominations of all bills and coins made are displayed next to the respective containers.  And after everything is entered, the employee must click "Complete the deposit" by conducting this transaction through the fiscal registrar, which will print the deposit document. <br><br><img src="https://habrastorage.org/files/fef/f07/c06/feff07c06f524546a223a7f6e87a5dab.png"><br><br>  There are few features, but they exist: depositing thousands and five thousand bills does not make any sense - these bills will fall into a cassette that cannot be issued to the buyer.  So for this situation requires a separate display. <br><br><img src="https://habrastorage.org/files/ded/e5d/da0/dede5dda08754ce9b12977ea5098ec52.png"><br><br>  It is clear that most likely the employee will not make such denominations, but there may be another situation: one of the drums overflowed and all the bills from it begin to fall into the cassette.  And in this case, it is just very useful - the employee immediately sees that there is no longer any sense to contribute this denomination.  The situation is similar with the surplus of coins. <br><br>  With the withdrawal had to tinker.  Withdrawals can be of 4 types (which, in principle, can not be on a regular box office): <br><ul><li>  withdrawal of coins of a certain value </li><li>  seizure of excess coins </li><li>  taking notes from the drums </li><li>  withdrawal of a cassette with notes </li></ul><br><br><img src="https://habrastorage.org/files/37c/231/c9c/37c231c9c8664a3fb033adef8602c131.png"><br><br>  For each of them was required to implement different behaviors. <br><ul><li>  When withdrawing coins from one of the coin boxes, the withdrawal amount is a multiple of the nominal value. </li><li>  The surplus of coins is withdrawn only as a whole, it is simply not possible to withdraw part of the coins of a certain amount, because all the coins in it are mixed </li></ul><br>  Money from coin boxes are not returned immediately, but after pressing the button ‚ÄúComplete withdrawal‚Äù.  At the same time, an exemption document is printed. <br><br><ul><li>  For banknotes, as well as for coins, the withdrawal amount that is a multiple of the nominal value on the drum is selected, but after consultations we decided not to issue this amount through a bill acceptor, but to send it to the cassette.  Accordingly, the withdrawal document in this case is not printed, because the money remained on hand. </li><li>  When removing the cassette, almost the entire sequence of actions is given by the manufacturer.  We send a command to withdraw the cassette, the door that locks it is unlocked in the bill acceptor.  The employee opens the door, takes out the tape.  He is obliged to insert back an empty cassette, otherwise the controller will return to the initial IDLE state, but it will not return the cassette inventory event.  Accordingly, our cash register module will not be able to print a withdrawal document, will not be able to find out the status of the cassette, so in this case we decided to block the payment in cash and ask you to insert an empty cassette.  This is reasonable, because he absolutely will not be able to find out what amount remained in the cassette after withdrawal. </li></ul><br>  The choice in the case of withdrawal of the cassette was only at what point to print the document of withdrawal.  Initially, we decided to print it at the time of installation of the empty cassette back, but after analyzing the store's processes, we began to print the document immediately after removing the cassette.  The reason is that the document remains in the main box office after making money in it.  The main cash desk is far from the self-cash cash desks, and the staff had to run 2 times: first with money, then with a document.  We simply optimized their work. <br><br><h2>  5. Handling erroneous situations </h2><br>  There were so many erroneous and borderline situations that it was a bit wrong to single out all this titanic work into just one point.  I will cite just a few questions that I had to answer both to developers and testers, and to me as an interface designer. <br><ul><li>  How will the coin jams / jams be handled?  How will the cash register behave in customer mode and assistant mode? </li><li>  What will happen if, after the assistant has clicked ‚ÄúComplete the deposit‚Äù, he will throw some more coins into the receiver? </li><li>  Lack of kopecks leaves its mark: what to do in a situation if the total amount turned out to be pennies (for example, if the discount on rounding a check did not work)? </li><li>  The controller itself can be far from only in the states IDLE, WAIT INSERTATION and WAIT FOR CHANGE.  The states change from each action: there is a COUNTING that turns on at the time of counting the money made, there is a CALCULATING CHANGE AMOUNT - it turns on for a fraction of a second at the time of counting the change, there is a DISPENSING that turns on at any time of issuing money.  It goes without saying that the ERROR state contains the details of the error that occurred.  And there are exactly 30 such states in total, and in each of them their functions become accessible or inaccessible.  All this must not only be programmed, but also tested. </li></ul><br><br>  Well, now it's time to talk about the main thing: the best characteristic of the work done is not its description, but the fact that the result is used and performs its function. <br><br>  Exactly one month ago we launched an island of self-service from 4 cash desks with a cash acceptance module in one of the shops of the Gallery shopping complex in St. Petersburg. <br><br><img src="https://habrastorage.org/files/eec/170/39a/eec17039a490490285b89fc3824bd46d.JPG"><br><br><img src="https://habrastorage.org/files/155/e09/1bb/155e091bb9084c99a87f6eb83adeb2a7.JPG"><br><br><img src="https://habrastorage.org/files/5e8/254/02e/5e825402e4e646cbb8b5844283fd3aec.JPG"><br><br>  Without undue modesty, I would say that the launch was a great success.  Buyers perceived the novelty with interest.  Already in the first week of the self-checkout, a decent percentage of buyers took over.  But we are not stopping - there are many ideas in the plans for improving and optimizing the work of cash registers. <br><br>  It is better to see once, and even better - to try.  Come to Petersburg and evaluate our decision. <br><br>  I wish all the developers to be diligent and attentive to important trifles.  Remember that first of all, both iron and the interface should help users. </div><p>Source: <a href="https://habr.com/ru/post/258889/">https://habr.com/ru/post/258889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258873/index.html">Context capture by closures instead of delegation in iOS 8 Swift</a></li>
<li><a href="../258875/index.html">Krasnoyarsk Dev2Dev 2.0 Developer Conference</a></li>
<li><a href="../258881/index.html">iSCSI 2.0 with FAS2xxx or the scaling path of a small data center</a></li>
<li><a href="../258883/index.html">MotoPress Review: Reinventing the Standard WordPress Text Editor</a></li>
<li><a href="../258885/index.html">Why a designer and developer should work together</a></li>
<li><a href="../258891/index.html">Mastering Composer: Tips and Tricks for Using</a></li>
<li><a href="../258893/index.html">Simple cryptography: frequency and differential cryptanalysis in the task NeoQUEST-2015</a></li>
<li><a href="../258895/index.html">Video with DevConf 2014 :: PHP Cob @ cniki against kinofobov</a></li>
<li><a href="../258897/index.html">Automaton like a jet engine: real physics of unreal flight</a></li>
<li><a href="../258901/index.html">Universal soldier: how we developed and implemented an adaptive portal menu for all Mail.Ru projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>