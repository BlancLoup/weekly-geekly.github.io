<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Puzzle game from scratch on ASP.NET Core 2, let's play?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern web frameworks are mainly used for writing corporate applications, but they have long been quite flexible and functional for other areas. Let's...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Puzzle game from scratch on ASP.NET Core 2, let's play?</h1><div class="post__text post__text-html js-mediator-article">  Modern web frameworks are mainly used for writing corporate applications, but they have long been quite flexible and functional for other areas.  Let's try to write a logical casual game on ASP.NET Core 2. Consider the process of creating a game project, as well as innovations of the framework and related tools. <br><br>  <a href="http://therooms.azurewebsites.net/">DEMO</a> <br>  <a href="https://github.com/gbdrm/TheRooms">Sources</a> <br><a name="habracut"></a><br><h3>  Idea </h3><br>  As described above: the game is logical and casual, that is, no super graphics and complex elements.  Our game world consists of many rooms, in each of them we are waiting for a special task, after which you can go to the next room.  Accordingly, between the rooms there are doors that need to be opened in order to move from one room to another.  In general, everything.  Each task is a logical puzzle or some kind of interactive element. <br><br><h2>  Implementation </h2><br><h3>  Create a project </h3><br>  The latest version of ASP.NET Core was released quite recently (in mid-August), so if you are interested in following the path of creating a project from scratch, do not forget to update at least .NET Core ( <a href="https://www.microsoft.com/net/download/core">http://dot.net</a> ). <br>  To create a project, you can use it as an IDE (Visual Studio, Visual Studio for Mac, Rider).  In the last Visual Studio update, the new web application creation dialog has been slightly reworked: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/ee9/494/991/ee94949919bb4ee0a6ff3735d9008b6e.png"><br><br>  Or you can create a project in a regular console: <br><br><img src="https://habrastorage.org/web/314/d6b/97f/314d6b97fdbc4797857dcf063305c849.png"><br><br>  and open it in that editor that you like. <br><br>  From the console, you can now also select a project template and, for example, add authorization: <br><br><img src="https://habrastorage.org/web/498/bdf/dab/498bdfdab9a34c3899dd8e79dbff69e3.png"><br><br>  Let's create a normal empty application without authorization. <br><br> <code>dotnet new web</code> <br>  And open it in Visual Studio (or your favorite editor).  If you look at the structure of the project <br><br><img src="https://habrastorage.org/web/2a2/33b/095/2a233b095f83445d94668c0e8eed3572.png"><br><br>  then you can see that instead of a heap of standard nuget packages, now only one has been added - Microsoft.AspNetCore.All, which is a kind of container for everything.  This is very convenient during development, as there is no need to constantly check whether the package that we need is connected, look for what it is called today, etc. <br><br>  If you run the project, the result will be the phrase ‚ÄúHello World!‚Äù In the browser. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/1897d49ef8bce953d91a533c303a64f815f51209">GitHub Check-point 0</a> <br><br><h3>  Customize MVC </h3><br>  Most ASP.NET projects are written using the ASP.NET MVC library set, as they add considerable development flexibility.  To begin with, we add the Controllers folder to the project and try to add a new controller from the context menu. <br><br><img src="https://habrastorage.org/web/a31/f15/31f/a31f1531f8ca436a8e03951530b0df3c.png"><br><br>  Unlike previous versions, now when you first add a controller, a dialog appears: <br><br><img src="https://habrastorage.org/web/958/c3c/966/958c3c96663140a7bfa70d1fab59f947.png"><br><br>  Since we first tried to add an element by pattern (scaffold), Visual Studio suggests that we customize templating.  Choose minimal dependencies in order to better control what happens to the code.  After automatic configuration of the template, we are told how to add MVC to the project.  Use the hint and modify the class Startup.cs <br>  <a href="https://github.com/gbdrm/TheRooms/commit/0af2f3375d7aa8a4ff6fcb2b719db08c730fffa8">GitHub Check-point 1</a> <br><br>  When launching the project, we get 404 in response, because the default route looks for the Home controller and the Index method inside it.  Add a start page by creating a Home controller and a view in the new Views folder. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/27d8da783794f9b87603fb90a6c926ff912cc6ad">GitHub Check-Point 2</a> <br><br><h3>  Add a database </h3><br>  As mentioned above: the structural units of our game are rooms.  Add a class that will be responsible for providing data about the room.  To begin, we limit ourselves to the following data: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TheRooms.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Room</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Task { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Answer { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [InverseProperty(<span class="hljs-string"><span class="hljs-string">"RoomTo"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICollection&lt;Door&gt; DoorsIn { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [InverseProperty(<span class="hljs-string"><span class="hljs-string">"RoomFrom"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICollection&lt;Door&gt; DoorsOut { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><br>  To go between rooms we will describe the class door: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TheRooms.Models</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Door</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [ForeignKey(<span class="hljs-string"><span class="hljs-string">"RoomFrom"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RoomFromId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Room RoomFrom { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [ForeignKey(<span class="hljs-string"><span class="hljs-string">"RoomTo"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RoomToId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Room RoomTo { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br>  In the Door class, we use ForeignKey attributes that suggest dependencies between doors and rooms.  In the Room class, InverseProperty attributes are added, which also show to which property of another entity this collection belongs.  InverseProperty is needed only in the case of several ‚Äúsimilar‚Äù relationships (in this case, the room has two types of doors - to enter the room and to exit). <br>  <a href="https://github.com/gbdrm/TheRooms/commit/8368fb81c3afb4952a68122712e6fc1b6cc40369">GitHub Check-Point 3</a> <br><br>  To work with the database, try the Entity Framework Core.  To do this, we need to add <b>a data context</b> (the connection between the code and the database). <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.EntityFrameworkCore; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> TheRooms.Models; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TheRooms.Data</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataContext</span></span> : <span class="hljs-title"><span class="hljs-title">DbContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Room&gt; Rooms { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Door&gt; Doors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DbContextOptions&lt;DataContext&gt; options</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnModelCreating</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnModelCreating(builder); <span class="hljs-comment"><span class="hljs-comment">// disable cascade delete foreach (var relationship in builder.Model.GetEntityTypes().SelectMany(e =&gt; e.GetForeignKeys())) { relationship.DeleteBehavior = DeleteBehavior.Restrict; } } } }</span></span></code> </pre><br>  And also <b>add the settings file</b> with the database connection string and link it with the context in the ConfigureServices method. <br><br><pre> <code class="cs hljs">services.AddDbContext&lt;DataContext&gt;(options =&gt; options.UseSqlServer(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>)));</code> </pre><br>  <a href="https://github.com/gbdrm/TheRooms/commit/dc64b575e88e6d9965f3bb0ebb8ffb0c033d1ae9">GitHub Check-Point 4</a> <br><br>  The next step is to <b>create the base itself</b> from the classes that we described above.  To do this, you need to run 2 commands in the Package Manger Console: <br><br> <code>Add-Migration Initial <br> Update-Database <br></code> <br><br>  The first command will add code to migrate the database from the previous state (when it did not exist) to the last state (where we have 2 tables - Rooms and Doors).  Accordingly, the second team will update the database using migration scripts. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/903c80a7a7e7e7cefc689c484d93f69ddd723ecb">GitHub Check-Point 5</a> <br>  The database is ready. <br><br><h3>  Show room </h3><br>  In order to show the room, it is necessary that the controller draws the details of the room from the base and transfers them to the presentation.  Let's start with the controller.  Let's create a new class - RoomsController with a method that will retrieve the necessary data and send it to the browser. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Show</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> room = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _context.Rooms.SingleAsync(r =&gt; r.Id == id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(room); }</code> </pre><br>  <a href="https://github.com/gbdrm/TheRooms/commit/16cd58e55ef94002b9f393f4bf73c441ff47cd5a">GitHub Check-Point 6</a> <br><br>  But in order to enter the room, you must first create it.  Add controllers to control rooms and doors using a template engine (scaffolding): <br><br><img src="https://habrastorage.org/web/8d0/41b/3cf/8d041b3cf168479fb9943c1145761d36.png"><br><br><img src="https://habrastorage.org/web/ac1/23e/fd3/ac123efd3e104d4792ac0c1c8e1bc9b4.png"><br><br>  <a href="https://github.com/gbdrm/TheRooms/commit/59110a04a38dca34c5f5bd8679a01dfa9c210865">GitHub Check-Point 7</a> <br><br>  Add styles, buttons, labels. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/1f954272d2b5e0d3c58e4a59e26e635a68724392">GitHub Check-point 8</a> <br><br>  We have a prototype ready, now we need to fill it with life. <br><br><h3>  Describe the players </h3><br>  Each user of our site must be uniquely identified.  For example, in order to know who has already passed which rooms and can move on.  In order to memorize players, create a Player class and add a unique identifier in the Cookies for each player.  To him in addition, add the essence of CompletedRooms, where we will store information about already completed rooms. <br><br>  In order for these classes to be used, they also need to be added to the data context and add migration to our database. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/42d2143ac38052fce5c7ab9ca03a3275548d8279">GitHub Check-point 8</a> <br><br>  Add logic to validate the user. <br>  <a href="https://github.com/gbdrm/TheRooms/commit/af0560518f06f278666b935af23721dea49f26c7">GitHub Check-point 9</a> <br><br>  Well, a few little things to make it all look not really scary.  The first version of the game is ready.  Unfortunately you can not rob korovanov yet. <br><br><h3>  findings </h3><br>  As expected, ASP.NET Core 2 did an excellent job with the task.  Of course, it is difficult to call a full-fledged game, and I want to check the possibilities of interactivity and real-time interactions.  But it seems that modern web frameworks are already very close to the line where the subject matter of the project is not so important.  You may notice that with new versions of Visual Studio, during development, more and more dialogs appear that automatically generate code.  Already, it is used to create a project, set up a template engine, and automatically create an admin panel.  This approach may evolve more <s>and</s> more with time <s>and it will be possible to code it with a mouse</s> . <br><br>  <a href="http://therooms.azurewebsites.net/">DEMO</a> <br>  <a href="https://github.com/gbdrm/TheRooms">Sources</a> </div><p>Source: <a href="https://habr.com/ru/post/336590/">https://habr.com/ru/post/336590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336578/index.html">Cryptoalgorithms. Classification in terms of the number of keys</a></li>
<li><a href="../336580/index.html">Metasloy: ideas about applying prediction to optimize programming and resource allocation in the OS</a></li>
<li><a href="../336584/index.html">Using the Chrome profiler frontend in your own projects</a></li>
<li><a href="../336586/index.html">Analysis of MS SQL Server, for those who see it for the first time (part 2)</a></li>
<li><a href="../336588/index.html">Inkscape: ms_meme and holiday tree</a></li>
<li><a href="../336592/index.html">Android Oreo bites off a piece of PWA</a></li>
<li><a href="../336594/index.html">Face segmentation on a selfie without neural networks</a></li>
<li><a href="../336596/index.html">Useful tricks when working with netcat</a></li>
<li><a href="../336598/index.html">Non-standard approach to the construction of a modern programming language</a></li>
<li><a href="../336600/index.html">Development at a speed of 450 words per minute</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>