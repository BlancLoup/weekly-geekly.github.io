<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Voluntary limits for cloud servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="News one paragraph: the opportunity to ask yourself the limits of performance. Limited by CPU, RAM and outgoing traffic. 
 It looks like this: 


 Do ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Voluntary limits for cloud servers</h1><div class="post__text post__text-html js-mediator-article">  News one paragraph: the opportunity to ask yourself the limits of performance.  Limited by CPU, RAM and outgoing traffic. <br>  It looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/a65/93f/0ea/a6593f0ea070d643d2d281bc523cd207.png" alt="cap_forced" width="540" height="186"><br><br><h1>  Do not like fast?  You can slowly! </h1><br>  We brought to the control panel the opportunity to set limits on resource consumption to ourselves.  These default settings for all virtual machines are set to "not limit", which does not differ from the behavior previously. <br><a name="habracut"></a><br>  The scope of these settings (in addition to ‚Äúplay around‚Äù) is the study of new software or the launch of applications, the adequacy of which you doubt.  You need to understand that if the program needs to perform 100,500 operations to complete it, then it will execute them.  That with a speed of 500 operations per second, that with a speed of 100 operations per second.  The only question is how quickly this one will do it. <br><br>  Similarly for traffic.  If the server decided to give a 100,500 MB file, then it will give it away.  Either at a speed of 900Mb / s, or at a speed of 1Mb / s - only time will differ. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ... Including the reaction time of a person to a sudden and "wrong" load.  It's one thing when a mad program eats 800% of the CPU and clogs the Internet channel into the ceiling, another thing when the ceiling is 20% CPU and a couple of megabits. <br><br>  In other words, the settings, I hope, will be useful to someone. <br><br>  What do the limits look like in practice? <br><br><h1>  CPU </h1><br>  (technical part of the patter): the cap parameter of the credit-based Xen skadjule allows you to specify the limit within which the domain can be scheduled for execution. <br><br>  The same, but with the arrangement: The hypervisor allows you to limit the virtual machine to the time during which it is executed.  If the virtual machine "managed" to do everything before the expiration of the limit, then it "gives" the rest of the time to the hypervisor and the limit, thus, it is not noticeable.  If the virtual machine reaches the limit, the hypervisor forcibly "takes" control from the virtual machine and does not give up until the beginning of the next interval.  The intervals themselves are short - 10 ms. <br><br>  From the point of view of the virtual machine, this limit looks like steal time.  Note that since we charge for the actual time during which the virtual machine used the processor, the steal time is not paid. <br><br>  What does this look like? <br><br>  This is how the system load in top with the set limit of 10% looks like when cpuburn is running (money burning utility): <br><img src="https://habrastorage.org/getpro/habr/post_images/a30/03a/3cc/a3003a3cc7ac8e25cf643a9f7ba1f4b4.png" alt="cpu_cap" width="560" height="188"><br>  It seems that it took 90% of the CPU.  In fact - 9%.  Another one percent is occupied by system processes.  Note, if you look, the stale (top right) - 80%. <br><br>  Here is the same, but in terms of htop: <br><img src="https://habrastorage.org/getpro/habr/post_images/ea0/b05/a11/ea0b05a113f9b0353d3cb39cb5fc0e53.png" alt="cpu_cap_htop" width="565" height="181"><br><br>  And atop: <br><img src="https://habrastorage.org/getpro/habr/post_images/f27/13c/adb/f2713cadb6c83bb37b343176bef77b3f.png" alt="cpu_cap_atop" width="636" height="232"><br><br>  Note, atop in this sense is the smartest of all - it clearly shows that the server is ‚Äúnot getting enough‚Äù of CPU time. <br><br>  Note about steal: the value of 1% on the CPU (i.e. up to 8% for 8 cores) is normal for unlimited virtual machines - processing requests for IO and network activity at the time of data transfer to dom0 blocks the virtual machine in a state similar to on steal, if it is more than 10-15%, then your virtual machine does not have enough CPU time.  Applies to all hosting on Xen'e - and rackspace, and Amazon. <br><br>  By itself, the parameter allows you to limit up to 1% of the CPU, but even by 10% the machine becomes somewhat thoughtful, so we limited the control panel to 5%, otherwise the user risks not waiting for the download to complete. <br><br><h1>  Outbound traffic </h1><br>  (technical patter) The qos_ratelimit_kpbs parameter for netback allows you to limit the speed of data transferred from a domain. <br><br>  Here is the 4 Mbit / s limit on the interface: <br><img src="https://habrastorage.org/getpro/habr/post_images/7a0/329/2d0/7a03292d0e06a3243b50eb02c04a83c7.png" alt="ratelimit" width="646" height="121"><br><br>  Human description: the para-virtualized network device in Hen consists of two halves.  One - netfront, is in the virtual machine.  The second half, netback, is in dom0.  When traffic arrives addressed to a virtual machine, it is transmitted through a rather cunning mechanism for transferring pages between domains (also called zero copy) to a virtual machine.  The reverse process is similar. <br><br>  It is important that this process (like everything in xen'e) is cooperative, that is, you need to simultaneously send ‚Äúdesire‚Äù on the one hand, and desire to ‚Äúaccept‚Äù on the other.  If the receiving party does not want to receive data, then the ring buffer (a special data structure that resides in shared memory between the domains and is used to coordinate the work of the components) simply overflows.  Since it is a ‚Äúring‚Äù, the sender has no options for action - either he waits for the recipient to read the data (and moves the pointers in the ring buffer), or he will erase the data about what data to send. <br><br>  Thus, the recipient has the ability to limit the speed of data reception - just ‚Äúslower to read‚Äù is sufficient. <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/8dc/b93/fe2/8dcb93fe2634ff141523eb42193e11ea.png" alt="limits" width="285" height="317">  This is exactly what the netback (half the driver in dom0) does when the limit option is set.  It just reads the data from the network adapter of the virtual machine more slowly. <br><br>  The question arises: what about the incoming traffic? <br><br>  The situation here is completely different: the traffic has already been sent.  We can either drop it or pass it on.  If we did not have time to transmit, then the traffic is dropped (otherwise, it will begin to accumulate, clogging the RAM).  It is not possible to limit it by speed, you can only discarding the excess.  And this is fraught with significant degradation of the quality of the network. </div><p>Source: <a href="https://habr.com/ru/post/159193/">https://habr.com/ru/post/159193/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159177/index.html">Wheel speed counter squirrel</a></li>
<li><a href="../159179/index.html">Banned google</a></li>
<li><a href="../159183/index.html">A copyright harm report was removed from the site of one of the US Congress committees one day after publication.</a></li>
<li><a href="../159187/index.html">Google wants to be a wireless internet provider</a></li>
<li><a href="../159189/index.html">How do you set element styles if you do not use ‚Äúforeign‚Äù libraries</a></li>
<li><a href="../159199/index.html">How do you feel about open source software?</a></li>
<li><a href="../159201/index.html">NODE.JS + Windows: look inside</a></li>
<li><a href="../159203/index.html">Configure Nginx + LAMP server at home. Part 1: Configuring the frontend - backend</a></li>
<li><a href="../159209/index.html">Overlaying text and images onto an image using MagickWand and GD libraries</a></li>
<li><a href="../159215/index.html">How many portable computer devices do you have (smartphones, tablets, laptops)?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>