<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple version of an indoor video surveillance system using a motion sensor and Python on the Raspberry platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, habrovchane! After several experiments with the development of a video surveillance system, which I reflected in a previous publication , I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple version of an indoor video surveillance system using a motion sensor and Python on the Raspberry platform</h1><div class="post__text post__text-html js-mediator-article">  Good day, habrovchane!  After several experiments with the development of a video surveillance system, which I reflected in a previous <a href="https://habrahabr.ru/post/316760/">publication</a> , I decided to share the final decision. <br><br><img src="https://habrastorage.org/files/1d8/b0e/12c/1d8b0e12c41549769972f78c8fa2427f.jpg"><br><a name="habracut"></a><br><h2>  Description of the final decision </h2><br>  After analyzing my experience of using the video surveillance system and recommendations for the previous post (special thanks to <a href="https://habrahabr.ru/users/varkus/" class="user_link">Varkus</a> ), as a result I chose an implementation using a PIR sensor (hereinafter <a href="https://habrahabr.ru/users/varkus/" class="user_link">referred</a> to as the sensor) for determining movements / movements.  Algorithm solutions implemented in Python. <br><br>  Earlier, I did not want to use an additional hardware component in my decision, but the approach using the sensor turned out to be very simple and concise.  Moreover, the sensor turned out to be inexpensive if ordered on aliexpress. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Hardware </h3><br>  From the "iron" used: <br><br>  - Raspberry Pi3; <br>  - Logitech USB camera; <br>  - motion sensor SR501P1. <br>  To work at night, you must additionally purchase an infrared emitter (lamp). <br><br>  The sensor is connected using 30-centimeter connectors, I give the appearance below. <br><br><img src="https://habrastorage.org/files/2c2/ed2/09d/2c2ed209df074d9e95f1d0a372d12b67.JPG"><br><br>  Yes, I pre-selected the required sensitivity by adjusting it with a potentiometer. <br><br><h3>  Software part </h3><br>  To automate the process of video surveillance limited to one Python-script that does all the work, namely, monitors the movement using the sensor and, if it is revealed: <br><br>  - takes several pictures of the room, using the Python OpenCV library for this; <br>  - saves images in Yandex.Disk; <br>  - upon reaching a certain threshold of movements, in my case - ten identified movements, stops shooting and sends the last of the saved images to Telegram. <br><br>  The threshold is set in order to limit the number of shots when fixing movements.  Upon reaching the threshold, the shooting is stopped and one of the last saved photos is sent to Telegram.  I set the threshold equal to ten, this is enough to fix the fact of penetration in the photo.  Video writing is considered superfluous, besides the photo takes up less space. <br><br>  In the final version, I refused to use the algorithm for determining the faces in the photo. <br>  The script code, without the algorithm by definition of persons, is given below. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gpiozero <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MotionSensor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telepot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Telegram_send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(input_file)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> glob <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os file=max(glob.iglob(input_file+<span class="hljs-string"><span class="hljs-string">'*.jpg'</span></span>),key=os.path.getctime) bot = telepot.Bot(<span class="hljs-string"><span class="hljs-string">'*************************************'</span></span>) bot.sendMessage(*********, <span class="hljs-string"><span class="hljs-string">'Motion detected!'</span></span>) bot.sendPhoto(*********, open(file,<span class="hljs-string"><span class="hljs-string">'rb'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> file=<span class="hljs-string"><span class="hljs-string">'/home/pi/alarms/'</span></span> counter=<span class="hljs-number"><span class="hljs-number">1</span></span> threshold=<span class="hljs-number"><span class="hljs-number">10</span></span> time.sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>) pir=MotionSensor(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: camera=cv2.VideoCapture(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> counter&lt;=threshold: <span class="hljs-comment"><span class="hljs-comment">#if pir.motion_detected: #pir.wait_for_motion() pir.when_motion print("Motion detected at "+str(time.strftime("%Y%m%d-%H%M%S"))) if not camera.isOpened(): camera.open(0) result,image=camera.read() else: result,image=camera.read() cv2.imwrite(file+str(time.strftime("%Y%m%d-%H%M%S"))+'.jpg',image) counter+=1 #pir.wait_for_no_motion() pir.when_no_motion camera.release() if counter &gt;=threshold: Telegram_send(file) except Exception as e: print('Something is wrong.',e) camera.release() finally: camera.release() if __name__=="__main__": main()</span></span></code> </pre> <br><h3>  Pros and cons of using a sensor </h3><br>  Advantages of using the sensor: <br><br>  1. A simple final code in the form of a ONE Python script that implements the entire algorithm of work. <br>  2. The relative cheapness of the sensor. <br><br>  Of the minuses I see so far only the possibility of failure of the sensor during its long operation.  But, perhaps, this device (sensor) will be stable and work for a long time, despite the fact that this is not an ‚Äúindustrial‚Äù version. <br><br><h2>  Additional features </h2><br>  I also tried to connect a second camera.  Raspberry coped with the processing of video from two cameras without problems. <br><br><h2>  Conclusion </h2><br>  Using the sensor turned out to be quite simple.  It remains to test the solution for long-term use. <br><br>  I hope that the proposed option will be a useful alternative to the implementation of a video surveillance system, which can be easily done with your own hands. </div><p>Source: <a href="https://habr.com/ru/post/320450/">https://habr.com/ru/post/320450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320434/index.html">Cerebro is a free alternative to Alfred and Spotlight</a></li>
<li><a href="../320436/index.html">10 questions for the informed choice of the SIEM system</a></li>
<li><a href="../320438/index.html">5 of the ‚Äúhottest‚Äù new books in January</a></li>
<li><a href="../320446/index.html">Mapping in C # on the example of the serializer for AMF</a></li>
<li><a href="../320448/index.html">User comfort in VR: player parameters</a></li>
<li><a href="../320452/index.html">Developing a new application architecture for Uber passengers</a></li>
<li><a href="../320454/index.html">ITSM educational program: How to meet customer expectations</a></li>
<li><a href="../320456/index.html">Uncomplicated SCRUM and Image Segmentation for Highlighting Post-it Stickers</a></li>
<li><a href="../320458/index.html">Arduino on car wash</a></li>
<li><a href="../320460/index.html">Exploit Exercises: Introducing binary vulnerabilities using the example of Protostar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>