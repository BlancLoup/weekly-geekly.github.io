<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bad code kills</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bad programmer John made a mistake in the code, due to which each user of the program was forced to spend an average of 15 minutes of time searching f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bad code kills</h1><div class="post__text post__text-html js-mediator-article">  Bad programmer John made a mistake in the code, due to which each user of the program was forced to spend an average of 15 minutes of time searching for a workaround for the problem.  There were 10 million users.  Total wasted 150 million minutes = 2.5 million hours.  If a person sleeps 8 hours a day, then he will have 16 hours left for conscious activity.  That is, John destroyed 1,56250 person-days ‚âà 427.8 person-years.  The average man lives 64 years, so John killed about 6 point 68 hundredths of a person. <br><br>  How do you sleep, John is a serial programmer? <br><br>  Users - the bottom of the food chain.  Programmers also slowly kill each other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Good Code Rules </h3><br>  Simplicity-clarity-compactness, performance, no duplication. <br><br>  If you write something harder than ‚Äúhello world‚Äù, it will be placed not in one, but in several files.  As a rule, there are more than a dozen files.  All of them are given incomprehensible short names (programmers love abbreviations). A person who tries to understand your code will spit, hiss, and curse you.  Your karma will be spoiled and the next few lives you will be a dog in Korea. <br><a name="habracut"></a><br>  <b>Note:</b> ‚Äúhello world‚Äù is not an error, this is exactly the way LibreOffice Writer quotes it.  Hello johnny  Always glad to see you!  Just kidding, never. <br><br><h3>  How to choose a good name </h3><br>  A good name is as short as possible, but it also reflects the essence of the object as accurately as possible.  Your code will be read by people (and you yourself before bedtime), so the names should be clear to people. <br><br>  John_Borser_Programmer is a good name.  A good name consists of one, two or three words.  Three is a lot.  One thing is good, but often not enough to reflect the essence.  Read the following file (class) names, can you guess the purpose of the code without looking inside? <br><br><pre><code>profiler.h
jitter_measurement.h
developer_menu.h
Animation2D.h
Rectangle.h
Wind_effect.h</code></pre><br>
       .   .<br>
<br>
           SoMFVec2s.h,  .   ,        .<br>
<br>
:     8.3   20  .<br>
<br>
<h3>   ?</h3><br>
.<br>
<br>
   .<br>
<br>
 ¬´   ¬ª               .     20NN   .<br>
<br>
        ‚Äî   ‚Äî  .     std:: cv::             . !<br>
<br>
    ?<br>
    - ?<br>
        .<br>
 .    ,  .<br>
 100     ?  ?    ‚Ä¶ <br>
<br>
<h3>     </h3><br>
.<br>
<br>
<pre><code class="cpp">int i;
char c;
byte b;
string s;
vector v;
pointer p;
argument a1;</code></pre><br>
  ,      ,     .        ,           -  -.     - ‚Äî ,      .<br>
<br>
<h3></h3><br>
  ¬´  windows¬ª,    ¬´  windows¬ª, ¬´ windows¬ª  ¬´ windows¬ª.     ,    .    ,     :      ,   .<br>
<br>
   52 ,        . : ¬´      ¬ª  . .<br>
<br>
   .  ,  ,  ,  ,  ,  .  ,      ,    5  .      ,   .<br>
<br>
<h3></h3><br>
       ,     .     , .             .<br>
<br>
<h3>...</h3><br>
‚Ä¶.         ,  ,     .         .    .        ‚Äî    .   ! !<br>
<br>
 , ,         ! !<br>
<br>
         6  ,          .     6 ! ,   !           !<br>
<br>
         ,     .       .      ,   remote code execution      ! !            100%  .<br>
<br>
    .     KB3136000    .<br>
<br>
,  !<br>
<br>
<h3>!</h3><br>
       20.  :    .      :<br>
<br>
<pre><code class="cpp">void split(const string&amp; s, std::vector&lt;string&gt;&amp; result, const string&amp; delimiters = " ")
{
	string::size_type a = s.find_first_not_of(delimiters, 0);
	string::size_type b = s.find_first_of(delimiters, a);

	while (string::npos != b || string::npos != a)
	{
		result.push_back(s.substr(a, b - a));

		a = s.find_first_not_of(delimiters, b);
		b = s.find_first_of(delimiters, a);
	}
}</code></pre><br>
     ,    :<br>
<br>
<pre><code class="cpp">void split(const string&amp; s, std::vector&lt;string&gt;&amp; result, const string&amp; delimiters = " ")
{
	string::size_type a, b = 0;

	for(;;)
	{	a = s.find_first_not_of(delimiters, b);
		b = s.find_first_of(delimiters, a);

		if (string::npos == b &amp;&amp; string::npos == a) break;

		result.push_back(s.substr(a, b - a));
	}
}</code></pre><br>
      ‚Äî           .         : boost,  ,   ,   ‚Ä¶     boost,      SSD ,   ‚Ä¶ ¬´      - ...¬ª<br>
<br>
 ,     ! ?         ,           .    .     - . ,         ,   .  ‚Ä¶<br>
<br>
 ,          C++     ? ,     ?<br>
<br>
<h3>  </h3><br>
,   ¬´ ¬ª    ‚Äî    .         .     ,        ,     ‚Ä¶<br>
<br>
   ,    ,     :<br>
<br>
<pre><code class="cpp">unsigned long t0 = current_time();
// - 

cout &lt;&lt; current_time() - t0 &lt;&lt; endl;</code></pre><br>
  ,        10 ,            .<br>
<br>
<div class="spoiler"><b class="spoiler_title">profiler.h</b><div class="spoiler_text"><pre><code class="cpp">/*
Profiler prof;

for (;;)
{
	Sleep(50); // code, which does not need to measure performance

	prof(NULL);

	Sleep(100); // some code

	prof("code1");

	Sleep(200); // some code

	prof("code2");

	prof.periodic_dump(5);
		// every 5 seconds will print table
}
*/

#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;

#include &lt;string&gt;
using std::string;

#include &lt;set&gt;
using std::set;

#include &lt;algorithm&gt;
using std::min;
using std::max;

#ifdef WIN32
#include &lt;Windows.h&gt;

class Microseconds
{
public:
	uint64_t operator()()
	{
		LARGE_INTEGER now;
		QueryPerformanceCounter(&amp;now);
		LARGE_INTEGER freq;
		QueryPerformanceFrequency(&amp;freq);

		return now.QuadPart * 1000 / (freq.QuadPart / 1000);
			// overflow occurs much later
	}
};

#else
#include &lt;sys/time.h&gt;
//#include "android_workarround.h"
class Microseconds
{
public:
	uint64_t operator()()
	{
		timeval tv;
		gettimeofday(&amp;tv, NULL);
		return (uint64_t)tv.tv_sec * 1000000 + tv.tv_usec;
	}
};
#endif

class Profiler
{
	Microseconds microseconds;

	class Event
	{
		public:
		const char* name;
		uint64_t time;
		uint64_t count;
		uint64_t min_time;
		uint64_t max_time;

		void reset()
		{
			time = 0;
			count = 0;
			min_time = (uint64_t)-1;
			max_time = 0;
		}
	};

	class Comparator
	{
		public:
		bool operator()(const Event&amp; a, const Event&amp; b) const
		{	//return strcmp(a.name, b.name) &lt; 0;
			return (void*)a.name &lt; (void*)b.name;
		}
	};

	set&lt;Event, Comparator&gt; events;

	uint64_t t0;
	uint64_t last_dump;

	Event c;
	set&lt;Event&gt;::iterator i;

public:
	Profiler()
	{
		last_dump = t0 = microseconds();
	}

	void operator()(const char* what)
	{
		if (what == NULL)
		{
			t0 = microseconds();
			return;
		}

		uint64_t t = microseconds() - t0;

		c.name = what;
		i = events.find(c);

		if (i == events.end())
		{
			c.reset();
			i = events.insert(c).first;
		}

		Event&amp; e = const_cast&lt;Event&amp;&gt;(*i);

		e.time += t;
		e.min_time = min(e.min_time, t);
		e.max_time = max(e.max_time, t);
		++e.count;

		t0 = microseconds();
	}

	void dump()
	{
		const float MS = 0.001f;

		float f_summ = 0;
		for (i = events.begin(); i != events.end(); ++i)
			f_summ += (float)i-&gt;time;

		if (f_summ == 0) return;

		f_summ *= MS;
		f_summ *= .01f; // %

		printf("           name count   total(%%)        min   avg   max\n");

		for (i = events.begin(); i != events.end(); ++i)
		{
			Event&amp; e = const_cast&lt;Event&amp;&gt;(*i);

			if (e.count == 0) e.min_time = 0;

			float f_time = e.time * MS;
			float f_min = e.min_time * MS;
			float f_max = e.max_time * MS;
			float f_average = e.count == 0 ? 0 : f_time / (float)e.count;

			printf("%15s %5llu %7.1f(%5.1f%%) %5.1f %5.1f %5.1f\n",
				e.name, (long long unsigned int)e.count,
				f_time, f_time / f_summ, f_min, f_average, f_max);

			e.reset();
		}
	}

	void periodic_dump(unsigned int period)
	{
		if (microseconds() &lt; last_dump + period * 1000000) return;
		dump();
		last_dump = microseconds();
	}
};</code></pre></div></div><br>
    ,    :<br>
<br>
<pre><code>           name count   total(%)        min   avg   max 
       detector     0     0.0(  0.0%)   0.0   0.0   0.0 
      predictor   161   287.8( 46.1%)   1.0   1.8   2.3 
        refiner   161   246.9( 39.5%)   0.8   1.5   1.8 
      shape fit   161    90.0( 14.4%)   0.3   0.6   0.8 </code></pre><br>
 ,         .<br>
<br>
      ,  dump  ,      vector out;       .      .       ,   ? .      .<br>
<br>
  <i></i>-  .   ‚Äî  . ,     500 ,    ,  .<br>
<br>
<h3>   </h3><br>
   ,  ¬´  ¬ª  ,   ¬´ ¬ª,      .   ,            .<br>
<br>
   ,         . ? .    ? .    ‚Äî  .<br>
<br>
<h3>    </h3><br>
  , !        .   ?   ,      ?      ,           ?      ¬´ .  ,   ¬ª,            ?     ,   ‚Ä¶ -‚Ä¶ . .<br>
<br>
  ‚Äî   .<br>
  ‚Äî  .<br>
  ‚Äî  .<br>
  ‚Äî   .<br>
   ‚Äî .<br>
  ‚Äî   .<br>
<br>
<h3></h3><br>
    windows,   15 .  5048 ‚Ä¶<br>
<br>
<h3>    profiler.h</h3><div class="spoiler"><b class="spoiler_title">profiler.h</b><div class="spoiler_text"><pre><code class="cpp">/*

#ifdef linux
#include &lt;time.h&gt;
void Sleep(int milliseconds)
{
	struct timespec ts;
	ts.tv_sec = milliseconds / 1000;
	ts.tv_nsec = (milliseconds % 1000) * 1000000;
	nanosleep(&amp;ts, NULL);
}
#endif

int main()
{	Profiler prof;

	for(;;)
	{	
		Sleep(50); // code, which does not need to measure performance

		prof(NULL);

		Sleep(100); // some code

		prof("code1");

		Sleep(200); // some code

		prof("code2");

		prof.periodic_dump(5);
			// every 5 seconds will print table
	}
	return 0;
}
*/

#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;

#include &lt;vector&gt;
using std::vector;

#include &lt;string&gt;
using std::string;

#include &lt;map&gt;
using std::map;

#include &lt;algorithm&gt;
using std::min;
using std::max;

#include &lt;utility&gt;
using std::make_pair;

#include &lt;iostream&gt;
using std::cout;

#ifdef linux

#include &lt;sys/time.h&gt;

static uint64_t microseconds()
{	timeval tv;
	gettimeofday(&amp;tv, NULL);
	return (uint64_t)tv.tv_sec * 1000000 + tv.tv_usec;
}

#else

#include &lt;Windows.h&gt;

static uint64_t microseconds()
{
	LARGE_INTEGER now;
	QueryPerformanceCounter(&amp;now);
	LARGE_INTEGER freq;
	QueryPerformanceFrequency(&amp;freq);
	return now.QuadPart * 1000 / (freq.QuadPart / 1000);
		// overflow occurs much later
}

#endif

class Profiler
{	
	class Event
	{
	public:
		uint64_t time;
		uint64_t count;
		uint64_t min_time;
		uint64_t max_time;

		void reset()
		{	time = 0;
			count = 0;
			min_time = (uint64_t)-1;
			max_time = 0;
		}
	};

	map&lt;const char*, Event&gt; events;

	uint64_t t0;
	uint64_t last_dump;

	map&lt;const char*, Event&gt;::iterator i;

public:
	vector&lt;string&gt; out;

	Profiler()
	{	last_dump = t0 = microseconds();
	}

	void operator()(const char* what)
	{	
		if (what == NULL)
		{
			t0 = microseconds();
			return;
		}
		
		uint64_t t = microseconds() - t0;

		i = events.find(what);
		
		if(i == events.end())
		{	
			Event e;
			e.reset();
			i = events.insert(make_pair(what, e)).first;
		}

		Event&amp; e = (*i).second;

		e.time += t;
		e.min_time = min(e.min_time, t);
		e.max_time = max(e.max_time, t);
		++e.count;

		t0 = microseconds();
	}

	void dump()
	{
		out.clear();

		const float us_to_ms = 0.001f;
		
		float summ = 0;
		for (i = events.begin(); i != events.end(); ++i)
		{	
			Event&amp; e = (*i).second;

			summ += (float)e.time;
		}

		if (summ == 0) return;

		summ *= us_to_ms;

		out.push_back("           name count   total(%)        min   avg   max\n");

		for(i = events.begin(); i != events.end(); ++i)
		{
			Event&amp; e = (*i).second;

			if(e.count == 0) e.min_time = 0;

			float time = e.time * us_to_ms;
			float min_time = e.min_time * us_to_ms;
			float max_time = e.max_time * us_to_ms;
			float average = e.count == 0 ? 0 : time / (float)e.count;

			char tmp[0x100];

			snprintf(tmp, sizeof(tmp), "%15s %5llu %7.1f(%5.1f%%) %5.1f %5.1f %5.1f\n",
				i-&gt;first, (long long unsigned int)e.count,
				time, time / summ * 100, min_time, average, max_time);
			out.push_back(tmp);
			
			e.reset();
		}

		for (int i = 0; i &lt; out.size(); ++i) cout &lt;&lt; out[i];
	}

	void periodic_dump(unsigned int period)
	{	if(microseconds() &lt; last_dump + period * 1000000) return;
		dump();
		last_dump = microseconds();
	}
};</code></pre></div></div></div><p>Source: <a href="https://habr.com/ru/post/309388/">https://habr.com/ru/post/309388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309378/index.html">Tower Defense on the Unity engine - Part 1</a></li>
<li><a href="../309380/index.html">Introduction to GitLab CI</a></li>
<li><a href="../309382/index.html">Elixir: Preparing parsing correctly - yecc and leex</a></li>
<li><a href="../309384/index.html">Compensation of lags for weapons in MechWarrior Online</a></li>
<li><a href="../309386/index.html">OSPF (Quagga), Shorewall and Policy Routing: inactive route problem</a></li>
<li><a href="../309390/index.html">Selection of equipment for corporate cloud storage</a></li>
<li><a href="../309394/index.html">The myth of RAM and O (1)</a></li>
<li><a href="../309400/index.html">The book ‚ÄúHTML5 and CSS3. Website development for any browsers and devices. 2nd ed. "</a></li>
<li><a href="../309402/index.html">Microsoft StorSimple virtual array. Part 2</a></li>
<li><a href="../309404/index.html">Why the 35-year-old SoftBank company again spoils its reputation because of the ‚Äúcrazy‚Äù deal with ARM Holdings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>