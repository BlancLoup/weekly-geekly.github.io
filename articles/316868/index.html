<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram-bot: my story. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habrahabr! The purpose of the article is to tell novice programmers about the possibility of not only developing something interesting based...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram-bot: my story. Part one</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/96a/dcf/a87/96adcfa8724345a6ba3e601d216628e5.png"></div><br>  Good day, Habrahabr!  The purpose of the article is to tell novice programmers about the possibility of not only developing something interesting based on simple tools, but also placing the project in the public domain, and with diligent efforts to see that not only the author can appreciate the effort spent. <br><br>  Closer to the point is my first pet-project, which solves the problem of accessing the university‚Äôs schedule on mobile devices via Telegram, with an audience of more than one hundred fifty unique visitors per day.  Despite the fact that the figure is not transcendental, this is quite a good result, serving as a follow-up long-term environment for real combat development, taking into account all possible features and supporting the product for a long period, which is indisputably useful and valuable for each developer. <br><a name="habracut"></a><br>  <b>UPD</b> : the project was successfully refactored using the author's framework for university timetables - ‚ÄúRutetider‚Äù ( <a href="https://habrahabr.ru/post/326222/">article on Habrahabr</a> , <a href="https://github.com/DmytryiStriletskyi/Rutetider">GitHub</a> ).  Therefore, some points in this article may not coincide, some may not exist or look different, but the concept is preserved. <br><br>  Not having the ability to expand access to the schedule using mobile applications, it was decided to use one of a number of popular instant messengers, namely, automated algorithms inside, that is, bots. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will say in advance that the programming language is Python, which, however, is not important because of the general availability and cross-platform of both the resources required in this article and the majority of other resources available for use in other projects.  And also missed easily accessible explanations, for example, the explanation of the plug-in (library), the registration of the bot Telegram token, or any other obvious point, located directly in Google on the first link. <br><br>  I provide the following set of required areas involved in the project ( <a href="https://github.com/DmytryiStriletskyi/DuttyBot">link to github.com</a> ).  In the sum of the categories, one can assess the vastness of the knowledge necessary for application, and, better, potentially open to study: <br><br><ul><li>  <a href="https://github.com/eternnoir/pyTelegramBotAPI">pyTelegramBotAPI</a> is the main library for interacting with <a href="https://core.telegram.org/bots/api">the Telegram API</a> . </li><li>  <a href="https://devcenter.heroku.com/">Heroku Cloud Application Platform</a> - support for an impressive range of languages, large and light (sometimes forcing the monitor to pour water) documentation with tutorials for beginners, a user-friendly interface for the complete work with the application, including access via the console, the presence of databases.  An important factor is the ability to <a href="https://devcenter.heroku.com/articles/free-dyno-hour-faq">"spin" on the server around the clock</a> . </li><li>  <a href="https://github.com/">Github</a> - working with application deployment on a server runs with the Git version control system.  A nice bonus is to combine it with your repository without time. </li><li>  PostgreSQL - SQL database, and nothing to say. </li></ul><br>  In the process it is worth adding the use of a virtual environment, one of the important frameworks (Flask), an impressive set of imported modules and everything that I did not recall. <br><br><h1>  About the project as a whole </h1><br>  I did not always have the opportunity to see which items need to be visited today and in which particular classrooms my classmates are located.  The only alternatives at the moment is the entrance to the non-adaptive website of the university from the word ‚Äúabsolutely‚Äù and a visit to the public in social networks, which does not suit me personally as a user. <br><br>  It was decided that ‚Äúone-knot‚Äù knowledge of one language, zero real experience in programming projects, and even worse, a lack of development experience, I began to prepare the further path of the application.  I was lucky with the business plan, it was on the schedule website, everything that I needed or needed to implement now is already implemented by others, it remains only to steal and think a little. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/89b/c7c/b6c/89bc7cb6c27347bdaf8f3ebad8dc670c.png"></div><br>  At the moment, the initial and final menus according to the order of pictures look like this. <br><br>  <b>1) To make it possible in a few clicks to get the schedule for today and tomorrow</b> - starting with the button ‚ÄúGet the schedule‚Äù and ending with the choice of the day (‚ÄúToday‚Äù or ‚ÄúTomorrow‚Äù), the user needs to choose his faculty, course and group. <br><br><ul><li>  <b>Why can not make a schedule for the whole week?</b>  Because I want more than thirty people per day to use my bot (most of the good updates I never release will have a bad effect on the online). <br><br></li><li>  <b>Why do you need to press so many buttons, you can not cut or just write your group once?</b>  I know that it is more convenient to click on the mobile phone screen three times than to write your group clearly and correctly (from two letters, two numbers and a hyphen and more) by calling the on-screen keyboard, and the final menu can also be used the next day. </li></ul><br>  <b>2) Sticker with time intervals of pairs</b> - the sticker is fun, the sticker is cool, and you can exchange them, so they are pressed by a third of users every day, although there is no great need (chat history is saved, it‚Äôs not difficult to flip up).  At the moment, the sticker can be improved by adding time breaks. <br><br>  <b>3) Schedule function by subscription</b> - I knowingly, up to the very first line of the code, knew that it was necessary to enter something that would allow to get the schedule in one click.  The need to go through all the stages in which all the same faculty is indicated, the course and the group, remained, but to do it all the time - no.  In the final menu there is a button ‚ÄúSubscribe to this group‚Äù, with which the user, without making ‚Äúextra movements‚Äù, gets a schedule for two days at a time. <br><br>  <b>4) Feedback and updates</b> are minor, but very important functions, if in the first version you need to be able to hear your users (from requests to enter something new and reporting on bugs to praise and thanks), then in the second - learn how to communicate your community about server issues, new releases and other important information. <br><br>  <b>5) Go back</b> - this is the first function implemented by the numerous requests of <s>working</s> users.  The obvious advantage over the erroneous transitions was embodied in just a couple of days, given the complex data table architecture for this application. <br><br>  <b>6) Statistics collection</b> - statistics for each user and his actions.  As a result, we obtain information when it is worthwhile to introduce updates that need to be tested load-bearing, and when ‚Äúon the sly‚Äù.  Based on the data, you can also designate the scope of relevance of a particular area. <br><br>  <b>7) All work should be automated</b> - the built-in CRON as a plug-in library on the server is a regular scheduler that performs tasks in a given period of time. <br><br><ul><li>  <b>Daily update of dates</b> - immediately after midnight, updated schedule dates for the current and tomorrow are available. </li><li>  <b>Weekly schedule updates</b> - for certain resource reasons, the service does not have the ability to update it every day, so users can expect to be updated once a week (the schedule is updated daily from 04.12). </li></ul><br><h1>  Application Deployment Aspects </h1><br>  Here I will describe non-obvious instructions on how to deploy to the Heroku Cloud Platform, including the technical code in the form of connecting to the server, implementing databases, and designing the application.  Before reading it is advisable to familiarize yourself with the <a href="https://devcenter.heroku.com/start">training instructions for beginners</a> , to ‚Äútouch‚Äù the already prepared project and service interface proposed in it. <br><br>  For general convenience, all variables and data are contained in one section of the code, but you do not do this, make configs. <br><br>  We force the cloud service, on which our project has already been created, to see the main script: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, request bot = telebot.TeleBot(  ) server = Flask(__name__) @bot.message_handler(commands=[<span class="hljs-string"><span class="hljs-string">'start'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.reply_to(message, <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + message.from_user.first_name) @bot.message_handler(func=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> message: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, content_types=[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echo_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.reply_to(message, message.text) @server.route(<span class="hljs-string"><span class="hljs-string">"/ "</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> bot.process_new_updates([telebot.types.Update.de_json(request.stream.read().decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>))]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"!"</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span> @server.route(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webhook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> bot.remove_webhook() bot.set_webhook(url=<span class="hljs-string"><span class="hljs-string">"https://  /  "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"!"</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span> server.run(host=<span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, port=os.environ.get(<span class="hljs-string"><span class="hljs-string">'PORT'</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>))</code> </pre> <br>  Everything you need to connect is available in Database Credentials on the databases page (user name, password, host, port, and the database name itself).  Everything is placed in a small script using convenient modules for development: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dj_database_url <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> psycopg2 DATABASELINK = <span class="hljs-string"><span class="hljs-string">"postgres://username:password@host:port/database"</span></span> db_info = dj_database_url.config(default=DATABASELINK) connection = psycopg2.connect(database=db_info.get(<span class="hljs-string"><span class="hljs-string">'NAME'</span></span>), user=db_info.get(<span class="hljs-string"><span class="hljs-string">'USER'</span></span>), password=db_info.get(<span class="hljs-string"><span class="hljs-string">'PASSWORD'</span></span>), host=db_info.get(<span class="hljs-string"><span class="hljs-string">'HOST'</span></span>), port=db_info.get(<span class="hljs-string"><span class="hljs-string">'PORT'</span></span>)) cursor = connection.cursor()</code> </pre><br>  This material is quite enough to independently begin the product development phase. <br>  If the community appreciates the article and shows little interest in continuing, I will definitely please the next part, in which I will describe all the technical logic of the application and tell you how this little success resulted for me in the end ( <a href="https://habrahabr.ru/post/317280/">part two by reference</a> ). </div><p>Source: <a href="https://habr.com/ru/post/316868/">https://habr.com/ru/post/316868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316856/index.html">FIAS addresses in the PostgreSQL environment. Part 4. EPILOGUE</a></li>
<li><a href="../316858/index.html">Testing UWP applications using Appium</a></li>
<li><a href="../316862/index.html">Custom Video Recorder for iOS applications</a></li>
<li><a href="../316864/index.html">Dive into the blockchain technology: Decentralized password-free security system</a></li>
<li><a href="../316866/index.html">Discuss? Gartner: Virtualization Market Reaches Saturation</a></li>
<li><a href="../316872/index.html">Testing 15+ virtual hosting for Wordpress or how not to disappear from the Yandex index</a></li>
<li><a href="../316874/index.html">We cover the project with smoke tests until it burns out</a></li>
<li><a href="../316880/index.html">Electron: from motivation to publication</a></li>
<li><a href="../316884/index.html">Monitoring GPU on Windows servers (TICK + Grafana + crutches)</a></li>
<li><a href="../316886/index.html">PIN cards of bank cards. How modern technology replaces paper mail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>