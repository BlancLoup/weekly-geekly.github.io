<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CLOS generic functions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Any developer who somehow faced object-oriented programming, and tried to figure it out, was sure to hear about CLOS , the object system of Common Lis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CLOS generic functions</h1><div class="post__text post__text-html js-mediator-article">  Any developer who somehow faced object-oriented programming, and tried to figure it out, was sure to hear about <abbr title="Common Lisp Object System">CLOS</abbr> , the object system of Common Lisp, one of the fundamental features of which is the so-called ‚Äúgeneric functions‚Äù or ". <br><br>  Although many believe that generalized functions are just an analogue of static function overload, but only in dynamics, this is completely wrong. <br>  It is not entirely correct to even say that this is an extension of the dispatching on self / this, that is, ‚Äúvirtual functions‚Äù, to several arguments. <br><br>  Of course, multiple dispatching is one of the main features of generalized functions, but their very essence is not only, and even not so much, in this. <br><a name="habracut"></a><br>  Let me explain with an example - a calculator of simple mathematical expressions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we take a language with a ‚Äúclassic‚Äù OOP implementation, for example C #, we will have something like this: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IExpression</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Negation</span></span> : <span class="hljs-title"><span class="hljs-title">IExpression</span></span> { IExpression expr; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Negation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression e</span></span></span><span class="hljs-function">)</span></span> { expr = e; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -expr.Evaluate(); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Addition</span></span> : <span class="hljs-title"><span class="hljs-title">IExpression</span></span> { IExpression left, right; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Addition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression l, IExpression r</span></span></span><span class="hljs-function">)</span></span> { left = l; right = r; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left.Evaluate() + right.Evaluate(); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Number</span></span> : <span class="hljs-title"><span class="hljs-title">IExpression</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Number</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = v; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><br>  The option on the Lisp will be: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defstruct</span></span> (<span class="hljs-name"><span class="hljs-name">negation</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:constructor</span></span> negation (<span class="hljs-name"><span class="hljs-name">expr</span></span>)) (<span class="hljs-symbol"><span class="hljs-symbol">:conc-name</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) expr) (<span class="hljs-name"><span class="hljs-name">defstruct</span></span> (<span class="hljs-name"><span class="hljs-name">addition</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:constructor</span></span> addition (<span class="hljs-name"><span class="hljs-name">left</span></span> right)) (<span class="hljs-symbol"><span class="hljs-symbol">:conc-name</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) left right) (<span class="hljs-name"><span class="hljs-name">defgeneric</span></span> evaluate (<span class="hljs-name"><span class="hljs-name">expr</span></span>) (<span class="hljs-symbol"><span class="hljs-symbol">:method</span></span> ((<span class="hljs-name"><span class="hljs-name">expr</span></span> negation)) (<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">evaluate</span></span> (<span class="hljs-name"><span class="hljs-name">expr</span></span> expr)))) (<span class="hljs-symbol"><span class="hljs-symbol">:method</span></span> ((<span class="hljs-name"><span class="hljs-name">expr</span></span> addition)) (<span class="hljs-name"><span class="hljs-name">+</span></span> (<span class="hljs-name"><span class="hljs-name">evaluate</span></span> (<span class="hljs-name"><span class="hljs-name">left</span></span> expr)) (<span class="hljs-name"><span class="hljs-name">evaluate</span></span> (<span class="hljs-name"><span class="hljs-name">right</span></span> expr)))) (<span class="hljs-symbol"><span class="hljs-symbol">:method</span></span> ((<span class="hljs-name"><span class="hljs-name">expr</span></span> number)) expr)) <span class="hljs-comment"><span class="hljs-comment">;; (evaluate (addition 5 (negation -5))) ;; ==&gt; 10</span></span></code> </pre><br><br>  The first thing that catches the eye, besides reducing the size of the code, is that the methods are separated from data structures and grouped into generic functions. <br>  The second noticeable difference is the absence of interfaces as such. <br>  In addition, we did not introduce a new class or data structure to represent numbers, and simply specialized <i>evaluate</i> in the standard class <a href="http://l1sp.org/cl/number"><i>number</i></a> . <br><br>  In general, the lack of concepts of interfaces in the CLOS, in the OO-understanding of this word, and abstract classes, quite strongly, according to my observations, prevents porting code from traditional object-oriented languages, and in addition, it puts additional obstacles in learning the language and object model to people accustomed to these most traditional OO languages;  In addition, problems for such people are created by the ‚Äúrequirement of uniformity of the signature of a generalized function‚Äù (which means that all methods in the group must have the same required parameters), because these people start writing in the traditional OO style, simply supplying the intended ‚Äúthis‚Äù as first argument  It is possible that some of them are also inconvenienced by the absence of access modifiers, ‚Äúproperties‚Äù and separation of interface and implementation inheritance from classes. <br><br>  Yes, the direct projection of the classic OOP on CLOS does not work, or at least it looks awful, but there is a very specific reason for this, and it is this: <br><br>  Methods are not simply separated from classes.  The CLOS object paradigm is fundamentally different from the classic OOP, tied to the transmission and processing of messages (message passing). <br><br>  CLOS shifts the focus from the <i>state</i> and <i>behavior of</i> entities to their <i>interaction with</i> each other and with the outside world. <br><br>  I wrote above that there are no interfaces in CLOS.  In fact, this is not quite the case - generic functions <i>are</i> interfaces, and their methods are implementations. <br><br>  At this point, one of the adherents of functional programming may ask: ‚ÄúGreat, well, and how does this all differ from the banal pattern-match?‚Äù. <br><br>  It differs a lot.  First, the specialization of methods of generalized functions is possible both in terms of values ‚Äã‚Äãand in classes, and in the latter case, taking into account inheritance.  Secondly, methods to generalized functions can be added, and even directly in runtime.  And thirdly, dispatching can be arbitrarily controlled by specifying the so-called ‚Äúcombinators of methods‚Äù to generic functions, and this is not to mention the: before,: after and: around decorators for the standard combinator. <br><br>  About the combinators of methods, I <a href="http://love5an.livejournal.com/350660.html">once wrote in my LiveJournal</a> , anyone can read, well, here I will show how using one of the built-in combinators, <i>progn</i> , to implement the similarity of "constructors" from ordinary OO languages: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defgeneric</span></span> construct (<span class="hljs-name"><span class="hljs-name">object</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;key</span></span>) (<span class="hljs-symbol"><span class="hljs-symbol">:method-combination</span></span> progn <span class="hljs-symbol"><span class="hljs-symbol">:most-specific-last</span></span>)) (<span class="hljs-name"><span class="hljs-name">defun</span></span> new (<span class="hljs-name"><span class="hljs-name">class</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;rest</span></span> args <span class="hljs-symbol"><span class="hljs-symbol">&amp;key</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;allow-other-keys</span></span>) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">object</span></span> (<span class="hljs-name"><span class="hljs-name">make-instance</span></span> class))) (<span class="hljs-name"><span class="hljs-name">apply</span></span> #'construct object args) object)) (<span class="hljs-name"><span class="hljs-name">defclass</span></span> superclass () (<span class="hljs-name"><span class="hljs-name">some-slot</span></span>)) (<span class="hljs-name"><span class="hljs-name">defclass</span></span> subclass (<span class="hljs-name"><span class="hljs-name">superclass</span></span>) ()) (<span class="hljs-name"><span class="hljs-name">defmethod</span></span> construct progn ((<span class="hljs-name"><span class="hljs-name">object</span></span> superclass) <span class="hljs-symbol"><span class="hljs-symbol">&amp;key</span></span> value) (<span class="hljs-name"><span class="hljs-name">setf</span></span> (<span class="hljs-name"><span class="hljs-name">slot-value</span></span> object 'some-slot) value) (<span class="hljs-name"><span class="hljs-name">write-line</span></span> <span class="hljs-string"><span class="hljs-string">"Superclass constructed"</span></span>)) (<span class="hljs-name"><span class="hljs-name">defmethod</span></span> construct progn ((<span class="hljs-name"><span class="hljs-name">object</span></span> subclass) <span class="hljs-symbol"><span class="hljs-symbol">&amp;key</span></span>) (<span class="hljs-name"><span class="hljs-name">write-line</span></span> <span class="hljs-string"><span class="hljs-string">"Subclass constructed"</span></span>) (<span class="hljs-name"><span class="hljs-name">format</span></span> <span class="hljs-literal"><span class="hljs-literal">t</span></span> <span class="hljs-string"><span class="hljs-string">"Slot value: ~s~%"</span></span> (<span class="hljs-name"><span class="hljs-name">slot-value</span></span> object 'some-slot))) <span class="hljs-comment"><span class="hljs-comment">;; (new 'subclass :value 123) ;; ==&gt; Superclass constructed ;; Subclass constructed ;; Slot value: 123</span></span></code> </pre><br><br>  In my opinion, the CLOS object model organically synthesized the best of OOP and functional programming, and is still the most perfect implementation of the paradigm presented in it. <br>  It's a shame that the mainstream takes its ideas extremely slowly and reluctantly, and it makes it worse. <br><br></div><p>Source: <a href="https://habr.com/ru/post/131026/">https://habr.com/ru/post/131026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131020/index.html">Anonymous collapsed servers with child pornography</a></li>
<li><a href="../131021/index.html">Mitap materials scala.by # 5 - Pragmatic Erlang</a></li>
<li><a href="../131022/index.html">Microsoft channel on Youtube was hacked</a></li>
<li><a href="../131023/index.html">Easy navigation in Windows Explorer and Total Commander</a></li>
<li><a href="../131025/index.html">Stop analytics</a></li>
<li><a href="../131028/index.html">Do large companies have the right to disregard user security?</a></li>
<li><a href="../131029/index.html">What happened to hosting in DC MHost?</a></li>
<li><a href="../131034/index.html">MouseTrack is open and published on code.google.com</a></li>
<li><a href="../131041/index.html">Some possibilities of using Intents</a></li>
<li><a href="../131043/index.html">Accelerate card loading in World of Tanks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>