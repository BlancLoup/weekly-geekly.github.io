<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Continuous integration for the smallest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Are you still publishing a project manually? Then we go to you 
 Under the guide, the CI implementation guideline for .NET projects from scratch, incl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Continuous integration for the smallest</h1><div class="post__text post__text-html js-mediator-article"><h1>  Are you still publishing a project manually?  Then we go to you </h1><img src="https://habrastorage.org/storage2/459/18f/f22/45918ff2207e861555c04e42e181a5d6.jpg"><br>  Under the guide, the CI implementation guideline for .NET projects from scratch, including: <br><ol><li>  Automatic daily builds </li><li>  Problem Notifications </li><li>  Integration with bug tracker and version control system </li><li>  Product Versioning </li><li>  Database Versioning </li><li>  Automated calculations and backups </li></ol><br><a name="habracut"></a><br>  Let's start with what ‚Äúcontinuous integration‚Äù is. <br><blockquote>  Continuous Integration (Continuous Integration) is the practice of software development, which is to perform frequent automated project builds to identify and solve integration problems as soon as possible. <br></blockquote><br>  From a practical point of view, this means that at any time you should have a ‚Äúlive, current version of the product‚Äù that you can test or demonstrate. <br>  For this you need: <br><ol><li>  For developers to contribute their code to VCS at least every day </li><li>  The product was assembled in automatic mode. </li><li>  Product display (including database update) was performed automatically. </li><li>  Product testing was done automatically (as far as possible) </li></ol><br>  Continuous Integration refers to agile practices.  Agile involves an iterative process, with repeated repetition of the development cycle, testing and display of the product.  Automation of routine processes avoids multiple routine tasks. <br><br><h2>  Work with VCS </h2>  First we need a test environment for testing the application.  If the testing cycle is long enough, and development is fast, then it is reasonable to select a dev-environment as well.  The structure of the VCS will reflect your surroundings. <br>  All developers work with the main development branch, then a certain version is fixed and merged into the test branch.  From the test branch, a calculation is made on the test environment.  Testing, making fixes and reverse merzh in dev.  The tested version is sent to the release branch and is published from there to production.  If there are any lapses on the production (unfortunately, this happens), we repair in the emergency mode from the production branch and again merge to the DEV-branch. <br><br>  In the philosophy of GIT it will be a little different, since when working with GIT it is not customary to commit to master and even dev.  Instead, a feature-stitch approach is practiced.  You can read about git workflow here: <a href="http://habrahabr.ru/post/60030/">habrahabr.ru/post/60030</a> .  In general, all the proposed VCS structures pursue one goal: to avoid a situation when the development branch is not stable, but it is absolutely necessary to ‚Äúfix‚Äù or ‚Äúfinish‚Äù something quickly and give everything.  When choosing your structure, ask yourself the question ‚Äúwill I be able to give everything to production for one day and not break everything.  If the answer is "yes", then the structure suits you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order not to miss the errors on production, you should make the test environment as much as the target environment as possible.  Usually, the main difficulty is the dependence on third-party web services or other components and operations associated with real financial transactions. <br><br><h2>  Configurations </h2>  No matter how hard we try to make the environments identical, the configuration files will be different: test and real accounts, tokens, IDs, external web services, and more.  .NET offers an excellent way to keep configurations up-to-date: configs transformations.  For some reason, out of the box, they are included only in web applications.  Fortunately, transformations are fairly easy to add to other applications. <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UsingTask</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TaskName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TransformXml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v10.0\Web\Microsoft.Web.Publishing.Tasks.dll"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AfterCompile"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Exists('App.$(Configuration).config')"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--Generate transformed app config in the intermediate directory--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TransformXml</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App.config"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(IntermediateOutputPath)$(TargetFileName).config"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App.$(Configuration).config"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--Force build process to use the transformed configuration file from now on.--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppConfigWithTargetPath</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Remove</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"App.config"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppConfigWithTargetPath</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(IntermediateOutputPath)$(TargetFileName).config"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetPath</span></span></span><span class="hljs-tag">&gt;</span></span>$(TargetFileName).config<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetPath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppConfigWithTargetPath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Novice developers often fall into a stupor when debugging Web.config transformations on local machines: unlike App.config, they are stored at the application level and not in the bin folder, so the local assembly does not transform.  Transformations are applied when publishing a project.  If you really need to work around this limitation, you can create a Web.template.config file and add a transformation to the PostBuild application.  Do not forget to remove the task transformation from the project, otherwise the transformation will be applied twice. <br>  If the application uses other technologies, it is still better to have one main configuration file with general settings and additional configuration files for changing the reference config.  This will save you from copy-paste the same settings. <br><br><h2>  Adding files that are not in the project to the calculation </h2><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CopyAllFilesToSingleFolderForPackageDependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> CustomCollectFiles; $(CopyAllFilesToSingleFolderForPackageDependsOn); <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CopyAllFilesToSingleFolderForPackageDependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CustomCollectFiles"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Copy JavaScript files --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CompressedScripts</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sources\**\*.js"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FilesForPackagingFromProject</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%(CompressedScripts.Identity)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DestinationRelativePath</span></span></span><span class="hljs-tag">&gt;</span></span>Sources\%(RecursiveDir)%(Filename)%(Extension)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DestinationRelativePath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FilesForPackagingFromProject</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Copy stylesheets --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CompressedScripts</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sources\**\*.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FilesForPackagingFromProject</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%(CompressedScripts.Identity)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DestinationRelativePath</span></span></span><span class="hljs-tag">&gt;</span></span>Sources\%(RecursiveDir)%(Filename)%(Extension)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DestinationRelativePath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FilesForPackagingFromProject</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  Product Versioning </h2>  .NET provides 2 attributes for versioning assemblies <br>  [assembly: AssemblyVersion ("1.0.0.0")] <br>  [assembly: AssemblyFileVersion ("1.0.0.0")] <br>  The first two digits are the major and minor version numbers.  These numbers interpret the increment of functional change.  The third digit is the so-called assembly number.  Every day, while the version is in development, this version increases.  And the last number is the revision number.  This number is incremented every time you build a version on the build server during the day.  Details on the versioning policy in .NET are written in the CLR book via C # Richter. <br>  Automatic versioning can be configured in various ways.  This topic is discussed in detail here: <a href="http://stackoverflow.com/questions/1126880/how-can-i-auto-increment-the-c-sharp-assembly-version-via-our-ci-platform-hudso">stackoverflow.com/questions/1126880/how-can-i-auto-increment-the-c-sharp-assembly-version-via-our-ci-platform-hudso</a> . <br><br><h4>  Basic approaches </h4><ol><li>  Using a version of the form 1.0. *. * (Does not fit well with the build server) </li><li>  Using a single SharedAssemblyInfo file to manage the versions of all assemblies from that place (one file is created with the version number and ‚Äúas a link‚Äù is added to all projects </li><li>  Use msbuild instead of AssemblyInfo file </li><li>  For TFS, you can use WWF-Activity </li></ol><br>  In my opinion the most convenient way is to use msbuild and set the value using the CI server: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Major</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Major</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Minor</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Minor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Build</span></span></span><span class="hljs-tag">&gt;</span></span>$(BUILD_NUMBER)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  All modern CI solutions offer this variable at build time.  In order for this approach to work, you need to add import msbuild task from <a href="http://msbuildtasks.tigris.org/">msbuildtasks.tigris.org</a> and add at the end of the project: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Project</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Exists('$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BeforeBuild"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Exists('$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets')"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Version: $(Major).$(Minor).$(Build).$(Revision)"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AssemblyInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CodeLanguage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CS"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OutputFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AssemblyFileInfo.cs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyFileVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(Major).$(Minor).$(Build).$(Revision)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyConfiguration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(Configuration)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(Revision) != '' "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  Database Versioning </h2>  I do not know a single project in which I would not have to change the database.  .NET offers the following solutions: <br><br><h4>  SSDT project <a href="http://msdn.microsoft.com/ru-ru/data/tools.aspx">msdn.microsoft.com/ru-ru/data/tools.aspx</a> </h4>  <strong>Pros: the</strong> process of creating and editing a database is reminiscent of how you would do it with Management Studio. <br>  <strong>Cons: the</strong> complexity of writing migration scripts.  Since  Incremental changes are built by the project itself; data security is ensured by pre-deploy and post-deploy scripts.  You will have to rely on the presence / absence of fields in the database or ‚Äúinvent‚Äù the schema version table already implemented in the migration engines. <br><br><h4>  ECM7 Migrator <a href="https://code.google.com/p/ecm7migrator/">code.google.com/p/ecm7migrator</a> </h4>  Open source migration engine.  The project supports Habrayuzer <a href="https://habrahabr.ru/users/dima117/" class="user_link">dima117</a> . <br>  <strong>Pros:</strong> different DBMS are supported, if something does not suit you, the code is open.  Migrator is supported and overgrown with new features.  And, perhaps most important, it supports multiple migration keys in one database.  This can be very useful if your application is modular and supports plugins in one form or another.  Each plugin can perform its migrations and still use one DB. <br>  <strong>Cons:</strong> No Entity Framework Migrations Buns. <br><br><h4>  Entity Framework Migrations <a href="http://blogs.msdn.com/b/adonet/archive/2012/02/09/ef-4-3-code-based-migrations-walkthrough.aspx">blogs.msdn.com/b/adonet/archive/2012/02/09/ef-4-3-code-based-migrations-walkthrough.aspx</a> </h4>  <strong>Pros:</strong> works out of the box, automatically creates migrations by Db-context, understands commands from the visual studio console, migrations are published using the standard Publish from Visual Studio. <br>  <strong>Cons:</strong> depends on the Entity Framework. <br><hr><br>  I managed to try all 3 solutions.  If you use EF, the choice is uniquely EF Migrations, for .NHibernate you can use ECM7 Migrator.  The SSDT project is suitable for lovers of wizards and windows. <br><br><h2>  Application Publishing Automation </h2>  In 2012 studios, the web project publishing system was significantly improved.  First of all it concerns publication profiles.  If you publish the application in azure, then the profile can be simply downloaded from the portal.  Otherwise, it will need to be created. <br><img src="https://habrastorage.org/storage2/690/90b/34e/69090b34e2b6e8b40b403200b25c148e.png"><br><br><img src="https://habrastorage.org/storage2/af0/70b/b00/af070bb00af536ec33551998fcf49806.png"><br><br>  As you can see in the screenshots, in the latest version of WebDeploy, you can run EF migrations with just one tick.  In addition, the publication from the studio can replace the connection string without the use of transformation. <br>  Details about the transformation and publication is written in Troy Hunt in the article: <a href="http://www.troyhunt.com/2010/11/you-deploying-it-wrong-teamcity.html">www.troyhunt.com/2010/11/you-deploying-it-wrong-teamcity.html</a> .  Now we are interested in the fifth step of his guideline, namely, automatic publication using the build server: <a href="http://www.troyhunt.com/2010/11/you-deploying-it-wrong-teamcity_26.html">www.troyhunt.com/2010/11/you-deploying-it-wrong-teamcity_26.html</a> .  I am a big fan of TeamCity, so consider this particular CI. <br><br><h2>  Automate the publishing of Windows services </h2>  To automatically create windows services, the easiest way to use the command is sc: <br><pre> <code class="xml hljs">sc [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerName</span></span></span><span class="hljs-tag">&gt;</span></span>] create|stop|start <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServiceName</span></span></span><span class="hljs-tag">&gt;</span></span> binpath= <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BinPath</span></span></span><span class="hljs-tag">&gt;</span></span> start= demand</code> </pre><br>  The only subtle point is how to deliver the binaries to &lt;BinPath&gt;.  This can be done in different ways: upload via FTP, use PowerShell, use xcopy / robocopy or rsync in a shared folder on the server.  The choice depends on your network environment and security requirements. <br><br><h2>  TeamCity </h2>  Using the tools described above will save you time.  Go ahead and install the build server.  Download TeamCity: <a href="http://www.jetbrains.com/teamcity/">www.jetbrains.com/teamcity</a> and launch the installer, click ‚ÄúOK‚Äù everywhere. <br>  The two basic concepts of TeamCity are ‚Äúproject‚Äù and ‚Äúbuild.‚Äù  The ‚Äúproject‚Äù corresponds to your solution, and by build is meant any meaningful set of actions on your project: be it building, running tests, laying out to the server, creating backups, and so on. <br><br><h2>  Automated display </h2>  The first step is to give the opportunity to upload a new version of the theme for which Visual Studio is not installed. <br>  The basic idea is to run the msbuild step with additional parameters, create a new Build Definition and select the first step Msbuild.  The command line parameters must be passed: <br><pre> <code class="xml hljs">/P:Configuration=%env.Configuration% /P:DeployOnBuild=True /P:DeployTarget=MSDeployPublish /P:MsDeployServiceUrl=https://%env.TargetServer%/MsDeploy.axd /P:AllowUntrustedCertificate=True /P:MSDeployPublishMethod=WMSvc /P:CreatePackageOnPublish=True /P:UserName=AutoDeploy\Administrator /P:Password=Passw0rd</code> </pre><br>  These parameters will indicate where to publish. <br>  In order to publish migrations, an additional Command Line step will be required: <br><pre> <code class="xml hljs">SET AssemblyName=MyMvc4App SET StartUpDirectory=MyMvc4App\bin\ SET ConnectionString=Server=tcp:XXXX.database.windows.net,1433;Database=XXXX;User ID=XXXX;Password=XXXX;Trusted_Connection=False;Encrypt=True;Connection Timeout=30;MultipleActiveResultSets=True SET ConnectionStringProvider=System.Data.SqlClient SET ConfigFilePath=%CD%\MyMvc4App\web.config SET MigrateExe=packages\EntityFramework.5.0.0\tools\migrate.exe %MigrateExe% %AssemblyName%.dll /startUpDirectory:%StartUpDirectory% /startUpConfigurationFile:"%ConfigFilePath%" /connectionProviderName:"%ConnectionStringProvider%" /connectionString:"%ConnectionString%" /verbose</code> </pre><br>  Save the build.  Now anyone can post the latest version of VCS.  Good practice to publish on a dev-stand every day before the start of the working day.  Thus, you will catch integration problems as quickly as possible. <br><br><h2>  Rolling builds </h2>  Another good practice is to set up a trigger for a build build, which will simply start assembling your solution after each change in the repo or timer (for example, every 10 minutes), if a lot of developers are working on the project at the same time.  Notifications should be connected to this build.  TeamCity supports notifications by mail, jabber, using a plugin for VisualStudio and Tray-application.  Choose an option to taste.  I like the tray app.  If the build is broken, you need to fix it urgently. <br><br><h2>  How not to break the build </h2>  Whatever practices you enter, so that you do not, there is no way to give a 100% guarantee that developers will not contribute code to VCS that is not even going to.  This issue should be resolved with the help of administrative measures: do not quit your job, without verifying that the build was assembled after your changes, who broke it and repairs it.  In one company where I worked, the problem with too often a broken build was solved by the rule: broke the build - bring a cake.  First, cakes were eaten every day, then stopped. <br><br><h2>  Auto run tests </h2>  This step should be divided into 2: unit tests and integration and acceptance tests.  This is important because unit tests should work on any environment.  All external dependencies are replaced by fakes. <br><br><h4>  Run unit tests </h4>  Everything is simple here.  Choose Build Step ‚ÄúNunit‚Äù or ‚ÄúMsTest‚Äù, enter the pattern **. Test * .dll, TeamCity will do the rest for you, provided that you use the .Tests pattern in the name of your test projects. <br><br><h4>  Running integration and acceptance tests </h4>  These tests may depend on many factors and their launch may involve rolling backups or init scripts.  You may want to build additional reports on the launch of such tests.  It is better not to litter your project with display and create a special build for them.  TeamCity allows you to create build chains.  In Build triggers of a build with acceptance / integration tests, you can add a trigger that is triggered when the build is successfully completed with display.  I described the creation of such a build to run acceptance tests in the topic: <a href="http://habrahabr.ru/post/182032/">habrahabr.ru/post/182032</a> . <br><br><h2>  Backups </h2>  Creating backups when displaying can also be automated.  For file system backup, I personally did not find anything better than nnbackup: <a href="http://www.nncron.ru/index_ru.shtml">www.nncron.ru/index_ru.shtml</a> . <br><pre> <code class="xml hljs">nnbackup -n 10 verz -i <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Src</span></span></span><span class="hljs-tag">&gt;</span></span> -o <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Destination</span></span></span><span class="hljs-tag">&gt;</span></span> -s -e ‚Äìv</code> </pre><br>  The command creates a source folder in zip and copies the archive to the destination.  Install nnbackup on target machines or call from the build server: a question of your preferences, the location of the build server, network costs and security. <br><br>  You can back up the sql server using T-SQL <br><pre> <code class="xml hljs">BACKUP DATABASE AdventureWorks2012 TO DISK='X:\SQLServerBackups\AdventureWorks1.bak', DISK='Y:\SQLServerBackups\AdventureWorks2.bak', DISK='Z:\SQLServerBackups\AdventureWorks3.bak' WITH FORMAT, MEDIANAME = 'AdventureWorksStripedSet0', MEDIADESCRIPTION = 'Striped media set for AdventureWorks2012 database; GO RESTORE DATABASE AdventureWorks FROM DISK='$(Backup)'</code> </pre><br>  Those.  for automatic backup, you will need to add another Command Line step.  Or you can use msbuild tasks from the same community package, and for nnbackup write your msbuild task. <br>  You can go ahead and put a trigger to start an automatic rollback from backup, if acceptance tests have not passed.  Then you will have a chain of builds: Layout "Acceptance Tests" Rollback from backup. <br><br><h2>  Integration with project management system and bug tracker </h2>  Up to this point, we have already done a lot of useful things.  There was one unpleasant feature.  The build server is still unrelated to our development process.  He does not know anything about the tasks of the current iteration of development. <br>  TeamCity supports integration with YouTrack, Jira and Bugzilla.  Integration is literally done in 2 clicks.  After that, indicating the task number in the comments to the commit, you will see links to the corresponding tasks in the build information. <br>  YouTrack supports reverse integration.  Main advantage: YouTrack will automatically indicate the build number in which the bug or feature was closed. <br><br><h2>  Build artifacts </h2>  If your application is boxed, then you probably need to take care of creating installers or deploy packages for shipment to customers.  Creating installers is a separate topic, I will not consider it within the framework of this topic.  It is important that for a boxed product, an installer or publication package is the most important part of the release.  This is exactly what the artifacts of the build are made up for. <br><br>  An artifact is any file that is a significant result of a build.  For builds with installers, you can specify my-installer.exe or my-package.zip as a mask for build artifacts and TeamCity will display them in the corresponding tab. <br>  This is where integration with Issue Tracker comes in handy.  A tester or manager can look at the closed task, follow the link with the build and pick up the version with fixes from the build artifacts. <br><br>  In conclusion, I want to add that the development process is purely individual for each team.  These practices are the base.  Further development of the toolkit should occur along with the development of the product.  We develop software to make other people's lives better.  It is reasonable to use the software in order to make it more comfortable for us to work. </div><p>Source: <a href="https://habr.com/ru/post/190412/">https://habr.com/ru/post/190412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190396/index.html">Methods of anonymity online. Part 1. Just about the difficult</a></li>
<li><a href="../190400/index.html">The first quantum teleportation of information on a computer chip</a></li>
<li><a href="../190402/index.html">Square Enix forbade the artist to sell printed 3D-figures of characters of Final Fantasy VII</a></li>
<li><a href="../190404/index.html">Leap Motion Review</a></li>
<li><a href="../190406/index.html">Perl6 - Exception Handling</a></li>
<li><a href="../190414/index.html">Small survey about operating systems</a></li>
<li><a href="../190422/index.html">WiFi radio from the old radio</a></li>
<li><a href="../190424/index.html">ICANN rejects google no dotted idea</a></li>
<li><a href="../190428/index.html">Modification of stock firmware for Android. Part 4</a></li>
<li><a href="../190434/index.html">Quick view comments on Habr√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>