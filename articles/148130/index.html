<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contract "share" - data transfer in metro applications Windows 8</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Windows 8, metro applications have the ability to transfer data (Share) between applications. In the future, for simplicity, the article will use t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contract "share" - data transfer in metro applications Windows 8</h1><div class="post__text post__text-html js-mediator-article">  In Windows 8, metro applications have the ability to transfer data (Share) between applications.  In the future, for simplicity, the article will use the term " <i><b>sharing</b></i> ". <br>  For security reasons, the data transmission is controlled by the user himself and is called up from the sidebar with the corresponding charm-button Share <br><img src="http://akhmed.ru/blogimages/sharecontract/shareicon.png" alt="image"><br>  or the key combination Win + H. <br><br>  As an example, the possibility of transferring your location from maps or your favorite photo to your email application or twitter. <br><br>  The implementation of the contract "sharing" can be a very powerful marketing tool.  You can provide the opportunity to share your achievements in the game or application with friends, which can help increase the popularity of your application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here I will use the terms <b><i>application provider</i></b> for an application that ‚Äúshares‚Äù data.  And the <b><i>application-receiver</i></b> for the application which can accept the shared data. <br><a name="habracut"></a><br>  The article turned out quite voluminous and here is a brief summary of the article: <br><br>  <b>Sharing</b>  <b>Data provider</b> <b><br></b>  <b>Sharing</b>  <b>Receiver data.</b> <b><br></b>  <b>Send and receive standard formats.</b> <b><br></b>  <b><i>Sending and receiving text data formats.</i></b> <b><br></b>  <b><i>Sending and receiving links</i></b> <b><br></b>  <b><i>Sending and receiving graphics</i></b> <b><br></b>  <b><i>Sending and receiving files</i></b> <b><br></b>  <b>Sending and receiving non-standard data types</b> <b><br></b>  <b><i>Sending and receiving objects serialized to a string</i></b> <b><br></b>  <b><i>Standard "non-standard types".</i></b>  <b><i>Data based on <a href="http://schema.org/">schema.org</a> schemas</i></b> <b><br></b>  <b><i>Sending and receiving binary data</i></b> <b><br></b>  <b><i>Delayed data transfer (Data Provider Transfer).</i></b> <b><br></b>  <b><i>Proper organization of the transfer of large amounts of data (music, video)</i></b> <b><br></b>  <b>Adding links to the sharing panel (Quick links)</b> <b><br></b>  <b>We process logical errors.</b> <b><br></b>  <b>We improve the sharing of data.</b>  <b>Statistics collection</b> <b><br></b>  <b>General recommendations for the implementation of sharinga.</b>  <b>Avoid errors in implementations.</b> <b><br></b>  <b><i>Recommendations for the application provider.</i></b> <b><br></b>  <b><i>Recommendations for the application provider.</i></b> <b><br></b> <br><br>  For a detailed study of the Sharing contract, I recommend downloading two great examples of implementation in MSDN: <br>  <a href="http://code.msdn.microsoft.com/windowsapps/Sharing-Content-Source-App-d9bffd84">Sharing content source app sample</a> <br>  <a href="http://code.msdn.microsoft.com/windowsapps/Sharing-Content-Target-App-e2689782">Sharing content target app sample</a> <br><br><a name="shareSource"></a>  <b>Sharing</b>  <b>Data provider</b> <br><br>  Implementing an application that supplies data is quite simple  Suppose we want to ‚Äúshare‚Äù some text. <br><br>  On the page in the OnNavigatedTo method, add a <i>request</i> handler for sharing data.  And unsubscribe from the sharing event in the OnNavigatingFrom method <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataTransferManager.GetForCurrentView().DataRequested += Share_DataRequested; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatingFrom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigatingCancelEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataTransferManager.GetForCurrentView().DataRequested -= Share_DataRequested; }</code> </pre> <br><br>  In the handler, we can specify the data that we want to ‚Äúshare‚Äù.  Suppose we want to publish some text. <br><br><pre> <code class="hljs vbscript"> void Share_DataRequested(DataTransferManager sender, DataRequestedEventArgs args) { args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Simple notepad"</span></span>; args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.Properties.Description = <span class="hljs-string"><span class="hljs-string">"Publication of the text"</span></span>; args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.SetText(<span class="hljs-string"><span class="hljs-string">"Hello! World!"</span></span>); }</code> </pre><br><br>  The Title property is mandatory; without its indication, we will get an error when trying to ‚Äúshare‚Äù the data.  At the same time, the Description property is optional. <br><br>  Now, if we call data sharing, we will see on the right a panel with a suggestion to choose an application that can receive data. <br><br><img src="http://akhmed.ru/blogimages/sharecontract/sharecontract.png" alt="image"><br><br>  By selecting a mail application, we will receive a form where the text of the letter will already be filled out and having selected the sender we can send a letter.  The first two points are from previous activations of the mail application. <br><br><a name="shareTarget"></a>  <b>Sharing</b>  <b>Receiver.</b> <br><br>  Implementing the data receiver's receiver application is also quite simple.  Here we can use the ready-made template in the studio: <br><br><img src="http://akhmed.ru/blogimages/sharecontract/ShareTemplate.png" alt="image"><br><br>  When you select this template, we will add an entry to the manifest, redefine the method in App.xaml, and add a new page. <br><br>  We will not consider using this template and ‚Äúmanually‚Äù add the necessary elements step by step. <br><br>  First of all, in the manifest file Package.appxmanifest, you need to add support for sharing contract by the application, and specify the type of data that the application can support: <br><br><img src="http://akhmed.ru/blogimages/sharecontract/shareManifestmarkt.png" alt="image"><br><br>  Here we can see that we can also add support for Uri, Bitmap, HTML, StorageItems, RTF. <br><br>  We will look at supporting these data types and non-standard formats later. <br><br>  Next, we need to override OnShareTargetActivation in App.xaml and in this method we can send a link from where we can extract the text: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnShareTargetActivated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ShareTargetActivatedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> frame = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Frame(); frame.Navigate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TargetPage), args.ShareOperation); Window.Current.Content = frame; Window.Current.Activate(); }</code> </pre><br><br>  Now on the TargetPage page, we can extract the transmitted text.  For simplicity, add a TextBlock to the page and set the text property for it. <br><br>  To do this, override the OnNavigateTo method in the page code and extract the text. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation)e.Parameter; txtBlock.Text=<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetTextAsync(); } }</code> </pre><br><br>  It's all.  Now, if we install the receiver application and then start the sending application and selecting our receiving application during sharing, we can see the following window: <br><br><img src="http://akhmed.ru/blogimages/sharecontract/shareheader.png" alt="image"><br><br>  Our application received a passed string from another application. <br><br>  What should pay attention.  The application is displayed in the side pop-up panel with a title.  This circumstance should be taken into account when planning the design of the receiver page.  (Perhaps there will be a different value in the release, but on several different monitors I had a panel width of 645 pixels). <br><br>  Also, we cannot influence the title - the receiver page will be activated with a title (back arrow, the name of the application and the logo of our application).  In this regard, you do not need to work out the navigation on this page.  Ideally, this should be one page without any navigation. <br><br><a name="shareSendAndReceiveSimpleData"></a>  <b>Send and receive standard formats.</b> <br><br>  Quite often we need to transfer and receive slightly more complex data formats rather than strings.  For the most commonly requested formats, the appropriate API support has been added.  We can transfer as standard formats Text, Rtf, Html, Uri, Bitmap, StorageItems (files).  Each of them can be transmitted simultaneously.  Those.  we can simultaneously send and extract, for example, Text, Html and Bitmap <br><br><a name="shareSendAndReceiveSimpleData_Text"></a>  <i><b>Sending and receiving text data formats</b></i> <br><br>  The first three formats Text, Rtf, Html are transmitted and received in the same way: <br><br>  Broadcast: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Request</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.SetText</span></span>("..."); <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Request</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.SetRtf</span></span>("..."); <span class="hljs-selector-tag"><span class="hljs-selector-tag">args</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Request</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.SetHtmlFormat</span></span>("...");</code> </pre><br><br>  Reception: <br><br>  First of all, to support the ‚Äúreception‚Äù of the Text, HTML, Uri formats, we add the corresponding entry to the manifest. <br><br>  And the corresponding data acquisition code: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.GetTextAsync</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.GetRtfAsync</span></span>(); <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.GetHtmlFormatAsync</span></span>();</code> </pre><br><br>  If we support several formats at once, then most likely we will receive only one specific data type and we should check the ‚Äúcontent‚Äù of the data in the package. <br><br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">Contains</span></span>(<span class="hljs-type"><span class="hljs-type">StandardDataFormats</span></span>.<span class="hljs-type"><span class="hljs-type">Text</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">GetTextAsync</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">Contains</span></span>(<span class="hljs-type"><span class="hljs-type">StandardDataFormats</span></span>.<span class="hljs-type"><span class="hljs-type">Html</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">GetHtmlFormatAsync</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">Contains</span></span>(<span class="hljs-type"><span class="hljs-type">StandardDataFormats</span></span>.<span class="hljs-type"><span class="hljs-type">Rtf</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rtf = shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">GetRtfAsync</span></span>(); }</code> </pre><br><br><a name="shareSendAndReceiveSimpleData_link"></a>  <i><b>Sending and receiving links</b></i> <br><br>  Transmission and reception of Uri is almost identical: <br><br><pre> <code class="hljs vbscript">args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.SetUri(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://akhmed.ru/post/2012/07/19/share_contract_win8.aspx"</span></span>));</code> </pre><br><br>  Reception: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Data</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.GetUriAsync</span></span>();</code> </pre> <br><br><a name="shareSendAndReceiveSimpleData_Image"></a>  <i><b>Sending and receiving graphics</b></i> <br><br>  A bit more interesting is the transmission and reception of the picture. <br><br>  Can be transferred as pictures from another server <br><br><pre> <code class="hljs vbscript">args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.SetBitmap(RandomAccessStreamReference.CreateFromUri(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://freshyourmood.com/wp-content/uploads/2012/04/pure-water-aquatecuk.wordpress.com_.jpg"</span></span>)));</code> </pre><br><br>  so and local from the project <br><br><pre> <code class="hljs vbscript">args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.SetBitmap(RandomAccessStreamReference.CreateFromUri(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"ms-appx:///apple.jpg"</span></span>)));</code> </pre><br><br>  extracting a picture is also quite a simple operation.  First, add the appropriate entry to the manifest of the receiving application: Bitmap. <br><br>  Next, for example, we will display the text and image on the page in the corresponding xaml code: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"img"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txtBlock"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"24"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start page text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource HeaderTextStyle}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The code to "extract" data: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation) e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shareOperation.Data.Contains(StandardDataFormats.Text)) { txtBlock.Text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetTextAsync(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shareOperation.Data.Contains(StandardDataFormats.Bitmap)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bitmapReference = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetBitmapAsync(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bitmapImage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BitmapImage(); bitmapImage.SetSource(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bitmapReference.OpenReadAsync()); img.Source = bitmapImage; } } }</code> </pre><br><br>  And we can admire the result: <br><br><img src="http://akhmed.ru/blogimages/sharecontract/ShareBitmap.png" alt="image"><br><br>  By the same principle, we can transfer images of icons.  The syntax looks a little different. <br><br>  Broadcast: <br><br><pre> <code class="hljs vbscript"> args.<span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>.Data.Properties.Thumbnail = RandomAccessStreamReference.CreateFromUri(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"ms-appx:///apple.jpg"</span></span>));</code> </pre> <br><br>  Reception: <br><br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bitmapReference = shareOperation.<span class="hljs-type"><span class="hljs-type">Data</span></span>.<span class="hljs-type"><span class="hljs-type">Properties</span></span>.<span class="hljs-type"><span class="hljs-type">Thumbnail</span></span>;</code> </pre> <br><br>  Thus, we can transmit two pictures at once, but for performance reasons, the second approach is used only if the pictures are located locally and they are not large. <br><br><a name="shareSendAndReceiveSimpleData_files"></a>  <i><b>Sending and receiving files</b></i> <br><br>  Through contracts we can transfer files available in the system.  By default, in WinRT we do not have direct access to the file system and we can transfer files received, for example, through the FilePicker contract.  In general, working with files deserves a separate article, but using FilePicker is very easy. <br><br>  For example, while working with an application, we can load several files into our application. <br><br>  For simplicity, add a button by clicking on which we select the files: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LoadFiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LoadFiles_Click"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Left"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"268,82,0,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"139"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br><br>  And save the link to the files selected by the user: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IReadOnlyList&lt;StorageFile&gt; files; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFiles_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> filePicker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOpenPicker { FileTypeFilter = {<span class="hljs-string"><span class="hljs-string">"*"</span></span>} }; files = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> filePicker.PickMultipleFilesAsync(); }</code> </pre><br><br>  Now, we will indicate to the event of calling the sharing that we want to transfer these files: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"file sharing"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(files!=<span class="hljs-literal"><span class="hljs-literal">null</span></span>) { args.Request.Data.SetStorageItems(files); } }</code> </pre><br><br>  The implementation of the ‚Äúreceiver‚Äù of files is also quite simple.  In the manifest, we need to add support for StorageItems files or tick Supports any file types <br><br>  Next, for example, we will list the files in the ListBox: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"listBox"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListBox</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And we tie the names of the received files to this list. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation)e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> files=<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetStorageItemsAsync(); listBox.ItemsSource = files.Select(i=&gt;i.Name); } }</code> </pre><br><br>  As a result, we can see about the following result: <br><br><img src="http://akhmed.ru/blogimages/sharecontract/sharefiles.png" alt="image"><br><br><a name="shareSendAndReceiveCustomData"></a>  <b>Sending and receiving non-standard data types.</b> <br><br>  Having standard formats greatly simplifies work for most scenarios.  But still, quite often scripts will be needed when none of the formats are suitable for us.  Suppose we have an application that works with a list of products.  We have many fields, some of which are optional (Name, price, category, brand, unit of measure, etc.).  Now, if we have another application that can also work with this format of products and we want to add the ability to put data in the form that we have another application. <br><br><a name="shareSendAndReceiveCustomData_String"></a>  <i><b>Sending and receiving objects serialized to a string.</b></i> <br><br>  We can serialize our data to some format (CSV, XML, JSON) and parse it for receiving.  But standard formats will not suit us.  Firstly, if we use Text or another format for this, then all applications that support the standard format will open and selecting the mail application, the user will see a letter filled with some incomprehensible text.  In addition, we still want to keep the ability to use Text or HTML format in order to be able to send data to another user a list of products without details. <br><br>  In this case, a special data format can help us. <br><br>  First of all, we need to come up with a name for the format, for example, Product.  (Perhaps, before or after us, someone will come up with a brilliant idea to use a format with the same name and also name its format Product, to avoid conflicts you can use Product_ {GUID} (For example, Product_F6FBDBFB-5703-44F6-ACBE-A2D25EF4D6CE). Here for simplicity, keep the Product). <br><br>  Suppose both in the receiver and the vendor we have the following class Product: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Product</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Count { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  And the serializer: <br><br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">JsonSerializer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Serialize&lt;T&gt;(T item) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSerializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(); dataSerializer.WriteObject(ms,item); ms.Position = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(ms).ReadToEnd(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T Deserialize&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSerializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T)dataSerializer.ReadObject(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(Encoding.UTF8.GetBytes(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>))); } }</code> </pre><br><br>  In the application provider, we can now serialize the product and send specifying the format identifier: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Product sharing"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product() { Name = <span class="hljs-string"><span class="hljs-string">"Bread"</span></span>, Count = <span class="hljs-number"><span class="hljs-number">2</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productJson = JsonSerializer.Serialize(product); args.Request.Data.SetData(<span class="hljs-string"><span class="hljs-string">"product"</span></span>,productJson); }</code> </pre><br><br>  The implementation of the "recipient": <br><br>  In the recipient application, we must indicate in the manifest that we now support the product format and can use the following code to get the product: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation)e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shareOperation.Data.Contains(<span class="hljs-string"><span class="hljs-string">"product"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productJson = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetTextAsync(<span class="hljs-string"><span class="hljs-string">"product"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = JsonSerializer.Deserialize&lt;Product&gt;(productJson); txtBlock.Text = product.Name + <span class="hljs-string"><span class="hljs-string">" "</span></span> + product.Count; } } }</code> </pre><br><br>  By running the application you can see that our data has been successfully transferred. <br><br><img src="http://akhmed.ru/blogimages/sharecontract/ShareCustomData.png" alt="image"><br><br>  In this case, we passed and received the usual string in a special form.  We can still get the string without specifying the format GetTextAsync (); <br><br><a name="shareSendAndReceiveCustomData_SchemaOrg"></a>  <i><b>Standard "non-standard types".</b></i>  <i><b>Data based on <a href="http://schema.org/">schema.org</a> schemas</b></i> <br><br>  You may want to use not your own private data format, but which one of the commonly accepted formats. <br><br>  For example, if there are other applications that work with products, then it makes sense to organize the reception and transmission of data with these applications. <br><br>  It is officially recommended in such cases to use schemas on the <a href="http://schema.org/">schema.org</a> resource. <br><br>  First of all, we need to decide on the type of entity (books, music, films, products) <br><br>  By selecting the appropriate entity, we must send or receive a string in JSON according to the schema data. <br><br>  Suppose we chose the ‚ÄúProduct‚Äù entity (http://schema.org/Product) <br><br>  <i>Implementing provider application:</i> <br><br>  Data transfer is completely analogous to the transfer of the own format discussed above, the only difference is in the JSON format: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Product sharing"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productFormat = <span class="hljs-string"><span class="hljs-string">@"{ ""type"" : ""http://schema.org/Product"", ""properties"" : { ""name"" : ""{0}"", ""description"" : ""{1}"", ""productID"" : ""{2}"" } }"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productJson = String.Format(productFormat, <span class="hljs-string"><span class="hljs-string">"Olive oil"</span></span>, <span class="hljs-string"><span class="hljs-string">"description of product"</span></span>, <span class="hljs-string"><span class="hljs-string">"8410660101481"</span></span>); args.Request.Data.SetData(<span class="hljs-string"><span class="hljs-string">"http://schema.org/Product"</span></span>,productJson); }</code> </pre><br><br>  <i>Receiver application implementation</i> <br><br>  To support this schema, we must specify the data format of <a href="http://schema.org/Product">schema.org/Product</a> in the manifest. <br><br><img src="http://akhmed.ru/blogimages/sharecontract/SchemaOrgMarkt.png" alt="image"><br><br>  Reading data is carried out similarly to reading the line that we considered above: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { shareOperation = (ShareOperation)e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productJson = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetTextAsync(<span class="hljs-string"><span class="hljs-string">"http://schema.org/Product"</span></span>); JsonObject productObject = JsonObject.Parse(productJson); JsonObject properties = productObject[<span class="hljs-string"><span class="hljs-string">"properties"</span></span>].GetObject(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productId = properties[<span class="hljs-string"><span class="hljs-string">"productID"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productName = properties[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productDescriptions = properties[<span class="hljs-string"><span class="hljs-string">"description"</span></span>]; } }</code> </pre><br><br><a name="shareSendAndReceiveCustomData_Binary"></a>  <i><b>Sending and receiving binary data</b></i> <br><br>  In some cases it is easier to transfer binary data instead of a string.  (For example, we have djvu editor and we want to transfer raw data). <br><br>  We can open the file by passing the link to the stream from the open file and reading this stream in the receiver's application. <br><br>  Consider a more interesting example of transferring data from a stream in memory: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Product sharing"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product() { Name = <span class="hljs-string"><span class="hljs-string">"Bread"</span></span>, Count = <span class="hljs-number"><span class="hljs-number">2</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InMemoryRandomAccessStream(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> writer=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataWriter(stream)) { writer.WriteInt32(product.Name.Length); writer.WriteString(product.Name); writer.WriteInt32(product.Count); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.StoreAsync(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.FlushAsync(); writer.DetachStream(); } stream.Seek(<span class="hljs-number"><span class="hljs-number">0</span></span>); args.Request.Data.SetData(<span class="hljs-string"><span class="hljs-string">"product"</span></span>, stream); }</code> </pre><br><br>  In the receiver application, we can read and parse this stream. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation)e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shareOperation.Data.Contains(<span class="hljs-string"><span class="hljs-string">"product"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> shareOperation.Data.GetDataAsync(<span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IRandomAccessStream; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamReader=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> streamReader.LoadAsync((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) stream.Size); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> len = streamReader.ReadInt32(); product.Name = streamReader.ReadString((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) len); product.Count = streamReader.ReadInt32(); } txtBlock.Text = product.Name + <span class="hljs-string"><span class="hljs-string">" "</span></span> + product.Count; } } }</code> </pre><br><br><a name="shareSendAndReceiveCustomData_DataProvider"></a>  <i><b>Delayed data submission (Data Provider Transfer)</b></i> <br><br>  In the previous example, there is a significant drawback.  We initialize and prepare the data always - even if later the user does not use the application and cancels the sharing operation.  Alternatively, we can share not the data but the data provider and the application the receiver can read the data after it has been activated by the user.  Rework the last example with a data provider using a data provider. <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Product sharing"</span></span>; args.Request.Data.SetDataProvider(<span class="hljs-string"><span class="hljs-string">"product"</span></span>,BinaryDataHandler); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BinaryDataHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataProviderRequest request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product() { Name = <span class="hljs-string"><span class="hljs-string">"Bread"</span></span>, Count = <span class="hljs-number"><span class="hljs-number">2</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InMemoryRandomAccessStream(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataWriter(stream)) { writer.WriteInt32(product.Name.Length); writer.WriteString(product.Name); writer.WriteInt32(product.Count); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.StoreAsync(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.FlushAsync(); writer.DetachStream(); } stream.Seek(<span class="hljs-number"><span class="hljs-number">0</span></span>); request.SetData(stream); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { request.GetDeferral().Complete(); } }</code> </pre><br><br>  The main advantage of this approach is that now the sharing dialog will appear faster, the BinaryDataHandler method will only be called AFTER the selection of a specific application.  And if the user cancels the sharing operation, the method will not be called at all. <br><br><a name="shareSendAndReceiveCustomData_recomendation"></a>  <i><b>Proper organization of the transfer of large amounts of data (music, video)</b></i> <br><br>  In cases where the application delivers a large amount of data, we should not force the user to wait until all data has been transferred. <br><br>  In those cases when we have already finished receiving data and if we carried out all the necessary actions in the interface (for example, we clicked the Send button on the mail interface or the Save button, where we clearly need confirmation from the user), we can call the method: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReportCompleted</span></span>();</code> </pre><br><br>  Which notifies the system that all data transfer operations have been completed and results in closing the sharing interface of the receiver's application. <br><br>  In cases where the amount of transmitted data is too large, we should not keep the user waiting. <br><br>  We can call the method <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReportStarted</span></span>();</code> </pre><br><br>  Before retrieving a large data packet, which will cause the transfer process to begin but will hide the sharing interface and allow the user to continue working. <br><br>  Next we have to call the method <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReportDataRetreived</span></span>();</code> </pre><br><br>  Which notifies the system that we have already extracted all the necessary data and the original application can be released (in case the user closed it before). <br><br>  Upon completion of the transfer, we can call the method <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReportCompleted</span></span>();</code> </pre> <br><br>  or method <br><br><pre> <code class="hljs objectivec">shareOperation.ReportError(<span class="hljs-string"><span class="hljs-string">"error description"</span></span>);</code> </pre> <br><br>  To notify the system of success or error during data transfer. <br><br>  In the latter case, the user will receive an error notification and may look at the error if he opens the sharing again and follows the link below to check the transfer status. <br><br>  In the event that the data transfer application uses BackgroundTransferTask, we can notify the system that we use this data transfer method by calling the appropriate method: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReportSubmittedBackgroundTask</span></span>();</code> </pre><br><br><a name="quckLink"></a>  <b>Adding links to the sharing panel.</b> <br><br>  Suppose in the application of the receiver after the transfer of data have to do additional operations.  For example, when we send text to an email application, the user must also select the addressee to whom he will send the message.  In this case, the email application creates a quick link to the last action.  Next time choosing this quick link in the ‚Äúto‚Äù field will be filled with the corresponding entry. <br><br>  Suppose that there is no single list of products in our receiver application.  There is a list of lists of products.  If the user selected the application and selected the list where he wants to transfer the product, we can provide a quick link to this list. <br><br>  Consider how you can add a quick link to our receiving application: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonSaveLink_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> quickLinkInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QuickLink { Id = <span class="hljs-string"><span class="hljs-string">"homeListId"</span></span>, Title = <span class="hljs-string"><span class="hljs-string">"Add to Home list"</span></span>, SupportedFileTypes = { <span class="hljs-string"><span class="hljs-string">"*"</span></span> }, SupportedDataFormats = { <span class="hljs-comment"><span class="hljs-comment">//   StandardDataFormats.Bitmap, "product" } }; try { var iconFile = await Package.Current.InstalledLocation.CreateFileAsync("assets\\Logo.png", CreationCollisionOption.OpenIfExists); quickLinkInfo.Thumbnail = RandomAccessStreamReference.CreateFromFile(iconFile); shareOperation.ReportCompleted(quickLinkInfo); } catch (Exception) { shareOperation.ReportCompleted(); throw; } }</span></span></code> </pre><br><br>  Relevant code in XAML <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Save"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ButtonSaveLink_Click"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><br>  Now, if we click the Save button in the receiver application, we will see that the next time we share the quick link with us. <br><br><img src="http://akhmed.ru/blogimages/sharecontract/ShareSaveQuickLink.png" alt="image"><br><br>  Now the next time we can simplify the same type of action, by determining which of the quick links the user clicked. <br><br><pre> <code class="hljs objectivec"> shareOperation = (ShareOperation)e.Parameter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shareOperation.QuickLinkId==<span class="hljs-string"><span class="hljs-string">"homeListId"</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//handle selected list }</span></span></code> </pre><br><br>  Why not add this link automatically?  Because the user may not take any action after the application is activated. <br><br>  The sharing API is specifically designed so that adding a link minimizes the receiving application.  Accordingly, adding the link should be the last operation that can be done.  Those.  if we have selected the receiver application and selecting the list, we immediately save and add a quick link.  Or by selecting the list, we give the opportunity to change your choice and save to the selected list only after clicking the Save button. <br><br>  If the link is no longer relevant, we can remove the quick link from our application.  (For example, there is no longer a list with this identifier). <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">shareOperation</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.RemoveThisQuickLink</span></span>();</code> </pre><br><br><a name="sharingLogicError"></a>  <b>We process logical errors.</b> <br><br>  If the source application page does not support data sharing when trying to share, the user will see the message ‚ÄúThis app can't share.‚Äù <br><br>              .              (             ). <br><br>   ,                   . <br><br>  For example: <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Share_DataRequested</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, DataRequestedEventArgs args</span></span></span><span class="hljs-function">)</span></span> { args.Request.Data.Properties.Title = <span class="hljs-string"><span class="hljs-string">"Product sharing"</span></span>; args.Request.FailWithDisplayText(<span class="hljs-string"><span class="hljs-string">"please select products for sharing"</span></span>); }</code> </pre><br><br>         ¬´¬ª : <br><br><img src="http://akhmed.ru/blogimages/sharecontract/ShareError.png" alt="image"><br><br><a name="sharingStatistics"></a> <b>  .  </b> <br><br>         API   .               . <br><br>    ,               . <br><br>                               . <br><br>          .           <br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataTransferManager.GetForCurrentView().DataRequested += Share_DataRequested; DataTransferManager.GetForCurrentView().TargetApplicationChosen += ShareText_TargetApplicationChosen; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatingFrom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigatingCancelEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataTransferManager.GetForCurrentView().DataRequested -= Share_DataRequested; DataTransferManager.GetForCurrentView().TargetApplicationChosen -= ShareText_TargetApplicationChosen; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShareText_TargetApplicationChosen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTransferManager sender, TargetApplicationChosenEventArgs args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targetAppName = args.ApplicationName; <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similarly, in the receiver application, we can find out from which application the data is delivered to us. </font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Parameter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shareOperation = (ShareOperation)e.Parameter; <span class="hljs-comment"><span class="hljs-comment">//   var sourceAppName = shareOperation.Data.Properties.ApplicationName; //Url      (null    ) var sourceAppMarketUrl = shareOperation.Data.Properties.ApplicationListingUri; //  } }</span></span></code> </pre><br><br><a name="sharingRecomendation"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General recommendations for the implementation of sharinga. </font><font style="vertical-align: inherit;">Avoid errors in implementations. </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not all recommendations presented here are official, I wrote a part of the recommendations from myself and should be taken critically.</font></font><br><br><a name="sharingRecomendation_Sender"></a> <i><b>  -.</b></i> <br><br>         .             .                  ,      . <br><br>                    ( OnNavigateTo, OnNavigateFrom).            . <br><br>          ,       ,               (             ). <br><br>       .        ,      Text  Html          ,  ,  . <br><br>       ,      ,       . <br><br>               (             ,    ,        ).   -   . <br><br>         ,           . <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">DataTransferManager</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ShowShareUI</span></span>();</code> </pre><br><br><a name="sharingRecomendation_Target"></a> <i><b>  -.</b></i> <br><br>            .        : shareOperation.Data.AvailableFormats <br><br>         shareOpertaion.Data.Contains(); <br><br>     ,   ,   ..   ,   shareOperation.Report‚Ä¶();               . <br><br>              . <br><br>       <a href="http://scheme.org/">scheme.org</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> always assume that the data will come in the wrong format and conduct the appropriate checks and error handling. </font></font></div><p>Source: <a href="https://habr.com/ru/post/148130/">https://habr.com/ru/post/148130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148125/index.html">Entity Framework is now open source</a></li>
<li><a href="../148126/index.html">Microsoft apologized for "insulting" in the Linux kernel</a></li>
<li><a href="../148127/index.html">Internet Security League creates an emergency network</a></li>
<li><a href="../148129/index.html">What are the established practices or traditions in your company?</a></li>
<li><a href="../14813/index.html">Trojan-downloader.JS.Psyme.cz on the site radio-t.com</a></li>
<li><a href="../148131/index.html">Which authentication option on the sites you choose?</a></li>
<li><a href="../148132/index.html">Microsoft believes in the Mayan calendar</a></li>
<li><a href="../148133/index.html">Created high-performance graphene transistor</a></li>
<li><a href="../148134/index.html">OOP. Unhurried conversation near the cooler</a></li>
<li><a href="../148135/index.html">Man: evolution of technology or technology of evolution?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>