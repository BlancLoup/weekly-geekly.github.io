<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization of Moscow Exchange data using InterSystems DeepSee</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 The InterSystems technology stack has technology for developing DeepSee analytical solutions. This is an embedded analytical technolo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization of Moscow Exchange data using InterSystems DeepSee</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vvedenie">  Introduction </h2><br><p>  The InterSystems technology stack has technology for developing <a href="http://www.intersystems.com/ru/our-products/embedded-technologies/deepsee/">DeepSee</a> analytical solutions.  This is an embedded analytical technology and a set of tools for creating effective decision support systems, including using predictive models.  DeepSee works with structured and unstructured data.  It is designed to create OLAP solutions for Cach√© databases and any relational database management system.  InterSystems DeepSee provides developers with the tools to integrate analytical OLAP functionality into their applications, which is able to work on operational application databases without creating a separate infrastructure for solving analytical problems. </p><br><p>  The article discusses an example of creating in an OLAP-cube, working with analytics tools and building a user interface using the example of analyzing stock quotes traded on the Moscow Exchange. </p><a name="habracut"></a><br><h2 id="etapy">  Stages </h2><br><ul><li>  Data acquisition </li><li>  ETL </li><li>  Build a cube </li><li>  Pivot table construction </li><li>  Building dashboards </li><li>  Visualization </li></ul><br><h2 id="poluchenie-dannyh">  Data acquisition </h2><br><p>  To visualize stock quote data, you must first download it.  The Moscow Exchange has a publicly documented <a href="http://www.moex.com/a2193">API</a> that provides information on stock trading in HTML, XML, JSON, CSV formats. </p><br><p> Here, for example, <a href="">XML data</a> for May 27, 2013.  Create an <a href="">XML-Enabled</a> <code>Ticker.Data</code> class in the InterSystems platform: </p><br><div class="spoiler">  <b class="spoiler_title">Ticker.Data</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> Ticker.Data Extends (%Persistent, %<span class="hljs-type"><span class="hljs-type">XML</span></span>.Adaptor) { ///   Property <span class="hljs-type"><span class="hljs-type">Date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Date</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">FORMAT</span></span> = <span class="hljs-number"><span class="hljs-number">3</span></span>, XMLNAME = "TRADEDATE", XMLPROJECTION = "attribute"); ///    Property <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String(XMLNAME = "SHORTNAME", XMLPROJECTION = "attribute"); ///  Property Ticker <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String(XMLNAME = "SECID", XMLPROJECTION = "attribute"); ///   Property Trades <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>(XMLNAME = "NUMTRADES", XMLPROJECTION = "attribute"); ///    Property <span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "VALUE", XMLPROJECTION = "attribute"); ///   Property <span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "OPEN", XMLPROJECTION = "attribute"); ///   Property <span class="hljs-keyword"><span class="hljs-keyword">Close</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "CLOSE", XMLPROJECTION = "attribute"); ///    Property CloseLegal <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "LEGALCLOSEPRICE", XMLPROJECTION = "attribute"); ///    Property Low <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "LOW", XMLPROJECTION = "attribute"); ///    Property High <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "HIGH", XMLPROJECTION = "attribute"); ///    http://www.moex.com/s1194 ///          . Property Average <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Decimal</span></span>(XMLNAME = "WAPRICE", XMLPROJECTION = "attribute"); ///      Property Volume <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>(XMLNAME = "VOLUME", XMLPROJECTION = "attribute"); }</code> </pre> </div></div><br><p>  And write the data loader in XML format.  Since the class is XML-Enabled, then the conversion from XML to objects of the Ticker.Data class occurs automatically.  Similar behavior can be achieved for data in JSON formats (via <a href="">dynamic objects</a> ) and CSV (using <a href="">% SQL.Util.Procedures</a> ).  Since the API gives data for a certain date (day), we need to iterate by day and store incoming data.  In addition, data on stock quotes come in pages of 100 entries.  The bootloader might look like this: </p><br><div class="spoiler">  <b class="spoiler_title">Data loader</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk">///       <span class="hljs-type"><span class="hljs-type">From</span></span>   <span class="hljs-type"><span class="hljs-type">To</span></span>. <span class="hljs-type"><span class="hljs-type">Purge</span></span> -       ///  <span class="hljs-type"><span class="hljs-type">From</span></span>, <span class="hljs-type"><span class="hljs-type">To</span></span> - <span class="hljs-type"><span class="hljs-type">YYYY</span></span>-<span class="hljs-type"><span class="hljs-type">MM</span></span>-<span class="hljs-type"><span class="hljs-type">DD</span></span> /// <span class="hljs-type"><span class="hljs-type">Write</span></span> <span class="hljs-string"><span class="hljs-string">$S</span></span>ystem.<span class="hljs-type"><span class="hljs-type">Status</span></span>.<span class="hljs-type"><span class="hljs-type">GetErrorText</span></span>(#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(<span class="hljs-type"><span class="hljs-type">Ticker</span></span>.<span class="hljs-type"><span class="hljs-type">Loader</span></span>).<span class="hljs-type"><span class="hljs-type">Populate</span></span>()) <span class="hljs-type"><span class="hljs-type">ClassMethod</span></span> <span class="hljs-type"><span class="hljs-type">Populate</span></span>(<span class="hljs-type"><span class="hljs-type">From</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Date</span></span>(<span class="hljs-type"><span class="hljs-type">DISPLAY</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-comment"><span class="hljs-comment">"2013-03-25"</span></span>, <span class="hljs-type"><span class="hljs-type">To</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Date</span></span>(<span class="hljs-type"><span class="hljs-type">DISPLAY</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span>) = {<span class="hljs-string"><span class="hljs-string">$Z</span></span>Date(<span class="hljs-string"><span class="hljs-string">$H</span></span>orolog,<span class="hljs-number"><span class="hljs-number">3</span></span>)}, <span class="hljs-type"><span class="hljs-type">Purge</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Boolean</span></span> = {<span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$Y</span></span>ES}) { <span class="hljs-symbol"><span class="hljs-symbol">#Dim</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Status</span></span> = <span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$O</span></span>K //         <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">FromH</span></span> = <span class="hljs-string"><span class="hljs-string">$Z</span></span>DateH(<span class="hljs-type"><span class="hljs-type">From</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">ToH</span></span> = <span class="hljs-string"><span class="hljs-string">$Z</span></span>DateH(<span class="hljs-type"><span class="hljs-type">To</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-type"><span class="hljs-type">Do</span></span>:<span class="hljs-type"><span class="hljs-type">Purge</span></span> ..<span class="hljs-type"><span class="hljs-type">Purge</span></span>() <span class="hljs-type"><span class="hljs-type">For</span></span> <span class="hljs-type"><span class="hljs-type">DateH</span></span> = <span class="hljs-type"><span class="hljs-type">FromH</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-type"><span class="hljs-type">ToH</span></span> { <span class="hljs-type"><span class="hljs-type">Write</span></span> <span class="hljs-string"><span class="hljs-string">$c</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>), <span class="hljs-comment"><span class="hljs-comment">"Populating "</span></span>, <span class="hljs-string"><span class="hljs-string">$Z</span></span>Date(<span class="hljs-type"><span class="hljs-type">DateH</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> = ..<span class="hljs-type"><span class="hljs-type">PopulateDay</span></span>(<span class="hljs-type"><span class="hljs-type">DateH</span></span>) <span class="hljs-type"><span class="hljs-type">Quit</span></span>:<span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$I</span></span>SERR(<span class="hljs-type"><span class="hljs-type">Status</span></span>) } <span class="hljs-type"><span class="hljs-type">Quit</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> } ///    .     <span class="hljs-number"><span class="hljs-number">100</span></span> . /// <span class="hljs-type"><span class="hljs-type">Write</span></span> <span class="hljs-string"><span class="hljs-string">$S</span></span>ystem.<span class="hljs-type"><span class="hljs-type">Status</span></span>.<span class="hljs-type"><span class="hljs-type">GetErrorText</span></span>(#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(<span class="hljs-type"><span class="hljs-type">Ticker</span></span>.<span class="hljs-type"><span class="hljs-type">Loader</span></span>).<span class="hljs-type"><span class="hljs-type">PopulateDay</span></span>(<span class="hljs-string"><span class="hljs-string">$H</span></span>orolog)) <span class="hljs-type"><span class="hljs-type">ClassMethod</span></span> <span class="hljs-type"><span class="hljs-type">PopulateDay</span></span>(<span class="hljs-type"><span class="hljs-type">DateH</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Date</span></span>) <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Status</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">#Dim</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Status</span></span> = <span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$O</span></span>K <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Reader</span></span> = #<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%<span class="hljs-type"><span class="hljs-type">XML</span></span>.<span class="hljs-type"><span class="hljs-type">Reader</span></span>).%<span class="hljs-type"><span class="hljs-type">New</span></span>() <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Date</span></span> = <span class="hljs-string"><span class="hljs-string">$Z</span></span>Date(<span class="hljs-type"><span class="hljs-type">DateH</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) //       <span class="hljs-type"><span class="hljs-type">YYYY</span></span>-<span class="hljs-type"><span class="hljs-type">MM</span></span>-<span class="hljs-type"><span class="hljs-type">DD</span></span> <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Count</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> //    <span class="hljs-type"><span class="hljs-type">While</span></span> <span class="hljs-type"><span class="hljs-type">Count</span></span> <span class="hljs-string"><span class="hljs-string">'= $G(CountOld) { Set CountOld = Count Set Status = Reader.OpenURL(..GetURL(Date, Count)) //     Quit:$$$ISERR(Status) //    row ==   Ticker.Data Do Reader.Correlate("row", "Ticker.Data") //    row    Ticker.Data While Reader.Next(.Object, .Status) { #Dim Object As Ticker.Data //   If Object.Ticker '</span></span>=<span class="hljs-comment"><span class="hljs-comment">""</span></span> { <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> = <span class="hljs-type"><span class="hljs-type">Object</span></span>.%<span class="hljs-type"><span class="hljs-type">Save</span></span>() <span class="hljs-type"><span class="hljs-type">Quit</span></span>:<span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$I</span></span>SERR(<span class="hljs-type"><span class="hljs-type">Status</span></span>) <span class="hljs-type"><span class="hljs-type">Set</span></span> <span class="hljs-type"><span class="hljs-type">Count</span></span> = <span class="hljs-type"><span class="hljs-type">Count</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> } } <span class="hljs-type"><span class="hljs-type">Quit</span></span>:(<span class="hljs-type"><span class="hljs-type">Count</span></span>-<span class="hljs-type"><span class="hljs-type">CountOld</span></span>)&lt;<span class="hljs-number"><span class="hljs-number">100</span></span> //     <span class="hljs-number"><span class="hljs-number">100</span></span>  =&gt;   -  } <span class="hljs-type"><span class="hljs-type">Quit</span></span> <span class="hljs-type"><span class="hljs-type">Status</span></span> } ///  <span class="hljs-type"><span class="hljs-type">URL</span></span>        <span class="hljs-type"><span class="hljs-type">Date</span></span>,   <span class="hljs-type"><span class="hljs-type">Start</span></span>  <span class="hljs-type"><span class="hljs-type">ClassMethod</span></span> <span class="hljs-type"><span class="hljs-type">GetURL</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>, <span class="hljs-type"><span class="hljs-type">Start</span></span> <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>) [ <span class="hljs-type"><span class="hljs-type">CodeMode</span></span> = expression ] { <span class="hljs-string"><span class="hljs-string">$$</span></span><span class="hljs-string"><span class="hljs-string">$F</span></span>ormatText(<span class="hljs-comment"><span class="hljs-comment">"http://iss.moex.com/iss/history/engines/stock/markets/shares/boards/tqbr/securities.xml?date=%1&amp;start=%2"</span></span>, <span class="hljs-type"><span class="hljs-type">Date</span></span>, <span class="hljs-type"><span class="hljs-type">Start</span></span>) }</code> </pre></div></div><br><p>  Now load the data with the command: <code>Write $System.Status.GetErrorText(##class(Ticker.Loader).Populate())</code> </p><br><p>  All code is available in the <a href="https://github.com/intersystems-ru/Ticker/">repository</a> . </p><br><h2 id="etl">  ETL </h2><br><p>  As you know, to build an OLAP cube, you first need to create <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25B8%25D1%2586%25D0%25B0_%25D1%2584%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B2">a fact</a> table: an operations table whose records you want to group and filter.  The fact table can be linked to other tables in a <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2585%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25B7%25D0%25B2%25D0%25B5%25D0%25B7%25D0%25B4%25D1%258B">star</a> or <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2585%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2581%25D0%25BD%25D0%25B5%25D0%25B6%25D0%25B8%25D0%25BD%25D0%25BA%25D0%25B8">snowflake</a> pattern. </p><br><p>  The fact table for a cube is usually the result of the work of analysts and developers on a process called <a href="https://ru.wikipedia.org/wiki/ETL">ETL</a> (extract, transform, load).  Those.  ‚Äúsqueeze‚Äù of data required for analysis is made from the data of the subject area, and transferred to the star / snowflake structure that is convenient for storage: facts and fact reference books. </p><br><p>  In our case, we skip the ETL stage.  Our <code>Ticker.Data</code> class <code>Ticker.Data</code> already in a <code>Ticker.Data</code> that is quite convenient for creating a cube. </p><br><h2 id="postroenie-kuba">  Build a cube </h2><br><p>  <a href="">DeepSee Architect</a> is a web application for creating an OLAP cube.  To go to DeepSee Architect, open the System Management Portal ‚Üí DeepSee ‚Üí Select Area ‚Üí Architect.  The working window of the Architect opens. </p><br><p>  You may need to select an area that supports DeepSee.  In that case, if you do not see your area in the list of DeepSee areas, go to the System Management Portal ‚Üí Menu ‚Üí Web Application Management ‚Üí / csp / area, and there in the Enabled field, check DeepSee and click the save button.  After that, the selected area should appear in the list of areas DeepSee. </p><br><h3 id="sozdaem-novyy-kub">  Create a new cube. </h3><br><p>  Clicking on the button "Create" we get to the screen of creating a new cube, there you need to set the following parameters: </p><br><ul><li>  Cube name - the name of the cube used in queries to it </li><li>  Display Name - localized cube name (translation is performed by <a href="">standard</a> InterSystems <a href="">mechanisms</a> ) </li><li>  Cube source - use a fact table or another cube as a data source </li><li>  Initial class - if in the previous step a class was chosen, then we specify the class Ticker.Data as the fact table. </li><li>  The class name for a cube is the name of the class in which the cube definition will be stored.  Automatically generated </li><li>  Class description - arbitrary description </li></ul><br><p>  This is what our new cube looks like: </p><br><p><img src="https://habrastorage.org/web/2ca/a45/a95/2caa45a95954472d810ed477179e051c.PNG" alt="Creating a cube"></p><br><h3 id="opredelyaem-svoystva-kuba">  Determine the properties of the cube </h3><br><p>  After clicking OK, a new cube will be created: </p><br><p><img src="https://habrastorage.org/web/15a/4f7/7de/15a4f77decd747edadeef95901389156.PNG" alt="New cube"></p><br><p>  On the left, the properties of the base and related by the ‚Äúsnowflake‚Äù classes are displayed, which can be used when constructing a cube. </p><br><p>  The center of the screen is the skeleton of the cube.  It can be filled with class properties using drag-n-drop from the base class area, or by adding elements manually.  The main elements of the cube are measurements, indicators and lists. </p><br><h4 id="izmereniya-dimensions">  Dimensions (Dimensions) </h4><br><p>  <a href="">Dimensions</a> are cube elements that group fact table entries.  In the measurement, the ‚Äúquality‚Äù attributes of the base class are usually referred to, which break all the records of the fact table according to one or another cut.  For example, we would like to group all the facts by instrument name and date. </p><br><p>  For splitting facts into tickers, the Ticker property is perfect.  Drag the Ticker onto the measurement area - as a result, the Architect adds a Ticker dimension to the cube with one H1 hierarchy and one Ticker level.  We indicate the displayed names in the signatures to the measurement and level. </p><br><p><img src="https://habrastorage.org/web/58c/90a/1c3/58c90a1c35cd4a7ebe5d007290066f4f.PNG" alt="Measure"></p><br><p>  Measurements besides grouping allow you to build hierarchies of nesting of facts from the general to the particular.  A typical example is measurement by date, which is often often required to be represented in a hierarchy Year-Month-Day. </p><br><p>  For date type properties (for example, the Date property has the% Date type), DeepSee has a special type of time dimension, which already has frequently used functions for creating hierarchies by date.  We use this and build a three-level hierarchy Year-month-day using the property Date. </p><br><p><img src="https://habrastorage.org/web/4da/b21/153/4dab21153a8241b9b8e56d3b8d8e1f77.PNG" alt="Measure 2"></p><br><p>  Note that there are elements in the dimension: the dimension itself, the hierarchy, and the levels of this hierarchy (Level).  Any cube dimension consists of at least one hierarchy in which in the simplest case there is only one level. </p><br><h4 id="pokazateli-measures">  Indicators (Measures) </h4><br><p>  <a href="">Indicators</a> or metrics are such elements of a cube, to which any ‚Äúquantitative‚Äù data are to be counted, which must be calculated for ‚Äúqualitative‚Äù dimensions of the cube (Dimensions). <br>  For example, in the fact table such indicators can be the properties of Volume (number of shares) and Average (Average price).  Drag the Volume property to the area of ‚Äã‚Äãindicators and create the ‚ÄúNumber‚Äù indicator with the SUM function, which will count the total number of shares in the current slice. </p><br><p>  We also add the Average property to the indicators and specify as the calculation function MAX ‚Äî the calculation of the maximum value.  In order to use the price to visualize changes in the maximum stock price over time. </p><br><p><img src="https://habrastorage.org/web/8a8/210/04c/8a821004c7134f41ad629379908a4ecb.PNG" alt="Indicators"></p><br><h4 id="spiski-listings">  Listings </h4><br><p>  <a href="">Lists</a> are cube elements that describe how to access the source data of the cube, allowing you to go from the cube aggregated to the source data.  As a rule, when working with a cube, the analyst views the aggregated information in various sections.  However, it is often necessary to look at the original facts that are included in the current slice.  For this, listings are created - they list a set of fields of the fact table that need to be displayed when going to the <a href="">Drillthrough</a> fact viewer.  Create a simple listing by clicking the "Add item" button: </p><br><p><img src="https://habrastorage.org/web/db8/806/6ae/db88066ae5c544f0856c7e131d030563.PNG" alt="Listing 1"></p><br><p>  Now we will set the fields of the fact table to be displayed.  For example, we will display information about tickers and their daily price fluctuations (Name, Ticker, "Open", CloseLegal, Low, Average, High): </p><br><p><img src="https://habrastorage.org/web/36b/930/ca5/36b930ca59fe47b2962feecb08bddeda.PNG" alt="Listing 2"></p><br><h4 id="kompilyaciya-kuba">  Compilation cube </h4><br><p>  So, we added two indicators to the cube, two measurements and one listing - this is quite enough and you can already see what happened. </p><br><p>  Compile the cube class (Compile button).  If there are no compilation errors, then the cube is created correctly and you can fill it with data. </p><br><p>  To do this, click "Build a cube" - as a result, DeepSee will load data from the fact table into the cube data store. </p><br><p>  To work with the cube data we need another web application - DeepSee Analyzer. </p><br><h2 id="postroenie-svodnoy-tablicy-pivot">  Pivot table construction (Pivot) </h2><br><p>  <a href="">DeepSee Analyzer</a> is a visual tool for directly analyzing cube data and preparing data sources for further visualization.  To go to DeepSee Analyzer, open the System Management Portal ‚Üí DeepSee ‚Üí Area Selection ‚Üí Analyzer.  The Analyzer working window opens. </p><br><p><img src="https://habrastorage.org/web/ba5/c87/035/ba5c8703519e47eca0bbe27f49f19c72.PNG" alt="Analyzer"></p><br><p>  In the working analyzer window on the left we see the elements of the created cube: indicators and measurements.  Combining them, we build queries to the cube in <a href="">MDX</a> , an analogue of the SQL language for multidimensional OLAP cubes. </p><br><p>  Consider the Analyzer interface.  On the right is a pivot table field.  The result of the MDX query is always shown in the field of the summary table of the Analyzer.  You can view the current MDX request by clicking the button. <img src="https://habrastorage.org/web/29d/377/fed/29d377fed2d94b79a83c5287b4932a32.PNG" alt="Source">  .  When you first open a cube, the default pivot table field shows the number of entries in the fact table ‚Äî in our case, the number of entries in the Ticker.Data class.  This corresponds to MDX: <code>SELECT FROM [TICKER]</code> . </p><br><p>  To create a pivot table, drag the ‚ÄúYear‚Äù dimension into the column field.  Indicator choose "Volume".  As a result, we obtain a table of the number of shares sold by year. </p><br><p><img src="https://habrastorage.org/web/a03/ea2/e71/a03ea2e711634b8ba86dbee9ec4d17c0.PNG" alt="Pivot 1"></p><br><p>  Next, drag the ‚ÄúTicker‚Äù dimension into the column field and get a summary table of the number of shares by instrument, broken down by year: </p><br><p><img src="https://habrastorage.org/web/8f1/e07/9e8/8f1e079e8ed6489384b180f8da742a3d.PNG" alt="Pivot 2"></p><br><p>  Now, for each cell of the resulting table, one value is calculated - the total number of shares involved in the transactions (if no indicator is selected, the number of facts is considered - in this case, this can be interpreted as the number of instrument trading days).  This can be changed.  Add the indicator "Average Price".  As a result, you can see a more interesting picture: the summary table displays the average maximum price for each instrument per year. </p><br><p><img src="https://habrastorage.org/web/acb/216/e95/acb216e95ab145628329ff7c271d66e7.PNG" alt="Pivot 3"></p><br><p>  As we remember, in the definition of a cube we have a hierarchy by dates.  This means that, by the Date dimension, a DrillDown operation is possible (moving along the measurement hierarchy from general to specific).  In the Analyzer, double clicking on the dimension heading leads to the next dimension in the hierarchy (DrillDown).  In this case, a double click on the year will lead to a transition to the months of this year, and a double click on a month will lead to a transition to the level of days.  As a result, you can see how the average stock price has changed for days or months. </p><br><p><img src="https://habrastorage.org/web/fee/ee8/f20/feeee8f20b4b40beb1404492a14f454b.PNG" alt="Pivot 4"></p><br><p>  At the previous stage, we created a listing - a tool for moving from aggregated data to source facts.  Select any row of the pivot table and press the button. <img src="https://habrastorage.org/web/814/84b/ed0/81484bed028041ed828768093de4c131.PNG" alt="Drillthrough">  to go to listing: </p><br><p><img src="https://habrastorage.org/web/d1a/a45/2b6/d1aa452b69844a43a7272129697631fb.PNG" alt="Drillthrough 2"></p><br><p>  The next stage is visualization.  Before saving, simplify the pivot table and save it as TickersByYears. </p><br><p><img src="https://habrastorage.org/web/dd6/9d1/3e6/dd69d13e6fd74bf985942cb535d75f01.PNG" alt="Pivot 5"></p><br><h2 id="postroenie-dashborda-dashboard">  Building a dashboard (Dashboard) </h2><br><p>  User Portal is a web application for creating and using dashboards ( <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BD%25D0%25B5%25D0%25BB%25D1%258C_%25D0%25B8%25D0%25BD%25D0%25B4%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2">indicator panels</a> ).  Dashboards contain widgets: tables, graphs and maps based on summary tables created by analysts in the Analyzer. </p><br><p>  To go to the DeepSee User Portal, open the System Management Portal ‚Üí DeepSee ‚Üí Select Region ‚Üí User Portal. </p><br><p><img src="https://habrastorage.org/web/f88/f5a/bdd/f88f5abdd50f4b64b3f66f6008b183d5.PNG" alt="Portal"></p><br><p>  Create a new dashboard by clicking on the arrow on the right ‚Üí add ‚Üí add display panel </p><br><p><img src="https://habrastorage.org/web/41c/186/875/41c186875ea14dbf8e782fc5d7877e8c.PNG" alt="Portal2"></p><br><p>  Create a widget by clicking the arrow on the right ‚Üí Widgets ‚Üí "+" ‚Üí Line chart with markers.  As the data source, select TickersByYears: </p><br><p><img src="https://habrastorage.org/web/672/756/789/6727567890724f3bb65f58eb3a753d24.PNG" alt="Widget"></p><br><p>  However, the reader will argue - this is the average temperature in the hospital.  And he will be right.  Add filtering by tool.  To do this, click the arrow on the right ‚Üí Widgets ‚Üí Widget 1 ‚Üí Controls ‚Üí "+".  The form for creating a new filter is as follows: </p><br><p><img src="https://habrastorage.org/web/fe8/559/69c/fe855969ca4e4f93bb5899527c2f1547.PNG" alt="Filter"></p><br><p>  This is how our filter widget looks like.  The user can change the filter value to any other. </p><br><p><img src="https://habrastorage.org/web/2bb/ebe/f7e/2bbebef7e1714df996be80599da42005.PNG" alt="Widget 2"></p><br><p>  After that, save the dashboard. </p><br><h2 id="ustanovka-mdx2json-i-deepseeweb">  Installing MDX2JSON and DeepSeeWeb </h2><br><p>  To visualize the created dashboard, you can use the following OpenSource solutions: </p><br><ul><li>  <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">MDX2JSON</a> - REST API provides information about cubes, pivots, dashboards and many other DeepSee elements, in particular, the results of MDX queries, which allows you to embed the user interface of the analytical solution on the DeepSee into any modern Web or mobile application. </li><li>  <a href="https://github.com/intersystems-ru/DeepSeeWeb">DeepSeeWeb</a> - AngularJS application that provides an alternative implementation of the DeepSee user portal.  Can be easily customized.  Uses MDX2JSON as a backend.  Here is an example of a dashboard rendered in DeepSeeWeb: </li></ul><br><p><img src="https://habrastorage.org/web/815/5ab/c73/8155abc739b64bb1a4a90978f2ad2a18.png" alt="DeepSeeWeb"></p><br><h3 id="ustanovka-mdx2json">  Installing MDX2JSON </h3><br><p>  To install MDX2JSON: </p><br><ol><li>  Download <a href="">Installer.xml</a> and import it to any area using Studio, System Management Portal or <code>Do $System.OBJ.Load(file)</code> . </li><li>  Run in terminal (user with% ALL role): <code>Do ##class(MDX2JSON.Installer).setup()</code> </li></ol><br><p>  To check the installation, you need to open the page <code>http://server:port/MDX2JSON/Test?Debug</code> in the browser.  You may need to enter a username and password (depending on server security settings).  A server page should open.  If you get an error, you can read on the <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">Readme</a> and <a href="https://github.com/intersystems-ru/Cache-MDX2JSON/wiki/Installation-Guide---RU">Wiki</a> . </p><br><h3 id="ustanovka-deepseeweb">  Install DeepSeeWeb </h3><br><p>  To install DeepSeeWeb you need: </p><br><ol><li>  Download the <a href="https://github.com/intersystems-ru/DeepSeeWeb/releases">installer</a> and import it to any area using Studio, System Management Portal or <code>Do $System.OBJ.Load(file)</code> . </li><li>  Run in terminal (user with% ALL role): <code>Do ##class(DSW.Installer).setup()</code> </li></ol><br><p>  To check the installation, open the browser page <code>http://server:port/dsw/index.html</code> .  The authorization page should open.  The SAMPLES area contains many ready-made dashboards and all of them are automatically displayed in DeepSeeWeb. </p><br><h2 id="vizualizaciya">  Visualization </h2><br><p>  Open <code>http://server:port/dsw/index.html</code> and log in, you also need to specify the area with the cube.  A list of dashboards will open, in our case there is only one ‚ÄúPromotions‚Äù dashboard created.  Open it: </p><br><p><img src="https://habrastorage.org/web/025/ee0/f99/025ee0f9992d44a7aed6948d6b70079f.PNG" alt="DSW"></p><br><p>  Our created widget is displayed.  It supports the Drilldown and filter created in the DeepSee User Portal: </p><br><p><img src="https://habrastorage.org/web/8de/c01/fb0/8dec01fb0d7c49639043643256ad8821.PNG" alt="DSW 2"></p><br><h2 id="vyvody">  findings </h2><br><p>  InterSystems DeepSee is a powerful tool for creating OLAP solutions, providing developers with the tools to create and integrate analytical OLAP functionality into their applications, which is able to work on operational application databases without creating a separate infrastructure for solving analytical tasks. </p><br><h2 id="ssylki">  Links </h2><br><ul><li>  <a href="http://www.intersystems.com/ru/our-products/embedded-technologies/deepsee/">Deepsee</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DnlmVE3CzHaM">DeepSee Intro Webinar</a> </li><li>  <a href="">Documentation</a> </li><li>  <a href="https://github.com/intersystems-ru/Ticker">Repository</a> </li><li>  <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">MDX2JSON</a> </li><li>  <a href="https://github.com/intersystems-ru/DeepSeeWeb">DeepSeeWeb</a> </li><li>  <a href="http://www.moex.com/a2193">API Moscow Exchange</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/335586/">https://habr.com/ru/post/335586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335574/index.html">Do-it-yourself chat bot: the story of one bike</a></li>
<li><a href="../335576/index.html">Digital economy and ecosystem R</a></li>
<li><a href="../335578/index.html">DLP and the Law: how to properly arrange the introduction of a system to protect against leaks</a></li>
<li><a href="../335580/index.html">Automation of fishing for World of Warcraft</a></li>
<li><a href="../335584/index.html">What's new in PHP 7.2?</a></li>
<li><a href="../335588/index.html">Planetary landscape</a></li>
<li><a href="../335590/index.html">Social Organism - as a form of effective team interaction. Part 2</a></li>
<li><a href="../335592/index.html">Cisco Digital Network Architecture: Key Features of the New Platform</a></li>
<li><a href="../335600/index.html">Internet bicycles - how IT helps to lead a healthy lifestyle and reduce harmful emissions</a></li>
<li><a href="../335602/index.html">The hunt for malicious npm-packages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>