<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of how I wrote OS in Minecraft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Back in 2011, the world saw a game like Minecraft - a voxel sandbox, where everyone creates everything his heart desires. After some time, craftsmen b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of how I wrote OS in Minecraft</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/266/93d/4d3/26693d4d3cd62fbeae423adec011f802.png" alt="image"><br><br>  Back in 2011, the world saw a game like Minecraft - a voxel sandbox, where everyone creates everything his heart desires.  After some time, craftsmen began to write various modifications for her, making the gameplay more diverse.  Not so long ago, a mod called ‚ÄúOpenComputers‚Äù appeared, adding high-grade computers programmed in the Lua scripting language.  And in this article I want to share with you a little experience gained in studying this extremely interesting fashion. <br><a name="habracut"></a><br><h4>  Studying mod </h4><br>  If you set a computer in front of you and install a standard console OS on it from local floppy disks, you may be slightly disappointed in the mod functionality.  In fact, at the start we have a command line with a rather nasty looking interface, we have a set of standard commands like ls, edit &lt;file&gt;, remove &lt;file&gt; or mkdir &lt;folder&gt;. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/736/974/5ca/7369745ca5e70033d38a042bc91c11c0.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The whole thing did not suit me at all, and I decided to add more pleasant colors to the console and Russify the clues for the mod, since the author allowed us to edit the source code of all its developments.  The syntax of Lua, its structure and capabilities, I was extremely surprised compared to the same unfriendly to the novice family of the SI family or even more indifferent Java, it has absolutely everything you need out of the box, and the documentation for the fashion is written in a simple popular language.  At first I began to write simple scripts a la ‚ÄúHello world‚Äù, and a little later I switched to all sorts of small programs for controlling doors or lighting in a game house, but it all smelled boredom and simplicity.  I wanted hardcore! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6de/dd8/b35/6dedd8b3511c9023ac4488a1a26bce89.png" alt="image"><br><br>  Gradually studying local libraries and Lua features, my friend and I were able to make simple GUI applications.  Rummaging through all sorts of wikipedia, we found several algorithms for working with color - for example, to convert colors from RGB to HSB format or to overlay one color over another, taking into account transparency.  A little fiddling, we managed to implement these algorithms on Lua, and so our first library for this mod appeared, we called it colorlib, and with its help we were able to create such a nice palette: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eeb/60e/e54/eeb60ee545804b31dd390c72980a561e.png" alt="image"><br><br>  Deciding not to stop there, we thought it would be cool to make a graphic editor for this mod, as well as its own image format.  Indeed, why not?  So we could easily draw beautiful graphics on the monitor.  Having spent a few days, my friend managed to implement a competent file structure of future pictures, which ate very little space on local hard drives, which, by the way, have a limited amount of 4 MB.  We denoted the abbreviation of the format as ".pic", and the format itself was called "OpenComputers Image Format", abbreviated "ocif".  After all this, we started creating the graphic editor itself, spending about three days on it.  As a result, we have this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/269/705/247/26970524772ee592de506b12ab4a0d8e.png" alt="image"><br><br>  The structure of the .pic file in hexadecimal can be seen in this picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/239/c22/7af/239c227aff16ae30fe5829c7c2143e6a.png" alt="image"><br><br>  First of all, we added the most necessary tools to our graphic editor - a brush, an eraser, as well as text to create inscriptions, because in fact we have a console, where each pixel has three parameters: text color, background color and symbol.  A little later, a recursive fill algorithm was inserted for more convenient creation of images, and our editor managed to teach the real PNG image format a little later (by the way, using an <a href="http://habrahabr.ru/post/130472/">article</a> from a habr).  So, we have a working image format, but do not know where it can be applied.  We began to write various applications for this mod, for example, such a nice calendar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/ae0/049/300ae00490ad0b193ef65831b215f984.png" alt="image"><br><br>  Or an application that generates digital rain from a famous movie: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/926/92a/5e2/92692a5e2e913948a27349e1a33796e4.png" alt="image"><br><br>  In the end, we had so many different scripts and libraries that we were tired of loading them manually with the standard method through Pastebin.com.  Yes, the mod has pastin integration, so we stored all our files initially on it, uploading them to computers as needed.  But considering the number of files, we decided to create an installer program that automatically downloads a list of files from our repository to GitHub, and then downloads files from the list to the desired directory.  There were quite a few hemorrhoids with transferring files from Pastebin, but after a couple of hours we managed the task and started coding the installer.  The result was this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/58b/4b9/abc/58b4b9abccfb4906ef3c058ba2140afc.png" alt="image"><br><br>  So, we could already code simple applications with pictures, we had a convenient installer for them, but we wanted something more!  The idea of ‚Äã‚Äãcreating an operating system came somehow by itself, and, without thinking twice, I decided to make a few sketches of icons for the future OS.  For example, the folder looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c05/9a1/114/c059a11141d85cf8cc26f9fdf396ded3.png" alt="image"><br><br>  Having drawn the main icons, I started creating the operating system itself, immediately giving it the name ‚ÄúMineOS‚Äù.  The basic concept is very simple: in the MineOS / Desktop / folder there are files of any type.  Using the standard getFileList () function, we get a list of files, get the file format through cropping a string file name, and then draw icons on our screen in accordance with the received format.  Something like this came out: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d00/b81/5a3/d00b815a331ac53e906e7d349f8b1e88.png" alt="image"><br><br>  Then I attached the bottom menu in the style of Mac OS, added the menu from the top, nakodil context interaction library - and in the end we already have something worthy of the name "graphical shell", but this is not yet up to the full OS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2c/bb7/580/a2cbb75803f9d03617ce6cbab1ff01a8.png" alt="image"><br><br>  Everything has its drawbacks: the local "video cards" provided by the mod have a limited number of operations that they can do for a gaming tick.  By operations we mean changing the text color, background color, setting a character, etc.  It is not difficult to imagine how many operations were required to draw our pictures and even more so to draw a desktop.  But the biggest sadness was that I needed to redraw the desktop completely, for example, if I opened the context menu or ran a file.  But here another comrade came to help me and advised me to write a double image buffering algorithm.  For those who do not know, I will briefly explain its essence: in RAM we have two arrays of images: the first contains information about the pixels that are currently displayed on the screen, and the second - information about the pixels that we want to draw.  Then, by calling the calculation function, the algorithm compares these two arrays and displays not all the pixels, but only the modified ones.  And then assigns the first array the value of the second. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4b/9dd/bed/d4b9ddbedd084e5ef044c7d861b5f57c.png" alt="image"><br><br>  Also, I have built in this library several algorithms to speed up the work of local GPUs, grouping neighboring pixels by color and combining them into one line instead of alternately rendering. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/263/267/022/263267022b9277764cae44a800730954.png" alt="image"><br><br>  And only now my OS is working as it should!  Icons were drawn almost instantly, it became extremely pleasant to interact with the computer.  Deciding not to stop there, I added several functions simulating image transparency, and with their help I managed to achieve quite beautiful results. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcc/256/068/dcc2560681c0fe27991aef89b300181d.png" alt="image"><br><br>  Then I nakodil beautiful file manager in the style of the Finder from the same Mac OS, and integrated it into the system.  He also added sorting files by name, type and date of change, added hiding of image format, added ‚Äúfavorites‚Äù menu.  As a result, we have the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/795/8cc/2887958ccb09022453568580213f98aa.png" alt="image"><br><br>  All this already looks pretty good, but behind me there is such a sin as a strong love for good graphics.  So I decided to add support for the wallpaper.  Here are some examples: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/346/765/91d/34676591d3a4def86ae189b669e0b688.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4b/6b2/282/e4b6b22828a093eb0d423fea6eb1291a.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/35d/bf8/c2f/35dbf8c2f53c059787bad35b5ce746b0.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/541/b0c/2ae/541b0c2aec9e60621f9a48dc393bd618.png" alt="image"><br><br>  By the way, today I wrote the HEX file editor, since I don‚Äôt like to pay for ready-made solutions that are sold on the Internet.  This is how it looks in combination with the wallpaper of the working table. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fe/c4c/354/5fec4c3541ecc9e0e7d3307aafe6906b.png" alt="image"><br><br>  So, our OS is ready!  In total, we have about 28 of our own libraries, while some of them have more than 2 thousand lines of code.  We also have about 30 high-quality GUI applications.  From the beginning of the study of fashion and up to the present time, almost a year has passed, and we programmed far from every day and every week.  This is how this operating system was written, and after it this article. <br><br><h4>  How to download? </h4><br>  If you want to feel this OS yourself, then please, here is a brief instruction: put the computer case on the ground, attach the monitor to it, and attach the keyboard to the monitor.  Then you insert into the case the best video card, processor, RAM, hard disk, Lua-BIOS, standard floppy with OpenOS (mod's scripts), as well as an Internet card (not a network, but the Internet). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29b/6b7/997/29b6b79973705343e6f087e3c9929497.png" alt="image"><br><br>  Then you turn on the computer, wait for the system to boot from a floppy disk, and then enter the <b>install</b> command on the console.  Next, select the number of the hard disk, press <b>enter</b> , and the system is set.  Next, restart the computer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c60/f95/d5a/c60f95d5ada5ff3d9065a636a74271bd.png" alt="image"><br><br>  Now your computer is ready to install my operating system.  Enter the <b>pastebin run 0nm5b1ju</b> command into the console, <b>press</b> <b>enter</b> and follow the instructions on the screen.  I wish you a pleasant use. <br><br><h4>  Total </h4><br>  Why, in fact, I wrote this article?  I wanted to show people that in any language and in any environment you can create a small, I‚Äôm not afraid of this word, a masterpiece.  A year and a half ago, I was extremely vaguely aware of what a ‚Äúfunction‚Äù, ‚Äúarray‚Äù or ‚Äúclass‚Äù is, and now with my friends we are coded with our own mini-OS.  The main thing is to have free time and the desire to spend it profitably and with pleasure, for me personally there is no greater buzz than to code all the nonsense in my favorite game.  I wish all beginners and not-so-novice programmers creative success! <br><br><hr><br><h4>  Sources </h4><br>  If anyone is interested, you can dig in the <a href="https://github.com/IgorTimofeev/OpenComputers">raw materials</a> , there you will find all the libraries, the OS itself, programs and images. <br><br><h4>  The authors </h4><br>  Just in case, I want to list the rest of the people who were somehow connected with this OS, who, just like me, were interested in studying this modification, and Lua as a whole. <br><br><ul><li>  <a href="http://vk.com/id88323331">Gleb Trifonov</a> is a developer of image format, as well as half of the libraries. </li><li>  <a href="http://vk.com/mathem">Jacob (last name unknown)</a> - the developer of the concept of double buffering, assistant in code optimization. </li><li>  <a href="http://vk.com/pacmax">Maxim Pakin</a> is the author of several OS programs. </li><li>  <a href="http://vk.com/id113499693">Timofey Shestakov</a> is the moral support of the team, the author of several interesting ideas to speed up the OS. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/272391/">https://habr.com/ru/post/272391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272381/index.html">Useful Snippets for Nginx Configs</a></li>
<li><a href="../272383/index.html">Postulates Go</a></li>
<li><a href="../272385/index.html">True Snowden</a></li>
<li><a href="../272387/index.html">Resources for designers and front-end developers</a></li>
<li><a href="../272389/index.html">Desktop JavaScript applications. Part 1</a></li>
<li><a href="../272393/index.html">Creating a ToDo application with Realm and Swift</a></li>
<li><a href="../272395/index.html">PostgreSQL Document Designing API (Part 1)</a></li>
<li><a href="../272397/index.html">Cloud services that help us every day</a></li>
<li><a href="../272399/index.html">Passion for the domain Sex.com</a></li>
<li><a href="../272401/index.html">50 typical gaming camera design errors (part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>