<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Changes in CleverStyle Framework 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago the first release of the 5.x branch was released, and then several smaller patch versions, so again there is something to be told. 

 Pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Changes in CleverStyle Framework 5</h1><div class="post__text post__text-html js-mediator-article">  Some time ago the first release of the 5.x branch was released, and then several smaller patch versions, so again there is something to be told. <br><br>  Previous changes: <a href="http://habrahabr.ru/post/244311/">part 1</a> , <a href="http://habrahabr.ru/post/255139/">part 2</a> , <a href="https://habrahabr.ru/post/275139/">part 3</a> , <a href="https://habrahabr.ru/post/302944/">part 4</a> . <br><br>  The comments under the previous article and in the chat posts were very useful, a separate thank you to <a href="https://habrahabr.ru/users/fesor/" class="user_link">fesor</a> , who, although he does not agree, but provides constructive criticism that has positive consequences. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Many changes have made the system faster, easier and more convenient than ever before.  The article briefly describes the main changes, their causes and consequences. <br><a name="habracut"></a><br><h3>  Goodbye jQuery </h3><br>  In versions 4.x, jQuery was first declared obsolete, later in 5.x it was completely cut out of the framework. <br><br>  Many routine operations using Polymer become declarative, and I didn‚Äôt want to pull jQuery for a small number of methods. <br><br>  JQuery was also actively used for XHR queries, but with extensive support for XHR2, there was no need to write several implementations, and the <a href="">cs.api ()</a> function was written, which: <br><br><ul><li>  provides 95% of needs with much more convenient syntax </li><li>  supports sending forms and files </li><li>  interface based on ES2015 Promise </li><li>  supports error handling with user output of beautiful pop-up messages </li></ul><br>  Some modules used jQuery plugins, they now use the NPM version of jQuery. <br><br>  Also one of the jQuery plugins that was used in the kernel was refactored without using jQuery, the patch is accepted upstream, so the framework includes a clean original version: <a href="https://github.com/voidberg/html5sortable/pull/204">github.com/voidberg/html5sortable/pull/204</a> <br><br><h3>  No more plugins and block templates </h3><br>  Previously, there were separate modules and plugins.  The plugins were similar to modules, but without their own pages, admins, settings, API, and other things. <br><br>  Due to the fact that the presence of the second type of components, which is actually a subspecies of the first, complicated the support, it was decided to abolish it, all the plugins were converted into modules. <br><br>  Also <code>components/blocks</code> and <code>components/modules</code> subsequently transferred to <code>blocks</code> and <code>modules</code> by analogy with <code>themes</code> . <br><br>  The block templates were quite a crooked thing initially and in fact were too tied to a specific project.  If we add to this the impossibility of installing blocks from packages, the benefit was completely reduced to zero. <br>  Therefore, the block templates were also cut, now the blocks themselves are worried about their own appearance. <br><br><h3>  Interface consistency </h3><br>  Along with the cleaning of minor features, a lot of work was done on the consistency of the internal API of the framework. <br><br>  For example, <code>cs\CRUD</code> when working with different database engines, now results in numeric types of the same type (MySQL returned rows even for numeric columns, and SQLite returned numbers). <br><br>  Another example is the removal of support for <code>cs\DB::instance()-&gt;$db_id</code> and <code>cs\DB::instance()-&gt;$db_id()</code> instead of <code>cs\DB::instance()-&gt;db($db_id)</code> and <code>cs\DB::instance()-&gt;db_prime($db_id)</code> .  Once upon a time it was used, but it is not very convenient and complicates type inference for the IDE. <br><br>  Many of these little things have been corrected and brought to a general view. <br><br><h3>  Testing </h3><br>  Testing in the latest versions was given much more time than the development of new features, the calculation was also added to cover the framework code with tests. <br><br>  As a result, the total coverage of the framework with tests is 66% + at the time of writing the article, covering the system classes is 96% + (the <code>modules</code> folder is almost entirely composed of controllers, so the priority is lower): <br><br><img src="https://habrastorage.org/files/a0b/82a/08c/a0b82a08c43344499a427e79b472f4ec.png"><br><br><img src="https://habrastorage.org/files/fff/f59/a9c/ffff59a9cbe74af3ab9e1400097a37b0.png"><br><br>  Just taking into account the coverage of the code made it possible to find areas that were not previously tested, as well as a number of minor bugs that would be difficult to find in another way. <br><br><h3>  Frontend is even easier, optionally disabling web component support </h3><br>  Since the web components are not all imbued with, it may seem too expensive to load Polymer, polyfills and HTML imports if they are not to be used.  For these cases, in the latest release, web component support has become disabled for advanced users in the admin area. <br><br>  The second important improvement is the transition to asynchronous interfaces for working with translations on the frontend. <br><br>  It used to be like this: <br><br><pre> <code class="javascript hljs">cs.Language.system_profile_hello(<span class="hljs-string"><span class="hljs-string">'Username'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  cs.Language('system_profile_').hello('Username')</span></span></code> </pre> <br>  Now you need to wait: <br><br><pre> <code class="javascript hljs">cs.Language.ready().then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">L</span></span></span><span class="hljs-function">) </span></span>{ L.system_profile_hello(<span class="hljs-string"><span class="hljs-string">'Username'</span></span>); }); <span class="hljs-comment"><span class="hljs-comment">//  cs.Language('system_profile_').ready().then(function (L) { L.hello('Username'); });</span></span></code> </pre> <br>  In fact, it is still synchronous under the hood until 6.x, but in the end translations will be loaded only when needed. <br><br>  All these changes will reduce the amount of necessarily downloadable JS code from 312 KiB to less than 30 KiB (this is all without gzip), and the HTML volume of imports from 107 KiB to 0 KiB (0 files). <br><br>  In essence, Alameda (RequireJS) and several auxiliary system functions / objects will be loaded. <br><br><h3>  Server side performance </h3><br>  The next batch of changes led to an even higher speed of work (although there are already no low-hanging fruits). <br><br>  Especially useful is the query API optimization.  Significant (relatively) overheads were provided by the work with translations; a large JSON took both time for parsing and memory.  Now, during an API request that does not work with multilingualism, translations will not be loaded into memory at all. <br><br>  For comparison with competitors, a <a href="https://github.com/nazar-pc/php-framework-benchmark">popular benchmark</a> with a bunch of different frameworks was made, so you can reproduce the results yourself: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5a3/4ed/3c4/5a34ed3c45d84b9dba70e44f6cf92f83.png"></div></div><br>  In text form: <br><br><pre> <code class="hljs ruby"><span class="hljs-params"><span class="hljs-params">|framework |</span></span>requests per second<span class="hljs-params"><span class="hljs-params">|relative|</span></span>peak memory<span class="hljs-params"><span class="hljs-params">|relative|</span></span> <span class="hljs-params"><span class="hljs-params">|-------------------|</span></span>------------------<span class="hljs-symbol"><span class="hljs-symbol">:|-------</span></span><span class="hljs-symbol"><span class="hljs-symbol">:|----------</span></span><span class="hljs-symbol"><span class="hljs-symbol">:|-------</span></span><span class="hljs-symbol"><span class="hljs-symbol">:|</span></span> <span class="hljs-params"><span class="hljs-params">|silex-1.3 |</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">02</span></span>9.<span class="hljs-number"><span class="hljs-number">75</span></span><span class="hljs-params"><span class="hljs-params">| 8.8|</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">59</span></span><span class="hljs-params"><span class="hljs-params">| 1.0|</span></span> <span class="hljs-params"><span class="hljs-params">|symfony-2.7 |</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">423.83</span></span><span class="hljs-params"><span class="hljs-params">| 4.2|</span></span> <span class="hljs-number"><span class="hljs-number">1.41</span></span><span class="hljs-params"><span class="hljs-params">| 2.4|</span></span> <span class="hljs-params"><span class="hljs-params">|symfony-3.0 |</span></span> <span class="hljs-number"><span class="hljs-number">995.79</span></span><span class="hljs-params"><span class="hljs-params">| 2.9|</span></span> <span class="hljs-number"><span class="hljs-number">1.64</span></span><span class="hljs-params"><span class="hljs-params">| 2.8|</span></span> <span class="hljs-params"><span class="hljs-params">|laravel-5.2 |</span></span> <span class="hljs-number"><span class="hljs-number">342.99</span></span><span class="hljs-params"><span class="hljs-params">| 1.0|</span></span> <span class="hljs-number"><span class="hljs-number">1.98</span></span><span class="hljs-params"><span class="hljs-params">| 3.4|</span></span> <span class="hljs-params"><span class="hljs-params">|zf-2.5 |</span></span> <span class="hljs-number"><span class="hljs-number">671.20</span></span><span class="hljs-params"><span class="hljs-params">| 2.0|</span></span> <span class="hljs-number"><span class="hljs-number">1.36</span></span><span class="hljs-params"><span class="hljs-params">| 2.3|</span></span> <span class="hljs-params"><span class="hljs-params">|cleverstyle-5.15 |</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">939.17</span></span><span class="hljs-params"><span class="hljs-params">| 5.7|</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">66</span></span><span class="hljs-params"><span class="hljs-params">| 1.1|</span></span></code> </pre><br><br>  Peak performance under the built-in Http server has also increased along with excellent scalability (HHVM, 16 processes, Core i7 4900MQ): <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> nazar-pc @ nazar-pc / w / t / www&gt; ab -c500 -n100000 -k http://test.com:9990/api/System/blank
 This is ApacheBench, Version 2.3 &lt;$ Revision: $ 1706008&gt;
 Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
 Licensed to The Apache Software Foundation, http://www.apache.org/

 Benchmarking test.com (be patient)
 Completed 10,000 requests
 Completed 20000 requests
 Completed 30000 requests
 Completed 40000 requests
 Completed 50000 requests
 Completed 60000 requests
 Completed 70000 requests
 Completed 80000 requests
 Completed 90000 requests
 Completed 100000 requests
 Finished 100000 requests


 Server Software: nginx / 1.10.1
 Server Hostname: test.com
 Server Port: 9990

 Document Path: / api / System / blank
 Document Length: 4 bytes

 Concurrency Level: 500
 Time taken for tests: 9.375 seconds
 Complete requests: 100,000
 Failed requests: 0
 Keep-Alive requests: 0
 Total transferred: 24,400,000 bytes
 HTML transferred: 400000 bytes
 Requests per second: 10666.64 [# / sec] (mean)
 Time per request: 46.875 [ms] (mean)
 Time per request: 0.094 [ms] (mean, across all concurrent requests)
 Transfer rate: 2541.66 [Kbytes / sec] received

 Connection Times (ms)
               min mean [+/- sd] median max
 Connect: 0 8 69.2 1 1013
 Processing: 0 39 30.9 31 272
 Waiting: 0 37 30.5 29 272
 Total: 0 47 75.3 35 1199

 Percentage of the requests served within a certain time (ms)
   50% 35
   66% 48
   75% 57
   80% 63
   90% 83
   95% 104
   98% 137
   99% 166
  100% 1199 (longest request)
</pre></div></div><br>  And in single-threaded mode, requests are processed starting from 0.6 ms (0.0006 seconds), which is a very good result, although I would like to get under 0.5 milliseconds. <br><br><h3>  At last </h3><br>  As usual, I will be grateful for constructive comments. <br>  GitHub repository: <a href="https://github.com/nazar-pc/CleverStyle-Framework">github.com/nazar-pc/CleverStyle-Framework</a> </div><p>Source: <a href="https://habr.com/ru/post/307626/">https://habr.com/ru/post/307626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307616/index.html">A bunch of ways to reuse code in Rust</a></li>
<li><a href="../307618/index.html">History of programming languages: how Haskell became the standard of functional programming</a></li>
<li><a href="../307620/index.html">Errors of questionnaires. 1 error: sample offset. 8 ways to attract the right respondents</a></li>
<li><a href="../307622/index.html">Porting FreeModbus under STM32. Version from dinar</a></li>
<li><a href="../307624/index.html">The report on the results of "My Circle" for July 2016, and the most popular vacancies of the month</a></li>
<li><a href="../307628/index.html">Tinkoff has compromised data on the balance of its clients' cards</a></li>
<li><a href="../307634/index.html">Top Selling Phones in History</a></li>
<li><a href="../307640/index.html">Recursion testing</a></li>
<li><a href="../307642/index.html">Tokenization in Russia: How the ‚Äúsafe‚Äù technology of contactless payments from Visa and Mastercard will work</a></li>
<li><a href="../307644/index.html">‚ÄúTo get above average, we need some kind of motivation beyond money‚Äù - an interview with Ruslan Cheremin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>