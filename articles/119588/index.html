<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Primary cache in Kohana 3 using tags</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The given example is the result of solving a single task that arose when developing a site management system on the Kohana 3.1 framework, in which one...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Primary cache in Kohana 3 using tags</h1><div class="post__text post__text-html js-mediator-article">  The given example is the result of solving a single task that arose when developing a site management system on the Kohana 3.1 framework, in which one administrator account and many unregistered readers are assumed. <br><br>  It took a long time to cache the results of the work of the model methods that access the database.  In fact, it was required to create copies of data sets from the database in order to reduce the load on the DBMS.  To immediately update the cache when adding new data or updating old ones, it was necessary to clear the cache by tags. <br><br>  Considering all this, and due to the limitations of the used hosting, the requirements were as follows: <br><ul><li>  The cache should be stored in files. </li><li>  The cache should be stored for a long time to increase the speed of data retrieval and reduce the load on the database. </li><li>  When the site administrator updates the data, the cache containing obsolete data must be cleared, and not only the result results cache of functions that directly retrieve this data from the database should be cleared, but also those whose results are associated with this data (for example, deleting catalog categories should clear cache list items rubrics).  To achieve this, tags must be supported. </li><li>  In order to achieve the goal, it is possible to sacrifice, within certain limits, the time spent on adding new materials, which will be spent, including clearing the cache, as they are added by ‚Äúown person‚Äù and not by outsiders. </li></ul><br>  The standard class <code>Cache_File</code> does not support tags, for this reason it was necessary to write its own class, it was given the name <code>JetCache</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The class is designed on the template "loner".  Consider the example of the class in the model for the file bank.  During model initialization, an instance is created: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = JetCache::instance();</code> </pre><br><br>  The creation of the data cache will be considered on the example of a function for extracting a list of files of a specific rubric (here some arguments and some code are removed from it for easier reading): <br><a name="habracut"></a><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">//    /** * * @param int $rubricId Id    * @return array */ public function getFiles($rubricId) { //!!!  ,      , //   $key = 'filebank_get_files'.$rubricId; $arResult = $this-&gt;cache-&gt;get($key); if (is_array($arResult)) { return $arResult; } $arResult = array(); $arParams = array(); $arParams[':rubricId'] = $rubricId; $query = " SELECT * FROM `filebank_files` WHERE `rubric_id`=:rubricId ORDER BY `time` DESC, `name` ASC "; $arResult['files'] = DB::query(Database::SELECT, $query) -&gt;parameters($arParams) -&gt;execute() -&gt;as_array(); //!!!      $this-&gt;cache-&gt;set($key, $arResult, array('filebank_rubrics', 'filebank_files')); return $arResult; }</span></span></code> </pre><br><br>  Thus, an entry to the cache is made with the key <code>$key = 'filebank_get_files'.$rubricId</code> and the tags ‚Äúfilebank_rubrics‚Äù and ‚Äúfilebank_files‚Äù, that is, this entry is required when updating information about rubrics and files directly. <br><br>  For an example of clearing the cache by tags, consider the function for deleting a rubric.  The <code>cacheRegExp</code> property contains a regular expression for the names of the files (keys) from which to extract tags for verification.  That is, the double check: first check the file name by a regular expression, then check the tags. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $cacheRegExp = <span class="hljs-string"><span class="hljs-string">'/^filebank/'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  public function delRubric($rubricId) { $query = ' SELECT `name` FROM `filebank_files` WHERE `rubric_id`=:rubricId '; $arFiles = DB::query(Database::SELECT, $query) -&gt;param(':rubricId', $rubricId) -&gt;execute() -&gt;as_array(); $arFiles = Arr::path($arFiles, '*.name'); $this-&gt;delFiles($arFiles); $query = ' DELETE FROM `filebank_rubrics` WHERE `rubric_id`=:rubricId '; DB::query(Database::DELETE, $query) -&gt;param(':rubricId', $rubricId) -&gt;execute(); //!!!     $tags = array('filebank_rubrics', 'filebank_files'); $this-&gt;cache-&gt;delete_by_tags($tags, $this-&gt;cacheRegExp); }</span></span></code> </pre><br>  That is, after deleting a rubric, the data cache associated with rubrics and rubric positions is cleared. <br><br>  Thus, the primary long-term data caching feature has been added.  At the controller level, you can also use short-term caching using the standard ‚ÄúCache‚Äù module with a file driver. <br><br>  In the case of large projects that require high speed to clear the cache or add information by users, of course, it is better to use special solutions.  For example, the ‚ÄúMemcached-tag‚Äù or ‚ÄúXcache‚Äù drivers of the ‚ÄúCache‚Äù module.  But for small sites administered by one person or a small group of people, when using hosting sites without providing special tools for caching, this solution fits well. <br><br>  The files in which the cache is stored are contained in one directory and have the following structure: <br> <code>,      (unix timestamp)\n <br>    \n <br>  \n <br></code> <br><br>  Finally, I‚Äôll give the full class code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'SYSPATH'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct access allowed.'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JetCache</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $instance = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $cache_dir; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $cache_time; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance)) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$config = Kohana::config(<span class="hljs-string"><span class="hljs-string">'jethelix'</span></span>)-&gt;default; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$config[<span class="hljs-string"><span class="hljs-string">'jet_cache_dir'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_dir(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir)) { $oldUmask = umask(<span class="hljs-number"><span class="hljs-number">0000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mkdir(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir, <span class="hljs-number"><span class="hljs-number">0777</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>)) { $message = <span class="hljs-string"><span class="hljs-string">'    JetCache'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>($message); } umask($oldUmask); } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_time = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$config[<span class="hljs-string"><span class="hljs-string">'jet_cache'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__clone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, $data, array $tags=array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $lifetime=NULL)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$lifetime) { $lifetime = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_time; } $filename = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $id . <span class="hljs-string"><span class="hljs-string">'.txt'</span></span>; $expires = time() + (int)$lifetime; $tagString = implode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $tags); $serData = serialize($data); $content = $expires . <span class="hljs-string"><span class="hljs-string">"\n"</span></span> . $tagString . <span class="hljs-string"><span class="hljs-string">"\n"</span></span> . $serData; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { file_put_contents($filename, $content); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $filename = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $id . <span class="hljs-string"><span class="hljs-string">'.txt'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_file($filename)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $content = file_get_contents($filename); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } $arContent = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, $content); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span> ($content); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($arContent[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt; time()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } $data = unserialize($arContent[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $filename = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $id . <span class="hljs-string"><span class="hljs-string">'.txt'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { unlink($filename); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">garbage_collect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $dir = opendir(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($file = readdir($dir)) { $fullName = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span>. $file; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_file($fullName)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_deleteIfExpires($fullName); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_deleteIfExpires</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename)</span></span></span><span class="hljs-function"> </span></span>{ $fhandle = fopen($filename, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); $expires = (int)fgets($fhandle); fclose($fhandle); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($expires &lt; time()) { unlink($filename); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete_by_tags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $tags, $filenameRegExp=NULL)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;garbage_collect(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $arFiles = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getTaggedFiles($tags, $filenameRegExp); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_deleteFiles($arFiles); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTaggedFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $needTags, $filenameRegExp)</span></span></span><span class="hljs-function"> </span></span>{ $taggedFiles = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $dir = opendir(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($file = readdir($dir)) { $fullName = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$cache_dir . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $file; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_file($fullName)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($filenameRegExp &amp;&amp; !preg_match($filenameRegExp, $file)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $hasTags = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getTagsFromFile($fullName); $isValid = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_tagsValidate($needTags, $hasTags); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isValid) { $taggedFiles[] = $fullName; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $taggedFiles; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTagsFromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename)</span></span></span><span class="hljs-function"> </span></span>{ $fhandler = fopen($filename, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); fgets($fhandler); $tagString = fgets($fhandler); fclose($fhandler); $tagString = trim($tagString); $arTags = explode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $tagString); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $arTags; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_tagsValidate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $needTags, array $hasTags)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($needTags <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $tag) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($tag, $hasTags)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_deleteFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $files)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($files <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $filename) { unlink($filename); } } }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/119588/">https://habr.com/ru/post/119588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119582/index.html">Release of Nginx CT ++ Module 0.5 - a high-performance template engine for a web server</a></li>
<li><a href="../119584/index.html">Glif: We shoot on the iPhone correctly</a></li>
<li><a href="../119585/index.html">Animation and Canvas</a></li>
<li><a href="../119586/index.html">Augmented Reality in Air Racing with Real Aircraft</a></li>
<li><a href="../119587/index.html">TrustPort Antivirus Products Competition</a></li>
<li><a href="../119589/index.html">SMP ON-Bank: Savings</a></li>
<li><a href="../119590/index.html">Application Development at AMFPHP</a></li>
<li><a href="../119591/index.html">Tool for offline ordering in the online store</a></li>
<li><a href="../119592/index.html">The imperfection of plain text as a carrier of information</a></li>
<li><a href="../119593/index.html">iOS tips and tricks: Dynamic Default.png</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>