<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Enhanced Four Rules for Software Design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! I present to you the article "Four Better Rules for Software Design" by David Bryant Copeland. David Bryant Copeland is a software archit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Enhanced Four Rules for Software Design</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello, Habr!  I present to you the article "Four Better Rules for Software Design" by David Bryant Copeland.  David Bryant Copeland is a software architect and CTO for Stitch Fix.  He maintains <a href="https://naildrivin5.com/">a blog</a> and is the <a href="https://naildrivin5.com/bio/index.html">author of several books</a> . </p><br><p>  Martin Fowler recently tweeted with a link to his <a href="https://martinfowler.com/bliki/BeckDesignRules.html">blog post</a> about four simple design rules from Kent Beck, which I think can be further improved (and which can sometimes send the programmer in the wrong way): </p><br><p>  Kent's Rules from <a href="https://www.amazon.com/gp/product/0201616416">Extreme Programming Explained</a> : </p><br><ul><li>  Kent says, "Run all the tests." </li><li>  Do not duplicate the logic.  Try to avoid hidden duplicates, such as parallel class hierarchies. </li><li>  All intentions important to the programmer should be clearly visible. </li><li>  The code should have the smallest possible number of classes and methods. </li></ul><br><p>  According to my experience, these rules do not quite meet the needs of software design. <a name="habracut"></a>  My four rules for a well-designed system might be: </p><br><ul><li>  it is well covered by tests and successfully passes them. </li><li>  it does not have abstractions that the program does not directly need. </li><li>  she has unambiguous behavior. </li><li>  it requires the least amount of concepts. </li></ul><br><p>  For me, these rules stem from what we do with our software. </p><br><h1 id="tak-chto-zhe-my-delaem-s-nashim-po">  So what do we <em>do</em> with our software? </h1><br><p>  We cannot talk about software design without first talking about what we intend to do with it. </p><br><p>  The software is written to solve the problem.  The program runs and has a behavior.  This behavior is studied to ensure correct operation or to detect errors.  Software also often changes to give it new or changed behavior. </p><br><p>  Therefore, any approach to software design should be focused on predicting, studying, and understanding its behavior in order to make changing this behavior as simple as possible. </p><br><p>  We check the correctness of behavior by testing, and therefore I agree with Kent that the first and most important thing is that well-designed software must pass the tests.  I will even go further and insist that the software should have tests (i.e. be well covered by tests). </p><br><p>  After the behavior has been verified, the following three points on both lists relate to understanding our software (and therefore its behavior).  His list begins with code duplication, which is really in place.  However, in my personal experience, focusing too much on reducing code duplication is expensive.  To eliminate it, it is necessary to create abstractions that hide it, and it is these abstractions that make the software difficult to understand and change. </p><br><h1 id="ustranenie-dublirovaniya-koda-trebuet-abstrakciy-a-abstrakcii-privodyat-k-slozhnosti">  Eliminating code duplication requires abstractions, and abstractions lead to complexity </h1><br><p>  Don't Repeat Yourself or DRY is used to justify controversial design decisions.  Have you ever seen similar code? </p><br><pre><code class="ruby hljs">ZERO = BigDecimal.new(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p>  In addition, you probably saw something like this: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map payload, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> async, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> errorStrategy)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  If you see methods or functions with flags, boolean, etc., then this usually means that someone used the DRY principle when refactoring, but the code was not <em>exactly</em> the same in both places, so the resulting code should have be flexible enough to accommodate both behaviors. </p><br><p>  Such generalized abstractions are difficult to test and understand, since they should handle many more cases than the original (possibly duplicated) code.  In other words, abstractions support much more behaviors than is necessary for the normal functioning of the system.  Thus, eliminating code duplication can create new behavior that the system does not require. </p><br><p>  Therefore, it is <em>really important to</em> combine some types of behavior, but it can be difficult to understand what kind of behavior is really duplicated.  Often pieces of code look similar, but this happens only by accident. </p><br><p>  Consider how much easier it is to eliminate duplication of code than to return it again (for example, after creating a poorly thought out abstraction).  Therefore, we need to think about leaving duplicate code, unless we are absolutely sure that we have a better way to get rid of it. </p><br><p>  Creating abstractions should make us think.  If in the process of eliminating duplicate code you create a very flexible generalized abstraction, then you may have gone the wrong way. </p><br><p>  This leads us to the next point - intent versus behavior. </p><br><h1 id="namerenie-programmista-bessmyslenno---povedenie-znachit-vse">  Programmer‚Äôs intention is meaningless - behavior means everything </h1><br><p>  We often praise programming languages, constructs, or pieces of code for ‚Äúrevealing the programmer‚Äôs intentions.‚Äù  But what's the point of knowing intentions if you cannot predict behavior?  And if you know behavior, how much does intention mean?  It turns out that you <em>need</em> to know how the software <em>should</em> behave, but this is not the same as the "programmer's intentions." </p><br><p>  Let's look at this example, which very well reflects the intentions of the programmer, but does not behave as intended: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LastModified</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Last modified on { props.date.toLocaleDateString() } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br><p>  Obviously, the programmer planned that this React component would display a date with the message "Last modified on".  Does this work as intended?  Not really.  What if this.prop.date doesn't matter?  Everything just breaks down.  We don‚Äôt know if it was so planned, or someone just forgot about it, and it doesn‚Äôt even matter.  What matters is the behavior. </p><br><p>  And this is exactly what we should know if we want to change this part of the code.  Imagine we need to change the line to "Last modification".  Although we can do this, it is not clear what should happen if date is missing.  It would be better if we instead write the component in such a way as to make its behavior more understandable. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LastModified</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!props.date) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"LastModified requires a date to be passed"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Last modified on { props.date.toLocaleDateString() } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br><p>  Or even like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LastModified</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (props.date) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Last modified on { props.date.toLocaleDateString() } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Never modified</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } }</code> </pre> <br><p>  In both cases, the behavior is more understandable, and the intentions of the programmer do not matter.  Suppose we choose the second alternative (which handles the missing date value).  When we are asked to change the message, we can see the behavior and check whether the message "Never modified" is correct or whether it also needs to be changed. </p><br><p>  Thus, the more unambiguous the <em>behavior</em> , the more chances we have to successfully change it.  And this means that we may need to write more code or make it more accurate, or even write duplicate code sometimes. </p><br><p>  This also means that we will need more classes, functions, methods, etc. Of course, <em>we would like to</em> keep their number minimal, but we should not use this number as our metric.  Creating a large number of classes or methods creates <em>conceptual overhead</em> , and more concepts appear in the software than units of modularity.  Therefore, we need to reduce the number of concepts, which, in turn, can lead to a decrease in the number of classes. </p><br><h1 id="konceptualnye-rashody-sposobstvuyut-zaputannosti-i-uslozhneniyu">  Conceptual costs contribute to confusion and complexity </h1><br><p>  To understand what the code will actually do, you need to know not only the subject area, but also all the concepts used in this code (for example, when searching for the standard deviation, you must know the assignment, addition, multiplication, for loops and array lengths).  This explains why as the number of concepts in a design increases, its complexity for understanding increases. </p><br><p>  I <a href="http://naildrivin5.com/blog/2018/02/02/explicit-code-is-inclusive.html">used</a> to write about <a href="https://naildrivin5.com/blog/2019/06/29/simple-expressions-only.html">conceptual expenses</a> , and a good side effect of reducing the number of concepts in a system is that more people can understand this system.  This in turn increases the number of people who can make changes to this system.  Definitely, a software design that can safely be changed by many people is better than one that can only be changed by a small handful.  (Therefore, I believe that hardcore functional programming will never become popular, as it requires a deep understanding of many very abstract concepts.) </p><br><p>  Reducing conceptual costs will naturally reduce the number of abstractions <em>and</em> make behavior easier to understand.  I do not say ‚Äúnever introduce a new concept‚Äù, I say that it has its own price, and if this price outweighs the benefit, the introduction of a new concept should be carefully considered. </p><br><p>  When we write code or design software, we should stop thinking about the <em>elegance</em> , <em>beauty,</em> or other subjective measure of our code.  Instead, we should always remember what we are going to do with the software. </p><br><h1 id="vy-ne-veshaete-kod-na-stenu---vy-menyaete-ego">  You do not hang the code on the wall - you change it </h1><br><p>  A code is not a work of art that you can print and hang in a museum.  The code is executing.  It is studied and debugged.  And, most importantly, it is <em>changing</em> .  And often.  Any design that is difficult to work with should be called into question and reviewed.  Any design that reduces the number of people who can work with it should <em>also</em> be called into question. </p><br><p>  The code should work, so it should be tested.  The code has bugs and will require the addition of new features, so we need to understand its behavior.  The code lives longer than the ability of a particular programmer to support it, so we should strive for code that is understandable to a wide range of people. </p><br><p>  When you write your code or design your system, do you simplify the explanation of system behavior?  Is it becoming easier to understand how she will behave?  Are you focused on solving the problem right in front of you or on a more abstract one? </p><br><p>  Always try to keep behavior simple for demonstration, prediction and understanding, and keep the number of concepts to an absolute minimum. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/461823/">https://habr.com/ru/post/461823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461805/index.html">Monte Carlo Integration Application in Rendering</a></li>
<li><a href="../461807/index.html">How pod priorities at Kubernetes caused downtime at Grafana Labs</a></li>
<li><a href="../461815/index.html">A revolution in the design of computer power supplies half a century ago</a></li>
<li><a href="../461817/index.html">CMake and C ++ - brothers forever</a></li>
<li><a href="../461819/index.html">Why simple website design is better scientifically</a></li>
<li><a href="../461827/index.html">Hybrid PHP / Go Application Development Using RoadRunner</a></li>
<li><a href="../46183/index.html">Domain .tel: Internet Phone Directory</a></li>
<li><a href="../461831/index.html">StealthWatch: Deployment and Customization. Part 2</a></li>
<li><a href="../461833/index.html">Do not get lost in three pines: an egocentric representation of the environment</a></li>
<li><a href="../461837/index.html">Deploying your MTProxy Telegram with statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>