<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security system Campus.ru</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing almost any software product, sooner or later, developers face the problem of restricting access. For example, in a web application, so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security system Campus.ru</h1><div class="post__text post__text-html js-mediator-article">  When developing almost any software product, sooner or later, developers face the problem of restricting access.  For example, in a web application, some pages can be accessed only by administrators or only registered users.  In the Campus.ru project, this access restriction is provided by the Spring Security library. <br><br>  Spring Security works with static roles that are defined through a URI for each request from the HTTP client.  But what about dynamic roles that change depending on the relationship between the current user and the requested object (for example, the role of the author in relation to the article)? <br><a name="habracut"></a><br><br>  To solve the problem of access to individual entities, the Domain Object Security System from Spring can be used.  However, this system is rigidly tied to the domain model, supports a limited number of functions on entities (up to 32) and is rather complex in implementation (7 key interfaces). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We decided to develop a new framework CRMedia.Security, which would have more flexibility, support dynamic access lists, and also be easier to use.  The idea of ‚Äã‚Äãthe framework proposed by us is that it allows you to protect certain user actions with a specific set of arguments, the meaning of which is known only to the web application, but not to the security system.  Such a model of the system allows you to abstract away Campus.ru entities and use the framework in other projects. <br><br>  CRMedia.Security gets the action, after which its arguments from the application look for restrictions on these actions through the PermissionProvider and calculate the intersection of these restrictions with the access list of the current user provided by the ACLProvider.  If the intersection is an empty set, then a handler is called that corresponds to the access denied case.  In the case of a non-empty intersection, the call to a specific Tapestry event continues. <br><br>  Here is a specific scenario that requires verification of rights: for example, viewing the community with id = 10 articles under number 20. In this case, ‚Äúviewing an article‚Äù is an action, and 10, 20 - its arguments.  Suppose this article is available only to members of a community, and a non-community user is trying to view it.  Thus, the PermissionProvider implemented in the application must return the ‚Äúcommunity member‚Äù constraint, and the ACLProvider is ‚Äúnot a member of the community‚Äù.  The intersection of these sets is empty, and, therefore, access to the page of the post will be closed. <br><br>  Consider a software implementation of a security system using the CRMedia.Security framework.  First you need to connect the CRMedia.Security module to the application being developed.  This module connects the annotation handler to the Tapestry component converter chain (ComponentClassTransformWorker). <br><br>  The interface of the restriction provider (PermissionProvider) is as follows: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> PermissionProvider { <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*     </font> <br> <font color="#008000">* @param action      </font> <br> <font color="#008000">* @param permission    ACL</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">void</font> restrict(Action action, <font color="#2B91AF">List</font> &lt;PermissionEntry&gt; permission); <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*  ACL    </font> <br> <font color="#008000">* @param action  </font> <br> <font color="#008000">* @return ACL</font> <br> <font color="#008000">*/</font> <br> <font color="#2B91AF">List</font> &lt;PermissionEntry&gt; <font color="#0000ff">get</font> (Action action); <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*       </font> <br> <font color="#008000">* @param action  </font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">void</font> revoke(Action action); <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*             </font> <br> <font color="#008000">* @param params    </font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">void</font> revokeReferenced(Map&lt; <font color="#2B91AF">String</font> , Object&gt; <font color="#0000ff">params</font> ); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  It can be implemented as a DAO for storing constraints in the database.  Here Action is a collection of the name of the action and the list of named arguments ({view_article; community = 10; article = 20} for the example above), and PermissionEntry is one entry of the access list (for example, {status = member}). <br><br>  ACLProvider contains the only method by which CRMedia.Security gets the current user's access list: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> ACLProvider { <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*          </font> <br> <font color="#008000">* @param component     </font> <br> <font color="#008000">* @param action      </font> <br> <font color="#008000">* @return   ; null,   </font> <br> <font color="#008000">*/</font> <br> <font color="#2B91AF">List</font> &lt;PermissionEntry&gt; getACL(Component component, Action action); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  For our example on action {view_article;  community = 10;  article = 20} the getACL method should return the set {status = nonmember} based on the relationship between the current user and the specified community. <br><br>  Now you need to tell the security engine exactly which events should be protected.  To do this, you must arrange annotations CRMedia.Security. <br><br>  Let the post be viewed through the ViewArticle page.  When accessing it using Tapestry rules, the onActivate method is called.  To restrict access to it, we need to arrange annotations in the following way: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ViewArticle { <br> <br> @Restricted(action = <font color="#A31515">"view_article"</font> ) <br> Object onActivate(@SecuredParam( <font color="#A31515">"community"</font> ) Community community, <br> @SecuredParam( <font color="#A31515">"article"</font> ) Article article) { <br> <br> ... <br> <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The Restricted annotation is placed before an event that has a restriction.  Each event corresponds to one action (in this case, ‚Äúview_article‚Äù) with a specific set of arguments (‚Äúcommunity‚Äù and ‚Äúarticle‚Äù).  Arguments from this are accompanied by SecuredParam annotations. <br><br>  By default, when access is denied, the client receives a response from the server with the code 403 (Forbidden).  If necessary, you can use your handler: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ViewArticle { <br> <br> @Restricted(action = <font color="#A31515">"view_article"</font> ) <br> <font color="#0000ff">void</font> onActivate(@SecuredParam( <font color="#A31515">"community"</font> ) Community community, <br> @SecuredParam( <font color="#A31515">"article"</font> ) Article article) { <br> <br> ... <br> <br> } <br> <br> Object onForbidForListArticles() { <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> TextStreamResponse( <font color="#A31515">"text/plain"</font> , <font color="#A31515">"access denied"</font> ); <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  CRMedia.Security supports nested properties in the arguments being checked.  For example, in the following example, the ‚Äúcommunity‚Äù parameter is taken from the community property of the Article entity: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Article { <br> <br> <font color="#0000ff">public</font> Community getCommunity() { <br> ‚Ä¶ <br> } <br> <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> ViewArticle { <br> <br> @Restricted( <br> action = <font color="#A31515">"view_article"</font> , <br> <font color="#0000ff">params</font> = { <br> @SecuredProp(name = <font color="#A31515">"community"</font> , paramProp = <font color="#A31515">"article.community"</font> ) <br> } <br> ) <br> Object onActivate(@SecuredParam( <font color="#A31515">"article"</font> ) Article article) { <br> <br> ... <br> <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  If the page retains its state between requests, the values ‚Äã‚Äãof the action arguments for the protected event (‚Äúview‚Äù in the example below) can be taken from the page itself: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ViewArticle { <br> <br> @Property <br> @Persist <br> <font color="#0000ff">private</font> Article article; <br> <br> @Restricted( <br> action = <font color="#A31515">"view_article"</font> , <br> <font color="#0000ff">params</font> = { <br> @SecuredProp(name = <font color="#A31515">"article"</font> , pageProp = <font color="#A31515">"article"</font> ), <br> @SecuredProp(name = <font color="#A31515">"community"</font> , paramProp = <font color="#A31515">"article.community"</font> ) <br> } <br> ) <br> Object onView() { <br> <br> ... <br> <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In addition to restrictions on events, you can set a limit on viewing parts of the page.  To do this, there is an IfCan component in the framework, which is completely similar to using the If component from Tapestry Core in the template: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">="http://www.w3.org/1999/xhtml"</font> <font color="#ff0000">xmlns:t</font> <font color="#0000ff">="http://tapestry.apache.org/schema/tapestry_5_0_0.xsd"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">t:ifCan</font> <font color="#ff0000">actionName</font> <font color="#0000ff">="view_article"</font> <font color="#ff0000">context</font> <font color="#0000ff">="viewArticleContext"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">t:eventlink</font> <font color="#ff0000">event</font> <font color="#0000ff">="view"</font> <font color="#0000ff">&gt;</font>   <font color="#0000ff">&lt;/</font> <font color="#800000">t:eventlink</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">t:parameter</font> <font color="#ff0000">name</font> <font color="#0000ff">="else"</font> <font color="#0000ff">&gt;</font> <br>   <br> <font color="#0000ff">&lt;/</font> <font color="#800000">t:parameter</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">t:ifCan</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The viewArticleContext property, similar to SecuredProp annotations, defines a list of protected parameters: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ViewArticle { <br> <br> @Property <br> @Persist <br> <font color="#0000ff">private</font> Article article; <br> <br> <font color="#0000ff">public</font> Object[] getViewArticleContext() { <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> Object[]{ <font color="#A31515">"article"</font> , article, <font color="#A31515">"community"</font> , article.getCommunity()}; <br> } <br> <br> @Restricted( <br> action = <font color="#A31515">"view_article"</font> , <br> <font color="#0000ff">params</font> = { <br> @SecuredProp(name = <font color="#A31515">"article"</font> , pageProp = <font color="#A31515">"article"</font> ), <br> @SecuredProp(name = <font color="#A31515">"community"</font> , paramProp = <font color="#A31515">"article.community"</font> ) <br> } <br> ) <br> Object onView() { <br> <br> ... <br> <br> } <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Thus, the developed framework has a sufficient degree of abstraction, allows you to protect various events on the Tapestry pages from unauthorized execution and to customize the display of the page depending on the rights that the user has. </div><p>Source: <a href="https://habr.com/ru/post/57525/">https://habr.com/ru/post/57525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../57513/index.html">Gamer.ru opens</a></li>
<li><a href="../57515/index.html">XSLT - a mechanism for beginners</a></li>
<li><a href="../57516/index.html">// in links</a></li>
<li><a href="../57517/index.html">Tagline 2009 - there will be no carnival?</a></li>
<li><a href="../57522/index.html">Kyocera demonstrates a foldable mobile phone with a flexible OLED display</a></li>
<li><a href="../57526/index.html">Philosophical geometry. Part 3. The root of the two and the perfect laptop</a></li>
<li><a href="../57527/index.html">Self-marketing - "Portfolio" programmer</a></li>
<li><a href="../57528/index.html">The theory of innovation of J. Schumpeter and subsequent theories</a></li>
<li><a href="../57529/index.html">Is Google ads targeting enabled?</a></li>
<li><a href="../57530/index.html">Google earnings fell for the first time in history.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>