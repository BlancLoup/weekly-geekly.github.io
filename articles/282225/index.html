<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Escape from Crypto Pro. Director's version, SMEV-edition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on how to stop using Crypto Pro and switch to Bouncy Castle in a development / test environment. 
 At the beginning of the articl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Escape from Crypto Pro. Director's version, SMEV-edition</h1><div class="post__text post__text-html js-mediator-article"><p>  This article focuses on how to stop using Crypto Pro and switch to Bouncy Castle in a development / test environment. <br>  At the beginning of the article there will be more about SMEV and its client, at the end - more about converting keys from the finished copy-paste so that you can start right now. </p><br><p>  Picture to attract attention: </p><br><img src="https://habrastorage.org/files/09e/5de/247/09e5de2472804c47aef31c11a79ccd2d.jpg" alt="image"><a name="habracut"></a><br><br><p>  And immediately the answer: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/9d1/a09/1b4/9d1a091b494fab46a29881922f481f02.jpg" alt="image"><br><br><h1>  Disclamer </h1><br><p>  Of course, it is impossible to escape with Krypto Pro, because it is a stronghold of Russian cryptography.  He satisfies the requirements of the competent authorities, he is registered in contracts and contracts, the whole country trusts him, and so on.  Therefore, all of the following applies to the developer or test environment, where we are our own masters. </p><br><p>  Recently, I needed to figure out how to write a service that works with the System of Interagency Electronic Interaction. <br>  All written is simply the result of a small study, the most abstracted from the work performed.  And even approximately to guess something about the decisions actually made is impossible, I checked. </p><br><h1>  Justification of the need for a finished client </h1><br><p>  The source code of the client lies on the SMEV3 technology portal, but what a bad luck - they are nailed to CryptoPro.  The Word file with the instruction attached to the source code states this in the most direct way.  And anyway, the source keys are also in CryptoPro format.  Based on production, this is normal, but for the test environment it is terribly inconvenient.  I would like to get rid of it. </p><br><p>  The site has two versions - "current" and "recommended."  Why they are so, and why the current version is not recommended, and the recommended one is not relevant - some kind of dilemma of a copywriter :) Then we‚Äôre talking about a client who is ‚Äúrelevant‚Äù. </p><br><p>  Strictly speaking, it cannot be used, because there is no license text in the source archive, and therefore it is not clear under which license the derivative work should be distributed.  I called the support phone number written on the portal, wrote an e-mail, watched a couple of weeks as my application flies between technical support levels and executing organizations, and as a result, it‚Äôs still there: </p><br><p><img src="https://hsto.org/files/512/b53/06f/512b5306ffca493682bd992be4d22c24.png" alt="image"></p><br><p>  The task is not completed, but completed and closed, amazingly.  Well, to hell with them ... </p><br><p>  Despite the inability to use it directly in the code, this is a great test example.  The fact is that the methodological recommendations of SMEV without pollitres cannot be understood, and the ready-made live code gives an excellent boost to understanding. </p><br><p>  The main complaint about the documentation is clericals and a poor description on the Internet. <br>  Remember the meme about the copywriter, who from the paragraph made one sentence in a few words?  For SMEV documentation, this is the place to be, for example, here is a chain of refactorins for one phrase taken for granted: </p><br><p>  "2. The consumer's IP sends an interdepartmental request to SMEV;" <br>  "2. The consumer‚Äôs IP sends a request to SMEV;" <br>  "2. The consumer‚Äôs IP sends the request;" <br>  "2. the consumer sends a request;" <br>  "2. consumer request;" </p><br><p>  In short, having a ready-made implementation is good. </p><br><h1>  Why Krypto Pro JCP is Good </h1><br><ul><li>  He is and works </li><li>  Judging by the source code of BoncyCastle, comrades from CryptoPro participated in its development by adding algorithms according to GOST </li></ul><br><h1>  Why Krypto Pro JCP is Evil </h1><br><ul><li>  If you have a lot of developers and virtual machines, you don‚Äôt really want to buy a license </li><li>  Proprietary, so all the bugs described below cannot be fixed.  More precisely, you can (disassembler shoots without a miss), but illegally and with the loss of all guarantees is not an option </li><li>  On Java 8 under OSX it was not possible to start (no version of the KP JCP).  Most likely this will be fixed pretty soon, because  representatives responded to my Facebook post </li><li>  In general, it was not possible to start on OSX.  Gui admin - half-worker, pouring errors, pieces of gui do not work. </li><li>  On Linux, too, there are bugs in the interface </li><li>  Once a long time ago, an installer on Windows wrote a crocodile console (didn‚Äôt check for new versions - maybe fixed it) </li><li>  Installing java distribution patch.  I believe that installing software by patching Java is the ultimate evil, for which the human rights court must appoint a six-time execution with hanging </li><li>  Not every java can be patched, to find out the magic combination you need to seriously oppose.  Here it is important that we try to develop on the newest versions of Java, with the heat of the heat, and we are testing on new versions (at the time of writing this article - JDK9), so restrictions on the version of Java are insane as it is. </li><li>  Ways to install and run the admin panel - fierce trash (this should be seen) </li></ul><br><p>  As an alternative, in a test environment, I would prefer to use Bouncy Castle with a PKCS12 or JKS container.  It is open, free and free software. <br>  To the credit of the developers of Krypto Pro, they seem to have taken part in its development. </p><br><h1>  What you need to finish in the finished client to escape with Krypto Pro </h1><br><p>  The code is written quite friendly for the extension, so you can simply take the KeyStoreWrapperJCP class as the basis, and write KeyStoreWrapperBouncyCastlePKCS12, KeyStoreWrapperBouncyCastleJKS in the same way. </p><br><p>  Rewrite DigitalSignatureFactory so that it starts to accept the path to the cryptocontainer on the file system and the password from it (for CryptoPro, this is simply not necessary).  There is a switch that checks the type of the crypto-provider, add two additional cases to it, for names like BOUNCY_JKS and BOUNCY_PKCS12 and hang up using the appropriate KeyWrapper and call initXmlSec. </p><br><p>  In initXmlSec you need to add <br>  1) the ability to accept any provider at all, not just cryptopro (it is just convenient) <br>  2) Security.addProvider (new BouncyCastleProvider ()); <br>  3) for XMLDSIG_SIGN_METHOD, make a switch: if CryptoPro, the algorithm is called "GOST3411withGOST3410EL", and if the BouncyCastle algorithm is called "GOST3411WITHECGOST3410". </p><br><p>  Well, sort of like everything.  If the license for this smav client was known, I would attach specific code under the Apache License 2, and this is just a list of ideas. </p><br><h1>  Initializing XML Signatures in Santuario </h1><br><p>  Oh yeah, there is one interesting point.  There are a lot of advice on SMEV in the network, consisting in manual parsing of XMLk pieces and manually setting the sun at sunset, but this is not our method (and not the method used by the client‚Äôs creators) </p><br><p>  The batch is that it is easy to generate self-signed keys according to GOST (a copy-paste to SO is searched for in seconds).  But to sign - no, because in the opinion of online schoolchildren, allegedly Bouncycastle does not support xml-signature.  More specifically, when working with Apache Santuario, XMLSignature from santuario-xmlsec does not understand what to use to handle the "xmldsig-more # gostr34102001-gostr3411" method when calling xmlSignature.sign (privateKey). </p><br><p>  Separate Hochma is that the IntelliJ IDEA Community is buggy when you try to detach xmlsec by throwing the step in debugger in the wrong place with the correct source code.  I tried all the sensible versions of Idea, so understand how it works blindly, writing tactical letters in Sportloto.  This is not a reproach to the Idea, there are no perfect tools, just a factor that influenced the speed of understanding the issue. </p><br><p>  To make it work, you need: </p><br><p>  1) Implement the SignatureAlgorithmSpi implementation from Apache Santuario.  In GetEngineUri, return the string: " <a href="http://www.w3.org/2001/04/xmldsig-more">http://www.w3.org/2001/04/xmldsig-more#gostr34102001-gostr3411</a> " (or whatever you have).  This is the key magic.  Absolutely nothing clever this class should not do. </p><br><p>  Initialization of the application's lifetime (for example, in the singleton bean of the spring): </p><br><p>  2) Download the provider so as not to patch the JDK: </p><br><pre><code class="java hljs">Security.addProvider(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BouncyCastleProvider());</code> </pre> <br><p>  3) Go to runtime just-written class: </p><br><pre> <code class="java hljs">String algorithmClassName = <span class="hljs-string"><span class="hljs-string">"fully qualified name   SignatureAlgorithmSpi"</span></span>; Class.forName(algorithmClassName); SignatureAlgorithm.providerInit(); SignatureAlgorithm.register(<span class="hljs-string"><span class="hljs-string">"http://www.w3.org/2001/04/xmldsig-more#gostr34102001-gostr3411"</span></span>, algorithmClassName);</code> </pre> <br><p>  4) Knocking on JCE mapping algorithms: </p><br><pre> <code class="java hljs">String ns = <span class="hljs-string"><span class="hljs-string">"http://www.xmlsecurity.org/NS/#configuration"</span></span>; Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument(); Element rootElement = document.createElementNS(ns, <span class="hljs-string"><span class="hljs-string">"JCEAlgorithmMappings"</span></span>); Element algorithms = document.createElementNS(ns, <span class="hljs-string"><span class="hljs-string">"Algorithms"</span></span>);</code> </pre> <br><p>  5) Zapit method for the algorithm: </p><br><pre> <code class="java hljs">Element aElem = document.createElementNS(NameSpace, <span class="hljs-string"><span class="hljs-string">"Algorithm"</span></span>); aElem.setAttribute(<span class="hljs-string"><span class="hljs-string">"URI"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://www.w3.org/2001/04/xmldsig-more#gostr34102001-gostr3411"</span></span>); aElem.setAttribute(<span class="hljs-string"><span class="hljs-string">"Description"</span></span>, <span class="hljs-string"><span class="hljs-string">"GOST R 34102001 Digital Signature Algorithm with GOST R 3411 Digest"</span></span>); aElem.setAttribute(<span class="hljs-string"><span class="hljs-string">"AlgorithmClass"</span></span>, <span class="hljs-string"><span class="hljs-string">"Signature"</span></span>); aElem.setAttribute(<span class="hljs-string"><span class="hljs-string">"RequirementLevel"</span></span>, <span class="hljs-string"><span class="hljs-string">"OPTIONAL"</span></span>); aElem.setAttribute(<span class="hljs-string"><span class="hljs-string">"JCEName"</span></span>, <span class="hljs-string"><span class="hljs-string">"GOST3411WITHECGOST3410"</span></span>); algorithms.appendChild(aElem);</code> </pre> <br><p>  6) Apply mappings: </p><br><pre> <code class="java hljs">org.apache.xml.security.Init.init(); JCEMapper.init(rootElement);</code> </pre> <br><p>  6) PROFIT! <br>  After this, XMLSignature abruptly begins to understand this method, and will begin to make xmlSignature.sign. </p><br><h1>  OpenSSL preparation for working with GOST </h1><br><p>  If you have OpenSSL on the wall at the beginning of the article, someday it will definitely shoot. <br>  So yes, this is an important point, necessary for the implementation of further text. </p><br><ul><li>  Since we have a Crypto Pro, and on the Mac it does not take off, we need a virtual machine with Windows (you can even use Windows XP), and the installed Crypta </li><li>  Install the latest version of OpenSSL as possible (so that it already has GOST support): <br>  <a href="https://wiki.openssl.org/index.php/Binaries">https://wiki.openssl.org/index.php/Binaries</a> <br>  <a href="https://slproweb.com/products/Win32OpenSSL.html">https://slproweb.com/products/Win32OpenSSL.html</a> </li><li>  Check that the installed version has the gost.dll file </li><li>  In the installed OpenSSL find the file openssl.cfg </li><li>  Add the line to the very beginning of the file: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">openssl_conf</span></span> = openssl_def</code> </pre> </li><li><p>  Add lines to the very end of the file: </p><br><pre> <code class="hljs objectivec">[openssl_def] engines = engine_section [engine_section] gost = gost_section [gost_section] engine_id = gost dynamic_path = ./gost.dll default_algorithms = ALL CRYPT_PARAMS = <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>-Gost28147<span class="hljs-number"><span class="hljs-number">-89</span></span>-CryptoPro-A-ParamSet</code> </pre> <br></li><li>  PROFIT </li></ul><br><h1>  How can we ask Krypto Pro to hand over the keys (actually, no) </h1><br><p>  If we already have real (not self-signed) keys, then it would be completely unreasonable to check them in action.  Yes, we are talking about test purposes, but still trust - but check! </p><br><p>  If you put the Windows in a virtual machine, roll Krypto Pro there, install the keys and try to export them, then we find an amazing thing: the export to PKCS12 does not work in the exporter, and all other directions in the exporter are blocked (English "grayed out"). </p><br><p>  I google a mistake, and what do we see on the official forum? <br>  <a href="https://www.cryptopro.ru/forum2/default.aspx%3Fg%3Dposts%26t%3D2425">https://www.cryptopro.ru/forum2/default.aspx?g=posts&amp;t=2425</a> </p><br><p>  "From Alexey Pisinin the answer was received: <br>  Good day.  PKCS12 does not meet the security requirements of the FSB regarding the storage of private keys.  In theory, private keys should be stored on so-called "removable" media.  Actually, for this reason, the export does not work. " </p><br><p>  I read it correctly, what do they have for export, but I don‚Äôt have business logic to it? <br>  For any ticks, do not click - there will always be an error on the last step of the wizard !? </p><br><p>  What a shame. </p><br><p>  Dear god <br>  Please kill them all. <br>  Love, Greg. </p><br><p><img src="https://hsto.org/files/14d/6c3/363/14d6c33631e1428c9de1fde82685544c.jpg" alt="image"></p><br><h1>  How can we roughly force Krypto Pro to give away the keys </h1><br><p>  You can suffer for a very long time trying to roll up C ++ to subtract the key from the container using OpenSSL and such and such mother.  I honestly tried, and crashed about the task like a ship on the rocks (at least, this is a task for more than 1 day for a person who hasn‚Äôt been doing this for a long time).  On the Internet, we are not the only ones who crashed on the same rocks: <a href="http://gigamir.net/techno/pub903517">http://gigamir.net/techno/pub903517</a> </p><br><p>  Here comes the moment "this is joy with tears in his eyes."  A certain office called Lissy Soft, for only 2 thousand rubles, gives us the ingenious utility P12FromGostCSP.  Its creators did defeat the problem that the community had not mastered, and it tears out the keys in PFX.  Joy - because it works. </p><br><p>  With tears - because it is proprietary, and she knows how she works. <br>  In the picture, Richard Stallman seems to be surprised and asks: "Are you really fighting proprietary with the help of another proprietary one?" </p><br><p><img src="https://hsto.org/files/000/ec7/292/000ec7292e2d425d9145854b56722a5e.jpg" alt="image"></p><br><p>  So the whole instruction on driving the keys looks something like this: </p><br><ul><li>  All actions are performed on Windows (a virtual machine will do) with an installed Crypto Pro CSP; </li><li>  Prepare OpenSSL with GOST instructions (in this article). </li><li>  Buy P12FromGostCSP.  Cry. </li><li>  Install the original key in CryptoPro (this deserves a separate instruction, but it is googled). </li><li>  Run P12FromGostCSP (before this, hide the icon of Richard Stallman under the table so that he does not curse you for launching proprietary art) </li><li>  Select installed certificate, specify CryptoPro certificate password </li><li>  Specify an arbitrary new password (password phrase) for the PFX key pair </li><li>  Specify the location to save the file.  It is better to name the file in p12.pfx format (this is the default name, it is better not to touch it - they say there are bugs if renamed) </li><li>  Get pem file: <br><pre> <code class="hljs cs">openssl pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> p12.pfx -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pem -name <span class="hljs-string"><span class="hljs-string">"alias"</span></span></code> </pre> </li><li>  (-name "alias" - this option will change the name of the key inside the container. This is necessary because P12FromGostCSP names the keys as a hit (in fact, in order, numbers) without saving the original alias. </li><li>  Get the pkcs12 file: <br><pre> <code class="hljs cs">openssl pkcs12 -export -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pem -name <span class="hljs-string"><span class="hljs-string">"alias"</span></span></code> </pre> </li><li>  Is done </li></ul><br><h1>  Test self-signed keys </h1><br><p>  Since we are doing all this for test purposes, now we come to a climax and begin to give ourselves the keys. </p><br><p>  How to issue keys in the Crypto Pro format, I did not particularly bother, because it simply is not necessary in the framework of the current task.  But just in case, there is a service for issuing such keys: <a href="http://www.cryptopro.ru/certsrv/">http://www.cryptopro.ru/certsrv/</a> </p><br><ul><li>  All actions are performed on Windows (a virtual machine will do) with an installed Crypto Pro CSP; </li><li>  Open the site and go to the key; </li><li>  You need to select the item "Generate keys and send a certificate request" and click the "Next" button; </li><li>  Click on the link "Create and issue a request to this CA"; </li><li>  Fill in the required fields; </li><li>  Press the "Issue" button; </li><li>  Install certificate. </li></ul><br><h1>  JKS container delivery </h1><br><p>  This question is widely represented on the Internet, so you can immediately watch Stackoverflow: <br>  <a href="http://stackoverflow.com/questions/14580340/generate-gost-34-10-2001-keypair-and-save-it-to-some-keystore">http://stackoverflow.com/questions/14580340/generate-gost-34-10-2001-keypair-and-save-it-to-some-keystore</a> </p><br><p>  The idea is that since we still use Bouncy Castle, we can also generate the key. <br>  This code is not the most ideal, but it gives a really working implementation (in practice, I ended up with several large classes to make a convenient interface) </p><br><pre> <code class="java hljs">Security.addProvider( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> org.bouncycastle.jce.provider.BouncyCastleProvider() ); KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance( <span class="hljs-string"><span class="hljs-string">"ECGOST3410"</span></span>, <span class="hljs-string"><span class="hljs-string">"BC"</span></span> ); keyPairGenerator.initialize( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ECGenParameterSpec( <span class="hljs-string"><span class="hljs-string">"GostR3410-2001-CryptoPro-A"</span></span> ) ); KeyPair keyPair = keyPairGenerator.generateKeyPair(); org.bouncycastle.asn1.x500.X500Name subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> org.bouncycastle.asn1.x500.X500Name( <span class="hljs-string"><span class="hljs-string">"CN=Me"</span></span> ); org.bouncycastle.asn1.x500.X500Name issuer = subject; <span class="hljs-comment"><span class="hljs-comment">// self-signed BigInteger serial = BigInteger.ONE; // serial number for self-signed does not matter a lot Date notBefore = new Date(); Date notAfter = new Date( notBefore.getTime() + TimeUnit.DAYS.toMillis( 365 ) ); org.bouncycastle.cert.X509v3CertificateBuilder certificateBuilder = new org.bouncycastle.cert.jcajce.JcaX509v3CertificateBuilder( issuer, serial, notBefore, notAfter, subject, keyPair.getPublic() ); org.bouncycastle.cert.X509CertificateHolder certificateHolder = certificateBuilder.build( new org.bouncycastle.operator.jcajce.JcaContentSignerBuilder( "GOST3411withECGOST3410" ) .build( keyPair.getPrivate() ) ); org.bouncycastle.cert.jcajce.JcaX509CertificateConverter certificateConverter = new org.bouncycastle.cert.jcajce.JcaX509CertificateConverter(); X509Certificate certificate = certificateConverter.getCertificate( certificateHolder ); KeyStore keyStore = KeyStore.getInstance( "JKS" ); keyStore.load( null, null ); // initialize new keystore keyStore.setEntry( "alias", new KeyStore.PrivateKeyEntry( keyPair.getPrivate(), new Certificate[] { certificate } ), new KeyStore.PasswordProtection( "entryPassword".toCharArray() ) ); keyStore.store( new FileOutputStream( "test.jks" ), "keystorePassword".toCharArray()</span></span></code> </pre> <br><h1>  Delivery of the PKCS12 container </h1><br><p>  In principle, this is not really necessary, because we already have a simple and convenient way to issue JKS, and JKS for Java is the most native solution.  But to complete the picture, let it be. </p><br><ul><li>  Prepare OpenSSL with GOST instructions (in this article). </li><li>  Make Cerificate Signing Request + private key (enter the necessary data on the key!): <br><pre> <code class="hljs cs">openssl req -newkey gost2001 -pkeyopt paramset:A -passout pass:aofvlgzm -subj <span class="hljs-string"><span class="hljs-string">"/C=RU/ST=Moscow/L=Moscow/O=foo_bar/OU=foo_bar/CN=developer/emailAddress=olegchiruhin@gmail.com"</span></span> -keyout <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pem -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> csr.csr</code> </pre> </li><li>  Sign with a private key (on Windows, this operation must be done with Administrator rights, otherwise it will crash with the error "unable to write 'random state'"): <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x509</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-days</span></span> 365 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">csr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-signkey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">private</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.crt</span></span></code> </pre> </li><li>  Get the public key: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x509</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-inform</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.crt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-pubkey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-noout</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> </li><li>  GOST2001-md_gost94 hex (if applicable): <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dgst</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-hex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-sign</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">private</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xml</span></span></code> </pre> </li><li>  MIME application / x-pkcs7-signature (if applicable): <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">smime</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-sign</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-inkey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">private</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-signer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.crt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xml</span></span></code> </pre> </li><li>  Turn pem into pkcs12: <br><pre> <code class="hljs cs">openssl pkcs12 -export -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key.pem -name <span class="hljs-string"><span class="hljs-string">"alias"</span></span></code> </pre> </li></ul><br><h1>  Summary </h1><br><p>  As a result of all the above actions, we got a relatively easy way to get rid of the heavy burden of Krypto Pro. </p><br><p>  In the future, I would like to continue the fight for the drunk before the final victory: arrange all utilities, key generators, self-written smav clients and so on in the form of one repository on GitHub.  Also, I would very much like to receive the rights to modify and distribute under the permissive license of the official client of the SIEV.  Then half of this article would simply not be needed, and the problem would be solved by downloading the necessary code from GitHub. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/282225/">https://habr.com/ru/post/282225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282209/index.html">PHDays VI member stories: how Moxy Marlinspike defeated the FBI, and John Bambenek figured out hacker No. 1</a></li>
<li><a href="../282213/index.html">From Scheduler to Scheduler</a></li>
<li><a href="../282215/index.html">Tomorrow, April 23, 2016 - see the online broadcast of the Russian final of the Imagine Cup</a></li>
<li><a href="../282217/index.html">Once again about deb packages</a></li>
<li><a href="../282223/index.html">Analysis of email messages in 18 years: Unsuccessful time travel experiment</a></li>
<li><a href="../282227/index.html">FBI generously rewarded hackers for exploiting for iPhone</a></li>
<li><a href="../282229/index.html">Ubuntu Server 16.04: what's new</a></li>
<li><a href="../282231/index.html">Determine gender and age using Microsoft Project Oxford and C #</a></li>
<li><a href="../282233/index.html">Setup of VLAN on Mikrotik together with Cisco</a></li>
<li><a href="../282235/index.html">Time of unexpected analogies: river crayfish and electrical conductivity sensors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>