<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search and edit values ‚Äã‚Äãin the memory of a third-party C ++ program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is not satisfied with ArtMoney 

 Often there is a need to find and change any lines / numbers in another program. This task is best done by ArtM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search and edit values ‚Äã‚Äãin the memory of a third-party C ++ program</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is not satisfied with ArtMoney </h4><br><br>  Often there is a need to find and change any lines / numbers in another program.  This task is best done by ArtMoney.  For those who do not know how or do not want to use debuggers, this is probably the only option today, since there are simply no normal analogues.  Although ArtMoney supports a lot of possibilities for working with memory, the whole process is done manually, without the possibility of creating actions using an algorithm.  If there are many values ‚Äã‚Äãand they need to be changed, for example, each time the program is started, then the time spent on this work exceeds any permissible limits.  Only one way out - to write your own memory editor! <br><a name="habracut"></a><br><h4>  We are looking for sources </h4><br><br>  At one time, I had a task that required modification of the values ‚Äã‚Äãin the memory of another program constantly during its operation.  One of the conditions was that the program would work on other machines, which means that the option of writing to memory at predetermined addresses would not work: the addresses for different machines will be different and it is necessary to implement the search for addresses in memory. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I started writing a bootloader and started looking for information on this issue.  Unfortunately, I do not own Delphi, and when it was discovered that most of the source code is in this language, I was a little confused.  I didn‚Äôt have time or opportunity to rewrite a huge amount of code in C ++.  Another discovery was that none of the sources I found worked correctly: the program either hung or worked with errors.  In addition, the work of all these search programs in memory took much longer than it should (15‚Äì20 times longer than ArtMoney). <br><br>  Searching the forums (including English) was also not joyful: in the topics related to the subject in C ++ there were snippets of code (obviously without the necessary functionality).  I do not remember where the author would have successfully solved his question.  Nevertheless, I made some knowledge about the device memory in Windows and learned about the functions used in the work. <br><br>  After several days of torment, I found one useful <a href="http://www.rohitab.com/discuss/index.php%3Fshowtopic%3D29190%26st%3D0%26p%3D10031597%26">topic</a> .  The author gives quite a working program in C ++, unfortunately it worked very slowly.  The solution is there in the penultimate post.  It remains only to link the two codes and provide them with comments.  I think the program below will help many people to solve the problem of searching through the process memory, well, and learn something new. <br><br><h4>  Search and edit values ‚Äã‚Äãin the program memory </h4><br><br><h5>  Test program </h5><br><br> <code>#include &lt;windows.h&gt; <br> <br> char szText[] = "Hello world.", <br> szTitle[] = "Information"; <br> <br> main() <br> { <br> while(TRUE) <br> MessageBox(NULL, szText, szTitle, MB_ICONINFORMATION); <br> return EXIT_SUCCESS; <br> } <br> /*  ,       */ <br></code> <br><br><h5>  Editor himself </h5><br><br> <code>#include &lt;stdio.h&gt; <br> #include &lt;windows.h&gt; <br> #include &lt;tlhelp32.h&gt; <br> #define PROC_NAME "n00b.exe" <br> #define MAX_READ 128 <br> <br> int fMatchCheck (char *mainstr, int mainstrLen, char *checkstr, int checkstrLen) <br> { <br> /* <br>     . <br>    ""  <br>   . <br> */ <br> BOOL fmcret=TRUE; <br> int x,y; <br> <br> for (x=0; x&lt;mainstrLen; x++) { <br> fmcret=TRUE; <br> <br> for (y=0; y&lt;checkstrLen; y++) { <br> if (checkstr[y]!=mainstr[x+y]) { <br> fmcret=FALSE; <br> break; <br> } <br> } <br> <br> if (fmcret) <br> return x+checkstrLen; <br> } <br> return -1; <br> } <br> <br> char *getMem(char *buff, size_t buffLen, int from, int to) <br> { <br> /* <br>    ,     <br>      . <br> */ <br> size_t ourSize = buffLen*2; <br> char *ret = (char*)malloc(ourSize); <br> <br> memset(ret, 0, ourSize); <br> <br> memcpy(ret, &amp;buff[from], buffLen-from); <br> memset(&amp;ret[to-from], 0, to-from); <br> <br> return ret; <br> } <br> <br> char *delMem(char *buff, size_t buffLen, int from, int to) <br> { <br> /* <br>  . <br> */ <br> size_t ourSize = buffLen*2; <br> char *ret = (char*)malloc(ourSize); <br> int i,x=0; <br> <br> memset(ret, 0, ourSize); <br> <br> for (i=0; i&lt;buffLen; i++) { <br> if (!(i&gt;=from&amp;&amp;i&lt;to)) { <br> ret[x]=buff[i]; <br> x++; <br> } <br> } <br> <br> return ret; <br> } <br> <br> char *addMem(char *buff, size_t buffLen, char *buffToAdd, size_t addLen, int addFrom) <br> { <br> /* <br>   . <br> */ <br> size_t ourSize = (buffLen+addLen)*2; <br> char *ret = (char*)malloc(ourSize); <br> int i,x=0; <br> <br> memset(ret, 0, ourSize); <br> <br> memcpy(ret, getMem(buff, buffLen, 0, addFrom), addFrom); <br> <br> x=0; <br> for (i=addFrom; i&lt;addLen+addFrom; i++) { <br> ret[i]=buffToAdd[x]; <br> x++; <br> } <br> <br> x=0; <br> for (i; i&lt;addFrom+buffLen; i++) { <br> ret[i]=buff[addFrom+x]; <br> x++; <br> } <br> <br> return ret; <br> } <br> <br> char *replaceMem(char *buff, size_t buffLen, int from, int to, char *replaceBuff, size_t replaceLen) <br> { <br> /* <br>   ""  . <br> */ <br> size_t ourSize = (buffLen)*2; <br> char *ret = (char*)malloc(ourSize); <br> <br> memset(ret, 0, ourSize); <br> <br> memcpy(ret, buff, buffLen); // copy 'buff' into 'ret' <br> <br> ret = delMem(ret, buffLen, from, to); // delete all memory from 'ret' betwen 'from' and 'to' <br> ret = addMem(ret, buffLen-to+from, replaceBuff, replaceLen, from); <br> <br> return ret; <br> } <br> <br> DWORD fGetPID( char *szProcessName ) <br> { <br> PROCESSENTRY32 pe = {sizeof(PROCESSENTRY32)}; <br> HANDLE ss; <br> DWORD dwRet = 0; <br> <br> ss = CreateToolhelp32Snapshot (TH32CS_SNAPPROCESS, 0); <br> <br> if (ss) { <br> if (Process32First(ss, &amp;pe)) <br> while (Process32Next(ss, &amp;pe)) { <br> if (!strcmp(pe.szExeFile, szProcessName)) { <br> dwRet = pe.th32ProcessID; <br> break; <br> } <br> } CloseHandle( ss ); <br> } <br> return dwRet; <br> } <br> <br> BOOL DoRtlAdjustPrivilege() <br> { <br> /* <br>  .   . <br>        <br>   . <br> */ <br> #define SE_DEBUG_PRIVILEGE 20L <br> #define AdjustCurrentProcess 0 <br> BOOL bPrev = FALSE; <br> LONG (WINAPI *RtlAdjustPrivilege)(DWORD, BOOL, INT, PBOOL); <br> *(FARPROC *)&amp;RtlAdjustPrivilege = GetProcAddress(GetModuleHandle("ntdll.dll"), "RtlAdjustPrivilege"); <br> if(!RtlAdjustPrivilege) return FALSE; <br> RtlAdjustPrivilege(SE_DEBUG_PRIVILEGE, TRUE, AdjustCurrentProcess, &amp;bPrev); <br> return TRUE; <br> } <br> <br> main() <br> { <br> /*** VARIABLES ***/ <br> HANDLE hProc; <br> <br> MEMORY_BASIC_INFORMATION mbi; <br> SYSTEM_INFO msi; <br> ZeroMemory(&amp;mbi, sizeof(mbi)); <br> GetSystemInfo(&amp;msi); <br> /* <br>       . <br> */ <br> <br> DWORD dwRead=0; <br> <br> char *lpData = (VOID*)GlobalAlloc(GMEM_FIXED, MAX_READ), <br> lpOrig[] = "Information", //   <br> lpReplacement[] = "habrahabr.ru"; //    <br> <br> int x,at; <br> /*****************/ <br> <br> if (!lpData) <br> return -1; <br> <br> ZeroMemory(lpData, MAX_READ); <br> <br> //   <br> do { <br> hProc = OpenProcess (PROCESS_ALL_ACCESS, <br> FALSE, <br> fGetPID(PROC_NAME)); <br> if (!hProc) { <br> Sleep(500); <br> puts ("Cant open process!\n" <br> "Press any key to retry.\n"); <br> getch(); <br> } <br> } while(!hProc); <br> <br> if(DoRtlAdjustPrivilege()){ <br> /* <br>      . <br> */ <br> <br> puts ("Process opened sucessfully\n" <br> "Scanning memory...\n"); <br> <br> for(LPBYTE lpAddress = (LPBYTE)msi.lpMinimumApplicationAddress; <br> lpAddress &lt;= (LPBYTE)msi.lpMaximumApplicationAddress; <br> lpAddress += mbi.RegionSize){ <br> /* <br>       ,      <br>  .   Windows     "". <br>      :  -  , <br> -   .      . <br>             <br>   .    ArtMoney. <br> */ <br> <br> if(VirtualQueryEx(fGetPID(PROC_NAME), lpAddress, &amp;mbi, sizeof(mbi))){ <br> /* <br>     . <br> */ <br> <br> if((mbi.Protect &amp; PAGE_READWRITE) || (mbi.Protect &amp; PAGE_WRITECOPY)){ <br> /* <br>     ,   . <br> */ <br> <br> for (lpAddress; <br> lpAddress&lt;(lpAddress + dwSize); <br> lpAddress+=0x00000100) { <br> /* <br>          ,    <br>  ,      . <br> */ <br> <br> dwRead=0; <br> if (ReadProcessMemory (hProc, <br> (LPCVOID)lpAddress, <br> lpData, <br> MAX_READ, <br> &amp;dwRead) == TRUE) { <br> /* <br>   128        <br>  ,      . <br> */ <br> <br> if (fMatchCheck(lpData, dwRead, lpOrig, sizeof(lpOrig)-1)!=-1) { <br> /*,            .*/ <br> printf ("MEMORY ADDRESS: 0x00%x\n" <br> "DATA:\n", lpAddress); <br> for (x=0;x&lt;dwRead;x++) { <br> printf("%c", lpData[x]); <br> } puts("\n"); <br> <br> at = fMatchCheck (lpData, <br> dwRead, <br> lpOrig, <br> sizeof(lpOrig)-1); <br> <br> if (at!=-1) { <br> at-=sizeof(lpOrig)-1; <br> <br> lpData = replaceMem (lpData, <br> dwRead, <br> at, <br> at+sizeof(lpOrig)-1, <br> lpReplacement, <br> /*sizeof(lpReplacement)-1*/sizeof(lpOrig)-1); <br> <br> puts("REPLACEMENT DATA:"); <br> for (x=0;x&lt;dwRead-sizeof(lpOrig)-1+sizeof(lpReplacement)-1;x++) { <br> printf("%c", lpData[x]); <br> } puts("\n"); <br> <br> puts("Replacing memory..."); <br> if (WriteProcessMemory (hProc, <br> (LPVOID)lpAddress, <br> lpData, <br> /*dwRead-sizeof(lpOrig)-1+sizeof(lpReplacement)-1*/dwRead, <br> &amp;dwRead)) { <br> puts("Success.\n"); <br> } else puts("Error.\n"); <br> } else puts("Error.\n"); <br> <br> } <br> <br> } <br> } <br> <br> }else puts("Error.\n"); <br> }else puts("Error.\n"); <br> } <br> }else puts("Error.\n"); <br> <br> // // // // // <br> // Cleanup <br> if (hProc) <br> CloseHandle(hProc); <br> if (lpData) <br> GlobalFree(lpData); <br> /////////////// <br> <br> puts ("Done. Press any key to quit..."); <br> return getch(); <br> } <br></code> <br><br><h4>  In custody </h4><br><br>  The code is damp, there is a lot of work to do, but this is apparently the only ready-made example of solving a C ++ problem in runet.  I intentionally did not make all the corrections here and cover all the nuances, because  this would greatly inflate the article (and it is not so small as it turned out).  In any case, it will be useful as a framework for writing a memory editor to fit your needs, as well as giving an insight into how to search in memory so that it takes a few seconds, not minutes. <br><br>  Once again I will mention a <a href="http://www.rohitab.com/discuss/index.php%3Fhowtopic%3D29190%26st%3D0%26p%3D10031597%26">topic</a> from which source codes and principles of work are taken. <br><br>  PS Thank you for donnerjack13589 for an <a href="https://habrahabr.ru/users/donnerjack13589/" class="user_link">invite</a> </div><p>Source: <a href="https://habr.com/ru/post/93437/">https://habr.com/ru/post/93437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../93429/index.html">Self-weighting luggage</a></li>
<li><a href="../93430/index.html">Here everything is sewn with white thread.</a></li>
<li><a href="../93431/index.html">... on land and sea, our answer is mighty and stern ...</a></li>
<li><a href="../93435/index.html">Studying at the University of the USA</a></li>
<li><a href="../93436/index.html">Drag and Drop to insert images</a></li>
<li><a href="../93442/index.html">JavaOne comes to St. Petersburg</a></li>
<li><a href="../93443/index.html">USB vampires?</a></li>
<li><a href="../93445/index.html">Once again about the "tax on blanks"</a></li>
<li><a href="../93446/index.html">VS 2010 Extension Manager and the new PowerCommands extension</a></li>
<li><a href="../93448/index.html">We are testing the ERP system. Part 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>