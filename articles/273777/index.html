<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to run your own torrent search engine based on RuTracker?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will try to write as much as possible without "water." A minimum of superfluous distracting information and ranting. Maximum useful information and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to run your own torrent search engine based on RuTracker?</h1><div class="post__text post__text-html js-mediator-article">  I will try to write as much as possible without "water."  A minimum of superfluous distracting information and ranting.  Maximum useful information and working code.  I will not raise the question of why someone own torrent search engine based on RuTracker.  And I do not consider myself a programming guru.  We will just make this site together.  We will use Apache + PHP, MySQL and Sphinx.  Immediately I will warn you that the site will not work very quickly on a minimal virtual hosting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6b/543/f6b/e6b543f6bf0b4e2a6e3dd02970111675.png" alt="image"><br><a name="habracut"></a><br><h4>  Database </h4><br>  First we need to take the base itself.  RuTracker every month lays out a dump of its torrents <a href="http://rutracker.org/forum/viewtopic.php%3Ft%3D4824458">here</a> .  Download, unpack and see two dozen CSV files. <br><br><img src="http://i.imgur.com/7DB32KP.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We need only those in which there is information about the torrents - the rest are deleted.  In the file ‚Äúcategory_info.csv‚Äù - a hint for those who do not want to open each file (delete: ‚Äúcategory_1.csv‚Äù, ‚Äúcategory_4.csv‚Äù, ‚Äúcategory_36.csv‚Äù).  Open any of the remaining files and see such a structure (I immediately replaced the ‚Äú;‚Äù symbol with a new line, which would be visually more convenient): <br><table><tbody><tr><td>  "1568" </td><td>  Section ID on RuTracker </td></tr><tr><td>  "Cooking" </td><td>  Section name </td></tr><tr><td>  "63629" </td><td>  Theme ID on RuTracker </td></tr><tr><td>  "F7D7BE97A818CCDFA072C42348EB669F7883888D" </td><td>  Hash torrent </td></tr><tr><td>  "(Cooking) Tasty Stories 1" </td><td>  The name of the torrent </td></tr><tr><td>  "729927066" </td><td>  Size of distribution in bytes </td></tr><tr><td>  "2006-08-21 10:00:22" </td><td>  Date of distribution </td></tr></tbody></table><br>  Now we will add all the information to the database.  We use MySQL, as the most common database.  I got this table (note: the ‚Äúhash‚Äù column is unique, all text data is in utf8 encoding): <br><br><div class="spoiler">  <b class="spoiler_title">SQL table</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`torrents`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_bin <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`hash`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_bin <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`size`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`topic_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`cat_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`cat_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_bin <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf32 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span>=utf32_bin; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`torrents`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`hash`</span></span> (<span class="hljs-string"><span class="hljs-string">`hash`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`torrents`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT;</code> </pre> <br></div></div><br>  Then we upload all the CSV files into one folder (for example, let's call it ‚Äúdb‚Äù) on the server.  Adding information about torrents in the database is accomplished using a simple script presented below.  It also needs to be downloaded to the same folder where the source CSV files are located. <br><br><div class="spoiler">  <b class="spoiler_title">File insert_to_db.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-comment"><span class="hljs-comment">//    3-  set_time_limit(180); //  MySQL,     mysql_connect("localhost", "torrent", "password") or die("Could not connect to MySQL"); // ,     mysql_select_db("torrent") or die("Could not select database"); //       utf8 mysql_query("SET NAMES utf8"); //    url  "f" $fp = fopen($_GET[f], "r"); //       while (!feof($fp)) { //  (,  trim()   ,      "") $tmp = trim(fgets($fp)); //   .    ";" $torrent = explode('";"', $tmp); //        " $torrent[0] = substr($torrent[0], 1); $torrent[6] = substr($torrent[6], 0, (strlen($torrent[6]) - 1)); //   ,          //print '&lt;pre&gt;'; print_r($torrent); exit(); //      mysql_query("INSERT INTO `torrents` (`name`, `hash`, `date`, `size`, `topic_id`, `cat_id`, `cat_name`) VALUES ('" . mysql_real_escape_string($torrent[4]) . "', '" . $torrent[3] . "', '" . $torrent[6] . "', '" . $torrent[5] . "', '" . $torrent[2] . "', '" . $torrent[0] . "', '" . mysql_real_escape_string($torrent[1]) . "') "); } //  fclose($fp); //     print 'complete: ' . $_GET[f]; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br></div></div><br>  Open the browser, open the url "http://site.ru/db/insert_to_db.php?f=category_10.csv".  We do the same with every CSV file.  Yes, all this could be automated, but I specifically wrote so that everything would be as clear as possible.  After these actions, a little more than 1.6 million records appeared in our table.  Not a small base like this.  MySQL search with this amount of data will not cope, so we will entrust this task to Sphinx. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6c/c79/7f9/b6cc797f91eba43f5dfd044233dc3fdc.png" alt="image"><br><br><h4>  Sphinx </h4><br>  Sphinx is installed on different systems in different ways.  It all depends on the operating system and hardware.  This topic deserves a separate article.  But there are so many great manuals on the Internet.  In Russian too.  Now we will set up the configuration file for Sphinx.  Create in the root directory of the site directory, for example, cache.  All Sphinx index files for our site will be stored here.  We load the configuration file into this folder (listing below). <br><br><div class="spoiler">  <b class="spoiler_title">Torrents.conf file</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#      source torrentz { #    <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = mysql sql_host = localhost sql_user = torrent sql_pass = <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> sql_db = torrent sql_port = <span class="hljs-number"><span class="hljs-number">3306</span></span> #        utf8 sql_query_pre = <span class="hljs-keyword"><span class="hljs-keyword">SET NAMES</span></span> utf8 sql_query_pre = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-type"><span class="hljs-type">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 #     sql_query = <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> id, <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> torrents #  ( )     .       sql_ranged_throttle = <span class="hljs-number"><span class="hljs-number">0</span></span> } #  .       Sphinx <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> torrentz { #   source = torrentz #     <span class="hljs-type"><span class="hljs-type">path</span></span> = /home/rutr/rutracker.online/www/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/ #    docinfo = extern #      morphology = stem_enru #     min_word_len = <span class="hljs-number"><span class="hljs-number">2</span></span> #   charset_type = utf<span class="hljs-number"><span class="hljs-number">-8</span></span> #  charset_table = <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-number"><span class="hljs-number">.9</span></span>, A..Z-&gt;a..z, _, a..z, U+<span class="hljs-number"><span class="hljs-number">410.</span></span>.U+<span class="hljs-number"><span class="hljs-number">42</span></span>F-&gt;U+<span class="hljs-number"><span class="hljs-number">430.</span></span>.U+<span class="hljs-number"><span class="hljs-number">44</span></span>F, U+<span class="hljs-number"><span class="hljs-number">430.</span></span>.U+<span class="hljs-number"><span class="hljs-number">44</span></span>F #    min_infix_len = <span class="hljs-number"><span class="hljs-number">2</span></span> #    "*" enable_star = <span class="hljs-number"><span class="hljs-number">1</span></span> } #   indexer { #     mem_limit = <span class="hljs-number"><span class="hljs-number">32</span></span>M } #    searchd { #           <span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> = <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">3312</span></span> #  <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> = /home/rutr/rutracker.online/www/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/searchd.log #   query_log = /home/rutr/rutracker.online/www/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/query.log #      read_timeout = <span class="hljs-number"><span class="hljs-number">5</span></span> #  -    max_children = <span class="hljs-number"><span class="hljs-number">30</span></span> #   pid- pid_file = /home/rutr/rutracker.online/www/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/searchd.pid #  -   max_matches = <span class="hljs-number"><span class="hljs-number">1000</span></span> }</code> </pre><br></div></div><br>  Connect to the server via ssh.  In order for Sphinx to be able to search our database, you need to prepare an index.  Execute the command: <br><br><pre> <code class="bash hljs">indexer --config /home/rutr/rutracker.online/www/cache/torrents.conf ‚Äìall</code> </pre><br>  Sphinx will spend some time indexing the database.  Duration depends on server capacity.  In my case, the indexing took about 10 minutes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20e/e6d/2c3/20ee6d2c37c07bd56ee946515400abfb.png" alt="image"><br><br>  After the end of the indexing, check whether everything is ok.  To do this, perform a search through the console using the command (the search phrase is written after specifying the config file): <br><br><pre> <code class="bash hljs">search --config /home/rutr/rutracker.online/www/cache/torrents.conf morrowind mod</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/080/7fb/da5/0807fbda54be03f28e17044bbe503c0f.png" alt="image"><br><br>  If you saw something similar to the upper screenshot, then the indexing was successful.  If nothing is found, then you do not need to run the following command.  To launch the Sphinx search daemon, execute the following command: <br><br><pre> <code class="bash hljs">searchd --config /home/rutr/rutracker.online/www/cache/torrents.conf</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/d12/c70/443/d12c70443164141890b393944c20b795.png" alt="image"><br><br>  Please note that the daemon needs to be run after each reboot.  To disable the daemon (if needed), add "--stop" at the end of the above command. <br><br><h4>  Web </h4><br>  I did not think for a long time what framework to use for the web interface.  The requirements are simple: ease of use, responsive design and support for all modern browsers.  Under this is great, albeit a bit bored, Bootstrap.  It is not necessary to download the distribution kit, you can connect the style file online.  The main page is in pure HTML, without using PHP.  Comments to the code, I think, will be superfluous. <br><br><div class="spoiler">  <b class="spoiler_title">File index.php</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=edge"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/favicon.ico"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  RuTracker<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">integrity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">crossorigin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"anonymous"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.inCenter</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: auto; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">bottom</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">right</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; } </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.inCenter</span></span></span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.isResp</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">min-width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">400px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">max-width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">800px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inCenter isResp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col-sm-12 col-md-10 col-md-offset-1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"GET"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group text-center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>  RuTracker<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group input-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control input-lg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-group-btn"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary input-lg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"glyphicon glyphicon-search"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  The design of the main page was very minimal and very functional. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5bd/f98/b7e/5bdf98b7e6dcc9177f716c40d29dbbbd.png" alt="image"><br><br>  The search script will be more interesting.  First we need the Sphinx API for PHP.  The latest version can be found <a href="https://code.google.com/p/sphinxsearch/source/browse/trunk/api/sphinxapi.php">here</a> .  Briefly describe how the search script works, and more details in the listing.  We connect the file to work with the API, we set up the search, we search, we post the search results in a convenient way.  Download torrent can be directly from the search, without additional clicks. <br><br><div class="spoiler">  <b class="spoiler_title">File search.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-comment"><span class="hljs-comment">//    $q=trim(urldecode($_GET[q])); //    ,       if (empty($q)) {header("Location: /"); exit();} //  , ... //  MySQL,     mysql_connect("localhost", "torrent", "password") or die("Could not connect to MySQL"); // ,     mysql_select_db("torrent") or die("Could not select database"); //       utf8 mysql_query("SET NAMES utf8"); // API Sphinx include("sphinxapi.php"); //  Sphinx $sphinx=new SphinxClient(); //  Sphinx-.      "torrents.conf" $sphinx-&gt;SetServer('localhost', 3312); //     $sphinx-&gt;SetMatchMode(SPH_MATCH_ANY); //    $sphinx-&gt;SetSortMode(SPH_SORT_RELEVANCE); // 50    . $sphinx-&gt;SetLimits(0, 50); //  (* -      "torrents.conf",     : torrentz) $torrents=$sphinx-&gt;Query($q, '*'); //    ,         //print $sphinx-&gt;getLastError(); //print '&lt;br&gt;&lt;pre&gt;'; print_r($torrents); exit(); //    ,   .   .       -  . function bytesToSize($bytes, $precision = 0) { $kilobyte = 1024; $megabyte = $kilobyte * 1024; $gigabyte = $megabyte * 1024; $terabyte = $gigabyte * 1024; if (($bytes &gt;= 0) &amp;&amp; ($bytes &lt; $kilobyte)) {return $bytes . ' B';} elseif (($bytes &gt;= $kilobyte) &amp;&amp; ($bytes &lt; $megabyte)) {return round($bytes / $kilobyte, $precision) . ' Kb';} elseif (($bytes &gt;= $megabyte) &amp;&amp; ($bytes &lt; $gigabyte)) {return round($bytes / $megabyte, $precision) . ' Mb';} elseif (($bytes &gt;= $gigabyte) &amp;&amp; ($bytes &lt; $terabyte)) {return round($bytes / $gigabyte, $precision) . ' Gb';} elseif ($bytes &gt;= $terabyte) {return round($bytes / $terabyte, $precision) . ' Tb';} else {return $bytes . ' B';} } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;link rel="icon" href="/favicon.ico"&gt; &lt;title&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($q)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/title&gt; &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"&gt; &lt;style type="text/css"&gt; body { padding-top: 80px; padding-bottom: 20px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;nav class="navbar navbar-default navbar-fixed-top"&gt; &lt;div class="container"&gt; &lt;div class="navbar-header"&gt; &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"&gt; &lt;span class="sr-only"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;/button&gt; &lt;a class="navbar-brand" href="/"&gt;  RuTracker&lt;/a&gt; &lt;/div&gt; &lt;div id="navbar" class="navbar-collapse collapse"&gt; &lt;form action="/search.php" method="GET" class="navbar-form navbar-left"&gt; &lt;div class="form-group input-group"&gt; &lt;input type="text" placeholder="" value="</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($q)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">" class="form-control" name="q"&gt; &lt;span class="input-group-btn"&gt; &lt;button class="btn btn-primary" type="submit"&gt;&lt;i class="glyphicon glyphicon-search"&gt;&lt;/i&gt;&lt;/button&gt; &lt;/span&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;!--/.navbar-collapse --&gt; &lt;/div&gt; &lt;/nav&gt; &lt;div class="container"&gt; &lt;h1&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($q)</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/h1&gt; &lt;table class="table table-striped"&gt; &lt;caption&gt; : </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrents[total_found]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/caption&gt; &lt;tbody&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment"> //         $ids = array_keys($torrents[matches]); //   id-     SQL  $ids = implode(',', $ids); // SQL        $sql="SELECT `id`, `name`, `hash`, `date`, `size` FROM `torrents` WHERE `id` IN (".$ids.") ORDER BY FIELD(`id`, ".$ids.")"; // SQL  $r=mysql_query($sql); //   for ($i=0; $i &lt; mysql_num_rows($r); $i++) { //      $f=mysql_fetch_array($r); //     $torrent_date=explode('-', $f[date]); //   ,      $torrent_date=$torrent_date[2].'.'.$torrent_date[1].'.'.$torrent_date[0]; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;tr&gt; &lt;td width="75%"&gt;&lt;a href="/torrent.php?id=</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$f[id]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$f[name]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/a&gt;&lt;/td&gt; &lt;td width="5%"&gt;&lt;a href="magnet:?xt=urn:btih:</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$f[hash]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;&lt;i class="glyphicon glyphicon-magnet"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/td&gt; &lt;td width="10%"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=bytesToSize($f[size])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;td width="10%"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent_date</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment"> } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;!-- /.container --&gt; &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt; &lt;script src="http://getbootstrap.com/dist/js/bootstrap.min.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</span></span></code> </pre><br></div></div><br>  For the convenience of users, we will make a separate page for each torrent.  Suddenly someone will need to send a link. <br><br><div class="spoiler">  <b class="spoiler_title">File torrent.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-comment"><span class="hljs-comment">//   id  $id=trim(urldecode($_GET[id])); //  id,       if (empty($id)) {header("Location: /"); exit();} // id , ... //  MySQL,     mysql_connect("localhost", "torrent", "password") or die("Could not connect to MySQL"); // ,     mysql_select_db("torrent") or die("Could not select database"); //       utf8 mysql_query("SET NAMES utf8"); // SQL      id $sql="SELECT * FROM `torrents` WHERE `id`='".mysql_real_escape_string($id)."'"; // SQL  $r=mysql_query($sql); //   id  ,       if (mysql_num_rows($r)==0) {header("Location: /"); exit();} //     $torrent=mysql_fetch_array($r); //     $torrent_date=explode('-', $torrent[date]); $torrent_date=$torrent_date[2].'.'.$torrent_date[1].'.'.$torrent_date[0]; //    ,   .   .       -  . function bytesToSize($bytes, $precision = 0) { $kilobyte = 1024; $megabyte = $kilobyte * 1024; $gigabyte = $megabyte * 1024; $terabyte = $gigabyte * 1024; if (($bytes &gt;= 0) &amp;&amp; ($bytes &lt; $kilobyte)) {return $bytes . ' B';} elseif (($bytes &gt;= $kilobyte) &amp;&amp; ($bytes &lt; $megabyte)) {return round($bytes / $kilobyte, $precision) . ' Kb';} elseif (($bytes &gt;= $megabyte) &amp;&amp; ($bytes &lt; $gigabyte)) {return round($bytes / $megabyte, $precision) . ' Mb';} elseif (($bytes &gt;= $gigabyte) &amp;&amp; ($bytes &lt; $terabyte)) {return round($bytes / $gigabyte, $precision) . ' Gb';} elseif ($bytes &gt;= $terabyte) {return round($bytes / $terabyte, $precision) . ' Tb';} else {return $bytes . ' B';} } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;link rel="icon" href="/favicon.ico"&gt; &lt;title&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($torrent[name])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/title&gt; &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"&gt; &lt;style type="text/css"&gt; body { padding-top: 80px; padding-bottom: 20px; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;nav class="navbar navbar-default navbar-fixed-top"&gt; &lt;div class="container"&gt; &lt;div class="navbar-header"&gt; &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"&gt; &lt;span class="sr-only"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;span class="icon-bar"&gt;&lt;/span&gt; &lt;/button&gt; &lt;a class="navbar-brand" href="/"&gt;  RuTracker&lt;/a&gt; &lt;/div&gt; &lt;div id="navbar" class="navbar-collapse collapse"&gt; &lt;form action="/search.php" method="GET" class="navbar-form navbar-left"&gt; &lt;div class="form-group input-group"&gt; &lt;input type="text" placeholder="" value="" class="form-control" name="q"&gt; &lt;span class="input-group-btn"&gt; &lt;button class="btn btn-primary" type="submit"&gt;&lt;i class="glyphicon glyphicon-search"&gt;&lt;/i&gt;&lt;/button&gt; &lt;/span&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;!--/.navbar-collapse --&gt; &lt;/div&gt; &lt;/nav&gt; &lt;div class="container"&gt; &lt;h1&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($torrent[name])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/h1&gt; &lt;table class="table table-striped"&gt; &lt;tbody&gt; &lt;tr&gt; &lt;th width="20%"&gt;:&lt;/th&gt; &lt;td&gt;&lt;a href="magnet:?xt=urn:btih:</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent[hash]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;&lt;i class="glyphicon glyphicon-magnet"&gt;&lt;/i&gt; Magnet&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th width="20%"&gt;:&lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=bytesToSize($torrent[size])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th width="20%"&gt; :&lt;/th&gt; &lt;td&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent_date</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th width="20%"&gt;:&lt;/th&gt; &lt;td&gt;&lt;a target=_blank href="http://rutracker.org/forum/viewforum.php?f=</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent[cat_id]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt;</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=htmlspecialchars($torrent[cat_name])</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th width="20%"&gt;:&lt;/th&gt; &lt;td&gt;&lt;a target=_blank href="http://rutracker.org/forum/viewtopic.php?t=</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent[topic_id]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt; #</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?</span></span></span><span class="hljs-comment">=$torrent[topic_id]</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;/div&gt; &lt;!-- /.container --&gt; &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt; &lt;script src="http://getbootstrap.com/dist/js/bootstrap.min.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</span></span></code> </pre><br></div></div><br>  That's all.  We got a fully working site with a database from RuTracker, with a quick search and user-friendly interface.  I deliberately did not add search filtering by categories, sorting, pagination, etc., so that the code would be as clean as possible.  If there is interest, I will tell all about it in the comments or in a separate article. <br><br>  Thank you all for your attention.  Write questions, I will answer all. </div><p>Source: <a href="https://habr.com/ru/post/273777/">https://habr.com/ru/post/273777/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273759/index.html">Budget homemade TCP "on the knees" (mobile television station). Part 1</a></li>
<li><a href="../273765/index.html">As I wrote and published a book based on my posts with Habr</a></li>
<li><a href="../273771/index.html">Parallel calculations on CPU and GPU</a></li>
<li><a href="../273773/index.html">3D-lab for people from MIEM, sling their heads inside the prototype trace of printed circuit boards</a></li>
<li><a href="../273775/index.html">The design decision is made by the designer.</a></li>
<li><a href="../273779/index.html">CLI for MarionetteJS</a></li>
<li><a href="../273783/index.html">Non-standard city for non-standard people: a guide to the architecture of Innopolis</a></li>
<li><a href="../273785/index.html">RHCSA certification: preparation and delivery experience</a></li>
<li><a href="../273791/index.html">Embedded Hyper-V Virtualization - First Step</a></li>
<li><a href="../273793/index.html">SID change during cloning and mass deployment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>