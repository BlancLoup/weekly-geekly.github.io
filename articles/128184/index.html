<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ridiculous nonsense</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that in my free time, I began to write programs. The right (maybe) programs, programs that I liked (and liked) to write - programs that...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ridiculous nonsense</h1><div class="post__text post__text-html js-mediator-article">  It so happened that in my free time, I began to write programs.  The right (maybe) programs, programs that I liked (and liked) to write - programs that I like to use.  So far there are two of them.  In principle, these are quite large programs (more than 2 MB of source code each).  When creating them, it was possible to stumble upon ‚Äúincomprehensible oddities‚Äù rather ‚Äúincorrect‚Äù, at first glance, the behavior of the compiler / program and the operating system.  After debriefing, once again made sure that I am SZZB (to myself angry <a href="http://www.youtube.com/watch%3Fv%3DC_QZ0bYoirY">buratinko</a> ).  In any case - a couple of examples, how I buggy and how not to do it (everything under Win32 - Intel86). <br><br><a name="habracut"></a><br><br>  <b>Example one</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://www.os-lab.ru/osa.htm">Wasp</a> (the name is what)).  A program that intercepts calls to functions of third-party processes to dlkam, and allows you to change the input / output parameters of these intercepted functions.  The spoof functions themselves are executed on the stack machine - there is no problem with them.  But in order to transfer control to them, you need to initialize the stack machine.  To do this, you need a bit of memory where the jump will jump either from the beginning of the intercepted function (of course, if it is successfully disassembled), or from the import tables of other PE files (ekzeshki and dll) loaded into the process memory.  Memory can be taken in three places: <br><br>  ‚Ä¢ Find a place in the sections of the downloaded file - in general, it is impossible. <br>  ‚Ä¢ In the stack - perhaps, but troublesome. <br>  ‚Ä¢ Heap - and chose it. <br><br>  The wasp loaded Dll into the memory of a third-party process, it allocated memory for the bytecode and filled it, allocated memory for pure x86 code that prepares the stack machine and calls it.  And everything worked.  Everywhere.  Almost everywhere).  It was on whist that two instances of the running Far manager with an interval of less than 3 seconds, with intercepted file access functions, died.  Processes said that they performed an illegal operation and will be closed.  Having sat for an hour for the debugger, I realized the simplest truth - the memory allocated to the process from the heap may not be executable.  For some reason, this had never occurred before (heh why).  Sometimes, in certain situations, certain versions of Windows, when allocating memory with the new operator, can do what they have the right to give memory with a non-executable attribute (read-only write).  Next, using the WinApi function, you must assign this attribute (if I‚Äôm not mistaken to the page or pages) to the execution attribute, if you want to execute the machine code directly in this memory. <br><br>  <b>Example two</b> <br><br>  Visual C ++ vs <a href="http://www.os-lab.ru/protector.htm">OSProtector</a> <br><br>  Protectors, they are trying to protect the program from evil hackers).  And they also need memory, memory in the executable file.  They take the memory either by increasing the size of the last section, or by adding new ones, or replacing the old ones altogether (as a rule, with the packaging of the sections).  In any case, the protectors change the section table (located at the beginning of the file).  Currently, Visual C ++ in the start code of compiled applications checks the integrity of the partition table.  If it has changed, then the <b>Runtime error R6002 floating point is not loaded</b> when the application starts.  When trying to protect the same Far manager (v 1.7) protector, everything was fine.  When trying to protect the Far manager (v 2.0) with a protector, everything was not good - obviously it was compiled with a newer version of the compiler.  Google found: <a href="http://www.manhunter.ru/underground/65_runtime_error_r6002_floating_point_not_loaded.html">www.manhunter.ru/underground/65_runtime_error_r6002_floating_point_not_loaded.html</a> <br><br>  Anyway, OSProtector, before transferring control to the start code, now restores the original attributes of sections of the protected file. </div><p>Source: <a href="https://habr.com/ru/post/128184/">https://habr.com/ru/post/128184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128171/index.html">The threat on behalf of the FBI can be placed on any site.</a></li>
<li><a href="../128172/index.html">Little known MST. Multi-region implementation considerations</a></li>
<li><a href="../128175/index.html">XPath: speeding up NodeList iteration</a></li>
<li><a href="../128182/index.html">Docblox - some innovations</a></li>
<li><a href="../128183/index.html">"RosYama" opened the source code of the site under a free license</a></li>
<li><a href="../128186/index.html">What does Junior need to get settled?</a></li>
<li><a href="../128188/index.html">From the Windows Phone Marketplace removed "antivirus", collecting personal data</a></li>
<li><a href="../128189/index.html">Implementing code in Silverlight</a></li>
<li><a href="../128191/index.html">How to write quine</a></li>
<li><a href="../128192/index.html">Free book "Best of Smashing Magazine"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>