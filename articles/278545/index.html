<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Complex hardware nodes, simultaneous parallel execution and kernel / system runtime</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Luxoft Training offers to get acquainted with the translation of another article by Randolph Gaist ‚Äú Big Nodes, Concurrent Parallel Execution And High...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Complex hardware nodes, simultaneous parallel execution and kernel / system runtime</h1><div class="post__text post__text-html js-mediator-article">  Luxoft Training offers to get acquainted with the translation of another article by Randolph Gaist ‚Äú <a href="http://oracle-randolf.blogspot.ru/2016/02/big-nodes-concurrent-parallel-execution.html">Big Nodes, Concurrent Parallel Execution And High System / Kernel Time</a> ‚Äù. <br><br><img align="left" width="90" src="https://habrastorage.org/files/b9a/9f8/846/b9a9f88464a54652ab15dfced6a8471b.jpg">  Randolph Geist specializes in correcting errors related to the performance of Oracle databases.  One of the best specialists in the world in the area of ‚Äã‚Äãanalyzing the performance of SQL-code and Oracle optimization technologies.  Is an Oracle Certified Database Administrator (OCP DBA) versions 8i, 9i and 10g. <br><a name="habracut"></a><br><br>  The following applies only to customers running Oracle on large servers with a large number of cores <b>in single-instance mode</b> (this particular problem is not reproduced in the RAC environment; see below for an explanation of why). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      These customers include one of my clients, which uses Exadata Xn-8 servers, for example, X4-8 with 120 cores / 240 processors per node (but also reproduced on older and smaller models with 64 cores / 128 processors per node ). <br><br>  Recently, the base application decided to rewrite.  A part of this code performed the same operations for different data sets, in many cases simultaneously.  This led to the fact that multiple sessions used parallel query execution.  Many queries in this code did not in the best way use parallel execution: queries with a very short duration used parallel execution, leading to several parallel execution starts per second.  Such a picture can be seen in the AWR report, which shows that, on average, several parallel execution trees were run every second of an hour: <br><img src="https://habrastorage.org/files/c8b/3b3/4a2/c8b3b34a237e481a9a5f3d776ea8ff33.png"><br><br>  When the new code was tested on the data and load received from the production system, at first the profile of the processor of such a large node (operating in single-instance mode) looked like this.  At the same time, the computer was not loaded by other processes. <br><br><img src="https://habrastorage.org/files/f30/1d1/0f6/f301d10f6c234e0cbec4f7183dd063c2.png"><br><br>  As can be seen in Fig., The node's processor is fully loaded, and most of the time is in kernel / system mode.  AWR reports showed a significant number of atypical PX wait events: <br><br><img src="https://habrastorage.org/files/cf9/cd7/54a/cf9cd754a8de4cd5a0f431db4f518064.png"><br><br>  The ‚ÄúPX Deq: Slave Session Stats‚Äù event should not take a lot of time, since we are talking about the transfer of session statistics of slave nodes to the PX coordinator at the time of their completion.  Obviously, something significantly slowed down this PX interaction (and this could only be noticed if there was excessive use of parallel execution). <br><br>  In addition, some of the more complex queries with parallel execution that perform a large number of associations and lead to a significant amount of redistribution of data, occurred as in slow motion.  Although almost 100% of the execution time was on the CPU, in Active Session History it can be seen that almost 90% of the time is related to the redistribution operation: <br><br><pre><code class="hljs ruby">SQL statement execution ASH Summary ----------------------------------------------- <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>PX SEND/RECEIVE<span class="hljs-params"><span class="hljs-params">|PX SEND/RECEIVE|</span></span> PERCENTAGE_CPU<span class="hljs-params"><span class="hljs-params">| PERCENT|</span></span> CPU PERCENT<span class="hljs-params"><span class="hljs-params">| --------------|</span></span>---------------<span class="hljs-params"><span class="hljs-params">|---------------|</span></span> <span class="hljs-number"><span class="hljs-number">98</span></span><span class="hljs-params"><span class="hljs-params">| 86|</span></span> <span class="hljs-number"><span class="hljs-number">87</span></span><span class="hljs-params"><span class="hljs-params">|</span></span></code> </pre> <br><br>  Running the same query with the same execution plan and the same data on the same machine during its idle time showed almost 20 times higher performance, and the redistribution took less than 40% of the time: <br><br><pre> <code class="hljs ruby">SQL statement execution ASH Summary ----------------------------------------------- <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>PX SEND/RECEIVE<span class="hljs-params"><span class="hljs-params">|PX SEND/RECEIVE|</span></span> PERCENTAGE_CPU<span class="hljs-params"><span class="hljs-params">| PERCENT|</span></span> CPU PERCENT<span class="hljs-params"><span class="hljs-params">| --------------|</span></span>---------------<span class="hljs-params"><span class="hljs-params">|---------------|</span></span> <span class="hljs-number"><span class="hljs-number">96</span></span><span class="hljs-params"><span class="hljs-params">| 38|</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span><span class="hljs-params"><span class="hljs-params">|</span></span></code> </pre><br><br>  Apparently, these requests entered into some kind of competition, which does not occur in Oracle, but outside (at the operating system level), and manifested as the expenditure of CPU time in kernel mode.  Similar was observed in previous versions of Oracle when spinning mutexes. <br><br>  The reduction in overuse of parallel execution caused a significant reduction in CPU time.  But still a large amount of CPU time in kernel / system mode was not clear. <br><br><img src="https://habrastorage.org/files/3db/b01/023/3dbb010231154ed08880abc2dddfa3f4.png"><br><br>  So, the main question: what exactly did this time spend in the core of the operating system?  The answer to it could help find additional clues. <br><br><h2>  Analysis </h2><br><br>  Starting "perf top" on the site during this launch produced the following profile: <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">PerfTop:</span></span> <span class="hljs-number"><span class="hljs-number">129074</span></span> irqs/sec <span class="hljs-symbol"><span class="hljs-symbol">kernel:</span></span><span class="hljs-number"><span class="hljs-number">76.4</span></span>% <span class="hljs-symbol"><span class="hljs-symbol">exact:</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>% [<span class="hljs-number"><span class="hljs-number">1000</span></span>Hz cycles], (all, <span class="hljs-number"><span class="hljs-number">128</span></span> CPUs) ------------------------------------------------------------------------------------------------------------------- samples pcnt function DSO ______<span class="hljs-number"><span class="hljs-number">_</span></span> ____<span class="hljs-number"><span class="hljs-number">_</span></span> _______________________<span class="hljs-number"><span class="hljs-number">_</span></span> __________________________________________________________<span class="hljs-number"><span class="hljs-number">_</span></span> <span class="hljs-number"><span class="hljs-number">1889395.00</span></span> <span class="hljs-number"><span class="hljs-number">67.8</span></span>% __ticket_spin_lock /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">27746.00</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span>% ktime_get /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">24622.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>% weighted_cpuload /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">23169.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>% find_busiest_group /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">17243.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>% pfrfd1_init_locals /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">16961.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>% sxorchk /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">15434.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>% kafger /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">11531.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>% try_atomic_semop /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">11006.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>% __intel_new_memcpy /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">10557.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>% kaf_typed_stuff /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">10380.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>% idle_cpu /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">9977.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>% kxfqfprFastPackRow /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">9070.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% pfrinstr_INHFA1 /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">8905.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% kcbgtcr /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">8757.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% ktime_get_update_offsets /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">8641.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% kgxSharedExamine /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">7487.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% update_queue /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">7233.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>% kxhrPack /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">6809.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% rworofprFastUnpackRow /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">6581.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% ksliwat /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">6242.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kdiss_fetch /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">6126.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% audit_filter_syscall /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">5860.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% cpumask_next_and /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">5618.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kaf4reasrp1km /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">5482.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kaf4reasrp0km /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">5314.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kopp2upic /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">5129.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% find_next_bit /usr/lib/debug/lib/modules/<span class="hljs-number"><span class="hljs-number">2.6</span></span>.<span class="hljs-number"><span class="hljs-number">39</span></span>-<span class="hljs-number"><span class="hljs-number">400.128</span></span>.<span class="hljs-number"><span class="hljs-number">17</span></span>.el5uek/vmlinux <span class="hljs-number"><span class="hljs-number">4991.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kdstf01001000000km /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">4842.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% ktrgcm /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">4762.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% evadcd /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle <span class="hljs-number"><span class="hljs-number">4580.00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>% kdiss_mf_sc /data/oracle/XXXXXXX/product/<span class="hljs-number"><span class="hljs-number">11.2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>/bin/oracle  ¬´perf¬ª          : <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">36</span></span>% ora_xxxx [kernel.kallsyms] [k] __ticket_spin_lock <span class="hljs-params"><span class="hljs-params">| --- __ticket_spin_lock |</span></span> <span class="hljs-params"><span class="hljs-params">|--99.98%-- _raw_spin_lock |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|--100.00%-- ipc_lock |</span></span> <span class="hljs-params"><span class="hljs-params">| ipc_lock_check |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">|--99.83%-- semctl_main |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> sys_semctl <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| system_call |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> __semctl <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| --100.00%-- skgpwpost |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kslpsprns <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| kskpthr |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> ksl_post_proc <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| kxfprienq |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kxfpqrenq <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span>--<span class="hljs-number"><span class="hljs-number">98.41</span></span><span class="hljs-string"><span class="hljs-string">%--</span></span> kxfqeqb <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kxfqfprFastPackRow <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kxfqenq <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qertqoRop <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kdstf01001010000100km <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kdsttgr <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qertbFetch <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qergiFetch <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> rwsfcd <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qertqoFetch <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qerpxSlaveFetch <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> qerpxFetch <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> opiexe <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> kpoal8</code> </pre><br><br>  Running ‚Äústrace‚Äù on these parallel slaves issued the following: <br><pre> <code class="hljs perl">. . . <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">397</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">388</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">347</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">394</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">393</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">392</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">383</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">406</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">389</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">380</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">395</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">386</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">385</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">384</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">375</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">398</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">381</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">372</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">387</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">378</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">377</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">376</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">367</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">390</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">373</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">332</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">379</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">346</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">369</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">368</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semctl</span></span>(<span class="hljs-number"><span class="hljs-number">1347842</span></span>, <span class="hljs-number"><span class="hljs-number">359</span></span>, SETVAL, <span class="hljs-number"><span class="hljs-number">0x1</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> . . .</code> </pre><br>  <b>Conclusion: a</b> lot of CPU time is spent on ‚Äúspinning‚Äù spin-locks (a critical section of the code), caused by calls in parallel execution to ‚Äúsemctl‚Äù (semaphores).  ‚ÄúStrace‚Äù indicates that all calls to ‚Äúsemctl‚Äù use the same semaphore set (first parameter), which explains the match for this particular set of semaphores (blocking area is a set of semaphores, not a semaphore). <br><br><h2>  Decision </h2><br>  Based on the results of ‚Äúperf‚Äù, an Oracle engineer found a suitable, but unfortunately unpublished and closed 2013 error in version 12.1.0.2.  For her, there are three different ways to solve the problem: <br><br>  1. <b>Starting from ‚Äúcluster_database‚Äù = true:</b> at the same time, Oracle will perform queries differently, which will reduce the number of semaphore calls by two orders of magnitude.  We tested this approach, and it showed an immediate load on the core operating time ‚Äî this is the explanation of why this particular problem is not reproduced in the RAC environment. <br><br>  2. <b>Run with different settings of ‚Äúkernel.sem‚Äù:</b> Exadata machines came with the following predefined semaphore configuration: <br><br><pre> <code class="hljs">kernel.sem = 2048 262144 256 256</code> </pre> <br><br>  "Ipcs" showed the following semaphore arrays with this configuration when running an instance of Oracle: <br><br><pre> <code class="hljs go">------ Semaphore Arrays -------- key semid owner perms nsems . . . <span class="hljs-number"><span class="hljs-number">0xd87a8934</span></span> <span class="hljs-number"><span class="hljs-number">12941057</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">1502</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8935</span></span> <span class="hljs-number"><span class="hljs-number">12973826</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">1502</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8936</span></span> <span class="hljs-number"><span class="hljs-number">12006595</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">1502</span></span>          , , : kernel.sem = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">262144</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-number"><span class="hljs-number">4096</span></span>     ¬´ipcs¬ª: ------ Semaphore Arrays -------- key semid owner perms nsems . . . <span class="hljs-number"><span class="hljs-number">0xd87a8934</span></span> <span class="hljs-number"><span class="hljs-number">13137665</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8935</span></span> <span class="hljs-number"><span class="hljs-number">13170434</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8936</span></span> <span class="hljs-number"><span class="hljs-number">13203203</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8937</span></span> <span class="hljs-number"><span class="hljs-number">13235972</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8938</span></span> <span class="hljs-number"><span class="hljs-number">13268741</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8939</span></span> <span class="hljs-number"><span class="hljs-number">13301510</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893a</span></span> <span class="hljs-number"><span class="hljs-number">13334279</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893b</span></span> <span class="hljs-number"><span class="hljs-number">13367048</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893c</span></span> <span class="hljs-number"><span class="hljs-number">13399817</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893d</span></span> <span class="hljs-number"><span class="hljs-number">13432586</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893e</span></span> <span class="hljs-number"><span class="hljs-number">13465355</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a893f</span></span> <span class="hljs-number"><span class="hljs-number">13498124</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8940</span></span> <span class="hljs-number"><span class="hljs-number">13530893</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8941</span></span> <span class="hljs-number"><span class="hljs-number">13563662</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8942</span></span> <span class="hljs-number"><span class="hljs-number">13596431</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8943</span></span> <span class="hljs-number"><span class="hljs-number">13629200</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8944</span></span> <span class="hljs-number"><span class="hljs-number">13661969</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8945</span></span> <span class="hljs-number"><span class="hljs-number">13694738</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8946</span></span> <span class="hljs-number"><span class="hljs-number">13727507</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8947</span></span> <span class="hljs-number"><span class="hljs-number">13760276</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8948</span></span> <span class="hljs-number"><span class="hljs-number">13793045</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8949</span></span> <span class="hljs-number"><span class="hljs-number">13825814</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894a</span></span> <span class="hljs-number"><span class="hljs-number">13858583</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894b</span></span> <span class="hljs-number"><span class="hljs-number">13891352</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894c</span></span> <span class="hljs-number"><span class="hljs-number">13924121</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894d</span></span> <span class="hljs-number"><span class="hljs-number">13956890</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894e</span></span> <span class="hljs-number"><span class="hljs-number">13989659</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a894f</span></span> <span class="hljs-number"><span class="hljs-number">14022428</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8950</span></span> <span class="hljs-number"><span class="hljs-number">14055197</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8951</span></span> <span class="hljs-number"><span class="hljs-number">14087966</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8952</span></span> <span class="hljs-number"><span class="hljs-number">14120735</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8953</span></span> <span class="hljs-number"><span class="hljs-number">14153504</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8954</span></span> <span class="hljs-number"><span class="hljs-number">14186273</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">0xd87a8955</span></span> <span class="hljs-number"><span class="hljs-number">14219042</span></span> oracle <span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span></code> </pre><br><br>  In other words, now Oracle has allocated much more sets with fewer semaphores in the set.  We tested this configuration instead of ‚Äúcluster_database = TRUE‚Äù and got the same low CPU time. <br><br>  3. There is a third solution to the problem.  Its advantage is: there is no need to change the host configuration, and a configuration can be made for each instance: there is an undocumented parameter <b>‚Äú_sem_per_sem_id‚Äù</b> , which defines the upper limit on the number of semaphores allocated to a set.  If you set an appropriate value for this parameter, such as 100 or 128, the end result should be the same.  Oracle will allocate more sets with fewer semaphores in the set, but we did not check this option. <br><br><h2>  Conclusion </h2><br><br>  Some ways to use an Oracle instance result in a spin-lock contention at the Linux operating system level (if Oracle is running in single-instance mode) and the recommended semaphore settings are used.  This leads to the fact that all semaphore calls go to the same semaphore set.  If you force Oracle to allocate more semaphore sets, then the calls are distributed across more sets.  Consequently, the competition is significantly reduced. <br><br>  There are probably indications for Oracle internal use that the default semaphore parameters recommended for large nodes are not optimal for single-instance mode under certain circumstances.  But I do not know whether there is a comprehensive official guide. <br><br>  This is the CPU profile at exactly the same test load as before, using the modified settings of ‚Äúkernel.sem‚Äù: <br><br><img src="https://habrastorage.org/files/cb7/f62/2d9/cb7f622d9b5b4319958244ee69e68f9d.png"><br><br>  Also from the AWR report, PX-related wait events have disappeared, which should not be.  Performance has improved significantly, also for the complex queries mentioned above. <br><br>  If you liked the material from Randolph, then on March 24 he will hold his <a href="http://www.luxoft-training.ru/master-class/geist/%3Futm_source%3Dhabrahabr%26utm_medium%3Dblogpost%26utm_campaign%3Dgeist">master class</a> in Moscow. </div><p>Source: <a href="https://habr.com/ru/post/278545/">https://habr.com/ru/post/278545/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278533/index.html">(La) TeX on Habrahabr</a></li>
<li><a href="../278535/index.html">libuniset2 is a library for creating ACS. It is better to see once ... Part 1</a></li>
<li><a href="../278537/index.html">libuniset2 is a library for creating ACS. It is better to see once ... Part 2 (Running the simulator)</a></li>
<li><a href="../278539/index.html">Preparing for the CISA exam. Business Continuity Practices</a></li>
<li><a href="../278541/index.html">We invite you to a round table on gaming industry trends.</a></li>
<li><a href="../278547/index.html">6 secrets of Bitbucket</a></li>
<li><a href="../278549/index.html">Security firmware on the example of the Intel Management Engine</a></li>
<li><a href="../278551/index.html">fsharpConf 2016 - Live Broadcast of the F # Virtual Conference</a></li>
<li><a href="../278553/index.html">How we fought parsers</a></li>
<li><a href="../278555/index.html">Security Week 09: DROWN attack, HackingTeam returns, impressions from RSA Conference 2016</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>