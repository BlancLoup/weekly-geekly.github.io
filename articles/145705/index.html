<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>mSearch: search + filter for MODX Revolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Something MODX blog on Habr√© completely withered, you need to revive it a little. I want to introduce you to your component, which has recently been a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>mSearch: search + filter for MODX Revolution</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/storage2/320/db5/d49/320db5d4955f89e886cbeea5edaedffb.png" align="right"><br></a> <br>  Something MODX blog on Habr√© completely withered, you need to revive it a little.  I want to introduce you to your component, which has recently been almost completely rewritten and expanded. <br><br>  It is called <a href="http://modx.com/extras/package/msearch">mSearch</a> and at first it was conceived as the simplest search on the site, taking into account the morphology of the Russian language.  That is, you needed a simple and easy solution for any site, without installing Sphinx and other serious systems. <br><br>  In the process of googling, I came across one <a href="http://valera.ws/2007.09.05~morpho_search_in_mysql/">interesting implementation of</a> this task with the help of <a href="http://sourceforge.net/projects/phpmorphy/">phpMorphy</a> .  Full-text search in a table with an index, with the generation of different vocabulary forms.  I liked the idea, it fit my criteria and I wrote my decision, based on this method. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  mSearch </h2><br>  This is a snippet and plugin.  Snippet searches, plugin indexes documents when saving. <br><br>  Installation, as usual, from the repository, in 4 clicks.  At the same time, you will be prompted to download and install phpMorphy dictionaries for the Russian language - do not refuse. <br><br>  If you install the extension on the working site, you will need to index existing documents.  This is done simply: <br> <code>[[!mSearch? <br> &amp;indexer=`1` <br> &amp;offset=`0` <br> &amp;limit=`200` <br> ]]</code> <br>  The first parameter indicates that we are not looking, but we are indexing, and the second and third are restricting the selection for large sites.  If there are a lot of documents, and the server is dead, you will have to work in several runs, changing the value of offset, in this example, first 0, then 200, then 400, etc. <br><br>  Indexing is needed only once, after installation on the site, if there are documents.  Then the plugin mSearchIndexer will be indexed when saving documents. <br><br>  You can see all the mSearch parameters in the properties of the snippet, and here I will write only the main ones: <br><ul><li>  &amp; indexer - enable indexing.  Only needed once after installation. </li><li>  &amp; indexFields - which fields of the resource to index? </li><li>  &amp; disablePhpMorphy - disable phpMorphy.  The search becomes much less accurate. </li><li>  &amp; includeMS - when displaying results, include the properties of products from <a href="http://habrahabr.ru/post/131456/">miniShop</a> . </li><li>  &amp; includeTVs - when displaying products, include TV parameters. </li><li>  &amp; includeTVList - list of names of TV parameters, separated by commas, for output. </li><li>  &amp; parents - the list of parents that will be searched to a depth of 10 attachments, separated by commas. </li><li>  &amp; returnIds - instead of decorated results, return the id of the found pages, separated by commas. </li><li>  &amp; resources - a list of required resources, separated by commas, which will be searched. </li><li>  &amp; templates - search only among resources with these template numbers, separated by commas. </li><li>  &amp; tpl - output template. </li><li>  &amp; where - JSON expressions to fine-tune the output of found resources. </li></ul><br>  Parameters indexFields, includeTVs, includeTVList, disablePhpMorphy have a plugin.  They are responsible for indexing the resource when updating. <br>  These parameters also affect primary indexing (&amp; &amp; indexer = `1`). <br><br>  Paying your attention to the fact that many parameters are not accidentally called like getResources.  This means that they work the same way.  Snippet perfectly supports output with pagination via getPage and can, in some cases, quietly replace getResources. <br><br>  The search goes on the index table, which gives a good speed, even with a large number of documents, checked for ~ 6000 pieces. <br><br>  Of course, this method is not perfect, not everything is smooth with relevance, but in any case there is no better solution for the Russian language and MODX.  The main thing, in my opinion, is that you can pretty well specify where to look, with which template, among which parents, etc.  Well, the &amp; where parameter allows you to customize the search in any way you like. <br><br>  You <a href="http://minishop2.com/search%3Fquery%3D%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580">can</a> search the search <a href="http://minishop2.com/search%3Fquery%3D%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580">here</a> .  Note that morphology works only for the Russian language. <br><br>  The logical use of mSearch was to search for the store's products, and display the results found, instead of getResources.  And this, in turn, has evolved into writing the mFilter snippet, for flexible filtering of found products. <br><br><h2>  mFilter </h2><br>  This is the second snippet in mSearch.  It independently generates filters for the found (or in advance specified) resources, using chunks for registration.  Numeric defaults are displayed as a slider, text values ‚Äã‚Äãas checkboxes. <br><br>  Filters are based on TV parameters of resources, and \ or properties of miniShop products. <br><br>  <a href="http://minishop2.com/catalog/">It looks like this</a> . <br><br>  You see on the left the parameters, on the right the search results on my demo site for the phrase "Sony".  Near each parameter there are tsiferki - this is the number of results that you get when you select this parameter.  That is, all filter options are calculated on the fly, and the impossible combinations are disabled. <br><br>  Works exclusively through Ajax ( <a href="">js script</a> for example is attached).  When the page loads, all the necessary resource properties for building filters are selected, cached, and the filter form is displayed.  each time a form changes, it is sent to the server and the results and status of the filter switches come in response. <br><br>  It works quite fast, but I haven‚Äôt yet tested it on really large volumes. <br><br>  The main parameters of mFilter: <br><ul><li>  &amp; resources - list of resources for work, separated by commas.  If not specified, it will try to search for results through mFilter. </li><li>  &amp; includeTVs - enable TV to generate filters </li><li>  &amp; includeTVList - use these TVs, separated by commas </li><li>  &amp; excludeTVList - do not use these TVs, separated by commas </li><li>  &amp; includeMS - take miniShop parameters to build a filter </li><li>  &amp; includeMSList - which fields of miniShop products to use for the filter </li><li>  &amp; sortFilters - filter output order, with prefixes, for example: `tv_category, tv_subcategory, ms_add2, tv_color, tv_size, tv_action, ms_price` </li><li>  + if you search for resources, then any mSearch parameters </li><li>  + any getPage and \ or getResources \ msGetResources parameters </li></ul><br>  To display the filter results, you need snippets <a href="http://modx.com/extras/package/getpage">getPage</a> , <a href="http://modx.com/extras/package/getresources">getResources</a> (if you use miniShop - msGetResources). <br><br>  Also jquery plugins are required: <br>  jQuery 1.7+ - the main assistant <br>  jQueryUI 1.8+ - you only need a slider widget for prices and other numeric values <br>  jQuery Form 2.7+ - submitting a form and receiving a response <br><br>  To display products from a certain category of miniShop store, you can use the getCatIds snippet: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_REQUEST[<span class="hljs-string"><span class="hljs-string">'query'</span></span>])) {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;} $parent = $modx-&gt;resource-&gt;id; $tmp = $modx-&gt;getChildIds($parent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($tmp)) {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;} $tpls = explode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'minishop.goods_tpl'</span></span>)); $q = $modx-&gt;newQuery(<span class="hljs-string"><span class="hljs-string">'modResource'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id:IN'</span></span> =&gt; $tmp, <span class="hljs-string"><span class="hljs-string">'template:IN'</span></span> =&gt; $tpls, <span class="hljs-string"><span class="hljs-string">'deleted:!='</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'published'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); $q-&gt;select(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($q-&gt;prepare() &amp;&amp; $q-&gt;stmt-&gt;execute()) { $ids = $q-&gt;stmt-&gt;fetchAll(PDO::FETCH_COLUMN, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> implode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $ids); }</code> </pre><br>  Call example: <br> <code>[[!mFilter? <br> &amp;resources=`[[!getCatIds]]` <br> &amp;includeTVs=`1` <br> &amp;includeTVList=`category,color,size,action` <br> &amp;includeMS=`1` <br> &amp;includeMSList=`add2,price` <br> &amp;tpl=`tpl.msGoods.row` <br> &amp;templates=`5` <br> &amp;sortFilters=`tv_category,tv_subcategory,ms_add2,tv_color,tv_size,tv_action,ms_price` <br> ]]</code> <br> <br><h2>  Conclusion </h2><br>  All design chunks and js script for work are included.  Of course, it‚Äôs not a fact that everything will be fine-tuned for you the first time, for this you need some knowledge of MODX, jQuery and an understanding of how Ajax works.  With all the "does not work!" First look at the console of your browser for javascript errors. <br><br>  But I, as I could, tried to simplify the task of building a filter.  And now, with a certain desire, you can do it on your website / store. <br><br>  You can see in the admin panel of my <a href="http://minishop2.com/manager/">demo site</a> how filter and search are enabled.  Login and password: <b>test</b> . <br><br><div class="spoiler">  <b class="spoiler_title">By the way</b> <div class="spoiler_text">  All work on the mFilter was ordered and paid for by Web Studio <a href="http://simpledream.ru/">Simple Dream</a> . </div></div></div><p>Source: <a href="https://habr.com/ru/post/145705/">https://habr.com/ru/post/145705/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145700/index.html">OVH opened a large data center in America</a></li>
<li><a href="../145701/index.html">How to record screencasts</a></li>
<li><a href="../145702/index.html">New office Zynga</a></li>
<li><a href="../145703/index.html">Implementing a Verilog Digital IIR Filter</a></li>
<li><a href="../145704/index.html">Treatment of encrypted javascript files</a></li>
<li><a href="../145706/index.html">Runetology (151): Travel.ru founder Asya Patrysheva</a></li>
<li><a href="../145708/index.html">Tests and DB. How to roll back the changes made by the test?</a></li>
<li><a href="../145709/index.html">‚ÄúVerification Decorators‚Äù for Views</a></li>
<li><a href="../145710/index.html">Linus Torvalds: Nokia made a mistake with Windows Phone</a></li>
<li><a href="../145711/index.html">Vote for the semi-finalists of the ‚ÄúYour Cinema‚Äù competition!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>