<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio for Visual C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A long time ago, all our articles began to be devoted to anything, but not only to the PVS-Studio tool itself. We talk about proven projects, about th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio for Visual C ++</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/c8e/3e7/060/c8e3e706083b48f7708c357b03e92e61.png" alt="PVS-Studio small"><br>  A long time ago, all our articles began to be devoted to anything, but not only to the PVS-Studio tool itself.  We talk about proven projects, about the intricacies of the C ++ language, about creating plugins in C #, about launching PVS-Studio from the command line.  But after all, first of all, PVS-Studio is focused on developers using Visual Studio.  We have done a lot to make it convenient to use our tool.  But just this often happens behind the scenes.  I decided to correct this situation and tell you about the PVS-Studio plugin from scratch.  If you are using Visual C ++, this article is for you. <br><a name="habracut"></a><br><h2>  What is static code analysis and why is it needed? </h2><br>  Static code analysis is the process of identifying errors and shortcomings in the source code of programs.  Static analysis can be viewed as an automated code review process.  Joint <a href="http://www.viva64.com/ru/t/0073/">code review</a> , great methodology.  But it has a significant drawback - the high cost.  It is necessary to regularly assemble several programmers to review a new code or re-review a code after making recommendations. <br><br>  On the one hand, I want to regularly review the code.  On the other hand, it is too expensive.  A compromise solution is static code analysis tools.  They tirelessly process the source code of the programs and give the programmer recommendations to pay special attention to certain parts of the code.  Of course, the program will not replace a full review of the code performed by a team of programmers.  However, the benefit / price ratio makes using static analysis a very useful practice used by many companies. <br><br>  There are a large number of commercial and free static code analyzers.  A large list of static analyzers is available on Wikipedia: <a href="http://www.viva64.com/go.php%3Furl%3D70">List of tools for static code analysis</a> .  The list of languages ‚Äã‚Äãfor which static code analyzers exist is also quite large (C, C ++, C #, Java, Ada, Fortran, Perl, Ruby, ...).  Naturally, we will tell you about the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main advantage of static analysis is the possibility of significantly reducing the cost of eliminating defects in the program.  The earlier the error is detected, the lower the cost of fixing it.  So, according to the data given in McConnell's ‚ÄúPerfect Code‚Äù, the correction of an error at the testing stage is ten times more expensive than at the design stage (writing code): <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/962/00d/889/96200d889a8fc8c1b6ad0ccd77689139.png" alt="Figure 1. The average cost of correcting defects depending on the time of their introduction and detection (data for the table are taken from the book of S. McConnell's Perfect Code). Click on the picture to enlarge it."></a> <br><br>  Figure 1. The average cost of correcting defects depending on the time of their introduction and detection (data for the table are taken from S. McConnell's ‚ÄúPerfect Code‚Äù).  Click on the picture to enlarge it. <br><br>  Static analysis tools allow you to identify a large number of errors in the design phase, which significantly reduces the development cost of the entire project.  For example, the PVS-Studio static code analyzer can run in the background immediately after compilation and, in case a potential error is found, notify the programmer.  More about this mode will be described below. <br><br>  The topic of code review and static analysis is described in more detail in the articles, the links to which are given at the end of the article [ <a href="http://www.viva64.com/ru/t/0073/">1</a> , <a href="http://www.viva64.com/ru/t/0046/">2</a> , <a href="http://www.viva64.com/ru/t/0074/">3</a> ]. <br><br><h2>  PVS-Studio static code analyzer </h2><br>  PVS-Studio is a static analyzer that detects errors in the source code of C, C ++, C ++ 11, C ++ / CX applications.  First of all, it is focused on Visual Studio users (on support for other environments, see <a href="http://www.viva64.com/ru/pvs-studio/">the product page</a> ).  The analyzer perfectly integrates into VS2005 - VS2012.  Soon we will add support for VS2013.  As a result, users receive an additional item ‚ÄúPVS-Studio‚Äù in the main menu and a window for working with diagnostic messages (see Figure 2). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1c6/907/049/1c690704965f3ebc2f710f3d70afe0a0.png" alt="Figure 2. Main elements added by the PVS-Studio analyzer when integrated into Visual Studio. Click on the picture to enlarge it."></a> <br><br>  Figure 2. Main elements added by the PVS-Studio analyzer when integrated into Visual Studio.  Click on the picture to enlarge it. <br><br><h3>  Initial settings </h3><br>  The analyzer is ready for operation immediately after installation.  In most cases, you do not need to configure anything to make the first launch.  The only setting you might need at the beginning is to exclude third-party libraries.  You still will not edit anything in the source files of the jpeg library.  Therefore, there is no need to check it.  In addition, excluding folders from analysis will shorten the analysis time.  Excluded from the analysis directories are set here: Options-&gt; Dont't Check Files-&gt; PathMasks (see Figure 3). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/392/b07/0b2/392b070b25232a09b7c77eec95d3562d.png" alt="Figure 3. Editing the list of directories that the analyzer will not check. Click on the picture to enlarge it."></a> <br><br>  Figure 3. Editing the list of directories that the analyzer will not check.  Click on the picture to enlarge it. <br><br>  If there is one of the specified names in the full file path, the analysis will not be performed.  By default, the list already includes the names of some directories.  However, in your project the folder with the ZLib library may not be called ‚Äúzlib‚Äù, but, for example, ‚Äúzip_lib‚Äù.  Therefore, you should edit this list.  To start editing, click the button with three dots. <br><br>  Examples of valid masks for the PathMasks list: <ul><li>  c: \ Libs \ - all project files located in this folder and its subfolders will be excluded. </li><li>  \ Libs \ or * \ Libs \ * - all files located in directories, the path to which contains the ‚ÄúLibs‚Äù subfolder, will be excluded.  If the characters "*" are not specified, they will still be automatically added, so both recording options are the same. </li><li>  Libs or * Libs * - all files to which the path contains a subfolder that has 'Libs' as a name or a fragment of a name will be excluded.  Also in this case, files containing Libs in the name will be excluded, for example, c: \ project \ mylibs.cpp.  To avoid confusion, we recommend always using slashes. </li></ul>  In addition to exceptions of entire folders, you can set masks to exclude individual files.  For this there is a setting FileNameMasks.  You can find out more about how to work with exclusion lists in the documentation: <a href="http://www.viva64.com/ru/d/0017/">Settings: Don't Check Files</a> . <br><br><h3>  Project Verification </h3><br>  Upon completion of the initial settings, you can proceed to check the project.  Most likely, you can immediately try to check the entire solution.  To do this, select the menu item PVS-Studio-&gt; Check-&gt; Solution (see Figure 4). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9d/c1a/3c4/f9dc1a3c4def0d633ed6abd753818b09.png" alt="Figure 4. Solution check using the PVS-Studio analyzer."><br><br>  Figure 4. Solution check using the PVS-Studio analyzer. <br><br>  If there are any difficulties with the verification, we recommend that you refer to the section ‚Äú <a href="http://www.viva64.com/ru/d/0304/">Can not verify?</a> ‚Äù On our website.  This is not a stupid recommendation in the spirit of "check that the plug is plugged in."  The section describes typical situations that users have approached us with and suggested options for action. <br><br><h3>  Work with a list of diagnostic messages </h3><br>  After verification, all diagnostic messages will be displayed in a special window.  The window has many controls.  All of them serve to show exactly those diagnostic messages that are interesting to the user.  However, at first the window may seem complicated.  Let's look at all the controls (see Figure 5). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1fe/861/f1e/1fe861f1e86fe2a3351d23dd6041b371.png" alt="Figure 5. Window with diagnostic messages. Click on the picture to enlarge it."></a> <br><br>  Figure 5. Window with diagnostic messages.  Click on the picture to enlarge it. <br><ol><li>  The PVS-Studio window itself. </li><li>  The button includes the message "something went wrong."  For example, it is not possible to preprocess one of the files. </li><li>  Buttons that include warnings of different levels.  Now all three levels of diagnostics are included.  In this case, the window displays 132 warnings of the first level, 235 warnings of the second level and 390 warnings of the third level.  The message level is shown in one of the columns as a triangle with a number. </li><li>  Active sets of diagnostic rules.  GA - general diagnostics, OP - micro-optimizations, 64 - 64-bit diagnostics, MP - errors related to OpenMP, CS - user diagnostics.  Now the window displays warnings related to GA and MP. </li><li>  Enable / disable the display of messages marked as false.  Showing false warnings now.  You can read more about this functionality in the documentation: <a href="http://www.viva64.com/ru/d/0021/">Suppressing false warnings</a> . </li><li>  Search among diagnostic messages. </li><li>  Quick filters.  You can, for example, leave in the list only messages with the code V501 and that are in the project XYZ. </li><li>  Go to previous / next post.  This opens the corresponding file, and the cursor is placed on the line with a potential error.  Also, you can always select diagnostics from the list by double-clicking the mouse. </li><li>  Open the settings window. </li></ol>  The table with diagnostic messages is divided into the following columns: <ul><li>  <b>Asterisk</b>  She has no specific purpose.  The user can interpret it at his discretion.  For example, he may mark the most interesting warnings for further careful analysis.  Analogy - mark with asterisks of letters in mail program like Thunderbird or Outlook. </li><li>  <b>Level</b>  The level to which the alert applies.  Level 1 - the most suspicious places.  Level 3 - most likely a false positive or a minor inaccuracy in the code. </li><li>  <b>ID</b> .  Unique message number.  It can be useful when working with a large list.  For example, you can go to the message with a specific number (see ‚ÄúNavigate to ID ...‚Äù in the <a href="http://www.viva64.com/ru/d/0202/">context menu</a> ). </li><li>  <b>Code</b> .  The message code.  If you click on it with a mouse, the page with the description of the warning will open. </li><li>  <b>Message</b> .  The text of the diagnostic message. </li><li>  <b>Project</b> .  Project name (you can disable this column using the context menu). </li><li>  <b>File</b> .  File name. </li><li>  <b>Line</b> .  Line number  <b>Important!</b>  Notice that after some lines, a semicolon is constructed.  Example: ‚Äú123 (...)‚Äù.  By clicking on this number, you will receive a list of all the lines of code that relate to this message.  At the same time, it is possible to go to each of the lines in the list. </li><li>  <b>Mark "False Alarm"</b> .  Mark that the warning is false.  Note that false warnings are present in the code only if the N 5 button is pressed (see Figure 5). </li></ul>  Yes, it was tiresome to read.  However, I assure you, starting to use, you quickly get comfortable with the tool.  And you will rarely click on something to set it up. <br><br><h3>  Context menu </h3><br>  So, by double-clicking on the message you move to the desired text fragment.  By pressing the right mouse button opens the context menu. <br><br>  The menu is quite simple, and you should not overload the article with a description of each of the items.  If something is not clear, you can peep in the documentation: <br><br>  However, I want to dwell on one very useful feature. <br><br>  Remember that in the settings you can add folders / files to exclude (see Figure 2).  So, adding something is much easier than it seems! <br><br>  Pay attention to the item ‚ÄúDon't check files and hide all messages from ...‚Äù.  Clicking on it will drop a list of paths that can be added to the exception (see Figure 6). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b6a/8bb/da1/b6a8bbda18b9062cd0e93bd31b30b2ec.png" alt="Figure 6. Excluding files from scanning. Click on the picture to enlarge it."></a> <br><br>  Figure 6. Excluding files from scanning.  Click on the picture to enlarge it. <br><br>  You can select a separate file or one of the directories.  The figure shows that the folder ‚ÄúE: \ [Build] \ VirualDub \ src \ test‚Äù is selected.  This means that all files in this folder and all subfolders will be excluded from the analysis.  Moreover, all messages related to these files will immediately disappear from the list.  Very comfortably.  You do not need to restart the analysis to remove all messages related to the tests (the ‚Äútest‚Äù folder). <br><br><h2>  Incremental analysis mode </h2> <br>  An introduction to PVS-Studio will be incomplete if you don‚Äôt talk about one of the most important features - incremental code analysis. <br><br>  The earlier the error is found, the cheaper its elimination.  It is ideal to immediately emphasize errors in the edited text of the program.  However, it is technically difficult and resource intensive.  Therefore, PVS-Studio runs in the background at the moment when the corrected code is successfully compiled.  Thus, errors in just changed code are looked for.  The fact that an analysis is taking place can be judged by the system tray icon. <br><br>  When an error is found, a pop-up warning window appears (see Figure 7). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02e/883/b9b/02e883b9ba49d7ac1445d162c3ba593d.png" alt="Figure 7. A pop-up message stating that suspicious places were found in the edited files."><br><br>  Figure 7. A pop-up message stating that suspicious places were found in the edited files. <br><br>  If you click on this pop-up message, the PVS-Studio window will open (see Figure 2), and you can examine the suspicious code fragments. <br><br>  In fact, than to describe this mode, it is easier to try to work with it.  You write the code as before.  And if necessary, the analyzer will disturb you.  Try it! <br><br>  We ourselves constantly use this mode.  Yes, we also sometimes make mistakes when coding.  And the ability to immediately fix them significantly reduces the time to detect a defect and try to understand why the program does not behave as planned.  It‚Äôs a shame to spend 15-20 minutes debugging to find a typo in the index.  Here is one of the latest cases when PVS-Studio found an error in PVS-Studio immediately after it appeared in the code: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'\\'</span></span> &amp;&amp; in[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.'</span></span> &amp;&amp; in[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { in += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  But this, of course, flowers.  PVS-Studio analyzer can sometimes be much more useful.  Here is one of the reviews about our analyzer: " <a href="http://www.viva64.com/ru/b/0221/">An example of using a static analyzer</a> ."  The text makes you think. <br><br>  I summarize.  Incremental analysis is something you should definitely try.  You will love it as soon as you find a couple of blunders in the fresh code. <br><br><h2>  PVS-Studio features </h2><br>  We will be short.  It is impossible to concisely describe all the diagnostics that are available in PVS-Studio.  A complete list of diagnostics and their detailed description can be found in the documentation: <a href="http://www.viva64.com/ru/d/">Description of the errors to be diagnosed</a> .  We confine ourselves to a table in which diagnostics are grouped by type.  Some diagnostics are included in more than one group.  The point is that the division is very conditional.  For example, a typo can lead to the use of uninitialized memory.  Some errors, on the contrary, did not find a place in the table, they are too specific.  However, the table as a whole gives an idea of ‚Äã‚Äãthe functionality of the static code analyzer (see Figure 8). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/213/9a2/85d/2139a285d470073a8506755d6203706b.png" alt="Figure 8. PVS-Studio features. Click on the picture to enlarge it."></a> <br><br>  Figure 8. PVS-Studio features.  Click on the picture to enlarge it. <br><br>  As you can see, the analyzer maximally manifests itself in such areas as the search for errors caused by typos, Copy-Paste.  Well diagnoses problems that are related to code security. <br><br>  How all this works in practice, you can find out by looking into the <a href="http://www.viva64.com/ru/examples/">database of errors</a> .  We collect in this database all the errors that are found by checking various Open-Source projects. <br><br><h2>  Conclusion </h2><br>  Of course, here we told not everything about the instrument.  If you tell everything, the article will turn into documentation.  The goal was to show how easy it is to work with a tool within the Visual Studio environment.  About other environments and modes of operation can be read in the documentation and other articles located on our <a href="http://www.viva64.com/ru/">website</a> .  There, by the way, a lot of interesting things for programmers.  Come to wander. <br><br>  I wish you a reckless code and I hope that you will enjoy PVS-Studio.  If you have any questions, we will always help and advise.  <a href="http://www.viva64.com/ru/about-feedback/">Write to us</a> . <br><br><h2>  Additional resources: </h2><br><ol><li>  <a href="http://www.viva64.com/ru/t/0073/">Code review</a> . </li><li>  <a href="http://www.viva64.com/ru/t/0046/">Static code analysis</a> . </li><li>  <a href="http://www.viva64.com/ru/t/0074/">Static code analysis tools</a> . </li><li>  Myths about static analysis.  <a href="http://www.viva64.com/ru/b/0116/">The second myth - professional developers do not make stupid mistakes</a> . </li><li>  <a href="http://www.viva64.com/ru/pvs-studio-download/">Download PVS-Studio</a> and try it out. </li><li>  Why do I find few bugs?  <a href="http://www.viva64.com/ru/b/0105/">Leo Tolstoy and static code analysis</a> . </li><li>  Discuss the price of the PVS-Studio analyzer for your team and how to acquire it: <a href="http://www.viva64.com/ru/order/">buy PVS-Studio</a> . </li><li>  <a href="http://www.viva64.com/ru/b/0132/">Answers</a> to questions that are often asked after reading our articles. </li></ol><br><br>  <b>UPDATE</b> <br>  Updated article version: <a href="http://www.viva64.com/ru/b/0305/">PVS-Studio for Visual C ++</a> . </div><p>Source: <a href="https://habr.com/ru/post/199346/">https://habr.com/ru/post/199346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199334/index.html">ASUS MeMO Pad FHD 10 tablet review</a></li>
<li><a href="../199336/index.html">Blippex - Search Wikipedia</a></li>
<li><a href="../199338/index.html">A pair of life hacks of our online store</a></li>
<li><a href="../199340/index.html">Quality of Service button. Do it yourself</a></li>
<li><a href="../199344/index.html">PostScience on Habr√©</a></li>
<li><a href="../199348/index.html">Making life easier for a mobile gaming developer.</a></li>
<li><a href="../199350/index.html">Performance analysis of block devices with blktrace</a></li>
<li><a href="../199352/index.html">Normalization of education in the resume on hh.ru</a></li>
<li><a href="../199354/index.html">How to encrypt messages by e-mail and whether it will become ‚Äúsafer‚Äù</a></li>
<li><a href="../199356/index.html">As Armadillo was fixed, the PSP was hacked and all DSA keys in Debian were compromised. Or again about weak PRNG and (EC) DSA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>