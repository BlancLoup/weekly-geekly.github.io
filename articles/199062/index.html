<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>pdoTools - a set of quick snippets and a library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to bring to your attention my development of fast content output on MODX Revolution sites. 

 As you know, this system is entirely built on its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>pdoTools - a set of quick snippets and a library</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/54d/e42/3cb/54de423cbc02b24627f2a5447461714f.jpg" align="right"><br>  I want to bring to your attention my development of fast content output on MODX Revolution sites. <br><br>  As you know, this system is entirely built on its own ORM called xPDO.  It greatly simplifies the work, allows you to write one universal code for different databases, and much more. <br><br>  Unfortunately, it cannot boast an output speed (like, probably, any ORM), so I tried to combine its advantages with the usual PDO, add better work with chunks and make a convenient MODX library. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Key Features: <br><ul><li>  Quick work with the database.  All requests are made on xPDO, and selected without objects - on PDO. </li><li>  Preliminary processing of simple placeholders in chunks.  The MODX parser deals only with complex calls. </li><li>  The chunks code can be specified directly when calling the snippet, loaded in the usual way or from static files. </li><li>  Correct sorting, preparation, processing and output of TV parameters. </li><li>  Maintaining a detailed log of the work of the snippet with time stamps, for debugging. </li><li>  Convenient loading classes and many functions that can be used in their development. </li><li>  Includes <b>8</b> universal snippetov, which give a good basis for the developer. </li></ul><br>  I'll start with the last item. <a name="habracut"></a><br><br><h4>  8 universal snippets </h4><br>  Initially, pdoTools was designed as a library for the operation of other components, for example, it is used by <a href="http://habrahabr.ru/post/159773/">Tickets</a> . <br><br>  Over time, it became obvious that it allows you to write a good package of tools that can replace standard MODX snippets at minimal cost. <br><br>  <b>pdoResources</b> <br>  A snippet for fetching resources, can replace getResources.  It supports almost all of its capabilities, and has the following features: <br>  - connection of other tables through different JOIN <br>  - you can specify what to choose from the columns of the tables <br>  - flexible sampling conditions, up to the specification of pure SQL <br><br>  At the same time, the snippet runs 5 to 10 times faster. <br><br>  <b>pdoMenu</b> <br>  Snippet to generate the site menu.  It can replace Wayfinder, supports almost all its parameters and chunks. <br><br>  It works faster, especially when you first start with a cold cache. <br><br>  <b>pdoPage</b> <br>  Replacement for getPage.  It generates a much more correct pagination, and does not allow to push incorrect requests into the page and limit request parameters. <br><br>  <b>pdoUsers</b> <br>  Snippet, which displays the site users, can filter them by groups and roles. <br><br>  <b>pdoCrumbs</b> <br>  Fast breadcrumbs generation, replaces BreadCrumb. <br><br>  <b>pdoNeighbors</b> <br>  The output of adjacent documents pages.  That is: the next, previous and parent.  It is very convenient to use to navigate the news. <br><br>  <b>pdoField</b> <br>  Snippet receiving any field of the resource or its parent, including the TV parameter.  Replaces getResourcesField and UltimateParent. <br>  Able to display "default value". <br><br>  <b>pdoSitemap</b> <br>  Site map generation.  Very fast replacement GoogleSiteMap, the difference is up to 12 times. <br><br><hr><br>  I specifically gave a brief description of the snippets at the beginning of the post, because for most novice users this will be enough to work quickly and comfortably in the MODX Revoltuion. <br><br>  In fact, when replacing standard snippets with analogues from pdoTools, the average site starts to run 2-3 times faster.  You can look at the documentation page and learn more about the parameters and examples of snippets <a href="http://bezumkin.ru/modx/pdotools/">here</a> . <br><br>  The beauty of my addition is that it does not require any special manipulations.  You simply install it from the repository and you can use it.  If something does not suit you, it‚Äôs buggy, it doesn‚Äôt work the way you‚Äôve expected - old snippets are still with you, you can use them. <br><br>  And now I‚Äôll tell you how pdoTools works fast. <br><br><h4>  Sampling from DB </h4><br>  For each table in MODX there is a description in the .map file.  Out of the box, the system supports 2 databases: MySQL and MSSQL, so all requests to pdoTools are generated via xPDO. <br><br>  The beginning is always the same: <br><pre><code class="php hljs">$q = $modx-&gt;newQuery(<span class="hljs-string"><span class="hljs-string">'modResource'</span></span>); $q-&gt;select(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'pagetitle'</span></span>, <span class="hljs-string"><span class="hljs-string">'content'</span></span>)); $q-&gt;sortby(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'asc'</span></span>); $q-&gt;limit(<span class="hljs-number"><span class="hljs-number">10</span></span>);</code> </pre> <br><br>  But then we can choose or objects: <br><pre> <code class="php hljs">$resources = $modx-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'modResource'</span></span>, $q); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($resources <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $resource) { print_r($resource-&gt;toArray()); }</code> </pre><br><br>  Or arrays: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($q-&gt;prepare() &amp;&amp; $q-&gt;stmt-&gt;execute()) { $resources = $q-&gt;stmt-&gt;fetchAll(PDO::FETCH_ASSOC); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($resources <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $resource) { print_r($resource); } }</code> </pre><br><br>  The classic MODX Revolution path, which is used in the components of its authors, is sampling through xPDO and further work with objects.  This is convenient, of course - because in the model, you can register different transformations for the fields of objects, and checks. <br><br>  But it is very slow, unfortunately.  Therefore, I use the second way - sampling through PDO.  It is faster several times. <br><br><h4>  Competent work with chunks </h4><br>  Chunks, if anyone does not know, these are elements in the MODX tree that contain only HTML.  They are needed to design the work of PHP scripts and separate the logic from the presentation in the system. <br><br>  Here is the usual chunk: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>[[+idx]]. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/[[+uri]]"</span></span></span><span class="hljs-tag">&gt;</span></span>[[+pagetitle]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In chunks there may be special commands for the parser, for example: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>[[+idx]]. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/[[+uri]]"</span></span></span><span class="hljs-tag">&gt;</span></span>[[+menutitle:isempty=`[[+pagetitle]]`]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Each [[+ key]] tag is a future object in the MODX parser.  You can specify different parameters, filters and, in general, program in this way. <br><br>  It's as much cool as slow. <br><br>  Therefore, in pdoTools, chunks are pre-processed - all that is possible is replaced with the banal str_replace () from the received data, then the links [[~ [[+ id]]]]] are replaced, then the lexicon placeholders [[% key]] are all that left (10% of the original work) is sent to the MODX parser. <br><br>  The end result is no different, but the speed of such processing is several times higher than the standard. <br><br>  Using it is very simple: <br><pre> <code class="php hljs">$pdo = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'pdoTools'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $pdo-&gt;getChunk(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'    '</span></span>));</code> </pre><br><br>  In contrast to the original modX :: getChunk (), in pdoTools :: getChunk () we can use not only the already prepared chunks, but also immediately indicate them using the <a href="http://habrahabr.ru/users/inline/" class="user_link">INLINE</a> binding: <br><pre> <code class="php hljs">$pdo = $modx-&gt;getService(<span class="hljs-string"><span class="hljs-string">'pdoTools'</span></span>); $tpl = <span class="hljs-string"><span class="hljs-string">'@INLINE &lt;p&gt;[[+idx]]. &lt;a href="/[[+uri]]"&gt;[[+pagetitle]]&lt;/a&gt;&lt;/p&gt;'</span></span>; $array = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'idx'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'pagetitle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'/page.html'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $pdo-&gt;getChunk($tpl, $array);</code> </pre><br><br><h4>  Work with TV </h4><br>  pdoTools and its snippets are trying to put all the work in 1 database query.  Therefore, all specified TV parameters are attached via LEFT JOIN. <br><br>  It becomes very convenient to filter on TV, because you can simply specify: <br><pre> <code class="php hljs">[[!pdoResources? &amp;parents=`<span class="hljs-number"><span class="hljs-number">2</span></span>` &amp;includeTVs=`myTV` &amp;where=`{<span class="hljs-string"><span class="hljs-string">"myTV:&gt;"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>}` ]]</code> </pre><br><br>  And you get all the resources from the container with id = 2 and the TV value of myTV is greater than 10. You can specify quite complex conditions and selections, so I made a logging system: <br><br><h4>  Library Log </h4><br>  Almost all snippets understand the &amp; shoLog = `1` parameter and output the manager the following wrapper: <br> <a rel="fancybox" href=""><img src="https://habrastorage.org/getpro/habr/post_images/864/747/fcf/864747fcf1ad40bb07356ecbc8e208b1.jpg"></a> <br>  It is very convenient to build conditions and debug queries in the database. <br><br><h4>  Library use </h4><br>  The library connects via modX :: getService () like this: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//       $pdo = $modx-&gt;getService('pdoTools'); //       $pdo = $modx-&gt;getService('pdoFetch');</span></span></code> </pre><br><br>  The first allows you to quickly work with chunks: <br><pre> <code class="php hljs">$pdo-&gt;getChunk(); $pdo-&gt;parseChunk();</code> </pre><br><br>  And the second is able to quickly select resources: <br><pre> <code class="php hljs">$pdo-&gt;getObject(<span class="hljs-string"><span class="hljs-string">'modResource'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $pdo-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'modTemplate'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id:&gt;='</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre><br><br>  If you combine them, this is how your entire site will look like: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//   $pdo = $modx-&gt;getService('pdoFetch'); //   $tpl = '@INLINE &lt;p&gt;&lt;a href="/[[+id]]"&gt;[[+pagetitle]]&lt;/a&gt;&lt;/p&gt;'; //     $resources = $pdo-&gt;getCollection('modResource'); $output = ''; foreach ($resources as $resource) { //  $output .= $pdo-&gt;getChunk($tpl, $resource); } //    $output .= '&lt;pre&gt;'.$pdo-&gt;getTime().'&lt;/pre&gt;'; return $output;</span></span></code> </pre><br><br>  How do you get the 2012 pages of the site for half a second? <br> <a rel="fancybox" href=""><img src="https://habrastorage.org/getpro/habr/post_images/4ed/522/9ca/4ed5229ca6233486f62b35de61e52565.jpg"></a> <br>  If you use modX :: getChunk (), it will be 4 seconds, instead of 0.5.  This difference is only in the processing of simple chunks, without conditions. <br><br>  If you wish, you can also enable permissions by specifying them in the &amp; checkPermissions parameter.  This will slow down the work, but it will still be faster than standard MODX methods. <br><br><h4>  Conclusion </h4><br>  This is very brief information about the features of pdoTools. <br><br>  The component has been under development for almost a year and has the greatest capabilities.  Honestly, it is difficult to describe everything that he can, but I try. <br><br>  Link <a href="http://bezumkin.ru/modx/pdotools/">to the documentation</a> . <br>  Link <a href="http://bezumkin.ru/modx/pdotools/">to the repository</a> . <br>  Fresh versions <a href="http://store.simpledream.ru/pdotools">in the Simple Dream repository</a> . <br>  Stable versions <a href="http://modx.com/extras/package/pdotools">in the official repository</a> . <br>  You can <a href="http://modx-test.com/">test</a> without problems on <a href="http://modx-test.com/">modx-test.com</a> . </div><p>Source: <a href="https://habr.com/ru/post/199062/">https://habr.com/ru/post/199062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199044/index.html">Computer PC "Search". Electronmash</a></li>
<li><a href="../199050/index.html">Groovy vs Java for JavaFX</a></li>
<li><a href="../199052/index.html">45% of web resources of the largest Russian companies contain critical vulnerabilities</a></li>
<li><a href="../199056/index.html">Why Open Data is a culture of working with information on the example of Roszdravnadzor</a></li>
<li><a href="../199060/index.html">Visualization of a two-dimensional gaussian on a plane</a></li>
<li><a href="../199064/index.html">Create a platformer in 30 minutes</a></li>
<li><a href="../199066/index.html">The Taming of Mary-301MTM</a></li>
<li><a href="../199068/index.html">PoolCoin - new cryptocurrency</a></li>
<li><a href="../199070/index.html">ICANN helped to combat child porn in Russia</a></li>
<li><a href="../199078/index.html">Hackers on the screen - 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>