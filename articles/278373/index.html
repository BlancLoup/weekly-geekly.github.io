<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Review of physics in Sonic games. Parts 3 and 4: Jumping and Spinning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: parts of the review are small, so I decided to translate two parts at once. 

 Links to other parts of the series: 
 Part 1: hard...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Review of physics in Sonic games. Parts 3 and 4: Jumping and Spinning</h1><div class="post__text post__text-html js-mediator-article"><img width="640" src="https://habrastorage.org/files/e52/fe6/d01/e52fe6d01d6e4dc2b1caf8c693bc6852.png"><br><br>  <i>From the translator: parts of the review are small, so I decided to translate two parts at once.</i> <br><a name="habracut"></a><br>  <b>Links to other parts of the series:</b> <br>  <a href="https://habrahabr.ru/post/276669/">Part 1: hard tiles</a> <br>  <a href="https://habrahabr.ru/post/276849/">Part 2: Running</a> <br>  <a href="https://habrahabr.ru/post/305312/">Parts 5 and 6: the loss of rings and being under water</a> <br>  <a href="https://habrahabr.ru/post/306756/">Parts 7 and 8: springs and gizmos, super speeds</a> <br><br><h1>  Part 3: Jumping </h1><br><ul><li>  <a href="https://habr.com/ru/post/278373/">1 Acceleration in the air</a> </li><li>  <a href="https://habr.com/ru/post/278373/">2 Gravity</a> </li><li>  <a href="https://habr.com/ru/post/278373/">3 Maximum vertical speed</a> </li><li>  <a href="https://habr.com/ru/post/278373/">4 Air resistance</a> </li><li>  <a href="https://habr.com/ru/post/278373/">5 jump speed</a> </li></ul><br><a name="Air_Acceleration"></a>  <b>Acceleration in the air</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When Sonic is in the air, he can accelerate faster than on the ground.  Two times faster, to be exact: 0.09375.  Let's call this value <i>air</i> . <br><br>  There is no friction in the air (but there is a complex resistance effect, which will be discussed below), and almost always, when Sonic has a certain horizontal speed in the air, he will keep it until the player changes it or Sonic hits the wall. <br><br>  In addition, there are also no differences for slowing down, when pressing the "left" button, <i>air</i> will always be subtracted from the horizontal speed, and when you press the "right" button, <i>air</i> will be added to it. <br><br>  Sonic's maximum speed in the air is the same as on the ground, and is equal to 6. <br><br><a name="Gravity"></a>  <b>Gravity</b> <br><br>  Gravity has a value of 0.21875 ( <i>grv</i> ).  This value is added to the vertical speed in each step in which the Sonic is not on the ground.  She makes him fall down while sliding off a cliff and does not allow him to move upwards endlessly while jumping. <br><br><a name="Top_Y_Speed"></a>  <b>Maximum vertical speed</b> <br><br>  It seems that in the game <i>Sonic 1 Sonic's</i> vertical speed is not limited in any way.  When falling, <i>grv</i> continues to increase to vertical speed, infinitely increasing it. <br><br>  A restriction is introduced in the <i>Sonic CD</i> , in it Sonic cannot fall faster than 16 pixels per step.  This restriction is important so that Sonic never overtook the camera and did not fly through the ground, because he could move so fast that he did not even collide with it.  I think this restriction was imposed because of the increased height of the levels, for example in the Collision Chaos, and the endless vertical mine in Tidal Tempest.  Without this limitation, Sonic could accelerate to enormous speeds in some areas, which could lead to disruption of the game process. <br><br><pre><code class="dos hljs">{ Y speed = Y speed + grv <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Y speed &gt; <span class="hljs-number"><span class="hljs-number">16</span></span> then Y speed = <span class="hljs-number"><span class="hljs-number">16</span></span> }</code> </pre> <br><a name="Air_Drag"></a>  <b>Windage</b> <br><br>  At each step in which the Sonic is in the air, a special formula is applied to the horizontal speed of Sonic, but only if certain conditions are present.  First, the vertical speed must be negative.  Secondly, the vertical speed must be greater than -4 (for example, -3 or -3.5 greater than -4).  Thirdly, the absolute value of the horizontal velocity must be greater than 0.125.  If these conditions are met, the horizontal speed is multiplied by a factor of 0.96875. <br><br><pre> <code class="dos hljs"> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Y speed &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> and Y speed is &gt; -<span class="hljs-number"><span class="hljs-number">4</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> absolute(X speed) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">125</span></span> then X speed = X speed * <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">96875</span></span> } }</code> </pre><br>  Actually, this is only an approximate calculation, and here's why: since the original games use 2 bytes to store the Sonic's speed value, where the first is the pixels and the second is subpixels, the speed of 6.5 pixels per step will be expressed in hexadecimal value $ 0680.  In decimal form, this is 1664. Of course, Sonic does not move at a speed of more than a thousand pixels per step!  1 pixel = $ 100 (256), half pixel = $ 80 (128).  Therefore, in the original game, the air resistance should be calculated as follows: <br><br><pre> <code class="dos hljs"> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Y speed &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> and Y speed is &gt; -$<span class="hljs-number"><span class="hljs-number">0400</span></span> { X speed = X speed - ( X speed div $<span class="hljs-number"><span class="hljs-number">0020</span></span> ) ; "div" -    } }</code> </pre><br>  If we carried out these calculations for relatively low horizontal speeds, which will always be less than $ 20 (32), this would have hardly affected the horizontal velocity.  Why?  Because if the integer division of any number is less than 32 by 32, the result would be 0. Therefore, in the original game, before calculating the air resistance, it is not necessary to check whether the horizontal speed is greater than a certain value - if the horizontal speed is equal to or less than $ 001F, then in any case nothing will happen. <br><br>  Therefore, more accurately emulate air resistance as follows: <br><br><pre> <code class="dos hljs"> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Y speed &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> and Y speed is &gt; -<span class="hljs-number"><span class="hljs-number">4</span></span> { X speed = X speed - ( ( X speed div <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">125</span></span> ) / <span class="hljs-number"><span class="hljs-number">256</span></span> ) } }</code> </pre><br>  In any case, the difference between the two methods is rather insignificant, just the second is technically more accurate. <br><br>  Air resistance is calculated at each step before <i>grv is</i> added to the vertical velocity. <br><br><a name="Jump_Velocity"></a>  <b>Jump speed</b> <br><br>  Now we are used to this, but at the time of the release of the game <i>Sonic the Hedgehog,</i> there were a lot of games that used a fixed jump height.  No matter how quickly the player released the jump button - the character still went up by the same number of pixels.  Games such as <i>Mario</i> and <i>Sonic</i> were among the first to have more flexible and responsive controls, providing improved sensations from controlling a character, and therefore much more interesting and gentle gameplay. <br><br>  How is the variable height of the jump? <br><br>  When you press the up button, when Sonic is on the ground, the vertical speed becomes -6.5 ( <i>jmp</i> ).  In a game without a changeable jump height, no subsequent calculations would be performed after this, except for the addition of gravity, and the character‚Äôs speed would gradually decrease under its influence.  The result would be a leap of exactly 1 second to a height of 100 pixels.  This type of jump is obtained if the player presses the jump button and holds it until Sonic reaches the top of his trajectory.  But the trick to creating a variable jump height is to release the button. <br><br>  When a player releases the jump button in the air after the jump, the computer checks if the Sonic is moving up (i.e., the vertical speed is negative).  If so, then it checks if the vertical speed is less than -4 (for example, -5 is less than -4).  If so, then the vertical speed is set to -4.  Thus, you can complete the jump at any time by releasing the jump button.  If the player releases the button in the next step after the jump, Sonic makes the shortest jump. <br><br>  In the step where the computer detects the click of a jump button, Sonic does not actually move up.  Therefore, in the next step, he can recognize the release of the jump button and Sonic will begin to move up at a speed of -4, without moving up at a speed of <i>jmp</i> . <br><br>  The check for releasing the jump button is performed before moving Sonic to a new position and adding <i>grv</i> to the vertical speed. <br><br>  Unfortunately, the computer checks that the jump button is pressed before Sonic moves.  If the player presses the jump button, he exits the rest of the cycle, so the Sonic does not move during the step where the player jumps, neither in a vertical nor in a horizontal position.  This is wrong, because the horizontal speed is not lost, and it must continue to move.  This disadvantage can be eliminated in the new engine. <br><br>  Tales jumps in the same way as Sonic, and Nackles jumps a little lower, because it has a slightly smaller <i>jmp</i> value, -6. <br><br><img width="640" src="https://habrastorage.org/files/685/1c2/8ad/6851c28ad1544a6298ed38f232237747.png"><br><br><h1>  Part 4: rotation </h1><br><ul><li>  <a href="https://habr.com/ru/post/278373/">1 Friction</a> </li><li>  <a href="https://habr.com/ru/post/278373/">2 slowdown</a> </li><li>  <a href="https://habr.com/ru/post/278373/">3 Maximum speed</a> </li><li>  <a href="https://habr.com/ru/post/278373/">4 Terms</a> </li><li>  <a href="https://habr.com/ru/post/278373/">5 Jump in rotation</a> </li></ul><br><a name="Jump_Velocity"></a>  <b>Friction</b> <br><br>  When Sonic starts spinning when you press <img src="https://habrastorage.org/files/202/3d7/05f/2023d705fa7d4503813949cccaf0ed9c.png">  on the cross, but can no longer accelerate.  As if the player did not press the button for a long time and strongly in the direction of movement, he would behave as if the player is not pressing anything.  The only thing that is involved in this case is friction, here it has a value of 0.0234375 (half of normal), so it seems that Sonic is rolling smoothly, like a wheel or a ball.  In fact, Mega Drive calculates the friction during rotation, halving the value of normal friction.  If you use the Game Genie to change the value of friction, then the friction of rotation will always be two times less. <br><br><a name="Deceleration"></a>  <b>Slowdown</b> <br><br>  However, Sonic may still slow down during rotation.  When the button is pressed in the direction opposite to its movement, the horizontal speed will decrease by 0.125.  In addition, unlike walking behavior, friction during rotation continues to operate, even if the player presses a button in the direction of movement.  Therefore, in reality, when slowing down, the horizontal speed decreases at each step by 0.125 + 0.0234375, or by 0.1484375. <br><br>  It is strange that the same anomaly of deceleration, as when running, occurs during rotation.  If the absolute value of the horizontal velocity is less than 0.1484375, then this value is subtracted, instead of equating the horizontal velocity to zero, and becomes equal to 0.5 in the opposite direction.  Therefore, in a surprising way, Sonic can turn as he spins, even if he cannot accelerate!  This bug is fixed in <i>Sonic 3 and Knuckles</i> , probably the programmers themselves found this behavior undesirable. <br><br><a name="Top_Speed"></a>  <b>Max speed</b> <br><br>  <b><i>(Note: this is currently tested for Sonic 1 and 2. It is not yet known whether this is true for a Sonic 3K or Sonic CD.)</i></b> <br>  Despite the fact that Sonic can not roll faster by itself, this does not mean that any hill will not be able to give it a little extra impetus.  Hills and slopes can be used to rotate at very high speeds.  As in the case of running, when rotating Sonic has a maximum speed limit, although it is much higher and reaches 16 pixels per step.  However, unlike running, Sonic in no way can overcome this speed limit.  If its <i>gsp</i> reaches a value of 16 and tries to increase further, it will automatically be set to 16. <br><br><a name="Criteria"></a>  <b>Conditions</b> <br><br>  In <i>Sonic 1</i> and <i>2</i> games, <i>Sonic</i> cannot start spinning if his absolute horizontal speed is greater than 0.53125. <br><br>  In <i>Sonic 3 and Knuckles,</i> this value is increased to 1.03125.  This is very convenient because you can hold the "down" button to rotate.  If Sonic had to stop before he was crouched, the player would have difficulty in quickly turning on the rotation. <br><br>  In <i>Sonic 3 and Knuckles,</i> Sonic stops spinning if his absolute horizontal speed falls below 0.5. Perhaps this way they wanted to eliminate the anomaly associated with turning in the other direction during rotation in previous games. <br><br><a name="Rolling_Jump"></a>  <b>Jump in rotation</b> <br><br>  In <i>Sonic 1, 2, 3</i> and <i>Knuckles, the</i> player cannot control the Sonic's trajectory in the air using the direction buttons when jumping in rotation.  Therefore, it is difficult to start the rotation to gain speed, and then make an accurate jump.  In <i>Sonic 3</i> and <i>Sonic &amp; Knuckles, the</i> player can regain control of the directional buttons by executing W Kaiten Attack. <br><br><div class="spoiler">  <b class="spoiler_title">W Kaiten Attack</b> <div class="spoiler_text">  He is <b>Insta-Shield</b> , he is also <b>W Spin Attack</b> (W Âõû Ëª¢ „Ç¢ „Çø „ÉÉ „ÇØ) (in Japan), he is also <b>Twin-Spin Attack</b> in <i>Sonic Generations</i> - this is a special movement first used by Sonic in <i>Sonic the Hedgehog 3</i> .  Jumping and then pressing the jump button in the air again creates a short flash that increases Sonic's attack radius and makes it temporarily invulnerable.  This technique is useful for attacking bosses who are slightly outside the range of attack, and covered with spikes of enemies, such as Orbinaut.  None of the characters, except Sonic, can use this technique. <br><br><img src="https://habrastorage.org/files/0ff/b78/502/0ffb78502ea04bd58dbad06dcca5f468.png"><br>  <b>Orbinaut</b> <br></div></div><br>  However, in a <i>Sonic CD, a</i> player can control a jump made in rotation, as if it were an ordinary jump.  It seems that this is more honest with the player. </div><p>Source: <a href="https://habr.com/ru/post/278373/">https://habr.com/ru/post/278373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278361/index.html">Preparing for the CISA exam. Benefits of Business Continuity</a></li>
<li><a href="../278363/index.html">Alljoyn: embedded view of the developer. Part 3: Porting on MK SAMD21</a></li>
<li><a href="../278365/index.html">Study Jam courses for Android developers started in Kazan</a></li>
<li><a href="../278367/index.html">Red Hat, Revolution R, Elasticsearch, MariaDB, Blockchain-as-a-service and much more is available in the Azure Marketplace</a></li>
<li><a href="../278369/index.html">Again about STL: containers</a></li>
<li><a href="../278377/index.html">Managing ES6 class private data</a></li>
<li><a href="../278383/index.html">Video analytics 2.0 or what have left the objects. Part 1</a></li>
<li><a href="../278387/index.html">ExtJS 6 gallery with touch events</a></li>
<li><a href="../278389/index.html">Lua Micro Apache Framework</a></li>
<li><a href="../278391/index.html">Stack Overflow Architecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>