<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cloud Firestore + Android is easy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, Google released Cloud Firestore. Cloud Firestore is a cloud-based NoSQL database, which Google positions as a replacement for the Rea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cloud Firestore + Android is easy</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/b7/qr/_j/b7qr_jowxs8lo___rp9mfyn_phe.png" width="350" align="left">  Not so long ago, Google released Cloud Firestore.  Cloud Firestore is a cloud-based NoSQL database, which Google positions as a replacement for the Realtime Database.  In this article I want to tell how to start using it. <br><br clear="all"></p><a name="habracut"></a><br><h4 id="vozmozhnosti">  Opportunities </h4><br><p>  Cloud Firestore allows you to store data on a remote server, easily access them and monitor changes in real time.  The <a href="https://firebase.google.com/docs/firestore/rtdb-vs-firestore">documentation</a> has an excellent comparison of Cloud Firestore and Realtime Database. </p><br><h4 id="sozdanie-i-podklyuchenie-k-proektu">  Creation and connection to the project </h4><br><p>  In the Firebase console, select Database and click on Create database.  Next, select the access settings.  For review, we will have enough test mode, but on the prode it is better to approach this issue more seriously.  You can read more about access modes <a href="https://firebase.google.com/docs/firestore/security/get-started">here</a> . </p><br><img src="https://habrastorage.org/webt/l8/sw/cq/l8swcqne5ia2furg-1jonuvci6c.png"><br><p>  To configure the project, we perform the following steps: </p><br><ol><li>  Add Firebase to the project according to the instructions from <a href="https://firebase.google.com/docs/android/setup">here.</a> </li><li> Add dependency to app / build.gradle <br> <code>implementation 'com.google.firebase:firebase-firestore:18.1.0'</code> </li> </ol><br><p>  Now everything is ready. </p><br><p>  To get acquainted with the basic techniques of working with Cloud Firestore, I wrote a simple <a href="https://github.com/LukyanovAnatoliy/CloudFirestoreExample">application</a> .  For it to work, you need to create a project in the Firebase console and add the google-services.json file to the project in Android Studio. </p><br><h4 id="struktura-hraneniya-dannyh">  Data storage structure </h4><br><p>  Firestore uses collections and documents to store data.  A document is an entry that contains any fields.  Documents are combined into collections.  Also, the document may contain nested collections, but on Android it is not supported.  If we draw an analogy with the SQL database, the collection is a table, and the document is an entry in this table.  One collection can contain documents with a different set of fields. </p><br><h4 id="poluchenie-i-zapis-dannyh">  Receive and write data </h4><br><p>  In order to receive all the documents of a collection, the following code is sufficient. </p><br><pre> <code class="kotlin hljs">remoteDB.collection(‚ÄúTasks‚Äù) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() .addOnSuccessListener { querySnapshot -&gt; <span class="hljs-comment"><span class="hljs-comment">//   .   querySnapshot.documents } .addOnFailureListener { exception -&gt; //      } }</span></span></code> </pre> <br><p>  Here we request all documents from the <em>Tasks</em> collection. </p><br><p>  The library allows you to create queries with parameters.  The following code shows how to get documents from the collection by condition </p><br><pre> <code class="kotlin hljs">remoteDB.collection(‚ÄúTasks‚Äù) .whereEqualTo(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, <span class="hljs-string"><span class="hljs-string">"Task1"</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() .addOnSuccessListener { querySnapshot -&gt; <span class="hljs-comment"><span class="hljs-comment">//   .   querySnapshot.documents } .addOnFailureListener { exception -&gt; //      } }</span></span></code> </pre> <br><p>  Here we request all documents from the <em>Tasks</em> collection, in which the <em>title</em> field corresponds to the value of <em>Task1</em> . </p><br><p>  Upon receipt of the documents, they can be immediately converted into our data classes. </p><br><pre> <code class="kotlin hljs">remoteDB.collection(‚ÄúTasks‚Äù) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() .addOnSuccessListener { querySnapshot -&gt; <span class="hljs-comment"><span class="hljs-comment">//   .   querySnapshot.documents val taskList: List&lt;RemoteTask&gt; = querySnapshot.toObjects(RemoteTask::class.java) } .addOnFailureListener { exception -&gt; //      } }</span></span></code> </pre> <br><p>  For recording, you must create a Hashmap with data (where the name of the field acts as a key, and the value of this field as a value) and transfer to the library.  The following code demonstrates this. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> taskData = HashMap&lt;String, Any&gt;() taskData[<span class="hljs-string"><span class="hljs-string">"title"</span></span>] = task.title taskData[<span class="hljs-string"><span class="hljs-string">"created"</span></span>] = Timestamp(task.created.time / <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) remoteDB.collection(<span class="hljs-string"><span class="hljs-string">"Tasks"</span></span>) .add(taskData) .addOnSuccessListener { <span class="hljs-comment"><span class="hljs-comment">//   } .addOnFailureListener { //     }</span></span></code> </pre> <br><p>  In this example, a new document will be created and the Firestore will generate an id for it.  To set your own id you need to do the following. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> taskData = HashMap&lt;String, Any&gt;() taskData[<span class="hljs-string"><span class="hljs-string">"title"</span></span>] = task.title taskData[<span class="hljs-string"><span class="hljs-string">"created"</span></span>] = Timestamp(task.created.time / <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) remoteDB.collection(<span class="hljs-string"><span class="hljs-string">"Tasks"</span></span>) .document(<span class="hljs-string"><span class="hljs-string">"New task"</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(taskData) .addOnSuccessListener { <span class="hljs-comment"><span class="hljs-comment">//   } .addOnFailureListener { //     }</span></span></code> </pre> <br><p>  In this case, if there is no document with id equal to <em>New task</em> , then it will be created, and if it is, then the specified fields will be updated. </p><br><p>  Another option to create / update a document </p><br><pre> <code class="kotlin hljs">remoteDB.collection(<span class="hljs-string"><span class="hljs-string">"Tasks"</span></span>) .document(<span class="hljs-string"><span class="hljs-string">"New task"</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(mapToRemoteTask(task)) .addOnSuccessListener { <span class="hljs-comment"><span class="hljs-comment">//   } .addOnFailureListener { //     }</span></span></code> </pre> <br><h4 id="podpisyvaemsya-na-izmeneniya">  Subscribe to changes </h4><br><p>  Firestore allows you to subscribe to data changes.  You can subscribe to changes in the collection as well as changes to a specific document </p><br><pre> <code class="kotlin hljs">remoteDB.collection(<span class="hljs-string"><span class="hljs-string">"Tasks"</span></span>) .addSnapshotListener { querySnapshot, error -&gt; <span class="hljs-comment"><span class="hljs-comment">// querySnapshot -   // error -  }</span></span></code> </pre> <br><p>  querySnapshot.documents - contains an updated list of all documents <br>  querySnapshot.documentChanges - contains a list of changes.  Each object contains a modified document and a type of change.  3 types of changes are possible. <br>  ADDED - document added, <br>  MODIFIED - the document is changed, <br>  REMOVED - Document deleted </p><br><h4 id="zagruzka-bolshogo-kolichestva-dannyh">  Loading large amounts of data </h4><br><p>  Realtime Database provides a less convenient mechanism for loading large amounts of data, which consists in manually editing a json file and loading it.  Firestore out of the box does not provide anything.  It was very inconvenient to add new documents until I found a way to download a large amount of information as easily as possible.  So that you do not have such problems as mine, I will attach the instructions below on how to quickly and easily load a large amount of data.  The instruction was found on the Internet. </p><br><ol><li>  Install <a href="https://nodejs.org/en/">Node.js and npm</a> </li><li>  Install the firebase-admin package by running the command <br> <code>npm install firebase-admin --save</code> </li> <li>  Generate a json file with collection data.  An example can be found in the <a href="">Tasks.json</a> file <a href="">.</a> </li><li>  To download, we need an access key.  How to get it is well described in this <a href="https://hackernoon.com/filling-cloud-firestore-with-data-3f67d26bd66e">article.</a> </li><li>  In the <a href="">export.js</a> file put down your data <br>  require ('./ firestore_key.json') - file with access key.  I was in the folder with the script <br>  &lt;YOU_DATABASE&gt; - the name of your firestore database <br>  "./json/Tasks.json" - the path to the file in which the data lie <br>  ['created'] - list of field names with type Timestamp </li><li>  Run script <br> <code>node export.js</code> <br>  The script uses the practices of <a href="https://github.com/dalenguyen/firestore-backup-restore">dalenguyen</a> </li></ol><br><h4 id="zaklyuchenie">  Conclusion </h4><br><p>  I used Cloud Firestore in one of my projects and did not experience any serious problems.  One of my collections contains about 15,000 documents and requests for it pass fairly quickly and this is without the use of indexes.  Using Cloud Firestore together with Room and Remote Config, you can significantly reduce the number of calls to the database and not go beyond the free limits.  At a free rate per day you can read 50,000 documents, write 20,000 and remove 20,000. </p><br><div class="spoiler">  <b class="spoiler_title">Gifka application work</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ed/f5/jm/edf5jmqtkoofqkxtomitfduda4w.gif"></p></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/447640/">https://habr.com/ru/post/447640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447630/index.html">SpaceX: launching Falcon Heavy and landing three accelerators, two of them simultaneously [01: 35–ú–°–ö, 12 Apr 2019]</a></li>
<li><a href="../447632/index.html">Bicycle infrastructure in Holland - how does it work?</a></li>
<li><a href="../447634/index.html">Stimulation of electricity leads to a significant improvement in the memory of older people.</a></li>
<li><a href="../447636/index.html">How to be the designer of your life: tips from Bill Burnett, Stanford Design Program Manager and Apple Veteran</a></li>
<li><a href="../447638/index.html">Audiophile smartphone: selection criteria and a few typical representatives of the class</a></li>
<li><a href="../447650/index.html">How to divide the front-end and backend, maintaining mutual understanding</a></li>
<li><a href="../447652/index.html">Weekend design: simple MIDI adapter</a></li>
<li><a href="../447654/index.html">Raspberry-pi-tank and GPS navigation</a></li>
<li><a href="../447656/index.html">The inconstancy of evolution: live birth and egg-laying simultaneously in lizards of the species Saiphos equalis</a></li>
<li><a href="../447658/index.html">Action programming games - fun or a way to introduce children to algorithms and robotics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>