<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple transmission to Google Analytics of form filling error events in Magento (and not only)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I received such a task, there is a site on Magento and the customer wants to monitor form filling errors on the site in Google Analytics (GA). As alwa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple transmission to Google Analytics of form filling error events in Magento (and not only)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/acc/a57/51e/acca5751e232eb57445ba6a27a4d178d.png" alt="image" align="left">  I received such a task, there is a site on Magento and the customer wants to monitor form filling errors on the site in Google Analytics (GA).  As always, the site has both Prototype and jQuery and a bunch of JS noodles as well, in general, everything is as usual.  At first, I made a bulky decision, but then a good idea came to my mind, which I want to share with the community. <br><a name="habracut"></a><br>  By JS noodle, I mean loosely structured third-party JS code on this site.  I will continue to use this term for brevity.  I will not describe the extra details and give all the code, I will summarize my approach, assuming that the reader understands how events work in GA, has basic ideas about Magento and can insert the code where it should be. <br><br>  After analyzing the site, I realized that I was very lucky, because  The style of displaying information on the site remained the same.  My idea is simple: to validate the form fields on the Magento frontend, use the js / prototype / validation.js library (the path from the site root).  If the validator detects an error, it adds the CSS class 'validation-failed' to the DOM element of the form field.  Also this class was added by all validator handlers from JS noodles.  Bingo - this fact can be tracked to send the corresponding event to GA.  Thank God that practically all JS noodles used either the Element.addClassName method from Prototype or the addClass from jQuery and there was very little code using the native JS methods, which I replaced with Element.addClassName. <br><br>  Now it remains only to override these two methods of the Prototype and jQuery libraries to call its checkValidationFailed function to send an event to GA.  Since  The Element.addClassName code in Prototype is very simple, you can simply replace this method, with jQuery it‚Äôs not so easy to work - I had to use ts  "Intermediate" object. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is my code (it is certainly not perfect, but it works): <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.observe(<span class="hljs-string"><span class="hljs-string">'dom:loaded'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Element.addMethods({ <span class="hljs-attr"><span class="hljs-attr">addClassName</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element, className</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(element = $(element))) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Element.hasClassName(element, className)) { element.className += (element.className ? <span class="hljs-string"><span class="hljs-string">' '</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>) + className; } checkValidationFailed(className, element); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element; } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oAddClass = jQuery.fn.addClass; jQuery.fn.addClass = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ checkValidationFailed(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> oAddClass.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkValidationFailed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">className, element</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (className != <span class="hljs-string"><span class="hljs-string">'validation-failed'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> label = <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> element.name != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { label = element.name; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> element.labels != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> element.labels[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> element.labels[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerText != <span class="hljs-string"><span class="hljs-string">'undefined'</span></span> ) { label = label + <span class="hljs-string"><span class="hljs-string">' : '</span></span> + element.labels[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerText; } dataLayer.push({ <span class="hljs-string"><span class="hljs-string">'event'</span></span>: <span class="hljs-string"><span class="hljs-string">'form_error_jsvalidator'</span></span>, <span class="hljs-string"><span class="hljs-string">'error_message'</span></span> : label }); } });</code> </pre> <br>  Since  The site uses Google Tag Manager - a standard dataLayer is used to send messages to GA. <br>  Based on the URL of the page from which the event came and the label variable in the GA report, it is easy to understand on which page and in which field the error occurred - this was enough for my customer, but in principle you can send a bunch of additional information to GA. <br><br>  I think that this approach is suitable not only for Magento, but also for sites on other platforms. </div><p>Source: <a href="https://habr.com/ru/post/216149/">https://habr.com/ru/post/216149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216133/index.html">A game about crazy geek scientists and a little enchanting localization story</a></li>
<li><a href="../216135/index.html">Win 8.1 App using HTML & WinJS</a></li>
<li><a href="../216137/index.html">Students, where are you? You need PostgreSQL!</a></li>
<li><a href="../216141/index.html">Rails 4 Engines. Gem development through mountable engine - we read server logs</a></li>
<li><a href="../216145/index.html">Neuroplasticity - 8 changes in man, formed under the influence of technology</a></li>
<li><a href="../216153/index.html">"Forbid them to ban" or the reverse side of the registry of banned sites</a></li>
<li><a href="../216155/index.html">The realities of working in Smart TV application projects</a></li>
<li><a href="../216157/index.html">Unicorn became interested in the microworld</a></li>
<li><a href="../216159/index.html">Cellular network in Yakutia: what happens to base stations at -60 Celsius</a></li>
<li><a href="../216163/index.html">Sculpting pixel cartoon Simpsons Coach Gag in Excel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>