<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A comprehensive guide to useEffect</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You have written several components using hooks . Perhaps - even created a small application. In general, the result suits you perfectly. You are accu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A comprehensive guide to useEffect</h1><div class="post__text post__text-html js-mediator-article"> You have written several components using <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a> .  Perhaps - even created a small application.  In general, the result suits you perfectly.  You are accustomed to the API and in the process of work you discovered some unobvious useful techniques.  You even created some of <a href="https://reactjs.org/docs/hooks-custom.html">your own hooks</a> and reduced your code by 300 lines, putting into them what was previously represented by repeating fragments of the program.  What you did, you showed colleagues.  ‚ÄúIt worked out great,‚Äù they said about your project. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/445276/"><img src="https://habrastorage.org/webt/bd/vj/e1/bdvje1n-vjzezd47wnphch1wq8a.png"></a> <br>  But sometimes, when you use <code>useEffect</code> , the component parts of software mechanisms do not fit particularly well with each other.  It seems to you that you are missing something.  All this seems to work with class-based component life cycle events ... but is it really? <a name="habracut"></a><br>  Trying to understand what exactly does not suit you, you notice that you are asking yourself the following questions: <br><br><ul><li>  How to play <code>componentDidMount</code> using <code>useEffect</code> ? </li><li>  How to load data inside <code>useEffect</code> ?  What is <code>[]</code> ? </li><li>  Do I need to specify functions as effect dependencies? </li><li>  Why does the program sometimes end up in an endless cycle of reloading data? </li><li>  Why sometimes inside the effects you can see the old state or the old properties? </li></ul><br>  When I first started using hooks, I was also tormented by these questions.  Even when I was preparing the documentation, I could not say that I am proficient in some subtleties.  Since then, I had a few moments when I, having suddenly understood something important, wanted to exclaim: ‚ÄúEureka!‚Äù.  That I realized at these moments I want to tell you.  What you learn now about <code>useEffect</code> will allow you to clearly see the obvious answers to the above questions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But in order to see the answers to these questions, we first need to take a step back.  The purpose of this article is not to give its readers some step-by-step instructions for working with <code>useEffect</code> .  It aims to help you, as they say, to ‚Äú <code>useEffect</code> ‚Äù <code>useEffect</code> .  And, frankly, there is not much to learn.  In fact, most of the time we will spend on forgetting what we knew before. <br><br>  In my head everything came together only after I stopped looking at the <code>useEffect</code> hook through the prism of familiar methods of life cycle components based on classes. <br><br><h3>  "You must forget what you were taught." </h3><br>  <i><a href="https://habr.com/ru/company/ruvds/blog/445276/%25D0%2599%25D0%25BE%25D0%25B4%25D0%25B0">habr.com/ru/company/ruvds/blog/445276/Ioda</a></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c3/9be/fba/8c39befba869c3bae1a6b87c2d2589d1.jpg"></div><br>  It is assumed that the reader of this material is to some extent familiar with the <a href="https://reactjs.org/docs/hooks-effect.html">useEffect</a> API.  This is a fairly long article, it can be compared with a small book.  The fact is that I prefer to express my thoughts that way.  Below, very briefly, are the answers to the questions discussed above.  Perhaps they are useful to those who do not have the time or desire to read all the material. <br><br>  If the format in which we are going to consider <code>useEffect</code> , with all its explanations and examples, is not very suitable for you, you can wait a bit - until the moment when these explanations appear in countless other manuals.  Here is the same story as with the React library itself, which in 2013 was something completely new.  It takes some time for the development community to recognize a new mental model and for learning materials based on this model to appear. <br><br><h2>  <font color="#3AC1EF">Answers on questions</font> </h2><br>  Here are brief answers to the questions posed at the beginning of this material, intended for those who do not want to read all this text.  If, reading these answers, you feel that you do not really understand the meaning of what you read - look through the material.  In the text you will find detailed explanations.  If you are going to read everything - you can skip this section. <br><br><h3>  <font color="#3AC1EF">How do I play componentDidMount using useEffect?</font> </h3><br>  Although the <code>useEffect(fn, [])</code> construct can be used to play the <code>componentDidMount</code> functional, it is not the exact equivalent of <code>componentDidMount</code> .  Namely, it, unlike <code>componentDidMount</code> , captures properties and a state.  Therefore, even inside the callback, you will see the original properties and state.  If you want to see the latest version of something, you can write it in the <code>ref</code> link.  But usually there is a simpler way to structure the code, so it is not necessary to do this.  Remember that the mental effects model is different from the one that applies to <code>componentDidMount</code> and other component lifecycle methods.  Therefore, trying to find exact equivalents may do more harm than good.  In order to work productively, it is necessary, so to speak, to ‚Äúthink by effects‚Äù.  The basis of their mental model is closer to the implementation of synchronization than to responding to component life cycle events. <br><br><h3>  <font color="#3AC1EF">How to properly load data inside useEffect?</font>  <font color="#3AC1EF">What []?</font> </h3><br>  <a href="https://www.robinwieruch.de/react-hooks-fetch-data/">Here is a</a> good guide to loading data using <code>useEffect</code> .  Try to read it entirely!  It is not as big as this.  The brackets, <code>[]</code> , representing an empty array, mean that the effect does not use the values ‚Äã‚Äãinvolved in the React data stream, and for this reason, it can be considered safe to use it once.  In addition, the use of an empty dependency array is a common source of error in the event that some value is actually used in the effect.  You will need to master several strategies (mainly, presented in the form of <code>useReducer</code> and <code>useCallback</code> ), which can help eliminate the need for dependence rather than unjustifiably discarding this dependence. <br><br><h3>  <font color="#3AC1EF">‚ñçDo you need to specify functions as effect dependencies?</font> </h3><br>  It is recommended to move functions beyond the limits of the components that do not need properties or in the state, and those functions that are used only by the effects are recommended to be placed inside the effects.  If after this your effect still uses functions that are in the scope of the render (including functions from properties), wrap them in <code>useCallback</code> where they are declared, and try again to use them.  Why is it important?  Functions can "see" values ‚Äã‚Äãfrom properties and states, so they participate in the data stream.  <a href="https://reactjs.org/docs/hooks-faq.html">Here are</a> more details about this in our FAQ. <br><br><h3>  <font color="#3AC1EF">‚ñçWhy does a program sometimes end up in an endless loop of reloading data?</font> </h3><br>  This can occur when the data is loaded in an effect that does not have a second argument representing the dependencies.  Without it, the effects are executed after each rendering operation - and this means that setting the state will result in the re-invoking of such effects.  An infinite loop can occur even if a value is specified in the dependency array, which always changes.  Find out - what is the value possible, removing the dependencies one by one.  However, removing dependencies (or recklessly using <code>[]</code> ) is usually the wrong approach to solving a problem.  Instead, it‚Äôs worth finding the source of the problem and really solving it.  For example, functions may cause a similar problem.  You can help solve it by placing them in effects, moving them outside the components, or wrapping them in <code>useCallback</code> .  In order to avoid creating multiple objects, you can use <code>useMemo</code> . <br><br><h3>  <font color="#3AC1EF">‚ñçWhy does the old state sometimes appear inside the effects or do the old properties occur?</font> </h3><br>  Effects always ‚Äúsee‚Äù the properties and state of the render in which they are declared.  This helps to <a href="https://overreacted.io/how-are-function-components-different-from-classes/">prevent errors</a> , but in some cases may interfere with the normal operation of the component.  In such cases, you can explicitly use mutable <code>ref</code> references to work with such values ‚Äã‚Äã(you can read about it at the end of the above article).  If you think that you see properties or state from the old render, but do not expect it, then you may have missed some dependencies.  To get used to seeing them, use <a href="https://github.com/facebook/react/issues/14920">this</a> linter rule.  After a couple of days, it will become something like your second nature.  Also, take a look at <a href="https://reactjs.org/docs/hooks-faq.html">this</a> answer in our FAQ. <br><br>  I hope these answers to questions turned out to be useful to those who read them.  Now let's talk more about <code>useEffect</code> . <br><br><h2>  <font color="#3AC1EF">Each render has its own properties and state</font> </h2><br>  Before we can discuss the effects, we need to talk about rendering. <br><br>  Here is the functional counter component. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>  Look carefully at the line <code>&lt;p&gt;You clicked {count} times&lt;/p&gt;</code> .  What does it mean?  Does the <code>count</code> constant ‚Äúobserve‚Äù somehow for changes in the state and is it updated automatically?  Such a conclusion can be considered something of a valuable first idea of ‚Äã‚Äãsomeone who studies React, but it is not an <a href="https://overreacted.io/react-as-a-ui-runtime/">exact mental model of</a> what is happening. <br><br>  In our example, <code>count</code> is just a number.  This is not some kind of magical "data binding", not some kind of "observer object" or "proxy", or anything else.  Before us is a good old number, like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> count = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ...</span></span></code> </pre> <br>  At the time of the first component output, the <code>count</code> value obtained from <code>useState()</code> is 0. When we call <code>setCount(1)</code> , React calls the component again.  This time the <code>count</code> will be 1. And so on: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { const count = 0; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... } //       function Counter() { const count = 1; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... } //        function Counter() { const count = 2; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... }</span></span></code> </pre> <br>  React calls a component whenever we update a state.  As a result, each rendering operation ‚Äúsees‚Äù the eigenvalue of the <code>counter</code> state, which, inside the function, is a constant. <br><br>  As a result, this line does not perform any special data binding operation: <br><br><pre> <code class="javascript hljs">&lt;p&gt;You clicked {count} times&lt;<span class="hljs-regexp"><span class="hljs-regexp">/p&gt;</span></span></code> </pre> <br>  It only embeds a numeric value in the code generated during rendering.  This number is provided by React.  When we call <code>setCount</code> , React again calls a component with a different <code>count</code> value.  Then, React updates the DOM so that the document object model matches the most recent data that was rendered during component rendering. <br><br>  The most important conclusion that can be made from this is that <code>count</code> is a constant within any particular render and does not change over time.  The component that is called over and over is changing.  Each render ‚Äúsees‚Äù its own <code>count</code> value, which is isolated for each rendering operation. <br><br>  In <a href="https://overreacted.io/react-as-a-ui-runtime/">this</a> article you can find details about this process. <br><br><h2>  <font color="#3AC1EF">Each render has its own event handlers.</font> </h2><br>  So far, everything is clear.  And what about event handlers? <br>  Take a look at this example.  Here, three seconds after pressing the button, a message box appears with information about the value stored in the <code>count</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleAlertClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     alert(<span class="hljs-string"><span class="hljs-string">'You clicked on: '</span></span> + count);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;     &lt;button onClick={handleAlertClick}&gt;       Show alert     &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/button&gt;   &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">div&gt; </span></span></span><span class="hljs-function">); }</span></span></code> </pre> <br>  Suppose I perform the following sequence of actions: <br><br><ul><li>  I‚Äôll bring <code>count</code> to 3 by clicking the <code>Click me</code> button. </li><li>  Click the <code>Show alert</code> button. </li><li>  Increase the value to 5 before the timeout expires. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/46c/55d/5f1/46c55d5f1f749462b7a173f1e748e41e.gif"></div><br>  <i><font color="#999999">Increasing the count value after clicking the Show alert button</font></i> <br><br>  What do you think will be displayed in the message box?  Will 5 be displayed there, which corresponds to the <code>count</code> value at the moment the timer is triggered, or 3 - that is, the <code>count</code> value at the moment the button is pressed? <br><br>  Now you will know the answer to this question, but if you want to find out everything yourself - <a href="https://codesandbox.io/s/w2wxl3yo0l">here is the</a> working version of this example. <br><br>  If what you see seems incomprehensible to you, here is an example that is closer to reality.  Imagine a chat application in which, in the state, the <code>ID</code> current recipient of the message is stored, and there is a <code>Send</code> button.  In <a href="https://overreacted.io/how-are-function-components-different-from-classes/">this</a> material, what is happening is discussed in detail.  In fact, the correct answer to the question of what appears in the message box is 3. <br><br>  The mechanism for displaying the message box "captured" state at the moment of clicking the button. <br><br>  There are ways to implement another variant of behavior, but for the time being we will deal with the standard behavior of the system.  When building mental models of technology, it is important to distinguish the ‚Äúpath of least resistance‚Äù from all ‚Äúemergency exits‚Äù. <br><br>  How does all this work? <br><br>  We have already said that the <code>count</code> value is a constant for each specific call to our function.  I think it is worthwhile to dwell on this.  The point is that our function is called many times (once for each rendering operation), but for each of these calls, the <code>count</code> inside it is a constant.  This constant is set to some specific value (representing the state of a specific rendering operation). <br><br>  This behavior of functions is not something special for React - regular functions behave in a similar way: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">person</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = person.name; setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name); }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Dan'</span></span>}; sayHi(someone); someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Yuzhi'</span></span>}; sayHi(someone); someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Dominic'</span></span>}; sayHi(someone);</code> </pre> <br>  In <a href="https://codesandbox.io/s/mm6ww11lk8">this</a> example, the external variable <code>someone</code> reassigned several times.  The same can happen somewhere inside React, the current state of the component may vary.  However, inside the <code>sayHi</code> function there is a local constant <code>name</code> that is associated with a <code>person</code> from a particular call.  This constant is local, so its values ‚Äã‚Äãin different function calls are isolated from each other!  As a result, after a timeout, each displayed message box ‚Äúremembers‚Äù its own <code>name</code> value. <br><br>  This explains how our event handler captures the <code>count</code> value when it clicks a button.  If we, working with components, apply the same principle, then it turns out that each render "sees" its own <code>count</code> value: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { const count = 0; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... } //       function Counter() { const count = 1; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... } //        function Counter() { const count = 2; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... }</span></span></code> </pre> <br>  As a result, each render, in fact, returns its own "version" of <code>handleAlertClick</code> .  Each of these versions "remembers" its own <code>count</code> value: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 0);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   0 // ... } //       function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 1);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   1 // ... } //        function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 2);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   2 // ... }</span></span></code> </pre> <br>  That is why, in <a href="https://codesandbox.io/s/w2wxl3yo0l">this</a> example, event handlers "belong" to specific renders, and when you click a button, the component uses the <code>count</code> state from these renders. <br><br>  Inside each particular renderer, the properties and state always remain the same.  But if different properties of rendering use their own properties and state, the same happens with any mechanisms that use them (including event handlers).  They also "belong" to specific renders.  Therefore, even asynchronous functions inside event handlers will ‚Äúsee‚Äù the same <code>count</code> values. <br><br>  It should be noted that in the above example, I embedded concrete <code>count</code> values ‚Äã‚Äãdirectly into the <code>handleAlertClick</code> functions.  This ‚Äúmental‚Äù substitution does not hurt us, since the constant <code>count</code> cannot change within a particular render.  First, it is a constant, in the second - it is a number.  It is safe to say that it is also possible to reflect on other values, such as objects, but only if we accept the rule not to make changes (mutations) of the state.  In this case, we are satisfied with the call to <code>setSomething(newObj)</code> with a new object instead of changing the existing one, since with this approach the state belonging to the previous renderer is intact. <br><br><h2>  <font color="#3AC1EF">Each render has its own effects.</font> </h2><br>  This material, as you know, is about effects, but we haven‚Äôt even talked about them yet.  Now we fix it.  As it turns out, working with effects is not particularly different from what we have already figured out. <br><br>  Consider <a href="https://reactjs.org/docs/hooks-effect.html">an example</a> from the documentation, which is very similar to the one we have already reviewed: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string"> times`</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>  Now I have a question for you.  How does the effect read the most recent <code>count</code> value? <br><br>  Maybe, some ‚Äúdata binding‚Äù or ‚Äúobserver object‚Äù is used here, which updates the <code>count</code> value inside the effect function?  Maybe <code>count</code> is a mutable variable, the value of which React sets inside our component, as a result of which the effect always sees its latest version? <br><br>  Not. <br><br>  We already know that in the rendering of a specific component, <code>count</code> is a constant.  Even event handlers "see" the <code>count</code> value from the render to which they "belong" because <code>count</code> is a constant that is in a certain scope.  The same is true for effects! <br><br>  And it should be noted that this is not a variable <code>count</code> some way changing inside the "unchanged" effect.  Before us is the effect function itself, which is different in each rendering operation. <br><br>  Each version ‚Äúsees‚Äù the <code>count</code> value from the render to which it ‚Äúbelongs‚Äù: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${0} times`;   } ); // ... } //       function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${1} times`;   } ); // ... } //        function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${2} times`;   } ); // .. }</span></span></code> </pre> <br> React     ,       DOM       . <br><br>  ,          (  ), ,   ,   ,     ¬´¬ª      ,   ¬´¬ª. <br><br> , ,       . <br><br>  ,    ( ,    <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/"> </a>            ).    ,     ,        ,   . <br><br>      ,       ,        : <br><br> React: <br><br><ul><li>      ,      0. </li></ul><br>  Component: <br><br><ul><li>   : <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code> . </li><li>  ,       ,   : <code>() =&gt; { document.title = 'You clicked 0 times' }</code> . </li></ul><br> React: <br><br><ul><li>  Of course.  . , ,   -  DOM. </li></ul><br> : <br><br><ul><li> ,     . </li></ul><br> React: <br><br><ul><li> ,    ,    . </li><li>  <code>() =&gt; { document.title = 'You clicked 0 times' }</code> . </li></ul><br>     ,      .   ,     ,  -   : <br><br>  Component: <br><br><ul><li> , React,     1. </li></ul><br> React: <br><br><ul><li>      ,      1. </li></ul><br>  Component: <br><br><ul><li>   : <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code> . </li><li>  ,       ,   : <code>() =&gt; { document.title = 'You clicked 1 times' }</code> . </li></ul><br> React: <br><br><ul><li>  Of course.  . , ,   -  DOM. </li></ul><br> : <br><br><ul><li> ,     . </li></ul><br> React: <br><br><ul><li> ,    ,    . </li><li>  <code>() =&gt; { document.title = 'You clicked 1 times' }</code> . </li></ul><br><h2> <font color="#3AC1EF">  ‚Ä¶ </font> </h2><br>     ,  ,     ,     ,  ¬´¬ª       . <br><br>    .  Consider the following code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string"> times`</span></span>);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>        ,       ? <br><br>  ,       . ,    ,    ,       .  But it is not so!    ,    ,      , ,  ,    <code>count</code> .    <a href="https://codesandbox.io/s/lyx20m1ol"> </a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/27d/333/a5727d333c270e05942f508707265378.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>    : ¬´,     !         ?¬ª. <br><br> ,   , <code>this.setState</code>  ,   ,   .    ,  ,  <a href="https://codesandbox.io/s/kkymzwjqz3"> </a> ,    ,   ,  : <br><br><pre> <code class="javascript hljs">  componentDidUpdate() {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.state.count}</span></span></span><span class="hljs-string"> times`</span></span>);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }</code> </pre> <br>   ,  <code>this.state.count</code>       <code>count</code> ,    ,   .  ,      , ,     5 ,  5  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/264/b32/9ed/264b329edc111a1973003bdf2bcacd65.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>     ,       JavaScript-,  ,   ,    <a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/"></a> ,    ,      <code>setTimeout</code> ,      .   ,          (React   <code>this.state</code>    ,          ),    . <br><br>  ‚Äî      ,  ,  ¬´¬ª  ,   .        ,  ,  ,    . ,    ,         . , ,   ,    ,   ,  ,  <a href="https://codesandbox.io/s/w7vjo07055"></a> . <br><br><h2> <font color="#3AC1EF">  </font> </h2><br>    ,        (  , , -   API  )      ,   . <br><br>      : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(props.counter);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); <span class="hljs-comment"><span class="hljs-comment">// ... } function Example(props) { const counter = props.counter; useEffect(() =&gt; {   setTimeout(() =&gt; {     console.log(counter);   }, 1000); }); // ... }</span></span></code> </pre> <br>   ,     ¬´¬ª     .   !           .  ,       . <br><br> , ,  - ,   ,     ,   ,   .    ,   <code>ref</code> ,        <a href="https://overreacted.io/how-are-function-components-different-from-classes/"></a> . <br><br>  ,           ,     ,  ,  ,    .  ,    (    ),   ¬´¬ª         React-.       ,       ,         .       ,    . <br><br> <a href="https://codesandbox.io/s/rm7z22qnlp"></a>      ,   ,      ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> latestCount = useRef(count); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-comment"><span class="hljs-comment">//        count   latestCount.current = count;   setTimeout(() =&gt; {     //            console.log(`You clicked ${latestCount.current} times`);   }, 3000); }); // ...</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78f/794/826/78f7948263dd13b023498b23cb99f4fc.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>   -  React    .     React   <code>this.state</code>  .         ,      ,   <code>latestCount.current</code>         .  ,       .        ,   ,   ,    . <br><br><h2> <font color="#3AC1EF">  ?</font> </h2><br>    ,      .  ,      ,  ¬´¬ª         . <br><br>   : <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);   }; });</code> </pre> <br> , <code>props</code> ‚Äî   <code>{id: 10}</code>    ,  <code>{id: 20}</code> ‚Äî  .  ,     : <br><br><ul><li> React     <code>{id: 10}</code> . </li><li> React    <code>{id: 20}</code> . </li><li> React    <code>{id: 20}</code> . </li></ul><br> ( ,   ,   .) <br><br>      ,    ¬´¬ª   - ,      ,     ¬´¬ª   - ,      .  ‚Äî  ,       ,   ,        .     . <br><br> React    <a href="https://medium.com/%40dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f"> </a> ,       .   ,         .    .            .        : <br><br><ul><li> React    <code>{id: 20}</code> . </li><li>     .     <code>{id: 20}</code> . </li><li> React     <code>{id: 10}</code> . </li><li> React    <code>{id: 20}</code> . </li></ul><br>       ,          ¬´¬ª  <code>props</code> ,  <code>{id: 10}</code> ,  ,   <code>props</code>  <code>{id: 20}</code> . <br><br>  ,     ‚Ä¶ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fe/238/cf0/5fe238cf03a21dfa32af624124fcdcff.gif"></div><br> <i><font color="#999999">   ‚Äî    ?</font></i> <br><br>     : ¬´      (  , , -   API  )      ,   ¬ª. <br><br>   !         ¬´ ¬ª ,     .    ,   ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,  props  {id: 10} function Example() { // ... useEffect(   //       () =&gt; {     ChatAPI.subscribeToFriendStatus(10, handleStatusChange);     //           return () =&gt; {       ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);     };   } ); // ... } //  ,  props  {id: 20} function Example() { // ... useEffect(   //       () =&gt; {     ChatAPI.subscribeToFriendStatus(20, handleStatusChange);     //           return () =&gt; {       ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);     };   } ); // ... }</span></span></code> </pre> <br>       ,        ,   ‚Ä¶     ,  ¬´¬ª      ,   -,   <code>{id: 10}</code> . <br><br>    React         . ,      ,    .       <code>props</code> ,    . <br><br><h2> <font color="#3AC1EF">,    </font> </h2><br>      React  ,           .  <a href="https://overreacted.io/the-bug-o-notation/"> </a> . <br><br> ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Greeting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     Hello, {name}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>     ,     <code>&lt;Greeting name="Dan" /&gt;</code> ,   ‚Äî <code>&lt;Greeting name="Yuzhi" /&gt;</code> ,       <code>&lt;Greeting name="Yuzhi" /&gt;</code> .             <code>Hello, Yuzhi</code> . <br><br> ,   ,   .    React,     .   ,   ,     .         <code>$.addClass</code>  <code>$.removeClass</code>  jQuery- ( ‚Äî ,    ¬´¬ª),   ,    CSS-  React (  ‚Äî ,    ¬´¬ª). <br><br> React  DOM  ,       .      ¬´¬ª  ¬´¬ª. <br><br>       .  <code>useEffect</code>   ,     React,    . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Greeting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     Hello, {name}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>       <code>useEffect</code>    ,     ,    .     ,    -    ,      !      ,      ¬´¬ª,    ¬´¬ª. <br><br>      ,         <code>A</code> ,   <code>B</code> ,   ‚Äî   <code>C</code> ,   ,         <code>C</code> .               (,    - ),         . <br><br>  , , ,             . (         ). <br><br>  How to deal with it? <br><br><h2> <font color="#3AC1EF"> React  </font> </h2><br>    React     DOM.     DOM      , React     DOM,  - . <br><br> ,     : <br><br><pre> <code class="javascript hljs">&lt;h1 className=<span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>&gt; Hello, Dan &lt;<span class="hljs-regexp"><span class="hljs-regexp">/h1&gt;</span></span></code> </pre> <br>       : <br><br><pre> <code class="javascript hljs">&lt;h1 className=<span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>&gt; Hello, Yuzhi &lt;<span class="hljs-regexp"><span class="hljs-regexp">/h1&gt;</span></span></code> </pre> <br> React   : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldProps = {<span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'Greeting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newProps = {<span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'Greeting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello, Yuzhi'</span></span>};</code> </pre> <br> React      ,   <code>children</code> ,        DOM.   ,  <code>className</code>  .     : <br><br><pre> <code class="javascript hljs">domNode.innerText = <span class="hljs-string"><span class="hljs-string">'Hello, Yuzhi'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// domNode.className   </span></span></code> </pre> <br>     -     ?    ,           ,      . <br><br> , ,     -  : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [counter, setCounter] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;h1 className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Greeting"</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;     Hello, {name}     &lt;button onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> setCounter(counter + <span class="hljs-number"><span class="hljs-number">1</span></span>)}&gt;       Increment     &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;   &lt;/</span></span>h1&gt; ); }</code> </pre> <br>      <code>counter</code>  .   <code>document.title</code>   <code>name</code> ,   <code>name</code>   .  <code>document.title</code>    <code>counter</code>  ,   . <br><br>   React ‚Ä¶  ? <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> oldEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-comment"><span class="hljs-comment">//   React  ,        ?</span></span></code> </pre> <br>  Not really. React     ,    ,   . (     .       <code>name</code> .) <br><br>  ,      ,      (    <code>deps</code> ),    <code>useEffect</code> : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, [name]); <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre> <br>    ,      React: ¬´,  ,        ,   ,      <code>name</code>       ¬ª. <br><br>   ,        ,       React     : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldDeps = [<span class="hljs-string"><span class="hljs-string">'Dan'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newDeps = [<span class="hljs-string"><span class="hljs-string">'Dan'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// React     ,     . //      ,     .</span></span></code> </pre> <br>          ,    ,         !       -  -     . <br><br><h2> <font color="#3AC1EF">  React  </font> </h2><br>    React    ‚Äî     .  ,   ,      ,    ,    <code>useEffect</code> ,        ,   ,   . (      !) <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-comment"><span class="hljs-comment">// ... } useEffect(() =&gt; {   fetchData(); }, []); //   ?  .      . // ... }</span></span></code> </pre> <br> <a href="https://reactjs.org/docs/hooks-faq.html">FAQ  </a>     ,     .      . <br><br> ¬´       !¬ª, ‚Äî  .  :    ,          ,   .   , , ,   ‚Äî ,       . <br><br> ,    ,   . ,  ,       ,   ,     .       ,    .    . <br><br> ,      ,      . <br><br><h2> <font color="#3AC1EF">    ,    React</font> </h2><br>      ,  ,  React   ,     . <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, [name]);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fae/247/cd0/fae247cd068eedbd4b62ba50592d2b3d.gif"></div><br> <i><font color="#999999">    ‚Äî  </font></i> <br><br>       ,   ,  , <code>[]</code> , ,   ,   ,    : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, []); <span class="hljs-comment"><span class="hljs-comment">// :    name</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25f/75d/b3f/25f75db3f9f57ffe1426912093577445.gif"></div><br> <i><font color="#999999">   ‚Äî    </font></i> <br><br>          .       ,    ¬´¬ª ,    ,   . <br><br> , ,   ,    .      ,      : ¬´   <code>setInterval</code>        <code>clearInterval</code>   ¬ª. <a href="https://codesandbox.io/s/n5mjzjy9kl"></a>    .  ,  ,   ,   <code>useEffect</code> ,  , ,     <code>[]</code> . -      , ? <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{count}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; }</code> </pre> <br> ,  ,       <a href="https://codesandbox.io/s/91n5z8jo7r"> </a> . <br><br>       ,     ¬´     ,      ¬ª,         .   ,       ,      ,  <code>setInterval</code> ,  .      ,  ? <br><br>      ,   ‚Äî     React   ,       ,        .  ,   <code>count</code> ,     React   , ,    ,  .        ‚Äî   . <br><br>     <code>count</code>  0.   <code>setCount(count + 1)</code>      <code>setCount(0 + 1)</code> .         ,   ‚Äî    <code>[]</code> ,     <code>setCount(0 + 1)</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,   0 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(0 + 1); //  setCount(1)     }, 1000);     return () =&gt; clearInterval(id);   },   [] //    ); // ... } //       1 function Counter() { // ... useEffect(   //     - ,    //   React  ,   .   () =&gt; {     const id = setInterval(() =&gt; {       setCount(1 + 1);     }, 1000);     return () =&gt; clearInterval(id);   },   [] ); // ... }</span></span></code> </pre> <br>   React,   ,         ,     ‚Äî . <br><br>    <code>count</code> ‚Äî ,    (   ): <br><br><pre> <code class="javascript hljs">  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> count = <span class="hljs-comment"><span class="hljs-comment">// ... useEffect(() =&gt; {   const id = setInterval(() =&gt; {     setCount(count + 1);   }, 1000);   return () =&gt; clearInterval(id); }, []);</span></span></code> </pre> <br>            . React        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29e/53b/d0c/29e53bd0c9b7d2ac70d3cd924886b030.gif"></div><br> <i><font color="#999999">  ,     </font></i> <br><br>        .       ,    ,  React       ,   ,     .           ‚Äî   <a href="https://github.com/facebook/react/issues/14920">-</a>      . <br><br><h2> <font color="#3AC1EF">       </font> </h2><br>       React   ,      .     ,  ,    ,   . <br><br>       ,      ,   ,    .     <code>count</code> : <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [count]);</code> </pre> <br>    . ,    ,   ‚Äî  ,    .   <code>count</code>    ,         <code>count</code>   ,   <code>setCount(count + 1)</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,   0 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(0 + 1); // setCount(count + 1)     }, 1000);     return () =&gt; clearInterval(id);   },   [0] // [count] ); // ... } //  ,   1 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(1 + 1); // setCount(count + 1)     }, 1000);     return () =&gt; clearInterval(id);   },   [1] // [count] ); // ... }</span></span></code> </pre> <br>     ,  <code>setInterval</code> ,    <code>count</code> ,    . ,    . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/573/427/1dd/5734271ddfa94d2d65ac6160515e0069.gif"></div><br> <i><font color="#999999"> ,    </font></i> <br><br>         ,      ,   ,   .       ‚Äî      ,       . <br><br>       . <br><br><h2> <font color="#3AC1EF">  </font> </h2><br> ,      <code>count</code>  . <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [count]);</code> </pre> <br>     ,    ,     <code>count</code> .   ,    <code>count</code>    <code>setCount</code> .    ,   ,     <code>count</code>   .     ,    ,    <a href="https://reactjs.org/docs/hooks-reference.html">  </a> <code>setState</code> : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []);</code> </pre> <br>       ¬´ ¬ª. ,  <code>count</code>    - ,       <code>setCount(count + 1)</code> .  <code>count</code>  -    ,      <code>count + 1</code>  ¬´¬ª  React.  React      <code>count</code> . ,     React ‚Äî    ,    ,    ,    . <br><br>       <code>setCount(c =&gt; c + 1)</code> .     ¬´ React ¬ª,  ,    .  ¬´ ¬ª      , ,   <a href="https://overreacted.io/react-as-a-ui-runtime/">  </a> . <br><br>    ,  ,   ,   .       React.        <code>count</code>    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f12/8ad/20c/f128ad20c28317ed27a3cb68197fc906.gif"></div><br> <i><font color="#999999">  ,     </font></i> <br><br>     <a href="https://codesandbox.io/s/q3181xz1pj"></a> . <br><br>        ,  <code>setInterval</code> ,    ,      <code>c =&gt; c + 1</code>    .       <code>count</code> . React    . <br><br><h2> <font color="#3AC1EF">   Google Docs</font> </h2><br> ,     ,   ‚Äî     ?      ,   ,  ¬´¬ª,   ,       . ,    Google Docs        .      .       ,    . <br><br>       ,      .             .      ,    <code>setCount(c =&gt; c + 1)</code> ,       ,     <code>setCount(count + 1)</code> ,        ¬´¬ª   <code>count</code> .    ,    (  ‚Äî ¬´¬ª). ¬´   React¬ª ‚Äî   <a href="https://reactjs.org/docs/thinking-in-react.html">   </a> .        . <br><br>     (     )   ,  Google Docs <a href="https://medium.com/%40srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682"></a>    .   ‚Äî     ,     React  .    ,  ,     ( ,  ,   )         . <br><br>   ,     <code>setCount(c =&gt; c + 1)</code> ,   .    ,       . ,       ,      ,      ,  ,         .    <code>setCount(c =&gt; c + 1)</code>     .   <code>useReducer</code> . <br><br><h2> <font color="#3AC1EF">   </font> </h2><br>     ,       : <code>count</code>  <code>step</code> .  <code>setInterval</code>     ,   <code>step</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [step, setStep] = useState(<span class="hljs-number"><span class="hljs-number">1</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c + step);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [step]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   &lt;&gt;     &lt;h1&gt;{count}&lt;/h1&gt;     &lt;input value={step} onChange={e =&gt; setStep(Number(e.target.value))} /&gt;   &lt;/&gt; ); }</code> </pre> <br> <a href="https://codesandbox.io/s/zxn70rnkx"></a>    . <br><br>    ,    React  .       <code>step</code> ,     .      . <br><br>     :  <code>step</code>  <code>setInterval</code> ‚Äî   <code>step</code>     . ,   ,   ,   !     ,   ,         ,  ,       ,    . <br><br>   ,   ,  ,    <code>setInterval</code> ,      <code>step</code> .    <code>step</code>  ? <br><br>            , ,         <code>useReducer</code> . <br><br>   ,     <code>setSomething(something =&gt; ...)</code> ,  ,           .     ¬´¬ª,    ,  ,       . <br><br>     <code>step</code>   <code>dispatch</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = useReducer(reducer, initialState); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { count, step } = state; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'tick'</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//  setCount(c =&gt; c + step); }, 1000); return () =&gt; clearInterval(id); }, [dispatch]);</span></span></code> </pre> <br> <a href="https://codesandbox.io/s/xzr480k0np"></a>      . <br><br>     : ¬´    ,  ?¬ª.    ,  React  ,   <code>dispatch</code>       .           . <br><br>   ! <br><br> (    <code>dispatch</code>  <code>setstate</code>      <code>useRef</code>      ,   React  ,    .     ‚Äî    .) <br><br>  ,     ,   ,     ,  .          <code>step</code> .    ,     .      ,  .      : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">step</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { count, step } = state; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'tick'</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: count + step, step }; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'step'</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { count, <span class="hljs-attr"><span class="hljs-attr">step</span></span>: action.step }; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); } }</code> </pre> <br> <a href="https://codesandbox.io/s/xzr480k0np"></a> ,   ,      ,    . <br><br><h2> <font color="#3AC1EF"> useReducer ‚Äî  - </font> </h2><br>    ,       ,       ,          .    ,     ,  ? , ,  API   <code>&lt;Counter step={1} /&gt;</code> . ,       <code>props.step</code>    ? <br><br>   ,        !     ,      : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ step }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, dispatch] = useReducer(reducer, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'tick'</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state + step;   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>();   } } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'tick'</span></span> });   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [dispatch]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{count}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; }</code> </pre> <br>      ,      . ,   ,  ,   ,       . <a href="https://codesandbox.io/s/7ypm405o8q"></a>  . <br><br>        <code>dispatch</code>    .  ,  ,     .       . <br><br> ,      ,      .   ¬´¬ª  ,    ,    ?    ,     <code>dispatch</code> , React   .        .                . <br><br>       <code>useReducer</code>    ¬´-¬ª .         ,  . ,   ,           ,  ,  . <br><br><h2> <font color="#3AC1EF">   </font> </h2><br>         ,    - ,        . <br><br> ,  ,  ,  : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [data, setData] = useState({ <span class="hljs-attr"><span class="hljs-attr">hits</span></span>: [] }); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios(     <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query=react'</span></span>,   );   setData(result.data); } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   fetchData(); }, []); <span class="hljs-comment"><span class="hljs-comment">//   ? // ...</span></span></code> </pre><br> <a href="https://codesandbox.io/s/8j4ykjyv0"></a>     <a href="https://www.robinwieruch.de/react-hooks-fetch-data/"></a>  ,      . <br><br>   ,  ,      .  ,   ,         ,   , ,    ,    ,       ,    . <br><br> ,       ,   ,    ,       : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       function getFetchUrl() {   return 'https://hn.algolia.com/api/v1/search?query=react'; } // ,        async function fetchData() {   const result = await axios(getFetchUrl());   setData(result.data); } useEffect(() =&gt; {   fetchData(); }, []); // ... }</span></span></code> </pre> <br>  , ,                : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,       function getFetchUrl() {   return 'https://hn.algolia.com/api/v1/search?query=' + query; } // ,        async function fetchData() {   const result = await axios(getFetchUrl());   setData(result.data); } useEffect(() =&gt; {   fetchData(); }, []); // ... }</span></span></code> </pre> <br>       ,    (,     ),         .     . <br><br>  ,      .        ,        : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... useEffect(() =&gt; {   //      !   function getFetchUrl() {     return 'https://hn.algolia.com/api/v1/search?query=react';   }   async function fetchData() {     const result = await axios(getFetchUrl());     setData(result.data);   }   fetchData(); }, []); //    . // ... }</span></span></code> </pre> <br> <a href="https://codesandbox.io/s/04kp3jwwql"></a>    . <br><br>          ?   ,           ¬´ ¬ª.       React,    -          . <br><br>      <code>getFetchUrl</code> ,      <code>query</code> ,  ,  , ,     .   ‚Äî  ,  <code>query</code>     : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFetchUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + query;   }   <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios(getFetchUrl());     setData(result.data);   }   fetchData(); }, [query]); <span class="hljs-comment"><span class="hljs-comment">//    . // ... }</span></span></code> </pre> <br> <a href="https://codesandbox.io/s/pwm32zx7z7"></a>    . <br><br>   ,    ¬´ React¬ª.        <code>query</code> . ,   ,    ,             ,     .   ,         ,     . <br><br>    <code>exhaustive-deps</code>   <code>eslint-plugin-react-hooks</code>  <a href="https://github.com/facebook/react/issues/14920">  </a>       ,   .  ,      ,         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04a/90d/cba/04a90dcbacb01105d634964880ebed19.gif"></div><br> <i><font color="#999999">  </font></i> <br><br>  It is very convenient. <br><br><h2> <font color="#3AC1EF"> ,      ?</font> </h2><br>        . ,               ,         . , ,      . <br><br>          ?  ,  . :     React  .       .         ,  ¬´   ¬ª. ,    ,    .   , ,   ,     ! <br><br> ,    ,  . ,      <code>getFetchUrl</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFetchUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + query; } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = getFetchUrl(<span class="hljs-string"><span class="hljs-string">'react'</span></span>);   <span class="hljs-comment"><span class="hljs-comment">// ...    -   ... }, []); //  : getFetchUrl useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, []); //  : getFetchUrl // ... }</span></span></code> </pre> <br>      <code>getFetchUrl</code>     ‚Äî   ,           . <br><br>   ,   ¬´¬ª   ,    .        <code>getFetchUrl</code> (,    ,   ),    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       function getFetchUrl(query) {   return 'https://hn.algolia.com/api/v1/search?query=' + query; } useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -    ... }, [getFetchUrl]); //   ,     . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, [getFetchUrl]); //   ,     . // ... }</span></span></code> </pre> <br>      ,    <code>getFetchUrl</code>   .    ,   ‚Äî  . -      ,       ,     .      ,     ,    ,    . <br><br>   ‚Äî        . <br><br>  ,         ,           : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        function getFetchUrl(query) { return 'https://hn.algolia.com/api/v1/search?query=' + query; } function SearchResults() { useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -   ... }, []); //     . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, []); //     . // ... }</span></span></code> </pre> <br>        ,                 .    ,  ,      . <br><br>       .    ,       <a href="https://reactjs.org/docs/hooks-reference.html">useCallback</a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,   const getFetchUrl = useCallback((query) =&gt; {   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, []);  //      . useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -   ... }, [getFetchUrl]); //      . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, [getFetchUrl]); //       // ... }</span></span></code> </pre> <br>  <code>useCallback</code>         .             :  ,   -,   ,      ,   . <br><br>       ,    .          ( <code>'react'</code>  <code>'redux'</code> ).  ,        ,         ,    <code>query</code> .  ,  ,   <code>query</code>    , <code>getFetchUrl</code>       . <br><br>   ,       <code>query</code>  <code>useCallback</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getFetchUrl = useCallback(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   query   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, []); //  : query // ... }</span></span></code> </pre> <br>    <code>useCallback</code>      <code>query</code> ,   ,     <code>getFetchUrl</code> ,      <code>query</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      query const getFetchUrl = useCallback(() =&gt; {   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, [query]);  //    . useEffect(() =&gt; {   const url = getFetchUrl();   // ...    -   ... }, [getFetchUrl]); //    . // ... }</span></span></code> </pre> <br>   <code>useCallback</code> ,  <code>query</code>  ,   <code>getFetchUrl</code>  ,  ,     .   <code>query</code> ,    <code>getFetchUrl</code> ,      .      Excel:     - ,     ,     ,   . <br><br>  ‚Äî    ,              .         ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      query const fetchData = useCallback(() =&gt; {   const url = 'https://hn.algolia.com/api/v1/search?query=' + query;   // ...      ... }, [query]);  //       return &lt;Child fetchData={fetchData} /&gt; } function Child({ fetchData }) { let [data, setData] = useState(null); useEffect(() =&gt; {   fetchData().then(setData); }, [fetchData]); //       // ... }</span></span></code> </pre> <br>   <code>fetchData</code>  <code>Parent</code>       <code>query</code> , <code>Child</code>        ,      . <br><br><h2> <font color="#3AC1EF">     ?</font> </h2><br>  ,          ,   , ,             .   ,    ,   ,        ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span> }; fetchData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.query;   <span class="hljs-comment"><span class="hljs-comment">// ...    -   ... }; render() {   return &lt;Child fetchData={this.fetchData} /&gt;; } } class Child extends Component { state = {   data: null }; componentDidMount() {   this.props.fetchData(); } render() {   // ... } }</span></span></code> </pre> <br> ,   : ¬´ , ,   ,  <code>useEffect</code> ‚Äî     <code>componentDidMount</code>  <code>componentDidUpdate</code> .     !¬ª.         <code>componentDidUpdate</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.fetchData(); } componentDidUpdate(prevProps) {   <span class="hljs-comment"><span class="hljs-comment">//         if (this.props.fetchData !== prevProps.fetchData) {     this.props.fetchData();   } } render() {   // ... } }</span></span></code> </pre> <br> , <code>fetchData</code> ‚Äî   ! (, ,  ,     .)      - ,   .  <code>this.props.fetchData</code>    <code>prevProps.fetchData</code>        . ,  ,  ? <br><br><pre> <code class="javascript hljs">  componentDidUpdate(prevProps) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.fetchData(); }</code> </pre> <br>      .          . (      .)  ,   <code>fetchData</code>   <code>this.state.query</code> ? <br><br><pre> <code class="javascript hljs">  render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Child</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fetchData</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.fetchData.bind(this,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.state.query</span></span></span></span><span class="xml"><span class="hljs-tag">)} /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br>    <code>this.props.fetchData !== prevProps.fetchData</code>    <code>true</code> ,    ,  <code>query</code>  !         . <br><br>      ,   ,   ,        <code>query</code>  <code>Child</code> .  ,   ,    <code>query</code> ,          <code>query</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span> }; fetchData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.query;   <span class="hljs-comment"><span class="hljs-comment">// ...    -    ... }; render() {   return &lt;Child fetchData={this.fetchData} query={this.state.query} /&gt;; } } class Child extends Component { state = {   data: null }; componentDidMount() {   this.props.fetchData(); } componentDidUpdate(prevProps) {   if (this.props.query !== prevProps.query) {     this.props.fetchData();   } } render() {   // ... } }</span></span></code> </pre> <br>     ,   ,     -       ,     ,     . <br><br>      ,   ,      .     <code>this</code> ,        .  ,      ,       ,     ,  -  .    ,    <code>this.props.fetchData</code> ,     ,    ,  ,   ,    . <br><br>   -       <code>useCallback</code> .   , ,     ,     .     ,     .   <code>useCallback</code>    <code>props.fetchData</code>   . <br><br> , <code>useMemo</code>        : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         Child, //       . const [color, setColor] = useState('pink'); const style = useMemo(() =&gt; ({ color }), [color]); return &lt;Child style={style} /&gt;; }</span></span></code> </pre> <br>     ,     <code>useCallback</code> ,    - .      ¬´ ¬ª,     ,      ,     .    ,       .      ,    <a href="https://reactjs.org/docs/hooks-faq.html"></a>    . <br><br>     ,   <code>fetchData</code>      (     ),       .    ,     ,       . (¬´   <code>props.onComplete</code>    ,       ?¬ª)    ,       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>          ,   : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">article</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> fetchData(id) {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ article }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  , , ,    .    .   ‚Äî    ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">article</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id); } componentDidUpdate(prevProps) {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevProps.id !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id) {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id);   } } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> fetchData(id) {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ article }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  , , ,       .     ,       . ,     <code>{id: 10}</code> ,      <code>{id: 20}</code> ,    ,            .   ,   ,      ,  .  And this is wrong. <br><br> ,     ,   .  ‚Äî ,   ,    <code>async/await</code> (  ,    - )    ,    (        ,      ). <br><br>         ,           <code>async</code> -. (, ,     ,     ,    .) <br><br>        ,   ,   !         . <br><br>  ,             : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Article</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ id }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [article, setArticle] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> didCancel = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!didCancel) {       setArticle(article);     }   }   fetchData();   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     didCancel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;   }; }, [id]); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  <a href="https://www.robinwieruch.de/react-hooks-fetch-data/"></a>      ,      ,    ,       .         ,       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>          ,   ,  ,      ,  ,   .       ,  , ,   .         .  ‚Äî   . <br><br>        <code>useEffect</code> ,  ,  ,  .       React.    ,     <code>useEffect</code>      . <br><br>   ,   ,  ¬´  ¬ª,         .     .    ,   ,  ,  ,   ¬´¬ª  ,      . <br><br>       ,  <code>useEffect</code>   ,    .   ‚Äî    .  ‚Äî    ,  ,  ‚Äî   ,      .   ,  ,       ,   ,      API. <br><br>  ,        ,  <code>useFetch</code> ,       ,  <code>useTheme</code> ,    .  ,      ,         <code>useEffect</code> .  ,   ,     ,    . <br><br>   , , <code>useEffect</code>      .    ‚Äî    ,     .      ,         .       ? <br><br>      <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html">Suspense</a>          React  ,       ,  -  ( : , , )     . <br><br>    <code>Suspense</code>       ,  ,  <code>useEffect</code>     ,    ,    ,        -  .    ,       ,        ,          .      ,  ,   <a href="https://www.robinwieruch.de/react-hooks-fetch-data/"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , will be a good way to reuse the logic responsible for loading data. </font></font><br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now you know about the effects of almost everything that I know. </font><font style="vertical-align: inherit;">And if you, starting to read this material and reviewing the section with answers to questions, are faced with something incomprehensible, now, I hope, everything fell into place.</font></font><br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/445276/">https://habr.com/ru/post/445276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445266/index.html">GeekBrains together with Rostelecom will hold IoT Hackathon</a></li>
<li><a href="../445268/index.html">Details about GraphQL: what, how and why</a></li>
<li><a href="../445270/index.html">[bookmarks] Bash for beginners: 21 useful commands</a></li>
<li><a href="../445272/index.html">JavaScript is the best programming language for beginners. Is that so or not?</a></li>
<li><a href="../445274/index.html">When ‚ÄúZo√´‚Äù! == ‚ÄúZo√´‚Äù, or why you need to normalize Unicode strings</a></li>
<li><a href="../445278/index.html">How to create a game if you are never an artist</a></li>
<li><a href="../445280/index.html">Profitability of sites and services</a></li>
<li><a href="../445284/index.html">Product Analytics VKontakte based on ClickHouse</a></li>
<li><a href="../445286/index.html">Brainboard: Hedera Hashgraph Distributed Registry Platform</a></li>
<li><a href="../445288/index.html">All your consumer loans and personal data "in one place" ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>