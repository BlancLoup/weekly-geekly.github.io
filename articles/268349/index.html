<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving electricity on thin clients</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to save electricity at work, a directive has been issued: for weekends and holidays, as well as for the night, all computers, except critical...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving electricity on thin clients</h1><div class="post__text post__text-html js-mediator-article">  In order to save electricity at work, a directive has been issued: for weekends and holidays, as well as for the night, all computers, except critical ones, should be turned off.  But as usual - someone forgets to forget.  For thin clients, there are two solutions - raise <a href="http://it-advisor.ru/thin/101-tsmon.html">TSmon</a> and steer from it or connect to the client via ssh and give the command to shutdown. <br><br>  By and large, the process itself is simple - we add the <b>sshd</b> package to the assembly, set the root password in the <b>build.conf</b> file <b>with</b> the <b>param</b> <b>rootpasswd</b> parameter, <b>build the</b> image, load it when we need to log in via ssh on the client, and turn it off, but it's more interesting to send the shutdown signal to all the necessary clients as a team, without unnecessary gestures. <br><br>  Why not telnet - because ssh is easier to make autologin, without crutches like perl and expect.  The following describes the method of implementation. <br><a name="habracut"></a><br>  And we will implement using key authentication, you may already have keys in the <b>~ / .ssh</b> folder and are used for other purposes, then you do not need to generate new ones, just copy the public key <pre><code class="bash hljs">cat id_rsa.pub &gt;&gt; authorized_keys</code> </pre>  if not, then command: <pre> <code class="bash hljs">ssh-keygen -t rsa; ssh-add; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/.ssh; cat id_rsa.pub &gt;&gt; authorized_keys</code> </pre>  Requests for the path for the keys and set-confirm the password to the private key are ignored, we do not need it, just press Enter. <br>  After executing the command in the <b>~ / .ssh</b> folder, we will have three files: <b>id_rsa</b> - private key, <b>id_rsa.pub</b> - public key and <b>authorized_keys</b> key.  We just transfer <b>authorized_keys</b> to the constructor folder of Thinstation <b>packages / sshd / etc / skel / .ssh</b> , set 0700 permissions on the .ssh folder and 0600 on the authorized_keys file, build the image and after downloading the client, we can log in on the client without a password. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you need to log in to the client from different machines or under from under different users, then we generate keys for each user, add them to the ssh agent with the <b>ssh-add</b> command and copy the contents of the resulting <b>id_rsa.pub</b> into one <b>authorized_keys</b> . <br>  I almost forgot, when connecting to the client for the first time, ssh asks "You <b>must</b> be silent, adding the option <b>-oStrictHostKeyChecking = no</b> , to the ssh command or create it in your own folder <b>~ /. ssh</b> <b>config</b> file and write to it: <b>StrictHostKeyChecking = no</b> . <br><br>  A few examples of use: <br><br>  Script shutdown clients list ip.txt: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh for ip in $(cat ip.txt) do ssh -oStrictHostKeyChecking=no root@$ip shutdown -h now&amp; #        ,      done</span></span></code> </pre><br>  Send all messages via Xdialog through the list of ip.txt: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh for ip in $(cat ip.txt) do ssh -oStrictHostKeyChecking=no root@$ip DISPLAY=:0 Xdialog --infobox \ '" !!!\n !!!  !!!\n !!!"' 300x200 0&amp; #        ,      # 300x200  -1 -1     . done</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Here is a message ...</b> <div class="spoiler_text">  Content <img src="https://habrastorage.org/getpro/habr/post_images/002/d88/27b/002d8827b0648d2ec550609dfd4f9f1e.png" alt="image"><br></div></div><br>  A little prettier is to send everyone a message through <b>notify-send</b> through the ip.txt list (add <b>package notification-daemon</b> to <b>build.conf</b> ): <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh for ip in $(cat ip.txt) do ssh -oStrictHostKeyChecking=no root@$ip DISPLAY=:0 notify-send --expire-time=0 -u critical \ '!!!' '" \n \n \n "'&amp; #        ,      done</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Here is a message ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ba6/79d/d3b/ba679dd3ba9361ba4b0a46c0b4cde9bf.png" alt="image"><br></div></div><br>  To facilitate the image of the dependencies notification-daemon, you can remove gtk-2.0, it is checked, it works. </div><p>Source: <a href="https://habr.com/ru/post/268349/">https://habr.com/ru/post/268349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268337/index.html">Welcome to OWASP EEE October 11</a></li>
<li><a href="../268339/index.html">Adding a new processor family to IDA pro</a></li>
<li><a href="../268341/index.html">We are looking for stability in retail, XYZ analysis of the range</a></li>
<li><a href="../268343/index.html">How do startups need IaaS: Speech Recognition Services</a></li>
<li><a href="../268347/index.html">I will give the domain and site pastebin.ru</a></li>
<li><a href="../268351/index.html">Calculation of formulas in office editors. Part 1</a></li>
<li><a href="../268355/index.html">DEV Labs 2015. Online conference for .NET developers. 17 October</a></li>
<li><a href="../268357/index.html">Um, but our fault is what? Do we issue these sim cards or what? (c) Vkontakte</a></li>
<li><a href="../268359/index.html">RailsStuff - development kit on rails</a></li>
<li><a href="../268361/index.html">Jii: A complete application with Yii2 architecture in the browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>