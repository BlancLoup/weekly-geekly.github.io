<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring Dockerfile to create and run a Docker container with your Go program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You wrote a program (microservice) on Go, and you want to deploy it in a Docker container? 
 In this small note I will try to describe this process fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring Dockerfile to create and run a Docker container with your Go program</h1><div class="post__text post__text-html js-mediator-article">  You wrote a program (microservice) on Go, and you want to deploy it in a Docker container? <br>  In this small note I will try to describe this process for beginners in the most compact and practical way. <br><a name="habracut"></a><br>  In short, I will say this about Docker - it allows you to launch a container with a virtual operating system and your application hosted in it.  And also, when you get bored, remove this container completely, without worrying that your application is somewhere in the dark. <br>  Here, in fact, all the benefits of using docker containers for beginners :) <br><br><blockquote>  In this article, I first consider how to compile your program inside an image, at the stage of its assembly.  This is the most obvious way for beginners.  Then the creation of the image and the launch of the container from a pre-compiled program file is considered. </blockquote><br>  Just a few words about what docker works with.  It stores images (images) of containers on the basis of which you can run as many instances of these containers as you like and configure them to route through the network (mapping of incoming ports, etc.).  Images are collected on the basis of other images (it can be said that there is an inheritance of images) that are publicly available in the docker repository.  For the Go program, the best ready-made choice would be the images golang: latest (based on debian) and golang: alpine (based on alpine linux).  Other image names can be viewed here: <a href="https://hub.docker.com/_/golang/">hub.docker.com/_/golang</a> <br><br><h3>  Building your program from source within a Docker image </h3><br>  This option is used, for example, when your main axis is windows or macos, and you are building a container for linux.  In order not to rebuild the go compiler for other platforms on our machine, simply compile the sources in the target Docker image. <br>  To build an image (image), you need to make a Dockerfile text file, without an extension, with the following contents in the source folder of your program: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs pgsql">#   <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> golang:latest # ,     RUN mkdir -p /go/src/app #   WORKDIR /go/src/app #        Docker         <span class="hljs-keyword"><span class="hljs-keyword">COPY</span></span> . /go/src/app #    ,    docker RUN go-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span> download #      RUN go-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span> install #      ,        #-web -  ,     ,       #go-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> -x  ,    stderr         CMD ["go-wrapper", "run", "-web"] #      EXPOSE <span class="hljs-number"><span class="hljs-number">8000</span></span></code> </pre> <br>  A special feature of this file for Go is the presence of a special go-wrapper script in the basic golang image, which facilitates compiling, allowing you not to think about paths and file names. <br>  In the folder with this file and your sources, run the command: <br><pre> <code class="bash hljs">docker build -t my-golang-app .</code> </pre> <br>  The dot at the end is the current directory with the Docker file, don't forget to specify it. <br>  my-golang-app - this will be the name of the image in which your program will be compiled. <br>  After executing this command, you can see the presence of the successfully assembled image with the command <br><pre> <code class="bash hljs">docker images docker ps -a</code> </pre> <br>  You can create and launch a container based on the collected image as follows: <br><pre> <code class="bash hljs">docker run -d --rm --name my-running-app my-golang-app</code> </pre> <br>  my-running-app - this will be the name of the container being created based on the my-golang-app image. <br>  Here you can also use the keys: <br> <code>-d | --detach -         id  . (  == false) <br> -i | --interactive -      ( STDIN ,       ) <br> -t | --tty -  ,    -i <br> -p | --publish=[] -     . : ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort | containerPort <br> -e | --env=[] -     . <br> -v | --volume=[] -      </code> <br>  For more details on the docker startup keys and the composition of the Dockerfile file, see <a href="https://docs.docker.com/">here</a> and <a href="https://docs.docker.com/engine/reference/commandline/run/">here</a> . <br><br><h3>  Running a compiled binary program file in a Docker container </h3><br>  It must be remembered that the file before being placed in the container must be correctly compiled for the desired image and architecture. <br><br>  Create and run a container with a binary: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #  CGO    alpine docker run --rm -v "$PWD":/go/src/myapp -w /go/src/myapp golang:alpine /bin/sh -c "apk add --update gcc musl-dev; go build -ldflags \"-s -w\" -a -o myapp_bin_name"</span></span></code> </pre><br>  Alternatively, we pack it in a container: <br><pre> <code class="hljs tex"># -*- Dockerfile -*- FROM alpine COPY myapp_bin_name /app/ RUN apk add --update tzdata openssl musl-dev ca-certificates &amp;&amp; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>rm -rf /var/cache/apk/* &amp;&amp; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>cp /usr/share/zoneinfo/Europe/Moscow /etc/localtime &amp;&amp; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>echo "Europe/Moscow" &gt; /etc/timezone &amp;&amp; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>chmod +x /app/myapp_bin_name &amp;&amp; <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>mkdir -p /data WORKDIR /app VOLUME /data CMD /app/myapp_bin_name EXPOSE 8085</code> </pre><br>  Create an image: <br><pre> <code class="bash hljs">docker build -t mymegapp .</code> </pre><br>  Run: <br><pre> <code class="bash hljs">docker run -d --rm --name my-running-app my-golang-app</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/331938/">https://habr.com/ru/post/331938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331910/index.html">Super Metroid Invisible Hand</a></li>
<li><a href="../331912/index.html">How to create an alternative to Google Drive and Dropbox in 3700 hours</a></li>
<li><a href="../331916/index.html">N ways to use Ahrefs when conducting a search audit</a></li>
<li><a href="../331930/index.html">Transition to binary</a></li>
<li><a href="../331934/index.html">Learn all programming languages</a></li>
<li><a href="../331940/index.html">Guide: how to use Python for algorithmic trading on the exchange. Part 2</a></li>
<li><a href="../331944/index.html">Algorithm for finding the best route in linux</a></li>
<li><a href="../331946/index.html">Using GAP analysis to identify and coordinate project tasks</a></li>
<li><a href="../331948/index.html">Multicore DSP TMS320C6678. Core memory organization</a></li>
<li><a href="../331952/index.html">Example of creating a WCF service running inside a Windows service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>