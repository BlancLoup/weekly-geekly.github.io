<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features of API development: which API is good?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably absolutely all readers use the API, working with frameworks, libraries, widgets, as a kind of language of communication between the essence a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features of API development: which API is good?</h1><div class="post__text post__text-html js-mediator-article">  Probably absolutely all readers use the API, working with frameworks, libraries, widgets, as a kind of language of communication between the essence and the main application.  And you probably noticed that some APIs are more convenient to use, and some have obvious problems.  <strong>Vsevolod Shmyrov</strong> (@ <a href="https://habr.com/users/vsesh/">vsesh</a> ) in his report on <a href="http://frontendconf.ru/">Frontend Conf</a> , decoding which you will find under the cut, tried to answer the question <strong>which API is good</strong> . <br><br>  The story is based on the Yandex.Maps API development experience, and although it is a JavaScript library, many of the principles and features of its development are applicable to other types of APIs, such as the server API and Standalone libraries.  Everything that will be discussed refers specifically to <strong>public A</strong> <strong>PI</strong> .  If only your colleagues access the API of your library, with whom you can easily tell that something needs to be changed somewhere, then you most likely will not encounter the problems faced by the developers of the public API. <br><br><img src="https://habrastorage.org/webt/jk/li/nq/jklinqceo8q1inq0mdnp8qygoss.jpeg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, the report <strong>will not answer the question whether you need your own API</strong> .  Hopefully, after reading you weigh the pros and cons and see for yourself whether you need it.  Vsevolod will simply tell you what difficulties the API developers face, what problems to solve and what else to do, namely about these four important points: <br><br><ul><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/358600/">Interface Design</a> <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/358600/">backward compatibility</a> <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/358600/">Research your API</a> <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/358600/">Additional actions</a> <br></li></ul><br><iframe width="560" height="315" src="https://www.youtube.com/embed/pYlsHDzaiOo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <strong>About the speaker:</strong> Vsevolod Shmyrov, senior interface developer at Yandex, directly participated in the development of the Yandex.Maps API and the Yandex map designer. <br><br>  This is a presentation on the report on <a href="http://frontendconf.ru/">Frontend Conf</a> in 2017, some moments, such as the list of supported browser versions, may have changed, but the criteria for a good API are still relevant.  Further the story will go on behalf of Vsevolod, pleasant reading. <br><a name="designing_interface"></a><br><h2>  Keep it simple </h2><br>  <strong>The API should be simple</strong> , well, preferably logical.  It seems that it seemed so easy that it could go wrong.  Nevertheless, people put completely different meanings into this word - the degree of simplicity is completely different for everyone.  Let's go straight to a negative example so that you understand what I am talking about. <br><br>  A few years ago, I ran into the API of a single social network.  There was a getFriends method. <br><br><pre><code class="javascript hljs">getFriends( ) =&gt; [ ]</code> </pre> <br>  Actually, despite the fact that on the slide I have JS pseudo-code, it was a server endpoint to which you sent a getFriends request with a parameter and received a list of friends.  It seems everything is logical, you request friends, you get friends.  My code that worked with this API would look something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends = getFriends( );</code> </pre><br>  But the developers for some reason decided that this was not enough.  They decided to do the following; if you have no friends, you get a <strong>Null</strong> instead of an empty list. <br><br>  Well, my code then began to look appropriate: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends = getFriends ( ); If (friends) { <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ } else { // ‚Ä¶ }</span></span></code> </pre><br>  It's okay, in principle, it‚Äôs still easy to use.  But the developers decided not to stop there and did the following logic: if you have one friend, then this list is not the return of one single friend: <br><br>  It becomes clear that the API is not easy, illogical.  My code has already begun to look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends = getFriends( ); If (isUser(friends)) { <span class="hljs-comment"><span class="hljs-comment">/*‚Ä¶*/</span></span>} elseif (friends) { <span class="hljs-comment"><span class="hljs-comment">/*‚Ä¶*/</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*‚Ä¶*/</span></span>}</code> </pre><br>  In principle, too, nothing terrible, two conditions, no problems.  The problem here lies in the other.  Absolutely all developers who use the API of this social network will write some additional checks in order to work with their API.  Probably somewhere here and you can draw a line and say a bad API and a good API. <br><br>  <strong>A good API is one that does not force you to write too much</strong> .  You use some method on the API and continue to work with the data, and you do not need to write terrible conditions. <br><br>  Let's summarize, the <strong>interface should be:</strong> <br><br><ul><li>  <strong>Simple and logical</strong> <br></li><li>  <strong>Consistent</strong> <br></li><li>  <strong>But not to the detriment of opportunities</strong> <br></li></ul><br>  By consistency, it means that if the API has methods that work with the same data types, these data types should be described the same way. <br><br><pre> <code class="javascript hljs">iCanShowYou({<span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}); NoUCant([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]); ButIMust(Point);</code> </pre><br>  For example, in the Maps API, the data type of the coordinate is often used; they are represented as an array - latitude, longitude.  And they are so described everywhere, that is, we have no methods that would accept an XY object, Long Lat objects, or even two objects at all.  Coordinates everywhere are represented by an array. <br><br>  But all of the above, of course, should not go to the detriment of opportunities.  It happens that there are some complex tasks that are simply impossible to describe simply, which require many parameters to enter.  Or the results of your method in the API depend on a third party.  Then each situation should be considered separately, and now I will tell you a little how we solve such problems. <br><br><pre> <code class="javascript hljs">someAwesomeMethod( elem, <span class="hljs-comment"><span class="hljs-comment">/* required */</span></span> index, <span class="hljs-comment"><span class="hljs-comment">/* = "key" */</span></span> startValue, <span class="hljs-comment"><span class="hljs-comment">/* = 0 */</span></span> endValue <span class="hljs-comment"><span class="hljs-comment">/* = 1 */</span></span> );</code> </pre><br>  In the example above, a method that takes some four arguments.  We try to derive the most probable cases and write down the standard values ‚Äã‚Äãof the parameters so that they solve these cases. <br><br>  We want the majority of users (in this case, users - developers who use the API) to pass the minimum number of necessary arguments to the method, and to solve complex problems they have already written additional arguments. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ymaps.GeoObject( geometry, <span class="hljs-comment"><span class="hljs-comment">/* {Object} */</span></span> properties, <span class="hljs-comment"><span class="hljs-comment">/* {Object} */</span></span> options, <span class="hljs-comment"><span class="hljs-comment">/* {Object} */</span></span> );</code> </pre><br>  In this example, we group the parameters by objects.  In other languages, it can be a class or an instance of a particular class or interface.  That is, a GeoObject can have a specific geometry, it can be a point, a line, a polygon, it has certain properties, such as a name, and it has options, such as color, etc.  There is not much difference between all these arguments, but we <strong>mathematically divided</strong> them <strong>to make it more convenient</strong> .  And frankly, the geometry changes much less frequently than the properties. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ymaps.GeoObject(geometry), <span class="hljs-comment"><span class="hljs-comment">//  new ymaps.Placemark(coord), //  ‚ÄúPoint‚Äù</span></span></code> </pre><br>  We also make special software helpers.  As I said, an object can be a point, line, polygon.  We noticed that, for example, points are used much more often and we have made a special class Placemark, which accepts not abstract geometry, but only a couple of coordinates. <br><br>  Below is a case of an undetermined result, this is a completely different task.  It happens that you still <strong>have to crush your crutches</strong> , only in the public API everyone will see them, which complicates the matter. <br><br><pre> <code class="javascript hljs">geolocation.get() .then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// success }, function (error) { // error });</span></span></code> </pre><br>  The geolocation.get method returns a promise, in which will be either the current position of the user or an error.  Due to the fact that an error is possible, we had to use the promise in this method, besides this method is asynchronous.  Geolocation.get uses browser geolocation by default, which not all browsers support. <br><br>  It works as follows, the developer writes in the code geolocation.get, this code is executed, and such a window comes out in the browser. <br><br><img src="https://habrastorage.org/webt/ya/gs/ts/yagstsiihkdp_0kw_cuk6ca6ieu.png"><br><br>  The site user can allow the site to get its location or deny.  But in some browsers there were bugs - if a person clicked on a cross or clicked somewhere on the page, this window disappeared and geolocation.get did not return any value, the promise hung without a value.  Therefore, we had to twist the time-out here, such a reinforced concrete solution, if within thirty seconds a person didn‚Äôt press anything or this window was gone, then we throw a rejection time-out.  This is not very beautiful, but nevertheless, it allows us to increase the stability of our code. <br><br><h2>  Manuscripts do not burn </h2><br>  This section is about <strong>backward compatibility</strong> .  You probably had such a case. <br><blockquote>  You rest, maybe it's a day off, most likely the night, you are relaxed, suddenly someone calls you and says that nothing works in production, your product has broken.  And you somehow remember that the last release was three weeks ago, everything was fine and nothing had to break.  Nothing, as they say, foreshadowed trouble. <br></blockquote>  You urgently connect to the working network, open the debugger, begin to understand what is happening, and suddenly you realize that everything is fine on your part.  Some API that you used has broken.  More precisely, he did not even break, he just began to work differently, not in the way you expected.  This means that backward compatibility has occurred. <br><a name="backward_compatibility"></a><br><h2>  backward compatibility <br></h2><br>  <strong>Backward compatibility is a guarantee that the published interface will be supported once in the future</strong> .  In principle, it would be nice <strong>to infinity</strong> , but, in fact, in the current major version. <br><br>  In general, everything is logical, <strong>did, it works - do not touch</strong> ! <br><br>  To make something new, do it somewhere aside, do not touch the old.  But not everything is so simple.  Backward compatibility imposes a very <strong>strong restriction on the development of any new components</strong> , any new interfaces, now I will tell you more about this. <br><br>  First, when you decide to publish a new interface, you should think about the <strong>degree of freedom of the developer</strong> . <br><br><img src="https://habrastorage.org/webt/dc/jy/eh/dcjyeh6jocnec4nwccxbqhmqut0.png"><br><br>  The more a developer‚Äôs degree of freedom, the more support resources are required.  Suppose you have one module that can only be used in one way.  Then you have a second module, now you can use the first module, you can the second, you can use both modules together.  Then you got a hundred modules, and with them a huge number of combinations and unforeseen situations that you can not even imagine.  This <strong>increases the risk of some unexpected error</strong> . <br><br>  In addition, all this is very expensive to maintain, you have to put additional unit tests, additional integration tests, check everything before each minor version. <br><br>  If you do decide to publish some entity, you need to think that the interface will be <strong>extensible</strong> . <br><br>  Let's take an example.  We once had a method, in principle, it still exists, balloon.setPosition.  Two coordinates, latitude, longitude could be passed there, which are indicated below by x and y. <br><br><pre> <code class="javascript hljs">balloon.setPosition( x, y<span class="hljs-comment"><span class="hljs-comment">//   )</span></span></code> </pre><br>  As I said earlier, all coordinates are recorded not by two arguments, but by one, since both of them are a required argument.  Therefore, it is better to tie them into one argument [x, y] and mark it as mandatory.  Then we thought that it would be nice to allow the projection to be transmitted except for latitude and longitude, we have a default projection, but you can specify some kind of projection of your own.  We could have added the Projection option, but then we would probably need to add some more options.  Then we decided that we would immediately make the options, specify the projection inside and in the future we will be able to add any other keys.  That is, we have made the interface extensible, and it does not block future development. <br><br>  All that I have just mentioned is needed in order to understand <strong>whether your new interface will not become a ‚Äúblocker‚Äù in the future?</strong> <br><br>  Let me go again to the example.  Once upon a time we decided to publish the getLayout method in essence overlay.  At that time, we had one single Layout, which was the implementations of the HTMLLayout symbol class.  We could publish the interface like this: <br><br><pre> <code class="javascript hljs">overlay.getLayout() <span class="hljs-comment"><span class="hljs-comment">// HTMLLayout</span></span></code> </pre><br>  Then in the future we would not be able to create a Layout other than html.  Therefore, we have made a method that returns an ILayout interface that will return an HTMLLayout. <br><br><pre> <code class="javascript hljs">overlay.getLayout() <span class="hljs-comment"><span class="hljs-comment">// ILayout // HTMLLayout, CanvasLayout‚Ä¶</span></span></code> </pre><br>  And the developer who uses the API, depending on his needs, can already switch to, for example, CanvasLayout. <br><br>  Then we thought and added Promise at all, because we realized that we need to do the API component-wise and, if the method becomes asynchronous, we will have the opportunity to add module loading at this point. <br><br><h3>  Error correction <br></h3><br>  But nothing is perfect, <strong>sooner or later</strong> <strong>errors leak</strong> <strong>into any</strong> <strong>API</strong> .  It so happens that the wrong architectural decision was made.  In our case, it happens that we were guided by some browser API, and it was closed.  It happens that they came to the conclusion that some kind of interface is unsuccessful and you need to redo it.  In this case, some developers start marking methods as <strong>deprecated</strong> . <br><br>  We are not very welcome this practice.  You probably encountered when there is an API, where forty major releases for six years, some method appeared in the eleventh version, in the fifteenth became deprecated, and in the twentieth it was completely removed.  You have to understand the documentation to understand how this works in general.  When deprecated API methods naturally grows very much and the documentation becomes not convenient to use. <br><br>  We often <strong>use aliases</strong> , but this is also in principle not a very good solution.  For example, we have layouts of icons, and in this case we use both spellings of the word ‚Äúgray‚Äù, as some users write in American, and some in English. <br><br><pre> <code class="javascript hljs">presets.get(<span class="hljs-string"><span class="hljs-string">'islands#greyicon'</span></span>); presets.get(<span class="hljs-string"><span class="hljs-string">'islands#grayicon'</span></span>);</code> </pre><br>  We did the same with the methods when we found typos. <br><br>  But the most important thing in backward compatibility is that <strong>not everything can be fixed</strong> .  Periodically, you just have to, as it is sung in my favorite cartoon, release and forget. <br><br>  Somewhere about two years ago, we were rewriting the backend API from one server technology to another.  Developers who use the API, used as follows: by reference <br><br><pre>  https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;mode=debug </pre><br>  We connected the script to the pages and everything worked fine. <br><br>  We moved to Node.js and all of a sudden, complaints came from users.  It was in an ampersand - some users copied a link with a special ‚Äú&amp; amp;‚Äù symbol, which in html is treated as an ampersand and works well.  But some users copied this link as is, that is, such a request was not sent to the server.  When this happened the following error, instead of the parameter ‚Äúmode‚Äù came ‚Äúamp; mode‚Äù.  The old backend handled this, because it considered the ‚Äú;‚Äù character to be a separator of get parameters along with the ampersand character.  That is, there came a lang, mode and a bunch of empty amp. <br><br>  We looked at how many users made such requests to us and realized that we cannot explain to everyone that doing so is wrong.  Therefore, we simply added middleware, which removes the amp from get parameters and only after that processes them.  Yes, it is stupid, but you have to live with it. <br><br><h3>  Major releases <br></h3><br>  But not everything is so hopeless, an <strong>error in backward compatibility will not haunt you for the rest of your life</strong> .  Only to the end, to the next major version. <br><br><img src="https://habrastorage.org/webt/ha/a9/2k/haa92koeo6-e4ta66fsb1ucaodm.png"><br><br>  Somewhere about three years ago we decided to release a major version of API 2.1 to <strong>update the list of browsers</strong> we support.  API 2.0 version was very old, it supported even IE 6 - you understand what a pain it is.  But, unfortunately, in 2.1 we still support IE 8, because three years ago it was a fairly current browser (now IE 8 is already in weak support). <br><blockquote>  To be honest, I will tell you a secret, only between us, on weekdays the share of IE 8 is somewhere around 4%, and on the weekend it sags less than 1%.  If you have an IE in your business, be renewed, enough to endure. </blockquote>  So, updating the list of browsers is also a breakdown of backward compatibility, in older browsers the API will not work, so we called this version 2.1.  At the same time, we decided to go for all serious and break backward compatibility even where it was not necessary.  We <strong>cleaned the code</strong> of all those aliases and the crutches that we needed to maintain due to backward compatibility, removed some of the old polyfiles for IE 6. <br><br>  It is clear that the <strong>major version is not a panacea</strong> , the release of a new major version is also a <strong>stress for developers</strong> who use your API.  They will have to re-clean the documentation, so still major versions are better not to indulge.  The release of the major version will still force them to rewrite the code, which means that your API would not be so good if you did not force the users to do it.  A partial solution is a special mode of operation. <br><br><h3>  "Special mode" work <br></h3><br>  JavaScript has a strict <strong>'use strict'</strong> mode; when you write the same code, it visually looks the same, but is treated a little differently.  We have a similar mode of operation, although it serves a completely different purpose. <br><br><pre>  https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;coordorder=longlat </pre><br>  We have a get coordinate parameter, which can be controlled by the order of coordinates in the array, about which I spoke earlier.  By default, we have latitude, longitude.  You can convey longitude, latitude (latlong).  Different geo-systems use a different coordinate order.  Accordingly, by specifying the get parameters, a different operation mode is obtained. <br><br>  The whole API works a little differently, and in the calculations it needs to be taken into account. <br><br>  What else can you say about backward compatibility?  Backward compatibility affects not only the code, as one might think. <br><br><img src="https://habrastorage.org/webt/f2/b9/ci/f2b9cia9jxdjmw7sz3htnfxxeoc.png"><br><br>  If you are developing a visual API, that is, an API that shows something, then you have <strong>backward compatibility to the visual component</strong> .  Not so long ago, we released a new minor version of the API, which updated the map controls.  They have become brighter, flatter, as is now fashionable, but they have practically not changed their size.  Why did we do that?  We could, in theory, make huge buttons, make them semicircular, change icons, or even remove the icons altogether, but this would violate backward compatibility. <br><br>  When we created the controls in the API, we thought it would be good to give developers the opportunity to add their own controls, and among ours.  That is, not on top, but right in the middle.  Accordingly, if we made the standard layout of the buttons more, then the developers on the sites would have gone layout.  So even this has to be tolerated and taken into account when creating a new minor version. <br><br><img src="https://habrastorage.org/webt/ti/es/nl/tiesnlfp4x4-rarm2o4vmtjxckc.png"><br><br>  I also want to note that very often backward compatibility breaks down in cascade.  In our case, something in the browser breaks - something breaks in the API. <br><br><img src="https://habrastorage.org/webt/8w/ac/db/8wacdbw5lw3lqvmypsotdbphdyq.png"><br><br>  We had such a little sad funny case, when in one browser, which already has about 80% share of users, the sign in the MouseEvent event suddenly changed.  The scrolling of the mouse wheel began to come not plus, but minus.  Naturally, when a person tried to bring the map with the mouse wheel, she began to move away from him.  In two days, until the browser fixed it, we received about three thousand emails per day.  In order for you to understand, usually even on the most stressful days, about ten letters arrive, that is, <strong>people were really uncomfortable with the</strong> fact that the map suddenly changed its behavior. <br><br><h2>  Own among strangers <br></h2><br>  This section is devoted to the JavaScript API, but nevertheless it is also quite interesting.  The API works in a strange context, what does this mean?  Suppose there is a first site that uses the maps API, and everything works well there.  There is a second site that uses the API, but it also uses the jQuery library - everything also works fine.  And there is a third site that uses the maps API and some evil.js, which <strong>for some reason redefines the basic methods</strong> . <br><br><img src="https://habrastorage.org/webt/jq/nx/rn/jqnxrnxzc_dv-slfxcxsmulporw.png"><br><br>  In the example below, the error is that indexOf does not return minus one.  Apparently the developer of this method decided to support IE 6, did not verify the existence of a real indexOf, and wrote this: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.indexOf = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item ==<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> [i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; };</code> </pre><br>  API naturally in this case breaks.  Or, for example, we came across this code: <br><br><pre> <code class="javascript hljs">* { <span class="hljs-attr"><span class="hljs-attr">transition</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>s all ease; }</code> </pre><br>  Someone for some reason wrote such a CSS selector that leaves absolutely everything on the page to be animated. <br><br>  As part of this article, I will not delve into how to deal with it, and in principle this is not always possible, you can find more details <a href="https://events.yandex.ru/lib/talks/4258/">here</a> . <br><br>  But I want to emphasize that this, too, need to spend resources.  Usually, this happens with us in the following way: the user's complaint comes in support of the fact that something is not working with the attached link;  we open it, we see that something is broken in the API;  We start watching CSS, JS and it is not always convenient.  It will also have to spend time if you are developing a JS library or an API that is embedded in someone else's context. <br><a name="exploring_your_api"></a><br><h2>  You do not know your product <br></h2><br>  The API, as I said before, is a product, and you don‚Äôt know how to use your product.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometime in version 2.0 we were faced with the fact that so many people created such small cards, but we just didn‚Äôt think about this case. </font></font><br><br><img src="https://habrastorage.org/webt/gz/yg/gn/gzyggnallascsjhy4adazg_m40m.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The map is tiny, about 150 * 150 pixels, and on the left map all the controls on each other ran. </font><font style="vertical-align: inherit;">And we just, when we created 2.0, didn‚Äôt think about it, well, who needs such a tiny map. </font><font style="vertical-align: inherit;">But when we saw it, in 2.1 we worked on it, and in the right picture everything is already placed. </font><font style="vertical-align: inherit;">We made </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adaptive elements</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - this is a very simple solution; the wider the map, the wider the elements. </font></font><br><br><img src="https://habrastorage.org/webt/xs/3z/6z/xs3z6zwkebjvarjuo6y5bgqsb_k.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accordingly, on large maps, the search is fully displayed, and on small buttons, upon clicking on which the search crawls out. </font><font style="vertical-align: inherit;">But this became possible only after putting the metrics on the own API methods.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Metrics </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you are developing an API, you </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need to constantly collect information</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> about using the API. </font><font style="vertical-align: inherit;">Maybe it seems to you that some module is important, but in fact almost no one uses it, and then you can, for example, devote less time to it. </font><font style="vertical-align: inherit;">It is also important to understand exactly how your API is used. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In our case, the size of the map was an important parameter. </font><font style="vertical-align: inherit;">We were faced with the fact that people created both small cards and very large ones - there are values ‚Äã‚Äãon the order of 5000 * 4000. </font><font style="vertical-align: inherit;">Apparently, such a size map is displayed on some stand, but I can not even imagine how much it opens. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, of course, you need to collect </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environmental information.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In our case, these are browsers. </font><font style="vertical-align: inherit;">You need to know which browsers you need to support, which do not, which can already be translated into weak support.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Think like ... </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To better understand how people use your API, you need to use the API yourself. </font><font style="vertical-align: inherit;">You know, it's not just abstract to know how it works, but to try to come up with a task that a developer would solve using your API. </font><font style="vertical-align: inherit;">For example, not so many years ago I tried to make an application for Vkontakte - a map on which people could mark where they traveled before. </font></font><br><br><img src="https://habrastorage.org/webt/jp/1c/8t/jp1c8tn7mknkahbtptgfqpzz4uu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The idea is simple, you can: put a label, open a map of friends and share it on the wall (it was four years ago). </font><font style="vertical-align: inherit;">And while I was making the application, I found a lot of bottlenecks in the documentation, where it was not very clear how this could be implemented. </font><font style="vertical-align: inherit;">Yes, I understand that the API developer himself criticizes the documentation, it sounds a bit strange, but it was </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">just necessary</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I tried to clear my mind, in this state I opened the documentation and tried to think like a developer-user. </font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus, I could find some fairly critical API work bugs inside the Iframe simply because such a case had not occurred to us, and it turned out to be important. </font><font style="vertical-align: inherit;">Vkontakte opens html applications via Iframe, respectively, the Iframe opens from another domain and features of work, for example, with events, which we, fortunately, have taken into account.</font></font><br><a name="additional_actions"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Document it </font></font><br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In any story about the API, it's probably impossible to avoid the topic of documentation, although it is quite tedious. </font><font style="vertical-align: inherit;">No API can do without documentation.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An API without documentation is not an API. </font></font><br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation is a document that confirms those public methods that should have the property of backward compatibility. </font></font><br><br><img src="https://habrastorage.org/webt/lz/jc/wb/lzjcwbjnw-qlmkju9lwecgdsgum.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our documentation is written by the developers themselves via JSDoc. We have, as a guide to all methods, and some introductory articles, for example, how to connect the API or how to create a map. </font></font><br><br><img src="https://habrastorage.org/webt/2h/kf/tf/2hkftf1tybfyy4atl5w7qgsmmf8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But experience shows that people are not very interested. Yes, if you wish, they can go into the documentation, but when the developer has not worked with your API yet, he will go to the search engine and type in ‚Äúcreate delivery card‚Äù, ‚Äúmark delivery card‚Äù or something like that. Accordingly, the documentation on such a request will not be issued, because it tells about more abstract things. Therefore, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you need to create special stands.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and collect popular cases there, we have such a stand is a sandbox. </font></font><br><br><img src="https://habrastorage.org/webt/lf/8q/80/lf8q80ghzluzsfqdagskmnwgwre.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There you can look at live examples of using the API: on the left is the code, on the right is the result. You can even correct something, and then export it to JSFiddle. But even here it turns out that everything is not as simple as it seemed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once we noticed such cards.</font></font><br><br><img src="https://habrastorage.org/webt/cw/ee/ls/cweelsyizyuzuo0b7xfikpleghe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first glance, everything is in order, but if you look closely, you can see that for some reason there are two elements for changing the scale (on the left is the scale, the buttons on the right). </font><font style="vertical-align: inherit;">We began to think why it happened, and it turned out that it was in one of our examples. </font><font style="vertical-align: inherit;">We wanted to make an example with the controls on the map and thought it would be a good idea to add two zoom controls: ‚Äúlook, we have a large zoom control and a small one, it works like this‚Äù. </font><font style="vertical-align: inherit;">The developers simply copied the code as is and pasted themselves onto the page. </font><font style="vertical-align: inherit;">After that, we decided that </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the examples we will make the most lively cases</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">That is, if there is a search case, then there will only be a search, no additional cool options that most developers may not need.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Call me maybe </font></font><br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API yet is possible without feedback</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Need to communicate with developers who use your API. We have a club for this, there API developers communicate with developers who use this API. Of course, we have technical support, but nevertheless, some questions are redirected directly to the developers, because who else can answer the questions that arise for programmers, except as programmers. We also have clubs in social networks, and in principle, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any feedback is also a very important call</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/n1/a0/qu/n1a0qutpln8r6uflgxhpnihauuu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you often complain that it is not clear how to use any method, and people cannot always clearly formulate their idea, then you should think that it is possible to change something in the API itself, change it in the documentation or make some new example in the sandbox. </font><font style="vertical-align: inherit;">It is always a very good indicator.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sell ‚Äã‚Äãme that pen </font></font><br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturally, besides a sandbox, documentation, and means for getting feedback, you need to make some advertising pages. </font><font style="vertical-align: inherit;">Often the question of choosing an API is not on the developer himself, but on his manager or manager, who may not be a programmer, all these scary characters scare him, he needs </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beautiful landing pages</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on how your API works. </font></font><br><br><img src="https://habrastorage.org/webt/cw/qm/y2/cwqmy2bjzx9ftdfjyvzfndosutk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It also needs to spend time.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Even easier </font></font><br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I started the story with the item ‚ÄúKeep it simple‚Äù, but you can go even further and </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not force the developer to program at all</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The most popular case can be resolved through some special tool. </font><font style="vertical-align: inherit;">For example, our popular case is simply displaying a map on a page or displaying a map on a page with some sort of label. </font><font style="vertical-align: inherit;">Therefore, we made a constructor. </font></font><br><br><img src="https://habrastorage.org/webt/hy/by/hw/hybyhwgyhfn43evyl9hxkxfzzry.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A person opens a map in the browser, clicks labels, draws lines and polygons, sets a description and gets the code to paste into the site. </font></font><br><br><img src="https://habrastorage.org/webt/tx/jf/v-/txjfv-bitgz5yapj-ioa0jwg6su.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is logical, but not everything is as simple as it seems at first glance. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constructor</font></font></strong> <br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple solution of popular tasks</font></font></strong> <br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Less ‚Äúfreedom‚Äù for the developer</font></font></strong> <br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backward compatibility bypass</font></font></strong> <br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In essence, the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constructor is a simplified version of the API</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , even non-developers can use it, so we give </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">less ‚Äúfreedom‚Äù in it</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . And this is a deliberate step. Now I will explain.</font></font><br><br><pre> <code class="javascript hljs">&lt;script src=<span class="hljs-string"><span class="hljs-string">" .../constructor/?um={id}&amp;width=514&amp;height=326 "</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a user receives a code for insertion into a site, he does not receive the same code that he would program through the API. It receives a script that connects a special module that loads the API itself and, based on the data specified in the constructor, creates a map. In this case, the user can control a small number of parameters, for example, the width and height of the map. If he created a map in the constructor, then he can no longer interact with it on the page, put another center, add a label, and so on. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We did this on purpose, because this is a very </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">good way to get around the limitations of backward compatibility.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If a person can not control anything, as in this case, then we can do anything. </font><font style="vertical-align: inherit;">For example, in this widget we quietly switched the version from 2.0 to 2.1 and did not receive any complaints at all. </font><font style="vertical-align: inherit;">If we left the possibility to edit something programmatically, we would give a greater degree of freedom to the developers and, accordingly, this would lead to some uncertainties and errors. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So maybe you don‚Äôt need an API, you may need a tool that allows you to do something instead of an API. </font><font style="vertical-align: inherit;">In our case, if developers need a lightweight case, we recommend the designer. </font><font style="vertical-align: inherit;">If it's more complicated, let's say you need to make a side menu next to the map and somehow interact with it - then you need an API.</font></font><br><br><h2>  Total <br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As I already said: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a good API doesn't make developers write too much, </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> but always remembers backward compatibility and does not break it; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the developer who creates the API must examine his API to understand how to use it. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finally, a couple of interesting links: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Maps API: </font></font><a href="https://tech.yandex.ru/maps/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tech.yandex.ru/maps</font></font></a> <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iframe v Script: </font></font><a href="https://events.yandex.ru/lib/talks/4258/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://events.yandex.ru/lib/talks/4258/</font></font></a> <br></li><li> <a href="https://habr.com/company/yandex/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> company Yandex.</font></font><br></li></ul><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next </font></font><a href="http://frontendconf.ru/moscow-rit/2018/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frontend Conf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> soon, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on May 28 and 29</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as always, awaits us a lot of interesting and even holivarny, for example, here are some accepted reports:</font></font><br><br><ul><li> <a href="http://frontendconf.ru/moscow-rit/2018/abstracts/3642"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Lilley</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (W3C). </font><font style="vertical-align: inherit;">WebFonts in 2018: Everything Changes.</font></font></li><li> <a href="http://frontendconf.ru/moscow-rit/2018/abstracts/3414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Victor Rusakovich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (GP Solutions). </font><font style="vertical-align: inherit;">Why do we rewrite the application to Elm, and who knows?</font></font></li><li> <a href="http://frontendconf.ru/moscow-rit/2018/abstracts/3334"> </a> (KeepSolid).     ,        . </li></ul><br> ,       ‚Äî <strong>4  5 </strong>     <a href="http://frontendconf.ru/moscow/2018">Frontend Conf Moscow</a> ,   . <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dfc2018-moscow"> </a>      3 ,       ++,      <a href="https://conf.ontico.ru/conference/join/fc2018-moscow.html"> </a>  . <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/358600/">https://habr.com/ru/post/358600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358584/index.html">Error notification: from each circuit in its own way</a></li>
<li><a href="../358586/index.html">Announcement mitap Sync.NET # 6 in Kharkov</a></li>
<li><a href="../358588/index.html">Application Monitoring with Prometheus</a></li>
<li><a href="../358594/index.html">Utilize Groovy DSL features for configuring Java applications</a></li>
<li><a href="../358596/index.html">John Carmack: My stories about Steve Jobs</a></li>
<li><a href="../358602/index.html">How to unleash the potential of a product manager? 30 typical PM interview questions</a></li>
<li><a href="../358604/index.html">PHP, GDB and arrays</a></li>
<li><a href="../358608/index.html">Each serverless platform has servers.</a></li>
<li><a href="../358610/index.html">The book "Theoretical minimum in Computer Science. All the programmer and developer need is "</a></li>
<li><a href="../358612/index.html">Building an extended anti-virus protection system for a small enterprise. Part 2. Antivirus Gateway USG40W by Zyxel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>