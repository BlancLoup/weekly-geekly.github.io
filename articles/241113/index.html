<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>This poodle bites: using SSL 3.0 holes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Interested in web security habrazhiteli already aware of another vulnerability in SSL, called POODLE. We will take a closer look at what this vulnerab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>This poodle bites: using SSL 3.0 holes</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/mailru/blog/241113/"><img src="https://habrastorage.org/files/430/c33/f9d/430c33f9de9b4455964f4402de6965fb.jpg"></a> <br><br>  Interested in web security habrazhiteli already aware of another vulnerability in SSL, called POODLE.  We will take a closer look at what this vulnerability is and exactly how an attacker can get to seemingly protected user data, and also describe how the Mail.Ru Group team dealt with this beast. <br><a name="habracut"></a><br>  An exhaustive explanation of the mechanism of using POODLE is given in the <a href="https://www.openssl.org/~bodo/ssl-poodle.pdf">article This POODLE Bites: Exploiting The SSL 3.0 Fallback</a> ;  Below is a translation of this article. <br><br>  For those who are not too interested in the details of the activity of a malicious dog, we recall that POODLE is a vulnerability in SSL 3, the old version of the protocol, which survives the second dozen.  There are two ways to deal with a vulnerability: <br><ul><li>  Put a patch on the server that prohibits roll back to SSL3 in the handshake process when it is impossible to connect via TLS.  The hitch is that this method works only if the patch is on both the server and the client.  Currently, this is only implemented in Google Chrome (starting in February 2014) and is planned for the next Firefox update.  It turns out that the security of users to a certain extent falls on the shoulders of the users themselves. </li><li>  Disable SSL 3 on servers, and that's the end of it.  Simple and elegant, but there is one "but."  Most browsers use TLS version 1.0 and higher, but there are still people in the world who are not ready to part with the legacy of the past, called Internet Explorer version 6, which simply does not support the new protocol versions in the default configuration. </li></ul><br>  Our statistics show that through IE6, 0.2% of users log into Mail.Ru.  And, although in absolute terms it is not such a small figure, we believe that safety is first and foremost.  Therefore, we have disabled the ability to connect with the client via SSL3 in Mail, Cloud, Calendar, authorization center and Mail.Ru for Business. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For IE6 users, this means Mail.Ru Mail, as well as other services that have chosen this method of dealing with POODLE, will no longer be available to them.  It is unlikely that there are many IE6 supporters among Habr's audience, but we advise you to make sure that your relatives and friends who are not too friendly with modern technologies have updated their browsers. <br><br>  In the case of services that have chosen the first way to protect against a vulnerability, if you are a Chrome user who regularly updates automatically, congratulations, you are protected.  If you prefer other browsers, we recommend using fresh Chrome at least when accessing public Wi-Fi, because in this case you are vulnerable.  Why exactly then?  This can be learned from the translation below. <br><br>  SSL 3.0 [RFC6101] is an outdated and insecure protocol.  When solving most practical tasks, it has already been replaced by successors, the TLS 1.0 [RFC2246], TLS 1.1 [RFC4346] and TLS 1.2 [RFC5246] protocols, but they maintain backward compatibility with SSL 3.0 for interoperability with older systems.  This allows you to avoid problems with client devices when introducing new versions of protocols on servers. <br><br>  But even if both the client and the server support TLS, the security level in SSL 3.0 is still an issue, as many clients use older protocols to deal with server compatibility bugs.  And here we would like to discuss how attackers can exploit this situation and hack the SSL 3.0 protocol.  It will be about <a href="http://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2014-3566">POODLE-</a> attack (Padding Oracle On Downgraded Legacy Encryption), through which you can, for example, intercept a Secure HTTP-cookie or the contents of HTTP-authorization headers. <br><br>  We will also recommend what measures need to be taken on clients and servers to counter such an attack.  If simply turning off SSL 3.0 does not suit you for compatibility reasons, then in the existing versions of TLS you need to use TLS_FALLBACK_SCSV. <br><br><h1>  Description of the POODLE vulnerability </h1>  For compatibility with older versions of servers, many TLS clients use downgrade dance: first, an attempt is made to establish a connection using the latest version protocol.  If the connection is not established, a new attempt is made, but under the older protocol.  Unlike the normal version determination procedure supported by both parties (for example, a client accesses TLS 1.2 and the server responds with TLS 1.0), the above scheme can be triggered due to network errors or malicious actions.  If the attackers who control the network between the client and the server interfere and prevent from establishing a connection with the TLS version 1.0 or higher, then the clients themselves switch to using SSL 3.0. <br><br>  The protocol uses RC4 stream encryption, or block encryption in CBC mode.  The main problem with RC4 is the presence of offsets: the more connections and encryption streams are used to send the same data (for example, a password or an HTTP cookie), the more information can be extracted from the traffic, which helps decrypt.  Below it will be shown how to combine an effective attack on CBC encryption using SSL 3.0 (provided that an attacker can modify the network exchange between the client and the server).  At the same time, unlike the vulnerabilities of BEAST and Lucky 13, there are no workarounds.  We only have insecure SSL 3.0 protocol, and to ensure strong encryption, we should avoid using it. <br><br>  The most serious problem of CBC-encryption in SSL 3.0 is that the addition of blocks (padding) can be arbitrary (except for the last byte), it is not covered by the MAC (Message Authentication Code).  The integrity of the add-on cannot be fully confirmed during the decryption, since in SSL 3.0 the message is first signed with the MAC, then padding complemented, and after that it is encrypted with a block cipher.  Padding from 1 to L bytes (where L is the block size in bytes) is used to obtain an integer number of blocks before encryption.  It is easiest to break through the protection if there is a whole padding block that (before encryption) consists of L-1 arbitrary bytes, followed by a single byte with the value L-1.  To process the incoming encrypted entry C <sub>1</sub> ... C <sub>n</sub> , when the initialization vector C0 is also given (where each C <sub>i</sub> is one block), the receiving party first determines P <sub>1</sub> ... P <sub>n</sub> as P <sub>i</sub> = D <sub>K</sub> (C <sub>i</sub> ) ‚äï C <sub>i- 1</sub> (D <sub>K</sub> denotes decryption of a single block using the session key K).  Then the padding is checked and removed at the end of the message, and finally the MAC signature is checked and deleted. <br><br>  If the last C <sub>n</sub> block is entirely padding, and the attacker replaces C <sub>n</sub> with any earlier encrypted C <sub>i</sub> block from the same stream, the message will still be accepted, provided that D <sub>K</sub> (C <sub>i</sub> ) C <sub>n-1</sub> has the last byte is L-1, otherwise it will probably be rejected, which makes it possible to carry out an attack on the Padding Oracle. <br><br>  Outside the lab, SSL 3.0 weakness can be used in MITM attacks when an attacker decrypts Secure HTTP cookies using the BEAST attack technique.  To implement a POODLE attack, you need: <br><ul><li>  Launch JS- on <a href="http://www.evil.com/">www.evil.com</a> so that the victim‚Äôs browser <a href="http://www.evil.com/">sends an</a> HTTPS request to <a href="http://example.com/">https://example.com</a> </li><li>  Intercept and modify the SSL entry so that there is a big enough chance that <a href="http://example.com/">example.com</a> will accept the modified entry.  If this happens, the attacker can decrypt one byte from the cookie. </li></ul><br>  Suppose that each C block contains 16 bytes - C [0] ... C [15].  We also assume that the size of the cookie has become known to us (we will show below how to launch an attack without knowing the size of the cookie).  The MAC size in SSL 3.0 is usually 20 bytes, so that ‚Äúunder a layer‚Äù of a CBC encrypted POST will look like this: <br><br>  POST / <i>path</i> Cookie: <i>name = value</i> ... \ r \ n \ r \ n <i>body</i> «Å 20 <i>byte</i> MAC <i>padding</i> <br><br>  The attacker controls the path and the body of the request, and therefore can initiate requests that satisfy two conditions: <br><ul><li>  Padding fills the entire block (encrypted in C <sub>n</sub> ) </li><li>  The first, as yet unknown, cookie byte is substituted as the last in the earlier block (encrypted in C <sub>i</sub> ) </li></ul><br>  Next, the attacker replaces C <sub>n</sub> with C <sub>i</sub> and redirects this modified entry to the server. <br><br>  Most often, the server does not accept it, and then the attacker sends a new request.  Sometimes (approximately once per 256 attempts) the server accepts a modified record and the attacker concludes that D <sub>k</sub> (C <sub>i</sub> ) [15] ‚äï C <sub>n-1</sub> [15] = 15, and therefore P <sub>i</sub> [15] = 15 ‚äï C <sub>n -1</sub> [15] ‚äï C <sub>i-1</sub> [15].  This reveals the first byte of the cookie, previously unknown.  The attacker proceeds to the next byte, simultaneously resizing the path and body of the request so that the size of the request does not change, but the location of the headers moves.  This is done until the cookie has been deciphered entirely.  The expected total effort is 256 SSL 3.0 requests per byte. <br><br>  Since the padding hides the exact size of the useful content, the size of the cookie does not immediately become apparent.  But GET /, GET / A, GET / AA, ... queries allow an attacker to calculate block boundaries.  A maximum of 16 such requests is enough to find out the size of the add-on, and therefore the size of the cookie. <br><br><h1>  Recommendations </h1> The above attack requires SSL 3.0 connection, so disabling it on the client or on the server (or on both sides) allows you to completely avoid trouble.  If at least one side supports only SSL 3.0, then medicine is powerless here, and a serious update is needed to avoid unsafe encryption.  If SSL 3.0 is not the only supported protocol and it is not disabled, then the attack is possible with downgrade dance (switching the client to lower versions for compatibility with the server). <br><br>  Disabling SSL 3.0 may be impractical if you need to periodically work with older systems.  The TLS_FALLBACK_SCSV mechanism solves a common problem for different protocol versions, and we believe that this is especially critical for systems that support SSL 3.0 compatibility.  The following explains the algorithm of TLS_FALLBACK_SCSV. <br><br>  TLS clients using downgrade dance should include the value 0x56, 0x00 in ClientHello.cipher_suites during each downgrade of the protocol version.  This value serves as a signal due to which the updated servers can refuse to establish a connection in the event of a downgrade attack.  Clients should always upgrade to the next lower version (for example, if started with TLS 1.2, then try TLS 1.1, then TLS 1.0, then SSL 3.0).  In the case of TLS_FALLBACK_SCSV, skipping a version can also prevent a successful connection. <br><br>  TLS servers, when an incoming connection encounters 0x56, 0x00 in ClientHello.cipher_suites, compare ClientHello.cipher_version with the highest protocol version supported by the server.  If the server supports a higher version than the client, then the connection is terminated with an error. <br><br>  This use of TLS_FALLBACK_SCSV makes sure that SSL 3.0 will be used only when working with older systems: attackers can no longer initiate a downgrade of the protocol.  If both sides allow SSL 3.0, but one of them does not support TLS_FALLBACK_SCSV, then the attack is still possible. <br><br><h1>  Bibliography </h1><ul><li>  [BEAST] T. Duong, J. Rizzo: ‚Äú <a href="https://www.google.com/search%3Fq%3D%2522Here%2BCome%2BThe%2BXOR%2BNinjas%2522">Here Come The ‚äï Ninjas</a> ‚Äù, 2011. </li><li>  [draft-ietf-tls-downgrade-scsv-00] B. M√∂ller, A. Langley: ‚ÄúTLS Fallback Signaling Cipher Suite (SCSV) for Preventing Protocol Downgrade Attacks‚Äù, Internet-Draft <a href="https://tools.ietf.org/html/draft-ietf-tls-downgrade-scsv-00">draft-ietf-tls-downgrade-scsv -00</a> , 2014. </li><li>  [Lucky13] NJ AlFardan, KG Paterson: ‚Äú <a href="http://www.isg.rhul.ac.uk/tls/Lucky13.html">Lucky Thirteen: Breaking the TLS and DTLS Record Protocols</a> ‚Äù, IEEE Symposium on Security and Privacy, 2013. </li><li>  [RC4biases] NJ AlFardan, DJ Bernstein, KG Paterson, B. Poettering, JCN Schuldt: ‚Äú <a href="http://www.isg.rhul.ac.uk/tls/">On the Security of RC4 in TLS and WPA</a> ‚Äù, USENIX Security Symposium, 2013. </li><li>  [RFC2246] T. Dierks, C.  Allen: ‚ÄúThe TLS Protocol Version 1.0,‚Äù <a href="http://www.ietf.org/rfc/rfc2246.txt">RFC2246</a> , 1998. </li><li>  [RFC4346] T. Dierks, E. Rescorla: ‚ÄúThe Transport Layer Security (TLS) Protocol Version 1.1‚Äù, <a href="http://www.ietf.org/rfc/rfc4346.txt">RFC4346</a> , 2006. </li><li>  [RFC5246] T. Dierks, E. Rescorla: ‚ÄúThe Transport Layer Security (TLS) Protocol Version 1.2‚Äù, <a href="http://www.ietf.org/rfc/rfc5246.txt">RFC5246</a> , 2008. </li><li>  [RFC6101] A. Freier, P. Karlton, P.  Kocher: ‚ÄúThe Secure Sockets Layer (SSL) Protocol Version 3.0‚Äù, <a href="http://www.ietf.org/rfc/rfc6101.txt">RFC6101</a> , 1996 (published as Historic RFC in 2011). </li><li>  [tlscbc] B. M√∂ller: ‚ÄúSecurity of CBC Ciphersuites in SSL / TLS: Problems and Countermeasures‚Äù, <a href="http://www.openssl.org/~bodo/tlscbc.txt">http://www.openssl.org/~bodo/tlscbc.txt</a> , 2004. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/241113/">https://habr.com/ru/post/241113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241099/index.html">How to make profitable design development sites (part 1)</a></li>
<li><a href="../241103/index.html">Rendering Clones in a Python Project</a></li>
<li><a href="../241105/index.html">Tinkoff Bank at #MBLTDev 2014</a></li>
<li><a href="../241109/index.html">Monitoring of transport: CIS vs West</a></li>
<li><a href="../241111/index.html">Translation of the book "The Little Book on CoffeeScript"</a></li>
<li><a href="../241117/index.html">Material Design Icon Set by Google</a></li>
<li><a href="../241119/index.html">Open online courses on Python, Linux and ... genetics</a></li>
<li><a href="../241123/index.html">How to create an interesting game setting? Level Four: Sound Effects</a></li>
<li><a href="../241125/index.html">System-NS from the inside</a></li>
<li><a href="../241127/index.html">German scientists: we program ... without programming languages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>