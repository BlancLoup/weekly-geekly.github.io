<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization of the process of searching for violators of land legislation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, Habr! It has long dreamed of contributing to this wonderful project that I have been reading for several years. 

 But since I am not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization of the process of searching for violators of land legislation</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, Habr!  It has long dreamed of contributing to this wonderful project that I have been reading for several years. <br><br>  But since I am not a programmer by training, my projects were not as elegant as those presented here.  Therefore, I thought for a very long time what could be placed here and that they would not shower with minuses.  As a result, within the framework of the work, the idea of ‚Äã‚Äãoptimizing the work of employees appeared, which makes it possible (in my opinion) to simplify life. <br><a name="habracut"></a><br>  The essence of the idea is that there are land plots on which it is possible to build only private residential buildings (Individual residential construction), and it is prohibited to use these premises for commercial activities.  Although it did not stop anyone in Russia, it turns out that employees must walk and check that the house is built as a dwelling, but used as a stall.  As a result, you need to walk for a long time and a lot, plus you constantly need access to information to clarify what kind of house it is.  Well, or in the office, select addresses for verification and then harness camels, replenish water and go on an amazing journey. <br><br>  Since we in the media say that the allegedly digital economy is in the yard and in general the Internet of things.  That approach in the form look in the database and go for a walk somehow looks strange. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result, realizing the idea of ‚Äã‚Äãcreating a heat map based on a <a href="http://pkk5.rosreestr.ru/">public cadastral map</a> and analyzing the data on the site, data on all cadastral neighborhoods within the district were obtained first.  The extraction method was not very humane.  In the analysis of tiles loaded on the map, all SVG files were saved, and the names of quarters were exported from the tags describing the geometry. <br><br>  Later, in each quarter, all objects within its boundaries were obtained.  The problem appeared at the stage of data analysis, that the coordinates of the objects are given in the mercator P3857 format, we had to add the translation to the usual coordinate system with longitude and latitude.  The coordinates of the object are given in two forms, this is the exact center of the site and the extreme points of the general geometry of the site. <br><br><div class="spoiler">  <b class="spoiler_title">json data</b> <div class="spoiler_text"><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"center"</span></span>: { <span class="hljs-string"><span class="hljs-string">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">5135333.187724394</span></span>, <span class="hljs-string"><span class="hljs-string">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">6709637.473119974</span></span> }, <span class="hljs-string"><span class="hljs-string">"extent"</span></span>: { <span class="hljs-string"><span class="hljs-string">"xmax"</span></span>: <span class="hljs-number"><span class="hljs-number">5135346.924914406</span></span>, <span class="hljs-string"><span class="hljs-string">"xmin"</span></span>: <span class="hljs-number"><span class="hljs-number">5135320.375756669</span></span>, <span class="hljs-string"><span class="hljs-string">"ymax"</span></span>: <span class="hljs-number"><span class="hljs-number">6709666.568613776</span></span>, <span class="hljs-string"><span class="hljs-string">"ymin"</span></span>: <span class="hljs-number"><span class="hljs-number">6709611.5618947</span></span> }</code> </pre> <br></div></div><br>  The first coordinates after the transfer I used for the heat map.  While fiddling with the map in QGIS (which I saw for the first time) came the crazy idea that you can search for objects by coordinates in the popular Yandex map and 2Gis services.  Immediately decided to check this theory.  And the truth is, if you drive in coordinates, then both services provide information about this house.  Consequently, the conclusion suggests itself, if you select objects with characteristics only for residential construction, and check them through the data on organizations, if the cards returned a list of organizations, then this structure is not used for its intended purpose. <br><br>  The initial verification was carried out on the data on the center of the plot, and as practice has shown, the data did not always converge, since the plot is larger than the house on it, and the house is not always in the middle of the plot.  But to confirm the theory, it fit.  Checked on that site which precisely I know that there is a private sector and precisely there are small shops or services. <br><br>  To get data from the maps, I used a blunt Python script (I apologize right away? If this code offended programmers): <br><br><div class="spoiler">  <b class="spoiler_title">code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> csv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyproj <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> choice <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> read_csv <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_proxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> headers = {<span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span>:<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows NT 8; WOW32; rv:54.0) Gecko/20100101 Firefox/54.0'</span></span>} proxies = open(<span class="hljs-string"><span class="hljs-string">'proxy.txt'</span></span>).read().split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) result=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span> proxy=<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: proxy = {<span class="hljs-string"><span class="hljs-string">'http'</span></span>:<span class="hljs-string"><span class="hljs-string">'http://'</span></span>+choice(proxies)} r = requests.get(<span class="hljs-string"><span class="hljs-string">'http://ya.ru'</span></span>,headers=headers, proxies=proxy,timeout=(<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code==<span class="hljs-number"><span class="hljs-number">200</span></span>: result=proxy <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> proxy <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> headers = { <span class="hljs-string"><span class="hljs-string">'Accept'</span></span>:<span class="hljs-string"><span class="hljs-string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8'</span></span>, <span class="hljs-string"><span class="hljs-string">'Accept-Encoding'</span></span>:<span class="hljs-string"><span class="hljs-string">'gzip, deflate'</span></span>, <span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>:<span class="hljs-string"><span class="hljs-string">'ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4'</span></span>, <span class="hljs-string"><span class="hljs-string">'Cache-Control'</span></span>:<span class="hljs-string"><span class="hljs-string">'max-age=0'</span></span>, <span class="hljs-string"><span class="hljs-string">'Connection'</span></span>:<span class="hljs-string"><span class="hljs-string">'keep-alive'</span></span>, <span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>:<span class="hljs-string"><span class="hljs-string">'_ym_uid=1495451406361935235; _ym_isad=1; topCities=43-2; _2gis_webapi_session=0faa6497-0004-47c5-86d8-3bf9677f972a; _2gis_webapi_user=7e256d33-4c6e-44ab-a219-efc71e2d330f'</span></span>, <span class="hljs-string"><span class="hljs-string">'DNT'</span></span>:<span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'Host'</span></span>:<span class="hljs-string"><span class="hljs-string">'catalog.api.2gis.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'Upgrade-Insecure-Requests'</span></span>:<span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'User-Agent'</span></span>:<span class="hljs-string"><span class="hljs-string">'Mozilla/5.0 (Windows NT 7; WOW32; rv:54.0) Gecko/20100101 Firefox/54.0'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-Compress'</span></span>:<span class="hljs-string"><span class="hljs-string">'null'</span></span> } print(<span class="hljs-string"><span class="hljs-string">"start"</span></span>) csvfile = open(<span class="hljs-string"><span class="hljs-string">'GetShopsByCoordinats.csv'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, newline=<span class="hljs-string"><span class="hljs-string">''</span></span>) fieldnames = [<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'x'</span></span>,<span class="hljs-string"><span class="hljs-string">'y'</span></span>,<span class="hljs-string"><span class="hljs-string">'shops'</span></span>,<span class="hljs-string"><span class="hljs-string">'names'</span></span>] writer = csv.DictWriter(csvfile, fieldnames=fieldnames, delimiter=<span class="hljs-string"><span class="hljs-string">';'</span></span>, quotechar=<span class="hljs-string"><span class="hljs-string">'|'</span></span>,) writer.writeheader() inputCSV = read_csv(<span class="hljs-string"><span class="hljs-string">'for2GIS.csv'</span></span>, sep=<span class="hljs-string"><span class="hljs-string">';'</span></span>, skiprows=[<span class="hljs-number"><span class="hljs-number">0</span></span>], header=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>): s= <span class="hljs-string"><span class="hljs-string">'point='</span></span>+str(inputCSV[<span class="hljs-number"><span class="hljs-number">1</span></span>][i])+<span class="hljs-string"><span class="hljs-string">'%2C'</span></span>+str(inputCSV[<span class="hljs-number"><span class="hljs-number">2</span></span>][i])+<span class="hljs-string"><span class="hljs-string">'&amp;fields=search_attributes%2Citems.links&amp;key=rutnpt3272'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (s) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requests.Session() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> session: r=session.get(<span class="hljs-string"><span class="hljs-string">'https://catalog.api.2gis.ru/2.0/geo/search?'</span></span>+s, headers=headers,timeout=(<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>)) JsonData = r.json() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: print(JsonData[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'items'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'links'</span></span>][<span class="hljs-string"><span class="hljs-string">'branches'</span></span>][<span class="hljs-string"><span class="hljs-string">'count'</span></span>]) writer.writerow({<span class="hljs-string"><span class="hljs-string">'id'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">0</span></span>][i]),<span class="hljs-string"><span class="hljs-string">'x'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">1</span></span>][i]), <span class="hljs-string"><span class="hljs-string">'y'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">2</span></span>][i]), <span class="hljs-string"><span class="hljs-string">'shops'</span></span>: JsonData[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'items'</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'links'</span></span>][<span class="hljs-string"><span class="hljs-string">'branches'</span></span>][<span class="hljs-string"><span class="hljs-string">'count'</span></span>] }) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: writer.writerow({<span class="hljs-string"><span class="hljs-string">'id'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">0</span></span>][i]),<span class="hljs-string"><span class="hljs-string">'x'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">1</span></span>][i]), <span class="hljs-string"><span class="hljs-string">'y'</span></span>: str(inputCSV[<span class="hljs-number"><span class="hljs-number">2</span></span>][i]), <span class="hljs-string"><span class="hljs-string">'shops'</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span> }) time.sleep(randint(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)) csvfile.close() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">'fin'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__==<span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre> <br></div></div><br>  The result was a file in which all checked objects with a cadastral number and coordinates of the site center and data from the site about the number of stores at a given point are reflected.  The names and contact details were not needed. <br><br>  Banal autofilter in Excel on a column with the number of stores more than 0, and we get a list of potential violators, you just need to go over the already "verified" addresses. <br>  The plans for the future to make the search is not at the point and within the radius of the borders of the site, like the possibility is in the API.  And if the number of identified objects is sufficient, then you can even make the builder of optimal routes and templates of acts of verification of the available data. <br><br>  The result was a very simple system that allows you not to just walk around employees, but to check only the necessary objects.  After confirming the identified objects and if you need to adjust the algorithm, you can create lists for verification automatically by simply selecting the required area of ‚Äã‚Äãverification on the map. <br><br>  Regarding the data upload, download, now received a legal API key. </div><p>Source: <a href="https://habr.com/ru/post/336972/">https://habr.com/ru/post/336972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336962/index.html">The flaw in formatting Swift blocks in Xcode</a></li>
<li><a href="../336964/index.html">40 spectacular ARKit demos that will soon see the world</a></li>
<li><a href="../336966/index.html">We configure the Internet gateway with transparent bypass of blocking (and we will block advertising)</a></li>
<li><a href="../336968/index.html">We pump USB Mass Storage Device on STM32F103 using FreeRTOS and DMA</a></li>
<li><a href="../336970/index.html">RxSwift: a bit about share (), replay (), shareReplayLatestWhileConnected () and other cool operators</a></li>
<li><a href="../336976/index.html">‚ÄúBy whom do you see yourself in 5 years?‚Äù: Wall Street top manager's advice on the answers to the cunning questions of recruiters</a></li>
<li><a href="../336978/index.html">Traffic mirroring on Juniper MX</a></li>
<li><a href="../336980/index.html">Creating a programming language using LLVM. Part 9: Add Debugging Information</a></li>
<li><a href="../336982/index.html">EWD: Substitution Processes</a></li>
<li><a href="../336984/index.html">Position selection procedure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>