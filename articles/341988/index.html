<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Model-Update-View pattern and dependent types</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Model-Updater-View is a functional pattern that is successfully used in the Elm language mainly for developing user interfaces. To use it, you need to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Model-Update-View pattern and dependent types</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1b3/f1c/541/1b3f1c541e15e6a8b677323ebde6c70d.png"><br><br>  Model-Updater-View is a functional pattern that is successfully used in the <a href="http://elm-lang.org/">Elm</a> language mainly for developing user interfaces.  To use it, you need to create a Model type that represents the full state of the program, a Message type that describes external events to which the program should react, changing its state, the updater function, which from the old state and message creates a new state of the program and the view function, which calculates, as a program, the required effects on the external environment, which generate Message events.  The pattern is very convenient, but it has a small flaw - it does not allow describing which events make sense for specific program states. <br><br>  A similar problem occurs (and <a href="https://habrahabr.ru/post/341134/">is solved</a> ) when using the OO pattern State. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Elm language is simple, but very strict - it checks that the updater function at least somehow processes all possible combinations of the model-state and message-events.  For this, you have to write extra, even if trivial - as a rule, leaving the model unchanged, the code.  I want to demonstrate how this can be avoided in more complex languages ‚Äã‚Äã- Idris, Scala, C ++ and Haskell. <br><a name="habracut"></a><br>  All the code here is available on <a href="https://github.com/potan/MUV-dp-example">GitHub</a> for experiments.  Consider the most interesting places. <br><br><h1>  Idris </h1><br>  <a href="https://www.idris-lang.org/">Idris</a> is a language that supports dependent types.  That is, in it the compiler can monitor the correct typing, although the type of one variable may depend on the value of another.  The types in Idris are similar to the <a href="https://en.wikibooks.org/wiki/Haskell/GADT">generalized algebraic types</a> in Haskell.  It is described by a list of type parameters and a set of constructors ‚Äî functions that create objects of this type.  Unlike Haskell, type parameters can be not only other types and type classes, but also values, including functions. <br><br>  We describe on it the type of a simple application using the Model-Updater-View pattern. <br><br><pre><code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vtype</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MUV</span></span></span><span class="hljs-class"> : model -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updater</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">) -&gt; model) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">) -&gt; vtype (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">)) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span><span class="hljs-class"> model msg vtype</span></span></code> </pre> <br>  This describes the parameterized data type Application.  Its parameters are the <u>type</u> model, the msg function that converts the <u>value</u> of the model type into an event type that can occur in a given program state, and a view type that will be parameterized by the event type ‚Äî it can be treated as a function from the parameter type into a simple type. <br><br><div class="spoiler">  <b class="spoiler_title">Lyrical digression about High Kind Types</b> <div class="spoiler_text">  This is the only place where the type parameter is used, which itself has type parameters.  Such an opportunity is not provided by all languages ‚Äã‚Äã- it is not present, including in Elm.  But in this example, the view is placed in the parameters of the type of application more ‚Äúfor beauty‚Äù - to show that it is part of the pattern.  One can proceed as in Elm ‚Äî use a fixed paramterized type as a View (in Elm, this is Html msg). <br><br>  I want to point out that HKTs are not necessary for using dependent types - these are different edges of a <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D1%258F%25D0%25BC%25D0%25B1%25D0%25B4%25D0%25B0-%25D0%25BA%25D1%2583%25D0%25B1">lambda cube</a> <br></div></div><br>  The msg function is unusual - it does not return a value, but a type.  During execution, nothing is known about the types of values ‚Äã‚Äã- the compiler performs <a href="https://en.wikipedia.org/wiki/Type_erasure">erasing of</a> all unnecessary information.  That is, such a function can only be called at compile time. <br><br>  MUV is a constructor.  It takes the parameters: model - the initial state of the program, updater - the function of updating the state when an external event occurs, and view - the function of creating an external view.  Note that the type of the updater and view functions depends on the value of the model (using the msg function from the type parameters). <br><br>  Now let's see how this application is run. <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">muvRun</span></span> : (<span class="hljs-type"><span class="hljs-type">Application</span></span> modelType msgType <span class="hljs-type"><span class="hljs-type">IO</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IO</span></span> a muvRun (<span class="hljs-type"><span class="hljs-type">MUV</span></span> model updater view) = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> msg &lt;- view model muvRun (<span class="hljs-type"><span class="hljs-type">MUV</span></span> (updater model msg) updater view)</code> </pre><br>  As an external view, we chose an input / output operation (in Idris, as in Haskell, input / output operations are first class values, so that they are completed, additional actions are required, usually returning such an operation from the main function). <br><br><div class="spoiler">  <b class="spoiler_title">Briefly about IO</b> <div class="spoiler_text">  When performing an operation of type (IO a), there is some impact on the outside world, possibly empty, and a value of type a is returned to the program, but the functions of the standard library are arranged so that it can be processed only by generating a new value of type IO b.  Thus, pure functions are separated from functions with side effects.  This is unusual for many programmers, but it helps to write more reliable code. </div></div><br>  Since the muvRun function generates I / O, it must return IO, but since it will never complete, the type of operation can be any - IO a. <br><br>  Now we describe the types of entities we are going to work with. <br><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MsgOuted</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Login</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MsgIned</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logout</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Greet</span></span></span><span class="hljs-class"> total msgType : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> msgType </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MsgOuted</span></span></span><span class="hljs-class"> msgType (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MsgIned</span></span></span></span></code> </pre><br>  It describes the type of the model, reflecting the presence of two states of the interface - the user is not logged in, and the user is logged in with the name of the String type. <br><br>  Next, we describe <b>two different</b> types of messages that are relevant for different variants of the model - if we are logged out, we can only log in under a certain name, and if already logged in, we can either log out or say hello.  Idris is a strongly typed language that will not allow the possibility of mixing up different types. <br><br>  And finally, the function that sets the model value to the message type. <br><br>  The function is declared total - that is, it should not fall or hang, the compiler will try to follow this.  msgType is called at compile time, which means its totality means that the compilation does not freeze due to our error, although it cannot guarantee that the execution of this function will lead to the exhaustion of system resources. <br>  It is also guaranteed that it will not execute ‚Äúrm -rf /‚Äù because there is no IO in its signature. <br><br>  We describe updater: <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">total</span></span> updater : (m:<span class="hljs-type"><span class="hljs-type">Model</span></span>) -&gt; (msgType m) -&gt; <span class="hljs-type"><span class="hljs-type">Model</span></span> updater <span class="hljs-type"><span class="hljs-type">Logouted</span></span> (<span class="hljs-type"><span class="hljs-type">Login</span></span> name) = <span class="hljs-type"><span class="hljs-type">Logined</span></span> name updater (<span class="hljs-type"><span class="hljs-type">Logined</span></span> name) <span class="hljs-type"><span class="hljs-type">Logout</span></span> = <span class="hljs-type"><span class="hljs-type">Logouted</span></span> updater (<span class="hljs-type"><span class="hljs-type">Logined</span></span> name) <span class="hljs-type"><span class="hljs-type">Greet</span></span> = <span class="hljs-type"><span class="hljs-type">Logined</span></span> name</code> </pre><br>  I think the logic of this function is clear.  I want to reiterate the totality - it means that the Idris compiler will check that we have considered all alternatives allowed by the type system.  Elm also performs such verification, but he cannot know that we cannot log out if not already logged in, and will require an explicit treatment of the condition. <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">updater</span></span> <span class="hljs-type"><span class="hljs-type">Logouted</span></span> <span class="hljs-type"><span class="hljs-type">Logout</span></span> = ???</code> </pre> <br>  Idris, on the other hand, will find an inconsistency in the types. <br><br>  Now we will start view - as usual in UI it will be the most difficult part of the code. <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">total</span></span> loginPage : <span class="hljs-type"><span class="hljs-type">IO</span></span> <span class="hljs-type"><span class="hljs-type">MsgOuted</span></span> loginPage = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> putStr <span class="hljs-string"><span class="hljs-string">"Login: "</span></span> map <span class="hljs-type"><span class="hljs-type">Login</span></span> getLine total genMsg : <span class="hljs-type"><span class="hljs-type">String</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">MsgIned</span></span> genMsg <span class="hljs-string"><span class="hljs-string">""</span></span> = <span class="hljs-type"><span class="hljs-type">Logout</span></span> genMsg _ = <span class="hljs-type"><span class="hljs-type">Greet</span></span> total workPage : <span class="hljs-type"><span class="hljs-type">String</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">IO</span></span> <span class="hljs-type"><span class="hljs-type">MsgIned</span></span> workPage name = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> putStr (<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> ++ name ++ <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) putStr <span class="hljs-string"><span class="hljs-string">"Input empty string for logout or nonempty for greeting\n"</span></span> map genMsg getLine total view : (m: <span class="hljs-type"><span class="hljs-type">Model</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IO</span></span> (msgType m) view <span class="hljs-type"><span class="hljs-type">Logouted</span></span> = loginPage view (<span class="hljs-type"><span class="hljs-type">Logined</span></span> name) = workPage name</code> </pre><br>  The view should create an I / O operation that returns messages, the type of which again depends on the value of the model.  We have two options: loginPage, which displays the message ‚ÄúLogin:‚Äù, reads a line from the keyboard and wraps it in the message Login and workPage with the parameter user name, which displays a greeting and returns various messages (but of the same type - MsgIned) depending on In addition, the user enters an empty or non-empty string.  view returns one of these operations depending on the value of the model, and the compiler checks their type, even though it is different. <br><br>  Now we can create and run our application. <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">app</span></span> : <span class="hljs-type"><span class="hljs-type">Application</span></span> <span class="hljs-type"><span class="hljs-type">Model</span></span> <span class="hljs-type"><span class="hljs-type">Main</span></span>.msgType <span class="hljs-type"><span class="hljs-type">IO</span></span> app = <span class="hljs-type"><span class="hljs-type">MUV</span></span> <span class="hljs-type"><span class="hljs-type">Logouted</span></span> updater view main : <span class="hljs-type"><span class="hljs-type">IO</span></span> () main = muvRun app</code> </pre> <br>  A subtle point should be noted here - the muvRun function returns <b>IO a</b> , where a was not specified, and main is of type <b>IO ()</b> , where <b>()</b> is the name of the type usually called <b>Unit</b> , which has a single value, also written as empty <b>()</b>  But the compiler does it easily.  substituting a () instead. <br><br><h1>  Scala and path dependent types </h1><br>  Scala does not have full support for dependent types, but there are types dependent on the object instance through which path dependent types are referenced.  In the theory of dependent types, they can be described as a variant of the sigma type.  Path-dependent types allow you to forbid folding vectors from different vector spaces, or to describe <a href="">who you can kiss with</a> .  But we apply them for simpler tasks. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgLogouted</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Login</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgLogouted</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sealed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgLogined</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logout</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgLogined</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Greet</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgLogined</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Msg</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">Msg</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span></span>: <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logouted</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">MsgLogouted</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] .... } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logined</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">MsgLogined</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] .... }</code> </pre><br>  Algebraic types in Scala are modeled through inheritance.  A <b>sealed abstract class</b> corresponds to a type, and each designer inherits a <b>case class</b> from it.  We will try to use them exactly as algebraic types, describing all variables as belonging to the parent <b>sealed abstract class</b> . <br><br>  The classes MsgLogined and MsgLogouted within our program have no common ancestor.  The view function had to be spread over different classes of the model in order to have access to a specific type of message.  This has its advantages, which supporters of OO will appreciate - the code turns out to be grouped in accordance with the business logic, everything connected with one use case is near.  But I would have liked to select the view into a separate function, the development of which could be transferred to another person. <br><br>  Now let's implement updater <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Updater</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Model</span></span>)(msg: model.<span class="hljs-type"><span class="hljs-type">Message</span></span>) : <span class="hljs-type"><span class="hljs-type">Model</span></span> = { model <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Logouted</span></span>() =&gt; msg <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Login</span></span>(name) =&gt; <span class="hljs-type"><span class="hljs-type">Logined</span></span>(name) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Logined</span></span>(name) =&gt; msg <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Logout</span></span>() =&gt; <span class="hljs-type"><span class="hljs-type">Logouted</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Greet</span></span>() =&gt; model } } } }</code> </pre> <br>  Here we, using path-dependent types, describe the type of the second argument from the value of the first.  In order for Scala to perceive such dependencies, functions have to be described in a carrirored form, that is, as a function of the first argument, which returns a function of the second argument.  Unfortunately, Scala in this place does not perform many type checks for which the compiler has enough information. <br><br>  Now we will give the full implementation of the model and view <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logouted</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">MsgLogouted</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() = { println(<span class="hljs-string"><span class="hljs-string">"Enter name "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = scala.io.<span class="hljs-type"><span class="hljs-type">StdIn</span></span>.readLine() <span class="hljs-type"><span class="hljs-type">Login</span></span>(name) } } } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logined</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">MsgLogined</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() = { println(<span class="hljs-string"><span class="hljs-string">s"Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$name</span></span></span><span class="hljs-string">"</span></span>) println(<span class="hljs-string"><span class="hljs-string">"Empty string for logout, nonempy for greeting."</span></span>) scala.io.<span class="hljs-type"><span class="hljs-type">StdIn</span></span>.readLine() <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Logout</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Greet</span></span>() } } } } <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Msg</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">Msg</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Viewer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Model</span></span>): <span class="hljs-type"><span class="hljs-type">View</span></span>[model.<span class="hljs-type"><span class="hljs-type">Message</span></span>] = { model.view() } }</code> </pre><br>  The type returned by the view function depends on the instance of its argument.  But for implementation, it turns into a model. <br><br>  The application created in this way is launched. <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.annotation.tailrec <span class="hljs-meta"><span class="hljs-meta">@tailrec</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span></span>(m: <span class="hljs-type"><span class="hljs-type">Model</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> msg = <span class="hljs-type"><span class="hljs-type">Viewer</span></span>.view(m).run() process(<span class="hljs-type"><span class="hljs-type">Updater</span></span>.update(m)(msg)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]) = { process(<span class="hljs-type"><span class="hljs-type">Logouted</span></span>()) } }</code> </pre> <br>  The code of the runtime system, therefore, does not know anything about the model's internal structure and message types, but the compiler can verify that the message matches the current model. <br><br>  Here we did not need all the possibilities provided by the path-dependent types.  Interesting properties will manifest themselves if we work in parallel with non-multiple instances of Model-Updater-View systems, for example, when simulating a multi-agent world (view would then be the agent's impact on the world and receiving feedback).  In this case, the compiler checked that the message is processed by the agent for which it is intended, despite the fact that all agents are of the same type. <br><br><h1>  C ++ </h1><br>  C ++ is still sensitive to the order of definitions, even if they are all made in one file.  This creates some inconvenience.  I will give the code in convenient for demonstration of ideas.  An ordered version for compilability can be viewed on <a href="">GitHub</a> . <br><br>  Algebraic types can be implemented in the same way as in Scala - the abstract class corresponds to the type, and the concrete heirs - to the designers (let's call them "constructor classes" that would not be confused with the usual C ++ constructors) of algebraic type. <br><br>  In C ++, there is <a href="http://meta-meta.blogspot.ru/2012/12/c11-sort-of-kind-of-has-path-dependent.html">support</a> for path-dependent types, but the compiler cannot use this type abstractly without knowing the actual type with which it is associated.  Therefore, it is impossible to implement Model-Updater-View with their help. <br><br>  But C ++ has a powerful template system.  The dependence of the type on the model value can be hidden in the template parameter of the specialized version of the executive system. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Processor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> CurModel&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProcessorImpl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Processor { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CurModel * model; ProcessorImpl&lt;CurModel&gt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CurModel* m) : model(m) { }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Processor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> View&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> CurModel::Message&gt; * view = model-&gt;view(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> CurModel::Message * msg = view-&gt;run(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> view; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Model * newModel = msg-&gt;process(model); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> msg; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newModel-&gt;processor(); } };</code> </pre><br>  We describe an abstract executive system, with the only method - to do everything that is required and return a new executive system suitable for the next iteration.  The competitive version has a template parameter and will be specialized for each ‚Äúconstructor class‚Äù of the model.  It is important here that all properties of the CurModel type will be checked during the template specialization by a specific type parameter, and at the time of compiling the template itself they are not required to be described (although it is possible using <a href="https://habrahabr.ru/post/304728/">concepts</a> or <a href="https://habrahabr.ru/post/205482/">other ways of implementing type classes</a> ).  Scala also has a fairly powerful system of parameterized types, but it checks the properties of the types of parameters it performs during the compilation of the parameterized type.  There, the implementation of such a pattern is difficult, but possible, thanks to the support of type classes. <br><br>  We describe the model. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Model() {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Processor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logined</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Model { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Model * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Logined * m)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Message() {}; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logout</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Message { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Model * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Logined * m)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Greet</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Message { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Model * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Logined * m)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; Logined(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> lname) : name(lname) { }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginedView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> View&lt;Message&gt; { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> View&lt;Message&gt; * view() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoginedView(name); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Processor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessorImpl&lt;Logined&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logouted</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Model { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> Model * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Logouted * m)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Message() {}; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Login</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Message { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; Login(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> lname) : name(lname) { }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Model * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Logouted * m)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogoutedView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> View&lt;Message&gt; { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> View&lt;Message&gt; * view() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LogoutedView(); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Processor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessorImpl&lt;Logouted&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }; };</code> </pre><br>  ‚ÄúConstructor classes‚Äù models ‚Äúcarry everything with them‚Äù - that is, they contain classes of messages and view that are specialized for them, and they also know how to create an executive system for themselves.  Own types of View are common to all models of the ancestor, which may be useful when developing more complex execution systems.  Basically, the message types are completely isolated and have no common ancestor. <br><br>  The updater implementation is separated from the model, since it requires that the type of the model be already fully described. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Model * Logouted::Login::process(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logouted * m) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logined(name); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Model * Logined::Logout::process(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logined * m) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logouted(); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Model * Logined::Greet::process(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Logined * m) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m; };</code> </pre><br>  Now let's put together everything related to the view, including the internal entities of the models. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Message&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Message * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~View&lt;Message&gt;() {}; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logined</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Model { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginedView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> View&lt;Message&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; LoginedView(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> lname) : name(lname) {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Message * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello %s"</span></span>, name.c_str()); fgets(buf, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (*buf == <span class="hljs-number"><span class="hljs-number">0</span></span> || *buf == <span class="hljs-string"><span class="hljs-string">'\n'</span></span> || *buf == <span class="hljs-string"><span class="hljs-string">'\r'</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Message*&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logout()) : <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Message *&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Greet); }; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> View&lt;Message&gt; * view() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoginedView(name); }; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logouted</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Model { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogoutedView</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> View&lt;Message&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Message * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Login: "</span></span>); fgets(buf, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Login(buf); }; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> View&lt;Message&gt; * view() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LogoutedView(); }; };</code> </pre><br>  And finally, write main <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ** argv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Processor * p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessorImpl&lt;Logouted&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logouted()); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Processor * pnew = p-&gt;next(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> p; p = pnew; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><h1>  And again Scala, already with classes of types </h1><br>  By structure, this implementation almost completely repeats the version in C ++. <br><br><div class="spoiler">  <b class="spoiler_title">Similar part of the code</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Message</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Processor</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Processor</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginedMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logout</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginedMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Greet</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginedMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logined</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Processor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ProcessorImpl</span></span>[<span class="hljs-type"><span class="hljs-type">Logined</span></span>, <span class="hljs-type"><span class="hljs-type">LoginedMessage</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogoutedMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Login</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogoutedMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logouted</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processor</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Processor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ProcessorImpl</span></span>[<span class="hljs-type"><span class="hljs-type">Logouted</span></span>, <span class="hljs-type"><span class="hljs-type">LogoutedMessage</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.annotation.tailrec <span class="hljs-meta"><span class="hljs-meta">@tailrec</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span></span>(p: <span class="hljs-type"><span class="hljs-type">Processor</span></span>) { process(p.next()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]) = { process(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ProcessorImpl</span></span>[<span class="hljs-type"><span class="hljs-type">Logouted</span></span>, <span class="hljs-type"><span class="hljs-type">LogoutedMessage</span></span>](<span class="hljs-type"><span class="hljs-type">Logouted</span></span>())) } }</code> </pre></div></div><br>  But in the implementation of the execution environment there are subtleties. <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProcessorImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">M</span></span></span><span class="hljs-class"> &lt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">model: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">M</span></span></span></span></span><span class="hljs-class">)(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> implicit updater: (</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">M</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Message</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">M</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">Message</span></span>] ) <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-type"><span class="hljs-type">Processor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Processor</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> v = view(model) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> msg = v.run() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newModel = updater(model,msg) newModel.processor() } }</code> </pre> <br>  Here we see the new mysterious parameters <b>(implicit updater: (M, Message) =&gt; Model, view: M =&gt; View [Message])</b> .  The implicit keyword means that the compiler, when calling this function (more precisely, the class constructor), will search for the context marked as implicit objects of the appropriate types and pass them as the corresponding parameters.  This is a rather complicated concept, one of whose applications is the implementation of type classes.  Here they promise the compiler that for specific implementations of the model and the message all the necessary functions will be provided by us.  Now fulfill this promise. <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updaters</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logoutedUpdater</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Logouted</span></span>, msg: <span class="hljs-type"><span class="hljs-type">LogoutedMessage</span></span>): <span class="hljs-type"><span class="hljs-type">Model</span></span> = { (model, msg) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Logouted</span></span>(), <span class="hljs-type"><span class="hljs-type">Login</span></span>(name)) =&gt; <span class="hljs-type"><span class="hljs-type">Logined</span></span>(name) } } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewLogouted</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Logouted</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">LogoutedMessage</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">LogoutedMessage</span></span> = { println(<span class="hljs-string"><span class="hljs-string">"Enter name "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = scala.io.<span class="hljs-type"><span class="hljs-type">StdIn</span></span>.readLine() <span class="hljs-type"><span class="hljs-type">Login</span></span>(name) } } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loginedUpdater</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Logined</span></span>, msg: <span class="hljs-type"><span class="hljs-type">LoginedMessage</span></span>): <span class="hljs-type"><span class="hljs-type">Model</span></span> = { (model, msg) <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Logined</span></span>(name), <span class="hljs-type"><span class="hljs-type">Logout</span></span>()) =&gt; <span class="hljs-type"><span class="hljs-type">Logouted</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (<span class="hljs-type"><span class="hljs-type">Logined</span></span>(name), <span class="hljs-type"><span class="hljs-type">Greet</span></span>()) =&gt; model } } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewLogined</span></span></span></span>(model: <span class="hljs-type"><span class="hljs-type">Logined</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">View</span></span>[<span class="hljs-type"><span class="hljs-type">LoginedMessage</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = model.name <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() : <span class="hljs-type"><span class="hljs-type">LoginedMessage</span></span> = { println(<span class="hljs-string"><span class="hljs-string">s"Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$name</span></span></span><span class="hljs-string">"</span></span>) println(<span class="hljs-string"><span class="hljs-string">"Empty string for logout, nonempy for greeting."</span></span>) scala.io.<span class="hljs-type"><span class="hljs-type">StdIn</span></span>.readLine() <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Logout</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Greet</span></span>() } } } } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> updaters._</code> </pre> <br><h1>  Haskell </h1><br>  There are no dependent types in mainstream Haskell.  It also lacks inheritance, which we essentially used in the implementation of the pattern in Scala and C ++.  But single-level inheritance (with elements of dependent types) can be modeled using more or less standard extensions of the language -TypeFamilies and ExistentialQuantification.  For a common interface of child OOP classes, a type class is started up, in which the dependent ‚Äúfamily‚Äù type is present, the child classes themselves are represented as a separate type, and then wrapped into an ‚Äúexistential‚Äù type with a single constructor. <br><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = forall m. (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Updatable</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Viewable</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">) =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> m class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Updatable</span></span></span><span class="hljs-class"> m where </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> m :: * update :: m -&gt; (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> class (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Updatable</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">) =&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Viewable</span></span></span><span class="hljs-class"> m where view :: m -&gt; (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">View</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">m</span></span></span><span class="hljs-class">)) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span></span></code> </pre><br>  I tried to smash the updater and view as far as possible, so I created two different types of types, but so far this has not worked out well. <br><br>  The implementation of updater is simple <br><br><pre> <code class="haskell hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">instance</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Updatable</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">where</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Login</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> update </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Login</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">) instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Updatable</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> where </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Message</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logined</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logout</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Greeting</span></span></span><span class="hljs-class"> update m </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logout</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Logouted</span></span></span><span class="hljs-class"> update m </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Greeting</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> m</span></span></code> </pre><br>  As View it was necessary to fix IO.  Attempts to make it more abstract greatly complicated and increased the coherence of the code - the Model type must know which View we are going to use. <br><br><pre> <code class="haskell hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> System.IO type View a = IO a instance Viewable Logouted where view Logouted = do putStr "Login: " hFlush stdout fmap Login getLine instance Viewable Logined where view (<span class="hljs-type"><span class="hljs-type">Logined</span></span> <span class="hljs-title"><span class="hljs-title">name</span></span>) = do putStr $ "Hello " ++ name ++ "!\n" hFlush stdout l &lt;- getLine pure $ if l == "" then Logout else Greeting</code> </pre><br>  Well, the executable environment is not much different from the same in Idris <br><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">runMUV</span></span> :: <span class="hljs-type"><span class="hljs-type">Model</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">IO</span></span> a runMUV (<span class="hljs-type"><span class="hljs-type">Model</span></span> m) = <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> msg &lt;- view m runMUV $ update m msg main :: <span class="hljs-type"><span class="hljs-type">IO</span></span> () main = runMUV (<span class="hljs-type"><span class="hljs-type">Model</span></span> <span class="hljs-type"><span class="hljs-type">Logouted</span></span>)</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/341988/">https://habr.com/ru/post/341988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341978/index.html">How to search for IT jobs in the EU</a></li>
<li><a href="../341980/index.html">We do well with Swift 4, Perfect, Protobuf and MySQL on a Linux server</a></li>
<li><a href="../341982/index.html">Laboratory: welcome to C ++ User Group Meetup</a></li>
<li><a href="../341984/index.html">Olympiad tasks in industrial programming. Part 1</a></li>
<li><a href="../341986/index.html">Integrating the equations of motion</a></li>
<li><a href="../341990/index.html">How Badoo is gaining developers</a></li>
<li><a href="../341992/index.html">Optimization of securities portfolio using Python</a></li>
<li><a href="../341996/index.html">Installing SSL certificate on Zimbra</a></li>
<li><a href="../341998/index.html">Board game design</a></li>
<li><a href="../342000/index.html">We authorize resources in the REST service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>