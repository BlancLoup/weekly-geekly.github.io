<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create an operating system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the report of Ivan Ruzanov ‚ÄúWindows - how the operating system is created‚Äù from the conference ‚Äú Platform 2009 ‚Äù. 

 As already wrote ant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create an operating system</h1><div class="post__text post__text-html js-mediator-article">  <em>According to the report of Ivan Ruzanov ‚ÄúWindows - how the operating system is created‚Äù from the conference ‚Äú <a href="http://platforma2009.ru/">Platform 2009</a> ‚Äù.</em> <br><br>  As already <a href="http://habrahabr.ru/blogs/microsoft/46690">wrote</a> <a href="http://geektimes.ru/users/antonms/" class="user_link">antonms</a> , records of reports from the Platform became available.  I looked at a few of them and want to share the ones you like the most.  Considering the employment of an ordinary habra-user and the duration of the initial recording of the report (1 hour 20 minutes), I give a detailed presentation of the material below. <ul><li>  Windows history </li><li>  Windows today </li><li>  Windows development </li><li>  Windows 7 kernel changes </li><li>  Maintenance of Windows, updates / patches </li></ul><a name="habracut"></a><h4>  Windows history </h4>  Few people know when the development of Windows NT began - more than 20 years ago, in November 1988.  Rumor has it that Microsoft <nobr>bought / stole</nobr> Windows NT.  Of course, this is not the case.  To work on the new operating system, Microsoft invited Dave Cutler, who worked for <a href="http://ru.wikipedia.org/wiki/Digital_Equipment_Corporation">DEC</a> and was one of the developers of the <a href="http://ru.wikipedia.org/wiki/OpenVMS">DEC VAX VMS</a> operating system.  In 1988, the development team of the new operating system was only 12 people, among which, along with Dave Cutler, were also former employees of DEC, who participated in the development of DEC VAX VMS.  And all the code for the new Windows NT was written to Microsoft. <br>  The abbreviation "NT" is decoded by marketing as "New Technologies", but in the project documentation, it meant something completely different.  The fact is that Windows NT was developed for a new, not released in 1988, <a href="http://ru.wikipedia.org/wiki/Intel_i860">Intel i860 processor</a> .  Its code name was <nobr>‚ÄúN10‚Äù (</nobr> <b>NT</b> en). <br>  The first version, Windows NT 3.1, was released 5 years later, in 1993.  At this point in the team was already 250 developers. <br><br><h4>  Windows today </h4><ul><li>  1 billion users </li><li>  140 million lines of code (including test code and toolkit) <br>  Windows code is very different.  Some parts were written 20 years ago, some appeared only in the current version.  For example, the Web Services on Devices (WSD) code in Windows Vista exists in its first version, the <a href="http://ru.wikipedia.org/wiki/GDI">GDI</a> code is in the final stages of its development and almost does not change, the DirectX code is already well developed, but it is actively changing now. </li><li>  8000 developers </li><li>  36 localization languages </li><li>  20 years of development </li></ul><br><h4>  Windows development </h4>  20-30 years ago, only one programming methodology, Waterfall, was used.  It is a sequence: <br>  Specifications ‚Üí Design ‚Üí Implementation ‚Üí Testing ‚Üí Supply. <br>  But this methodology works only for small projects.  For a product like Windows today, other methodologies are needed: <ul><li>  Product Cycle Model </li><li>  Team Software Process </li><li>  ‚Äú <a href="http://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BA%25D1%2581%25D1%2582%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Extreme Programming</a> ‚Äù </li></ul>  All of these methodologies have advantages and disadvantages.  Depending on the size of the team and the development stage of the component, different Windows development groups apply different development methodologies. <br>  For Windows, as a product as a whole, the Product Cycle Model is used: <ul><li>  Periods of 3-4 months </li><li>  Inside the period - "waterfall" </li></ul>  The biggest challenge in developing a product of this magnitude is that development takes time.  At the initial stage, those problems that exist in the current time and existing means are solved.  But the only thing that is constant is that everything will change.  Over the years of development: <ul><li>  Requirements will change </li><li>  Opportunities will change </li><li>  The schedule will change </li><li>  The project will change </li><li>  Users will change </li></ul>  Despite the fact that different teams are developing differently, there are "universal" rules: <ul><li>  Release of intermediate versions (milestones, beta, CTP) for broad masses of testers </li><li>  Production of internal assemblies with short cycles (1 day) </li><li>  Simplicity and reliability of design </li><li>  Personal and team code reading </li><li>  Unit tests </li><li>  Build Verification Tests </li><li>  Any intermediate assembly should be of high quality (what is written should work) </li></ul>  From myself, I note that for the month of working with Windows 7 build 6801 as the main OS on the home computer, I have a positive impression about this build. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The entire Windows development process is built around a daily build: <ul><li>  This is the pulse of the product. </li><li>  Development never stops </li><li>  Daily Auto Test </li><li>  Early Integration </li><li>  Developer Responsibility </li><li>  Obvious condition of the product </li></ul>  Once there used to be only one source code branch, and all developers made changes directly to it.  Now the development team is so big that it does not work.  Supported by many branches, among which is the main - WinMain.  Each laboratory has its own local development branch into which changes are integrated.  Proven changes over time integrate into WinMain. <br>  Daily development cycle: <ul><li>  3:00 pm - Admitted to integration changes to the source code control system </li><li>  Build 6 versions (Free / Checked - x86, x64, IA64) </li><li>  18:00 - New versions are available for testing. </li><li>  The new version is installed on several thousand workstations and servers for testing. </li><li>  Automated stress test </li><li>  05:00 - Test protocols are analyzed, failures are diagnosed </li><li>  09:00 - Summary reports automatically sent to teams </li><li>  09:30 - Consolidated meeting of team leaders to set goals </li></ul>  All project participants, including the most senior managers, use intermediate versions on their work (and usually home) computers. <br><br>  What is Windows written on? <ul><li>  C, C ++, C #, Assembler (x86, x64, IA64) <br>  Assemblers are used to a rather limited extent in situations where it cannot be avoided. </li><li>  Visual Studio, Source Insight, build, nmake </li><li>  Source Depot - source control system </li><li>  WinDbg, KD, NTSD - debuggers </li></ul>  Many internal tools, such as build, can be downloaded from <a href="http://www.microsoft.com/whdc/devtools">microsoft.com/whdc/devtools</a> . <br><br><h4>  Windows 7 kernel changes </h4>  The Windows 7 kernel has undergone the following changes: <ul><li>  Refactoring <br>  Why is it impossible to delete the graphics subsystem in Windows? <br>  From a technical point of view, the answer to this question is that the graphics subsystem in Windows is not independent, it is part of the Win32 subsystem. <br>  In Windows 7, many low-level components were refactored to break dependencies.  It will not be noticeable to users, only new Dll will appear, for example, <nobr>kernel32.dll is</nobr> divided into <nobr>kernel32.dll</nobr> and <nobr>kernelbase.dll</nobr> . <br>  This split made it possible to isolate a minimal kernel called <a href="http://en.wikipedia.org/wiki/MinWin">MinWin</a> (20 megabytes per disk). </li><li>  <a href="http://ru.wikipedia.org/wiki/Extensible_Firmware_Interface">EFI</a> support for x86 and x64 (as in Vista SP1) <br>  Many manufacturers are trying to get rid of the <a href="http://ru.wikipedia.org/wiki/BIOS">BIOS</a> in favor of EFI. </li><li>  Boot from VHD (virtual hard disk) </li><li>  Parallel device initialization and start of services <br>  When booting Windows, it takes quite a long time to build a tree of devices.  The PNP manager must interrogate the bus drivers (PCI, USB, FireWire, etc.) for what devices they have.  And most of the time, the processor waits for devices to respond (or not).  After all, in order to determine the devices on the bus you need to interview them.  If they are, they will answer, and if not, then you have to wait, and the processor is idle.  Parallel execution of these tasks reduces load time. </li><li>  Remove Dispatcher lock from scheduler and PFN lock from memory manager <br>  The last few years, the processor clock speeds do not grow, and the development is moving towards an increase in the number of concurrently running instructions both at the level of a single core and at the system level (multicore).  In this regard, a lot of work has been done to improve scaling. <br>  The two hottest locks that were in the core were the Dispatcher lock and the PFN lock. <br>  Dispatcher lock was used by the scheduler when the state of threads changes.  This lock has been removed, and the ‚Äúwaiting‚Äù flow state has been divided into several: <ul><li>  Waiting: In process </li><li>  Waiting: Completed </li><li>  Waiting: Canceled </li></ul>  PFN lock was used when changing the attributes of physical memory pages.  In a multiprocessor system, each processor requested access to this lock, which led to a lot of time. </li><li>  Support for 256 logical processors <br>  Earlier in Windows, a machine word was used as an affinity mask.  This was done because it was so easy to find free processors ‚Äî every bit is a processor.  Accordingly, 32 logical processors were supported in a 32-bit system, and 64 in a 64-bit one. <br>  In Windows 7, as a result of the transition to the affinity mask segment model, support for 256 logical processors became possible.  Processors began to be grouped into groups / segments.  Each group can contain up to 64 processors.  As a result, backward compatibility is obtained, old programs ‚Äúsee‚Äù only processors in one group, and new programs that use new interfaces work with all processors in the system. </li><li> Improved power saving: turning off processor sockets Today, there is a serious problem of power saving not only for owners of laptops, but also for owners of data centers.  In the US, 2% of the electricity consumed by computer data centers.  Many of them turn off some of their servers during low user activity (weekends). <br>  It was found that it is much more profitable to disconnect the entire processor socket than one core over several, since  in this case, you can disable the entire socket support infrastructure (memory controller). </li></ul><br><h4>  Windows maintenance, updates </h4>  Previously, updates were often cumulative (accumulative).  This meant that if the erroneous code was contained in an early update of the component, then later versions will contain this code.  But not all users need all the updates, they have a different configuration. <br>  Now after release (RTM) in Windows, there are 2 versions of the source code: <ul><li>  RTM GDR (General Distribution Release) <br>  Includes those few changes that are meant for everyone.  Mostly security fixes. </li><li>  RTM LDR (Limited Distribution Release) <br>  During the installation of the update, the Windows Update client selects the branch it needs and installs the code from it. </li></ul><br><h4>  Create security update </h4>  The job of creating a security update begins with a vulnerability discovery.  There are lots of different detection methods ‚Äî internal security teams, security partners, developers.  When a vulnerability is discovered, 2 parallel processes begin: <ul><li>  Development fixes for all platforms </li><li>  Search for "options" <br>  Large-scale search for similar vulnerability options on all platforms.  Search not identical code, but similar. </li></ul>  After the development of the fix, begin checking its code.  When they complete, the fix is ‚Äã‚Äãintegrated into the build, and the build is sent for testing: <ul><li>  Manual and automatic component testing </li><li>  Automatic testing of file format distortions, network components, etc.  (more than a million options) </li><li>  System testing in general, including backward compatibility testing </li></ul>  Only corrections that meet all quality criteria are allowed to be released to Windows Update and Download Center. <br><br>  <em>Thanks to everyone who read to the end =)</em> </div><p>Source: <a href="https://habr.com/ru/post/46757/">https://habr.com/ru/post/46757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../46750/index.html">Microsoft Office Groove 2007 is free and almost free</a></li>
<li><a href="../46751/index.html">Habr began to work more slowly lately?</a></li>
<li><a href="../46753/index.html">LETSystem and what it eat</a></li>
<li><a href="../46754/index.html">Do you need a habre book blog? (meaning technical, not fiction)</a></li>
<li><a href="../46756/index.html">IceCube: neutrino telescope in a block of ice</a></li>
<li><a href="../46758/index.html">Canadian created a woman Aiko</a></li>
<li><a href="../46760/index.html">Parade of Ideas (ideas for a startup)</a></li>
<li><a href="../46761/index.html">Fear the Danaians ...</a></li>
<li><a href="../46762/index.html">We dream about the education system in universities ...</a></li>
<li><a href="../46763/index.html">Which brief is better?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>