<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quadstor - performance and reliability</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the continuation of the article "Quadstor - a virtual SAN for state employees" as promised, the comparative speed tests of VSAN Quadstor HA and VSA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quadstor - performance and reliability</h1><div class="post__text post__text-html js-mediator-article">  In the continuation of the article <a href="https://habrahabr.ru/post/323114/">"Quadstor - a virtual SAN for state employees"</a> as promised, the comparative speed tests of VSAN Quadstor HA and VSAN Starwind HA.  As well as the Quadstor HA reliability test with simulated shutdown of one of the HA nodes. <br><br><h3>  Performance </h3><br>  To test the speed benchmarks of VSAN Quadstor and Starwind, 5 virtual machines were created based on a single iron host with VMware ESXi 6.5.  Virtual machines for those.  characteristics are exactly the same (twin brothers) (2xCPU, RAM-3Gb, 2x1Gb LAN,). <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/747/ee3/5ce/747ee35cea47490faeaaf997f2b593cb.png" alt="image"><br><br>  As can be seen in the figure (above): two VMs (virtual machines) under Windows Server 2008 R2 with StarWind 6 (which was), two VMs under Linux CentOS 7.3 with Quadstor 3.2.11, and one VM under Windows Server 2008 R2 for tests.  Then, the Quadstor VM pairs allocated 50GB of disk each (not counting the disk for the OS) and combined them into the Quadstor ON, and StarWind allocated 50GB of disks each of the VM pairs (not counting the disk for the OS) and combined them into Starwind HA. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, the created pools of disks with Quadstor ON and Starwind HA via iSCSI connected to the VMware ESXi host (figure below). <br><br><img src="https://habrastorage.org/files/9c8/0a2/89a/9c80a289acd9447096edb86a3fd3951c.png" alt="image"><br><br>  datastore1 and datastore2 are local VMware ESXi host disks, and quadstor and starwind are iSCSI disks.  It turns out that the local disk datastore2 of the VMware ESXi host via virtual machines is again allocated via iSCSI to the host (of itself). <br><br>  Such a solution is convenient when, for example, there are only two powerful servers and nothing else, and you need to create a fault-tolerant cluster such as VMware HA or Hyper-V HA or Windows Server Claster, etc. Then we allocate all servers on the two servers by virtual machine, issue all server disk space ( except for the disk with the OS), these VMs are merged into HA and from virtual machines we give two servers via iSCSI.  Servers understand this disk as separate disk storage by iSCSI, and based on this, you can build a HA cluster using two servers. <br>  Returning to our "sheep".  I connect 4 disks to VM ‚ÄúVM_TEST‚Äù (figure below). <br><br><img src="https://habrastorage.org/files/cb4/3dc/643/cb43dc643bed4c6eae3581a4de68e9fc.png" alt="image"><br><br>  Hard disk 1 and Hard disk 4 is a local host disk (datastore2), Hard disk 2 is a Quadstor AT disk, Hard disk 3 is a Starwind HA disk. <br><br>  <b>The tests took place in two stages:</b> <br><br><ul><li>  Synthetic test using Crystal Disk Mark v5.2 </li><li>  Test the usual copying of large and small files. </li></ul><br>  <b>Synthetic test.</b> <br><br>  As mentioned above, there are 4 disks connected to the VM_TEST VM (image below). <br><br><img src="https://habrastorage.org/files/466/b26/48a/466b2648ab864a929044d99e7e175ad2.png" alt="image"><br><br>  Tests on the Crystal Disk Mark were launched to each disk in two modes, with 100MB of data and 2GB of data. <br><br>  Test drive C: (Local, system drive) (figure below) <br><br><img src="https://habrastorage.org/files/3ea/28d/8a8/3ea28d8a823046f9ac9bd9c24a80540e.png" alt="image"><br><br>  Drive Test E: (Quadstor Drive) (Figure below) <br><br><img src="https://habrastorage.org/files/92f/fef/e1a/92ffefe1a2bc4c769e3459afbaf8a310.png" alt="image"><br><br>  Disk test F: (Starwind disk) (see figure below) <br><br><img src="https://habrastorage.org/files/d44/9d2/bf9/d449d2bf9cd04c6e84f3c81bc238cddd.png" alt="image"><br><br>  Disk Test G: (Local Disk) (Figure below) <br><br><img src="https://habrastorage.org/files/c1f/9be/b89/c1f9beb89e66470ba3d23f600ef87046.png" alt="image"><br><br>  These are the tests, comments unnecessarily, who knows he will understand everything.  The only thing I will add is that it is strange that the C: drive and the G: drive are different, although this is the same local drive. <br><br>  <b>Test the usual copy.</b> <br><br>  This test will be a little more interesting.  I wrote a small bat file that copies one large file of 7.71GB in size and many small files (about 10,000 files) with a total size of 1.94GB. <br><br>  Sample bat file: <br><br><pre><code class="hljs dos">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> NAME=%<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> DISK=%<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LOG=log_<span class="hljs-variable"><span class="hljs-variable">%date%</span></span>.txt <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ================================== &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> "  " <span class="hljs-variable"><span class="hljs-variable">%NAME%</span></span> &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ================================== &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> "   ( - <span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">71</span></span>Gb)" &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ---------------------------------- &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start</span></span> <span class="hljs-variable"><span class="hljs-variable">%date%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%time%</span></span> &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> /Y CentOS-<span class="hljs-number"><span class="hljs-number">7</span></span>-x86_64-Everything-<span class="hljs-number"><span class="hljs-number">1611</span></span>.iso <span class="hljs-variable"><span class="hljs-variable">%DISK%</span></span>\CentOS-<span class="hljs-number"><span class="hljs-number">7</span></span>-x86_64-Everything-<span class="hljs-number"><span class="hljs-number">1611</span></span>.iso <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> End <span class="hljs-variable"><span class="hljs-variable">%date%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%time%</span></span> &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ---------------------------------- &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> "    ( - <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">94</span></span>Gb)" &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ---------------------------------- &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start</span></span> <span class="hljs-variable"><span class="hljs-variable">%date%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%time%</span></span> &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /Y /EC:\Windows\System32 <span class="hljs-variable"><span class="hljs-variable">%DISK%</span></span>\ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> End <span class="hljs-variable"><span class="hljs-variable">%date%</span></span>-<span class="hljs-variable"><span class="hljs-variable">%time%</span></span> &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ---------------------------------- &gt;&gt;<span class="hljs-variable"><span class="hljs-variable">%LOG%</span></span></code> </pre> <br>  As you can see, the bat file is simple, using the usual commands, the iso file and the entire C: \ Windows \ System32 folder are copied and written to the log file (below). <br><br>  <i>==================================</i> <i><br></i>  <i>"Test disk check" "QuadStor"</i> <i><br></i>  <i>==================================</i> <i><br></i>  <i>"Copying a large file (size - 7.71Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017- 8: 26: 24,32</i> <i><br></i>  <i>End 03/22 / 2017- 8: 31: 43,79</i> <i><br></i>  <i>-</i> <i><br></i>  <i>"Copying many small files (size - 1.94Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017 - 8: 31: 43,79</i> <i><br></i>  <i>End 03/22/2012 - 8:32: 55.69</i> <i><br></i>  <i>-</i> <i><br></i>  <i>==================================</i> <i><br></i>  <i>‚ÄúStarwind Disc Test‚Äù</i> <i><br></i>  <i>==================================</i> <i><br></i>  <i>"Copying a large file (size - 7.71Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017: 8:32: 55.72</i> <i><br></i>  <i>End 03/22 / 2017- 8: 37: 32.90</i> <i><br></i>  <i>-</i> <i><br></i>  <i>"Copying many small files (size - 1.94Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017- 8: 37: 32.92</i> <i><br></i>  <i>End 03/22 / 2017-8: 38: 36.80</i> <i><br></i>  <i>-</i> <i><br></i>  <i>==================================</i> <i><br></i>  <i>‚ÄúDisk check test‚Äù ‚ÄúLocal‚Äù</i> <i><br></i>  <i>==================================</i> <i><br></i>  <i>"Copying a large file (size - 7.71Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017: 8: 38: 36.82</i> <i><br></i>  <i>End 03/22 / 2017- 8: 42: 37.31</i> <i><br></i>  <i>-</i> <i><br></i>  <i>"Copying many small files (size - 1.94Gb)"</i> <i><br></i>  <i>-</i> <i><br></i>  <i>Start 03/22/2017: 8: 42: 37.31</i> <i><br></i>  <i>End 03/22 / 2017-8: 43: 32.50</i> <i><br></i>  <i>-</i> <br>  Now a little analyze this log file. <br><br>  <u>QuadStor Disk Test (E :)</u> <br><br>  Copying a large file size 7.71GB, took - 5m.  22c.  - this is about 25 MB / s <br>  Copying small files with a total size of 1.94GB took 1m.  12c.  - this is about 27 MB / s <br><br>  <u>Starwind Disk Test (F :)</u> <br>  Copying a large file size 7.71GB, took - 4m.  27c.  - this is about 29 MB / s <br>  Copying small files with a total size of 1.94GB took 1m.  4c.  - this is about 31 MB / s <br><br>  <u>Local Disk Test (G :)</u> <br>  Copying a large file size 7.71GB, took - 4m.  01s.  - this is about 33 MB / s <br>  Copying small files with a total size of 1.94GB, took 55s.  - this is about 36 MB / s <br><br>  Below are screenshots of the load on Linux OS (QuadStor) and Windows OC (Starwind) while copying files. <br><br><img src="https://habrastorage.org/files/a88/189/686/a881896864024b0ead6ed57046236a41.png" alt="image"><br><br><img src="https://habrastorage.org/files/97e/cf8/f47/97ecf8f473be4d68b084644f322a0a73.png" alt="image"><br><br>  In general, the conclusions you can do yourself. <br><br>  I just want to give some examples: <br><br>  Standard desktop, home or work PC, the speed of copying files, an average of 20-25 MB / s.  HP Proliant 380 G8 server, 2 disks (HDD SAS 300Gb 10k) RAID1 - the speed of copying files, an average of 80-100 MB / s. <br><br><h3>  Reliability. </h3><br>  The reliability check consisted in the emergency shutdown of one of the Quadstor ON nodes while recording files.  Turn on copying. <br><br><img src="https://habrastorage.org/files/bd1/2be/a11/bd12bea119374e178b2cb7266501908d.png" alt="image"><br><br>  And turn off one of the nodes. <br><br><img src="https://habrastorage.org/files/536/aa0/4d8/536aa04d83b54701b4585745179538f2.png" alt="image"><br><br>  And in fact, almost nothing changes.  When copying a file, when you turn off one of the nodes, copying ‚Äúfreezes‚Äù for 1-2 seconds.  and continues on.  And the load on the work node increases slightly. <br><br><img src="https://habrastorage.org/files/d2b/2fd/ef3/d2b2fdef3e514524ab284fddeab5fddb.png" alt="image"><br><br>  When the disabled node resumes, synchronization occurs. <br><br><img src="https://habrastorage.org/files/75a/ba2/fd0/75aba2fd06514a5baf3a54030e28f79a.png" alt="image"><br><br><img src="https://habrastorage.org/files/b6e/738/869/b6e738869996479191b89bb34364178c.png" alt="image"><br><br>  Synchronization lasted 1-2min. <br><br>  Then I decided to check if you disable the synchronization network.  It's a little more complicated here.  Since the two nodes of each other do not see each other, they became both Master.  But this situation was solved simply.  I disconnected the node that was once ‚ÄúSlave‚Äù, connected the network and started the node.  Nod understood that the ‚ÄúMaster‚Äù already exists and becomes ‚ÄúSlave‚Äù and synchronization occurs. <br><br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/324598/">https://habr.com/ru/post/324598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324588/index.html">Continuous integration with Drone CI, Docker and Ansible</a></li>
<li><a href="../324590/index.html">The history of the 3rd place on ML Boot Camp III</a></li>
<li><a href="../324592/index.html">Mahou updated to version 2.0</a></li>
<li><a href="../324594/index.html">JNI Receive and Connect to JVM in Delphi</a></li>
<li><a href="../324596/index.html">Statistics on property values ‚Äã‚Äã- visualization on the map</a></li>
<li><a href="../324600/index.html">GitHub introduces SHA-1 collision detection system</a></li>
<li><a href="../324604/index.html">Detection and elimination of hacker attacks: how the system GOSPKA works</a></li>
<li><a href="../324606/index.html">Definition of development vector in the project</a></li>
<li><a href="../324608/index.html">Intel strengthens its position in HPC</a></li>
<li><a href="../324610/index.html">Monitoring of engineering infrastructure in the data center. Part 2. Power supply system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>