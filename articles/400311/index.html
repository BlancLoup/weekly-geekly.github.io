<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>This is not a toy for you: how the Playkey cloud gaming service works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Geektimes! This is the first post from Playkey - the first and largest Russian cloud gaming service. To play on a cloud gaming service, you need a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>This is not a toy for you: how the Playkey cloud gaming service works</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Geektimes!  This is the first post from <a href="https://goo.gl/sctrRl">Playkey</a> - the first and largest Russian cloud gaming service.  To play on a cloud gaming service, you need a high-speed Internet connection and almost any hardware, both on Mac OS and Windows. </p><br><img src="https://habrastorage.org/files/b1f/4ea/15b/b1f4ea15b9aa460ba4993aedfd365247.png"><br><br><p>  Outside it looks like a fairy tale: a decade old PC, and GTA V flies online without brakes.  But, if you look inside, then launching a top toy in the ‚Äúcloud‚Äù and transmitting it in real time to the user, instantly reacting to his actions is not easy as hell. </p><br><p>  For our intro publication, we decided to talk with Playkey technical director Alexey Lykov about how Playkey technology works in principle, how we solve the ‚Äúlast mile‚Äù problem and fight with high ping.  Go! </p><br><a name="habracut"></a><br><img src="https://habrastorage.org/files/e73/0e3/d7b/e730e3d7b4ab406083c3ce35f147976b.jpg"><br><p>  <i>(oh well, who are we kidding, Alexey is just looking at the monitor for the frame! In general, meet Alexey Lykov)</i> <i><br><br></i> <br></p><h3>  How it works </h3><br>  For a user, the operation of Playkey looks simple: you choose a game in the catalog, click to play - and you get a live picture in the client window. <p></p><br><p>  From our side it's all a bit more complicated.  It's like ‚Äúriding a bike that burns, and you burn, and everything burns, and you're in hell.‚Äù </p><br><p>  At the core of the Playkey service is a game server.  This is a virtual unit that serves one user.  Dozens of virtual servers can be run on the same physical server, which already serve individual users. </p><br><p>  Service is designed to bring joy to gamers, not pain and lagging picture.  Therefore, our task is to tune in to users, assessing the speed and quality of the Internet connection on their part, hardware, their own resources, free slots on the server, the availability of the game itself, and instantly adjust to all these conditions. </p><br><img src="https://habrastorage.org/files/c7c/90c/4a4/c7c90c4a4df6409f9f5586c690fece6e.png"><br><p>  At the stage of loading a game through Playkey, ping to the nearest servers and the presence of the selected game on a particular server are checked first.  Understandably, no one remembers that we have already downloaded this game ourselves and installed it on the server SSD.  Checkpoint is not relevant for all games, because the most popular titles like GTA 5 are spread on all servers at once. </p><br><p>  What happens if the service load is close to critical and only long servers with high ping remain?  The player is queued up for launch.  You have to wait a short time, 3-4 minutes, but, fortunately, recently, such episodes occur very rarely and only at the most peak moments.  We understand that the lag picture is a situation that is much worse than having to wait a couple of minutes, so we chose this scenario. </p><br><h3>  This is all your fault: we sort out the difficulties on the user's side </h3><br><p>  The main and first question asked about the Playkey is ping.  Today we can unequivocally say that for large Russian cities we have achieved excellent value: when playing by cable, you can count on units of milliseconds.  This is enough even for playing shooters. </p><br><p>  Why can ping in playkey be above the playable level?  According to our statistics, the main problem is the quality of the network directly at the user's home.  The frequent problem of the ‚Äúlast mile‚Äù is connecting via Wi-Fi.  With Playkey, we transmit realtime video, so we need to instantly respond to the ‚Äúfeedback‚Äù from the player.  On the technological side, Playkey is far more complex than the standard video stream.  We cannot allow a delay of a couple of minutes before viewing or reloading the sagging parts ‚Äúin progress‚Äù.  The video buffer in Playkey is minimal and amounts to milliseconds - as soon as it crosses over 20-30 milliseconds, it becomes uncomfortable to play. </p><br><p>  The Wi-Fi router is a terrible headache where packet loss is unacceptable.  Put a kettle near the router - Wi-Fi practically will not work.  Move the router behind the wall - the signal will begin to lose twice as many packets.  For the player, this means that the picture will start to lag, and the ping will grow.  When connecting via cable all these problems are not, but what can you do, we have learned how to work with players via Wi-Fi.  How? </p><br><p>  To eliminate lags when playing via Wi-Fi, we made adaptive bitrate triggers, which we collect all the time.  Based on the data obtained, we set the user to the highest possible quality and bit rate, depending on its conditions.  The situation of the user may change: starting from the fact that someone started using the network in parallel with the game, or the player moved to the next room, and the Wi-Fi signal improved (or vice versa worsened?).  At each step we take retaliatory actions. </p><br><p>  Therefore, we strongly recommend that users connect via wire, this allows us to exhibit better quality. </p><br><p>  Additionally, even before launching the game, the system collects statistics on the user's hardware: memory, operating system, processor.  This data allows us to understand the quality of the video stream can be decoded by the user's computer.  To decode streaming video, you need resources: if we are talking about the Core i7, then it can decode in realtime and 4K.  And something old or laptops on the Intel Atom are practically incapable of doing it on the fly.  We have to weaken the bitrate, leave fewer encoder chips - otherwise the software decoder simply does not have time to process the frame.  Even here we are trying to find a balance in the quality of the image that is available to the user in his realities. </p><br><p>  Our hyper goal is to launch Playkey on 3G / 4G networks, although they are sharpened for fundamentally different tasks.  Now, when transferring data within the mobile network, the player receives a high ping, and although it is generally possible to play, here we still have a lot of work to do. </p><br><img src="https://habrastorage.org/files/876/4cc/a4f/8764cca4f5c8410a8d2fff105ff05c8c.jpg"><br><p>  There are also more serious problems - on the way from the computer to the data center.  It happens that traffic goes from Moscow to St. Petersburg via Amsterdam.  Just because the operator at the backbone level, or in a specific data center, thought that it would be cheaper. </p><br><p> To combat this phenomenon is almost impossible, except by connecting to the traffic exchange sites.  Most often the problem occurs when working with different operators.  If the Perm user is connected, for example, via ‚ÄúXX-telecom‚Äù, and the servers are connected via ‚ÄúYY-telecom‚Äù, then it happened that the traffic was hooked through Moscow.  between providers may not be direct peering, since at the moment this problem is mostly eliminated. </p><br><h3>  How games are ported </h3><br><p>  The appearance of the game on the Playkey - it is not just ‚Äúdownloaded-set‚Äù.  This is a whole way to adapt each project to the cloud.  Previously, it took months, today we have made some progress: many engines are supported ‚Äúimmediately‚Äù, and the game can be launched on the day of release. </p><br><p>  In other cases, you have to connect a technical team and start setting up.  ‚ÄúGuys, we work further‚Äù: </p><br><img src="https://habrastorage.org/files/de8/f8e/3ba/de8f8e3ba3ee49ac8a5cc1fb4494002a.jpg"><br><blockquote>  Fun Fact # 1: One of the main difficulties in porting games is anti-cheat protection.  The behavior of the cloud gaming service looks like an emulator, and <i>Tom Clancy's</i> conditional <i>: Rainbow Six Siege</i> , for example, does not give us access to the online mode. <br></blockquote><p>  All games use WinAPI functions, there are a lot of these functions, some developers use little functionality, some - advanced.  In our technology, we handle these challenges, but they are very many and they behave differently.  Most of the scenarios we are already working out perfectly, but there are some new things.  Yes, writing a file is not a problem, but how does the game work with it further?  What markers does it put on this file?  Only for reading?  Does she close it?  Did she leave a link to it to use later?  The main scenarios, such as working with the file system, working with the registry, working with sound and video - we have, of course, already worked.  Therefore, to launch a new game, it is often enough to specify the version of Direct X, select the audio library, and everything is ready.  But there are also surprises, because of which setting up the game can take from a couple of hours to a couple of months. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </p><br><h3>  How are catalog games selected? </h3><br><p>  We are repelled from the goal to select the hottest new items, fresh ones that have received a high rating and, of course, with high technical requirements.  High priority is given to new games that we technically know that we can probably release on the day of release.  Users themselves also make the choice - often in social networks we open the polls, we take the winners in a mass decision.  That is, users here directly affect the library of games Playkey. </p><br><p>  <i>It looks like this:</i> </p><br><img src="https://habrastorage.org/files/e72/d02/ccc/e72d02ccc3144336b881d5d19f11e9c3.png"><br><p>  (and by the way, our VK group: <a href="https://vk.com/playkey_net">https://vk.com/playkey_net</a> ) </p><br><p>  Two important ‚Äúbuts‚Äù: we don‚Äôt take to play games in beta and we don‚Äôt work with titles that are focused exclusively on online and have a complex anti-cheat system. <br><br></p><br><h3>  What servers are used? </h3><br><p>  The huge complexity of Playkey is that we need not ordinary servers, but servers with a GPU.  There are not many of them in the world, and in Russia there is practically no such way at all. </p><br><p>  Here‚Äôs what these exclusive guys look like: </p><br><img src="https://habrastorage.org/files/827/db0/a44/827db0a44077422284b3575d26981f52.jpg"><br><p>  The problem is that they are rarely available for rent.  Service providers often boast that they have such solutions available, but, as a rule, they are put in the catalog ‚Äúto be‚Äù.  And if there is a request - there they are already organizing the delivery and price offer.  There is simply no formed demand for servers with GPUs. </p><br><p>  In fact, we have already blocked the amount of server resources with a GPU that was available for rent in Russia. </p><br><blockquote>  Fun Fact # 2: The main use case for such servers is the military industry and sophisticated mathematical calculations, where the GPU can do better than the processor.  This is also a problem: the cloud architecture does not suit the military - they want to buy a server for themselves.  At any price!  And this inflates the cost even higher.  We, on the contrary, need ‚Äúclouds‚Äù and for rent.  And yes, better is cheaper. </blockquote><p>  Yes, there are several large companies that provide the servers we need, but this is where the price problem arises.  They make a one-stop solution for all industries - and primarily for those who work with professional graphics.  They build a complicated and complicated infrastructure, and we need an architecture that would simply save money on storing games and reduce the check for players. </p><br><p>  Now there are simply no massive tasks for servers with a GPU.  And it fundamentally affects the issue price.  We want a rental model, but service providers at the current stage have to put all financial risks on us alone.  Because of this, it is easier for us to lease the server. </p><br><h3>  And it's all? </h3><br><img src="https://habrastorage.org/files/286/27e/ee2/28627eee227a46e38a0938e250f80bcf.jpg"><br><p>  Of course not!  This is only our first post in a series of publications about cloud gaming.  Now, after we have dismantled the basic architecture of the Playkey service, we plan to tell in detail the statistics about gamers in Russia, about the performance of Playkey hardware (and the cost of building a similar PC at home) and much, much more.  So feel free to subscribe to our channel, comment and confess - what else would you be interested to know about us? </p><br><p>  Happy New Year, Geektimes!  Play only the best games. </p></div><p>Source: <a href="https://habr.com/ru/post/400311/">https://habr.com/ru/post/400311/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../400301/index.html">Loneliness kills people with medium and low IQ</a></li>
<li><a href="../400303/index.html">Korean antimonopoly committee fined $ 853 million for Qualcomm</a></li>
<li><a href="../400305/index.html">New Ford drones replicate human driving</a></li>
<li><a href="../400307/index.html">Ask Ethan: why such bright quasars turn out from black holes?</a></li>
<li><a href="../400309/index.html">Kingston wishes GeekTimes readers a Happy New Year</a></li>
<li><a href="../400313/index.html">Physics in the animal world: magnetically sensitive bacteria and their compass</a></li>
<li><a href="../400315/index.html">Review of Fidget Cube alternatives</a></li>
<li><a href="../400317/index.html">Asteroids and we</a></li>
<li><a href="../400319/index.html">Six more signals of unknown nature were received from outside of our galaxy.</a></li>
<li><a href="../400321/index.html">What can be read from fresh fiction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>