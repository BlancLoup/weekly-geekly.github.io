<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to minimize errors when integrating with external services: the online broker experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a year and a half, we integrated via API with twenty external services. The first five integrations went through pain and tears - we made all the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to minimize errors when integrating with external services: the online broker experience</h1><div class="post__text post__text-html js-mediator-article">  For a year and a half, we integrated via API with twenty external services.  The first five integrations went through pain and tears - we made all the possible mistakes.  We rewrote the code several times, parted with partners just before the release, because we could not agree on the modifications.  Lost time and money. <br><br>  But with each new integration, we came up with solutions for recurring problems.  As a result, we did the last integration four times faster than the first.  What now we do differently - read the article. <br><a name="habracut"></a><br>  So that you better understand the specifics of our integrations, we will briefly describe what we are doing.  We are developing an online broker.  Principle of work: a user comes to the site, fills in a questionnaire, we transfer it to microfinance organizations (MFIs) and receive approval or refusal of a loan from them.  The user selects the right offer and gets paid.  To make it all work online, we integrate with the IFIs through an API. <br><br><h2>  Assessment of the partner‚Äôs readiness for integration using checklist and specification </h2><br>  Let us examine two scenarios: when a potential partner already has an API for receiving applications, and when not.  Both scenarios suggest that the partner wants to integrate with us and is willing to spend time on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Partner has no API - send specification </h3><br>  <b>Previously,</b> we explained to a partner verbally or in correspondence what we need for integration, and the partner based on these explanations made an API for receiving applications from Finspin.  We did not agree on the requirements for models, objects, fields of the questionnaire and the rules for their validation.  Quickly described the assignment of methods and possible answers.  The result turned out to be infinitely far from the expected, because our understanding of the API strongly diverged from the partner.  We had to redo everything. <br><br>  <b>Now</b>  We wrote our specification - a YAML file, which can be opened in Swagger.  In the specification, we described the most appropriate API for integrating Finspin with MFIs: questionnaire fields and rules for their validation, formats and types of requests with answers, method names, possible errors and statuses.  We recorded the status of the application, which we plan to receive, for example: ‚Äúaccepted for processing‚Äù, ‚Äúscoring is in progress‚Äù, ‚Äúdenied a loan‚Äù, ‚Äúapproval‚Äù, etc. <br><br>  We send the specification to a partner, and he decides whether he can provide such an API.  If it cannot, marks problem points in the specification, for example, not all the application states are ready to be passed to the API or there are not enough fields in the questionnaire.  And we are already discussing specific points, not abstract entities.  The partner does not spend time writing their documentation, but corrects ours. <br><br>  We spent on the creation of the specification for two days, but now we save dozens of hours on approvals and API modifications.  Also, using the specification, we quickly screen out partners who are not ready for integration.  In the early stages, it becomes clear that our online application processing is very different: it is not profitable to integrate. <br><br><h3>  The partner has an API - we run on the checklist </h3><br>  <b>Previously,</b> we received a partner specification and asked questions about it on the go.  Often forgot to clarify something important, and then this important surfaced in the final stages of development and testing, when correcting and rewriting became particularly costly.  Once, at the end of integration with one partner, it turned out that it would transfer API loan statuses with a delay of several days.  For us, this is unacceptable.  We had to abandon the partnership. <br><br>  <b>Now</b>  We wrote a checklist to evaluate the API and the processes it serves.  The checklist collected questions that need to get answers.  First, our manager looks for answers in the specification.  If not found, addresses questions to the partner. <br><br>  The checklist helps to find bottlenecks before starting development, and not after - when you have to edit the code, and customers suffer because of poor service. <br><br>  We constantly replenish the checklist when faced with new situations.  The more detailed the checklist, the lower the risk of missing mistakes in the development. <br><br><img src="https://habrastorage.org/webt/sa/u7/m4/sau7m4kwc3-mzhxwaq37w1pu1pm.png" width="600"><br>  <i>API checklist fragment</i> <br><br><h2>  Glossary of terms </h2><br>  <b>Previously,</b> it seemed to us that in the field of online lending, everybody understands the proftermines equally, there can be no different interpretations.  Practice has shown that we were wrong. <br><br>  For example, with one MFI, we interpreted primary and repeat clients differently.  For us, the primary client is a client, whose profile first got into the MFI database through Finspin, and the repeat client was already in the database.  The partner considered repeated clients by the number of loans issued: the repeated ones received two loans and came for the third.  Such terminological confusion could lead to inconsistencies in financial reconciliations. <br><br>  <b>Now</b> we use a small glossary of terms, which we check with partners.  As a rule, it is enough to clarify five or six basic terms in order to synchronize ideas about integration and assess the prospects for collaboration. <br><br>  Once a glossary of terms helped us avoid unprofitable integration.  Our interpretation of "approval" was very different from the affiliate.  The partner's ‚Äúapproval‚Äù included many different aspects that require manual processing.  We strive for maximum automation, so we immediately refused to cooperate. <br><br><img src="https://habrastorage.org/webt/zf/8s/8i/zf8s8i52-w3mfjcqncaxcelxlpq.png" width="800"><br>  <i>We clarify the term ‚ÄúApproval‚Äù</i> <br><br><h2>  First business, then development </h2><br>  <b>There used to</b> be cases when we started working with a potential partner with a specification.  Our manager received the specification, carefully studied it, clarified with the partner the details for integration, discussed controversial issues with the developers.  And then a message arrived from the management: ‚ÄúEnd of release, integration is canceled, we did not agree on the terms‚Äù.  The staff wasted time. <br><br><img src="https://habrastorage.org/webt/1p/at/bg/1patbgwgpcliihybxvmuvj1-uo0.png" width="800"><br>  <i>When you change your mind, and the work is done</i> <br><br>  <b>The</b> iron rule <b>now</b> applies: the manager proceeds to study the specification only when he receives an unambiguous integration decision from management. <br><br><h2>  Readiness for integration: urls, requisites, surroundings </h2><br>  <b>Previously, the</b> first call to the partner API occurred during testing of our application, from dev servers.  Often the first requests received errors at the connection setup stage: can not connect to server or just a timeout.  The most popular reasons are: <br><br><ul><li>  wrong method names (sealed or confused), </li><li>  invalid domain </li><li>  Incorrect connection details </li><li>  did not add our servers IP to the white list. </li></ul><br>  It took hours to correct such minor mistakes, because they followed one after another: until you correct one, you will not see the next one. <br><br>  <b>Now</b> , before we take the task into the development plan, we clarify all the features of accessing the API using a small checklist.  The checklist lists the points that need to be clarified, for example: <br><br><ul><li>  restrictions on the load on the service, </li><li>  the number of requests per unit time </li><li>  connection details </li><li>  white-list by ip-addresses, </li><li>  SSL certificate validation </li><li>  traffic encryption requirements </li><li>  presence of special headers in queries, </li><li>  availability of a test server with an API or the ability to send test requests to a combat server </li></ul><br>  If there is a test API, we will definitely find out what the difference is when accessing the combat server and the test server.  We take into account the differences when building requests from our application to partners in the dev and prod environments.  Such measures help us to understand whether the systems are ready for our requests or if we need additional settings. <br><br><img src="https://habrastorage.org/webt/bw/jz/f1/bwjzf19losfdd62xwajd3ww6ris.png" width="800"><br><br>
<h2>  Manually sending API requests </h2><br>  <b>Previously,</b> we immediately wrote the code according to the partner‚Äôs specification, made up the TZ, revised it, tested it.  And at the stage of integration tests, it turned out that not everything written in the specification corresponds to reality - from the format of requests to the process of passing an application. <br><br>  For example, according to the spec, when accessing a method, we expect a line in the answer in a certain format, hang processing for the validity of the answer, exit the tests, and suddenly we get an array in the answer.  We find out the reasons from the developers of the partner.  They refer to outdated documentation.  Again a circle of improvements, reviews and tests. <br><br>  <b>Now</b> , as soon as we receive the documentation and connection details, we run the process through the API client.  As a rule, the tester loads the specification in Postman and simulates the complete business process of sending a loan application, checks the most popular cases with different data sets for the request.  That is, manually doing what the application will do later. <br><br>  At the manual run stage, 80% of inaccuracies in the documentation are revealed.  We describe the errors and pass on to the partner.  The partner either eliminates inaccuracies in itself, or modifies the specification.  As a result, by the time the code starts working, developers will receive working documentation. <br><br>  The most popular discrepancies are: <br><br><ul><li>  wrong request format, promise to take json, form-data was needed; </li><li>  errors in the names of the fields to be transmitted in the request; </li><li>  errors in field formats; </li><li>  the field validation rules are not specified or are wrong; </li><li>  some fields may be completely forgotten; </li><li>  absent or different from the actual description of the method response format; </li><li>  erroneous marks about the obligatory fields - ‚Äúasterisks‚Äù can stand where the field is in fact not obligatory, and vice versa; </li><li>  often, all states and statuses in which an object may be located are not documented; </li><li>  discrepancies between expected and received states of objects.  For example, at some point we are waiting for the application to be in the X state - and, in fact, according to the API, we get Y. </li></ul><br><h2>  The recipe for happiness: how to avoid errors when integrating API </h2><br>  Write a specification for integration with your service.  We spent on the development of specifications in YAML for two days, but now we save dozens of hours on modifications and approvals. <br><br>  If the partner submits its specification, check it on the checklist.  In the checklist, collect questions that need to get answers.  Do not rely on experience and memory, anyway miss something. <br><br>  Get a glossary of terms to avoid discrepancies with your partner.  Our experience has shown that the differences can even be in obvious terms. <br><br>  Do not take the task into development until you receive from the management a principle approval of integration with a partner.  The idea is obvious, but it helps us to avoid wasting work. <br><br>  Get a checklist to clarify the peculiarities of accessing the partner's API: connection details, white-list, SSL certificate validation, traffic encryption requirements, etc. Check the checklist as early as possible in order to avoid slipping during the final stages. <br><br>  Received the specification - do not rush to write the code immediately.  First, manually run the process through the API client, for example through Postman.  So you will find errors in the specification at an early stage and with small resources.  And they will. </div><p>Source: <a href="https://habr.com/ru/post/441152/">https://habr.com/ru/post/441152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441140/index.html">Development under WebAssembly: real rake and examples</a></li>
<li><a href="../441142/index.html">12 points of growth conversion, or content that really sells</a></li>
<li><a href="../441146/index.html">Industrial wireless networks: which one to choose?</a></li>
<li><a href="../441148/index.html">How to handle errors correctly: silence is not always good</a></li>
<li><a href="../441150/index.html">The first acquaintance with the HTTP protocol by writing a simple Java Web server</a></li>
<li><a href="../441158/index.html">How ethics became the most expensive problem of Silicon Valley, and philosophy - its most practical solution</a></li>
<li><a href="../441160/index.html">How to learn to determine when to say ‚Äúno‚Äù</a></li>
<li><a href="../441166/index.html">We get the master password from the password manager 1Password 4 blocked</a></li>
<li><a href="../441168/index.html">QUIC DataChannels: First Steps</a></li>
<li><a href="../441170/index.html">The head of "Roskosmos" does not believe in Mask's ability to create a rocket engine, superior to Russian developments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>