<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application launch in Vkontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is aimed at novice developers who want to run their application in a social network. 

 The article describes the personal experience of c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application launch in Vkontakte</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/16d/9d8/474/16d9d84747e8426f5dc93490766b0404.png" alt="image" align="right">  The article is aimed at novice developers who want to run their application in a social network. <br><br>  The article describes the personal experience of creating an IFrame application, from scratch, for Vkontakte, as well as all the events that occurred during the launch and after, and, of course, the errors made.  You can even say that this is not really an article, but rather a story. <br><br>  In addition to the story, there are load reports, an attempt to monetize, server information and code analysis.  Therefore, you can switch to your points of interest. <br><a name="habracut"></a><br>  The application as an example will be a snake, with a slight modification. <br>  Impatient, link: <a href="http://vk.com/classic_snake">vk.com/classic_snake</a> <br>  Here you can change the code (no user rating): <a href="http://js.do/usr753/snake">js.do/usr753/snake</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Content </h4><br>  <a href="https://habr.com/ru/post/220679/">A bit of history</a> <br>  <a href="https://habr.com/ru/post/220679/">First problems</a> <br>  <a href="https://habr.com/ru/post/220679/">Monetization</a> <br>  <a href="https://habr.com/ru/post/220679/">Server, Application, Load</a> <br>  <a href="https://habr.com/ru/post/220679/">Application process</a> <br>  <a href="https://habr.com/ru/post/220679/">Snake inside</a> <br>  <a href="https://habr.com/ru/post/220679/">What awaits you after the publication of the application</a> <br>  <a href="https://habr.com/ru/post/220679/">findings</a> <br><a name="a1"></a><br><h4>  A bit of history </h4><br>  A few months ago, on Habr√©, there was a series of posts with the title "Playing 30 lines of code."  And it so happened that I came across this post <a href="http://habrahabr.ru/post/202476/">http://habrahabr.ru/post/202476/</a> there described the creation of a simple snake, not having had time to finish reading it to the end, I rushed to write my own.  And as I wrote, I played a little and abandoned the case for a long time. <br><br>  But soon, he was eager to try himself in a new sphere, in the development of applications for social networks.  Moreover, the game was already ready and gathering dust in a dark, forgotten directory.  And the platform itself promised such nishtyak as - access to a large audience, zero costs for promotion (under certain conditions).  Convenient API and monetization, in many ways. <br><br>  It remains only to modify and download, which I actually did. <br><a name="a2"></a><br><h4>  First problems </h4><br>  After adding the application to VKontakte, it is available for installation by a direct link, but is not available in the search and is not displayed in the general directory. <br><br>  On the account you need to have 10 votes (local currency VK, 10 votes == 70 rubles), in order to send the application for moderation, if everything is normal and it complies with the rules, it is added to the catalog of new applications, and the written off votes are returned back.  And if something is wrong, your 10 votes will not be returned.  The application can be sent again, after eliminating the inconsistencies. <br><br>  After the application has successfully passed the moderation, it gets to the third position in the directory of new applications and then goes down, and soon disappears completely.  The first two positions, in new applications, seem to be paid and cost about 1000 votes. <br><br>  There are still unspoken rules that are not written anywhere, they can only be learned from the verifier. <br>  Sent the game to moderation.  I did not have to wait a long time for an answer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/263/8ef/137/2638ef13757e9c5d4f7f1f0fdb07f360.jpg" alt="image"><br><br>  And here I had to study their API, write a rating script that interacts with my database and an additional module on JS.  Thus, my test application from a single file evolved into a not entirely simple one.  The application itself was engaged in free time.  When I did everything I needed, I sent it for a second check, and went to bed. <br><br>  When I woke up in the morning, I saw a text message coming up: ‚ÄúYour application has been approved and added to the directory ... and something else there.‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c80/925/57b/c8092557b519586a6da532f4cc3a66d7.jpg" alt="image"><br><br>  Immediately rushed to watch.  The game was installed by 57 people, after a minute it updated the page - 100 people, 200, 300, 400. I spent the whole day pressing F5.  By evening, there were about 2000 people who installed the application. The next day, twice as many.  After a couple of days, the excitement was already gone and the participants were perceived as simple numbers.  By the way, the moderator returned 10 votes, thanks to him more. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/765/b81/b76/765b81b761c5229d4aa17ddf31a72716.jpg" alt="image"><br><br><a name="a3"></a><br><h4>  Monetization </h4><br>  The application was considered a test and its monetization was not planned.  After a couple of weeks I decided to hang ads from VK partners, chose a preloader (pop-up ads before downloading the application).  It is not allowed to choose an advertising partner, but only from the list of recommended ones. <br><br>  At that moment, the application itself went down and there was no such influx of the audience as before.  When the advertisement was hung there were about 2,000 unique visitors per day, the next day was 1,700 and less and less every day.  Now, the game is not in new applications, i.e.  It does not weigh on the main one as before, but it can be raised for 1000 votes. <br><br>  After a couple of weeks, after the application disappeared from the main page, 50-250 people visit it daily.  The same is the influx of the audience, but a small, 5-20 people a day. <br><br>  The graph shows how people find it: <br><img src="https://habrastorage.org/getpro/habr/post_images/902/203/97b/90220397b03fcaedb9ba58a342158e30.jpg" alt="image"><br><br>  It also happens that people delete the application. <br><img src="https://habrastorage.org/getpro/habr/post_images/8cb/314/346/8cb314346e9bd20b251fe48286e79ef0.jpg" alt="image"><br><br>  And the earnings from the preloader for 2 months amounted to 76 rubles, for 4500 hits. <br><br>  But the preloader itself is not shown to everyone, but only if the user fits ‚Äúcertain parameters‚Äù, which is 40-60% of the audience.  These parameters are set by the advertiser, thereby choosing "his" target audience, which will be shown advertising. <br><br>  These parameters include: interests, tastes, books, your music, your browser and all that you yourself indicated on your page.  In a word - Targeting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/054/0e6/707/0540e6707c592684c121ebfd2ad91a88.jpg" alt="image"><br><br><a name="a4"></a><br><h4>  Server, Application, Load </h4><br>  The server was a simple VPS with the following characteristics: <br>  Debian 32-bit, RAM: 512mb, CPU: 500Mhz * 2 - all this for 210 rubles per month. <br><br>  Installed software: <br>  Nginx - to distribute statics, and for data processing, nginx redirects requests to Apache2 + PHP + MySQL. <br><br>  The game itself is written in HTML (4.0) + JavaScript and some CSS, without the use of frameworks and without different libraries. <br><br>  All this was collected from different js / css modules into one file and passed through YUI Compressor for compression.  As a result, there was one html file weighing 20-30kb, a full-fledged game with a rating + a couple of pictures, one for the background, the second - a loader, for displaying the download. <br><br>  These few kilobytes gave more than one and a half gigabytes of traffic.  According to this, if your application weighs a lot, get ready to pay for traffic. <br><br>  Visitors for all time: <br><img src="https://habrastorage.org/getpro/habr/post_images/a81/43f/373/a8143f37323e8c3d48086a32194aa605.jpg" alt="image"><br><br>  As for the load, the maximum number of visitors per day was 6 thousand people. <br><img src="https://habrastorage.org/getpro/habr/post_images/dac/e28/4d8/dace284d85d8c95f629ce249254969af.jpg" alt="image"><br><br>  Maybe for some it is not enough, but I honestly did not expect that the server will survive.  I was frightened by various articles that they say the server needed cool.  And as it turned out, this ‚Äúa lot‚Äù is used by 5-20% of resources out of 100. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c7/df9/bfb/4c7df9bfbebfc719106403f699e2d80f.jpg" alt="image"><br><br>  The processor load did not rise above 12% and then, if it went up for a second and immediately became 0%, it usually jumps from 0 to 4%. <br>  And the use of RAM did not exceed 200MB, even when the InnoDB buffer with 8mb raised to 32mb, just in case. <br>  Perhaps such indicators due to the following application architecture, or because of undemanding operations. <br><br><a name="a5"></a><br><h4>  Application process </h4><br>  After the user enters the page, he downloads one html-file (game), then ajax receives a list of users (Top100, 5kb in size), his position in the rating and the score, all in XML. <br><br>  Then everything happens on the same page, nothing else is loaded from the server. <br>  The user can re-request the updated data of other participants, by pressing the button, or send their result to the server. <br><br>  After that, when the xml-list came to the client, with a score and identifier of VK users, a rating is formed.  We request data, through the API, of the first 10 users.  And we deduce: "Name + Surname and their total score."  If the user has clicked on the ‚Äúnext‚Äù button, then a new access to the API occurs, and we don‚Äôt overwrite the old data, but cache them, i.e. we will not re-access the API if we have previously received this data.  And in the database itself, we store their id'shniki, invoice and other technical information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f36/d5d/36b/f36d5d36be51c42f9006985b30a5ea59.jpg" alt="image"><br><br>  Still, the main thing is to adjust the indexes so that the data is taken from there, and not read from the disk. <br><br><a name="a6"></a><br><h4>  Snake inside </h4><br>  Let me remind you that this is a "snake", then its code will be dealt with.  If you decide to write a snake yourself, you can skip this paragraph, otherwise you will get it in the well-known phrase: ‚Äúthe killer is the butler‚Äù. <br><br>  Very few people will get into the code, for this I will describe the algorithm first, and then look at the code as well. <br><br>  First, a field is generated from simple divs.  Coordinates are listed as div identifiers that allow you to access any cell.  Next, create a snake on this field, by highlighting the cells, color and put the coordinates of the snake body into a multidimensional array. <br><br>  Then a bonus (snake food) is created.  Again, save the coordinates of the bonus to the array. <br><br>  After that, when the bonus is eaten, we collect empty cells into an array (without the cells on which the snake itself is located) and from them, we choose a different cell at random, and already make it a bonus.  If empty cells are not detected then the user is the winner. <br><br>  When moving, in the array, we change only two cells, the back one is removed, and the front one (unused by the snake), in the direction of movement we paint in the color of the snake.  And with each move we check whether we are confronted with a tail, or with a bonus. <br><br>  And in order to pass through the walls, we check if the next cell does not exist ahead, then we write to the snake coordinate array, if we write - 0 (the first position, the beginning of the line), or the last one.  Depending on the direction of movement. <br><br>  Example: <br>  X = 100.  Y = 200. <br>  The snake moves the side of X ++, from zero position. <br>  0,1,2,3..99, [if there is no cell and the direction does not change, then we write to array 0 along x].  And with Y, the same thing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/39d/928/2db/39d9282db7f04a46c46f50e5e8d91679.jpg" alt="image"><br><br>  Now we will disassemble small modification. <br><br>  In this modification, I made a bonus to escape from the snake.  After some time, the bonus changes direction, and if it collides with a snake's tail, and not its head, it eats it.  And she will eat until nothing of the snake remains, but she can be saved if she turns from the direction of the bonus. <br><br>  There are two timers, at different speeds, which move the bonus and the snake.  It would be possible to do everything in one timer, but then the speed would be the same, because  You need to go through every cell, do not jump. <br><br>  Still faced with the problem that when moving towards each other, the bonus and the snake, the first is not eaten.  Due to the fact that they move independently.  When the check occurs, the bonus has already moved to another cell. <br><br>  I solved the problem.  Delivered to a separate method, collision check code.  Next, put this method to the bonus and to the snake. <br><br><a name="a7"></a><br><h4>  What awaits you after the publication of the application </h4><br>  Since the application was originally planned without a rating, it was completely made in JavaScript, on the client side, that is, all the code is available to everyone and everyone who knows could send their number to the place of the earned result. <br><br>  The main filters on the "important" sites were exposed.  But the control of the incoming result was weak and the real result could have come, and such a ‚Äú999999‚Äù could have come.  Moreover, such a result came from schoolchildren who used hacking programs like ‚ÄúCharles,‚Äù as I happily told them in a personal, from their real accounts and from real ip-addresses. <br><br>  Wrote a method that duplicated the result.  In one parameter, a real, in another, encrypted result was transmitted by replacing the symbol with a key.  And further, on the server both are compared and if something does not match, then - ban on account. <br><br>  And yet, the server sends the generated key on the first access.  The client must return it with the result.  Without this key, the result will not be accepted and if everything matches, and everything passes the test, the result is written to the database, and a new key is generated, which is again given to the client.  This is done in order to re-request with the result could not send, as is done in the program "Charles". <br><br>  Here, the students already dropped out.  Students who know JavaScript began to write in a personal. <br><br>  After the introduction of additional checks, no one seems to be writing.  Since only one attempt, and in which case the ban account VK. <br><br>  And so, for good, all computational processes need to be transferred to the server, so that nothing can be replaced, but, that very high load is possible here. <br><br>  They will also write the scammers offering to buy an application from you from 3000 rubles and up to $ 3000, which, if you google it, you can come across not very flattering reviews about them. <br><br>  Schoolchildren, with different business proposals, become the admin of a group, or the admin of an application.  They will also ask: ‚Äúin which program did you create this game?‚Äù <br><br>  Advisors who know how best to develop your application. <br>  Trolls, where do without them. <br><br><a name="a8"></a><br><h4>  findings </h4><br>  Financial side: <br>  <b>Domain</b> - 200 rubles per year. <br>  <b>SSL Certificate</b> (required) - the first year is free at startssl.com, and so, it costs from 1500 rubles.  Self-signed certificate is not suitable. <br>  <b>VPS</b> - 420rub for two months. <br>  <b>Spent on promotion</b> - 0 rubles.  True, I threw 100 rubles on advertising, purely to see what would happen.  25,000 hits.  12 transitions.  5 installations. <br>  <b>Advertising revenue</b> - 76 rubles. <br>  <b>Profit</b> : -544rub + elapsed time. <br><br>  But the main thing is the enjoyment of the process. <br><br>  If you develop an application aimed at profits, then only with the methods of retaining users, because with time they will decrease. <br><br>  Monetization through advertising should be considered as an additional source of income, and not as a main source, if the daily number of users exceeds the thousandth threshold. <br><br>  Therefore, there are so many applications that sell virtual goods for real money, because it is not profitable otherwise. <br><br>  And finally, browser statistics: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d47/50a/963/d4750a96333ce71e0d9dd19d1a8b806f.jpg" alt="image"><br><br>  And the daily time of user activity: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c0/afb/233/0c0afb2331eef119065c17be965e9a5c.jpg" alt="image"><br><br>  Screenshots with statistics from Vkontakte and Yandex-Metrics. <br><br>  Thank you all for your attention. </div><p>Source: <a href="https://habr.com/ru/post/220679/">https://habr.com/ru/post/220679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220665/index.html">Regulation of SMS spam. Let's ponder?</a></li>
<li><a href="../220667/index.html">Data recovery from monolith flash drives</a></li>
<li><a href="../220671/index.html">Training Round RCC 2014 Warmup</a></li>
<li><a href="../220673/index.html">NASA has published a long-term plan for landing a man on Mars</a></li>
<li><a href="../220675/index.html">Customer interaction with an outsourcing company</a></li>
<li><a href="../220681/index.html">Common Web Designer Mistakes or How to Please the Layout Designer</a></li>
<li><a href="../220685/index.html">Network between offices with VLANs based on Mikrotik equipment</a></li>
<li><a href="../220687/index.html">Custom types in Qt over D-Bus</a></li>
<li><a href="../220689/index.html">As I wrote a custom locker</a></li>
<li><a href="../220695/index.html">HR research. The most popular programming language in the Siberian region, the average wage level and where our programmers want to move</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>