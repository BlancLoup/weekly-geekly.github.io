<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Expel evil spirits from the ReadyNAS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr√© already has several articles on the security of various devices from the so-called ‚ÄúInternet-things‚Äù sphere: home routers, smart TVs, NAS device...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Expel evil spirits from the ReadyNAS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ccd/bad/fc6/ccdbadfc6ea843fe99ee7414c337ca0a.png" align="left"><br>  Habr√© already has several articles on the security of various devices from the so-called ‚ÄúInternet-things‚Äù sphere: home routers, smart TVs, NAS devices, etc. <br><br>  This article tells about the features of NAS models ReadyNAS.  An article about how I managed to drive a stranger out of a NAS device, which was very well established there.  Looking ahead, I would say that the information gathered was not enough to say who the stranger was: a hacker with a human face and self-interest or an insensitive virus.  Therefore, in the title of this article appears the impersonal word "evil". <br><br>  One day, my friend called me and asked: ‚Äúlook what‚Äôs wrong with this piece of iron?  well, I keep films on it ... well, you understand what I mean! ‚ÄùAnd then the descriptions of the symptoms followed.  It was an ordinary working evening, and my head was already thinking not super.  Of course, from the telephone conversation, I really did not understand.  But I decided not to conduct interrogations by phone and arrive at the scene, personally see what and how.  I asked to disconnect the device from the Internet before my arrival. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When I arrived at his home, I still did not understand what kind of symptoms he described to me.  But just in case, I decided to look a piece of iron.  It turned out to be ReadyNAS.  The device looked quite normal in appearance; there were no special brakes or inappropriate behavior.  No unidentified users were found on the device list.  After that, I decided to still look at the logs.  So, to clear your conscience.  I had no reason to worry.  So my motivation was more likely to reassure my friend.  Like, I was carrying with a piece of iron, everything is fine in the logs, I don‚Äôt see any brakes, a false alarm.  Leaving immediately, without depicting even an attempt to really understand it was ugly.  But the logs were not so soothing.  And I realized that the evening will stand out with the struggle. <a name="habracut"></a><br><br><h4>  And what are the logs? </h4><br>  The line ‚ÄúEnabled root SSH access‚Äù was found in the logs <br><img src="https://habrastorage.org/files/ef3/783/b3a/ef3783b3a33f40f590fad455e27dfc6d.png"><br><br>  Search in Google issued a <a href="http://kb.netgear.com/app/answers/detail/a_id/24586/~/add-ons-for-raidiator-5.x-(arm)">page with a description of the utility</a> .  Judging by the description, the utility was designed to provide root access to the device via SSH.  And the root password should be the same as the user admin.  The admin user was used by us to access the device via the web interface.  Fellow swore that he did not put this plugin. <br><br>  I will make a small digression.  ReadyNAS devices are divided into those where the ReadyOS OS and RAIDiator are installed. <br>  In the case of ReadyOS, the included SSH server can be seen among other services through the web interface. <br><br><img src="https://habrastorage.org/files/4ab/fff/6cb/4abfff6cb46045fd9289d960e16991fb.png"><br><br>  But with RAIDiator, the SSH server is available after installing the <b>enable root</b> plugin.  After this procedure, there is no <b>enable root</b> in the plug-in lists, and no information about the enabled SSH server appears in the list of services: <br><img src="https://habrastorage.org/files/034/307/aed/034307aed5bf4090abf0ec967b40e3f9.png"><br><br><img src="https://habrastorage.org/files/01f/2a4/a1d/01f2a4a1d0ab4b60abed744c5177281b.png"><br><br>  So  On systems running RAIDiator, it can be revealed that the uninvited guest in the device is somewhat more problematic. <br><br>  Having executed the trite <b>telnet 192.168.0.1 22,</b> I made sure that the SSH server really works.  But it failed to log in as root - the intended admin password did not fit.  Authorization from admin led to reset the session.  As it turned out, besides the root user, the rest of the device in <b>/ etc / passwd</b> was written <b>/ bin / false</b> <br>  It can be assumed that the attacker has changed the password.  I thought, ‚ÄúGreat!  The rogue has no physical access to the device, but there is root access.  And I have physical access ... but what's the use?  After all, there is no root access.  And how to solve the problem? ‚ÄùThe first thing that comes to mind is resetting the device to factory settings.  But the last thing I wanted to do was this: I had to merge terabytes of films somewhere.  The procedure is not fast.  And I didn‚Äôt really want to come the second time.  And I began to look for alternatives. <br><br><h4>  Decision </h4><br>  Further description of the solution takes very little text, but it took a lot of time and nerves.  The first thing I tried was to upload this <b>enable root</b> plugin on the device in the hope that it would reset the root password.  I hoped that the plugin simply overwrites / etc / shadow for root with the default password.  The plugin was successfully filled, the device rebooted.  But the problem is not solved. <br>  The next step I decided to try to update the firmware of the device, if it is not the latest version.  Suddenly it will overwrite the system files and the problem will be miraculously solved? <br><br><img src="https://habrastorage.org/files/d1d/f3c/0ee/d1df3c0eeb7a40f3be915eb003ae11a3.png"><br><br>  The firmware was not the latest version, an update was available.  I pressed the treasured button.  The system warned that the procedure will take time and I will be notified of the result at the end.  However, the result turned out to be negative: a mismatch of checksums.  I began to feel that I could hardly go to bed early ... And even if I could, in a dream, I would be tormented by thoughts like: ‚Äúwhy should I throw this rascal out of the system?‚Äù And you can forget about a good dream anyway.  My head completely refused to work, and I didn‚Äôt find anything better than just poking the ‚ÄúUpdate‚Äù button, in the hope that the device would stop being naughty and update ... Did I believe that it would end well?  Hardly.  I did not know what to do anymore, there was not so much left of the former fighting spirit.  But by some miracle, the system has actually been updated since the 5th and went to reboot.  It was a real miracle!  After that we successfully logged in from root with password from admin. <br>  Once on the device, I ran through the file system and logs, hoping to find traces of the presence of a stranger.  But I could not find them: the <b>last</b> team showed information only about my own visit.  A file with a history of commands ( <b>.bash_history</b> ) was completely absent.  And in the file <b>/var/log/auth.log</b> there was also information only about my visit.  So  it was not possible to find out when the device was compromised, from which IP address and which commands were executed.  The only evidence was the date and time of the initial installation of the <b>enable SSH root</b> plugin in the web interface logs.  Yes, we can say that some unnoticed code remained in the device, which works with the privileges of the root.  But the decision to reinstall the system is not for me, but for my friend.  But he decided not to do it yet.  In addition, as it turned out after the interrogation with predilection, it was the reboot of the device that was straining my friend while watching a movie.  What the attacker needed to do was to <b>enable the SSH root enable</b> plug-in.  The time of a sudden reboot coincided with the time found in the logs of the web interface regarding the installation of the <b>SSH root enable</b> .  So, perhaps, we really responded quickly and the attacker did not have time to mess things up. <br><br><h4>  Conclusion </h4><br>  I advise many of my friends and acquaintances not to give out ‚Äúwhite‚Äù IP to my devices from the ‚ÄúInternet of Things‚Äù.  You can "score" (or unwilling) to change the factory passwords on the device.  But by hiding them from public access via the Internet, you can save yourself from such unpleasant stories.  While changing the factory password is not a fact that will solve the problem.  I tell them: ‚Äúput them behind the router.  Especially since you do not have to pay for another static address.  Need access remotely?  Configure the router port forwarding correctly.  According to the port knoking technology ( <a href="http://habrahabr.ru/post/179219/">article one</a> , <a href="http://habrahabr.ru/post/194412/">article two</a> ) ‚ÄùTortured to explain in detail how to do this, wrote an article <a href="http://www.securitylab.ru/contest/448565.php">Example of a secure home LAN configuration</a> .  I hope some readers will also be helpful. <br>  And those few comrades for whom it is problematic to tweak the article due to the small knowledge in the field of network technologies ... I just ask them to fork out on the Mikrotik router and come with pre-configured settings in which I can only change the settings for the interface where the cable from the provider is plugged in <br><br>  <b>UPD:</b> Mikrotik can be useful in terms of analyzing the traffic from the studied device to the network.  Mikrotik allows you to intercept and analyze traffic very conveniently: in the config, the address of the computer is set, where the log will be analyzed, the traffic collection rule.  Next, we start Wireshark on the computer, configure it and see the traffic in real time.  More on this <a href="http://www.nasa-security.net/mikrotik/mikrotik-packet-sniffer/">here</a> .  Those.  traffic can be analyzed without taking the priests from his chair, there is no need to collect test networks. <br><br>  Although, on the device itself one could try to sniff traffic through tcpdump (if it is there, it will be necessary to take a look). </div><p>Source: <a href="https://habr.com/ru/post/240763/">https://habr.com/ru/post/240763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240747/index.html">VexorCI - a fresh look at continuous integration</a></li>
<li><a href="../240755/index.html">Ubi: hut, turn to the forest!</a></li>
<li><a href="../240757/index.html">The latest credit history or bank guide from Bankle.ru</a></li>
<li><a href="../240759/index.html">Facebook doubles anti-hacker prize</a></li>
<li><a href="../240761/index.html">Notes junior programmer: how to get the first job</a></li>
<li><a href="../240765/index.html">Openssl closed four dangerous vulnerabilities</a></li>
<li><a href="../240767/index.html">mod_proctitle - Apache module for displaying requests and brief statistics in the program name (output of top and ps)</a></li>
<li><a href="../240769/index.html">Overview of JPA-RS New Features in EclipseLink</a></li>
<li><a href="../240773/index.html">Atom - TypeScript implementation</a></li>
<li><a href="../240775/index.html">Working with a COM port in a web project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>