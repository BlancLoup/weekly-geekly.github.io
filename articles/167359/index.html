<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MintEye CAPTCHA solution in 31 lines of code without even opening the picture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inspired by the article “MintEye CAPTCHA Solution in 23 Lines of Code” , and also with the desire to get deeper into the methods of selecting image ed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MintEye CAPTCHA solution in 31 lines of code without even opening the picture</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/47b/646/8ae/47b6468ae6901204c4273d2fe2d40b4f.png" alt="image"><br>  Inspired by the article <a href="http://habrahabr.ru/post/166307/">“MintEye CAPTCHA Solution in 23 Lines of Code”</a> , and also with the desire to get deeper into the methods of selecting image edges, such as <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_%25D0%25A1%25D0%25BE%25D0%25B1%25D0%25B5%25D0%25BB%25D1%258F">the Sobel</a> <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_Canny">operator</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_Canny">the Canny operator</a> , I decided to try to repeat the algorithm described in the article myself. <br><br>  Having quickly sketched a script that loads a set of “experimental” images from <a href="http://minteye.com/">the MintEye website</a> , I was ready to open my favorite IDE to start experiments with “high technologies”, but looking in the catalog with downloaded pictures, I found one very interesting pattern. <br><a name="habracut"></a><br>  All images (in JPEG format, which is very important), related to one captcha, <b>had the same size in bytes!</b> <br><br>  “But this is impossible!” - I thought.  To explain why it is impossible, I’ll briefly remind you of the main ideas behind the JPEG compression algorithm.  For a more detailed description, welcome to <a href="http://en.wikipedia.org/wiki/JPEG">Wikipedia.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The JPEG algorithm compresses the original image in the following sequence: <br><ul><li>  Color model conversion in progress: the translation of the source image from the RGB color space to the <a href="http://en.wikipedia.org/wiki/YCbCr">YCbCr</a> color space.  After this step, the image is divided into a luminance channel (Y) and two “color difference channels” - Cb and Cr; </li><li>  Decimation (downsampling) of the Cb and Cr color channels is performed.  As a rule, simply reducing their size by half.  Due to the fact that the human eye is more sensitive to changes in brightness than color, already at this a tangible reduction in image size is achieved with very little quality loss; </li><li>  Each channel is divided into so-called “coding blocks”.  In the most common case, a “coding block” is a linear array of 64 bytes, obtained from an 8x8 pixel image block by traversing it <a href="http://en.wikipedia.org/wiki/File:JPEG_ZigZag.svg">along such a tricky trajectory</a> that resembles a “snake”; </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BA%25D0%25BE%25D1%2581%25D0%25B8%25D0%25BD%25D1%2583%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Discrete cosine transform</a> is applied to coding blocks.  I will not go into details, but after this conversion, the “coding block” turns, roughly speaking, into a certain set of coefficients, closely related to the number of fine details and smooth color transitions in the original image. </li><li>  Quantization is performed.  At this stage, the “compression ratio” or “desired image quality” option comes into play.  Again, very roughly, the idea here is that all coefficients are less than a certain threshold value (determined by the desired degree of compression), stupidly reset.  The remaining coefficients still allow you to restore the original image with some accuracy.  It is this stage that “generates” compression artifacts so well known to all; </li><li>  And finally, all that remains of our poor original image is finally “pressed on” by the lossless compression algorithm.  For JPEG, this is almost always <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B4_%25D0%25A5%25D0%25B0%25D1%2584%25D1%2584%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B0">the Huffman algorithm</a> . </li></ul><br>  What is the knowledge of the “internal kitchen” of the JPEG algorithm that can be useful for us in solving MintEye CAPTCHA?  And the fact that, knowing all this, it becomes obvious that two <b>different</b> images that have the <b>same</b> size (in pixels) and are compressed with the <b>same</b> quality settings, with a probability of almost 100% will have a <b>different</b> size in bytes!  Moreover, the largest size will have that picture, in which there are more small details, and less smooth color transitions. <br><br>  To prove this, we take an old Lena and conduct the following experiment (all three images are compressed with standard Photoshop “Save for Web”, with quality 40): <br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e5/6be/759/7e56be759098148f5767ee047f320190.jpg"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbe/9fd/6d8/fbe9fd6d8300fd46c91ad7550f924578.jpg"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/963/1fb/6be/9631fb6be68306236a2ad1bd5ae63a29.jpg"></div></td></tr><tr><td>  Gaussian Noise 5% <br>  Size: 10342 bytes </td><td>  Original <br>  Size: 7184 bytes </td><td>  Gaussian Blur 1,5px <br>  Size: 4580 bytes </td></tr></tbody></table><br>  Well, as required to prove: ceteris paribus, the more noise - the larger the file size, the greater the blur - the smaller the size. <br><br>  Why then all MintEye CAPTCHA pictures have the same size?  The secret of the focus turned out to be primitive to impossibility: the files are <b>simply padded with zeros</b> to the size of the largest of them! <br><br>  Having discovered this, almost immediately, in my head, I was born in some way a “brazen”, but extremely simple and effective solution for recognizing this, if I may say “captcha”.  Take a look at these two pictures: <br><br> <a href=""><img height="250" width="300" src="https://habrastorage.org/getpro/habr/post_images/38e/2a3/f4a/38e2a3f4a0c45a68b8d483965e1c5377.jpg"></a> <a href=""><img height="250" width="300" src="https://habrastorage.org/getpro/habr/post_images/f92/8d6/f8b/f928d6f8be961eea62fe0863d3486012.jpg"></a> <br><br>  On the left - a slightly distorted image that is one position to the left than the “correct” one.  On the right is an undistorted image, which is the correct answer. <br><br>  The left picture at first glance is curved very slightly.  But in reality, such a “twisting” at a small angle strongly “blurs” sharp boundaries and small details.  So, based on the JPEG compression features known to us, such a slightly distorted picture should differ in size from the correct one, and differ <b>sharply in a smaller direction!</b> <br><br>  In order to test such a bold assumption, I open the IDE and literally in 10 minutes write the following: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.RandomAccessFile; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MintEye</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxDelta = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> correctNum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> zeroes = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prevZeroes = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; <span class="hljs-number"><span class="hljs-number">30</span></span>; n++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) prevZeroes = zeroes; zeroes = <span class="hljs-number"><span class="hljs-number">0</span></span>; RandomAccessFile raf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RandomAccessFile( String.format(<span class="hljs-string"><span class="hljs-string">"images/%1$02d.jpg"</span></span>, n + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> fileLen = raf.length(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) fileLen - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i--) { raf.seek(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (raf.read() != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; zeroes++; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = prevZeroes - zeroes; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta &gt; maxDelta) { maxDelta = delta; correctNum = n; } raf.close(); } System.out.printf(<span class="hljs-string"><span class="hljs-string">"Correct image: %d%n"</span></span>, correctNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }</code> </pre> <br>  In a nutshell: we go through our pictures (MintEye has 30 of them), counting the number of zeros at the end of the current file and comparing it with the number of zeros at the end of the previous one.  The file for which this difference will be maximal is supposed to be the original, undistorted picture, that is, the correct answer. <br><br>  The idea was absolutely true: <b>100%!</b>  <b>10 out of 10!</b>  All downloaded sets of pictures were unmistakably recognized.  While not using absolutely no image processing libraries, and not even loading pictures into memory! <br><br>  As a result, I was once again convinced that for every tricky captcha, sooner or later there will be a “recognizer”, and my personal “collection of scalps”, added to MintEye (who can now safely turn off their startup <s>and make hara-kiri</s> ). <br><br>  Well, Habrahabr added to this article. <br><br>  PS I know that the above code is far from perfect, in particular, it will not work if the very first picture is correct.  But I did not strive for the ideal, I just wanted to illustrate the idea as briefly as possible. </div><p>Source: <a href="https://habr.com/ru/post/167359/">https://habr.com/ru/post/167359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167343/index.html">Using RichText in Android. Spannable</a></li>
<li><a href="../167347/index.html">Automated functional testing of Windows applications using Ranorex</a></li>
<li><a href="../167349/index.html">dynDNS for Amazon EC2 or how to automate IP auto-update on hosting with dynamic public IP</a></li>
<li><a href="../167351/index.html">Business Plan "Creating a Game"</a></li>
<li><a href="../167353/index.html">Sublime Text 2 for C / C ++ Developer or SublimeClang</a></li>
<li><a href="../167363/index.html">The implementation of the Euclidean algorithm on Shakespeare</a></li>
<li><a href="../167367/index.html">Deploying DNS / DDNS and DHCP servers on ROSA Enterpise Linux Server in a few minutes</a></li>
<li><a href="../167371/index.html">The release of a new program for video monitoring user actions: NetWrix User Activity Video Reporter</a></li>
<li><a href="../167375/index.html">Forwarding vlan'ov through Juniper</a></li>
<li><a href="../167377/index.html">Windows To Go Technology in Windows 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>