<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create 2D tile maps in QML. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first thought that came to me was: ‚Äúand what, in fact, is this complicated?‚Äù. 
 Well, sort of, nothing: 
 ‚Ä¢ create an array of textures, 
 ‚Ä¢ indic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create 2D tile maps in QML. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f72/174/43c/f7217443c0c345eba85b2256b4516ca2.png"><br><br>  The first thought that came to me was: ‚Äúand what, in fact, is this complicated?‚Äù. <br>  Well, sort of, nothing: <br>  ‚Ä¢ create an array of textures, <br>  ‚Ä¢ indicate the size of the card, <br>  ‚Ä¢ you loop around the array, creating objects. <br>  That's exactly what I did from the very beginning ... <br><a name="habracut"></a><br><h5>  <b>Small retreat</b> </h5><br>  I don‚Äôt want to go into the details of what tiles are, and the article is a little different about that.  It is assumed that the reader already has some idea of ‚Äã‚Äãwhat isometry is in games, what tiles are, what they are and how they are drawn.  I recall only that an elementary isometric tile is created in a ratio of 2 to 1, that is, if the width of the tile is 2 units, then its height should be 1 unit. <br>  I want to note that in my project pseudo-3D tiles will be used, whose sizes are 1 to 1. They look like this: <br><br><img src="https://habrastorage.org/files/8bb/dba/ae4/8bbdbaae42144c3b96a8734500d2e64b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      but only half of this ‚Äúcube‚Äù will be used (highlighted in red).  So far, I have not invented the use of the cut-off bottom, but most likely in the future it will be used for mountains, depressions or banal map breaks.  Then you will most likely have to use the z-index ... but that's another story <br><br>  <b><i>ps</i></b>  <b><i>At the end of the article there is a project source</i></b> <br><br><h3>  <b>The first steps</b> </h3><br>  This is how the code looked at the very beginning of my journey: <br><pre><code class="javascript hljs">property int mapcols: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-comment"><span class="hljs-comment">// -   x () property int maprows: mapcols * 3 // -   y () //  3   :   //    -    function createMap() { //         -     // (    !), //       var tilecount = mapcols * maprows //     for(var tileid = 0; tileid &lt; tilecount; tileid++) { //         var col = tileid % mapcols var row = Math.floor(tileid / mapcols) //    //   ,      //        ,    var iseven = !(row&amp;1) //    var tx = iseven ? col * tilesizew : col * tilesizew + tilesizew/2 var ty = iseven ? row * tilesizeh : row * tilesizeh - tilesizeh/2 ty -= Math.floor(row/2) * tilesizeh //  ,      var component = Qt.createComponent("Tile.qml"); var tile = component.createObject(mapitem, { "x": tx, "y": ty, "z": tileid, "col": col, "row": row, "id": tileid }); } }</span></span></code> </pre> <br><br>  That's all.  With a minimum of effort, it turned out to create such a nice card: <br><img src="https://habrastorage.org/files/fab/21a/c3c/fab21ac3c34d432ea1552be80db2efae.png"><br><br>  I will not begin to paint the contents of <b>Tile.qml</b> , because in the future we will not need this component at all.  And all because doing so is not worth it! <br>  Let me explain: by drawing a map in 4x12 sizes ( <b>mapcols * maprows</b> ) 48 objects were created.  But such a playing field is obviously too small.  If we draw a larger field, for example, a width of 20 tiles, then its height will be 60 tiles, and this is <b>1200 visual objects</b> !  It is not difficult to imagine how much memory will be used to store such a number of objects.  In a word - a lot. <br><br><h3>  <b>Reflections</b> </h3><br>  We did not have to think long for a new method of creating a map.  First of all, the main parameters of the map were identified, which should be achieved in the new method: <br>  1. the card must be movable (the player can scroll the card in any direction); <br>  2. Objects located outside the window should not be drawn; <br>  3. the method should be as simple as possible to implement%) <br><br>  The first Wishlist is very easy to implement using the <b>Flickable</b> element.  Why not?  It will not be necessary to bother with scrolling, catching events and ... in general, it is not necessary to bother at all, which fully satisfies the third point :-) the element will be named <b>map_area</b> - map_ area. <br><br>  To enable <b>Flickable</b> to move the map, you need to create an element in the flick, with dimensions equal to the full size of the map in pixels.  An ordinary <b>Item</b> is suitable for this - this item is not visual, due to which its dimensions do not affect the amount of memory consumed.  He will have the key name <b>map</b> - map. <br><br>  To draw textures, you need to use an additional element that must be located inside the <b>map</b> element.  At the same time, its size must correspond to the size of <b>map_area</b> , and in order for this element to always be ‚Äúin sight‚Äù, it must be moved to the side opposite to the map scrolling.  Those.  if the user moves the map to the left, this element should be moved to the right and redrawn. <br>  To implement this idea, the <b>Image</b> bundle with <b>QQuickImageProvider</b> could be suitable, but their capabilities are rather scarce, so you have to create your own component by resorting to the dark side - <b>C ++</b> .  The future item will be the <b>QQuickPaintedItem</b> heir and will be named <b>MapProvider</b> . <br><br><h3>  <b>From simple to ... simple</b> </h3><br>  In my view, it looked something like this: <br><img src="https://habrastorage.org/files/6b2/84e/34f/6b284e34f41c40c58edf5c31379b7f69.png"><br><br>  In code, it looks like this: <br><pre> <code class="javascript hljs">Window { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: root visible: <span class="hljs-literal"><span class="hljs-literal">true</span></span> width: <span class="hljs-number"><span class="hljs-number">600</span></span> height: <span class="hljs-number"><span class="hljs-number">600</span></span> <span class="hljs-comment"><span class="hljs-comment">//   //  ,   ?     // ""  ,         property double tilesize: 128 property double tilesizew: tilesize property double tilesizeh: tilesizew / 2 //    X   Y (   .) property int mapcols: 20 property int maprows: mapcols * 3 Flickable { id: maparea width: root.width height: root.height contentWidth: map.width contentHeight: map.height Item { id: map width: mapcols * tilesizew height: maprows * tilesizeh Item /*MapProvider*/ { id: mapprovider } } } }</span></span></code> </pre><br>  This code will be the skeleton for further work.  The next step is to create a <b>MapProvider</b> element.  To do this, create a new C ++ class in the project: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapProvider</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QQuickPaintedItem { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: MapProvider(QQuickItem *parent = <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QPainter *painter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      } };</span></span></code> </pre><br><br>  Immediately register this element in <b>QML</b> , for this we rule <b>main.cpp</b> .  Its contents should be something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QGuiApplication&gt; #include &lt;QQmlApplicationEngine&gt; #include "mapprovider.h" int main(int argc, char *argv[]) { QGuiApplication app(argc, argv); //   : qmlRegisterType&lt;MapProvider&gt;("game.engine", 1, 0, "MapProvider"); QQmlApplicationEngine engine; engine.load(QUrl(QStringLiteral("qrc:/main.qml"))); return app.exec(); }</span></span></span></span></code> </pre><br><br>  After saving the changes, this element can be used in <b>QML</b> . <br><br>  To do this, add the import module to <b>main.qml</b> : <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> game.engine <span class="hljs-number"><span class="hljs-number">1.0</span></span></code> </pre><br>  and replace the string <br><pre> <code class="javascript hljs">Item <span class="hljs-comment"><span class="hljs-comment">/*MapProvider*/</span></span> {</code> </pre><br>  on <br><pre> <code class="javascript hljs">MapProvider {</code> </pre><br><br>  In order to visually show how the method will work, I created 2 additional elements on the form: inside the window I marked the special area <b>game_area</b> , into which I moved the <b>map_area</b> element.  I deliberately made the size of the game area smaller than the size of the form, and to display the borders of this area I created the usual <b>Rectangle</b> : <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    X   Y (   .) property int mapcols: 20 property int maprows: mapcols * 3 Item { id: gamearea width: root.width / 2 height: root.height / 2 x: width / 2 y: height / 2 clip: false Flickable { id: maparea width: root.width height: root.height contentWidth: map.width contentHeight: map.height Item { id: map width: mapcols * tilesizew height: maprows * tilesizeh MapProvider { id: mapprovider } } } } Rectangle { id: gameareaborder width: gamearea.width height: gamearea.height x: gamearea.x y: gamearea.y border.width: 1 border.color: "red" color: "transparent" } }</span></span></code> </pre><br><br><h3>  <b>Wet calculations - a section in which a lot of water</b> </h3><br>  We are almost close to drawing the map, but there are some nuances that are worth paying attention to.  And the first candidate for consideration is the edges of the map.  We get them " <i>toothy</i> ."  This could be observed in the past project, but you need to get rid of this new one.  To hide the teeth on the left and the top out of sight, just move the map ( <b>Item: map</b> ) to the left and up by half the width and height of the tile: <br><pre> <code class="javascript hljs"> Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: map width: mapcols * tilesizew height: maprows * tilesizeh x: -tilesizew / <span class="hljs-number"><span class="hljs-number">2</span></span> y: -tilesizeh / <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><br><img src="https://habrastorage.org/files/518/fcd/d57/518fcdd57f4847d2a6349b6ace1a47a4.png"><br><br>  To hide the teeth on the right and below, you just need to limit the scrolling by changing the parameters <b>contentWidth</b> and <b>contentHeight</b> .  Here it is necessary to take into account the fact that we have already shifted the card itself to the left and upwards by half the size, which means that the size of the content must be reduced by the full size of the tile: <br><pre> <code class="javascript hljs"> Flickable { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: maparea contentWidth: map.width - tilesizew contentHeight: map.height - tilesizeh</code> </pre><br><br>  The implementation of moving the <b>MapProvider</b> element while scrolling looks like this: <br><pre> <code class="javascript hljs"> MapProvider { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: mapprovider width: gamearea.width + tilesizew * <span class="hljs-number"><span class="hljs-number">2</span></span> height: gamearea.height + tilesizeh * <span class="hljs-number"><span class="hljs-number">2</span></span> x: maparea.contentX + (tilesizew/<span class="hljs-number"><span class="hljs-number">2</span></span> - maparea.contentX%tilesizew + map.x) y: maparea.contentY + (tilesizeh/<span class="hljs-number"><span class="hljs-number">2</span></span> - maparea.contentY%tilesizeh + map.y)</code> </pre><br>  scary :) now I'll explain what's going on here. <br><br>  In fact, our map consists of rectangular blocks in which diamond-shaped tiles are inscribed.  This eliminates the need to redraw the visible area of ‚Äã‚Äãthe map at the slightest scrolling, you can simply select the " <i>protection zone</i> " (did not come up with a suitable name) outside the visible area, which will also be drawn along with the entire map, and you will only need to redraw the entire map when scrolling will exceed the size of this zone.  Due to this, the number of necessary redrawing of the map will decrease hundreds of times (depending on the size of the tile). <br>  In this code, this ‚Äúprotection zone‚Äù is calculated by adding twice the <b>tile</b> size to the width and height of the <b>MapProvider</b> .  Thus, we will expand the rendered area to the right and down exactly 2 tiles.  In order to spread half of this area up and to the left, it is necessary to tweak the content sizes of <b>map_area</b> and map <b>map</b> sizes: <br><pre> <code class="javascript hljs"> Flickable { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: maparea contentWidth: map.width - tilesizew * <span class="hljs-number"><span class="hljs-number">1.5</span></span> contentHeight: map.height - tilesizeh / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: map width: mapcols * tilesizew + tilesizew height: maprows * tilesizeh / <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><br>  The formula for calculating the <b>X</b> and <b>Y</b> of the <b>MapProvider</b> element provides it with <i>hopping</i> only when scrolling is outside the ‚Äúprotection zone‚Äù.  In the future, a map redrawing event will be tied to these jumps. <br><br><h3>  <b>Closer to the body</b> </h3><br>  So, with the calculations on the side of QML done, now it is necessary to determine the set of additional parameters that will be necessary for the correct drawing of the ‚Äú <i>body</i> ‚Äù of the <b>MapProvider</b> element: <br>  1. The actual position of the content in <b>map_area</b> - will be needed to calculate the numbers of columns and lines from which the map starts to draw (the drawing starts from the top left, then we find the index of the upper left tile).  I gave these parameters the names <b>cx</b> and <b>cy</b> . <br>  2. Tile sizes - necessary for drawing pictures. <br>  3. Map dimensions - will be needed to calculate the real tile index. <br>  4. Actually, the very description of the textures of the map.  I have the usual one-dimensional array with the name of resources. <br><pre> <code class="javascript hljs"> MapProvider { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: mapprovider width: gamearea.width + tilesizew*<span class="hljs-number"><span class="hljs-number">2</span></span> height: gamearea.height + tilesizeh*<span class="hljs-number"><span class="hljs-number">2</span></span> x: maparea.contentX + (tilesizew/<span class="hljs-number"><span class="hljs-number">2</span></span> - maparea.contentX%tilesizew + map.x) y: maparea.contentY + (tilesizeh/<span class="hljs-number"><span class="hljs-number">2</span></span> - maparea.contentY%tilesizeh + map.y) cx: maparea.contentX cy: maparea.contentY tilesize: root.tilesize tilesizew: root.tilesizew tilesizeh: root.tilesizeh mapcols: root.mapcols maprows: root.maprows mapdata: [ <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>, <span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span>,<span class="hljs-string"><span class="hljs-string">"0004"</span></span> ] }</code> </pre><br>  <i>ps</i>  <i>here ‚Äú0004‚Äù is the name of the image resource without an extension.</i> <br><br>  Of course, all these parameters must be declared on the C ++ side, all this is done using the <b>Q_PROPERTY</b> macro: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapProvider</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QQuickPaintedItem { <span class="hljs-function"><span class="hljs-function">Q_OBJECT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tilesize READ tilesize WRITE setTilesize NOTIFY tilesizeChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tilesizew READ tilesizew WRITE setTilesizew NOTIFY tilesizewChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tilesizeh READ tilesizeh WRITE setTilesizeh NOTIFY tilesizehChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mapcols READ mapcols WRITE setMapcols NOTIFY mapcolsChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maprows READ maprows WRITE setMaprows NOTIFY maprowsChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cx READ cx WRITE setCx NOTIFY cxChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cy READ cy WRITE setCy NOTIFY cyChanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QVariantList mapdata READ mapdata WRITE setMapdata NOTIFY mapDatachanged)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function">: </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/* ... */</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br><br>  The power of <b>QtCreator</b> 'a will allow you to easily create all these parameters with a couple of clicks (for those who do not know: call the context menu on each line <i>Q_PROPERTY -&gt; Refactor -&gt; Generate Missing Q_PROPERTY Members ...</i> ) <br><br><h3>  <b>The final</b> </h3><br>  Finally, we got to the implementation of the <b>paint</b> method.  In fact, it is not much different from the <b>createMap ()</b> function from the previous project, except that the caching of images has been added to it: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MapProvider::paint(QPainter *painter) { <span class="hljs-comment"><span class="hljs-comment">//     ,     int startcol = qFloor(m_cx / m_tilesizew); int startrow = qFloor(m_cy / m_tilesizeh); //     int tilecountw = qFloor(width() / m_tilesize); int tilecounth = qFloor(height() / m_tilesize) * 4; int tilecount = tilecountw * tilecounth; int col, row, globcol, globrow, globid = 0; double tx, ty = 0.0f; bool iseven; QPixmap tile; QString tileSourceID; for(int tileid = 0; tileid &lt; tilecount; tileid++) { //         col = tileid % tilecountw; row = qFloor(tileid / tilecountw) ; //   ,     globcol = col + startcol; globrow = row + startrow * 2; globid = m_mapcols * globrow + globcol; //        //       if(globid &gt;= m_mapdata.size()) { return; } //   ,      else if(globcol &gt;= m_mapcols || globrow &gt;= m_maprows) { continue; } //    iseven = !(row&amp;1); //    tx = iseven ? col * m_tilesizew : col * m_tilesizew + m_tilesizew/2; ty = iseven ? row * m_tilesizeh : row * m_tilesizeh - m_tilesizeh/2; ty -= qFloor(row/2) * m_tilesizeh; //       tileSourceID = m_mapdata.at(globid).toString(); //    ,     if(tileCache.contains(tileSourceID)) { tile = tileCache.value(tileSourceID); } //          else { tile = QPixmap(QString(":/assets/texture/%1.png").arg(tileSourceID)) .scaled(QSize(m_tilesize, m_tilesize), Qt::IgnoreAspectRatio, Qt::SmoothTransformation); tileCache.insert(tileSourceID, tile); } //   painter-&gt;drawPixmap(tx, ty, tile); //     painter-&gt;setFont(QFont("Helvetica", 8)); painter-&gt;setPen(QColor(255, 255, 255, 100)); painter-&gt;drawText(QRectF(tx, ty, m_tilesizew, m_tilesizeh), Qt::AlignCenter, QString("%1\n%2:%3").arg(globid).arg(globcol).arg(globrow)); } }</span></span></code> </pre><br><br>  Caching is necessary in order not to redraw the image each time, but it is redrawn due to the fact that the size of the original image is much larger than the size of the tile (this is done to implement scaling in the future).  Redrawing eats up a lot of resources, especially because <b>Qt :: SmoothTransformation is</b> used when changing the image. <br>  <i>By the way, theoretically, scaling can be implemented even now; all you have to do is add an increase factor for the <b>root</b> parameter <b>.</b></i> <br><br>  The variable <b>tileCache is</b> declared in the <b>MapProvider</b> class: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: QMap&lt;QString, QPixmap&gt; tileCache;</code> </pre><br><br>  And the final touch is adding a map redraw event by creating a pair of connections: <br><pre> <code class="cpp hljs">MapProvider::MapProvider(QQuickItem *parent) : QQuickPaintedItem(parent) { connect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SIGNAL(xChanged()), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(update())); connect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SIGNAL(yChanged()), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, SLOT(update())); }</code> </pre><br><br><h3>  <b>Release</b> </h3><br>  Well, that's all, now you can run the project and see this picture: <br><img src="https://habrastorage.org/files/577/285/768/577285768a544f8d847739f710d12a80.png"><br>  which is not much different from the picture in the first draft, but is less voracious. <br><br>  In order to see how the map is drawn in motion, you need to increase the value of the <b>root.mapcols</b> variable, setting it, for example, to <b>8</b> (this value multiplied by <b>root.maprows</b> corresponds to the number of elements in the <b>mapprovider.mapdata</b> variable; for larger values, you will need to add elements ). <br><br>  In order to hide the ‚Äúprotection zone‚Äù behind the scenes, leaving only the useful part of the map visible, it is enough to change the <b>gamearea.clip</b> parameter from <b>false</b> to <b>true</b> <br><br>  The next part will describe the process of creating a map editor based on the current project.  The editor will need to be able to save the map and load it. <br><br><h4>  <b><a href="https://vk.com/doc11085446_437245521">Source code of the current project (vk.com)</a></b> </h4></div><p>Source: <a href="https://habr.com/ru/post/276457/">https://habr.com/ru/post/276457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276447/index.html">As I wrote the game for 3 years</a></li>
<li><a href="../276449/index.html">A small comparison of online translators</a></li>
<li><a href="../276451/index.html">Ivan Grigorov: ‚ÄúFor top baghunters $ 25K per month is not a problem‚Äù</a></li>
<li><a href="../276453/index.html">New options for opening and closing tabs in the assembly Vivaldi 1.0.385.5</a></li>
<li><a href="../276455/index.html">Custom gestures, Kinect + Unity. Part 2</a></li>
<li><a href="../276459/index.html">Hack PayPal in 73 seconds</a></li>
<li><a href="../276461/index.html">Oracle will take part in the presentation of the program "Single frontal system"</a></li>
<li><a href="../276467/index.html">Dosimeter on the Internet of Things: we make a map of radioactive zones for ourselves and the whole world</a></li>
<li><a href="../276469/index.html">Product Design Digest, January 2016</a></li>
<li><a href="../276471/index.html">Waffles against technology at FOSDEM 2016</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>