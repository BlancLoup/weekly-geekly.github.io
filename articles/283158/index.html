<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL is the best NoSQL system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When considering the use cases of NoSQL, such as storing key-value pairs, it turns out that MySQL is more preferable in terms of performance, ease of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL is the best NoSQL system</h1><div class="post__text post__text-html js-mediator-article">  When considering the use cases of NoSQL, such as storing key-value pairs, it turns out that MySQL is more preferable in terms of performance, ease of use, and stability.  MySQL is a solid system with an abundance of online materials that cover all topics from basic operations and error analysis to replication and various usage patterns.  This gives MySQL an advantage over younger NoSQL systems that have no such experience. <br><br>  In recent years, NoSQL-systems have become the dominant trend.  Many developers see in NoSQL-systems, such as MongoDB, Cassandra, Redis or Hadoop, the best option for building their applications, considering them as a single product family that devalues ‚Äã‚Äãthe old SQL-systems. <br><br>  Often, the decision to use the NoSQL database is based on advertising hype or the mistaken belief that relational databases cannot provide the same performance as NoSQL databases.  When it comes to choosing a database, engineers often lose sight of operating costs, as well as considerations of stability and maturity of a technology.  To learn more about the limitations and flaws of various NoSQL (as well as SQL) systems, look at the Jepsen project series published on Aphyr.com. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, we will explain why, in our opinion, using MySQL to store key-value pairs is better than most specialized NoSQL systems, and also provide instructions for using MySQL. <br><a name="habracut"></a><br><h2>  <font color="#f9a339">Defining Wix Sites</font> </h2><br>  When someone clicks a link on a Wix site, their browser sends an HTTP request to the Wix server with the site address.  This is also the case with the Wix premium site, which has its own domain (for example, domain.com), and with a free site on the Wix subdomain (for example, user.wix.com/site).  The server must recognize the requested site at the site address, performing a key-value search for a URL-site pair.  In the following discussion, we will denote the URL as a ‚Äúroute‚Äù. <br><br>  The routes table is used to convert the site address to the site object.  Since different paths can be used to enter the site, there is a ‚Äúmany-to-one‚Äù relationship.  When the site is found, the application loads it to work with it.  The site object, in turn, has a complex structure that includes two lists of child objects ‚Äî various services used by the site.  Below is a sample model of our facilities.  Here we assume that a standard SQL database with a normalized structure is used: <br><br><img src="https://habrastorage.org/files/ff1/9e0/2b7/ff19e02b7dc549caa57eb7fd7faedc3e.png"><br><br>  When updating a site with a traditional normalized model, we need to use a transaction to update multiple tables to ensure data integrity (note that the transaction uses a lock at the database level, which prevents simultaneous writing and sometimes reading from the affected tables).  Continuing to work with such a model, we will probably get to the SERIAL type key in each table, foreign keys and index in the URL field of the routes table. <br><br>  However, data modeling based on a normalized scheme is fraught with a number of complications: <br><br>  ‚Ä¢ locks restrict access to the table, so with large amounts of data this may limit our performance; <br>  ‚Ä¢ reading an object requires either a few SQL queries (4 in our case) or using a JOIN - and this also affects the delay time; <br>  ‚Ä¢ keys with the SERIAL attribute require locking, which again limits write performance. <br><br>  These problems limit the bandwidth and parallelization of queries that MySQL (or any other SQL system) can provide for us.  Because of these weaknesses, and also due to the fact that this is essentially a key-value pair, many developers prefer to look for a NoSQL solution that provides better performance and parallelization, even at the cost of stability, integrity and availability. <br><br>  We found in Wix that MySQL, if used creatively as a repository of key-value pairs, can work better than MySQL with the normalized data model (given above), and also better than most NoSQL systems.  Our current system provides such scaling, bandwidth, query parallelization, delay times that would honor any NoSQL system.  Here are some data from our system: <br><br>  ‚Ä¢ active installation on three data centers (active-active-active); <br>  ‚Ä¢ throughput of about 200,000 RPM; <br>  ‚Ä¢ The routes table has a volume of about 100,000,000 entries, 10 GB of disk space; <br>  ‚Ä¢ table sites has about 100 000 000 records, 200 GB of disk space; <br>  ‚Ä¢ the average read delay is 1.0-1.5 milliseconds (in fact, 0.2-0.3 ms in one data center). <br><br>  Notice a delay of about 1.0 ms.  It is considered an impressive figure in most systems built on a key-value pair, including both cloud systems and open source systems.  And we achieved this using MySQL (the simplest, as is commonly believed, SQL-system). <br><br>  Here is the diagram we use: <br><br><img src="https://habrastorage.org/files/c2e/a46/bbe/c2ea46bbe16044cb80b899d94b1ac522.png"><br><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`routes`</span></span> ( <span class="hljs-string"><span class="hljs-string">`route`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`site_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`last_update_date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`key`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`site_id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`sites`</span></span> ( <span class="hljs-string"><span class="hljs-string">`site_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`owner_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`schema_version`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, <span class="hljs-string"><span class="hljs-string">`site_data`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`last_update_date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`site_id`</span></span>) ) <span class="hljs-comment"><span class="hljs-comment">/*ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=16*/</span></span>;</code> </pre> <br>  All fields that are not used as query conditions were collapsed into a single blob type field (site_data text field).  It includes the sub-obj tables, as well as any fields of the table object itself.  Note that we do not use SERIAL keys, instead we use a VARCHAR (50) type field that contains user-created GUID variables (more on this in the next section). <br><br>  Below is the query we use, it has high bandwidth and low latency: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sites <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> site_id = ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> site_id <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> route = ? )</code> </pre> <br>  Here, first a query is made to the routes table using a unique index; the query must return only one value.  Then we browse the sites by the primary key, again looking for one value.  The nested syntax allows you to process both SQL queries in one call to the database. <br><br>  The result shown above requires approximately 1 ms.  consistent work in high traffic and high frequency of updates.  Semi-transactional updates, even without the use of transactions.  This is possible due to the fact that we enter the entire site with a single INSERT command and, until we enter data into routes, requests will not detect it.  That is, when we enter data about a site first, and then about paths, we are sure of the integrity of our data, even in a border situation, while our data in the sites table are not connected. <br><br>  Instructions for using MySQL as a NoSQL system <br>  Using the experience gained in the example described above (and other similar cases from Wix practice), we developed a short list of recommendations for using MySQL as a NoSQL system. <br><br>  The main thing to remember when using MySQL as a NoSQL system is to avoid locks at the base level and complex queries. <br><br>  ‚Ä¢ Do not use transactions that involve locks.  Instead, use transactions in the application; <br>  ‚Ä¢ Do not use SERIAL keys.  Such keys entail blocking and complicate the configuration of the active-active type; <br>  ‚Ä¢ use unique keys created by customers.  We use GUID. <br><br>  Optimizing the structure for reading, pay attention to a few additional recommendations: <br><br>  ‚Ä¢ do not perform normalization; <br>  ‚Ä¢ if there is a field - it should be indexed.  If the field for the index is not needed, save it in one field of type BLOB / TEXT (as JSON or XML); <br>  ‚Ä¢ do not use foreign keys; <br>  ‚Ä¢ design your structure so that upon request you can read a separate series; <br>  ‚Ä¢ Do not use the ALTER TABLE statement.  These commands entail blockages and periods of temporary inoperability.  Instead, use Live Migration data migration. <br><br>  When requesting data: <br><br>  ‚Ä¢ look for records by primary key or by index; <br>  ‚Ä¢ do not use JOIN; <br>  ‚Ä¢ do not use aggregation functions; <br>  ‚Ä¢ run validation functions (BI, data mining) on ‚Äã‚Äãreplicas, and not on the head base. <br>  We are planning to write another article where we will tell in more detail about the migration of Live Migrations data and transactions through the application. <br><br><h2>  <font color="#f9a339">You can think in new ways</font> </h2><br>  Perhaps this is the most important conclusion from this article.  It's great to use MySQL as a NoSQL system, that is, not the way it was designed.  As shown in this article, an example is the use of MySQL for working with key-value pairs instead of NoSQL-systems specially designed for this.  In Wix, we chose MySQL to work with key-value pairs (and not only), because it is easy to use, easy to manage, and it is a great ecosystem.  As a bonus, it provides latency, throughput, and parallelization rates, which are almost the same as most NoSQL systems. <br><br>  Chief Software Architect for <a href="http://ru.wix.com/">Wix site creation</a> , <br>  Yoav Abrahami <br><br>  Original article: <a href="http://blog.wix.engineering/2015/12/10/scaling-to-100m-mysql-is-a-better-nosql/">Wix engineers blog</a> </div><p>Source: <a href="https://habr.com/ru/post/283158/">https://habr.com/ru/post/283158/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283148/index.html">Why not use Backbone.js in 2016</a></li>
<li><a href="../283150/index.html">IBM TrueNorth-based computer chip helps predict epileptic seizures</a></li>
<li><a href="../283152/index.html">Meteor + MVVM =</a></li>
<li><a href="../283154/index.html">The digest of interesting materials for the mobile # 152 developer (May 4-9)</a></li>
<li><a href="../283156/index.html">PostgreSQL in Azure. Part 1</a></li>
<li><a href="../283160/index.html">Expectations of development directions in the field of data storage and processing until 2020. Key Trends</a></li>
<li><a href="../283162/index.html">Composition of functions on F # and Scala</a></li>
<li><a href="../283166/index.html">The easiest way to create a website</a></li>
<li><a href="../283168/index.html">R: processing missing values</a></li>
<li><a href="../283172/index.html">Digest of fresh materials from the world of frontend, design and IT for the last week ‚Ññ210 (May 2 - 8, 2016)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>