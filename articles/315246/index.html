<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Repair a damaged NTFS partition if it has been reduced to the minimum size (0 bytes free)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When redistributing hard disk partitions on a laptop, by inattention, I did not leave any free space for the partition with the NTFS file system. The ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Repair a damaged NTFS partition if it has been reduced to the minimum size (0 bytes free)</h1><div class="post__text post__text-html js-mediator-article">  When redistributing hard disk partitions on a laptop, by inattention, I did not leave any free space for the partition with the NTFS file system.  The system at that time was Linux Mint 18, although, in fact, it does not matter.  After the redistribution of the place, I was horrified.  When I tried to mount this section, I got an error: <br><a name="habracut"></a><br><h3>  Failed to attach Volume 101 GB </h3><br><blockquote>  Error mounting / dev / sda4 at / media / dashka / B490E48B90E45600: command line `mount -t" ntfs "-o" uhelper = udisks2, nodev, nosuid, uid = 1000, gid = 1000 "" / dev / sda4 "" " / media / dashka / B490E48B90E45600 "'exited with non-zero exit status 13: Failed to load runlist for $ MFT / $ DATA. <br>  highest_vcn = 0x204f, last_vcn - 1 = 0x263f <br>  Failed to load $ MFT: I / O Error <br>  Failed to mount '/ dev / sda4': I / O Error <br>  NTFS is either inconsistent, or there is a hardware fault, or it's a <br>  SoftRAID / FakeRAID hardware.  In the first case run chkdsk / f on Windows <br>  then reboot into Windows twice.  The usage of the / f parameter is very <br>  important!  If the device is a SoftRAID / FakeRAID then first activate <br>  / dev / mapper / directory, (eg <br>  / dev / mapper / nvidia_eahaabcc1).  Please see the 'dmraid' documentation <br>  for more details. </blockquote><br>  Putting the Windows was completely reluctant, there was practically no free memory on the laptop.  I suffered a lot for a long time, I tried a lot, but, nevertheless, I found a way out.  So, first we need another PC with free space, which is enough for a full backup of the damaged partition, or we need as much space on the affected computer.  The latter, of course, is much simpler than the first. <br><br><h3>  If there is enough space on the affected computer. </h3><br>  In this case, download the <a href="http//www.cgsecurity.org/wiki/TestDisk_Download">testdisk</a> utility. <br><br>  Next, it is advisable to make an exact backup of the damaged partition to the external media, how to do it correctly, I will describe in more detail in the second method, when we do not have enough space.  Everything is clear with this utility, I didn‚Äôt even have to compile it.  I just ran the testdisk_static executable.  Then you can figure it out yourself.  If it did not work, then you should use the photorec utility.  It also runs, and comes bundled with the testdisk utility, in the same folder.  The cons of the photorec utility is incomplete recovery, that is, all files will be interspersed and the creation date, changes, name, and so on will be lost.  The maximum that you can - is to sort that where. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">mv /////*.{jpg,png} ./Photo mv /////*.mov ./\  mv /////*.mp4 ./</code> </pre> <br>  Etc. <br><br><h3>  If there is not enough space on the affected computer. </h3><br>  In general, everything is similar to the first option, BUT: first, you need to make an exact copy of the broken partition from the affected computer to the computer, where there is enough memory to perform the operations above.  This can be done by connecting computers with USB-to-USB, over a local network, or via the Internet.  I'm not a special craftsman, so for the second option, I thought of just using ssh. <br><br><h3>  How to make this backup </h3><br><pre> <code class="bash hljs">sudo dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/sdaX bs=8192 | ssh hostname <span class="hljs-string"><span class="hljs-string">'dd of=/home/user/backup.img bs=8192'</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'all right'</span></span> &gt; ~/DD.log || <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> &gt; ~/DD.log; ssh hostname poweroff; sudo shutdown</code> </pre><br>  X - the number of the damaged section, look in programs like GParted or in the description of the error itself.  ssh hostname - is replaced with your ssh configuration (in my case, this is 'ssh -p 31182 -i .ssh / id_rsa nikitosios@192.168.1.10').  Backup 100 GB I took all night, about 10-11 hours. <br><br><div class="spoiler">  <b class="spoiler_title">Explanation of the code above and some usefulness</b> <div class="spoiler_text">  The most important thing to say is: to keep track of the backup process, you need: <br><br>  1) Start another terminal. <br><br>  2) Register <code>ps -a</code> and find the PID of the dd utility. <br><br>  3) Register <code>while true; do sudo kill -USR1 [PID  dd] ; sleep 10; done</code> <code>while true; do sudo kill -USR1 [PID  dd] ; sleep 10; done</code>  <code>while true; do sudo kill -USR1 [PID  dd] ; sleep 10; done</code> and enter the password. <br><br>  4) Look at the execution process in the terminal where the dd utility is running. <br><br> <code>&amp;&amp; echo 'all right' &gt; ~/DD.log || echo '' &gt; ~/DD.log</code>  <code>&amp;&amp; echo 'all right' &gt; ~/DD.log || echo '' &gt; ~/DD.log</code> is a command to look in the morning whether everything was copied normally or not.  The result will be recorded in the DD.log file in your home folder. <br><br> <code>ssh hostname poweroff; sudo shutdown</code>  <code>ssh hostname poweroff; sudo shutdown</code> - turn off computers. <br></div></div><br>  Well, we have an exact copy of the section.  What next to do with it?  And then I had to make a rather cunning move.  Since testdisk and photorec are only looking for devices connected to a PC, you need to set our image as a device.  For this, I created a symbolic link like this: <br><br><pre> <code class="bash hljs"> ln -s /dev/sdv /home/user/backup.img</code> </pre> <br>  Sly, is not it?  Now you can safely restore our / dev / sdv using the example described under the heading "If there is enough space on the affected computer." <br><br>  First, I advise you to try the <b>S-trace</b> user method: <br>  Put VirtualBox, put windows into it (discard the ideological side - the question is purely technical), then (after installing windows) forward the physical disk to the virtual machine using the command vboxmanage internalcommands createrawvmdk -filename ~ / sda.vmdk -rawdisk / dev / sda (maybe you will have to wrestle a little with the carrier system for the right of direct access to / dev / sda). <br>  a) From under windows try to run chkdsk this section. <br>  b) Or expand it back with standard disk tools. <br>  c) If the partition is mounted but not writable, you can copy data through the VirtualBox ‚Äúshared folder‚Äù or over the network between the virtual machine and the system. <br><br>  <b>PS</b> With a testdisk you have to dance, so for a start it is better to restore everything with a photorec, and if the result does not suit you, then you can dance with a testdisk. <br><br>  Well that's all.  I hope someone will help this post. </div><p>Source: <a href="https://habr.com/ru/post/315246/">https://habr.com/ru/post/315246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315234/index.html">The best IT vacancies on My Circle in a week, October 24-30</a></li>
<li><a href="../315236/index.html">How to solve simple optimization problems on python using cvxpy</a></li>
<li><a href="../315240/index.html">Testing Mobile Applications: Interview with Dan Cuellar (Appium)</a></li>
<li><a href="../315242/index.html">The media learned about the new way to intercept passwords and PIN-code from mobile phones</a></li>
<li><a href="../315244/index.html">JetBrains Night in Moscow. Video. Integrating JetBrains server products with each other</a></li>
<li><a href="../315248/index.html">Connect (); // 2016: Program, Live Broadcast and Bonus</a></li>
<li><a href="../315252/index.html">Creating a blog engine with Phoenix and Elixir / Part 3. Add roles</a></li>
<li><a href="../315254/index.html">Simple migrations with PHPixie Migrate</a></li>
<li><a href="../315256/index.html">A smart reference for css-properties for a beginner</a></li>
<li><a href="../315258/index.html">Comparing objects by value - 4, or Inheritance & Equality operators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>