<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alternative implementation of the many-to-many relationship in Oracle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The benefits of nested tables, or, as they are also called, child tables ( NESTED TABLE ), are rather doubtful for two reasons: you cannot create fore...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alternative implementation of the many-to-many relationship in Oracle</h1><div class="post__text post__text-html js-mediator-article"> The benefits of nested tables, or, as they are also called, child tables ( <code>NESTED TABLE</code> ), are rather doubtful for two reasons: you cannot create foreign keys ( <code>FOREIGN KEY</code> ) for types and objects, and it is very easy to implement functionality using an additional table.  And it would be possible to find other advantages for nested tables, if not for the fact that after creating the main table, the column of the nested table cannot be changed.  You can, of course, create a second type and use it, but this is a fairly large amount of work and, undoubtedly, a lot of concern about existing data. <br><br>  However, I had the idea of ‚Äã‚Äãimplementing many-to-many interconnections ( <code>MANY-TO-MANY RELATIONSHIP</code> ) using a nested table, because the idea is so tempting ‚Äî instead of a single foreign key, you can store them for a specific record ‚Äî which could be more logical from a human point of view. logic?  But then the question arose - is the game worth the candle? <br><a name="habracut"></a><br><h4>  Example </h4><br>  Using the example, it is easier to show the proposed structure, and it is also a good way to check which method loads the system less. <br><br>  Suppose there is a bus depot spherical in a vacuum.  The bus fleet has several buses and several drivers.  There are several drivers driving the same bus (several shifts).  Features of this park are such that one driver can also ride on several buses, for example, depending on the day of the week. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will create two very simple tables intended only to create relationships between them. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> tab_bus <br> ( b_id NUMBER <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> <br> , bus_number VARCHAR2(9) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> <br> ); <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">SEQUENCE</font> seq_bus; <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> tab_driver <br> ( d_id NUMBER <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> <br> , driver_name VARCHAR2(255) <font color="#0000ff">NOT</font> <font color="#0000ff">NULL</font> <br> ); <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">SEQUENCE</font> seq_driver;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  To begin, we implement the relationship using the most common approach: create a table of relationships. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">TABLE</font> bus_driver <br> ( bus_id NUMBER <br> , driver_id NUMBER <br> , <font color="#0000ff">CONSTRAINT</font> pk_driver_bus <font color="#0000ff">PRIMARY</font> <font color="#0000ff">KEY</font> (bus_id, driver_id) <br> , <font color="#0000ff">CONSTRAINT</font> fk_bus_id <font color="#0000ff">FOREIGN</font> <font color="#0000ff">KEY</font> (bus_id) <font color="#0000ff">REFERENCES</font> tab_bus (b_id) <br> , <font color="#0000ff">CONSTRAINT</font> fk_driver_id <font color="#0000ff">FOREIGN</font> <font color="#0000ff">KEY</font> (driver_id) <font color="#0000ff">REFERENCES</font> tab_driver (d_id) <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  The primary key ( <code>PRIMARY KEY</code> ) to two fields ensures that all necessary conditions are met: the contents of the fields (each separately) cannot be empty and each relationship will be unique.  In addition, this approach allows you to get rid of additional fields and provides automatic indexing. <br><br>  For creating, deleting and selecting relationships in the example, procedures will be used - for convenience of testing.  In addition, it was interesting for me to test it with procedures, because from the point of view of programming it is more convenient than composing queries in the body of the program.  It should be noted that there is no commit to one procedure ( <code>COMMIT;</code> ).  Firstly, I do it manually when testing, and secondly, the procedures for adding and deleting relationships are started in a loop during testing - in this case, the commit will only interfere. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> add_relation <br> ( p_bus NUMBER <br> , p_driver NUMBER <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> bus_driver <font color="#0000ff">VALUES</font> ( p_bus, p_driver ); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> drop_relation <br> ( p_bus NUMBER <br> , p_driver NUMBER <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">DELETE</font> bus_driver <font color="#0000ff">WHERE</font> bus_id = p_bus <font color="#0000ff">AND</font> driver_id = p_driver; <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> select_relation <br> ( p_data <font color="#0000ff">OUT</font> SYS_REFCURSOR <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">OPEN</font> p_data <font color="#0000ff">FOR</font> <br> <font color="#0000ff">SELECT</font> b.bus_number, d.driver_name <br> <font color="#0000ff">FROM</font> tab_bus b, tab_driver d, bus_driver r <br> <font color="#0000ff">WHERE</font> (b.b_id = r.bus_id) <font color="#0000ff">AND</font> (r.driver_id = d.d_id); <br> <font color="#0000ff">END</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  It is probably worth noting that here in the sampling procedure, the <code>WHERE</code> used as a join of the tables ( <code>JOIN</code> 'a).  There are two reasons for this: the Oracle is all the same, it considers it a <code>JOIN</code> 'th, and it is more convenient for me to compare the complexity of building SQL query queries. <br><br>  At the creation of the first structure of the relationship is completed.  The following relationship scheme was implemented: two tables and an additional table in which the list of relationships is stored. <br><img src="https://habrastorage.org/storage/habraeffect/21/1d/211dc1a67884457de2bf6c37ddafa5b0.png"><br>  Next comes the SQL code for the alternative.  The second option was created on the exact same table structure, but in a different scheme.  And the structure of interrelations looks like this: there are two tables, in one of them each record stores a list of interrelations. <br><img src="https://habrastorage.org/storage/habraeffect/1b/de/1bde247aa0b0ec3c6d99a8240b9d9280.png"><br>  A table can be created immediately with a column of nested tables, but in this case the relationship is constructed from two tables already prepared, so another approach is used: one of the tables is changed. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">OR</font> REPLACE TYPE obj_list <font color="#0000ff">AS</font> <font color="#0000ff">OBJECT</font> <br> ( r_driver NUMBER <br> ); <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">OR</font> REPLACE TYPE nt_list <font color="#0000ff">AS</font> <font color="#0000ff">TABLE</font> <font color="#0000ff">OF</font> obj_list; <br> <font color="#0000ff">ALTER</font> <font color="#0000ff">TABLE</font> tab_bus <font color="#0000ff">ADD</font> <br> ( bus_drivers nt_list <font color="#0000ff">NULL</font> <br> ) NESTED <font color="#0000ff">TABLE</font> bus_drivers STORE <font color="#0000ff">AS</font> nt_bus_drivers;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  As already mentioned, foreign keys in nested tables cannot be created, so it makes sense to write your own bicycle, which, undoubtedly, will negatively affect the speed of work with interconnections. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">FUNCTION</font> check_fk <br> ( p_id NUMBER <br> ) <font color="#0000ff">RETURN</font> NUMBER <font color="#0000ff">IS</font> <br> fk_count NUMBER; <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">SELECT</font> <font color="#0000ff">COUNT</font> (d_id) <font color="#0000ff">INTO</font> fk_count <br> <font color="#0000ff">FROM</font> tab_driver <font color="#0000ff">WHERE</font> d_id = p_id; <br> <font color="#0000ff">RETURN</font> fk_count; <br> <font color="#0000ff">END</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  And finally, the procedures for creating, deleting and selecting for relationships.  Here it is worth noting the exception blocks at the end of the procedures.  The fact is that the first value for the record must be added using <code>UPDATE</code> , i.e.  actually change the whole cell of the record.  But subsequent relationships are already added using the <code>INSERT</code> .  The procedure assumes that there is already a record, and in the case of an exception it acts as if the record has no connections.  It makes no sense to check before attempting to insert a relationship, since this is quite a lot of actions.  If it is necessary to process other exceptions and plan to write another code for the general case, then you should clarify the exception handling, add the exception number to the variables and take action on it. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> add_relation <br> ( p_bus  NUMBER <br> , p_driver NUMBER <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">IF</font> (check_fk(p_driver) = 1) <font color="#0000ff">THEN</font> <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> <font color="#0000ff">TABLE</font> <br> ( <font color="#0000ff">SELECT</font> bus_drivers <br> <font color="#0000ff">FROM</font> tab_bus <br> <font color="#0000ff">WHERE</font> b_id = p_bus <br> ) <br> <font color="#0000ff">VALUES</font> ( obj_list(p_driver) ); <br> <font color="#0000ff">ELSE</font> <br> RAISE_APPLICATION_ERROR(-20665, <font color="#A31515">'Record doesn'</font> <font color="#A31515">'t exist.'</font> ); <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">EXCEPTION</font> <br> <font color="#0000ff">WHEN</font> OTHERS <font color="#0000ff">THEN</font> <br> <font color="#0000ff">UPDATE</font> tab_bus <br> <font color="#0000ff">SET</font> bus_drivers = nt_list ( obj_list(p_driver) ) <br> <font color="#0000ff">WHERE</font> b_id = p_bus; <br> <font color="#0000ff">END</font> add_relation; <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> drop_relation <br> ( p_bus  NUMBER <br> , p_driver NUMBER <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">IF</font> (check_fk(p_driver) = 1) <font color="#0000ff">THEN</font> <br> <font color="#0000ff">DELETE</font> <font color="#0000ff">TABLE</font> <br> ( <font color="#0000ff">SELECT</font> bus_drivers <br> <font color="#0000ff">FROM</font> tab_bus d <br> <font color="#0000ff">WHERE</font> d.b_id = p_bus <br> ) nt <br> <font color="#0000ff">WHERE</font> nt.r_driver = p_bus; <br> <font color="#0000ff">END</font> <font color="#0000ff">IF</font> ; <br> <font color="#0000ff">EXCEPTION</font> <br> <font color="#0000ff">WHEN</font> OTHERS <font color="#0000ff">THEN</font> <br> <font color="#0000ff">NULL</font> ; <br> <font color="#0000ff">END</font> drop_relation; <br> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> select_relation <br> ( p_data <font color="#0000ff">OUT</font> SYS_REFCURSOR <br> ) <font color="#0000ff">AS</font> <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">OPEN</font> p_data <font color="#0000ff">FOR</font> <br> <font color="#0000ff">SELECT</font> b.bus_number, d.driver_name <br> <font color="#0000ff">FROM</font> tab_bus b, tab_driver d, <font color="#0000ff">TABLE</font> (b.bus_drivers) r <br> <font color="#0000ff">WHERE</font> (b.b_id = p_bus) <font color="#0000ff">AND</font> (d.d_id = p_driver); <br> <font color="#0000ff">END</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  The delete relationship procedure also has exception handling, as it happens if the table is empty.  In the case of an exception, you do not need to do anything, since the record you search for no longer exists, which is necessary for the procedure for deleting a relationship. <br>  To verify the correctness of the procedures, the same test values ‚Äã‚Äãwere used. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_driver <font color="#0000ff">VALUES</font> ( seq_driver.NEXTVAL, <font color="#A31515">'Viktor Jeliseev'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_driver <font color="#0000ff">VALUES</font> ( seq_driver.NEXTVAL, <font color="#A31515">'Stepan Kljavin'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_driver <font color="#0000ff">VALUES</font> ( seq_driver.NEXTVAL, <font color="#A31515">'Marija Baranka'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_driver <font color="#0000ff">VALUES</font> ( seq_driver.NEXTVAL, <font color="#A31515">'Arsenij Dubov'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_bus <font color="#0000ff">VALUES</font> ( seq_bus.NEXTVAL, <font color="#A31515">'p666pp'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_bus <font color="#0000ff">VALUES</font> ( seq_bus.NEXTVAL, <font color="#A31515">'LT-3216'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_bus <font color="#0000ff">VALUES</font> ( seq_bus.NEXTVAL, <font color="#A31515">'zox-15'</font> ); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_bus <font color="#0000ff">VALUES</font> ( seq_bus.NEXTVAL, <font color="#A31515">'x234oo'</font> ); <br> <br> <font color="#0000ff">BEGIN</font> <br> add_relation (1, 3); <br> add_relation (1, 4); <br> add_relation (3, 3); <br> add_relation (3, 2); <br> add_relation (2, 2); <br> drop_relation (3, 2); <br> drop_relation (2, 2); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#0000ff">DECLARE</font> <br> g_data SYS_REFCURSOR; <br> <font color="#0000ff">BEGIN</font> <br> select_relation (1, 4, g_data); <br> select_relation (3, 3, g_data); <br> select_relation (2, 2, g_data); <br> select_relation (1, 1, g_data); <br> <font color="#0000ff">END</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  Testing </h4><br>  Testing was conducted several times for each option.  First, the samples, procedures, and function were debugged on the above test data.  Then procedures were created for each database (in fact, of course, charts), which filled the tables with data using a random number generator.  In approximately the same way, a specified number of relationships were created. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">CREATE</font> <font color="#0000ff">OR</font> REPLACE <br> <font color="#0000ff">PROCEDURE</font> random_insert_data <br> ( record_count NUMBER <br> ) <font color="#0000ff">AS</font> <br> start_time NUMBER <font color="#0000ff">DEFAULT</font> DBMS_UTILITY.GET_TIME; <br> counter NUMBER; <br> field_value VARCHAR2(255); <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..record_count <br> LOOP <br> field_value := DBMS_RANDOM.STRING( <font color="#A31515">'A'</font> , 9); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_bus (b_id, bus_number) <font color="#0000ff">VALUES</font> <br> ( seq_bus.NEXTVAL <br> , field_value <br> ); <br> <font color="#0000ff">END</font> LOOP; <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..record_count <br> LOOP <br> field_value := INITCAP(DBMS_RANDOM.STRING( <font color="#A31515">'L'</font> , 6))|| <font color="#A31515">' '</font> ||INITCAP(DBMS_RANDOM.STRING( <font color="#A31515">'L'</font> , 9)); <br> <font color="#0000ff">INSERT</font> <font color="#0000ff">INTO</font> tab_driver <font color="#0000ff">VALUES</font> <br> ( seq_driver.NEXTVAL <br> , field_value); <br> <font color="#0000ff">END</font> LOOP; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#008000">-- for standart many-to-many relations</font> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> random_insert_rel <br> ( rel_count NUMBER <br> , rel_from NUMBER <br> , rel_to  NUMBER <br> ) <font color="#0000ff">AS</font> <br> start_time NUMBER <font color="#0000ff">DEFAULT</font> DBMS_UTILITY.GET_TIME; <br> rel1_value VARCHAR2(255); <br> rel2_value VARCHAR2(255); <br> counter  NUMBER; <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..rel_count <br> LOOP <br> rel1_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> rel2_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> add_relation(rel1_value, rel2_value); <br> <font color="#0000ff">END</font> LOOP; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#008000">-- for standart many-to-many relations</font> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> random_delete_rel <br> ( rel_count NUMBER <br> , rel_from NUMBER <br> , rel_to  NUMBER <br> ) <font color="#0000ff">AS</font> <br> start_time NUMBER <font color="#0000ff">DEFAULT</font> DBMS_UTILITY.GET_TIME; <br> rel1_value VARCHAR2(255); <br> rel2_value VARCHAR2(255); <br> counter  NUMBER; <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..rel_count <br> LOOP <br> rel1_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> rel2_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> drop_relation(rel1_value, rel2_value); <br> <font color="#0000ff">END</font> LOOP; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#008000">-- for alternative many-to-many system with nested table</font> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> random_insert_rel <br> ( rel_count NUMBER <br> , rel_from NUMBER <br> , rel_to  NUMBER <br> ) <font color="#0000ff">AS</font> <br> start_time NUMBER <font color="#0000ff">DEFAULT</font> DBMS_UTILITY.GET_TIME; <br> rel1_value VARCHAR2(255); <br> rel2_value VARCHAR2(255); <br> counter  NUMBER; <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..rel_count <br> LOOP <br> rel1_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> rel2_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> add_relation(rel1_value, rel2_value); <br> <font color="#0000ff">END</font> LOOP; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">END</font> ; <br> <br> <font color="#008000">-- for alternative many-to-many system with nested table</font> <br> <font color="#0000ff">CREATE</font> <font color="#0000ff">PROCEDURE</font> random_delete_rel <br> ( rel_count NUMBER <br> , rel_from NUMBER <br> , rel_to  NUMBER <br> ) <font color="#0000ff">AS</font> <br> start_time NUMBER <font color="#0000ff">DEFAULT</font> DBMS_UTILITY.GET_TIME; <br> rel1_value VARCHAR2(255); <br> rel2_value VARCHAR2(255); <br> counter  NUMBER; <br> <font color="#0000ff">BEGIN</font> <br> <font color="#0000ff">FOR</font> counter <font color="#0000ff">IN</font> 1..rel_count <br> LOOP <br> rel1_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> rel2_value := ROUND(DBMS_RANDOM. <font color="#0000ff">VALUE</font> (rel_from, rel_to)); <br> drop_relation(rel1_value, rel2_value); <br> <font color="#0000ff">END</font> LOOP; <br> DBMS_OUTPUT.PUT_LINE( TO_CHAR( (DBMS_UTILITY.GET_TIME-start_time)/100, <font color="#A31515">'09.99'</font> ) ); <br> <font color="#0000ff">END</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  Please note that there is no commit in the testing procedures either. <br><br><h4>  results </h4><br>  Testing was conducted on data in the amount of <i>n</i> = 4, 1000, 100000. It is assumed that there are <i>n</i> records in each table, and also <i>n</i> relationships are created.  Testing was carried out on 10 positions, the table below presents 6 of them, which have the most significant differences in time and display the most significant data. <br><br>  During testing, a distinction was made between the first sample and the subsequent ones, as well as between the sample using a query or a procedure that places data on the cursor.  The main measurements were made to create relationships and different variants of samples.  Deleting relationships is not included in this list, since a random number generator is used and it is likely that almost all attempts to delete relationships will turn into inaction. <br><table><tbody><tr><td>  way to write </td><td>  sample 1 </td><td>  sample 2 </td><td>  sample 3 </td><td>  sample 4 </td><td>  sample 5 </td><td>  creature </td></tr><tr><td>  additional  table 4 </td><td>  00.844 </td><td>  00.792 </td><td>  00.967 </td><td>  00.01 </td><td>  00.02 </td><td>  00.032 </td></tr><tr><td>  at.  table 4 </td><td>  00.694 </td><td>  00.707 </td><td>  00.026 </td><td>  00.00 </td><td>  00.00 </td><td>  00.034 </td></tr><tr><td>  additional  table, 1000 </td><td>  00.642 </td><td>  00.645 </td><td>  00.698 </td><td>  00.02 </td><td>  00.02 </td><td>  00.142 </td></tr><tr><td>  at.  table, 1000 </td><td>  00.687 </td><td>  00.695 </td><td>  00.344 </td><td>  00.00 </td><td>  00.00 </td><td>  00.721 </td></tr><tr><td>  additional  table, 100,000 </td><td>  00.648 </td><td>  00.697 </td><td>  01.323 </td><td>  00.14 </td><td>  00.49 </td><td>  14.613 </td></tr><tr><td>  at.  table, 100,000 </td><td>  00.741 </td><td>  00.829 </td><td>  01.117 </td><td>  00.00 </td><td>  00.00 </td><td>  84.630 </td></tr></tbody></table><br>  The time is in seconds. <br><br>  Sample 1: sample of one relationship from an anonymous block to the cursor, using linked variables. <br>  Sample 2: sampling one relationship by procedure, using related variables. <br>  Sample 3: selection of relationships from an anonymous block to the cursor. <br>  Sample 4: The first sample of all relationships by procedure in the cursor. <br>  Sample 5: the subsequent sampling of all relationships by the procedure in the cursor. <br>  Add: time to add <i>n</i> relationships. <br><br>  I would like to say that if we are talking about 1-2 seconds, then the time is not important at all, but here it should be taken into account that it is assumed that either the real database will be large or the server will be weaker.  The fact that the server on which both options were tested is quite powerful also has its drawback: side operations take too much time, which makes it difficult to make comparisons on a small amount of data. <br><br>  So, adding an interconnection in an alternative variant takes much more (6 times) time than in the standard one, which definitely indicates that the alternative variant is not suitable for cases when a lot (more than 500) links need to be created and destroyed a day.  If there are fewer such actions, then from a person‚Äôs point of view, the difference will be simply invisible, despite unnecessary actions, such as replacing the verification of a foreign key. <br><br>  Now about the sample.  Sampling from an anonymous block takes just over half a second in all cases.  Probably the fact is that most of the time goes to work with the cursor itself.  But when sampling a large amount of data (for example, all), the nested table becomes more efficient: it takes almost less time and the only option when the alternative is slower is the first sample of all data. <br>  And finally, the last comparison: query comparison.  Personally, I do not see any noteworthy differences. <br><table><tbody><tr><td>  SELECT b.bus_number, d.driver_name <br>  FROM tab_bus b, tab_driver d, <br>  bus_driver r <br>  WHERE (b.b_id = r.bus_id) <br>  AND (r.driver_id = d.d_id); <br></td><td>  SELECT b.bus_number, d.driver_name <br>  FROM tab_bus b, tab_driver d, <br>  TABLE (b.bus_drivers) r <br>  WHERE (b.b_id = p_bus) <br>  AND (d.d_id = p_driver); <br></td></tr></tbody></table><br><h4>  findings </h4><br>  In general, the idea of ‚Äã‚Äãcreating many-to-many relationships using nested tables was not as hopeless as it seemed at first.  Despite the fact that the operations of creating and deleting relationships take an order of magnitude longer, the sampling of even large queries becomes faster, and the structure of the query is approximately the same in complexity.  In terms of the complexity of the sample code, both approaches are equally simple, but for creating or deleting a relationship, it is more difficult for an alternative approach. <br><br>  The relationship should not be implemented using a nested table if: <br><ul><li>  It is necessary to create and delete them often and much (it takes too much time); <br></li><li>  There are few tables in general or the structure of the database as a whole is simple (the relationship will take too much time to write the procedures for adding and deleting them); <br></li><li>  The data logic implies the equivalence of the objects being linked (it is impossible to decide in which table to create a column of interrelations). <br></li></ul><br>  It makes sense to think about the implementation of the relationship in an alternative way, if <br><ul><li>  One table is connected by the principle of many-to-many with several others (simplifies the understanding of the structure and logic of the data); <br></li><li>  Relationships are created and deleted quite rarely and in one and linked tables records are deleted and added not too often (there is no loss in speed); <br></li><li>  To work with the database, only procedures, views, and possibly sampling are used; <br></li><li>  There is a need to implement a foreign key on several tables, rather than on one (a more elegant solution, in contrast to creating several columns, especially since the function of checking the field identifier correspondence is needed anyway). <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/100050/">https://habr.com/ru/post/100050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100038/index.html">Dreams about something bigger (open letter)</a></li>
<li><a href="../100039/index.html">Game Engine Blender - master controllers with logical expressions</a></li>
<li><a href="../100040/index.html">Contact the QSP community to the developers</a></li>
<li><a href="../100046/index.html">Apple posted on their site video showing problems with the signal level of competitors' phones</a></li>
<li><a href="../100049/index.html">Another way to use IBM Rational TestManager / Robot for your testing tasks</a></li>
<li><a href="../100053/index.html">WordPress will stop supporting PHP4 and MySQL4</a></li>
<li><a href="../100054/index.html">mysql-proxy testing under a small-scope lens</a></li>
<li><a href="../100056/index.html">Crazy hands vs Driin Phone Holder</a></li>
<li><a href="../100057/index.html">Amiga - 25 years of multimedia stupor!</a></li>
<li><a href="../100059/index.html">EDS - is it all so simple?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>