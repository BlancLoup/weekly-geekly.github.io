<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use Twitter for its intended purpose</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I was very bored. So much so that I decided to get all the details of my "designer" and collect something. 



 The following was found in the bi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use Twitter for its intended purpose</h1><div class="post__text post__text-html js-mediator-article">  Once I was very bored.  So much so that I decided to get all the details of my "designer" and collect something. <br><br><img src="https://habrastorage.org/storage2/c8a/cae/daa/c8acaedaa2de1f72e8fa16e51346f01a.jpg"><br><br>  The following was found in the bins: Arduino compatible board, tp-link mr3020 router, GPS module, gyroscope / accelerometer, and a whole bunch of other stuff. <br><a name="habracut"></a><br>  Looking ahead, so as not to upset some readers, I will say that the GPS module and the gyroscope were not useful <br>  . <br>  And here twitter.  My attitude to sabzh balances on the verge of indifference and negativity.  Well, what is so interesting to tell using only 140 characters without pictures and video?  An incomprehensible toy for those who live in social networks and post about what he ate for breakfast.  This is my personal opinion, if it does not coincide with yours, I can understand it.  Therefore, I ask dear readers not to holivarit on this topic, at least in the comments to this article. <br>  All these thoughts prompted me to an idea for an indispensable device that would tweet every time I visited the toilet!  Well, that all were in the know.  And not just about the visit, but in more detail: what exactly did I do there?  Let's get started 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing to do is define the criteria.  I think that the signs of finding me in the toilet are the door closed and the lights on.  At hand was some kind of sensor from an automatic gate, from which a photosensitive element was removed. <br><br><img src="https://habrastorage.org/storage2/671/4e3/ca2/6714e3ca222d8456c0445729e4b7cd43.jpg"><br><br>  Having played with the multimeter, I found out that when the illumination changes, a potential difference arises in it.  At maximum illumination, the voltage meter showed approximately 0.330 volts.  We cling it to the "Arduine".  I decided to determine the position of the door (opened / closed) simply by closing the contacts.  This, by the way, turned out to be the most difficult, because I did not have a suitable button. <br><br><img src="https://habrastorage.org/storage2/eb8/a24/f1f/eb8a24f1f7db09dd5f1799aa29ce3937.jpg"><br><br>  Here is the program for "Arduin": <br><br><pre><code class="java hljs">#include &lt;SoftwareSerial.h&gt; <span class="hljs-comment"><span class="hljs-comment">//   SoftwareSerial mySerial(2, 3); // RX, TX     rs323 int cnt = 0; //   void setup() { mySerial.begin(115200); //   mySerial.println("Halo world"); } void loop() { int lightValue = analogRead(A0); //      int doorValue = analogRead(A1); //    boolean light = false; boolean door = false; if(lightValue &gt; 60) light = true; //    60 -   .    if(doorValue &gt; 500) door = true; //       0,   1023. //   ,  ...   if(light &amp;&amp; door) cnt++; //    -   else { if(cnt&gt;0) { //    mySerial.print("&lt;"); mySerial.print(cnt); //      mySerial.println("&gt;"); } cnt = 0; //   } delay(1000); }</span></span></code> </pre> <br><br>  The second thing we need is a router.  I took the tp-link mr3020.  You need to install OpenWRT on it, set up a connection to the Internet and install php.  How this is done is described here many times, including by me.  Therefore, we will not linger on this.  Only important points: here we listen to the port and get the data we need <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//     $child_pid = pcntl_fork(); if ($child_pid) { exit(); } posix_setsid(); //      include("post.php"); $filename = "/dev/ttyATH0"; // serial-  $handle = fopen($filename, "r"); //  while (!feof($handle)) { $sym = fread($handle, 1); //       if($sym=='&gt;') { $f=false; echo "&lt;&lt;$cnt&gt;&gt;\n"; flush(); act($cnt); $cnt=''; } elseif($sym=='&lt;') $f=true; elseif($f) $cnt .= $sym; } fclose($handle); function act($time) { if($time&lt;40) {echo "dunno\n";} if(40&lt;=$time &amp;&amp; $time&lt;150) { postMyPost("i was pee");} if(150&lt;=$time &amp;&amp; $time&lt;300) { postMyPost("i was poo");} if(300&lt;=$time &amp;&amp; $time&lt;900) { postMyPost("i take shower");} } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  We post using this library: <br><br>  The third important point is the ability to post a program tweeter.  To do this, you need to log in, go to <a href="https://dev.twitter.com/">dev.twitter.com</a> , move the cursor at the top right to your bright face, select My Applications.  To do Create New Application, answer all questions.  Then in the Settings you must specify Access: Read and Write.  Then in Details, click Create my access token and remember the fields Consumer key, Consumer secret, Access token and Access token secret, we still need them.  Downloading PHP library: <a href="">github.com/abraham/twitteroauth</a> / <a href="">archive</a> / <a href="">master.zip</a> <br>  In config.php, we substitute the previously stored data: <br><br><pre> <code class="php hljs">define(<span class="hljs-string"><span class="hljs-string">'CONSUMER_KEY'</span></span>, <span class="hljs-string"><span class="hljs-string">'xxxxxxxxxxxxxxxxxxxxxxxxxx'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'CONSUMER_SECRET'</span></span>, <span class="hljs-string"><span class="hljs-string">'yyyyyyyyyyyyyyyyyyyyyyyyyy'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'OAUTH_TOKEN'</span></span>, <span class="hljs-string"><span class="hljs-string">'qwertyqwertyqwertyqwertyqwertyqwerty'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'OAUTH_SECRET'</span></span>, <span class="hljs-string"><span class="hljs-string">'sashagreysashagreysashagreysashagrey'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'OAUTH_CALLBACK'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://example.com/twitteroauth/callback.php'</span></span>);</code> </pre><br><br>  Well, the script itself to send (post.php): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?PHP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'lib/twitteroauth/twitteroauth.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'lib/config.php'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postMyPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($status)</span></span></span><span class="hljs-function"> </span></span>{ $connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TwitterOAuth(CONSUMER_KEY, CONSUMER_SECRET,OAUTH_TOKEN,OAUTH_SECRET); $connection-&gt;format = <span class="hljs-string"><span class="hljs-string">'xml'</span></span>; $connection-&gt;post(<span class="hljs-string"><span class="hljs-string">'statuses/update'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;$status)); } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Debugging process: <br><br><img src="https://habrastorage.org/storage2/767/cf9/3a6/767cf93a684294aa2709ace0a110587d.jpg"><br><br>  Product Assembly: <br><br><img src="https://habrastorage.org/storage2/540/606/6b3/5406066b3edc3fb65d2a7c40d697788b.jpg"><br><br>  Connection: <br><br><img src="https://habrastorage.org/storage2/1cc/55d/f38/1cc55df381c7b2113ae0a1689a3737dc.jpg"><br><br>  Using: <br>  connect to the router via ssh, run the script: <br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># php-cgi /www/twitter/run.php X-Powered-By: PHP/5.4.11 Content-type: text/html root@OpenWrt:~#</span></span></code> </pre><br>  This starts the background process, and the parent ends.  Thus, the script will work even after disconnecting from the console. <br><br>  To stop the script, you need to look at the process ID and make it kill: <br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># ps | grep run.php 1665 root 10436 S php-cgi /www/twitter/run.php 1670 root 1492 S grep run.php root@OpenWrt:~# kill 1665</span></span></code> </pre><br><br>  The result of the work can be found here: <a href="https://twitter.com/kruz_ivan">twitter.com/kruz_ivan</a> <br><br>  What are the plans: <br>  1) Tighten the camera so that you can also see a photo of the process itself. <br>  2) Odor transfer technologies are being actively developed.  With the advent of the first serial devices, I will definitely use them in my project. <br>  3) Creating similar devices integrated with social networks that will tweet when you, for example, open a refrigerator, or instagram photos every time you sit down to eat. </div><p>Source: <a href="https://habr.com/ru/post/181852/">https://habr.com/ru/post/181852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181840/index.html">A module that simplifies working with OpenLayers and monitoring systems</a></li>
<li><a href="../181842/index.html">UN expert urged the world community to slow down the creation of combat robots with artificial intelligence</a></li>
<li><a href="../181844/index.html">Creating multiboot HDD in linux (GRUB2 + memdisk + grub4dos)</a></li>
<li><a href="../181848/index.html">Configuring the working environment for Backend PHP development</a></li>
<li><a href="../181850/index.html">Protein Structure: An Introduction for IT Professionals</a></li>
<li><a href="../181854/index.html">How to stop noticing the limited traffic with free WiFi</a></li>
<li><a href="../181858/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 14</a></li>
<li><a href="../181860/index.html">6 hours with MegaFon Login or looking for a budget smartphone with android for a vacation trip</a></li>
<li><a href="../181864/index.html">Graphene photosensor is 1000 times more sensitive to light than CMOS and CCD</a></li>
<li><a href="../181868/index.html">Juniper Wireless Systems - First Meet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>