<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A little about the implementation of the puzzle "Soma Cubes" (Swift & SceneKit)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago, I noticed that Pete Hain‚Äôs ‚ÄúSoma Cubes‚Äù puzzle, which was invented back in 1933, is not in mobile stores. The desire to try to write...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A little about the implementation of the puzzle "Soma Cubes" (Swift & SceneKit)</h1><div class="post__text post__text-html js-mediator-article">  About a year ago, I noticed that Pete Hain‚Äôs ‚ÄúSoma Cubes‚Äù puzzle, which was invented back in 1933, is not in mobile stores.  The desire to try to write a game for iOS was drilled for a long time by an inflamed brain and I finally decided, especially since the design was not particularly needed (drawing a cube in Blender does not count).  In the puzzle there are 7 elements from cubes from which other various figures are assembled ( <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2583%25D0%25B1%25D0%25B8%25D0%25BA%25D0%25B8_%25D1%2581%25D0%25BE%25D0%25BC%25D0%25B0">Wikipedia</a> ). <br><br>  Requirements immediately submitted to the game, boiled down to two points: <br>  1. Do not use third-party frameworks in development. <br>  2. To control the figures and the scene should not be used buttons - only Recognizers. <br><br>  According to paragraph 2, I mean that the script, when you need to select an object and then click on the control buttons, does not fit. <br><a name="habracut"></a><br><h4>  1. Preparation </h4><br>  We export the cube drawn in Blender to the .dae file and put it in the art.scnassets folder of our game project, during the creation of which the SceneKit was specified as Game Tech.  Access to the imported scene and the object on the scene is obtained as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cubeScene = <span class="hljs-type"><span class="hljs-type">SCNScene</span></span>(named: <span class="hljs-string"><span class="hljs-string">"art.scnassets/cube.dae"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cubeNode1 = cubeScene!.rootNode.childNodeWithName(<span class="hljs-string"><span class="hljs-string">"Cube"</span></span>, recursively: <span class="hljs-literal"><span class="hljs-literal">false</span></span>) cubeNode1?.geometry?.materialWithName(<span class="hljs-type"><span class="hljs-type">CUBE_MATERIAL_NAME</span></span>)?.diffuse.contents = <span class="hljs-type"><span class="hljs-type">COLORS_FOR_PRIMITIVES</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>]</code> </pre> <br>  The third line simply colors the edges of the cube in the desired color.  Now you can clone an object, set coordinates and add it to a parent shape, which is simply an object of class SCNNode.  Similarly, place the shape for the assembly in the center of the scene, after making the cube a little smaller. <br><br><h4>  2. Rotate, raise, lower and drag objects </h4><br>  For the game, it is necessary to provide the ability to rotate the figure 90 degrees around all three axes, which at first caused some difficulties, but then it dawned on me (in a week) that combinations of turns around two axes are enough for all cases.  UISwipeGestureRecognizer was chosen for the implementation of the plan.  So, a swipe on the figure turns left and right around the vertical axis (Y), regardless of the camera position, the swipe up and down turns the figure either around X or around Z (depending on the camera position). <br><br>  To drag objects along the XZ plane, it is natural to use the UIPanGestureRecognizer, however, it is necessary to specify the relationship between the ‚Äúswipe‚Äù and the ‚Äúdrag‚Äù in order for both handlers to work. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">panGestureRecognizer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.requireGestureRecognizerToFail</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">swipeGestureRecognizer</span></span>)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Code for dragging objects for those interested</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handlePanGestures</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recogniser: UIPanGestureRecognizer)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> recogniser.state == .<span class="hljs-type"><span class="hljs-type">Began</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> location = recogniser.locationInView(recogniser.view) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> hits = sceneView.hitTest(location,options: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! [<span class="hljs-type"><span class="hljs-type">SCNHitTestResult</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hits { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">Utils</span></span>.nodeHasPrefix(hit.node.parentNode!, <span class="hljs-keyword"><span class="hljs-keyword">prefix</span></span>: <span class="hljs-string"><span class="hljs-string">"fig"</span></span>){ selectedNode = hit.node.parentNode saveOldPosition(selectedNode) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> worldCoord = selectedNode.position <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> projectedOrigin = sceneView.projectPoint(worldCoord) curZ = projectedOrigin.z <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> unProj = sceneView.unprojectPoint(<span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(<span class="hljs-type"><span class="hljs-type">Float</span></span>(location.x), <span class="hljs-type"><span class="hljs-type">Float</span></span>(location.y), projectedOrigin.z)) ofset = <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(selectedNode.position.x - unProj.x, selectedNode.position.y - unProj.y, selectedNode.position.z - unProj.z) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> recogniser.state == .<span class="hljs-type"><span class="hljs-type">Changed</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> curScreenPoint = <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(<span class="hljs-type"><span class="hljs-type">Float</span></span>(location.x), <span class="hljs-type"><span class="hljs-type">Float</span></span>(location.y), curZ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> curWorld = sceneView.unprojectPoint(curScreenPoint) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> posPlusOffset = <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(curWorld.x + ofset.x, curWorld.y + ofset.y , curWorld.z + ofset.z) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newPosition = <span class="hljs-type"><span class="hljs-type">SCNVector3Make</span></span>(posPlusOffset.x , selectedNode.position.y , posPlusOffset.z ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> projectedOrigin2 = sceneView.projectPoint(newPosition) curZ = projectedOrigin2.z selectedNode.position = newPosition } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> recogniser.state == .<span class="hljs-type"><span class="hljs-type">Ended</span></span> || recogniser.state == .<span class="hljs-type"><span class="hljs-type">Failed</span></span>{ selectedNode.position.x = <span class="hljs-type"><span class="hljs-type">Utils</span></span>.clamp(selectedNode.position.x, <span class="hljs-built_in"><span class="hljs-built_in">min</span></span> : -<span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>) selectedNode.position.y = round(selectedNode.position.y) selectedNode.position.z = <span class="hljs-type"><span class="hljs-type">Utils</span></span>.clamp(selectedNode.position.z, <span class="hljs-built_in"><span class="hljs-built_in">min</span></span> : -<span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testCollision(selectedNode){ selectedNode.position = selectedNodeOldPosition }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ testGameOver(selectedNode <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">SimpleFigure</span></span>) } selectedNode = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br></div></div><br>  For raising and lowering one unit along the Y axis, two instances of UITapGestureRecognizer are used, only one of them has the numberOfTapsRequired = 2, and the envy is also indicated: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tapRecognizer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.requireGestureRecognizerToFail</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">doubleTapRecognizer</span></span>)</code> </pre><br><h4>  3. Camera control </h4><br>  The camera is added to the SCNNode in the center of coordinates at some distance from it and directed in its direction.  That is, the camera is located, as it were, on the surface of the sphere, and to rotate the camera, it suffices to rotate the parent SCNNode by a certain angle.  For approximation-removal, we use UIPinchGestureRecognizer and it is enough to do the ‚Äúscale‚Äù of the same SCNNode in the handler: <br><br><pre> <code class="hljs objectivec"> let cameraNode = <span class="hljs-built_in"><span class="hljs-built_in">SCNNode</span></span>() cameraNode.name=<span class="hljs-string"><span class="hljs-string">"mainCamera"</span></span> cameraNode.camera = <span class="hljs-built_in"><span class="hljs-built_in">SCNCamera</span></span>() cameraNode.camera!.zFar = <span class="hljs-number"><span class="hljs-number">100</span></span> cameraNode.position = <span class="hljs-built_in"><span class="hljs-built_in">SCNVector3</span></span>(x: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, z: <span class="hljs-number"><span class="hljs-number">8.0</span></span>) let cameraOrbit = <span class="hljs-built_in"><span class="hljs-built_in">SCNNode</span></span>() cameraOrbit.position = <span class="hljs-built_in"><span class="hljs-built_in">SCNVector3</span></span>(x: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0.0</span></span>, z: <span class="hljs-number"><span class="hljs-number">0.0</span></span>) cameraOrbit.addChildNode(cameraNode) cameraOrbit.eulerAngles.x = -Float(M_PI_4)</code> </pre><br>  I used the eulerAngles property of the cameraOrbit object to increment the angle of rotation in the same handlers as for the figures, previously identifying the object in SCNHitTestResult. <br><br><h4>  4. Other stuff </h4><br>  To test collisions, the coordinates of each cube of the current figure (which was released, turned, etc.) with the cubes of the other six figures are simply checked.  Levels are simply a text file with coordinates. <br><br>  Following the development of this puzzle, I would like to say that iOS has left a pleasant impression on me, especially the implementation of UIGestureRecognizers.  Thank you all for your attention and I hope someone written above will help. </div><p>Source: <a href="https://habr.com/ru/post/266449/">https://habr.com/ru/post/266449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266435/index.html">How to learn to make games: useful resources</a></li>
<li><a href="../266437/index.html">Says Gartner: Overheated IoT and Practical Clouds</a></li>
<li><a href="../266441/index.html">Assistant program for mastering blind typing on a keyboard in Linux</a></li>
<li><a href="../266443/index.html">How do closures (under the hood) in JavaScript</a></li>
<li><a href="../266447/index.html">LinkedIn's brief history of scaling</a></li>
<li><a href="../266453/index.html">As I wrote the rainy map</a></li>
<li><a href="../266455/index.html">Backstage at CyberSoft</a></li>
<li><a href="../266457/index.html">Making a Real Forex Robot Idea</a></li>
<li><a href="../266459/index.html">Old new pywinauto: automate Windows GUI in Python with install / uninstall example</a></li>
<li><a href="../266461/index.html">Adaptive scaling: design of online stores for large screens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>