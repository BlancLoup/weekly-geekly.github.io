<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Play RSS with PlayFramework 2.2 and Scala</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habravchane. 

 We, the pogrom programmers, very often encounter the same problem when learning a new language X or the framework Y - w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Play RSS with PlayFramework 2.2 and Scala</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/ff9/55e/3fa/ff955e3fa48672518d5bb089bcf70c7c.png"><br><br>  Good day, dear habravchane. <br><br>  We, the <s>pogrom</s> programmers, very often encounter the same problem when learning a new language X or the framework Y - what to write after the intro Yet Yet Hello World?  Anything that can show some of the advantages and disadvantages of X / Y, but it would not take a lot of time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My friends and I often asked this question.  As a result, a simple thought was born - write an RSS reader.  Here you have to work with the network, and XML parser, and the database can be connected, look at the template engine.  But you never know. <br><br>  So, here begins the fascinating journey to the stack of the <b>Play Framework 2.2 + Scala + MongoDB</b> on the backend and <b>AngularJS + CoffeeScript</b> on the frontend. <br><br><div class="spoiler">  <b class="spoiler_title">TL; DR</b> <div class="spoiler_text">  The whole project was placed in ~ 250-300 lines on Scala with documentation and ~ 150 lines on CS.  Well, some HTML. <br>  Code is available on <a href="https://bitbucket.org/ImLiar/playrss">Bitbucket</a> </div></div><br><a name="habracut"></a><br><h5>  And the first stop is the question - why Scala, and not Java?  And why Play, and not the same Lift? </h5><br>  The answers are very simple and subjective. <br>  Scala provides a higher level of abstraction and less code for the sake of code.  When I saw the documentation on the standard <a href="http://www.scala-lang.org/api/current/index.html">List</a> with its 200 methods for all occasions ... Seriously, try it yourself. <br>  As for the choice of framework - a simple example on Lift gave me a page on localhost for <b>~ 150 ms</b> , and this without using a database.  At the same time on the same machine and the same JVM Play managed for ~ 5-10 ms.  I do not know, maybe the stars are so formed. <br>  And in the console console sweetheart. <br><br>  I will miss the part on how to install and start working with Play, since everything is quite <a href="http://www.playframework.com/documentation/2.2.x/Installing">thoroughly chewed</a> in the official documentation (up to the generation of the project for your <a href="http://www.playframework.com/documentation/2.2.x/IDE">favorite IDE</a> ), and we will go further. <br><br><h5>  Query path </h5><br>  The most obvious way to disassemble the application is to follow the client's request. <br>  Today it is better to skip the black box for processing the request by the framework itself, especially since it is built on Netty, and it would have to dig deep.  Perhaps to China. <br>  As each river begins with a streamlet, any application in Play begins with routing, which is quite clearly described in <br><div class="spoiler">  <b class="spoiler_title">conf / routes</b> <div class="spoiler_text"><pre> # Routes
 # This file defines all application routes (Higher priority routes first)
 # ~~~~

 # Get news
 GET / news controllers.NewsController.news (tag: String? = "", PubDate: Int? = (System.currentTimeMillis () / 1000) .toInt)

 # Parse news
 GET / parse controllers.NewsController.parseRSS

 # Get tags
 GET / tags controllers.TagsController.tags

 # Map static resources from the URL path
 GET / assets / * file controllers.Assets.at (path = "/ public", file)

 # Home page
 GET / controllers.Application.index

</pre><br></div></div><br><blockquote>  <b>Marking in the fields:</b> <br>  Separately, I want to highlight the fact that in addition to the very possibility of setting default values ‚Äã‚Äãfor the arguments passed to the specified method, you can specify expressions.  For example - getting the current timestamp. <br>  By the way, the routing in Play is quite functional, up to regexp when processing a request. <br></blockquote><br><h5>  Show your ticket! </h5><br>  As you can guess from the title - the story continues with the controllers.  In Play, user controllers are included in the package <code>controllers</code> , use the Treyt <code>Controller</code> and are objects whose methods accept and respond to user requests in accordance with the routing. <br>  Since the application receives data from the server via AJAX, the controller for drawing the main page is as square as it is necessary only for loading HTML / CS / JS scripts. <br><br><div class="spoiler">  <b class="spoiler_title">Not typed and 20 lines</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> controllers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.mvc._ <span class="hljs-comment"><span class="hljs-comment">/** * playRSS entry point */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Main page. So it begins... * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Action</span></span> { <span class="hljs-type"><span class="hljs-type">Ok</span></span>(views.html.index()) } }</code> </pre><br></div></div><br>  <code>Ok</code> returns the <code>play.api.mvc.SimpleResult</code> instance, which contains the headers and body of the page.  The response from the server will be equal, as they could have guessed especially attentive, 200 <code>OK</code> . <br><br><blockquote>  <b>but</b> <br>  If a full-fledged controller for the entire application fits in 20 lines, then it is very likely that you write in Ruby. <br></blockquote><br>  So, what is the best way to send an AJAX request to a client to receive news?  Right, JSON. <br>  <code>NewsController</code> deals with <code>NewsController</code> <br><br><div class="spoiler">  <b class="spoiler_title">object NewsController</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> controllers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.mvc._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.concurrent._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models.<span class="hljs-type"><span class="hljs-type">News</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.libs.concurrent.<span class="hljs-type"><span class="hljs-type">Execution</span></span>.<span class="hljs-type"><span class="hljs-type">Implicits</span></span>.defaultContext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models.parsers.<span class="hljs-type"><span class="hljs-type">Parser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mongodb.casbah.<span class="hljs-type"><span class="hljs-type">Imports</span></span>._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewsController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Get news JSON * @param tag optional tag filter * @param pubDate optional pubDate filter for loading news before this UNIX timestamp * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">news</span></span></span></span>(tag: <span class="hljs-type"><span class="hljs-type">String</span></span>, pubDate: <span class="hljs-type"><span class="hljs-type">Int</span></span>) = <span class="hljs-type"><span class="hljs-type">Action</span></span>.async { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureNews = <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-type"><span class="hljs-type">News</span></span> asJson <span class="hljs-type"><span class="hljs-type">News</span></span>.allNews(tag, pubDate) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">MongoException</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } futureNews.map { news =&gt; <span class="hljs-type"><span class="hljs-type">Ok</span></span>(news).as(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>) }.recover { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">MongoException</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">InternalServerError</span></span>(<span class="hljs-string"><span class="hljs-string">"{error: 'DB Error: "</span></span> + e.getMessage + <span class="hljs-string"><span class="hljs-string">"'}"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>) } } <span class="hljs-comment"><span class="hljs-comment">/** * Start new RSS parsing and return first N news * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseRSS</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Action</span></span>.async { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureParse = scala.concurrent.<span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-type"><span class="hljs-type">Parser</span></span>.downloadItems(<span class="hljs-type"><span class="hljs-type">News</span></span>.addNews(_)) <span class="hljs-type"><span class="hljs-type">News</span></span> asJson <span class="hljs-type"><span class="hljs-type">News</span></span>.allNews() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">Exception</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } futureParse.map(newsJson =&gt; <span class="hljs-type"><span class="hljs-type">Ok</span></span>(newsJson).as(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>)).recover { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">MongoException</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">InternalServerError</span></span>(<span class="hljs-string"><span class="hljs-string">"{error: 'DB Error: "</span></span> + e.getMessage + <span class="hljs-string"><span class="hljs-string">"'}"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">Exception</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">InternalServerError</span></span>(<span class="hljs-string"><span class="hljs-string">"{error: 'Parse Error: "</span></span> + e.getMessage + <span class="hljs-string"><span class="hljs-string">"'}"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>) } } }</code> </pre><br></div></div><br>  <code>Future</code> .  <code>Async</code> .  Here it becomes interesting for the first time. <br>  Let's start with the fact that Play is asynchronous and in principle you don‚Äôt need to work with streams at all.  But when we <s>urgently</s> need <s>to calculate the number œÄ</s> to access the database, read data from a file or perform another slow I / O procedure, <code>Future</code> comes to the rescue, which allows you to perform an operation asynchronously without blocking the main thread.  To perform <code>Future</code> uses a separate context, so you should not worry about threads. <br>  Since the function now returns not <code>Future[SimpleResult]</code> , but the <code>Future[SimpleResult]</code> , the <code>async</code> method of the <code>ActionBuilder</code> trait (which uses the <code>Action</code> object) is used <br><br><h5>  Landscapes </h5><br>  Let us break with this asynchronous nightmare and turn to the patterns that are nice to us.  Play provides the ability to work with plain HTML.  Normal such HTML with Scala code inserts.  The template is automatically compiled into a rolling source and is a normal function where you can transfer parameters or connect (call) other templates.  By the way, many people disliked the new template engine because of the relatively slow compilation time of that HTML into the code.  Thats OK for me. <br><div class="spoiler">  <b class="spoiler_title">index.scala.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> playRSS <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shortcut icon"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'@routes.Assets.at("images/favicon.png")'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/png"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'@routes.Assets.at("stylesheets/main.css")'</span></span></span><span class="hljs-tag">&gt;</span></span> @helper.requireJs(core = routes.Assets.at("javascripts/require.js").url, module = routes.Assets.at("javascripts/main").url) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainCtrl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>playRSS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> @control() <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col-lg-12"</span></span></span><span class="hljs-tag">&gt;</span></span> @news() <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  As can be seen from the source - little magic.  <code>@helper</code> connects the requireJS supplied by the framework itself and indicates the path to main.js, where the frontend is initialized.  <code>@news()</code> and <code>@control()</code> are the news.scala.html and control.scala.html templates, respectively.  Perform the function and display the result inside the current template.  Nicely. <br><blockquote>  <b>And also</b> <br>  you can work with loops, if / else, etc.  There is <a href="http://www.playframework.com/documentation/2.2.x/ScalaTemplates">detailed documentation</a> <br></blockquote><br><h5>  Mount Kasbah </h5><br>  Let's continue, perhaps, work from a DB.  In my case, Mongo was chosen.  <s>Since I'm too lazy to create tables :)</s> <br>  Casbah is the <a href="http://mongodb.github.io/casbah/">official driver</a> for working with MongoDB in a rolling pin.  Its advantage is simultaneous simplicity and functionality.  And the main drawback will be considered at the end. <br><br>  The driver is connected quite plainly: <br><ul><li>  Add a line to <code>libraryDependencies</code> inside the build.sbt: <br> <code>"org.mongodb" %% "casbah" % "2.6.3"</code> </li> <li>  Add to our code: <br> <code>import com.mongodb.casbah.Imports._</code> </li> <li>  Play when launching the project itself deflates dependencies </li><li>  ??? </li><li>  PROFIT </li></ul><br><br>  And a little about the code.  Since my reader is not uncomplicated, an object was created that distributes to the needy collections from MongoDB.  The right word, the fence DAO or DI is simply superfluous. <br><br><div class="spoiler">  <b class="spoiler_title">object database</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mongodb.casbah.<span class="hljs-type"><span class="hljs-type">Imports</span></span>._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.<span class="hljs-type"><span class="hljs-type">Play</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * Simple object for DB connection */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Database</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> db = <span class="hljs-type"><span class="hljs-type">MongoClient</span></span>( <span class="hljs-type"><span class="hljs-type">Play</span></span>.current.configuration.getString(<span class="hljs-string"><span class="hljs-string">"mongo.host"</span></span>).get, <span class="hljs-type"><span class="hljs-type">Play</span></span>.current.configuration.getInt(<span class="hljs-string"><span class="hljs-string">"mongo.port"</span></span>).get). getDB(<span class="hljs-type"><span class="hljs-type">Play</span></span>.current.configuration.getString(<span class="hljs-string"><span class="hljs-string">"mongo.db"</span></span>).get) <span class="hljs-comment"><span class="hljs-comment">/** * Get collection by its name * @param collectionName * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collection</span></span></span></span>(collectionName:<span class="hljs-type"><span class="hljs-type">String</span></span>) = db(collectionName) <span class="hljs-comment"><span class="hljs-comment">/** * Clear collection by its name * @param collectionName * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearCollection</span></span></span></span>(collectionName:<span class="hljs-type"><span class="hljs-type">String</span></span>) = db(collectionName).remove(<span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>()) }</code> </pre><br></div></div><br><blockquote>  <b>Marking in the fields:</b> <br>  In Scala, objects are in fact singletons.  If you turn on the bore mode, an anonymous class is created and instantiated with static methods (in the Java / JVM view).  So our connection will rise during the creation of the object and will be available throughout the application's working cycle. </blockquote><br>  It is time to demonstrate the work with the base on Scala and Casbah: <br><br><div class="spoiler">  <b class="spoiler_title">object news</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default news container * @param id MongoID * @param title * @param link * @param content * @param tags Sequence of tags. Since categories could be joined into one * @param pubDate */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val id: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = "0", val title: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val link: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val content: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val tags: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val pubDate: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">/**</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">allows</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operate</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">news</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">database</span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Companion</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*/</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">/** * Method to add news to database * @param news filled News object * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNews</span></span></span></span>(news: <span class="hljs-type"><span class="hljs-type">News</span></span>) = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> toInsert = <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"title"</span></span> -&gt; news.title, <span class="hljs-string"><span class="hljs-string">"content"</span></span> -&gt; news.content, <span class="hljs-string"><span class="hljs-string">"link"</span></span> -&gt; news.link, <span class="hljs-string"><span class="hljs-string">"tags"</span></span> -&gt; news.tags, <span class="hljs-string"><span class="hljs-string">"pubDate"</span></span> -&gt; news.pubDate) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { col.insert(toInsert) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">Exception</span></span> =&gt; } } .... <span class="hljs-comment"><span class="hljs-comment">/** * Get news from DB * @param filter filter for find() method * @param sort object for sorting. by default sorts by pubDate * @param limit limit for news select. by default equals to newsLimit * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNews</span></span></span></span>(filter: <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>, sort: <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span> = <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"pubDate"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>), limit: <span class="hljs-type"><span class="hljs-type">Int</span></span> = newsLimit): <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">News</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { col.find(filter). sort(sort). limit(limit). map((o: <span class="hljs-type"><span class="hljs-type">DBObject</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">News</span></span>( id = o.as[<span class="hljs-type"><span class="hljs-type">ObjectId</span></span>](<span class="hljs-string"><span class="hljs-string">"_id"</span></span>).toString, title = o.as[<span class="hljs-type"><span class="hljs-type">String</span></span>](<span class="hljs-string"><span class="hljs-string">"title"</span></span>), link = o.as[<span class="hljs-type"><span class="hljs-type">String</span></span>](<span class="hljs-string"><span class="hljs-string">"link"</span></span>), content = o.as[<span class="hljs-type"><span class="hljs-type">String</span></span>](<span class="hljs-string"><span class="hljs-string">"content"</span></span>), tags = o.as[<span class="hljs-type"><span class="hljs-type">MongoDBList</span></span>](<span class="hljs-string"><span class="hljs-string">"tags"</span></span>).map(_.toString), pubDate = o.as[<span class="hljs-type"><span class="hljs-type">Long</span></span>](<span class="hljs-string"><span class="hljs-string">"pubDate"</span></span>)) }).toArray } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">MongoException</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } }</code> </pre><br></div></div><br>  Familiar to everyone who worked with MongoDB, the API and the trivial filling of the case class News instance.  While all elementary.  Even too much. <br>  Need something more interesting.  How about <a href="http://docs.mongodb.org/manual/aggregation/">aggregation</a> ? <br><br><div class="spoiler">  <b class="spoiler_title">Pulling out tags</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">/** * News tag container * @param name * @param total */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tags</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, total: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">/**</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tags</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">allows</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operate</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tags</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DB</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*/</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tags</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * News collection contains all tag info */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> col: <span class="hljs-type"><span class="hljs-type">MongoCollection</span></span> = <span class="hljs-type"><span class="hljs-type">Database</span></span>.collection(<span class="hljs-string"><span class="hljs-string">"news"</span></span>) <span class="hljs-comment"><span class="hljs-comment">/** * Get all tags as [{name: "", total: 0}] array of objects * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allTags</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">Tags</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> group = <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"$group"</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>( <span class="hljs-string"><span class="hljs-string">"_id"</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">"$tags"</span></span>, <span class="hljs-string"><span class="hljs-string">"total"</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"$sum"</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) )) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sort = <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"$sort"</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">MongoDBObject</span></span>(<span class="hljs-string"><span class="hljs-string">"total"</span></span>-&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { col.aggregate(group,sort).results.map((o: <span class="hljs-type"><span class="hljs-type">DBObject</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = o.as[<span class="hljs-type"><span class="hljs-type">MongoDBList</span></span>](<span class="hljs-string"><span class="hljs-string">"_id"</span></span>).toSeq.mkString(<span class="hljs-string"><span class="hljs-string">", "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> total = o.as[<span class="hljs-type"><span class="hljs-type">Int</span></span>](<span class="hljs-string"><span class="hljs-string">"total"</span></span>) <span class="hljs-type"><span class="hljs-type">Tags</span></span>(name, total) }).toArray } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">MongoException</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } }</code> </pre><br></div></div><br>  <code>.aggregate</code> allows <code>.aggregate</code> to work wonders without mapReduce.  And the principle of work in Scala is the same as from the console.  A kind of pipeline-way, only separated by commas.  Grouped by tags, summed up the same in total and sorted the whole thing.  Fine. <br><br>  By the way, <a href="http://en.wikipedia.org/wiki/Kasbah">Casbah is a citadel.</a> <br><br><h5>  You're JSON-XMLed </h5><br><blockquote>  <i>Never gonna give you up</i> <i><br></i>  <i>Never gonna let you down</i> <br></blockquote><br>  Because for a statically typed language, working with XML / JSON in this case looks like a joke.  Suspiciously brief. <br>  And in fact, parsing XML in Scala is a delight for my eyes (after massive factories in Java). <br><div class="spoiler">  <b class="spoiler_title">XML Parser</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> models.parsers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.xml._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models.<span class="hljs-type"><span class="hljs-type">News</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.<span class="hljs-type"><span class="hljs-type">Locale</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.text.{<span class="hljs-type"><span class="hljs-type">SimpleDateFormat</span></span>, <span class="hljs-type"><span class="hljs-type">ParseException</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.text._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> play.api.<span class="hljs-type"><span class="hljs-type">Play</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> collection.<span class="hljs-type"><span class="hljs-type">JavaConversions</span></span>._ <span class="hljs-comment"><span class="hljs-comment">/** * Simple XML parser */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parser</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * RSS urls from application.conf */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> urls = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-type"><span class="hljs-type">Play</span></span>.current.configuration.getStringList(<span class="hljs-string"><span class="hljs-string">"rss.urls"</span></span>).map(_.toList).getOrElse(<span class="hljs-type"><span class="hljs-type">List</span></span>()) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">Throwable</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>() } <span class="hljs-comment"><span class="hljs-comment">/** * Download and parse XML, fill News object and pass it to callback * @param cb */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downloadItems</span></span></span></span>(cb: (<span class="hljs-type"><span class="hljs-type">News</span></span>) =&gt; <span class="hljs-type"><span class="hljs-type">Unit</span></span>) = { urls.foreach { (url: <span class="hljs-type"><span class="hljs-type">String</span></span>) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { parseItem(<span class="hljs-type"><span class="hljs-type">XML</span></span>.load(url)).foreach(cb(_)) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">Exception</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } } <span class="hljs-comment"><span class="hljs-comment">/** * Parse standart RSS time * @param s * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseDateTime</span></span></span></span>(s: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Long</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SimpleDateFormat</span></span>(<span class="hljs-string"><span class="hljs-string">"EEE, dd MMM yyyy HH:mm:ss zzz"</span></span>, <span class="hljs-type"><span class="hljs-type">Locale</span></span>.<span class="hljs-type"><span class="hljs-type">ENGLISH</span></span>).parse(s).getTime / <span class="hljs-number"><span class="hljs-number">1000</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> e: <span class="hljs-type"><span class="hljs-type">ParseException</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } } <span class="hljs-comment"><span class="hljs-comment">/** * For all items in RSS parse its content and return list of News objects * @param xml * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseItem</span></span></span></span>(xml: <span class="hljs-type"><span class="hljs-type">Elem</span></span>): <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">News</span></span>] = (xml \\ <span class="hljs-string"><span class="hljs-string">"item"</span></span>).map(buildNews(_)).toList <span class="hljs-comment"><span class="hljs-comment">/** * Fill and return News object * @param node * @return */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildNews</span></span></span></span>(node: <span class="hljs-type"><span class="hljs-type">Node</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">News</span></span>( title = (node \\ <span class="hljs-string"><span class="hljs-string">"title"</span></span>).text, link = (node \\ <span class="hljs-string"><span class="hljs-string">"link"</span></span>).text, content = (node \\ <span class="hljs-string"><span class="hljs-string">"description"</span></span>).text, pubDate = parseDateTime((node \\ <span class="hljs-string"><span class="hljs-string">"pubDate"</span></span>).text), tags = <span class="hljs-type"><span class="hljs-type">Seq</span></span>((node \\ <span class="hljs-string"><span class="hljs-string">"category"</span></span>).text)) }</code> </pre><br></div></div><br><blockquote>  <b>I agree</b> <br>  At first, methods with the name of the form \ or \\ are driven into a stupor.  However, this makes some sense when you remember BigInteger from Java. </blockquote><br>  And what about JSON?  Native JSON in Scala is no subjective yet.  Slow and scary. <br>  In a difficult moment, Play and his Writes / Reads from the <code>play.api.libs.json</code> package <code>play.api.libs.json</code> .  Does anyone know the <code>JsonSerializable</code> interface from PHP 5.4?  So in Play is still easier! <br><br><div class="spoiler">  <b class="spoiler_title">JSON Writes</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val id: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params"> = "0", val title: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val link: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val content: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, val tags: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val pubDate: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">/**</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">allows</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operate</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">news</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">database</span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Companion</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*/</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Play Magic * @return */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newsWrites</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Json</span></span>.writes[<span class="hljs-type"><span class="hljs-type">News</span></span>] <span class="hljs-comment"><span class="hljs-comment">/** * Converts array of news to json * @param src Array of News instances * @return JSON string */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asJson</span></span></span></span>(src: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">News</span></span>]) = { <span class="hljs-type"><span class="hljs-type">Json</span></span>.stringify(<span class="hljs-type"><span class="hljs-type">Json</span></span>.toJson(src)) } }</code> </pre><br></div></div><br>  The <code>someObjectWrites</code> -line method <code>someObjectWrites</code> in simple cases of serialization removes all the questions.  Implicit conversions in Scala are powerful and convenient tools used in practice. <br>  But this is a very commonplace case.  When you want something special or complex, then <a href="http://www.playframework.com/documentation/2.2.x/ScalaJsonCombinators">functionalists and combinators</a> come to the rescue. <br><br><h5>  Through hardship to the stars </h5><br>  While the user is bored and waiting for a response to the request that was sent to the server by the script ... Wait a minute.  Still the same frontend. <br>  As promised, CoffeeScript and AngularJS were used.  After we started using this bundle in production, the number of pains just below the back when developing user interfaces decreased by 78.5% percent.  Like the amount of code. <br>  It is for this reason that I decided to use these stylish, fashionable and youth technologies in the reading room.  And also because the framework chosen by me has the compiler CoffeeScript and LESS on board. <br>  In fact, experienced developers do not learn anything new and interesting, so I will show only a couple of interesting tricks. <br><br>  Often it is necessary to exchange data between the angular controllers.  And what sophistries do not go to just some gentlemen (such as writing to localStorage) ... <br>  A casket just opens. <br><div class="spoiler">  <b class="spoiler_title">It is enough to create a service and implement it into the necessary controllers.</b> <div class="spoiler_text">  <b>Announcing</b> <br><pre> <code class="coffeescript hljs">define [<span class="hljs-string"><span class="hljs-string">"angular"</span></span>,<span class="hljs-string"><span class="hljs-string">"ngInfinite"</span></span>],<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(angular,infiniteScroll)</span></span></span><span class="hljs-function"> -&gt;</span></span> newsModule = angular.<span class="hljs-built_in"><span class="hljs-built_in">module</span></span>(<span class="hljs-string"><span class="hljs-string">"News"</span></span>, [<span class="hljs-string"><span class="hljs-string">'infinite-scroll'</span></span>]) newsModule.factory <span class="hljs-string"><span class="hljs-string">'broadcastService'</span></span>, [<span class="hljs-string"><span class="hljs-string">"$rootScope"</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($rootScope)</span></span></span><span class="hljs-function"> -&gt;</span></span> broadcastService = message: {}, broadcast: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sub, msg)</span></span></span><span class="hljs-function">-&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> msg == <span class="hljs-string"><span class="hljs-string">"number"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> msg = {} <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message[sub] = angular.copy msg $rootScope.$broadcast(sub) ] newsModule</code> </pre><br><br>  <b>We send</b> <br><pre> <code class="coffeescript hljs">define [<span class="hljs-string"><span class="hljs-string">"app/NewsModule"</span></span>], <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(newsModule)</span></span></span><span class="hljs-function">-&gt;</span></span> newsModule.controller <span class="hljs-string"><span class="hljs-string">"PanelCtrl"</span></span>, [<span class="hljs-string"><span class="hljs-string">"$scope"</span></span>, <span class="hljs-string"><span class="hljs-string">"$http"</span></span>, <span class="hljs-string"><span class="hljs-string">"broadcastService"</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($scope, $http, broadcastService)</span></span></span><span class="hljs-function">-&gt;</span></span> $scope.loadByTag = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tag)</span></span></span><span class="hljs-function"> -&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tag.active tag.active = <span class="hljs-literal"><span class="hljs-literal">false</span></span> broadcastService.broadcast(<span class="hljs-string"><span class="hljs-string">"loadAll"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> broadcastService.broadcast(<span class="hljs-string"><span class="hljs-string">"loadByTag"</span></span>,tag.name) ]</code> </pre><br><br>  <b>Get</b> <br><pre> <code class="coffeescript hljs">define [<span class="hljs-string"><span class="hljs-string">"app/NewsModule"</span></span>,<span class="hljs-string"><span class="hljs-string">"url"</span></span>], <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(newsModule,urlParser)</span></span></span><span class="hljs-function">-&gt;</span></span> newsModule.controller <span class="hljs-string"><span class="hljs-string">"NewsCtrl"</span></span>, [<span class="hljs-string"><span class="hljs-string">"$scope"</span></span>, <span class="hljs-string"><span class="hljs-string">"$http"</span></span>, <span class="hljs-string"><span class="hljs-string">"broadcastService"</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($scope, $http, broadcastService)</span></span></span><span class="hljs-function">-&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">#recieving message $scope.$on "loadAll", ()-&gt; $scope.after = 0 $scope.tag = false $scope.busy = false $scope.loadByTag() ]</span></span></code> </pre><br></div></div><br><blockquote>  <b>In angular</b> <br>  Services are singletons.  Therefore, we can drive messages back and forth, without fruiting instances. <br></blockquote><br><h5>  All arrived </h5><br>  After such a chaotic journey to the depths and back is worth summing up. <br>  Advantages and disadvantages, fatal and not so much, everyone should single out for himself.  We still use the tool where it fits, and do not cultivate the cargo, right? <br><br>  <b>I like it:</b> <br><ul><li>  Short Scala before Java.  For a statically typed language, there is somehow little code, and errors are caught in compile time.  That would not speak about tests, etc., and languages ‚Äã‚Äãof dynamic typification in this plan concede. </li><li>  The functionality of the framework itself, which provides many solutions, but does not impose a certain structure and style of writing code. </li></ul><br>  <b>Did not like:</b> <br><ul><li>  Yet hit refresh workflow works tight due to constant recompilation of modified sources.  Not deadly, but slows the flight of thought </li><li>  The windproblems (\\ vs /) of the framework together with the JVM do not allow to fully run the compiled and running application under the Win system.  Only in dev mode.  And here, especially the performance can not be measured.  Fortunately there are several nix servers at hand </li><li>  No logging in tests.  Allegedly due to wild memory leaks in the logger.  Well, I already find fault with it. </li></ul><br><br>  Also during development it is worth being careful when working with blocking operations using Future.  However, there is one thing but.  In spite of the fact that the main thread will not be blocked, another will be blocked.  And it is good if you have enough flows and there will not be many competitive requests.  But what if?  In this case, Play developers recommend using asynchronous in nature drivers for the same databases.  ReactiveMongo instead of Casbah, for example.  Or at least tune the actors and thread pools.  But that's another story ... <br><br>  Thank you for attention. <br><br>  PS <br>  If this writings did not seem enough - here is <a href="https://bitbucket.org/ImLiar/playrss">the Bitbucket repository</a> . </div><p>Source: <a href="https://habr.com/ru/post/197930/">https://habr.com/ru/post/197930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197918/index.html">RevealApp - Firebug for iOS applications</a></li>
<li><a href="../197920/index.html">What is the Entity System Framework and why is it needed in game devs?</a></li>
<li><a href="../197924/index.html">October 21-22, we invite you to Tizen Hackathon in Yaroslavl</a></li>
<li><a href="../197926/index.html">Java vs go</a></li>
<li><a href="../197928/index.html">HTML Form Validator</a></li>
<li><a href="../197932/index.html">Basics of dealing with implicit code duplication</a></li>
<li><a href="../197934/index.html">Using the service Corp2World, sending "messages to the world" from 1C</a></li>
<li><a href="../197936/index.html">Lexand A802 review: 8-inch tablet with non-standard "iron"</a></li>
<li><a href="../197938/index.html">Emergency satellite decommissioning: scenarios</a></li>
<li><a href="../197940/index.html">Java Stored Procedure in Oracle Subd. By Example of Forming a PDF File</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>