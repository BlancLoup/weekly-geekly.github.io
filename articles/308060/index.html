<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"In one basket": A little about the storage code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Efficient data storage interests absolutely everyone who is in any way connected with IT. We in IaaS-provider 1cloud constantly analyze the experience...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"In one basket": A little about the storage code</h1><div class="post__text post__text-html js-mediator-article">  Efficient data storage interests absolutely everyone who is in any way connected with IT.  We in <a href="https://1cloud.ru/">IaaS-provider 1cloud</a> constantly analyze the experience of colleagues - quite recently we <a href="https://habrahabr.ru/company/1cloud/blog/302124/">discussed</a> how large companies store their data. <br><br>  Today we will continue this topic and discuss how best to store your code: in one repository or in several.  We will also take a look at two examples that demonstrate the features of both approaches. <br><br> <a href="https://habrahabr.ru/company/1cloud/blog/308060/"><img src="https://habrastorage.org/files/01f/06a/138/01f06a138f8944aa97c96e5059511c6e.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>/ photo by <a href="https://www.flickr.com/photos/dskley/13935044783/">Dennis Skley</a> <a href="https://creativecommons.org/licenses/by-nd/2.0/">CC</a></i> <br><a name="habracut"></a><br>  Do I need to save my source in a single, monolithic repository, or should I break the code into blocks and write them into several different repositories?  As a rule, it depends on the team and the project it is working on.  First, consider the advantages and disadvantages of both types of storage. <br><br><h3>  Monolithic repository </h3><br>  Usually, the first thing that comes to mind is to write all the code in one repository, at least in the first stage: most projects start with this.  A repository is called monolithic if it contains two or more separate projects.  These projects are loosely or completely unrelated, and the repository itself contains too many files, commits, and other objects. <br><br>  The main advantage of storing code in a single repository <a href="http://boldradius.com/blog-post/Vwa-JCgAAB0B802v/source-control-single-repo-vs-multi-repo">is</a> that it is much easier to organize collaboration with the code.  We can create one common project consisting of several subprojects, and then link these subprojects as we wish. <br><br>  If a developer needs to change the code or principle of communication between parts of a project, it is easier to do this when he has access to the code of the entire project.  Suppose we are writing a system for online trading, which is based on microservice architecture.  When we write code for the cart service and we need to view or change the shared library, we can immediately go to it: we do not need to open another project or repository.  Since we can edit dependencies, we can quickly make global changes without worrying about versioning. <br><br>  When all the code is stored in one place, we just have to start the process and, for example, monitor how changes in the shared library affect the work with the basket.  Objects are available at any time from any place, changes are quick and painless.  But not everything is so smooth. <br><br>  Often, managers choose a single repository simply because it will be easier with them, and they supposedly know what they are doing.  Because of such decisions, there are frequent cases when developers make changes to parts of the code that they shouldn‚Äôt touch.  And this is easy to do if you have access to all the code, and the project has no clearly defined boundaries. <br><br>  Many problems arise when deploying and scaling.  Thus, the integrity of the system is lost.  The larger the repository volume, the slower the check will be.  If the code is stored in several repositories, the process can be parallelized, and errors that occur in one of the parts of the project will not be able to bring down the work of all services. <br><br>  <i>Conclusion:</i> If you have a small team or you are not going to expand, it is more logical to store all the code in one place.  It is convenient to use a single repository even if you are not working with microservices, but are developing a monolithic application. <br><br>  Several tips to mitigate the shortcomings of monolithic repositories in Git (large file sizes, the number of commits and pointers) <a href="https://habrahabr.ru/post/280358/">are</a> offered <a href="https://habrahabr.ru/post/280358/">here by the</a> user Habr. <br><br><h3>  Storing code in multiple repositories </h3><br>  Part of the problems that arise when there is a single repository is solved by introducing several repositories.  If we talk about microservices, then ideally for each service should be its own repository.  This approach facilitates the version control process: made changes to the library ‚Äî updated its version, corrected the service code ‚Äî updated its version. <br><br>  The presence of several repositories makes it necessary to write the code as if third-party developers were going to view it (which, by the way, is quite likely).  Instead of thinking of changes in the code as a large-scale change of the entire program, the developer begins to think about how to change one module without affecting the work of the entire system.  As a result, connectivity between modules weakens. <br><br>  This allows you to deploy them independently.  If our order processing service works with both versions of the protocol, we can deploy it even before the basket code is fixed.  Such an approach requires a high level of discipline. <br><br>  <i>Conclusion:</i> If your team is experienced enough to maintain regular version updates and work with microservices, or there are a lot of people who are organized in small groups, then it is better to store the code in several repositories.  The approach will also be useful in training new employees, who will become more disciplined if they follow the version update rules and preserve the boundaries between services. <br><br><h3>  How to store the code of Google and Kiln </h3><br>  Judging by the findings, most companies, especially large ones, would prefer to work with several repositories.  Even if so, there is at least one big exception to this rule.  Oddly enough, tens of thousands of Google developers today <a href="http://m.cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext">use a</a> monolithic repository, where about two billion lines of code are stored.  To maintain this scale, Google had to develop a version control system, better known as Piper. <br><br>  Access to Piper is organized using the Clients in the Cloud (CitC) system, consisting of cloud storage and the FUSE file system for Linux.  Each developer has a working environment in which the files they modified are stored.  All recorded files are stored in CitC in the form of snapshots, which allows, if necessary, ‚Äúroll back‚Äù the work several steps back. <br><br>  The built-in CitC tool for searching the CodeSearch code allows you to make minor corrections to the code, and also to transmit the modified code for checking with the possibility of autocommit: if the check is passed, a test is performed, after which the system sets the commit itself. <br><br>  The basis of the monolithic repository model is an approach called trunk-based development (‚Äútrunk development‚Äù).  The main (trunk) line <a href="http://www.ibm.com/developerworks/ru/library/j-ap10078/">is</a> the latest version of the code, changes are made one-time and sequentially.  Immediately after the commit, a new version of the code is available to all Piper users, that is, in fact, the developer always has a fresh version of the code before his eyes. <br><br>  As for adding functionality, both the old and the new code exist parallel to each other, and their use is monitored using configuration flags.  This approach avoids the problems that arise from the merging of changes. <br><br>  Stack Overflow users <a href="http://stackoverflow.com/questions/14679614/whats-the-best-practice-for-putting-multiple-projects-in-a-git-repository">are advised</a> to keep the code in a single repository, even when it is possible to split it into several repositories.  To do this, there are tools such as submodules in Git, external objects in Subversion, and sub-repositories in Mercurial. <br><br>  All of them are designed to build the internal hierarchy of a large project, and they can be used to select individual modules: <a href="http://stackoverflow.com/questions/5514739/best-practice-for-git-repositories-with-multiple-projects-in-traditional-n-tier%3Frq%3D1">just</a> put each project in a separate repository, and then use sub-modules to include the necessary projects at a certain hierarchy level. <br><br>  In addition, Git has the ability to create independent branches, which are called orphan (orphan).  They have nothing in common with each other and retain their history exclusively.  This is how a new orphan branch is created: <br><br><pre><code class="bash hljs">git checkout --orphan BRANCHNAME</code> </pre> <br>  Each individual project can be represented by a separate orphan branch.  For some reason, Git needs to do this cleanup after creating this branch: <br><br><pre> <code class="bash hljs">rm .git/index rm -r *</code> </pre> <br>  Before cleaning, make sure that the appropriate commit is set.  After it you can safely use the branch. <br>  Another option is to create several repositories and throw these branches into each of them (the repository names should not be the same): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># repo 1 git push origin master:master-1 # repo 2 git push origin master:master-2</span></span></code> </pre> <br>  Kiln developers, who once switched from a monolithic Subversion repository to a Mercurial multi-repository, adhere to a different <a href="http://help.fogcreek.com/8169/using-more-than-one-repository">opinion</a> about the storage of the code.  Their project is divided into five parts: exe-clients, server for client interaction (Reflector), site, billing system and library Aadvark. <br><br>  For each part, they created two repositories - devel and stable.  The first one gets new features, which later pass to the second, and the corrected bugs, on the contrary, are first placed in stable, and then as new functions are returned to devel.  For synchronization tags are used.  In Mercurial, they are repository metadata. <br><br>  For example, to deploy a new version of the site, the website-stable and aadvark-stable repositories are taken.  Each tag is attached, say, Website-000123.  Then, the build process starts, which clones both repositories from the server to the build directory and executes the hg up ‚ÄìC Website-000123 command to switch the local copy to the required tag.  After the build is assembled, it is deployed. <br><br><h3>  Conclusion </h3><br>  The choice of where and how to store the code should be approached intelligently, and this requires some effort.  It cannot be said that one approach is definitely better than the other.  You need to take into account the composition of the team, your experience and your goals, and to make a decision based on this.  Moreover, if you wish, you can always go from one repository to several, and vice versa. <br><br>  Anyway, any understanding comes with experience.  Sometimes it is useful to fill the cones, then to know what to fear and which methods will surely work.  Therefore, the time and the desire of everyone to make the maximum contribution to the development of the product will help you to truly understand what suits your team more. <br><br>  <strong>PS</strong> Our materials on the development of IaaS-provider <a href="https://1cloud.ru/">1cloud</a> : <br><br><ul><li>  <a href="https://1cloud.ru/news/how-to-create-iaas-provider">How to create a virtual infrastructure provider</a> </li><li>  <a href="https://1cloud.ru/news/it-project-area-choice">How to choose a direction for the development of an IT project</a> </li><li>  <a href="https://1cloud.ru/news/21-question-to-iaas-provider">What you need to know about IaaS-provider before starting work</a> </li></ul><br>  <strong>PPS</strong> Our new series of posts about the myths in the field of cloud technologies: <br><br><ul><li>  <a href="https://habrahabr.ru/company/1cloud/blog/307930/">Part 1: about "useless" technical support and "clever" services</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/308060/">https://habr.com/ru/post/308060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308044/index.html">How does the MTS Mobile Network Operations Center work?</a></li>
<li><a href="../308050/index.html">Questions Heilmeyer, Pierce and our developers answers</a></li>
<li><a href="../308054/index.html">Planning usability testing. Part 2</a></li>
<li><a href="../308056/index.html">Trello Clone on Phoenix and React. Parts 1-3</a></li>
<li><a href="../308058/index.html">"Let's talk about it": The work of the designer</a></li>
<li><a href="../308062/index.html">About the risks of using clouds</a></li>
<li><a href="../308064/index.html">Cisco and Fortinet confirmed the presence of vulnerabilities published by The Shadow Brokers hackers</a></li>
<li><a href="../308066/index.html">What do experts and users think about the new design of VKontakte?</a></li>
<li><a href="../308068/index.html">WebSockets in Scorocode or chat with your own hands in 15 minutes</a></li>
<li><a href="../308070/index.html">How are the channels in Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>