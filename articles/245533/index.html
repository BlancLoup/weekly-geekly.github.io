<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Containers for Windows: 10 years before Microsoft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In October 2014, Microsoft announced  a partnership with Docker , in which the implementation of container virtualization for a future version of Wind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Containers for Windows: 10 years before Microsoft</h1><div class="post__text post__text-html js-mediator-article">  In October 2014, Microsoft <a href="http://habrahabr.ru/company/microsoft/blog/240575/">announced</a> <a href=""><img width="250" height="187" src="https://habrastorage.org/files/5e0/9ba/95d/5e09ba95deb54f22a62e1ed8915981aa.jpg" alt="image" align="left"></a>  a partnership with <a href="https://www.docker.com/">Docker</a> , in which the implementation of container virtualization for a future version of Windows Server will be presented, expected in Q3 2015.  To support the containers Microsoft will use its own technology, developed in the research project <a href="http://research.microsoft.com/en-us/projects/drawbridge/">Drawbridge</a> .  The Drawbridge virtualization technology is similar to the one used in the <a href="https://www.winehq.org/">Wine</a> project, which allows running Windows applications on computers with UNIX-like operating systems.  A key feature of both technologies is that hardware virtualization (processor, memory, input / output devices) is not required, and only the Windows executable environment is emulated. <br>  Parallels began developing containers for Windows long before they thought about it at Microsoft.  And since this topic in connection with the announcement of Microsoft, obviously, becomes very relevant, in this post I will try to tell you what technologies our Windows containers work with, what functionality they have, and what the main scenarios of their use are.  In the comments is ready to answer all questions, including the most popular - how many containers as possible can be run on the host. <br><a name="habracut"></a><br><h5>  <b>Parallels Containers</b> </h5><br>  The increase in computing power continues to obey <a href="https://en.wikipedia.org/wiki/Moore%2527s_law">Moore's law</a> , but how to effectively use these systems with minimal overhead?  One possible solution is to use containers to control resources and isolate applications running by different users.  Without false modesty, the pioneer and leader in the advancement of container technology is Parallels, which, in addition to products for the OS based on the Linux kernel, has been offering its own implementation of <a href="http://sp.parallels.com/products/parallels-containers-windows/">Windows containers for</a> almost 10 years.  The approach implemented in Parallels is based on <a href="http://sp.parallels.com/ru/products/pvc/os-virtualization/">OS kernel virtualization</a> , which, after modifications, is capable of running an arbitrary number of Windows user environments. <br><br> <a href=""><img width="250" height="134" src="https://habrastorage.org/files/288/385/8aa/2883858aa7c24f5eba950649074eccfc.jpg" alt="image" align="left"></a>  The user environment is located on a virtual disk containing references to Windows OS files and its own system registry;  Windows OS system files are launched from the same disk, which form the environment for users (including the administrator), with the possibility of domain membership, application operation and network interaction via a virtual adapter.  This is what we call Parallels-container for Windows. <br><br><h5>  <b>And what's under the hood?</b> </h5><br>  Parallels containers ‚Äî both for Linux-based OS and Windows ‚Äî rely on kernel modifications.  And if the Linux community took most of these changes from Parallels to the main branch of the kernel source, Microsoft wasn‚Äôt so open.  During the work on the containers, we sent a large number of messages to Microsoft about the detected limitations and simple errors in the components of the Windows kernel.  Some of them were taken into account in the following versions of Windows, and to solve more than a dozen problems, Microsoft released separate fix packs.  So we can say that we also participate, albeit indirectly, in the development of the Windows core components.  But, unfortunately, they did not dare to go on our initiatives to expand cooperation in Microsoft. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So how does this still work if Microsoft does not accept the changes and does not provide access to the source code of the Windows kernel?  When developing Parallels containers, 2 technologies occupy a central place: <a href="https://en.wikipedia.org/wiki/Reverse_engineering">reverse engineering</a> and <a href="http://en.wikipedia.org/wiki/Dynamic_software_updating">updating the program code during execution</a> . <br> <a href=""><img width="350" height="187" src="https://habrastorage.org/files/ed7/f2a/0b0/ed7f2a0b00ed47c8a9bb0d682529e411.jpg"></a> <br><br>  And if reverse engineering is rather a practical application of the method of scientific knowledge, known as <a href="https://en.wikipedia.org/wiki/Systems_analysis">systems analysis</a> , in the field of computer science, then we are really proud of the implementation of the technology of updating the program code during execution in Parallels, considering it one of the best in the world , and protect patents. <br><br>  As already noted, the entire virtualization technology works in the OS kernel, which allows the separation of kernel objects between containers, thereby isolating the containers from each other.  Each container has its own set of processes, sessions and drivers, as well as the registry and the tree of kernel objects. <br> <a href=""><img width="400" height="278" src="https://habrastorage.org/files/f9b/2a9/8e3/f9b2a98e330841f989c6fc1ff432e02f.jpg"></a> <br><br>  Pay attention to the screenshots.  First, it can be concluded that the experience of user interaction with the OS in the container is no different from interaction with the Windows operating system itself, and secondly, it becomes clear how isolation works.  Containers know nothing about each other or about the host on which they are located, but from the host containers are easily accessible, so the host administrator is the SuperAdministrator for containers.  Containers are integrated into Windows so that standard OS tools such as Task Manager, Registry Editor and <a href="http://technet.microsoft.com/en-US/sysinternals/bb545021.aspx">Mark Russinovich‚Äôs Sysinternals</a> toolkit can be used to manage and monitor containers. <br><br><h5>  <b>How much to hang in grams?</b> </h5><br>  The most popular question of our users is how many Parallels containers can be run on a host?  In the Parallels laboratory, during the experiment, we were able to launch about 600 containers into which it was possible to log in via RDP, although the delays in the response of the user interface were already unacceptably long.  Further experiments have confirmed that the overhead of virtualizing the OS kernel is relatively small and noticeably less than in <a href="https://en.wikipedia.org/wiki/Hypervisor">hypervisor-</a> based solutions, so the deciding factors will be the applications you plan to run in the container and the physical capabilities of the host itself. <br><br> <a href=""><img width="250" height="282" src="https://habrastorage.org/files/4d1/903/592/4d19035927164cef89db81d6b2c3a1c8.jpg" alt="image" align="left"></a>  For real-life applications, the number of applications inside containers needs to be limited, so resource control is a key feature of Parallels containers.  You can control the consumption of container computing power of processors, memory, storage space on the storage system and network traffic. <br><br><h5>  <b>Application Templates</b> </h5><br>  How to deploy applications inside Parallels containers?  You can do it as usual by running the application installer, but if there are a lot of containers, you will have to press the ‚ÄúInstall‚Äù button incalculable times.  To automate the process and not to waste container disk space to host application files, we use Application Templates.  Physically, a template is a file that stores information that reproduces the original location of files, folders, and registry keys.  To create an application template, use a special tool, the Template Creation Wizard, which tracks all changes in the file system and in the registry that the application installer makes and saves these changes to the application template.  The resulting application pattern can be connected to any container, which will be equivalent to installing this application, and immediately start using it in the container.  The user of Parallels containers can create a template from any application that can be installed inside the container. <br> <a href=""><img width="300" height="210" src="https://habrastorage.org/files/fb5/09b/dcc/fb509bdcc3644a9eaa5f05d930534ccb.jpg"></a> <br><br><h5>  <b>Copy-on-write file system</b> </h5><br>  Parallels containers share with each other not only the kernel, but also all the files installed on the host from the Windows OC distribution, which saves space on the storage system.  <a href="https://en.wikipedia.org/wiki/Data_deduplication">Deduplication of data is</a> carried out at the file level using templates and a specialized file system with support for <a href="https://en.wikipedia.org/wiki/Copy-on-write">copy-on-write</a> .  For each supported version of the Windows operating system, including language localizations, Parallels releases an OS template.  The OS template differs from the application template only in that the contents of the files are not stored in it.  From within the container, accessing files from an OS template looks completely transparent, creating a holistic view of the Windows file structure, consisting of files that are common and private to the container.  Support in the file system copy-on-write allows you to avoid modifying files from the OS template, saving the changes only inside the container. <br> <a href=""><img width="300" height="275" src="https://habrastorage.org/files/d09/e92/f9b/d09e92f9b5d246099345649b8c049aa3.jpg"></a> <br><br><h5>  <b>Who needs it?</b> </h5><br>  From the very beginning of the project, we in Parallels offered our containers for hosting web applications, the most important of which is the <a href="http://sp.parallels.com/products/plesk/">Parallels Plesk</a> automation system.  Parallels container-based hosting products are offered by the world's leading providers, such as AT &amp; T, 1 &amp; 1, GoDaddy, HostEurope, and others. <br><img src="https://habrastorage.org/files/103/390/f8c/103390f8c8dc4384aa24e799d004357f.jpg"><br><br>  But most of all, Parallels containers for Windows are suitable for deploying many identical environments that are managed and configured uniformly.  An example of such a scenario is <a href="http://en.wikipedia.org/wiki/Desktop_virtualization">desktop virtualization</a> .  So, Parallels in partnership with the integrator IBS has developed and since 2013 has <a href="http://www.ibs.ru/media/news/kompaniya-ibs-soobshchaet-o-poluchenii-sertifikata-fstek-rossii-na-sistemu-virtualizatsii-rabochikh-mest-parallels-vdi/">been</a> offering the <a href="http://www.ibs.ru/media/news/kompaniya-ibs-soobshchaet-o-poluchenii-sertifikata-fstek-rossii-na-sistemu-virtualizatsii-rabochikh-mest-parallels-vdi/">FSTEC-certified</a> <a href="http://sp.parallels.com/ru/news/id,32533">Parallels VDI</a> solution, which consists of a connection broker and container-based virtualization.  At the moment, on the basis of this decision, a large-scale project is being implemented to automate the Federal Tax Service of the Russian Federation, involving the transfer to the cloud-based data center of more than 10,000 jobs. <br><br><h5>  <b>Project history</b> </h5><br>  The project of containers under Windows was launched in May 2002, after successful experiments with Parallels containers based on the Linux kernel.  In January 2003, a prototype was demonstrated on Windows 2000 Server, which was able to run 50 isolated copies of Microsoft IIS and Microsoft SQL Server, and in June 2005, the first public release of Parallels Virtuozzo Containers for Windows 2003 Server version 3.0 took place. <br><br>  To date, the project has experienced 7 public releases, nearly 300 updates have been released, and the project code base has exceeded 1,300,000 SLOCs.  More recently, the total number of containers created using Parallels technologies (including the one described) <a href="http://www.spbit.su/news/n174740/">exceeded 1.000.000</a> ! <br><br>  Parallels containers have also earned high marks at Microsoft - in private conversations the engineers of this company spoke of the project as the most technically complex for the Windows kernel. <br><br><img src="https://habrastorage.org/files/ec1/e72/947/ec1e729478d84c7faba700c9296ee17b.jpg"><br><br><h5>  <b>Conclusion</b> </h5><br>  Microsoft‚Äôs entry into the container market will no doubt make this approach to virtualization much more popular, and Docker solutions will allow wrapping applications into containers in an easy and convenient way.  From a technical point of view, the small cost of virtualization and the ability to implement containers exclusively in the user mode of the OS can be considered the advantage of Microsoft containers.  The disadvantages include difficulties in ensuring application compatibility, because for this it is necessary to emulate the entire <a href="https://en.wikipedia.org/wiki/Windows_API">Windows API</a> , which currently has thousands of calls. <br><br>  Despite the fact that the approaches to the implementation of containers in Parallels and Microsoft are different, both technologies can perfectly complement each other - Microsoft containers will probably be able to work inside Parallels containers.  Therefore, we consider Microsoft not as a competitor, but as the creator of the Windows ecosystem, in which container virtualization occupies an important place. <br><br>  We can hope that the fact that container virtualization projects for OS based on the Linux kernel that are currently on the market are not in a state of competition - most of them are teams from Parallels, Google, IBM, Canonical, Docker, etc.  work together.  And although the Windows ecosystem is understandably more closed for obvious reasons, we look forward to further cooperation. <br><br>  Learn more and try Parallels Containers for Windows <a href="http://sp.parallels.com/ru/products/parallels-containers-windows/">here</a> . <br>  I will also try to answer all your questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/245533/">https://habr.com/ru/post/245533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245523/index.html">Concurrent programming with CUDA. Part 2: GPU hardware and parallel communication patterns</a></li>
<li><a href="../245525/index.html">Peter Thiel: How to build a monopoly?</a></li>
<li><a href="../245527/index.html">Qt Creator 3.3 IDE Release</a></li>
<li><a href="../245529/index.html">Payments via WebMoney and other benefits of the Timeweb affiliate program</a></li>
<li><a href="../245531/index.html">Code Review Process with Atlassian Stash</a></li>
<li><a href="../245535/index.html">Private library: information etiquette, preparation for large projects, lean manufacturing, space exploration</a></li>
<li><a href="../245537/index.html">Crowdsourcing translation of OWASP Testing Guide 4.0 has been launched into 30+ languages ‚Äã‚Äã(including Russian)</a></li>
<li><a href="../245539/index.html">Embedding into the Linux kernel: intercepting system calls</a></li>
<li><a href="../245545/index.html">Birch's hypothesis - Swinnerton-Dyer</a></li>
<li><a href="../245549/index.html">Multiple versions of php on the same server. suphp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>