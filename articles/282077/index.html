<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chat bot development for Bitrix24</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My previous article on the development of a chat bot for Facebook Messenger showed that the topic is interesting to the inhabitants of Habr, so I cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chat bot development for Bitrix24</h1><div class="post__text post__text-html js-mediator-article">  My previous <a href="https://habrahabr.ru/post/281559/">article on the development of a chat bot for Facebook Messenger</a> showed that the topic is interesting to the inhabitants of Habr, so I continue. <br>  Today we will have a bot development for the Bitrix24 messenger.  The development language is the same - PHP. <br><a name="habracut"></a><br><h2>  general information </h2><br>  The platform for chat-bots Bitrkis24 appeared at the end of March of this year. <br>  At the time of writing the bot, GitHub did not have a PHP library, so I wrote my own - <a href="https://github.com/pimax/bitrix24-bot-php">github.com/pimax/bitrix24-bot-php</a> <br><br><h2>  Write the code </h2><br>  The easiest option is to clone the repository <a href="https://github.com/pimax/bitrix24-bot-php-example">github.com/pimax/bitrix24-bot-php-example</a> <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/pimax/bitrix24-bot-php-example.git . composer install cp config_example.php config.php</code> </pre> <br>  Open the config.php for editing and fill in the information about your bot. <br>  I will not dwell here in detail so as not to inflate the article, each parameter is supplied with a comment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let me explain in more detail the main part of the demo-bot. <br>  In total, Bitrix24 transmits 4 types of events to the webhook: <br><br><h3>  ONAPPINSTALL - Installing the bot on the portal </h3><br><pre> <code class="php hljs">$bot-&gt;install(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bot( $config[<span class="hljs-string"><span class="hljs-string">'alias'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'type'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'url_message_add'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'url_welcome_message'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'url_bot_delete'</span></span>], $config[<span class="hljs-string"><span class="hljs-string">'data'</span></span>] ));</code> </pre><br>  Everything here is elementary - we take the data from the config of our application and register the bot on the portal. <br>  This code is unlikely to change with you. <br><br><h3>  ONIMBOTDELETE - Remove the bot </h3><br><pre> <code class="php hljs">$bot-&gt;uninstall();</code> </pre><br>  Remove the bot from the portal. <br>  Similar to the previous one, it is unlikely to change. <br><br><h3>  ONIMBOTJOINCHAT - Inviting a bot to chat </h3><br><pre> <code class="php hljs">$bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>], [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command1]Command 1[/send]'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command2]Command 2[/send]'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command3]Command 3[/send]'</span></span>), ]));</code> </pre><br>  Here options are already possible.  A good tone is the behavior in which in the first message the bot will report its commands to the user.  To prevent the user from entering commands manually, Bitrix24 provided the [send] code, which sends a message to the bot when clicking on a link. <br><br>  This is how it looks like: <br><br><img src="https://habrastorage.org/files/23e/db5/db7/23edb5db744f4b9aabc9290f860d91d7.png"><br><br><h3>  ONIMBOTMESSAGEADD - Receiving a message from a user </h3><br>  The main type for us. <br>  In it, we must understand what the user wants from the bot, prepare an answer, and send a response to the user. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'MESSAGE'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'/command1'</span></span>: $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Command 1 response"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'/command2'</span></span>: $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Command 2 response"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'/command3'</span></span>: $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Command 3 response"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>], [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command1]Command 1[/send]'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command2]Command 2[/send]'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send=/command3]Command 3[/send]'</span></span>), ])); }</code> </pre><br>  This code processes three commands, and in case the user has sent something else, it will again display a list of available commands. <br><br><h2>  Application Placement </h2><br>  Go to the section Applications&gt; Add application of your portal. <br><br>  Specify the name of the application, tick the "Application uses only API". <br>  In the access rights, we note ‚ÄúCreating and managing chat bots‚Äù. <br>  In the field Specify the link and specify the callback-link for the installation event indicate the link to our bot, for example: <a href="https://example.com/apps/bitrix24/">example.com/apps/bitrix24</a> <br>  Press the save button. <br><br><h2>  A real example of Bota for Job4Joy freelance exchange </h2><br>  For the purity of the experiment, we take the same task as in the article about Facebook Messenger and develop a chat bot for the Job4Joy freelance exchange. <br><br>  So, our goal is to implement a bot, which, at our request, will issue new projects in the appropriate category. <br>  Data will be received via RSS using picoFeed - <a href="https://github.com/fguillot/picoFeed">github.com/fguillot/picoFeed</a> <br>  And <a href="https://github.com/SebastianM/GooglShortener">github.com/SebastianM/GooglShortener</a> for shortening links. <br><br>  We perform <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/pimax/bitrix24-bot-php-example.git . composer install cp config_example.php config.php</code> </pre><br>  Next, edit config.php and add the list of feeds and the token for goo.gl: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'google_token'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'feeds'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'/all'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'All jobs'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/webdev'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Web Development'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=3'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/software'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Software Development &amp; IT'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=5'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/design'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Design &amp; Multimedia'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=2'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/mobile'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Mobile Application'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=7'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/server'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Host &amp; Server Management'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=6'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/writing'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Writing'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=8'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Customer Service'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=10'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/marketing'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Marketing'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=11'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/business'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Business Services'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=12'</span></span> ], <span class="hljs-string"><span class="hljs-string">'/translations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Translation &amp; Languages'</span></span>, <span class="hljs-string"><span class="hljs-string">'Feed'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://job4joy.com/marketplace/rss/?id=14'</span></span> ] ]</code> </pre><br>  Create a file messages / ru.php, with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'Hello! I can help you with IT projects.'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'!       .'</span></span>, <span class="hljs-string"><span class="hljs-string">'find work &amp; hire freelancers'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span>, <span class="hljs-string"><span class="hljs-string">'All jobs'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'Web Development'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'Software Development &amp; IT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'Design &amp; Multimedia'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'Mobile Application'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'Host &amp; Server Management'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'Writing'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'Customer Service'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'Marketing'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'Business Services'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'Translation &amp; Languages'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'New projects not a found!'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'   !'</span></span> ];</code> </pre><br>  The basic language of our bot is English, but we will also support Russian. <br><br>  Add the GoogleShortener library connection to index.php: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> (dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>) .<span class="hljs-string"><span class="hljs-string">'/GooglShortener.php'</span></span>); $googl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GooglShortener($config[<span class="hljs-string"><span class="hljs-string">'google_token'</span></span>]);</code> </pre><br>  Write the logging function immediately: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Log * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $data Data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $title Title * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $title = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $log = <span class="hljs-string"><span class="hljs-string">"\n------------------------\n"</span></span>; $log .= date(<span class="hljs-string"><span class="hljs-string">"Ymd G:i:s"</span></span>) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $log .= (strlen($title) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? $title : <span class="hljs-string"><span class="hljs-string">'DEBUG'</span></span>) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $log .= print_r($data, <span class="hljs-number"><span class="hljs-number">1</span></span>); $log .= <span class="hljs-string"><span class="hljs-string">"\n------------------------\n"</span></span>; file_put_contents(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/imbot.log'</span></span>, $log, FILE_APPEND); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  Next, we write the function of the bot's welcome message: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Send Help Message * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $bot Bot instance * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHelpMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($bot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $config; $attach = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($config[<span class="hljs-string"><span class="hljs-string">'feeds'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $com =&gt; $feed) { $attach[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">'[send='</span></span>.$com.<span class="hljs-string"><span class="hljs-string">']'</span></span>.$bot-&gt;t($feed[<span class="hljs-string"><span class="hljs-string">'Title'</span></span>]).<span class="hljs-string"><span class="hljs-string">'[/send]'</span></span>); } $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message($bot-&gt;t(<span class="hljs-string"><span class="hljs-string">'Hello! I can help you with IT projects.'</span></span>), $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>], $attach)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  Next, write a function to get a list of projects for a specific feed and send messages to the user: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Get Feed Data * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $feed Feed data * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $bot Bot instance * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFeed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($feed, $bot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $googl; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Reader; $resource = $reader-&gt;download($feed[<span class="hljs-string"><span class="hljs-string">'Feed'</span></span>]); $parser = $reader-&gt;getParser( $resource-&gt;getUrl(), $resource-&gt;getContent(), $resource-&gt;getEncoding() ); $feed = $parser-&gt;execute(); $items = array_reverse($feed-&gt;getItems()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($items)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($items <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $itm) { $url = $googl-&gt;shorten($itm-&gt;getUrl()); $message = substr(strip_tags($itm-&gt;getContent()), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>); $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message(<span class="hljs-string"><span class="hljs-string">"[B]"</span></span>.$itm-&gt;getTitle() . <span class="hljs-string"><span class="hljs-string">"[/B]\n"</span></span> . $message . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>]), [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Link($url-&gt;id, $url-&gt;id) ]); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $bot-&gt;send(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Message($bot-&gt;t(<span class="hljs-string"><span class="hljs-string">'New projects not a found!'</span></span>), $_REQUEST[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-string"><span class="hljs-string">'PARAMS'</span></span>][<span class="hljs-string"><span class="hljs-string">'DIALOG_ID'</span></span>])); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { writeToLog($e-&gt;getMessage(), <span class="hljs-string"><span class="hljs-string">'Exception'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  That's all.  The full code is posted on GitHub - <a href="https://github.com/pimax/job4joy_bitrix24bot">github.com/pimax/job4joy_bitrix24bot</a> <br><br><h2>  Publication in the directory for all </h2><br>  Now the application is available only to users of your portal. <br>  In order to publish applications in the catalog for all, you need to become a 1C-Bitrix partner. <br>  Detailed information on this process is available here - <a href="https://www.bitrix24.ru/apps/dev.php">www.bitrix24.ru/apps/dev.php</a> <br><br><h2>  Conclusion </h2><br>  In general, the platform makes a rather pleasant impression, despite its young age. <br>  The biggest disadvantage for developers is quite a long moderation time.  The bill can go for weeks without exaggeration.  Perhaps this is due to the heavy load on the moderators and they do not have time.  Today, the problem is typical for many messengers. <br><br><h2>  useful links </h2><br><ol><li>  An article on 1C-Bitrix about chatbots platform - <a href="http://dev.1c-bitrix.ru/community/blogs/marketplace_apps24/we-present-a-platform-for-chatbots-for-bitrix24.php">dev.1c-bitrix.ru/community/blogs/marketplace_apps24/we-present-a-platform-for-chatbots-for-bitrix24.php</a> </li><li>  Bitrix24 Bot PHP SDK - <a href="https://github.com/pimax/bitrix24-bot-php">github.com/pimax/bitrix24-bot-php</a> </li><li>  Bitrix24 Bot PHP SDK Example - <a href="https://github.com/pimax/bitrix24-bot-php-example">github.com/pimax/bitrix24-bot-php-example</a> </li><li>  Job4Joy Bot PHP Sources - <a href="https://github.com/pimax/job4joy_bitrix24bot">github.com/pimax/job4joy_bitrix24bot</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/282077/">https://habr.com/ru/post/282077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282065/index.html">How it is made: mobile cross-platform engine</a></li>
<li><a href="../282067/index.html">From the command line for knowledge</a></li>
<li><a href="../282071/index.html">What does the convolutional neural network look at when it sees nudity?</a></li>
<li><a href="../282073/index.html">Summit comes to us ...</a></li>
<li><a href="../282075/index.html">Week before the 5th International Mobile Conference MBLT16</a></li>
<li><a href="../282079/index.html">Low FPS while scrolling the page. Problem solving background-attachment: fixed</a></li>
<li><a href="../282081/index.html">Mathematical model of perception (Part 1)</a></li>
<li><a href="../282085/index.html">Long archival data storage, or How to see my great-grandmother's selfie?</a></li>
<li><a href="../282087/index.html">Investigate the "Inspector" Roskomnadzor</a></li>
<li><a href="../282089/index.html">The Basics of Developing 3D Games in Intel XDK at BabylonJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>