<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RPKI integration into BGP on Juniper routers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I wanted to put together all the information on the RPKI certification system, but the topic turned out to be quite extensive, besides I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RPKI integration into BGP on Juniper routers</h1><div class="post__text post__text-html js-mediator-article">  In this post I wanted to put together all the information on the RPKI certification system, but the topic turned out to be quite extensive, besides I came across several articles in the Russian-language part of the Internet which describe in detail how RPKI works (links to these articles at the end of the post).  With examples of setting up and using RPKI on the living gland, everything is getting worse.  Therefore, I decided to make an article in the style of HOW-TO.  The information presented in the article can help providers automate the process of checking received prefixes from clients and eliminate errors in filters.  Anyone who is interested in protecting dynamic routing with RPKI tools and setting up the RPKI cache server on Linux, please ask for cat. <br><a name="habracut"></a><br><h4>  Theory </h4><br>  First, a few terms: <br><br>  <b>RPKI (Resource Public Key Infrastructure)</b> is a hierarchical public key system (PKI) designed to provide security for global routing on the Internet.  RPKI uses the X.509 PKI ( <a href="http://tools.ietf.org/html/rfc5280">RFC5280</a> ) certificate architecture with an additional extension that allows the use of IP addresses and AS numbers ( <a href="http://tools.ietf.org/html/rfc3779">RFC3779</a> ).  The certificate structure allows you to determine the order of distribution of Internet resources (IP addresses and autonomous systems numbers).  Internet resources are initially distributed by IANA through the Regional Internet Registries (RIRs), which in turn distribute them to the Local Internet Registries (LIRs), and they in turn distribute the Internet resources among their customers.  The RPKI system is built in the same way.  Each subsequent distribution of Internet resources is accompanied by the creation of a certificate that is signed with the key of the ‚Äúparent‚Äù, that is, the organization that originally provided these Internet resources.  The totality of such certificates attached to each Internet resource constitute a database by which you can verify the accuracy of the information.  Such databases are located on public RPKI repositories of all RIRs. <br><br>  <b>ROA (Route Origin Authorization)</b> - permission to create a route.  In accordance with the specification, ROA contains the number of an authorized AS, a list of IP prefixes that this AS has permission to announce and a certificate describing the corresponding information resources.  You can read more about the certification system in the article "Certification of Addressable Internet Resources" link to which you will find at the end of the post. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Although prefixes can be checked by each router separately for a direct RPKI session, this approach is not recommended because it requires a lot of router resources (demanding cryptographic operations when retrieving RPKI data).  To use this data, the best practice is to support your local RPKI cache server, which will synchronize your database with public RPKI repositories.  The received data is processed and verified on the cache server.  Next, the cache server generates prefix-to-AS entries.  The generated database is downloaded to the router via a secure TCP connection using the RPKI-RTR protocol.  Thus, the router is not required to process cryptographic information and operate on RPKI data.  Subsequently, the router uses a ready-made table for checking prefixes. <br><br>  On the router, the database is presented in the format of RV (route validation) records.  The RV database contains a collection of RV records available for the router to download from the RPKI cache server.  An RV record consists of: a prefix, a maximum prefix length, and an AS source.  This entry is used to check each route with which the prefix field of the RV entry matches.  It also checks the maximum length of the record specified in the RV and the correspondence of the AS number.  RV recording is a simplified form of ROA recording.  Since the ROA entries themselves are not used to validate routes, the cache server exports the already generated RV entries to the router. <br><br>  Steps to check the route for RV records: <br><ul><li>  The maximum prefix length in the RV entry must be greater than or equal to the length of the route mask for which the entry was created. </li><li>  The first (right) AS prefix presented in AS_PATH must match the AS number in the RV record. </li></ul><br>  All prefixes are checked by the router regardless of the state of the local RV records database.  If the database is empty at the time of the check, the status will be set to <i>unknown</i> on all prefixes, as there is no information about this prefix in the database.  Each time the database is updated, the router resets the timer on the cache server, thus setting a baseline for changes in the database and stores in its memory the version of the database.  When reconnecting, the router sends the version of the database that is in its memory to the cache server and if the version is not current, an update will occur. <br><br>  The prefix received by eBGP based on the verification can take on three states: <br><ul><li>  Valid - indicates that the prefix and AS number are in the database </li><li>  Invalid - indicates that the prefix was found in the database, but the AS number of the source prefix does not match the AS number specified in the database, or the length of the prefix in the BGP message exceeds the maximum allowed length specified in the database </li><li>  Unknown - indicates that the prefix is ‚Äã‚Äãnot found in the database and does not belong to any network in the database. </li></ul><br><h4>  Practice </h4><br>  First we need to configure the RPKI cache server with which our router will communicate.  For these purposes, the RIPE NCC developed their application RPKI validator running on UNIX-like OS and consisting of two parts: <br><ol><li>  Web interface for working with the RPKI database </li><li>  Daemon to work with the router </li></ol><br>  Java 7 is required to install it. All further steps to install the RPKI validator will be done on Ubuntu 12.04. <br><br>  Install Java 7: <br><pre><code class="bash hljs">sudo apt-get remove openjdk* sudo add-apt-repository ppa:webupd8team/java sudo apt-get update sudo apt-get install oracle-java7-installer <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_HOME=/usr/lib/jvm/java-7-oracle <span class="hljs-comment"><span class="hljs-comment">#    bashrc echo "export JAVA_HOME=/usr/lib/jvm/java-7-oracle" &gt;&gt; /etc/bash.bashrc</span></span></code> </pre> <br>  Install the validator itself from the <a href="http://www.ripe.net/lir-services/resource-management/certification/tools-and-resources">RIPE</a> page: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget https://certification.ripe.net/content/static/validator/rpki-validator-app-2.15-dist.tar.gz tar -xzvf /tmp/rpki-validator-app-2.15-dist.tar.gz -O &lt;_&gt;</code> </pre><br>  Run validator: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> &lt;_&gt; ./rpki-validator.sh start</code> </pre><br>  In response, we will see: <br><pre> <code class="bash hljs">[ info ] Starting rpki-validator... [ info ] writing logs under <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> directory [ info ] Web user interface is available on port 8080 [ info ] Routers can connect on port 8282 [ info ] Writing PID 15860 to validator.pid</code> </pre><br>  As you can see from the message, the validator daemon occupies two ports: <br><ul><li>  8080 - RPKI validator web management interface </li><li>  8282 - interface for connecting a router </li></ul><br>  You can check the operation of the RPKI validator using curl using the API: <br><pre> <code class="bash hljs">curl http://localhost:8080/api/v1/validity/AS174/89.207.56.0/21</code> </pre><br>  where AS174 is the AS number, 89.207.56.0/21 is the AS prefix requiring verification.  In response, we get: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"validated_route"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"route"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"origin_asn"</span></span>:<span class="hljs-string"><span class="hljs-string">"AS174"</span></span>, <span class="hljs-string"><span class="hljs-string">"prefix"</span></span>:<span class="hljs-string"><span class="hljs-string">"89.207.56.0/21"</span></span> }, <span class="hljs-string"><span class="hljs-string">"validity"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"state"</span></span>:<span class="hljs-string"><span class="hljs-string">"Valid"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"At least one VRP Matches the Route Prefix"</span></span>, <span class="hljs-string"><span class="hljs-string">"VRPs"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"matched"</span></span>:[{ <span class="hljs-string"><span class="hljs-string">"asn"</span></span>:<span class="hljs-string"><span class="hljs-string">"AS174"</span></span>, <span class="hljs-string"><span class="hljs-string">"prefix"</span></span>:<span class="hljs-string"><span class="hljs-string">"89.207.56.0/21"</span></span>, <span class="hljs-string"><span class="hljs-string">"max_length"</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span> }], <span class="hljs-string"><span class="hljs-string">"unmatched_as"</span></span>:[{ <span class="hljs-string"><span class="hljs-string">"asn"</span></span>:<span class="hljs-string"><span class="hljs-string">"AS3257"</span></span>, <span class="hljs-string"><span class="hljs-string">"prefix"</span></span>:<span class="hljs-string"><span class="hljs-string">"89.207.56.0/21"</span></span>, <span class="hljs-string"><span class="hljs-string">"max_length"</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span> },{ <span class="hljs-string"><span class="hljs-string">"asn"</span></span>:<span class="hljs-string"><span class="hljs-string">"AS41073"</span></span>, <span class="hljs-string"><span class="hljs-string">"prefix"</span></span>:<span class="hljs-string"><span class="hljs-string">"89.207.56.0/21"</span></span>, <span class="hljs-string"><span class="hljs-string">"max_length"</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span> }], <span class="hljs-string"><span class="hljs-string">"unmatched_length"</span></span>:[] } } } }</code> </pre><br><br>  Having come to the address &lt;ip_address_server&gt;: 8080 in the browser, we will see the management interface. <br><img src="https://habrastorage.org/getpro/habr/post_images/8bd/460/7d9/8bd4607d93eb92b3a95854cf4e716418.png" alt="image"><br><br>  On the ‚ÄúTrust Anchors‚Äù tab there is a list of all RPKI root servers. <br><img src="https://habrastorage.org/getpro/habr/post_images/dd6/06b/56e/dd606b56ea69f95df01247474a6669e6.png" alt="image"><br><br>  On the ROAs tab, a list of all prefixes with RPKI signatures installed (all known ROAs).  The interface allows you to search by any parameter, for example, the AS number (AS174 - provider Cogent). <br><img src="https://habrastorage.org/getpro/habr/post_images/5ae/22f/1f9/5ae22f1f9638aeaaf7d573e3ffea0dc1.png" alt="image"><br><br>  On the BGP Preview tab, a list of all prefixes with or without ROA.  This tab is convenient for checking all prefixes of any AS. <br><img src="https://habrastorage.org/getpro/habr/post_images/eda/e2e/e18/edae2ee181a98aa90d04cdf51d941e3e.png" alt="image"><br><br>  The interface also provides an API for remotely retrieving data. <br><img src="https://habrastorage.org/getpro/habr/post_images/991/400/426/9914004263731a0c297865eb226c9ef5.png" alt="image"><br><br>  Next, configure the Juniper router itself to work with the RPKI cache server. <br><br>  We configure the session with the RPKI cache server to check the prefixes.  In the example, RPKI validator is running on the server <i>192.168.0.10:8282</i> and the router accesses it from the address <i>192.168.0.1</i> : <br><pre> <code class="nginx hljs">{master}[edit] user@router<span class="hljs-comment"><span class="hljs-comment"># show | compare [edit routing-options] + validation { + group RPKI-validator { + session 192.168.0.10 { + refresh-time 120; + hold-time 180; + port 8282; + local-address 192.168.0.1; + } + } + }</span></span></code> </pre><br>  If you use <a href="http://habrahabr.ru/post/186566/">RE protection</a> on your Juniper router, then you also need to add rules allowing traffic from the RPKI cache server: <br><pre> <code class="nginx hljs">{master}[edit] user@router<span class="hljs-comment"><span class="hljs-comment"># show | compare | display omit [edit policy-options] + prefix-list RPKI-servers { + apply-path "routing-options validation group &lt;*&gt; session &lt;*&gt;"; + } + prefix-list RPKI-locals { + apply-path "routing-options validation group &lt;*&gt; session &lt;*&gt; local-address &lt;*&gt;"; + } [edit firewall family inet] + filter accept-rpki { + apply-flags omit; + interface-specific; + term accept-rpki { + from { + source-prefix-list { + RPKI-servers; + } + destination-prefix-list { + RPKI-locals; + } + protocol tcp; + } + then { + count accept-rpki; + accept; + } + } + } [edit interfaces lo0 unit 0 family inet filter] - input-list [ accept-bgp accept-common-services discard-all ]; + input-list [ accept-rpki accept-bgp accept-common-services discard-all ];</span></span></code> </pre><br>  After applying the configuration, the session will be established: <br><pre> <code class="nginx hljs">{master}[edit] user@router<span class="hljs-comment"><span class="hljs-comment"># run show validation session detail Session 192.168.0.10, State: up, Session index: 2 Group: RPKI-validator, Preference: 100 Local IPv4 address: 192.168.0.1, Port: 8282 Refresh time: 120s Hold time: 180s Record Life time: 3600s Serial (Full Update): 16 Serial (Incremental Update): 16 Session flaps: 0 Session uptime: 00:00:16 Last PDU received: 00:00:14 IPv4 prefix count: 7061 IPv6 prefix count: 1109</span></span></code> </pre><br>  RV database of the router will be updated: <br><pre> <code class="nginx hljs">user@router&gt; <span class="hljs-attribute"><span class="hljs-attribute">show</span></span> validation database | <span class="hljs-literal"><span class="hljs-literal">last</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> 2a04:71c0::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">200086</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:81c0::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">48526</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:<span class="hljs-number"><span class="hljs-number">8400</span></span>::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">41887</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:8d40::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">50304</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:8f00::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">49531</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:92c0::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">62240</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:93c0::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">60251</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:9fc0::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">24904</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2a04:a5c0::/<span class="hljs-number"><span class="hljs-number">29</span></span>-<span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">199789</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:f668::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">37519</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:f970::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">37596</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:f9b0::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">37390</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:f9b8:a::/<span class="hljs-number"><span class="hljs-number">48</span></span>-<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">37674</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:f9b8:f::/<span class="hljs-number"><span class="hljs-number">48</span></span>-<span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">16265</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:faf8::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">37403</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:fbf0::/<span class="hljs-number"><span class="hljs-number">28</span></span>-<span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">32653</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:fc00::/<span class="hljs-number"><span class="hljs-number">27</span></span>-<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">3741</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid 2c0f:feb0::/<span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">37100</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.10</span></span> valid IPv4 records: <span class="hljs-number"><span class="hljs-number">7061</span></span> IPv6 records: <span class="hljs-number"><span class="hljs-number">1109</span></span></code> </pre><br>  The established session can also be viewed in the RPKI validator web management interface. <br><img src="https://habrastorage.org/getpro/habr/post_images/543/8bd/7e0/5438bd7e0e049581377be4467586bbdf.png" alt="image"><br><br>  We configure policy-statement for check of prefixes on a router.  To build flexible prefix filters, Juniper recommends creating special BGP communities: <br><ul><li>  origin-validation-state-valid </li><li>  origin-validation-state-invalid </li><li>  origin-validation-state-unknown </li></ul><br>  that allow the router to tag prefixes based on the results of the check.  This mechanism is convenient to use on border routers that parse ebGP prefixes.  For example, such a border router can mark all prefixes with such a community, and then all AS routers connected to it via iBGP, without additional checking through the RPKI cache server, will build their routing tables, trusting this community.  This method allows you to configure the RPKI-RTR session only on some routers and thereby reduce the load on the RPKI cache server.  Also, the policy will set different local-preference for prefixes based on the results of the check.  This will allow the routing table to be built according <a href="http://tools.ietf.org/search/rfc6811">to the IETF recommendations</a> , setting the lowest priority to those prefixes that have not passed the test. <br><br>  Create a policy: <br><pre> <code class="nginx hljs">{master}[edit] user@router<span class="hljs-comment"><span class="hljs-comment"># show | compare [edit policy-options] + policy-statement RPKI-validation { + term valid { + from { + protocol bgp; + validation-database valid; + } + then { + local-preference 110; + validation-state valid; + community add origin-validation-state-valid; + next policy; + } + } + term invalid { + from { + protocol bgp; + validation-database invalid; + } + then { + local-preference 90; + validation-state invalid; + community add origin-validation-state-invalid; + next policy; + } + } + term unknown { + from protocol bgp; + then { + local-preference 100; + validation-state unknown; + community add origin-validation-state-unknown; + next policy; + } + } + } [edit policy-options] + community origin-validation-state-invalid members 0x43:100:2; + community origin-validation-state-unknown members 0x43:100:1; + community origin-validation-state-valid members 0x43:100:0;</span></span></code> </pre><br>  The community configuration uses the AS number equal to 100, it should be replaced with your AS number. <br><br>  View the router routing table: <br><pre> <code class="nginx hljs">{master} user@router&gt; <span class="hljs-attribute"><span class="hljs-attribute">show</span></span> route protocol bgp validation-state valid | <span class="hljs-literal"><span class="hljs-literal">last</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:faf8::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">110</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">30844</span></span> <span class="hljs-number"><span class="hljs-number">37105</span></span> <span class="hljs-number"><span class="hljs-number">37403</span></span> <span class="hljs-number"><span class="hljs-number">37403</span></span> I, validation-state: valid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:fbf0::/<span class="hljs-number"><span class="hljs-number">28</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">110</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">6939</span></span> <span class="hljs-number"><span class="hljs-number">3741</span></span> <span class="hljs-number"><span class="hljs-number">32653</span></span> I, validation-state: valid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:fc00::/<span class="hljs-number"><span class="hljs-number">27</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">110</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">3356</span></span> <span class="hljs-number"><span class="hljs-number">3741</span></span> I, validation-state: valid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:feb0::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>, localpref <span class="hljs-number"><span class="hljs-number">110</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">37100</span></span> ?, validation-state: valid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> {master} user@router&gt; <span class="hljs-attribute"><span class="hljs-attribute">show</span></span> route protocol bgp validation-state invalid | <span class="hljs-literal"><span class="hljs-literal">last</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> 2a03:f85:<span class="hljs-number"><span class="hljs-number">1</span></span>::/<span class="hljs-number"><span class="hljs-number">48</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>, localpref <span class="hljs-number"><span class="hljs-number">90</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">34305</span></span> I, validation-state: invalid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2a03:f86:<span class="hljs-number"><span class="hljs-number">4</span></span>::/<span class="hljs-number"><span class="hljs-number">48</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>, localpref <span class="hljs-number"><span class="hljs-number">90</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">54020</span></span> <span class="hljs-number"><span class="hljs-number">59692</span></span> I, validation-state: invalid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2a03:f87:ffff::/<span class="hljs-number"><span class="hljs-number">48</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>, localpref <span class="hljs-number"><span class="hljs-number">90</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">9002</span></span> <span class="hljs-number"><span class="hljs-number">57169</span></span> I, validation-state: invalid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2a03:bb40::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>, localpref <span class="hljs-number"><span class="hljs-number">90</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> I, validation-state: invalid &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> {master} user@router&gt; <span class="hljs-attribute"><span class="hljs-attribute">show</span></span> route protocol bgp validation-state unknown | <span class="hljs-literal"><span class="hljs-literal">last</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:ff40::/<span class="hljs-number"><span class="hljs-number">26</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">6939</span></span> <span class="hljs-number"><span class="hljs-number">10474</span></span> I, validation-state: unknown &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:ff90::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">6453</span></span> <span class="hljs-number"><span class="hljs-number">15808</span></span> I, validation-state: unknown &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:ffa0::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">9498</span></span> <span class="hljs-number"><span class="hljs-number">37273</span></span> I, validation-state: unknown &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span> 2c0f:ffd8::/<span class="hljs-number"><span class="hljs-number">32</span></span> *[BGP/<span class="hljs-number"><span class="hljs-number">170</span></span>] <span class="hljs-number"><span class="hljs-number">2d</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>, localpref <span class="hljs-number"><span class="hljs-number">100</span></span> AS path: <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">33762</span></span> I, validation-state: unknown &gt; to <span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">978</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:b4::<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> via ae0.<span class="hljs-number"><span class="hljs-number">12</span></span></code> </pre><br>  The results of these commands show that the routing table gives priority to valid routes. <br><br><h4>  Reality </h4><br>  Unfortunately, at the moment many providers are avoiding schemes using RPKI, since only a small part of the prefixes from the world full-view routing table have certificates.  In addition, not all customers have the <s>desire</s> to configure ROA records for their networks.  Providers most often use the proven scheme for automatically updating prefix filters based on whois data, running a script once or twice a day.  Such a scheme implies full trust in the whois database, which in turn is updated by the customers themselves and may differ from different RIRs.  Small regional providers may not care about filters at all, relying on <s>peer</s> filters, and thus be sources of attacks on <a href="http://ru.wikipedia.org/wiki/IP_hijacking">Traffic Attracting</a> .  The situation is also aggravated by the need for additional costs for the installation and maintenance of the RPKI cache server.  Probably, until a significant critical mass is reached, this technology will remain in a ‚Äúpaper‚Äù form, because, in the opinion of many, the costs of implementation do not pay off the result. <br><br><h5>  Links </h5><br><ul><li>  <a href="http://www.ripn.net/articles/certification/">Certification of Addressable Internet Resources</a> </li><li>  <a href="http://www.ripn.net/articles/secure_routing/">Internet routing security</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/211146/">https://habr.com/ru/post/211146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211128/index.html">Oona R√§is√§nen determined the GPS coordinates of the helicopter from YouTube‚Äôs sound</a></li>
<li><a href="../211132/index.html">NASA has launched a new program to develop private landing modules for the moon.</a></li>
<li><a href="../211136/index.html">Setting up a SoftEtherVPN VPN server under Linux</a></li>
<li><a href="../211140/index.html">Creating the game on your eyes - part 2: Shaders for styling images under the CRT / LCD</a></li>
<li><a href="../211144/index.html">UICollectionView or dancing with wolves</a></li>
<li><a href="../211148/index.html">Podcasts Devops Deflope - Issue 005</a></li>
<li><a href="../211150/index.html">MMU in pictures (part 1)</a></li>
<li><a href="../211152/index.html">Mobile energy: a review of interesting Nokia accessories with external batteries</a></li>
<li><a href="../211156/index.html">print or echo, which is faster?</a></li>
<li><a href="../211158/index.html">Google added pictures of 300 cities of Russia to Street View</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>