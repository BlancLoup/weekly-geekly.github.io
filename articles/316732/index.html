<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logux: Connection lost, data synchronized - interview with Andrey Sitnik (Evil Martians)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What happens if the Internet suddenly disappears on the client? Perhaps for a split second, or maybe for a more tangible period? We all as users are f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logux: Connection lost, data synchronized - interview with Andrey Sitnik (Evil Martians)</h1><div class="post__text post__text-html js-mediator-article">  What happens if the Internet suddenly disappears on the client?  Perhaps for a split second, or maybe for a more tangible period?  We all as users are faced with an unstable signal, a floating quality of communication.  Sometimes it doesn't matter, because you want to watch some funny video, sometimes a lot can depend on it - imagine that you urgently need to buy a train ticket or pay for the same Internet. <br><br>  Those areas where the end user is very important - for example, the media, say that already 13% of users leave if your site opens for more than four seconds without understanding the reasons.  And now let's imagine such a user who is still trying to send a comment, and he constantly ‚Äúfalls off‚Äù due to communication problems? <br><br>  The percentage of withdrawals and failures will certainly be more.  How to avoid it?  What can be done in a situation where the data must be guaranteed to be sent both from the client and from the server? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/bf3/a94/cf7/bf3a94cf715e478d8d3393abcb405283.jpg" align="left" width="250">  This and other questions are answered by <b>Andrey Sitnik</b> - the author of PostCSS and Autoprefixer, leading the fender in ‚ÄúEvil Martians‚Äù. <br><br><br><br><br><br><br><br><br><br>  <b>‚ÄúWhy do we even talk about communication problems?‚Äù</b>  <b>Is this not a question solely related to physical / network capabilities?</b> <br><br>  - OSI is not quite the topic here.  Logux replaces REST and AJAX.  That is, it is a purely applied level.  Logux solves the following problems: <br><a name="habracut"></a><br><ol><li>  Now it takes a lot of code for simple queries. </li><li>  Live update data from the server to write an order of magnitude more difficult. </li><li>  Good offline support is generally a hell of a write.  But offline is always needed, since we always have ‚Äú500 ms offline‚Äù - these are constant buttons on buttons. </li></ol><br>  To do this, Logux creates a special virtual event channel between the client and the server. <br><br>  The client can put events on this channel - Logux will send them when it is available.  And the same on the server.  Let's sort it out at the technical level step by step: <br><br><h2>  Debriefing </h2><br>  <b>1.</b> On the client, this will be a one-to-one library with APIs like Redux (the React is not tied, there is a lower-level API).  You create action in the same way.  But for some actions you can set the key sync: true - then Logux will deliver them to the server itself.  This library holds a web socket, sends a ping, checking that there is a connection. <br><br>  <b>- So, why is it good that this library is not tied to React?</b> <br><br>  Not everyone develops on React (and this is very good for a variety of environments).  Someone might use Vue.js, Angular.  Or just have a JS application where there is no HTML, so the React will not be needed so much.  Go ahead: <br><br>  <b>2.</b> Additional library, which, when communication is lost, will show specials.  ‚ÄúNo Link‚Äù badge at the top of the page and will change the favicon.  If there are events in the channel for sending, but there is no connection, she will also tell the user that not all the data has been saved. <br><br>  <b>- Why does the user need to know this?</b>  <b>For which interaction format can this be critically important?</b> <br><br>  - If the user gave us some data, we must notify him that they have not been saved.  I would say that this behavior should be the default.  The library is optional in many ways in order to write such a notification yourself and better integrate it into the design.  Although there are cases where you can skip connection problems - for example, if Logux is used to collect user actions for analytics. <br><br>  Next step. <br><br>  <b>3.</b> When the connection appears, the Logux client and the server will send each other the events that were added during the absence of the connection. <br><br>  <b>- It is clear, it is logical, how many actions can be in the queue?</b> <br><br>  - Usually 10-20 events.  But we have no hard limits - how much will fit in the memory of the client and server. <br><br>  <b>- The order of performance of these events?</b> <br><br>  - The order of events is controlled very strictly.  The problem is not only in the order of events of one user.  But even when several users are working, the order of all their events must be the same on all systems (so that the final state is the same).  Therefore, in Logux, each event is assigned a creation time.  It is quite tricky - for example, the difference in time between the client and the server is taken into account. <br><br>  <b>- Could it be that some events no longer have to be performed?</b>  <b>Mutual verification of action dependencies?</b> <br><br>  - The client can clean the log from already unnecessary events.  This is already determined by business logic. <br><br>  Next step: the user can close the browser - unsent events will be saved in localStorage.  But before attempting to close, the library will ask the user to first go online, as there is unsent data. <br><br>  <b>- Again we return to the issue of capacity and importance, and what happens if the user forcibly closes the browser?</b> <br><br>  - Nothing wrong.  As soon as the user returns to the site, the data will be sent. <br><br>  Now all the remaining steps: <br><br>  <b>5.</b> To write a Logux server, there is a special server framework.  That is, it is like express.js.  You yourself describe how the server responds to a particular event from a client.  At the same time, the logic is a bit more cunning - the fact that the event has come now does not mean that it was created now.  Therefore, each event has a creation time.  When connecting, the client and server determine the time difference and synchronize the clock (and the time of creating old events). <br><br>  <b>6.</b> Server framework for now on node.js.  Then we will do for Elixir and Go.  But you can use Ruby, Python, and PHP ‚Äî just put the node.js server as a proxy to hold the socket.  And already this proxy server will send the old REST request to the ruby ‚Äã‚Äãserver. <br><br>  <b>7.</b> Since we have this event log and exact time, you can make CRDT on top of it like in Swarm.js - and automatically resolve conflicts in many simple cases. <br><br>  <b>8.</b> In general, in most cases you can not draw a twister - the client can immediately draw as if the event has already run (for example, a comment has been sent), Logux will show the user that the data has not been saved to the server.  Of course, there will be cases where this does not work out - for example, payment.  There you can do the old logic with a twist. <br><br><h2>  Logux and alternatives </h2><br>  <b>- Thanks, and how is Logux better then the existing solutions?</b> <br><br>  - There is Relay / GraphQL - they reduce the amount of code when requesting data.  But changing the data itself is also not very easy to implement.  Live update is bad.  Offline is also not worked out. <br><br>  There are isomorphic databases - they work on the client and on the server and synchronize the data between themselves.  For example, CouchDB and Firebase.  It is well resolved live update data.  Ready CRDT is now a few who have, but, in general, it can be implemented.  But they are quite difficult to expand, many developers are afraid of such a strange approach to synchronization, so these databases did not become an industry standard. <br><br>  There are also CRDT libraries - for example, Swarm.js.  Logux copies many ideas from Swarm.js.  But Swarm.js is difficult to make friends with React and Redax.  It is also difficult to transfer non-CRDT operations in it. <br><br>  <b>- What are the strengths and weaknesses?</b> <br><br>  - Less code, live data update out of the box, easy to make an application to work offline.  And all this with the familiar semantics of Redax. <br><br>  The main weak point - you need to run an additional server.  But all such decisions have it.  Plus, you can make this server a proxy server and keep all the logic stored in PHP or Ruby on Rails. <br><br>  <b>- Where did the need for this dedicated solution come from?</b> <br><br>  - On the Amplifer it was necessary to show live statistics of publications and update the page with errors immediately when a problem appeared.  And we realized that there was no good solution.  We tried to implement Swarm.js, but it wasn‚Äôt easy to deploy.  So I started thinking how to make friends with Swarm.js and Redax.  In St. Petersburg, at that time, Dan Abramov was just, and the idea of ‚Äã‚Äãa separate library was born in a conversation with him. <br><br>  <b>- Does it have a chance to become an industry standard?</b> <br><br>  - I try to make Logux as a universal solution for all web applications.  But, it seems to me, in 2017 we will see many more attempts to redo AJAX / REST - now this is the main problem of web development, in my opinion.  Who will win this fight, we learn only in 2018. <br><br><h2>  Life examples </h2><br>  <b>- Are there 1-2 interesting practical case?</b> <br><br>  - Yes, even TODO MVC - you also want to continue working with the task list even if there is no connection.  Or if you added a task to a computer, then you want it to appear right there on your phone, without reloading the pages. <br><br>  Or comments - a live update, like on Facebook or VK, useful for engaging people. <br><br>  There is one more advantage of Logux for any site - it is an ‚Äúoptimistic interface‚Äù ( <a href="https://habrahabr.ru/company/jugru/blog/315806/"><b>another HolyJS speaker was</b></a> just <a href="https://habrahabr.ru/company/jugru/blog/315806/"><b>talking</b></a> about it).  Now, with every action we show the user a "twister".  Each save locks the interface and disrupts the user's flow.  With Logux, it is an order of magnitude easier to make an optimistic interface, where saving will occur in the background, distracting the user only if an error has indeed occurred.  For example, this is how Google Inbox works.  Any web application will benefit from an optimistic interface, as users always love fast interfaces. <br><br>  <b>- Thank you very much for the interview, and see you at the conference.</b> <br><br><hr><br>  Of course, in an interview I managed to discuss only a general view of the library and its philosophy, Andrei will give a <a href="http://holyjs.ru/talks/logux-new-way-to-connect-client-and-server/">presentation</a> on <a href="http://holyjs.ru/">HolyJS</a> with a detailed hourly <a href="http://holyjs.ru/talks/logux-new-way-to-connect-client-and-server/">report</a> on the development and work with Logux.  In addition, you can immediately see the reports on other discussed technologies: <br><ul><li>  <a href="http://holyjs.ru/talks/a-circular-firing-squad-how-technologies-drag-frontend-down/">Swan cancer and pike: how technology pulls the frontend to the bottom</a> </li><li>  <a href="http://holyjs.ru/talks/a-little-closer-to-frontend-bliss-with-elm/">A Little Closer to Frontend Bliss with Elm</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/316732/">https://habr.com/ru/post/316732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316722/index.html">35 resources that will be interesting to the creators of startups</a></li>
<li><a href="../316724/index.html">Personal experience: the organization of Workflow in the TFS tracker</a></li>
<li><a href="../316726/index.html">How to put things in order if you run out of power</a></li>
<li><a href="../316728/index.html">Review ACS with free software</a></li>
<li><a href="../316730/index.html">Screaming</a></li>
<li><a href="../316734/index.html">Personal experience of implementing the GLPI system. Part 2</a></li>
<li><a href="../316736/index.html">The Tale of Cleopatra and Russian Cryptography (Continued)</a></li>
<li><a href="../316738/index.html">Advent of Code 2016</a></li>
<li><a href="../316740/index.html">Efficient storage: as we did from 50 Pb, 32 Pb</a></li>
<li><a href="../316742/index.html">How to create a trading robot using genetic programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>