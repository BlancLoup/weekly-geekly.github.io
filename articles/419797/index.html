<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The reverse engineering of the protocol of the panel from the invertor Electrolux conditioner</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will describe my experience and the main stages of studying the IR remote from the air conditioner. From the tool you will need Ardu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The reverse engineering of the protocol of the panel from the invertor Electrolux conditioner</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8e0/62f/a4f/8e062fa4ff125f4988a387bb5a8c36a6.jpg"><br><br>  In this article I will describe my experience and the main stages of studying the IR remote from the air conditioner.  From the tool you will need Arduino nano on mega328 and a receiver of IR signals (I have VS1838B). <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">A little background</b> <div class="spoiler_text">  I decided to turn on my Electrolux air conditioner in the smart home system.  Three options are possible for this: the use of a broadlink infrared transmitter, the use of a self-made infrared transmitter and the integration of a self-made circuit into the air conditioner itself.  As the safest, for the experimental air conditioner, and the cheapest, the choice fell on a homemade IR module. <br><br>  The first step is to disassemble the IR protocol.  An Internet search gave only 1 result and that does not fit, since the air conditioner of another company: <a href="https://habr.com/post/189142/">link</a> .  I took an oscilloscope, looked at what was happening.  It turned out that the protocol is similar to NEC, but the package is so long that it does not fit into the buffer of my USB oscilloscope.  It does not matter, I took Arduinka, I found the universal library IRremote and ... I understood that it does not understand commands longer than 32 bits, and I have at least 3 parts in a row 6 bytes (48 bits). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I could not correct the library, it is too complicated for me.  Having suffered a little, I wrote a code that reads the time intervals between signal changes.  In Arduino, I am not strong, so the code is probably crooked and is guaranteed to work on arduins with the ATMega328 and a frequency of 16 MHz.  Actually, I could write a more beautiful code in CVAVR, but then not everyone can repeat my experience, because a programmer is needed and I decided to do it all with arduino.  I'll start with the features of my model.  Some air conditioners in my line have the ‚ÄúI feel‚Äù function, which is designed to ensure that the desired temperature is reached in that part of the room?  where I am (actually the remote).  The documentation states that there is no such function in my model, but it turned out that it exists.  It turned out to be quite an unpleasant way, the batteries in the console sat down and the remote began to raise the temperature by 4 degrees, i.e.  instead of 28, show 32. I put 28 degrees and the condo cools down to 26. Well, I decided, and set 32 ‚Äã‚Äãdegrees for cooling (this is the upper limit), but the air conditioner persistently continued to cool the room.  I decided that something had broken, or the contact at the thermal sensor had oxidized and disassembled the air conditioner in search of a breakdown.  Having found nothing, just in case, he decided to change the batteries and, lo and behold, the air conditioner began to work adequately.  So how does this work?  The console, along with all the settings, sends the temperature to the air conditioner that it measured and it corrects the readings of the internal thermal sensor, depending on what it sent to the console. <br></div></div><br>  To begin with, I wrote a code that reads the duration of the signal from the IR receiver in the low and high states, writes them to the array, and then outputs them to the computer port. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="hljs pgsql">// IR    D2 unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> timerValue; //   unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> data_m[<span class="hljs-number"><span class="hljs-number">350</span></span>]; unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> n=<span class="hljs-number"><span class="hljs-number">0</span></span>; byte <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">115200</span></span>); //   ,  <span class="hljs-number"><span class="hljs-number">115200</span></span> //   <span class="hljs-number"><span class="hljs-number">1</span></span> TCCR1A = <span class="hljs-number"><span class="hljs-number">0</span></span>; TCCR1B = <span class="hljs-number"><span class="hljs-number">0</span></span>; attachInterrupt(<span class="hljs-number"><span class="hljs-number">0</span></span>, inter_1, CHANGE); //  <span class="hljs-number"><span class="hljs-number">0</span></span>-    inter_1 TCCR1B = <span class="hljs-number"><span class="hljs-number">2</span></span>; //    <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Start"); pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>=TIFR1&amp;<span class="hljs-number"><span class="hljs-number">0x01</span></span>; //     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { TIFR1=<span class="hljs-number"><span class="hljs-number">0x01</span></span>; //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i!=<span class="hljs-number"><span class="hljs-number">0</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (n&lt;=i) //    { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(n,<span class="hljs-type"><span class="hljs-type">DEC</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("="); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(data_m[n],<span class="hljs-type"><span class="hljs-type">DEC</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("\t"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n&amp;B00000011)==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(" ");} n++; } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("End"); } i=<span class="hljs-number"><span class="hljs-number">0</span></span>; //       n=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-type"><span class="hljs-type">void</span></span> inter_1() { timerValue = (unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>)TCNT1L&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> | ((unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>)TCNT1H &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>); //   data_m[i]=timerValue; i++; TCNT1H = <span class="hljs-number"><span class="hljs-number">0</span></span>; //   TCNT1L = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br>  After pressing the button of the air conditioner remote control, the following data came to the port: <br><br><div class="spoiler">  <b class="spoiler_title">The result of receiving the parcel</b> <div class="spoiler_text"> <code>Start <br> 0=20543 <br> 1=9038 2=4541 3=548 4=1675 <br> 5=548 6=1681 7=545 8=560 <br> 9=543 10=614 11=494 12=569 <br> 13=543 14=620 15=493 16=624 <br> 17=494 18=1688 19=544 20=603 <br> 21=494 22=1655 23=571 24=1685 <br> 25=545 26=613 27=495 28=568 <br> 29=543 30=622 31=493 32=625 <br> 33=495 34=613 35=494 36=604 <br> 37=494 38=607 39=493 40=561 <br> 41=545 42=612 43=495 44=620 <br> 45=491 46=622 47=494 48=624 <br> 49=494 50=565 51=543 52=602 <br> 53=494 54=1679 55=547 56=609 <br> 57=494 58=614 59=493 60=619 <br> 61=492 62=1693 63=546 64=1698 <br> 65=547 66=1685 67=548 68=603 <br> 69=494 70=608 71=493 72=609 <br> 73=495 74=615 75=493 76=571 <br> 77=540 78=620 79=494 80=626 <br> 81=493 82=565 83=545 84=605 <br> 85=492 86=607 87=493 88=613 <br> 89=492 90=596 91=512 92=619 <br> 93=492 94=622 95=493 96=624 <br> 97=494 98=594 99=521 100=7988 <br> 101=550 102=1674 103=546 104=608 <br> 105=492 106=1685 107=543 108=611 <br> 109=495 110=1689 111=547 112=620 <br> 113=495 114=625 115=491 116=1689 <br> 117=543 118=605 119=493 120=1654 <br> 121=572 122=611 123=494 124=614 <br> 125=493 126=1692 127=545 128=621 <br> 129=492 130=622 131=496 132=613 <br> 133=492 134=604 135=494 136=605 <br> 137=496 138=556 139=548 140=614 <br> 141=493 142=618 143=494 144=620 <br> 145=494 146=624 147=494 148=615 <br> 149=493 150=606 151=493 152=608 <br> 153=493 154=609 155=496 156=614 <br> 157=494 158=566 159=545 160=623 <br> 161=493 162=625 163=493 164=564 <br> 165=543 166=603 167=494 168=606 <br> 169=495 170=609 171=496 172=613 <br> 173=494 174=617 175=495 176=620 <br> 177=494 178=624 179=496 180=613 <br> 181=494 182=604 183=493 184=606 <br> 185=494 186=562 187=541 188=613 <br> 189=495 190=618 191=493 192=622 <br> 193=493 194=623 195=494 196=1663 <br> 197=569 198=603 199=494 200=1678 <br> 201=547 202=1686 203=543 204=1663 <br> 205=570 206=1692 207=545 208=619 <br> 209=494 210=624 211=495 212=614 <br> 213=494 214=1653 215=569 216=1657 <br> 217=571 218=611 219=493 220=1664 <br> 221=571 222=1691 223=544 224=1671 <br> 225=571 226=1699 227=547 228=1671 <br> 229=572 230=7995 231=551 232=603 <br> 233=493 234=606 235=493 236=612 <br> 237=493 238=608 239=497 240=618 <br> 241=494 242=621 243=492 244=626 <br> 245=493 246=584 247=524 248=556 <br> 249=541 250=1680 251=545 252=610 <br> 253=494 254=613 255=495 256=588 <br> 257=523 258=620 259=494 260=625 <br> 261=494 262=615 263=493 264=604 <br> 265=495 266=607 267=495 268=612 <br> 269=493 270=616 271=493 272=570 <br> 273=542 274=621 275=495 276=625 <br> 277=493 278=612 279=496 280=606 <br> 281=493 282=607 283=496 284=610 <br> 285=494 286=614 287=495 288=618 <br> 289=493 290=595 291=519 292=575 <br> 293=543 294=616 295=494 296=605 <br> 297=495 298=606 299=495 300=613 <br> 301=493 302=613 303=494 304=616 <br> 305=495 306=569 307=546 308=625 <br> 309=493 310=564 311=545 312=602 <br> 313=496 314=607 315=495 316=611 <br> 317=494 318=613 319=496 320=571 <br> 321=541 322=621 323=494 324=624 <br> 325=495 326=568 327=539 328=604 <br> 329=493 330=1679 331=547 332=610 <br> 333=495 334=614 335=493 336=618 <br> 337=495 338=572 339=543 340=623 <br> 341=496 342=596 343=484 344=0</code> <br>  End </div></div><br>  We can notice that all odd numbers are the same (except for the starting pulse) and can be ignored.  Further, the interrupt code had a rather if condition (digitalRead (2) == 0) which discards the duration of the low state at the controller input. <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inter_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ timerValue = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)TCNT1L&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> | ((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)TCNT1H &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   if (digitalRead(2)==0) { data_m[i]=timerValue; i++; } TCNT1H = 0; //   TCNT1L = 0; }</span></span></code> </pre> <br>  In general, the program works as follows: a timer-counter is started with a division factor of 8 (this is one of the standard dividers provided by the MC), and when the state of input D2 changes, an interrupt is performed - the function void inter_1 ().  In this interrupt, the value of the timer-counter is read and divided by 2, after which it is written to the array, and the timer itself is reset.  The timer counter operates with a frequency of 8 times less than the clock frequency of the MK (16 MHz) i.e.  2 MHz and to get the time in microseconds, the number read from the counter must be divided by 2. In the main body of the program, the timer overflow flag is checked and if the timer counter is full, i.e.  counted up to 65535, the counter of the accepted intervals is checked.  If it is not 0, all received data is output and the byte count is reset.  New data looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">The result of receiving the command</b> <div class="spoiler_text"> <code>Start <br> 0=26938 <br> 1=4539 2=1675 3=1654 4=610 <br> 5=563 6=569 7=567 8=621 <br> 9=1687 10=602 11=1679 12=1658 <br> 13=613 14=615 15=619 16=576 <br> 17=561 18=602 19=591 20=607 <br> 21=611 22=615 23=620 24=622 <br> 25=611 26=602 27=1678 28=609 <br> 29=612 30=615 31=1693 32=1695 <br> 33=1659 34=601 35=605 36=610 <br> 37=611 38=566 39=564 40=622 <br> 41=611 42=601 43=604 44=608 <br> 45=614 46=615 47=618 48=620 <br> 49=594 50=7970 51=1676 52=604 <br> 53=1681 54=613 55=1688 56=620 <br> 57=623 58=1685 59=602 60=1680 <br> 61=1680 62=612 63=1687 64=619 <br> 65=624 66=611 67=602 68=604 <br> 69=607 70=558 71=616 72=619 <br> 73=624 74=560 75=603 76=605 <br> 77=562 78=611 79=615 80=566 <br> 81=622 82=612 83=601 84=603 <br> 85=606 86=611 87=564 88=618 <br> 89=572 90=612 91=601 92=604 <br> 93=608 94=611 95=569 96=621 <br> 97=622 98=1686 99=552 100=1678 <br> 101=1681 102=1660 103=1689 104=618 <br> 105=622 106=610 107=1675 108=1677 <br> 109=1681 110=1681 111=1691 112=1688 <br> 113=1696 114=1668 115=7966 116=599 <br> 117=603 118=562 119=558 120=612 <br> 121=617 122=621 123=565 124=601 <br> 125=1679 126=607 127=612 128=616 <br> 129=565 130=622 131=613 132=602 <br> 133=604 134=608 135=612 136=615 <br> 137=618 138=617 139=611 140=598 <br> 141=553 142=607 143=612 144=615 <br> 145=617 146=568 147=565 148=600 <br> 149=604 150=606 151=559 152=613 <br> 153=617 154=622 155=609 156=549 <br> 157=605 158=609 159=611 160=613 <br> 161=618 162=621 163=609 164=602 <br> 165=1679 166=609 167=612 168=615 <br> 169=618 170=622 171=595 172=0 <br> End</code> <br> </div></div><br>  From the data obtained it is clear that the first number is random ‚Äî this is the time from the last overflow of the timer, before the start of the sending.  Further, the starting pulse is 4.5 ms and data.  Data is transmitted bit by bit, where an interval of approximately 1690 Œºs corresponds to a logical one, and an interval of 560 Œºs corresponds to a logical zero.  It is also seen that the parcels are divided into 3 separate parts, where 50 = 7970 and 115 = 7966 are the starting sequences. <br><br>  Add in the code the function of forming bytes and a small decoding of the received data.  I wrote the last line right at the very end, but not producing the same almost code. <br><br><div class="spoiler">  <b class="spoiler_title">Arduino code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">// IR    D2 unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> timerValue; //   unsigned <span class="hljs-type"><span class="hljs-type">int</span></span> data_m[<span class="hljs-number"><span class="hljs-number">250</span></span>]; byte i=<span class="hljs-number"><span class="hljs-number">0</span></span>; byte n=<span class="hljs-number"><span class="hljs-number">0</span></span>; byte <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>; byte k=<span class="hljs-number"><span class="hljs-number">0</span></span>; byte x,y; byte m1=<span class="hljs-number"><span class="hljs-number">0</span></span>; byte dat[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">12</span></span>]; byte temp2=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">char</span></span> s[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">115200</span></span>); //   ,  <span class="hljs-number"><span class="hljs-number">9600</span></span> //   <span class="hljs-number"><span class="hljs-number">1</span></span> TCCR1A = <span class="hljs-number"><span class="hljs-number">0</span></span>; attachInterrupt(<span class="hljs-number"><span class="hljs-number">0</span></span>, inter_1, CHANGE); //  <span class="hljs-number"><span class="hljs-number">0</span></span>-    inter_1 TCCR1B = <span class="hljs-number"><span class="hljs-number">2</span></span>; //      <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Start"); pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>=TIFR1&amp;<span class="hljs-number"><span class="hljs-number">0x01</span></span>; //     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { TIFR1=<span class="hljs-number"><span class="hljs-number">0x01</span></span>; //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) //           FF     {dat[y][x]=<span class="hljs-number"><span class="hljs-number">0xFF</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {dat[y][x+<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-number"><span class="hljs-number">0xFF</span></span>; dat[y][x]=m1; } <span class="hljs-comment"><span class="hljs-comment">/* while (n&lt;=i) //    { Serial.print(n,DEC); Serial.print("="); Serial.print(data_m[n],DEC); Serial.print("\t"); if ((n&amp;B00000011)==0) { Serial.println(" ");} n++; }*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i1 &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i1++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; j++) { sprintf(s, "%02X ", dat[i1][j]); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(s); //dat[i1][j]=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(""); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x0F</span></span>)==<span class="hljs-number"><span class="hljs-number">0x2</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Cool "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x0F</span></span>)==<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Heat "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x0F</span></span>)==<span class="hljs-number"><span class="hljs-number">0x3</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Dry "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x0F</span></span>)==<span class="hljs-number"><span class="hljs-number">0x04</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Vent "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x03</span></span>)==<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Vent=Auto "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x03</span></span>)==<span class="hljs-number"><span class="hljs-number">0x1</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Vent=Max "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x03</span></span>)==<span class="hljs-number"><span class="hljs-number">0x2</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Vent=Mid "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x03</span></span>)==<span class="hljs-number"><span class="hljs-number">0x3</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Vent=Min "); <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>=((dat[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0xF0</span></span>)&gt;&gt;<span class="hljs-number"><span class="hljs-number">4</span></span>)+<span class="hljs-number"><span class="hljs-number">18</span></span>; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("T="); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>,<span class="hljs-type"><span class="hljs-type">DEC</span></span>); sprintf(s, " Time=%02d:%02d ",(dat[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x7F</span></span>),(dat[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]&amp;<span class="hljs-number"><span class="hljs-number">0x7F</span></span>)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(s); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" C="); <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>=(dat[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">6</span></span>]); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>,<span class="hljs-type"><span class="hljs-type">DEC</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("End"); //   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; i1 &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i1++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">9</span></span>; j++) {dat[i1][j]=<span class="hljs-number"><span class="hljs-number">0</span></span>;} } } i=<span class="hljs-number"><span class="hljs-number">0</span></span>; //       n=<span class="hljs-number"><span class="hljs-number">0</span></span>; k=<span class="hljs-number"><span class="hljs-number">0</span></span>; m1=<span class="hljs-number"><span class="hljs-number">0</span></span>; x=<span class="hljs-number"><span class="hljs-number">0</span></span>; y=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-type"><span class="hljs-type">void</span></span> inter_1() { timerValue = (unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>)TCNT1L&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> | ((unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>)TCNT1H &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>); //       <span class="hljs-number"><span class="hljs-number">2</span></span>, ..  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>      <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(<span class="hljs-number"><span class="hljs-number">2</span></span>)==<span class="hljs-number"><span class="hljs-number">0</span></span>) { data_m[i]=timerValue; i++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((timerValue&gt;<span class="hljs-number"><span class="hljs-number">4400</span></span>)&amp;&amp;(timerValue&lt;<span class="hljs-number"><span class="hljs-number">4700</span></span>)) {m1=<span class="hljs-number"><span class="hljs-number">0</span></span>; k=<span class="hljs-number"><span class="hljs-number">0</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((timerValue&gt;<span class="hljs-number"><span class="hljs-number">7500</span></span>)&amp;&amp;(timerValue&lt;<span class="hljs-number"><span class="hljs-number">8500</span></span>)) {<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k==<span class="hljs-number"><span class="hljs-number">0</span></span>) //           FF     {dat[y][x]=<span class="hljs-number"><span class="hljs-number">0xFF</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {dat[y][x+<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-number"><span class="hljs-number">0xFF</span></span>; dat[y][x]=m1; } x=<span class="hljs-number"><span class="hljs-number">0</span></span>; y++; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((timerValue&gt;<span class="hljs-number"><span class="hljs-number">1500</span></span>)&amp;&amp;(timerValue&lt;<span class="hljs-number"><span class="hljs-number">1800</span></span>)) {m1=(m1&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>)+<span class="hljs-number"><span class="hljs-number">0x80</span></span>; k++;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((timerValue&gt;<span class="hljs-number"><span class="hljs-number">450</span></span>)&amp;&amp;(timerValue&lt;<span class="hljs-number"><span class="hljs-number">800</span></span>)) {m1=m1&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>; k++;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k&gt;=<span class="hljs-number"><span class="hljs-number">8</span></span>) {k=<span class="hljs-number"><span class="hljs-number">0</span></span>; dat[y][x]=m1; x++; m1=<span class="hljs-number"><span class="hljs-number">0</span></span>; } } TCNT1H = <span class="hljs-number"><span class="hljs-number">0</span></span>; //   TCNT1L = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br>  It is worth noting that the size of the arrays fit my console, to explore the new console, they should be expanded so that everything fits.  It is also worth checking the number of bits in the parcels, for example, I have 50-2 = 48 first parcel, 115-51 = 64 and 172-116 = 56 (I subtract numbers from the last insignificant bit, the first significant one).  Total we get 6 bytes 8 bytes and 7 bytes.  Since all 3 parcels are of different lengths, I decided to designate the end of the parcel with FF values, since such data are almost not found in the tested console. <br><br>  As I already mentioned, my air conditioner has the ‚ÄúI feel‚Äù function. It works as follows: the console every 9 minutes, along with all the settings, sends the temperature to the conditioner that it measured and that, if it is within the range of the console, corrects the readings of the internal thermal sensor, depending on what it sent. remote controller. <br><br>  By the way <br><br><div class="spoiler">  <b class="spoiler_title">commands sent automatically</b> <div class="spoiler_text"> <code>Start <br> 83 06 00 82 00 00 FF 00 00 <br> 16 30 00 00 00 80 1D 39 FF <br> 00 00 00 00 00 00 00 FF 00 <br> Cool Vent=Auto T=26 Time=22:48 C=29 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 16 31 00 00 00 80 1D 38 FF <br> 00 00 00 00 00 00 00 FF 00 <br> Cool Vent=Auto T=26 Time=22:49 C=29 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 16 3A 00 00 00 80 1D 33 FF <br> 00 00 00 00 00 00 00 FF 00 <br> Cool Vent=Auto T=26 Time=22:58 C=29 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 17 07 00 00 00 80 1D 0F FF <br> 00 00 00 00 00 00 00 FF 00 <br> Cool Vent=Auto T=26 Time=23:07 C=29 <br> End</code> <br> </div></div><br>  Then everything is the simplest and most interesting - tykakh on buttons, we get the result and try to guess what, what is responsible for.  It turned out that the bits in my air conditioner are transmitted starting from the youngest.  I managed to decrypt most of the protocol. <br><br><h4>  Description of the protocol remote control Electrolux </h4><br>  <b>0.1 bytes</b> 0x83 0x06 Apparently the address <br>  <b>2 bytes</b> 0b00000000 Mode of operation <br>  7 bit = 1 if the ‚Äúswing‚Äù button is pressed <br>  6 5 4 bits in the dehumidification mode are responsible for the ‚Äúpower‚Äù 110 = -7 ...- 2, 101 = -1, 000 = 0, 001 = 1, 010 = 2..7 <br>  3 bits = 1 in the sleep mode (at the same time the fan is set to minimum) <br>  2 bits are set if the power button is pressed <br>  The 1 and 0 bits correspond to the fan mode - 00 automatic, 10 maximum speed, 01 average speed, 11 low speed. <br>  <b>3 bytes</b> 0b11000010 Mode of operation and temperature.  In this example, cooling to 30 degrees <br>  The older 4 bits contain the specified temperature using the formula 18 + the number written here, for example 0b1100 = 12 we add 18 we get 30 <br>  The lower 4 bits are responsible for the 0010 operation mode cooling, 0000 heating, 0011 dehumidification, 0001 ‚Äúsmart‚Äù mode <br>  <b>4 bytes</b> 0b00000000 unknown byte <br>  <b>5 bytes</b> 0b10010000 Super cooling mode <br>  In the super cooling mode, the fan is at a maximum, the temperature is +18, and additionally the higher 4 bits 1001 in the remaining modes there are zeros. <br>  The first 6 bytes are completed, followed by a starting sequence of 8ms in high state + 0.5ms in low state and the second part of the packet is 8 bytes. <br>  <b>0 bytes</b> 0b10000110 The current time (hours), in this example, 6 hours. <br>  7 bit is always set. <br>  5 bits = 1 turn off the display on the indoor unit. <br>  <b>1 byte</b> 0b00000010 current time (minutes) in this example 02 minutes <br>  7 bit is set when the off timer is enabled. <br>  <b>2 bytes</b> 0b00010111 Auto-off time (hours), it's 23 hours. <br>  <b>3 bytes</b> 0b10111010 Auto power off time (minutes) here 58 <br>  7 bit is set when the auto-on timer is on. <br>  <b>4 bytes</b> 0b00001100 Auto-on time (clock) here 12 hours <br>  <b>5 bytes</b> 0b10000010 Auto power on time (minutes) here 2 minutes <br>  7 bits always set <br>  <b>6 bytes</b> 0b00011111 The current temperature measured by the remote control, here 31. <br>  <b>7 bytes</b> CRC.  <s>The CRC algorithm is not found by me.</s>  <s>(I will be grateful if someone tells).</s>  <s>I tried all the proposed algorithms in the online calculators (10 pieces), but did not find the right one.</s>  <s>Obviously, when calculating the CRC, the first and second lines are considered.</s>  <s>when changing any byte in the first or second line, the CRC changes.</s> <br>  Member <a href="https://habr.com/users/huhen/">huhen</a> guessed the CRC calculation method: This is a XOR operation on all the bytes of the first and second package except the address.  For example: 83 06 60 ^ 73 ^ 00 ^ 00 ^ 00 ^ 00 ^ 96 ^ 04 ^ 00 ^ 00 ^ 00 ^ 80 ^ 1E = 1F <br>  The last part of the package is 7 bytes. <br>  <b>0 bytes</b> <br>  5 bit SOFT mode <br>  4 bit switch pressed <br>  3 bits set when mute mode is on (ear icon is lit on the display) <br>  <b>1 byte</b> <br>  0x00 = automatic sending, dimmer button and time setting clock button <br>  0x01 = power button pressed <br>  0x02 = button pressed to change the set temperature (power) + or - 0x03 = button pressed sleep <br>  0x04 = Super Cool button pressed <br>  0x05 = Timer ON auto on / off timer <br>  0x06 = button pressed <br>  0x07 = swing button pressed (swing flap) <br>  0x0B mute button pressed <br>  0x0C button pressed SOFT (power saving) <br>  0x0D button I feel pressed <br>  0x0F switch pressed (turn off the display of the indoor unit) <br>  0x11 fan mode button pressed <br>  0x17 = smart button pressed (automatic operation) <br>  0x1D on or off the auto off timer Timer OFF <br><br>  <b>2 bytes</b> in dehumidification mode and smart (automatic) are responsible for "power" along with 2 bytes of the first parcel <br>  0x14 = + -7 <br>  0x10 = + -6 <br>  0x0C = + -5 <br>  0x08 = + -4 <br>  0x02 = + -3 <br>  0x00 = 0, + -1, + -2 <br>  <b>6 bytes</b> Checksum 0-5 bytes (third line). <br>  In the dehumidification or smart mode, the air conditioner does not have a temperature, you can only select a number from -7 to +7.  Probably they are responsible for power.  And this power is transmitted in the second byte of the first parcel and the second byte of the third parcel. <br><br>  I also have an xiaomi IR transmitter.  It was tuned to the air conditioner by a brute force method and sends the first parcel with a length of 6 bytes to the air conditioner.  An air conditioner on such a shortened parcel responds and performs it properly.  But I don‚Äôt really like this version of control because it doesn‚Äôt allow the air conditioner to transmit the current temperature, thereby correcting its operation. <br><br>  Then I just clicked on the buttons.  In the signature on the data T = set temperature <br>  C = current temperature measured by the remote control.  Vent = fan mode. <br><br><div class="spoiler">  <b class="spoiler_title">Data</b> <div class="spoiler_text"> <code>83 06 60 73 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 1F FF <br> 00 02 08 00 00 00 0A FF 00 <br> Dry Vent=Auto T=25 Time=22:04 C=30 <br> End <br> 83 06 01 74 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 79 FF <br> 00 06 00 00 00 00 06 FF 00 <br> Vent Vent=Max T=25 Time=22:04 C=30 <br> End <br> 83 06 00 50 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 5C FF <br> 00 06 00 00 00 00 06 FF 00 <br> Heat Vent=Auto T=23 Time=22:04 C=30 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 8E FF <br> 00 06 00 00 00 00 06 FF 00 <br> Cool Vent=Auto T=26 Time=22:04 C=30 <br> End <br> 83 06 00 73 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 7F FF <br> 00 06 00 00 00 00 06 FF 00 <br> Dry Vent=Auto T=25 Time=22:04 C=30 <br> End <br> 83 06 01 74 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 79 FF <br> 00 06 00 00 00 00 06 FF 00 <br> Vent Vent=Max T=25 Time=22:04 C=30 <br> End <br> 83 06 00 50 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 5C FF <br> 00 06 00 00 00 00 06 FF 00 <br> Heat Vent=Auto T=23 Time=22:04 C=30 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 8E FF <br> 00 06 00 00 00 00 06 FF 00 <br> Cool Vent=Auto T=26 Time=22:04 C=30 <br> End <br> 83 06 00 92 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E 9E FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=27 Time=22:04 C=30 <br> End <br> 83 06 00 A2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E AE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=28 Time=22:04 C=30 <br> End <br> 83 06 00 B2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E BE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=29 Time=22:04 C=30 <br> End <br> 83 06 00 C2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E CE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=30 Time=22:04 C=30 <br> End <br> 83 06 00 D2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E DE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=31 Time=22:04 C=30 <br> End <br> 83 06 00 E2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E EE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=32 Time=22:04 C=30 <br> End <br> 83 06 00 E2 00 00 FF 00 00 <br> 96 04 00 00 00 80 1E EE FF <br> 00 02 00 00 00 00 02 FF 00 <br> Cool Vent=Auto T=32 Time=22:04 C=30 <br> End <br> 83 06 00 E2 00 00 FF 00 00 <br> B6 05 00 00 00 80 1E CF FF <br> 00 00 00 00 00 00 00 FF 00 <br> Cool Vent=Auto T=32 Time=54:05 C=30 <br> End <br> 83 06 00 E2 00 00 FF 00 00 <br> 96 05 00 00 00 80 1E EF FF <br> 10 0F 00 00 00 00 1F FF 00 <br> Cool Vent=Auto T=32 Time=22:05 C=30 <br> End <br> 83 06 03 E2 00 00 FF 00 00 <br> 96 05 00 00 00 80 1E EC FF <br> 04 0B 00 00 00 00 0F FF 00 <br> Cool Vent=Min T=32 Time=22:05 C=30 <br> End <br> 83 06 00 71 80 00 FF 00 00 <br> 96 05 00 00 00 80 1E FC FF <br> 00 17 00 00 00 00 17 FF 00 <br> Vent=Auto T=25 Time=22:05 C=30 <br> End <br> 83 06 80 71 00 00 FF 00 00 <br> 96 05 40 00 00 80 1E BC FF <br> 00 07 00 00 00 00 07 FF 00 <br> Vent=Auto T=25 Time=22:05 C=30 <br> End <br> 83 06 00 82 00 00 FF 00 00 <br> 96 05 00 00 00 80 1E 8F FF <br> 00 06 00 00 00 00 06 FF 00 <br> Cool Vent=Auto T=26 Time=22:05 C=30 <br> End <br> 83 06 04 82 00 00 FF 00 00 <br> 96 05 00 00 00 80 1E 8B FF <br> 00 01 00 00 00 00 01 FF 00 <br> Cool Vent=Auto T=26 Time=22:05 C=30 <br> End</code> <br> </div></div></div><p>Source: <a href="https://habr.com/ru/post/419797/">https://habr.com/ru/post/419797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419785/index.html">How MSTP works</a></li>
<li><a href="../419787/index.html">Rome Club Report 2018, Chapter 3.9: ‚ÄúFivefold Resource Performance‚Äù</a></li>
<li><a href="../419789/index.html">Thoughts Jimmy Wales: "Wikipedia as a sausage ..."</a></li>
<li><a href="../419791/index.html">Apple abandons affiliate program to promote applications from the App Store</a></li>
<li><a href="../419795/index.html">Tesla reported a record loss. Shares of the company still rose due to forecasts for the next quarter</a></li>
<li><a href="../419799/index.html">How the confrontation between Walmart and Amazon determines the future of retail</a></li>
<li><a href="../419801/index.html">Overview of the industrial 3D-printer Creatbot F430 from 3Dtool</a></li>
<li><a href="../419803/index.html">WANHAO DUPLICATOR 8 mini review</a></li>
<li><a href="../419805/index.html">The Super Tiny Compiler - now in Russian</a></li>
<li><a href="../419807/index.html">Glaucoma - how not to go blind: let's talk about the treatment ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>