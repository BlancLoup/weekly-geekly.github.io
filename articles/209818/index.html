<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FORTH: nano-servers and nanoclients. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's time to talk about another side of using the wonderful Fort language. 
 In this series of articles, I will show how you can use it to create tiny...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FORTH: nano-servers and nanoclients. Part 1</h1><div class="post__text post__text-html js-mediator-article">  It's time to talk about another side of using the wonderful Fort language. <br>  In this series of articles, I will show how you can use it to create tiny client-server applications.  Each of which can be used as a research and teaching tool. <br>  For entertainment, we need Windows up to the seven and the SP-Forth package.  Andrei Tcherezov declared the possibility of running his fort system under Linux, but I didn‚Äôt check it. <br><br>  To begin with, we will try to create a simple server program that will give to the joining client well ... let's say the current date and time on the server. <br><br><a name="habracut"></a><br>  Create a datetimes.f file in Notepad or any other text editor (Akelpad) in the same folder as spf4.exe. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What do we need to create a server?  Sockets! <br>  To start working with them you need to connect the appropriate library. <br>  <em>~ nn \ lib \ sock2.f</em> <br><br>  Conveniently, all libraries are stored in source code.  You can always look and see what it is and how it works. <br><br><pre> 0 VALUE sockt
 0 VALUE sockt_a
 SocketsStartup THROW. (Sockets started) CR 
 CreateSocket THROW TO sockt. (Socket created) CR
</pre><br>  The first two lines - obviously the definition of variables.  VALUE variables are an improvement to the classic Fort.  They allow you to avoid endless dereferencing (getting the value to the address) and make the text more readable. <br>  The third line speaks for itself, but at the last it is necessary to give a couple of comments. <br>  The word CreateSoket is understandable and true, but there are nuances.  Sockets are different!  Honestly, I don‚Äôt know much about socket sorts, but the simplest and, it seems, the most frequently used is a blocking bidirectional streaming TCP / IP socket created by this word.  How to create a different type of sockets, you can look into the library.  The magic word THROW just intercepts the error codes and throws an exception if the error code is non-zero.  The brackets print the text between them on the terminal, CR - line feed. <br><pre> 
 80 sockt BindSocket THROW. (Socket binded) CR
 sockt ListenSocket THROW. (Listen) CR
 sockt AcceptSocket THROW TO sockt_a. (Accept connection from :) 
</pre><br>  That's almost all.  Now we sit and listen on port 80 until someone knocks. <br>  Of course, you can choose a completely arbitrary free port. <br>  The word AcceptSoket will stop the execution of the program until it is connected. <br>  Who joined us? <br><br><pre> sockt_a GetPeerIP &amp; Port THROW SWAP NtoA TYPE. "port:". </pre><br>  will display in the console the IP address and port from which the connection occurred.  The only SWAP in the whole program arose only because of the not very thoughtful implementation of the word <em>GetPeerIP &amp; Port</em> . <br><br>  Prepare the date and time for shipment. <br>  We will need another library. <br><br>  <em>lib \ include \ facil.f</em> <br><br>  From which you need the word <em>TIME &amp; DATE</em> .  (I had to fix it in the library, now it is different from the complete one. It began to give out milliseconds, and the date order has changed.) This word puts 7 values ‚Äã‚Äãon the stack.  Milliseconds, seconds, hours, year, month, day.  Accordingly, the first number will be removed from the stack.  This is the date of the month. <br><br><pre>  S "Current time: sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (day)
 S "-" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (month)
 S "-" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (year)
 S "" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (hours)
 S "-" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (minutes)
 S "-" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (seconds)
 S "-" sockt_a WriteSocket THROW
 S&gt; D (D.) sockt_a WriteSocket THROW (milliseconds) </pre><br><br>  It looks awful.  The beauty of the Fort is that this ugliness can be turned into candy. <br>  It can be seen that the same text is repeated 7 and twice in 3. Of course, you can put a cycle on it, but then the text will be difficult to read. <br>  Take advantage of the possibilities of the Fort. <br><br>  Define additional words <br><br><pre>  : send_value S&gt; D (D.) sockt_a WriteSocket THROW;
 : send_delimeter sockt_a WriteSocket THROW; </pre><br><br>  Logical, understandable and easy to read.  <em>{Remark: The word S&gt; D extends the top element of the stack to double precision with a sign.</em>  <em>The word (D.) converts the double precision number to a string and puts its address and counter on the stack.}</em> <em><br><br></em> <pre> : Day send_value;
 : Month send_value;
 : Year send_value;
 : Hours send_value;
 : Minutes send_value;
 : Seconds send_value;
 : Milliseconds send_value; </pre><br><br>  Still awful.  What can be done? <br>  One key feature of the Fort language comes to the rescue.  We can create our own defining words. <br><br><pre> : make_value CREATE DOES&gt; DROP send_value;
 : make_values ‚Äã‚Äã0 DO make_value LOOP; </pre><br><br>  During its execution, the word <em>make_value</em> will select the next set of characters, limited by spaces, from the input stream and place it on top of the current dictionary.  The semantics of this new word will be <em>assigned to the</em> word after <em>DOES&gt;</em> .  That is, we have a tool with which you can create concepts that are united by common semantics. <br><br><pre>  7 Make_values ‚Äã‚ÄãDay Month Year Hours Minutes Seconds Milliseconds </pre><br><br>  And for delimiters <br><br><pre> : make_delimeter CREATE, DOES&gt; 1 send_delimeter;
 : make_delimeters 0 DO make_delimeter LOOP;

 BL CHAR - CHAR: 3 make_delimeters: - _ </pre><br><br>  Now we can write nicely <br><br><pre> TIME &amp; DATE
 Day - Month - Year _ Hours: Minutes: Seconds: Milliseconds </pre><br><br>  We break connection <br><br><pre>  sockt_a CloseSocket THROW </pre><br><br>  And clear the sockets <br><br><pre>  SocketsCleanup THROW </pre><br><br>  Everything. <br><br>  As you can see the stages of execution and compilation can alternate.  This is another basic feature of the Fort.  Also a well-written Fort program requires almost no comments. <br>  Those who were attentive enough noticed that we had redefined the basic words colon and minus.  How to deal with this?  The answer is below. <br><br><h3>  Combed code </h3><br><pre> ~ nn \ lib \ sock2.f 
 lib \ include \ facil.f

 80 CONSTANT port
 0 VALUE sockt
 0 VALUE sockt_a

 : send_value S&gt; D (D.) sockt_a WriteSocket THROW;
 : send_delimeter sockt_a WriteSocket THROW;

 : make_value CREATE DOES&gt; DROP send_value;
 : make_values ‚Äã‚Äã0 DO make_value LOOP;

 7 Make_values ‚Äã‚ÄãDay Month Year Hours Minutes Seconds Milliseconds 

 : make_delimeter CREATE, DOES&gt; 1 send_delimeter;
 : make_delimeters 0 DO make_delimeter LOOP;

 : define::;

 BL CHAR - CHAR: 3 make_delimeters: - _



 define: time &amp; date_server 

                 SocketsStartup THROW. "Sockets started" CR 
                 CreateSocket THROW TO sockt. "Socket created" CR

                 port sockt BindSocket THROW. "Socket binded" CR
                 sockt ListenSocket THROW. "Listen" CR

                 sockt AcceptSocket THROW TO sockt_a. "Accept connection from:" 
                 sockt_a GetPeerIP &amp; Port THROW SWAP NtoA TYPE. "port:". 

                 S "Current time:" sockt_a WriteSocket THROW

                 TIME &amp; DATE 

                 Day - Month - Year _ Hours: Minutes: Seconds: Milliseconds  

                 sockt_a CloseSocket THROW 

                 SocketsCleanup THROW 
 ;

 time &amp; date_server  
</pre></div><p>Source: <a href="https://habr.com/ru/post/209818/">https://habr.com/ru/post/209818/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209808/index.html">Tablet Lenovo Yoga Tablet 10: tested in humans</a></li>
<li><a href="../209810/index.html">Stock Market Tools: Derivatives</a></li>
<li><a href="../209812/index.html">Why are there so many Pythons?</a></li>
<li><a href="../209814/index.html">New payment method: Bitcoin and Litecoin</a></li>
<li><a href="../209816/index.html">Day-to-Day Service Plan - Part 2: Automatic Update of Statistics</a></li>
<li><a href="../209820/index.html">Validating Forms in a Declarative Style (C #)</a></li>
<li><a href="../209822/index.html">Testers - a supporting role?</a></li>
<li><a href="../209824/index.html">Test boost :: lockfree on the speed and delay of message transmission</a></li>
<li><a href="../209826/index.html">The implementation of the shingle algorithm on Node.JS. Finding Fuzzy Duplicates for English Texts</a></li>
<li><a href="../209828/index.html">Hekslet: Erlang, logic, operating systems, Java 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>