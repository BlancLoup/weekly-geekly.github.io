<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Live Container Migration: An Inside Look</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will look at a topic that is not fully disclosed in the modern IT world: live container migration, how it works behind the scenes and what pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Live Container Migration: An Inside Look</h1><div class="post__text post__text-html js-mediator-article">  Today we will look at a topic that is not fully disclosed in the modern IT world: live container migration, how it works behind the scenes and what problems it solves.  The demand for this technology continues to grow rapidly as it opens up new opportunities, providing more freedom in managing the application lifecycle. <br><br><h4>  <b>Live migration - what is it?</b> </h4><br>  <b>Live container migration</b> involves the process of moving an application between different physical machines or clouds without interrupting the application and breaking the connection with the user.  Memory, file system and network connection of containers running on top of bare hardware are transferred from the source host computer to the destination, maintaining a working state without interrupting work. <br><img src="https://habrastorage.org/getpro/habr/post_images/0a7/243/05d/0a724305d84e70281194c616f3987a95.gif" alt="image"><br><a name="habracut"></a><br><br><h4>  <b>Problems that live migration solves</b> </h4><br>  There are several problems that live migration can solve: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>Idle period during equipment maintenance</b> </li></ul>  In order to modify / replace hardware, the system administrator must transfer all users from one hardware node to another without downtime and interruption, which in itself is a difficult-to-do, and often impossible task at all. <br><br><ul><li>  <b>Unbalanced cluster load</b> </li></ul>  If the load on the hardware node is too high, the rebalancing process must be performed, for which specific application configurations will need to be implemented, which in turn will reduce / reduce the choice of workloads that can be hosted in a cluster <br><br><ul><li>  <b>Cloud issues</b> </li></ul>  There are many different cloud solutions on the modern IT market, and from time to time they have various incidents, such as an idle period, a change in pricing policy, or even a deterioration in the quality of services provided.  In most cases, it is impossible to migrate an application from one cloud provider to another. <br><br><h4>  <b>Alternative Solutions</b> </h4><br>  All the above mentioned problems can be solved, and now we will tell you several options for solving these problems without the help of live migration. <br><br><ul><li>  <b>Scheduled idle periods</b> .  To perform technical maintenance of the cluster, you need to go through three steps: <br><br>  <strong>1.</strong> Notify users (application owners) in advance of the maintenance window and possible idle time. <br>  <strong>2.</strong> Disconnect hardware <br>  <strong>3.</strong> Connect back only after all necessary changes are made.  In this case, the problem is a relatively large period of inactivity. </li></ul><br><ul><li>  <b>Redirect traffic</b> .  To perform cluster maintenance, you must restore a copy of each application in a different hardware node, then redirect traffic to this new copy and close the previous one.  In this case, the problem is the complexity of this process - you need to have specially designed applications to obtain high availability and data synchronization.  In addition, more hardware resources may be required to complete this task. </li></ul><br><ul><li>  <b>Microservices.</b>  Detailed division of application services into separate containers and their distribution across different physical servers helps to avoid idle periods in the event of a hardware failure.  Broken containers will be automatically restored to the active hardware node.  However, in this case, the problem is again the complexity of the process, since the applications in the cluster must be designed so that you can manage the high availability and recovery process after a crash. </li></ul><br><h4>  <b>How Live Migration Works</b> </h4><br>  Let's look at the live migration process from the technical side using the following scheme: <br><br><img src="https://habrastorage.org/files/255/202/224/2552022240a34aeb92feec1ec7cdf51d.png" alt="image"><br><br><ul><li>  <b>Source Node</b> ‚Äî The location of the container before live migration. </li><li>  <b>Destination Node</b> - container location after live migration </li></ul><br>  To complete the migration, the platform freezes the container in the source node, locking the memory, processes, file system, and network connections, and saves the state of that container.  After that, it is copied to the destination node.  The platform restores the state and thaws the container in this node.  Then, in the source node, the process of quickly clearing the data of the migrating container is carried out. <br><br>  It's pretty simple: you get, copy and restore the state of the container.  However, in this case, it is necessary to take into account the freezing period, which must be taken into account when developing (architecture) applications, since this point may be critical for some of them. <br><br>  There are two ways to do live migration.  One of these is <b>memory pre-copying.</b>  If you want to transfer the container, the platform will direct the monitored memory to the source node, and will copy this memory at the same time as the destination node until the difference is minimal.  After that, the platform freezes the container, gets the remaining state, transfers it to the destination node, restores and defrosts it. <br><br><img src="https://habrastorage.org/files/c89/d08/8d9/c89d088d9715490fa71b41004463b1d9.png" alt="image"><br><br>  Another way is to <b>post-copy memory</b> , or in other words, <b>lazy migration</b> .  The system first freezes the container in the source node, obtains the state of the most rapidly changing memory pages, transfers the state to the destination node, restores it and unfreezes the container.  The rest of the state in the background is copied from the source node to the destination node. <br><br><img src="https://habrastorage.org/files/ee8/a2f/4cb/ee8a2f4cb1284f9db7b605a06fa1b76a.png" alt="image"><br><br>  Usually, depending on the application, the freezing time for each container takes from 5 to 30 seconds.  This is indeed a short period of time compared to the possible idle hours during cluster maintenance. <br><br><h4>  <b>Live Migration Examples</b> </h4><br><ul><li>  <b>Maintain hardware without downtime</b> </li></ul>  During the maintenance period, containers can be moved in real time from one node of a physical server to another within one data center, which does not lead to an idle period. <br><br><ul><li>  <b>Load redistribution</b> </li></ul>  Live migration allows you to re-balance (evenly distribute) the load by migrating containers from one hardware node to another.  This scenario can also be automated, a special dispatching algorithm and the corresponding triggers are activated. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/945/1c1/031/9451c1031de0c12b797da3175cce4ceb.gif" alt="image"><br><br><ul><li>  <b>High availability between availability areas in data centers</b> </li></ul>  The cloud service provider can pre-configure and offer a set of hardware availability zones within one or more data centers.  As a result, end users have more opportunities to ensure high availability by carrying out live container migration without the participation of system administrators from one availability zone to another. <br><br><ul><li>  <b>Switch to another cloud provider</b> </li></ul>  Live migration gives users the freedom to choose - they are not tied to a particular cloud provider, and can transfer their applications to an alternative cloud, without changing the configuration and redeploying during the migration. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/255/5b9/44a/2555b944a7b18d5ae2510714e021cc94.gif" alt="image"><br><br><h4>  <b>Pitfalls and Possible Disadvantages</b> </h4><br>  With all the benefits of live migration, there are also a few drawbacks that need to be taken into account before starting the migration: <br><br><ul><li>  During live migration, you may notice some performance degradation while the container is in a frozen state.  For some applications, this is a critical drawback, since they do not accept any performance degradation (for example, monolithic high-load online applications).  However, short-term freezing is not a serious drawback for most applications on the Internet, especially if we talk about web applications. </li></ul><br><ul><li>  Another difficulty is the large amount of fast-changing data that is not easily transferred from one cloud provider to another.  The waiting period and a large amount of data can impede the success of live migration. </li></ul><br><ul><li>  Public IP addresses in multi-cloud.  It is not possible to transfer containers with a public IP address from one cloud provider to another, because the IP address is tied to a specific provider. </li></ul><br><ul><li>  If an application inside a container uses a proprietary API or proprietary cloud services of a particular cloud provider, it can be very difficult or even impossible to perform live migration from one cloud to another. </li></ul><br><h4>  <b>Live Migration in the Modern IT Market</b> </h4><br>  What companies offer live container migration today? <br><br><ul><li>  <a href="https://virtuozzo.com/">Virtuozzo</a> - this company, in fact, created the technology of live migration of containers;  they were pioneers in this area and currently offer a live migration engine that allows atomic migration of a container from one physical host to another. </li></ul><br><ul><li>  <a href="http://runc.io/">The runC</a> from the Open Containers Initiative is another promising container solution that supports live migration based on <a href="https://criu.org/Main_Page">CRIU</a> . </li></ul><br><ul><li>  <a href="https://jelastic.com/">Jelastic</a> offers a container-orchestrated platform that provides live migration of both atomic containers and applications with a complex deployment topology between hardware hosts, availability zones, data centers, and cloud providers. </li></ul><br><h4>  <b>Demo: Minecraft Migration in Real Time</b> </h4><br>  To see the Minecraft process from AWS to Azure in real-time without downtime, watch the following video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HfN4L6RFL10" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Live container migration is still a relatively new technology on the market.  Nevertheless, the advantages of this technology for modern business are obvious - no downtime during maintenance, no need to spend a lot of effort on preparing and testing the working environment in another cloud.  That is why live migration is a great solution for better availability and flexibility.  Share your experience in real-time container migration between clouds or data centers. </div><p>Source: <a href="https://habr.com/ru/post/313512/">https://habr.com/ru/post/313512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313500/index.html">PPC - now Pay Per Call</a></li>
<li><a href="../313502/index.html">How to become smarter in a world where we want to leave an idiot</a></li>
<li><a href="../313506/index.html">Power OK: Schneider Electric Galaxy G300</a></li>
<li><a href="../313508/index.html">Technologies of development and support of a complex product: the experience of "Hydra"</a></li>
<li><a href="../313510/index.html">The book "Learning Python. Game programming, data visualization, web applications</a></li>
<li><a href="../313514/index.html">The Pros & Cons of Test-Driven Development</a></li>
<li><a href="../313516/index.html">Creating a console application using Android NDK</a></li>
<li><a href="../313518/index.html">7 more services for monitoring sites</a></li>
<li><a href="../313522/index.html">WTF: What the FITS</a></li>
<li><a href="../313524/index.html">Upsource 3.5 is released with numerous changes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>