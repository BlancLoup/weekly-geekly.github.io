<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Vim and Keyboard Layout Switching</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: This is the ‚Äúhistorical‚Äù version of the topic. A new solution to the problem is here . 

 The problem of Russian layout in Vim has been raised ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Windows Vim and Keyboard Layout Switching</h1><div class="post__text post__text-html js-mediator-article">  <b>UPD:</b> This is the ‚Äúhistorical‚Äù version of the topic.  A new solution to the problem is <a href="http://habrahabr.ru/post/175709/">here</a> . <br><br>  The problem of Russian layout in Vim has been raised many times.  One solution can be seen <a href="http://habrahabr.ru/post/98393/">here</a> , but it makes you get used to the new hot key for switching layouts.  There are also many solutions with calling the system utility to change the layout, but under Windows I did not find such a utility, so I had to implement it myself. <br><a name="habracut"></a><br>  In fact, it turned out the console interface for WinAPI-functions.  To install a new layout for a window, the program gets the class name of this window and the two-letter language code.  If there is such a window and the corresponding language code is found, then the program sends the WM_INPUTLANGCHANGEREQUEST message to this window. <br><br>  To create a link to the program with Vim, he relied on a post from the <a href="http://lin-techdet.blogspot.com/2012/04/vim.html">Tech Details</a> blog.  For the switch to work in Windows, add the following lines to _vimrc: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs pgsql">fun! &lt;SID&gt;xkb_switch(mode) let cur_layout = <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>(<span class="hljs-string"><span class="hljs-string">'dxlsw.exe -get VIM'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a:mode == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cur_layout != <span class="hljs-string"><span class="hljs-string">'en'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>(<span class="hljs-string"><span class="hljs-string">'dxlsw.exe -set VIM en'</span></span>) endif let b:xkb_layout = cur_layout elseif a:mode == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>(<span class="hljs-string"><span class="hljs-string">'b:xkb_layout'</span></span>) &amp;&amp; b:xkb_layout != cur_layout <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>(<span class="hljs-string"><span class="hljs-string">'dxlsw.exe -set VIM '</span></span>.b:xkb_layout) endif endif endfun <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> executable(<span class="hljs-string"><span class="hljs-string">'dxlsw.exe'</span></span>) autocmd InsertEnter * <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> &lt;SID&gt;xkb_switch(<span class="hljs-number"><span class="hljs-number">1</span></span>) autocmd InsertLeave * <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> &lt;SID&gt;xkb_switch(<span class="hljs-number"><span class="hljs-number">0</span></span>) endif</code> </pre> <br><br>  Also, don't forget to put <a href="">dxlsw.exe</a> (3.5 KB) somewhere in <i>% PATH</i> , for example, in <i>C: \ Windows \ System32</i> .  If someone needs, then there is a <a href="">64-bit version</a> (5 KB).  <a href="">The source code</a> (6.8 KB) is available under the LGPL2 license. <br><br>  Advantages: works, switches the layout only in the Vim window. <br>  Disadvantages: when calling the system function from GVim, the cmd.exe window opens for a short period of time and the GVim window briefly loses focus. <br><br>  <b>UPD:</b> <br>  On the advice of habrayuzer, <a href="http://habrahabr.ru/users/ivnik/" class="user_link">ivnik</a> assembled a DLL version of the language switch.  The cmd window does not appear, there are no brakes. <br><br>  _vimrc changed to: <br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function">! </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;SID&gt;</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lib_kb_switch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mode)</span></span></span></span> let cur_layout = libcallnr(<span class="hljs-string"><span class="hljs-string">'libdxlsw'</span></span>, <span class="hljs-string"><span class="hljs-string">'dxGetLayout'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a:mode == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cur_layout != <span class="hljs-number"><span class="hljs-number">1033</span></span> call libcallnr(<span class="hljs-string"><span class="hljs-string">'libdxlsw'</span></span>, <span class="hljs-string"><span class="hljs-string">'dxSetLayout'</span></span>, <span class="hljs-number"><span class="hljs-number">1033</span></span>) endif let b:lib_kb_layout = cur_layout elseif a:mode == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exists(<span class="hljs-string"><span class="hljs-string">'b:lib_kb_layout'</span></span>) &amp;&amp; b:lib_kb_layout != cur_layout call libcallnr(<span class="hljs-string"><span class="hljs-string">'libdxlsw'</span></span>, <span class="hljs-string"><span class="hljs-string">'dxSetLayout'</span></span>, b:lib_kb_layout) endif endif endfun autocmd InsertEnter * call &lt;SID&gt;lib_kb_switch(<span class="hljs-number"><span class="hljs-number">1</span></span>) autocmd InsertLeave * call &lt;SID&gt;lib_kb_switch(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br><br>  Put the DLL file in the directory with the Gvim EXE file.  If Vim's 64-bit build, then use the appropriate library. <br><ul><li>  32-bit DLL: <a href="">libdxlsw.dll</a> , <a href="https://docs.google.com/open%3Fid%3D0B9-Etri4sAb5Y2NWY3JqLTVHYTg">mirror</a> (3 KB) </li><li>  64-bit DLL: <a href="">libdxlsw64.dll</a> , <a href="https://docs.google.com/open%3Fid%3D0B9-Etri4sAb5N1hRUzZjLWQyQlE">mirror</a> (3.5 KB) </li><li>  Code: <a href="">libdxlsw.c</a> , <a href="http://pastebin.com/ScqTmaQn">pastebin</a> (1.9 KB) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/162483/">https://habr.com/ru/post/162483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162471/index.html">New Cloud Server Control Panel</a></li>
<li><a href="../162473/index.html">Convert Word documents to php using COM (windows + apache)</a></li>
<li><a href="../162475/index.html">Pure Version Control</a></li>
<li><a href="../162477/index.html">Last.fm announces termination of radio service for most countries</a></li>
<li><a href="../162479/index.html">Office for Kolobok</a></li>
<li><a href="../162487/index.html">Video review laptop Lenovo IdeaPad S400</a></li>
<li><a href="../162491/index.html">Every fifth vacancy in IT for a young specialist</a></li>
<li><a href="../162493/index.html">Who do employers hunt for?</a></li>
<li><a href="../162497/index.html">All that you were shy to ask about backups of Microsoft SQL Server</a></li>
<li><a href="../162499/index.html">Service direct SIP calls call2sip.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>