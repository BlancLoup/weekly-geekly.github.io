<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of using WxPython to create a node interface. Part 1: Learning to draw</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a small series of articles will be described the use of WxPython to solve a very specific task of developing a user interface, and even how to make...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of using WxPython to create a node interface. Part 1: Learning to draw</h1><div class="post__text post__text-html js-mediator-article">  In a small series of articles will be described the use of WxPython to solve a very specific task of developing a user interface, and even how to make this solution universal.  This tutorial is designed for those who have already begun to study this library and want to see something more complex and holistic than the simplest examples (although everything will start from relatively simple things). <br><br>  It all started like this: it took me for one project to make a UI, where I need to edit the message processing sequence.  Something like Simulink.  Accordingly, it is useful to look for ready-made frameworks / frameworks.  At first I thought that the problem was popular and someone had already done this bike, looked, looked and ... did not find it.  More precisely found a lot of antique bicycles, but who will use someone else's old bike, if you can make your new one.  But since to make a new bike, why not make it universal, you never know, where else is useful. <br><br>  So I will try in several articles to describe the development process from scratch to a working example.  Well, so that it was interesting, and the fermwork was universal, the first task for him would not be Simulink's similarity, but a software for drawing flowcharts √† la Visio, but with his blackjack and other participants :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://habrahabr.ru/post/201336/">Part 1: Learning to draw</a> <br>  <a href="http://habrahabr.ru/post/201538/">Part 2: Handling Mouse Events</a> <br>  <a href="http://habrahabr.ru/post/201608/">Part 3: We continue to add features + keyboard handling</a> <br>  <a href="http://habrahabr.ru/post/201784/">Part 4: Implementing Drag &amp; Drop</a> <br>  <a href="http://habrahabr.ru/post/201930/">Part 5: We connect nodes</a> <br><br>  Who cares, welcome under the cat‚Ä¶ <br><a name="habracut"></a><br><br>  <i>A small comment: I will use English names in the code and will often use transliteration, i.e.</i>  <i>instead of writing ‚Äúcanvas‚Äù or ‚Äúcanvas‚Äù, I will write ‚Äúcanvas‚Äù.</i>  <i>Yes, I know that this may look bad and wrong, but there is no perfect way to mix Russian and English, all methods have their drawbacks (my personal opinion).</i> <br><br><h4>  1. First test </h4><br>  Let's start with simple banal things.  Since this is a framework, then someone will be based on it to make applications or parts of applications that will do.  Those.  for the simplest test, we need to make the simplest application.  Without thinking too long, I decided that I would draw connected rectangles and started with this code (it will live in the file ‚ÄúConnectedBoxes.py‚Äù): <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wx <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> MoveMe.Canvas.Canvas <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Canvas <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CanvasWindow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(wx.Frame)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kw)</span></span></span><span class="hljs-function">:</span></span> wx.Frame.__init__(self, *args, **kw) s = wx.BoxSizer(wx.VERTICAL) s.Add(Canvas(self), <span class="hljs-number"><span class="hljs-number">1</span></span>, wx.EXPAND) self.SetSizer(s) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: app = wx.PySimpleApp() CanvasWindow(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>).Show() app.MainLoop()</code> </pre> <br>  Everything is rather trivial and obvious, except for a couple of moments: MoveMe is the name of our framework, and Canvas is the main class of our framework responsible for rendering the whole thing. <br><br><h4>  2. Learn to draw </h4><br>  Actually our framework starts with canvas.  It is responsible for storing objects (we will call them nodes), their rendering and handling user interaction.  Accordingly, let's start with a simple drawing. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wx <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Canvas</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(wx.PyScrolledWindow)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Canvas stores and renders all nodes and node connections. It also handles all user interaction. """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kw)</span></span></span><span class="hljs-function">:</span></span> super(Canvas, self).__init__(*args, **kw) self.scrollStep = kw.get(<span class="hljs-string"><span class="hljs-string">"scrollStep"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) self.canvasDimensions = kw.get(<span class="hljs-string"><span class="hljs-string">"canvasDimensions"</span></span>, [<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">800</span></span>]) self.SetScrollbars(self.scrollStep, self.scrollStep, self.canvasDimensions[<span class="hljs-number"><span class="hljs-number">0</span></span>]/self.scrollStep, self.canvasDimensions[<span class="hljs-number"><span class="hljs-number">1</span></span>]/self.scrollStep) self._dcBuffer = wx.EmptyBitmap(*self.canvasDimensions) self.Render() self.Bind(wx.EVT_PAINT, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> evt: wx.BufferedPaintDC(self, self._dcBuffer, wx.BUFFER_VIRTUAL_AREA) ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Render all nodes and their connection in depth order."""</span></span> cdc = wx.ClientDC(self) self.PrepareDC(cdc) dc = wx.BufferedDC(cdc, self._dcBuffer) dc.Clear() gc = wx.GraphicsContext.Create(dc) gc.SetPen(wx.Pen(<span class="hljs-string"><span class="hljs-string">'#000000'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, wx.SOLID)) gc.DrawRoundedRectangle(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) gc.DrawRoundedRectangle(<span class="hljs-number"><span class="hljs-number">112</span></span>, <span class="hljs-number"><span class="hljs-number">134</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>, <span class="hljs-number"><span class="hljs-number">178</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br>  Here everything becomes a little more interesting: <br><ul><li>  First, we inherit ‚Äúwx.PyScrolledWindow‚Äù so that our window can be scrolled and set the parameters of scrolling in ‚Äúself.SetScrollbars‚Äù. </li><li>  Secondly, we will not be drawing directly, but in the buffer, so that all this happens faster and without flickering.  To do this, use "wx.BufferedDC" and a buffer that is a bitmap. </li><li>  And thirdly, we will use ‚Äúwx.GraphicsContext‚Äù for convenient state saving.  It has ‚ÄúPushState‚Äù and ‚ÄúPopState‚Äù methods that save settings for brushes, fonts, and so on, which is especially useful, since the user code will draw blocks on the screen and no one guarantees that the user will return everything to the place. </li></ul>  If we run the code now, we will be able to see a couple of <s>iPhones of</s> rectangles with rounded corners in the window that can be scrolled. <br><img src="https://habrastorage.org/getpro/habr/post_images/aed/1da/f7c/aed1daf7c44f379d7caaa6b1d64ee674.png"><br><br><h4>  3. Arrange the scene </h4><br>  With the simplest drawing figured out, it's time to somehow streamline this process and introduce the concept of an object on the stage.  All visible objects will be stored in the list, which will determine the order of the objects.  To support this, we will add the "_canvasObjects" field to the canvas class and slightly modify the rendering process, i.e.  instead of drawing directly, we will call the "Render" method of all objects on the scene.  Now the code looks like this: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wx <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> MoveMe.Canvas.Objects.SimpleBoxNode <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SimpleBoxNode <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Canvas</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(wx.PyScrolledWindow)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Canvas stores and renders all nodes and node connections. It also handles all user interaction. """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kw)</span></span></span><span class="hljs-function">:</span></span> super(Canvas, self).__init__(*args, **kw) self.scrollStep = kw.get(<span class="hljs-string"><span class="hljs-string">"scrollStep"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) self.canvasDimensions = kw.get(<span class="hljs-string"><span class="hljs-string">"canvasDimensions"</span></span>, [<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">800</span></span>]) self.SetScrollbars(self.scrollStep, self.scrollStep, self.canvasDimensions[<span class="hljs-number"><span class="hljs-number">0</span></span>]/self.scrollStep, self.canvasDimensions[<span class="hljs-number"><span class="hljs-number">1</span></span>]/self.scrollStep) self._canvasObjects = [SimpleBoxNode([<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>]), SimpleBoxNode([<span class="hljs-number"><span class="hljs-number">140</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>]), SimpleBoxNode([<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>])] self._dcBuffer = wx.EmptyBitmap(*self.canvasDimensions) self.Render() self.Bind(wx.EVT_PAINT, <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> evt: wx.BufferedPaintDC(self, self._dcBuffer, wx.BUFFER_VIRTUAL_AREA) ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Render all nodes and their connection in depth order."""</span></span> cdc = wx.ClientDC(self) self.PrepareDC(cdc) dc = wx.BufferedDC(cdc, self._dcBuffer) dc.Clear() gc = wx.GraphicsContext.Create(dc) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._canvasObjects: gc.PushState() obj.Render(gc) gc.PopState()</code> </pre><br>  By the way, the list of scene objects at once contains several objects of the class ‚ÄúSimpleBoxNode‚Äù, which for now will simply draw rectangles with the coordinates of the objects. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wx <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleBoxNode</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" SimpleBoxNode class represents a simplest possible canvas object that is basically a rectangular box. """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.position = pos self.boundingBoxDimensions = [<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, gc)</span></span></span><span class="hljs-function">:</span></span> gc.SetPen(wx.Pen(<span class="hljs-string"><span class="hljs-string">'#000000'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, wx.SOLID)) gc.DrawRoundedRectangle(self.position[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.position[<span class="hljs-number"><span class="hljs-number">1</span></span>], self.boundingBoxDimensions[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.boundingBoxDimensions[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>) gc.SetFont(wx.SystemSettings.GetFont(wx.SYS_DEFAULT_GUI_FONT)) gc.DrawText(<span class="hljs-string"><span class="hljs-string">"(%d, %d)"</span></span>%(self.position[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.position[<span class="hljs-number"><span class="hljs-number">1</span></span>]), self.position[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-number"><span class="hljs-number">10</span></span>, self.position[<span class="hljs-number"><span class="hljs-number">1</span></span>]+<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br>  Here everything seems to be rather trivial.  Unless it is necessary to specify the font, as the "GraphicsContext" does not have default settings (we will return to this fact and its correction).  At the moment, our code draws just such a picture: <br><img src="https://habrastorage.org/getpro/habr/post_images/a9c/b96/64f/a9cb9664f5c397553acf4797a5c73d05.png"><br>  No miracles, but enough for a start.  This concludes the first part, and in the next part we add the handling of mouse and keyboard events and let the user move our rectangles, join and delete. <br><br>  To be continued‚Ä¶ <br><br>  PS1: Code can be found on <a href="https://github.com/Akson/MoveMe/tree/6066ae9c1792c4d540e2c3741d12bbba0e6f4834">GitHub</a> <br>  PS2: Write about typos in PM. </div><p>Source: <a href="https://habr.com/ru/post/201336/">https://habr.com/ru/post/201336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201326/index.html">Pipe Child: How to combine web services into new tools</a></li>
<li><a href="../201328/index.html">Sony digital A4 paper</a></li>
<li><a href="../201330/index.html">Font path on WebFont.ru</a></li>
<li><a href="../201332/index.html">Easy printing from mobile devices or AirPrint without AirPrint</a></li>
<li><a href="../201334/index.html">FindBugs helps learn Java better</a></li>
<li><a href="../201338/index.html">Why the TV control method should change</a></li>
<li><a href="../201340/index.html">Today at 10:00 (MSK), see the online broadcast "Developing applications with common code for the Windows platform"</a></li>
<li><a href="../201344/index.html">Infrastructure of the Russian securities market (brief educational program)</a></li>
<li><a href="../201346/index.html">ART is replacing Dalvik</a></li>
<li><a href="../201348/index.html">We drove you to tea</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>