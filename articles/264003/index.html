<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lambda expressions in Java, how and why to serialize them?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The lambda expression mechanism introduced in Java8 has become such a feature that clearly separated the code before and after (it seems the same can ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lambda expressions in Java, how and why to serialize them?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8b4/f99/f9f/8b4f99f9f5ae44f79bd009c161dee16b.png"><br><br>  The lambda expression mechanism introduced in Java8 has become such a feature that clearly separated the code before and after (it seems the same can happen with Java9 and the modular system, but in a bad sense).  Java8 has more functional tricks, various processing of large data arrays has become much easier and now takes up much less space.  However, regarding the rational use of lambda expressions, there are many questions such as: how rational is it often to use them?  Whether a significant loss of performance is lost when moving from a normal loop to `forEach ()` with a lambda expression, and so on.  Most courses (even <a href="https://apexapps.oracle.com/pls/apex/f%3Fp%3D44785:141:::NO::P141_PAGE_ID%252CP141_SECTION_ID:250%252C1807">an Oracle course</a> ) ignore these questions.  This post will describe just one of the least popular questions, but no less interesting than the others: <br><blockquote>  How does lambda expression serialization work in Java and how can it be used? </blockquote><br><a name="habracut"></a><br><br><h4>  How to make a lambda expression serialized? </h4><br>  First of all, it is important to understand that the lambda function in Java is still <i>an object</i> with one unrealized method (the rest can be declared as default methods in the interface (c) <a href="http://habrahabr.ru/users/uthark/" class="user_link">uthark</a> ), and not a <i>function</i> .  That is, all the same manipulations are available with it as with ordinary objects.  In other words, a lambda function that implements a serializable interface will be serializable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SDoubleUnaryOperator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoubleUnaryOperator</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span></span>{ SDoubleUnaryOperator t = t-&gt;t*t; <span class="hljs-comment"><span class="hljs-comment">// - }</span></span></code> </pre> <br>  However, with new features in Java8, a more simplified version became available, without creating an additional interface: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span></span>{ DoubleUnaryOperator t = (DoubleUnaryOperator &amp; Serializable)t-&gt;t*t; <span class="hljs-comment"><span class="hljs-comment">// - }</span></span></code> </pre><br>  In both cases, instead of creating the usual lambda function, the compiler will create the lambda function in a special, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/invoke/SerializedLambda.html">serialized</a> form.  Then you can work with the lambda function as with any other object being serialized, if you do not forget about ... <br><br><h4>  How is the lambda function serialized? </h4><br>  To parse the process of serialization of lambda functions, the following class was created: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//saveLambda(); loadLambda(); } public static void saveLambda() throws IOException { Factory factory = new Factory(3); ObjectOutputStream output = new ObjectOutputStream(new FileOutputStream(new File("lambdas"))); output.writeObject(factory.createLambda(4,new SerializableData(3.3,4))); output.writeObject(factory.createLambda(5,new SerializableData(5.3,-4))); output.writeObject(factory.createLambda(3,new SerializableData(10.3,+80e-5))); output.close(); } public static void loadLambda() throws IOException, ClassNotFoundException { ObjectInputStream input = new ObjectInputStream(new FileInputStream(new File("lambdas"))); DoubleToString operator1 = (DoubleToString) input.readObject(); DoubleToString operator2 = (DoubleToString) input.readObject(); DoubleToString operator3 = (DoubleToString) input.readObject(); System.out.println(operator1.get(5)); System.out.println(operator2.get(5)); System.out.println(operator3.get(5)); } }</span></span></code> </pre><br>  The full code can be found <a href="https://gist.github.com/SirEdvin/575bfe6f17ba371af735">here</a> . <br><br>  During serialization, the lambda function serializes all the variables that are used in it, and the external object in which it is implemented, if it uses the fields of this object.  Accordingly, if at least one of the required components is not serializable, an error java.io.NotSerializableException will be received.  The serialized lambda function <b>knows nothing</b> about what it should do with the data.  It knows only the identifier of the corresponding special class for this function. <br><br>  For me personally, this was a slight disappointment.  In fact, during the serialization of the lambda function, it simply serializes the list of parameters that are used in it and its identifier.  However, after some thought and experimentation, I found several useful features and one practical example of using lambda-serialization serialization. <br><br><h5>  Features serialization lambda functions </h5><br><ul><li>  No duplicates in serialization.  In other words, if several lambda functions serialize the same object, it will be serialized only once; </li><li>  Minimally necessary serialization.  Only those objects that are needed are serialized.  For others, for example, if it is an external object, only the name is saved; </li><li>  The speed of the lambda function prepared for serialization practically does not differ with the speed of the usual lambda function. </li></ul><br><br><h4>  Practical use of lambda function serialization </h4><br>  The only useful way I found using lambda-serialization functions is to get lambda-functions from a class that is loaded during program execution.  The fact is that I did not find standard methods for obtaining lambda functions that were implemented in this class.  So serialization can help transfer lambda functions between programs or embed them in external modules. <br><br>  To begin with, we implement some external class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RemoteLambdaClass</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception</span></span>{ DoubleUnaryOperator t1 = (DoubleUnaryOperator &amp; Serializable) t-&gt;t*t; DoubleUnaryOperator t2 = (DoubleUnaryOperator &amp; Serializable) t-&gt;t*t*t; ObjectOutputStream output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"lambdas"</span></span>))); output.writeObject(t1); output.writeObject(t2); output.close(); } }</code> </pre><br>  After its launch, the file `lambdas` will be created, in which the serialized lambda functions will be located.  Next, create a simple class for reading (it is assumed that the external class and the file are in the RemoteLambdaClass folder in the project root): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ File f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"./RemoteLambdaClass/"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       URLClassLoader mainLoader = (URLClassLoader) Main.class.getClassLoader(); Field classPathField = URLClassLoader.class.getDeclaredField("ucp"); classPathField.setAccessible(true); URLClassPath urlClassPath = (URLClassPath) classPathField.get(mainLoader); urlClassPath.addURL(f.toPath().toUri().toURL()); Class&lt;?&gt; clazz = mainLoader.loadClass("RemoteLambdaClass"); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(new File(f,"lambdas"))); DoubleUnaryOperator o1 = (DoubleUnaryOperator) inputStream.readObject(); DoubleUnaryOperator o2 = (DoubleUnaryOperator) inputStream.readObject(); System.out.println(o1.applyAsDouble(2)); System.out.println(o2.applyAsDouble(2)); } }</span></span></code> </pre><br>  Results of performance: <br><br><pre> <code class="hljs css">4<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span></code> </pre><br><h5>  Total </h5><br>  Serialization of lambda functions is a rather interesting, but practically useless mechanism.  The reasons for making them serializable are hidden rather in avoiding problems with serialized interfaces.  Nevertheless, I think this mechanism can come up with a few more applications that I missed. </div><p>Source: <a href="https://habr.com/ru/post/264003/">https://habr.com/ru/post/264003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263993/index.html">Continuously distributed random variables generators</a></li>
<li><a href="../263995/index.html">Google Analytics with Unity3D</a></li>
<li><a href="../263997/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ170 (July 26 - August 2, 2015)</a></li>
<li><a href="../263999/index.html">Using Visual Studio Application Insights - Test Engineer's Experience</a></li>
<li><a href="../264001/index.html">We clean the Internet from annoying ads (AD Blocker for MikroTik)</a></li>
<li><a href="../264005/index.html">PHP to Clojure</a></li>
<li><a href="../264007/index.html">Magic of tensor algebra: Part 16 - Properties of the solid body inertia tensor</a></li>
<li><a href="../264009/index.html">Message Formatting for Yii :: t ()</a></li>
<li><a href="../264011/index.html">Microservices Q & A</a></li>
<li><a href="../264013/index.html">Antivirus # 2: Hacking BitDefender and Serious Symantec Vulnerabilities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>