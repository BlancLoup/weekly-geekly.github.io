<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>At the forefront of virtual machine design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While the first article is being prepared in a training series about the Erlang language, I decided to translate one interesting blog post. A post abo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>At the forefront of virtual machine design</h1><div class="post__text post__text-html js-mediator-article">  While the first article is being prepared in a training series about the Erlang language, I decided to translate one interesting blog post.  A post about the development of the Erlang virtual machine and the goals that its authors are trying to achieve. <br><br><a name="habracut"></a><br><br>  The Java virtual machine is now considered the benchmark, crammed with all sorts of optimizations and tricks so that you can break your head.  Because of this, many programming languages ‚Äã‚Äãuse it as an executable medium, instead of writing their own virtual machine (although <a href="http://github.com/why/potion/blob/1fa23f8719c448b595931cbe04a009a6392894e0/INTERNALS">someone</a> still considers this an interesting occupation).  I believe that the path chosen by the JVM will eventually become unpopular, since programmers in the very near future will face the problem of utilizing the power of systems with dozens or hundreds of processors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Architects of virtual machines will face the same problem as the creators of processors today - do not do one thing quickly, do several things at the same time.  Therefore, I do not believe that the benchmark of the virtual machine is the path chosen by the JVM.  Java is not created for such a future: <br><br><table><tbody><tr><td> <a href="http://picasaweb.google.com/lh/photo/e8Pq2NaS7e4NBbBzxFaQrA%3Ffeat%3Dembedwebsite"><img src="https://habrastorage.org/getpro/habr/post_images/31a/589/af6/31a589af6bfe1f14de4a498687af5017.png"></a> </td></tr><tr><td>  <i>We look at the image from the blog of Toby Archiani, who stole it from Ulf Wiger, who took it from Joe Armstrong, who borrowed it from Eric Chagershtern.</i> <br>  <i>On the graph - the part of the processor, which can be reached in one clock.</i> </td></tr></tbody></table><br>  At first glance, it is difficult to assess the benefits of using the Erlang virtual machine.  The garbage collector operates in soft real time, while the JVM garbage collector operates in hard real time.  On-the-fly compilation is slow enough for methods from computational mathematics and cannot ‚Äúinline‚Äù (tell me the correct word?) Between modules as HotSpot does.  For inexperienced Erlang administrators in general - horror.  For no apparent reason, it starts eating processor time and memory, and the only way to find out what is happening is to get into the shell and type commands in some esoteric language! <br><br>  But all these problems are very minor if you look at the plans and goals of the Erlang virtual machine.  At the beginning of the book Programming to Erlang, one of the creators of the language, Joe Armstrong, talks about the dream of a competitive programming model: your program runs N times faster on N processors.  Erlang achieved this goal to some extent using a distributed programming model.  But distributed programming is difficult: the moment will come when you will have to take into account the cost of sending messages on the network, deal with latency, lack of a network, server crashes.  And although Erlang / OTP provides a powerful platform for developing distributed services, many distribution factors turn out to be insignificant when it comes to one server with a large number of cores in the processor. <br><br>  VM Erlang supports SMP scheduler running in the normal thread for each processor core.  This allows VMs to distribute processes to several processors at the same time avoiding the negative sides of distributed programming.  A simple rule of Erlang: create as many processes as you want - the scheduler will load the processor evenly. <br><br>  And although all this is beautiful and interesting, the SMP scheduler has many bottlenecks.  Everything works fine with two or four cores, but as soon as you start to increase this number, the performance will not only not improve, but may fall.  The same situation is in the JVM, but based on the fact that this behavior is the result of the fundamental principles and design of this virtual machine, the Erlang competitiveness model gives creators much more optimization options. <br><br>  A recent presentation of the super-famous Erlanger Ulf Wiger tells us about a very near future for the Erlang virtual machine.  The presentation clarified several weak points of scalability and how the authors plan to get rid of them.  You can read the presentation yourself, or if you are lazy enough - read on, I will try to do everything for you. <br><br>  So, here's the tv thing: (sorry for cutting out the drawings from the presentation of Ulf! They rule!) <br><br><table><tbody><tr><td> <a href="http://picasaweb.google.com/lh/photo/YXyHdavWL1B1k79T6R21cg%3Ffeat%3Dembedwebsite"><img src="https://habrastorage.org/getpro/habr/post_images/928/013/dbe/928013dbeb96ec27d22f587458fb7e35.png"></a> </td></tr><tr><td>  <i>In this picture was the large logo of Errikson.</i>  <i>If anyone complains, I'll make my version.</i> </td></tr></tbody></table><br><br>  This is the Erlang virtual machine scheduler.  There are many schedulers, each of which works in a separate thread, and executes code from the general command flow.  See a weak spot?  Look at this bunch of arrows pointing to one place!  How to solve this problem?  Divide and conquer: <br><br><table><tbody><tr><td> <a href="http://picasaweb.google.com/lh/photo/ViP5l5TlnGe4YOysgW3UrA%3Ffeat%3Dembedwebsite"><img src="https://habrastorage.org/getpro/habr/post_images/026/e4b/de6/026e4bde66d09b07c3ca631c9832a8cd.png"></a> </td></tr></tbody></table><br><br>  Separating each scheduler with its own execution queue, we will get rid of one weak point, but we will have to correctly distribute the processes between the schedulers.  This is already starting to look like the core of the operating system, right?  Well, let's see how it affects the scalability of the system: <br><br><table><tbody><tr><td> <a href="http://picasaweb.google.com/lh/photo/eScn-9ykdISfaRmcHO03_A%3Ffeat%3Dembedwebsite"><img src="https://habrastorage.org/getpro/habr/post_images/99e/5f4/311/99e5f431184de8cbad221caffe32edde.png"></a> </td></tr></tbody></table><br><br>  The red line is today's SMP scheduler with a single execution queue.  The blue line is the next generation SMP scheduler, which will be in the next versions of Erlang.  As we can see, the separation of a single queue really helped, but after reaching a certain number of cores, the performance starts to fall again.  What is the matter? <br><br><table><tbody><tr><td> <a href="http://picasaweb.google.com/lh/photo/8ls-kn5xIFSQDzFYlyAW6w%3Ffeat%3Dembedwebsite"><img src="https://habrastorage.org/getpro/habr/post_images/646/485/28c/64648528c73ee900502ac4c8482d1ba6.png"></a> </td></tr></tbody></table>  <i>Again a bunch of arrows pointing to one place!</i>  <i>:(</i> 
<br><br>  Memory allocation in Erlang is another blocking point and, accordingly, a weak link in the scalability of the system.  I suppose that Ulf put it in his presentation because it is another task that the Erlang creators will solve when developing a new SMP planner. <br><br>  It may seem that these minor improvements in the performance of the scheduler are not so exciting, but step by step the creators of Erlang go through all the bottlenecks of the scalability of the system, increasing the performance of the virtual machine.  Based on the basic distribution of Erlang - the potential is huge.  And with the increase in the number of cores on the processor (these tests were run on a 64-core processor), all these optimization steps will be more and more needed to utilize all the power of the computing system. <br><br>  Systems like JVM will certainly not disappear with the advent of a multi-core future.  An approach like software transactional memory can be successfully used in the JVM, especially with a language like Clojure for achieving results, in certain parallelization problems, better than the ‚Äúnothing in common between processes‚Äù model in Erlang. <br><br>  But in general, I find the Erlang approach to competitiveness more understandable and making programmers' lives easier, hiding the entire complexity of distribution to the lowest level of the virtual machine.  This approach may be more logical than PTP, especially if it acquires a ‚Äúhuman face‚Äù, which I am trying to achieve with my project a programming language based on the Erlang virtual machine - Reia.  But the main thing is the presence of a huge potential for improving the performance of a virtual machine for multi-core systems, and I hope that one day we will see Joe Armstrong's dream in action - to run programs N times faster on N processors. <br><br>  PS Russian is not my native language, so any corrections or suggestions for improving readability are welcome.  Thank you for reading to the end;) </div><p>Source: <a href="https://habr.com/ru/post/50561/">https://habr.com/ru/post/50561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50556/index.html">How meld helped me</a></li>
<li><a href="../50557/index.html">Tasks EGE on computer science</a></li>
<li><a href="../50558/index.html">Learning to write: To be or not to be yourself</a></li>
<li><a href="../50559/index.html">Fasting and his life.</a></li>
<li><a href="../50560/index.html">Xen networking: the challenge of choice</a></li>
<li><a href="../50562/index.html">Running a Ruby on Rails application on a shared hosting using the example of a Redmine bug / timetracker</a></li>
<li><a href="../50563/index.html">AMD Brook +: right off the bat</a></li>
<li><a href="../50564/index.html">PocketFALLOUT. The same FALLOUT on your WM device.</a></li>
<li><a href="../50566/index.html">Correct tutorial</a></li>
<li><a href="../50568/index.html">Moore's life test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>