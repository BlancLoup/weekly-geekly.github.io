<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to KDF on the example of solving a cryptographic rebus</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One day, walking across the dark corners of the light Internet, I came across a software developer‚Äôs job with an impressive list of requirements and r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to KDF on the example of solving a cryptographic rebus</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5fd/590/331/5fd5903316584521900e8d95a08670ed.jpg"><br><br>  One day, walking across the dark corners of the light Internet, I came across a software developer‚Äôs job with an impressive list of requirements and responsibilities with a focus on security systems for both software and hardware. <br><br>  In addition to a long list of requirements, an even more fantastic list of expectations was attached: serious mathematical skills, experience in cryptography, analysis, and the like.  But it was also proposed to solve the puzzle test: a coded message that needed to be decrypted. <br><a name="habracut"></a><br>  Although the topic for me is absolutely new and I don‚Äôt come close to the requirements, but I decided, for the sake of simple interest, to try to solve the encrypted message.  See what hackers are lured to work with. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The message was encoded in base64: <br>  <i>KDF function for use of this generic hash algorithm which has a 32 bytes output.</i> <i><br></i>  <i>KDF output.</i> <i><br></i>  <i>Here is the encrypted question:</i> followed by the text of the encrypted message as a hexadecimal string. <br><br><h4>  KDF </h4><br>  The first thing that caught my eye was the unknown <i>KDF function</i> . <br><br>  Key Derivation Function is a function that is used to obtain secret keys from some other secret value for information protection tasks. <br><br>  The most common task for KDF is password hashing.  Where it is necessary to complicate hacking compromised hashes. <br>  update (thanks to <a href="https://habrahabr.ru/users/frol/" class="user_link">frol</a> ): <br>  The task of KDF is to generate a conclusion that is not only difficult to reverse (the task of a hash function), but also satisfies the requirements of randomness of a sequence (this requirement comes from the encryption algorithms with which KDF is used for initialization parameters).  Thus, yes, the most common KDF task is to ‚Äúhash‚Äù passwords, but not for storing in the database (although it is possible already), but for further use of these ‚Äúpasswords‚Äù as input to encryption. <br><br>  Isn't the usual <a href="https://ru.wikipedia.org/wiki/SHA-2">sha-2</a> with salt suitable for backing up hashing, saving and protecting passwords? <br><br>  Here KDF provides better protection for secret keys (such as passwords) than regular cryptographic hash functions.  This is obtained by stretching the key ( <a href="https://en.wikipedia.org/wiki/Key_stretching">key stretching</a> ) and the ability to use different pseudo-random hash functions (pseudo-random hash-function). <br><br>  If password hashes were obtained with ordinary cryptographic functions, like md5, sha256, and others, then dictionary attacks or brute force will happen orders of magnitude faster than if some key retrieval functions (KDF) were used based on the same hash functions general purpose. <br><br>  The thing is that using the key stretching, namely, repeated hashing, allows you to control the difficulty of selecting the hash, the used memory and processor time.  As a result, the repeated complication of hacking results. <br><br>  When legal users need to perform a calculation only once (for example, getting a password hash and comparing with a stored value), then an attacker needs to make billions of such calculations, which, if properly configured, KDF gives almost no chance of success. <br><br><h4>  KDF Types </h4><br>  And now we have dealt with KDF, now we will return to the first hint. <br>  <i>KDF function for use of this generic hash algorithm which has a 32 bytes output.</i> <br><br>  Since KDF normally uses general-purpose cryptographic hash functions as pseudo-random, it is clear that there is some KDF that takes this sentence and uses some common function that returns 32 bytes. <br><br>  What is the nature of the species KDF? <br>  Here is a sample list: <br>  KDF1, KDF2, KDF3, KDF4, MGF1, PBKDF-Schneier, PBKDF1, PBKDF2, bcrypt, scrypt, HKDF. <br><br>  Too much, it would be necessary to exclude the obviously wrong. <br>  After reviewing the description of each function, deleted from the list those that are either outdated and difficult to find implementation, or there is no information about pseudo-random functions. <br><br>  The most modern and up-to-date remained: PBKDF2, bcrypt, scrypt, HKDF. <br><br>  It seemed the most promising challenger was <a href="https://ru.wikipedia.org/wiki/PBKDF2">PBKDF2</a> .  But the input gets, in addition to the hash function, also the salt, the number of iterations and the number of output bytes. <br><br>  Then it turned out that <a href="http://en.wikipedia.org/wiki/Bcrypt">bcrypt</a> always requires salt to enter, and the number of iterations depends on the implementation.  Since we don‚Äôt know anything about the salt from the message, bcrypt leaves the bidders. <br><br>  Then comes <a href="http://en.wikipedia.org/wiki/Scrypt">scrypt</a> - the most crypto-resistant modern KDF, which uses HMAC_SHA256 as a pseudo-random function (which suits us, since the output will be 32 bytes), but also takes the input salt, the number of iterations or computational complexity, block size and paralleling factor. <br><br>  The HMAC-based Extract-and-Expand Key Derivation Function or HKDF also remains. <br><br><h4>  Key search </h4><br>  The second stage of decryption is to understand how to decipher. <br>  The hint says: <i>Encryption algorithm is a KDF output.</i> <br><br>  With the encryption algorithm, everything is clear - this is <a href="https://ru.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> in <a href="http://www.cryptopp.com/wiki/CBC_Mode">CBC</a> encryption mode. <br><br>  For decryption, you need to know in addition to the key and the initialization vector, so what other variant of AES is used, with a block size of 128, 192 or 256 bits. <br><br>  We were given a hint that the key and initialization vector (most likely) is the output of the KDF. <br>  Have you already felt the number of unknown parameters? <br><br>  Here dances begin, because functions such as PBKDF2 or scrypt can return count almost any number of bytes, and HKDF returns, depending on the pseudo-random function. <br><br>  And the calculation complexity parameters for PBKDF2 and scrypt are unknown, and the salt is also unknown.  And it is unclear what is the size of the AES key and what is the size of the initialization vector. <br><br>  Fortunately, it turned out that the size of this vector should coincide with the size of the block.  For example, for rijndael-128 (rijndael is another name of AES) - the block size is 128 bits or 16 bytes.  Therefore, in this embodiment, the size of the initialization vector must be exactly 16 bytes. <br><br>  It also turned out that the key cannot be greater than 32 bytes. <br><br><h4>  Decryption </h4><br>  Now you can proceed to the decoding itself. <br>  And now it is clear that we need to take the result of the KDF, from 0 to 32 bytes is the key, and then, depending on the AES version, the initialization vector: 16, 24 or 32 bytes. <br><br>  It turns out that the size of the result of the KDF should be no more than 64 bytes to accommodate 32 bytes of the key and 32 bytes of the initialization vector. <br><br>  After checking on the basic parameters: empty salt, simple coefficients (ones), the result could not be obtained. <br>  So I had to start to panic. <br><br><h4>  Panic </h4><br>  For PBKDF2, only one parameter was moved - encryption iterations, but with empty salt (since it was not clear where to get this salt). <br>  Three parameters were scrolled for scrypt at once: block size, paralleling factor and complexity. <br><br>  Despite the fact that the key and initialization vector were also selected, no results appeared. <br><br>  I began to look at the hash-based message authentication code ( <a href="https://ru.wikipedia.org/wiki/HMAC">HMAC</a> ) options hashes, but everywhere it was said that it is used as a pseudo-random function, and not as a KDF. <br>  But, having tried all the options with HMAC, I did not get a result. <br><br><h4>  Light at the end </h4><br>  In one of the scrypt papers, I discovered that just KDFs could be used as general purpose hash functions that were not specifically designed to be keyed, which is of course bad practice. <br><br>  Understanding that there can be no difficult answer in such rebuses, we must try to find the most suitable and simple option.  Therefore, I decided to go through all 32 byte general-purpose hash functions, without any KDF, and just try to get the key and initialization vector from the result. <br><br>  And it turned out that using rijndael-128 (16 bytes is the size of a vector and a block), the sha256 hash function, the result of which 32 bytes was divided into a key of 16 bytes, and the remaining 16 bytes per initialization vector, turned out to decrypt the original message.  In which it was simply proposed to send a letter to a specific address. <br><br>  With one hand I type, I wipe the other with tears.  Everything turned out to be much simpler than was seen at first. </div><p>Source: <a href="https://habr.com/ru/post/259199/">https://habr.com/ru/post/259199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259189/index.html">The implementation of one of the variants of the mobile version of the site</a></li>
<li><a href="../259191/index.html">Sudden sofa of a leopard coloring</a></li>
<li><a href="../259193/index.html">Qucs project news: preparing for release 0.0.19</a></li>
<li><a href="../259195/index.html">The digest of interesting materials for the mobile # 105 developer (on May 25-31)</a></li>
<li><a href="../259197/index.html">What do we know about MODX 3 at the moment?</a></li>
<li><a href="../259201/index.html">MailChimp UX team: Improvements and iterations [the final part of the book]</a></li>
<li><a href="../259203/index.html">Sensors and microcontrollers. Part 2. Climate control</a></li>
<li><a href="../259205/index.html">Real-time debugging via JTAG / SWJ-DP for ARM Cortex-M microcontrollers</a></li>
<li><a href="../259207/index.html">The digest of interesting materials from the world of web development and IT for the last week? 162 (May 15 - 31, 2015)</a></li>
<li><a href="../259209/index.html">Comparison of PHP7 and Hack type systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>