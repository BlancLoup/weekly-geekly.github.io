<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Console to the masses. Go to the bright side. Part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 For quite a long time, I used screen in my work. But over time, he stopped me to arrange. I started looking for alternatives. This alte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Console to the masses. Go to the bright side. Part two</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4e4/b82/fed/4e4b82fed6d0405dbb58445fa79c7165.jpg" alt="tmux example"><br><br><h2>  Introduction </h2><br>  For quite a long time, I used screen in my work.  But over time, he stopped me to arrange.  I started looking for alternatives.  This alternative is tmux.  On many portals it is described like this: "This is the same screen, only on steroids."  At first I could not understand why such a comparison has not yet tried.  Frankly, I did not go to him the first time.  Three or four times I tried, I returned to the screen.  But tmux still won. <br><a name="habracut"></a><br>  <b>An important point.</b>  I received quite a few comments on the previous <a href="https://habrahabr.ru/post/317534/">article</a> with alternatives to screen and tmux.  Here, as they say, the taste and color of pencils are different.  The second point that I wanted to draw attention to is that the reader does not have access to the graphical shell.  All that is in his arsenal is a terminal ( <a href="https://goo.gl/5nxyuX">CLI</a> ) and a set of commands that he can use. <br><br><h2>  Installation </h2><br>  Well, let's move on to the tmux installation.  It is enough to execute the first command to install it.  After that you can start it by typing the <code>tmux</code> command in the terminal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="oembed"><script type="text/javascript" src="https://gist.github.com/d461580168f96a1ff8ca62d24aba305c.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist42975695" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-install-tmux" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-text ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-install-tmux-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-install-tmux-LC1" class="blob-code blob-code-inner js-file-line">sudo apt-get install tmux</td>
      </tr>
      <tr>
        <td id="file-install-tmux-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-install-tmux-LC2" class="blob-code blob-code-inner js-file-line">tmux</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">install tmux</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div>  For more experienced users, it is possible to collect tmux from the <a href="https://github.com/tmux/tmux">repository</a> or download the archive to your computer.  How to do this is described <a href="https://raw.githubusercontent.com/tmux/tmux/master/README">here</a> . <br><br><h2>  Basic shortcut keys </h2><br>  Here, as in the case of screen, I will add only a <a href="">link</a> .  Then we take and begin to use.  Memorizing, remembering is not necessary.  The only nuance, the key combinations are different, but this can be easily corrected through the settings file. <br><br><h2>  Settings </h2><br>  By default, tmux, as they say, "from the box", is set up quite qualitatively.  You do not need to adjust the position of the tabbed panel, what color to highlight them, and other settings, as it was in the screen.  But if suddenly you need a configuration file, then take note: it should be called <code>.tmux.conf</code> ;  put it in the user's home directory. <br><br>  I want to share a useful setting, without which I had to re-create a tmux session.  I will describe it in more detail.  I have a working machine running Windows.  To connect to a remote server, use <a href="http://www.putty.org/">putty</a> and pagent (to add keys).  When you add a key to the pagent, you need to enter a password (passphrase - you specify it when creating ssh keys).  In the putty for each compound this checkbox is set: <br><br><img src="https://habrastorage.org/files/dbd/22b/c4c/dbd22bc4c2f64c48943cdaeb269ec828.jpg" alt="PuTTY Configuration ssh" align="left">  Such features of windows + putty + remote connection via ssh.  This checkbox is required for SSH-agent forwarding to work. <br><br>  So, back to the problem.  If you suddenly lost contact with the network or in the office suddenly turned off the electricity, then tmux, of course, will save the session.  And when you reconnect to this session, politely ask you to enter a password for the key.  So it will be every time.  Those.  SSH-agent forwarding will stop working.  This can be corrected if you terminate the current tmux session and reconnect to the remote server.  On the one hand, this is not so critical. <br><br clear="left">  But over time, this problem gives quite a lot of inconvenience and I want to solve it once and for all.  To solve this problem, add the settings to the <code>.bashrc</code> , which is located in the user's home directory: <br><br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/a1b7b506572084e9b98e549745683fb5.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist42986240" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-ssh_auth_sock-sh" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-shell ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-ssh_auth_sock-sh-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-ssh_auth_sock-sh-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">#</span> Making SSH_AUTH_SOCK work between detaches in tmux/screen</span></td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-ssh_auth_sock-sh-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> [[ <span class="pl-k">!</span> <span class="pl-k">-z</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$SSH_AUTH_SOCK</span><span class="pl-pds">"</span></span> <span class="pl-k">-a</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$SSH_AUTH_SOCK</span><span class="pl-pds">"</span></span> <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$HOME</span>/agent_sock<span class="pl-pds">"</span></span> ]]</td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-ssh_auth_sock-sh-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-k">then</span></td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-ssh_auth_sock-sh-LC4" class="blob-code blob-code-inner js-file-line">   unlink <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$HOME</span>/agent_sock<span class="pl-pds">"</span></span> <span class="pl-k">2&gt;</span>/dev/null</td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-ssh_auth_sock-sh-LC5" class="blob-code blob-code-inner js-file-line">   ln -s <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$SSH_AUTH_SOCK</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$HOME</span>/agent_sock<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-ssh_auth_sock-sh-LC6" class="blob-code blob-code-inner js-file-line">   <span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">export</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SSH_AUTH_SOCK = </font></font><span class="pl-s"><span class="pl-pds"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font></span><span class="pl-smi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ HOME</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / agent_sock </font></font><span class="pl-pds"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"</font></font></span></span></td>
      </tr>
      <tr>
        <td id="file-ssh_auth_sock-sh-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-ssh_auth_sock-sh-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fi</font></font></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view raw </font></font></a>
        <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH_AUTH_SOCK.sh</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
        hosted with ‚ù§ by </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a>
      </div>
    </div>
</div>
</div>  Let me try to describe what happens when you connect to a remote server with SSH-agent forwarding enabled.  When an ssh client (in this case, putty), with SSH-agent forwarding enabled, connects to the server, it creates a socket through which this key can be obtained.  It also creates the <code>$SSH_AUTH_SOCK</code> variable, which refers to this socket.  This variable is inherited by the running shell (the shell that processes user commands) within the current session.  In addition to this variable, several more variables are created: <code>$SSH_CLIENT, $SSH_CONNECTION, $SSH_TTY</code> , in which information about the current ssh connection is stored.  When the connection is broken, the terminal manager, in this case tmux, will save the session with the old values ‚Äã‚Äãof these variables.  And when we reconnect to the remote server, a new socket with new values ‚Äã‚Äãwill be created.  But they will not fall into the old session of the terminal manager.  Therefore, we need to make it clear to the shell that we want it to save these values ‚Äã‚Äãand use them when reconnecting, if any. <br><br><h2>  tmux in action </h2><br>  It's time to check tmux at work.  We already know how to run it.  Enough to type <code>tmux</code> . <br><br><img src="https://habrastorage.org/files/c33/ae0/c14/c33ae0c14b2b4ecaad7b3ddfe90375f5.jpg" alt="tmux first start example"><br><br><ol><li>  Workspace.  Panel (pane - from the documentation for tmux). </li><li>  Status bar.  It contains tabs and other elements. </li><li>  Tab with the default name. </li></ol><br>  We looked at the initial tmux state.  If you read the previous <a href="https://habrahabr.ru/post/317534/">article</a> , you might have noticed that the initial state, and indeed the appearance of tmux, is not very different from the screen.  Except that the status bar is available to us initially.  Let's now look at tmux using a more complex example. <br><br><img src="https://habrastorage.org/files/0c4/fc6/aa9/0c4fc6aa94fa428094a7b25cfd351a4a.jpg"><br><br>  For this we need a <a href="https://github.com/var-bin/terminalForCoder__WSD">repository</a> .  If you have not cloned it to your computer, then run the following command: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/var-bin/terminalForCoder__WSD.git</code> </pre> <br>  Next, run tmux.  To get started, let's work with tabs.  We will need 2-3 tabs.  To create a new tab, you need to press the following keyboard shortcuts: <br><br><pre> <code class="bash hljs">Ctrl + b, c -   </code> </pre> <br>  The next step is to rename the tabs.  To do this, use: <br><br><pre> <code class="bash hljs">Ctrl + b, , -  </code> </pre> <br>  To switch between tabs, use these keys: <br><br><pre> <code class="bash hljs">Ctrl + b, int -     (int -   0 - 9)</code> </pre> <br>  Or <br><br><pre> <code class="bash hljs">Ctrl + b, w -   </code> </pre> <br>  Tabbed a little practice.  Now let's break our current panel into two independent panels.  Please note that this layout will not be saved for all other tabs.  For each tab tmux creates its own independent layout.  This is done using the keyboard shortcut: <br><br><pre> <code class="bash hljs">Ctrl + b, % -        </code> </pre> <br>  Now let's run in the panel on the left, some kind of utility.  For example, <a href="https://www.midnight-commander.org/">midnight commander</a> (any other utility) with the command: <br><br><pre> <code class="bash hljs">mc</code> </pre> <br>  To move between panels, use these keyboard shortcuts: <br><br><pre> <code class="bash hljs">Ctrl + b, ‚Üê ‚Üë ‚Üí ‚Üì -   </code> </pre> <br>  And in the panel on the right, run our test application.  This is a simple chat written in <a href="https://nodejs.org/">node.js</a> and <a href="http://socket.io/">socket.io</a> .  This example is taken from the official site of socket.io.  The only thing I added is a bit of logging so that we can see that it works.  To do this, go to the directory <code>%repoName%/tmux/chat-example</code> .  And execute commands: <br><br><pre> <code class="bash hljs">npm i node index.js</code> </pre> <br>  <code>%repoName%</code> is the name of the directory into which it was cloned by the repository. <br><br>  If all is well, then you should see the line on the screen: <br><br><pre> <code class="bash hljs">listening on localhost:3000</code> </pre> <br>  After that launch the browser and in the new tab go to <code>localhost:3000</code> .  Type any message in the input line and press <code>Enter</code> .  As you can see, everything works and you can read this message also in the terminal.  In the region where the <code>node index.js</code> command was <code>node index.js</code> . <br><br><img src="https://habrastorage.org/files/25a/50e/4c5/25a50e4c5e1844478389cb3a399e7c40.jpg" alt="example tmux with node.js, socket.io, mc"><br><br>  And now it's time to do what we did in the previous article.  We simulate a communication break.  It is necessary to close the terminal through the cross.  But do not close the browser.  And try to send some more messages.  Everything continues to work.  This is despite the fact that we have just closed the terminal. <br><br><img src="https://habrastorage.org/files/13b/74b/c1d/13b74bc1da72421c956abd3e246de8a5.jpg" alt="example tmux.  Chat is still working"><br><br>  The session and all processes that were started tmux saved.  As we know from the previous article, screen also knows how to do that.  Let's connect back to the tmux session.  Start the terminal and execute the command: <br><br><pre> <code class="bash hljs">tmux attach</code> </pre> <br><img src="https://habrastorage.org/files/95b/877/889/95b8778897ea4200b833fa8bce404082.jpg" alt="example tmux.  tmux attach"><br><br>  As you can see, the layout we created earlier (panel layout vertically) was saved by tmux.  This is a huge plus compared to the same screen. <br><br><h2>  useful links </h2><br><ol><li>  <a href="https://gist.github.com/MohamedAlaa/2961058">Good cheat sheet by tmux</a> </li><li>  <a href="https://habrahabr.ru/post/126996/">A good cheat sheet for tmux (habr version)</a> </li><li>  <a href="https://tmux.github.io/">Tmux official website</a> </li><li>  <code>man tmux</code> =) </li></ol><br><h2>  screen vs.  tmux </h2><br>  It's time to compare screen and tmux.  During my work with both screen and tmux (about 2.5 years), I came to the conclusion that if you should use screen, then only if tmux is not available to you.  Those.  if you can't install tmux yourself or build it from source.  In all other cases, it is better to start immediately with tmux. <br><table><thead><tr><td align="center">  <b>screen</b> </td><td align="center">  <b>tmux</b> </td></tr></thead><tbody><tr><td>  <code>-</code> Cannot create layout for each tab <br>  <code>-</code> Does not know how to save the layout, if the connection is broken or something else <br>  <code>-</code> Up to version 4.1, could not do vertical breakdown <br>  <code>-</code> When you have created a new region, then you need to create a new window separately <code>(Ctrl+a, c)</code> , go to the desired directory, etc. <br>  <code>-</code> To remove a region, you also need to torture <code>Ctrl+a, :remove</code> ,: <code>Ctrl+a, :remove</code> <br></td><td>  <code>+</code> "From the box" is set fairly high quality <br>  <code>+</code> No need to adjust the position of the tabbed pane, how to highlight them. <br>  <code>+</code> Able to divide the screen into panels, both vertically and horizontally <br>  <code>+</code> To close the panel, just type <code>exit</code> <br>  <code>+</code> Able to keep remote connection <code>*</code> <br><br><blockquote>  * need extra magic <br></blockquote><br></td></tr></tbody></table>  Let's summarize.  We reviewed another one of the terminal managers, namely tmux.  Practiced in the installation, configuration.  Used some hotkeys.  We tried tmux with an example.  Saw its advantages in comparison with the same screen. <br><br>  In addition to screen and tmux, there is a fairly wide choice of terminal managers for different operating systems, your personal preferences and wishes. <br><br>  That's all.  Thanks for attention.  Who read to the end, special thanks.  See you in the next article. </div><p>Source: <a href="https://habr.com/ru/post/318376/">https://habr.com/ru/post/318376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318366/index.html">Creating an editor quests and dialogues for the Unreal engine, Part 1 plugin description</a></li>
<li><a href="../318368/index.html">MiniATS at home</a></li>
<li><a href="../318370/index.html">Office 2 - Search Approach</a></li>
<li><a href="../318372/index.html">VulnHub: Parsing the DC416 by Dick Dastardly</a></li>
<li><a href="../318374/index.html">Competitiveness: Parallelism</a></li>
<li><a href="../318380/index.html">Family business in IT. How we sold our startup</a></li>
<li><a href="../318384/index.html">Experience in porting a project to Python 3</a></li>
<li><a href="../318386/index.html">Creating an editor quest and dialogs for the Unreal engine: Part 2 technical aspects</a></li>
<li><a href="../318388/index.html">Backup network spheres (samba) in Linux based on Windows Server Backup</a></li>
<li><a href="../318390/index.html">How to talk with assholes. 7 strategies for communicating with inappropriate people</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>