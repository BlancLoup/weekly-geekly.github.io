<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>File system steganography</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 


 I want to introduce you to a small project on steganography , made in free time from school. 


 I made a project on the hidden storage ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>File system steganography</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr. </p><br><p>  I want to introduce you to a small project on <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25B3%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%258F">steganography</a> , made in free time from school. </p><br><p>  I made a project on the hidden storage of information in the file system (hereinafter <strong>FS</strong> ). <br>  It can be applied <del>  to steal confidential information </del>  for educational purposes. </p><br><p><img src="https://habrastorage.org/webt/_v/p6/6-/_vp66-b4brnsakckv8lcj6qbaby.jpeg" alt="Image"></p><br><p>  In the form of a prototype, a very old Linux <a href="https://ru.wikipedia.org/wiki/Ext2">ext2</a> FS was chosen. </p><br><a name="habracut"></a><br><h3 id="realizaciya">  Implementation </h3><br><h4 id="soobrazheniya-o-realizacii">  Implementation Considerations </h4><br><p>  If the ext2 standard is good, then you can replace that there is a so-called <a href="http://www.nongnu.org/ext2-doc/ext2.html"><strong>Superblocks</strong></a> in the file system, which contains basic information about the system.  After me, <a href="http://www.nongnu.org/ext2-doc/ext2.html"><strong>Block Bitmap</strong></a> and <a href="http://www.nongnu.org/ext2-doc/ext2.html"><strong>Inode Table</strong></a> were found.  Almost immediately the idea of ‚Äã‚Äãrecording information in currently empty FS blocks was born.  Now it was worth thinking about protection from a programmer armed with a <a href="https://ru.wikipedia.org/wiki/Hex-%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580">hex editor</a> . </p><br><p>  If you store the hidden information without encryption, then, despite its blurring by the file system, it will still be too striking, especially if the programmer knows what to look for.  Therefore, it was decided to encrypt all blocks of the source file.  I chose the <a href="https://ru.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> block cipher, but as you know, it doesn‚Äôt matter. </p><br><p>  To separate the necessary blocks from all the others, it was decided to add a special marker to the beginning of the block in each block when reading.  This token was encrypted depending on the block number in the source file.  This trick immediately allowed not only to find the necessary blocks, but also to recognize their correct order. </p><br><p>  The general principle of the system. </p><br><p><img src="https://habrastorage.org/webt/6w/kg/gm/6wkggm-6rqw52anugx2yi1_t42m.gif" alt="image"></p><br><h4 id="algoritm-zapisi">  Write algorithm </h4><br><p>  The points: </p><br><ul><li>  First write any information to the original file system; </li><li>  Delete this information (not necessarily all); </li><li>  The file for hiding is divided into blocks of the same length by adding a marker; </li><li>  Encrypt these blocks; </li><li>  Place encrypted blocks in empty FS blocks. </li></ul><br><div class="spoiler">  <b class="spoiler_title">For lovers of flowcharts</b> <div class="spoiler_text"><p>  Below is a flowchart of the recording algorithm.  The algorithm receives four files as input: <br>  - Image of a variable file system; <br>  - File subject to steganography; <br>  -File encryption file for AES; <br>  -File with a marker. <br><img src="https://habrastorage.org/webt/si/y_/kt/siy_ktinclphi8noi_826hmicuy.png" alt="image"></p></div></div><br><p>  Immediately it should be noted that this algorithm has one drawback: after writing a file to the file system, <strong>you cannot</strong> write anything new to the file system, since any new information can get into those blocks that we assigned to our zip file, however, this also opens up "Fast sweeping tracks." </p><br><p>  But it is quite obvious how this can be fixed: it is necessary to rewrite the algorithm for writing blocks in a file system.  This is an understandable, but incredibly time consuming task. <br>  For Proof Of Consept, I did not implement it. </p><br><p>  The result is the following changes in the FS, this is how the FS looks like before steganography (the audio file was previously recorded). <br><img src="https://habrastorage.org/webt/vy/kz/iz/vykzizdfhfacz2ypiordid4w0qa.png" alt="image"><br>  And this is what a file system looks like with already zasteganograph information. <br><img src="https://habrastorage.org/webt/17/dn/ld/17dnldpq7mkel66hz0b640ckgn4.png" alt="image"></p><br><h4 id="algoritm-chteniya">  Reading algorithm </h4><br><p>  The points: </p><br><ul><li>  With the knowledge of the key and the method of constructing the markers, compile the first N markers, with the guarantee that N multiplied by the file system block length is longer than the zip file; </li><li>  Search for blocks in FS, starting with markers; </li><li>  Decrypt the received blocks and separate the markers; </li><li>  Collect the received blocks in the correct order and get the source file. </li></ul><br><div class="spoiler">  <b class="spoiler_title">For lovers of flowcharts</b> <div class="spoiler_text"><p>  Below is a flowchart of the recording algorithm.  The algorithm receives three files as input: <br>  - Image file system; <br>  -File encryption file for AES; <br>  -File with a marker. <br><img src="https://habrastorage.org/webt/vm/lx/ko/vmlxkom-qho9f5zw2jzim7ogfdg.png" alt="image"></p></div></div><br><p>  After the program has been running, the Read file appears, which will be the file extracted from the steganographized FS, if the key or token was entered incorrectly, then the Read file will be empty. <br>  (for lovers of beautiful things, you can intersperse not only a file, but a "header" containing meta information: the name of the file, the rights, the last modification time, etc.) </p><br><h4 id="avtomatizaciya-zapuska">  Startup automation </h4><br><p>  For convenience, bash scripts have been written that automate Linux launches (tested on Ubuntu 16.04.3 LTS). <br>  Let's sort start in steps. <br>  Record: </p><br><ol><li>  sudo Copy_Flash.sh ‚ÄúDEVICE‚Äù - we get the image of FS from DEVICE (flash); </li><li>  ./Write.sh ‚ÄúFILE‚Äù ‚ÄúKEY‚Äù ‚ÄúMARKER‚Äù - create a virtual environment, download the necessary libraries and start writing to skip; </li><li>  sudo ./Write_Flash.sh ‚ÄúDEVICE‚Äù - write the changed filesystem to DEVICE again. </li></ol><br><p>  Reading: </p><br><ol><li>  sudo Copy_Flash.sh ‚ÄúDEVICE‚Äù - we get the image of FS from DEVICE (flash); </li><li>  ./Read.sh ‚ÄúKEY‚Äù 'MARKER ‚Äù- create a virtual environment, download the necessary libraries and run the skipt for reading; </li><li>  In the current directory, open the Read file - this is the zip code. </li></ol><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  This method of steganography probably needs further work, additional testing and expansion to more popular file systems, such as <a href="https://ru.wikipedia.org/wiki/FAT32">Fat32</a> , <a href="https://ru.wikipedia.org/wiki/NTFS">NTFS</a> and <a href="https://ru.wikipedia.org/wiki/Ext4">ext4</a> . <br>  But the purpose of this work was to show the principle by which it is possible to carry out the hidden storage of information in the file system. <br>  Using such algorithms, one can safely store information, and if, with knowledge of the key, such a system can be hacked without a complete search (but a very long algorithm), then without knowing the key, this system seems to me absolutely stable, however this may be the reason for a separate article. </p><br><p>  All code is implemented in Python version 3.5.2.  <a href="https://youtu.be/FEAE3_xDKkA">An example of work</a> is presented on my youtube channel.  The full code of the project is laid out on <a href="https://github.com/MalahovMV/Ext2Stego">github</a> . <br>  (Yes, yes, I know that for the production version you need to write on something "fast", for example in C;)) <br>  In this implementation, the size of the input file for steganography should not exceed 1000 KB. </p><br><p>  I want to thank the <a href="https://habrahabr.ru/users/pavelmstu/" class="user_link">PavelMSTU</a> user for valuable advice when planning a study and recommendations on the design of the article. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/347604/">https://habr.com/ru/post/347604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347592/index.html">Telegram bot for complex quests</a></li>
<li><a href="../347594/index.html">Beautiful Chromium and gnarled memset</a></li>
<li><a href="../347596/index.html">The evolution of x86 architecture system calls</a></li>
<li><a href="../347598/index.html">Legal aspects of domain space</a></li>
<li><a href="../347600/index.html">Friday format: ‚Äúlanguage development‚Äù - research that combines IT and linguistics</a></li>
<li><a href="../347606/index.html">Dynamic email :: practical use</a></li>
<li><a href="../347608/index.html">Report from the last Christmas Agile MeetUp</a></li>
<li><a href="../347610/index.html">How to write clean and beautiful code</a></li>
<li><a href="../347612/index.html">MOSDROID # 5 Boron in Tutu.ru office</a></li>
<li><a href="../347616/index.html">Disassembling .xlsx files: string values, cell markup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>