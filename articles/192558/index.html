<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SATA controller, blurred photography and competition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few days ago, an English-speaking user registered with the nickname mdickie registered on the KolibriOS forum and complained that the mouse does not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SATA controller, blurred photography and competition</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/d39/571/e66/d39571e660756db08bd8976ed61b3145.gif" align="left">  A few days ago, an English-speaking user registered with the nickname <a href="http://board.kolibrios.org/memberlist.php%3Fmode%3Dviewprofile%26u%3D5900">mdickie</a> registered on the <a href="http://board.kolibrios.org/"><b>KolibriOS</b> forum</a> and complained that the mouse does not work on his Dell Latitude C640 laptop: <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">board.kolibrios.org/viewtopic.php?f=4&amp;t=2389</a> .  Since we <a href="http://habrahabr.ru/company/kolibrios/blog/181309/">recently had USB support</a> (in particular, USB mice), our founder <a href="http://habrahabr.ru/users/mario_z/" class="user_link">Mario_Z</a> logically suggested that <b>mdickie is</b> using some old version, and advised him to <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">download the latest nightly build and check on it</a> . <br><br>  The assumption of <a href="http://habrahabr.ru/users/mario_z/" class="user_link">Mario_Z</a> turned out to be true - the mouse worked in the nightly build, <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">but something else broke</a> : <blockquote>  It works with the latest build, <br>  Thanks <br>  <b>EDIT: It freezes slower.</b> </blockquote>  Unfortunately, the user was laconic ( <a href="http://habrahabr.ru/company/kolibrios/blog/182170/">or English is not his native language</a> ), so for some time <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">we found out exactly what was wrong</a> by asking leading questions until the picture cleared: <blockquote>  Needs to freeze the mouse. <br>  Oh yes, the whole system freezes.  The Keyboard and the clock are not working. </blockquote>  Here, I already <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">guessed</a> that the cause of the hangup is most likely the <b>SATA IDE</b> driver, which is currently developing <a href="http://habrahabr.ru/users/mario_z/" class="user_link">Mario_Z</a> .  At the moment, <b>KolibriOS</b> has a native driver only for the <b>PATA</b> controller, and support for the <b>SATA</b> controller in <b>IDE</b> mode is only through the BIOS, which introduces 2 limitations: <br><ol><li>  Access to disks through the ‚Äúcrutch‚Äù BIOS is very slow, so the movie from such a disk in KolibriOS does not look - it will go jerky.  The speed of copying files is also unacceptable - you can have lunch while a large file is being copied. </li><li>  Some disks without a driver are not visible at all in the system. </li></ol><br>  In view of this, at the moment we are writing 2 <b>SATA</b> drivers (in parallel): <br><ul><li>  Driver for <b>SATA</b> controller in <b>IDE</b> mode from <a href="http://habrahabr.ru/users/mario_z/" class="user_link">Mario_Z</a> : <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D1%26t%3D2343">board.kolibrios.org/viewtopic.php?f=1&amp;t=2343</a> </li><li>  Driver for <b>SATA</b> controller in <b>AHCI mode</b> from <b>Serge</b> : <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D31%26t%3D2152">board.kolibrios.org/viewtopic.php?f=31&amp;t=2152</a> </li></ul><br>  Both drivers have one unpleasant feature - hang the system tightly in case of any abnormal situation - and then you need logs to see the configuration of the disks and try to find out the cause of the hang.  This is exactly what happened in <b>mdickie</b> , and therefore I asked him to attach logs.  Naturally, if the entire system hangs, copying the logs directly from <b>KolibriOS</b> to a text file will not work, and in such cases we ask to take a picture of the log from the monitor screen to a smartphone or camera, and upload the photo on our forum.  And here we go to the second part of the article. <a name="habracut"></a><br><br>  To write a log to a text file (like <a href="http://en.wikipedia.org/wiki/Dmesg">dmesg</a> in <b>Linux</b> ) we have the utility <b>BOARD</b> , which also displays the last few lines of the log in its window.  When the system hangs, the visible part of the log is usually not enough, and copying the entire file is not possible, as I said above.  It remains only to duplicate the entire log to the screen, and then photograph it, and for such purposes we have an option on the start screen: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage3/654/ec6/5f8/654ec65f868cc6f9e999ac911c72197c.png"><br><br>  <a href="http://habrahabr.ru/users/clevermouse/" class="user_link">CleverMouse</a> wrote the functionality for duplicating the log to the screen, but I can be proud that my assembly language knowledge was enough to arrange this functionality as an option for the start screen <b>*</b> (before that, manual recompilation of the <b>KolibriOS</b> kernel was required to enable or disable this functionality often too difficult for new project users. <br><br>  <b>*</b> We often informally call this screen " <i>blue screen</i> " by analogy with <b>Windows</b> , but, naturally, our starting screen does not have any connection with the <b>BSOD</b> ( <i>" <a href="http://en.wikipedia.org/wiki/Blue_Screen_of_Death">Blue Screen of Death</a> " / " <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25B9_%25D1%258D%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BD_%25D1%2581%25D0%25BC%25D0%25B5%25D1%2580%25D1%2582%25D0%25B8">Blue Screen of Death</a> "</i> ) (except for color).  Even more likely, it is the exact opposite of the blue screen of <b>Windows</b> - there the blue screen heralds the ‚Äúend of life‚Äù, and in our case the contrary is about the beginning :-) <br><br>  So, I asked <b>mdickie</b> <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">to enable option C on the ‚Äúblue screen‚Äù and attach the resulting log</a> .  What he did, only <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">instead of a photo, he rewrote the text manually</a> : <blockquote>  ========= tmpdisk 0.45 ======== <br>  trying to add disk <br>  10% of free RAM will be used, new Disksize: 50MB <br>  operation completed successfully <br>  K: Attach Interrupt 11 Handler 80BA2F04 </blockquote>  Unfortunately, his answer could not help us, although the result was quite expected.  The fact is that the log is displayed on the screen, but simultaneously with the drawing of other programs (for example, ‚Äúicons‚Äù), and if the draw event occurs after the log output event (as it was in our case), then part of the log is simply erased in video memory, since other images are drawn on top of it (in the file, of course, the entire log is saved, but the file cannot be pulled out, as mentioned above). <br><br>  Since I myself have already encountered a similar problem repeatedly, I found a solution - disabling the launch of all programs except the kernel is not guaranteed to erase the log on the screen.  <b>KolibriOS</b> has its own <b>Windows</b> autoloader equivalent, or /etc/init.d <b>Linux</b> : after booting the kernel, it launches the <b>LAUNCHER</b> program, which reads one line from the <a href="http://websvn.kolibrios.org/filedetails.php%3Frepname%3DKolibri%2BOS%26path%3D%252Fdata%252Feng%252Fautorun.dat">AUTORUN.DAT</a> file and runs the programs registered there (with optional parameters).  Moreover, in <b>KolibriOS,</b> both the desktop itself, and the icons, and the background image are run from <a href="http://websvn.kolibrios.org/filedetails.php%3Frepname%3DKolibri%2BOS%26path%3D%252Fdata%252Feng%252Fautorun.dat">AUTORUN.DAT</a> , and are not part of the kernel.  Thus, all that was needed was to add the ability to turn off the <b>LAUNCHER</b> call after the kernel was loaded on the start screen.  Inspired by the fact that I was able to add the option of duplicating the log to the screen, I added the option to disable <b>LAUNCHER</b> (under the letter <b>D</b> in the photo of the blue screen above). <br><br>  Therefore, I asked the user to <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">simultaneously enable log duplication on the screen and disable the LAUNCHER boot</a> : <blockquote>  Unfortunately it will not help us. <br><br>  Please <b>turn <u>on</u> option C on blue screen</b> .  This will boot KolibriOS without displaying the debug log.  Please try to make a photo this time.  I don‚Äôt worry about it.  It wouldn‚Äôt get them to be stuck. </blockquote> This request was finally crowned with success - we were presented with a <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">photo of the full log</a> (below I give it in a reduced size): <br><br><img src="https://habrastorage.org/storage3/bf6/a06/ae7/bf6a06ae74d912eef2cc03cf64affa31.jpg"><br><br>  The user warned me that the photo looks bad, but I wrote to him arrogantly (translated from English above): " <i>Do not be afraid about the small print - we can disassemble it</i> ."  Looking at the photo, I realized that I underestimated the user's ability to make bad photos (or overestimated his ability to disassemble them) - the photo was specifically ‚Äúblurred‚Äù, so it was almost impossible to disassemble something.  I <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389%26start%3D15">advised the user how to try to solve the hang problem</a> (and get a text log, instead of a blurred photo), but he seemed to be tired of it, and he <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389%26start%3D15">decided to wait until KolibriOS becomes more stable</a> . <br><br>  So, it was not necessary to expect to receive any more information from this user, and the hang problem is very desirable to solve (but for this you need to get a clear photo of the log).  And then I remembered the program for recovering blurred images (the author <a href="http://habrahabr.ru/post/175717/">even</a> <a href="http://habrahabr.ru/post/180393/">advertised</a> one of them, <a href="http://smartdeblur.net/">SmartDeblur</a> , several times on Habr√©). <br><br>  I downloaded for trial 2 versions of <b>SmartDeblur</b> (the last free and last paid trial version), as well as the <b>Blurity</b> program found on the Internet that openly considers itself better than <b>SmartDeblur</b> in <a href="https://www.blurity.com/features">the comparison section</a> : <br><ul><li>  SmartDeblur v.1.27: <a href="https://github.com/Y-Vladimir/SmartDeblur">github.com/Y-Vladimir/SmartDeblur</a> </li><li>  SmartDeblur v.2.2: <a href="http://smartdeblur.net/download.html">smartdeblur.net/download.html</a> </li><li>  Blurity v1.5.171: <a href="https://www.blurity.com/download">www.blurity.com/download</a> </li></ul><br>  Having played with the manual settings and using the automatic improvement method where it was, I could not get a normal result.  The best photo that I had was obtained using manual adjustment in <b>SmartDeblur v.2.2</b> with the following parameters: <br><br><img src="https://habrastorage.org/storage3/b51/53c/6d0/b5153c6d0eead702bcce5afd3c13c8d4.png"><br><br>  The result is shown in the photo below (you can open the photo in a new window using PCM, and then it will open in its original size).  I don‚Äôt know whether my hands are completely crooked, or all these programs in their advertisements / on the site use specially made test photos that are well restored, or this photo is from the discharge of those that no existing program can restore It cannot, but the fact remains: I could not get a good result. <br><br>  <u><b>UPDATE:</b></u> <a href="http://habrahabr.ru/users/yuvladimir/" class="user_link">YUVladimir</a> (author of the <b>SmartDeblur</b> program) <b>explains</b> in the comments why all programs give poor quality: <a href="http://habrahabr.ru/company/kolibrios/blog/192558/">habrahabr.ru/company/kolibrios/blog/192558/#comment_6710828</a> <br><br><img src="https://habrastorage.org/storage3/3c5/dd1/a0c/3c5dd1a0c6f0e7e3dc374ae868383f6e.jpg"><br><br>  Therefore, I decided to announce a contest - any Habr reader can try to improve the <a href="http://board.kolibrios.org/download/file.php%3Fid%3D5109">original</a> blurred <a href="http://board.kolibrios.org/download/file.php%3Fid%3D5109">photo</a> with the help of any blurred image recovery program (it‚Äôs not necessary to use one of the ones I brought - I am sure there are many more).  You can post an improved photo either in the comments to this post, or <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D4%26t%3D2389">on our forum in the original thread</a> , until September 17, 2013 at 24:00 GMT.  To the photo you need to attach the instruction (better screenshot), which program, which version and which settings to use in order to achieve such a result. <br><br>  The top 10 photos, according to the <b>KolibriOS</b> developers, will be put up for voting at Habr√©.  The author of the photo that received the most votes will be awarded with a branded USB flash drive and a <b>KolibriOS</b> t-shirt (including shipment to the address specified by the winner).  Good luck! <br><br>  <b><u>Bonus</u></b> - a prize of 1000 rubles to the one who first correctly tells <a href="http://habrahabr.ru/users/mario_z/" class="user_link">Mario_Z</a> how to solve the hangup problem: <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D1%26t%3D2343%26start%3D120">board.kolibrios.org/viewtopic.php?f=1&amp;t=2343&amp;start=120#p51072</a> (the decision itself is optional; only a hint is sufficient).  Tips can be written both here in the comments and <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D1%26t%3D2343">on our forum</a> . </div><p>Source: <a href="https://habr.com/ru/post/192558/">https://habr.com/ru/post/192558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192544/index.html">HDMI 2.0 specifications released</a></li>
<li><a href="../192546/index.html">[NES] Writing level editor for Prince of Persia. Chapter Four He himself runs! Or a skeleton in the closet</a></li>
<li><a href="../192548/index.html">Hello, Russia!</a></li>
<li><a href="../192554/index.html">Webcast: Dell Converged Network Solutions</a></li>
<li><a href="../192556/index.html">Flex & utf8</a></li>
<li><a href="../192560/index.html">We buy new Kindle and Nexus 4.7 without intermediaries</a></li>
<li><a href="../192562/index.html">Is XMPP protocol obsolete?</a></li>
<li><a href="../192564/index.html">RailsClub'Moscow 2013. Interview with Jeremy Evans (Jeremy Evans)</a></li>
<li><a href="../192566/index.html">For kiberdruzhinnikov created its own social network</a></li>
<li><a href="../192570/index.html">Not an admob th one. Overview of interesting advertising networks and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>