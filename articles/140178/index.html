<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamically adding groups of elements in Zend Framework forms using ZendX_JQuery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is no secret that it is often necessary to add elements or groups of elements to a form, the number of which may be uncertain or large enough to in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamically adding groups of elements in Zend Framework forms using ZendX_JQuery</h1><div class="post__text post__text-html js-mediator-article"> It is no secret that it is often necessary to add elements or groups of elements to a form, the number of which may be uncertain or large enough to indicate them explicitly in the configuration of the form. <br><br>  Also, it is no secret that there is a general approach to solving this issue - adding groups of elements through subforms.  The logic of this approach is simple - in the template, using the javascript, the necessary groups of elements are added to the form, the form handler calculates the number of incoming groups of elements and, according to their number, subforms are added, then the entire form with subforms is validated. <br><br>  For me, the minus of this approach is that it is almost impossible to take out the configuration of the form in a separate place (in a separate configuration file) and it has to be ‚Äúconfigured‚Äù in the form handler. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I propose to solve this issue by creating a separate form element that implements this functionality. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/706/fe1/0da/706fe10da756ba64a41df537c62fd38f.png" alt="image"><br><br>  Let us turn to the practical implementation of this. <br><br><a name="habracut"></a><br><br>  Create a new ZF project <br><br> <code><a href="http://www.multielement.lo/"></a> % zf create project www.multielement.lo</code> <br> <br>  We initialize the View object with jQuery support in the application.ini configuration file, set the path to our helpers, set the versions and paths to the javascript libraries <br><br> <code>resources.view[] = "" <br> resources.view.helperPath.ZendX_JQuery_View_Helper = "ZendX/JQuery/View/Helper" <br> resources.view.helperPath.My_JQuery_View_Helper = "My/JQuery/View/Helper" <br> resources.jquery.version = "1.7" <br></code> <br><br>  Create a FormController in / application / controllers / <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FormController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Controller_Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'elements'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'firstname'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ) ), <span class="hljs-string"><span class="hljs-string">'lastname'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ) ), <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MultiElement'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'elements'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ) ), <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Select'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'multioptions'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'green'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'red'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'blue'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, ) ) ), <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">', .'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ) ), ) ) ), <span class="hljs-string"><span class="hljs-string">'logons'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MultiElement'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'elements'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'login'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ) ), <span class="hljs-string"><span class="hljs-string">'passw'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ) ), <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Select'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'multioptions'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'vk'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'fc'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'FaceBook'</span></span>, <span class="hljs-string"><span class="hljs-string">'tw'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Twitter'</span></span>, ) ) ), ) ) ), <span class="hljs-string"><span class="hljs-string">'submit'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Submit'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ) ), ), ); $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Form(); $form-&gt;addPrefixPath(<span class="hljs-string"><span class="hljs-string">'My_JQuery_Form'</span></span>,<span class="hljs-string"><span class="hljs-string">'My/JQuery/Form'</span></span>); $form-&gt;setOptions($opts); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;isPost()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($form-&gt;isValid(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getPost())) { $values = $form-&gt;getValues(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;assign(<span class="hljs-string"><span class="hljs-string">'MyFormValues'</span></span>,$values); } } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;assign(<span class="hljs-string"><span class="hljs-string">'MyForm'</span></span>,$form-&gt;render()); } }</code> </pre><br><br>  Create a view script in /views/scripts/form/index.phtml <br><br><pre> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"text/html; charset=UTF-8"</span></span> /&gt; &lt;title&gt;   &lt;/title&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;JQuery(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/head&gt; &lt;body <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ui</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">widget</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">&gt;   &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h1</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyForm</span></span></span><span class="hljs-class">; ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFormValues</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;pre&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> print_r(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;MyFormValues); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/pre&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/body&gt; &lt;/html&gt;</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cf/d66/aec/6cfd66aecf40e1effb0bb8821817decd.png" alt="image" align="right"><br><br>  As you can see, the MultiElement element contains the ‚Äúelements‚Äù options section, which is compatible with Zend_Form_Element. <br><br>  The principle of operation of the MultiElement element is as follows: <br><br><ul><li>  For each group of elements, a Zend_Form form is created without the Form and DtDdWrapper decorators. </li><li>  Each element in the group is set by the setElementsBelongTo name of the type element [] [group element] </li><li>  The form is rendered and placed in the options of the MultiElement element for further use in the view helper. </li><li>  The form object is placed in a private property for further use of its cloned instances in the isValid and setValue methods. </li><li>  In the view helper, the rendered form of the group is placed in the js variable and added to the View object via addJavascript </li><li>  A ‚ÄúAdd‚Äù button is created in the view helper and js to handle clicks </li><li>  When you click, the rendered form is inserted from the js-variable, replacing the element names with the element [counter] [group element] </li><li>  In the view helper, the clicked values ‚Äã‚Äãof groups of elements and the groups themselves are also drawn. </li></ul><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">"Zend/Form/Element/Xhtml.php"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">My_JQuery_Form_Element_MultiElement</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Form_Element_Xhtml</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $helper = <span class="hljs-string"><span class="hljs-string">"multiElement"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *         * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $forms = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** *     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Zend_Form */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $form; <span class="hljs-comment"><span class="hljs-comment">/** *     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $renderform = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *        * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $spec * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $options */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($spec, $options = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *          */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($options[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>]) &amp;&amp; is_array($options[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>])) { $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Form(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'elements'</span></span>=&gt;$options[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>])); $form -&gt; removeDecorator(<span class="hljs-string"><span class="hljs-string">'Form'</span></span>); $form -&gt; removeDecorator(<span class="hljs-string"><span class="hljs-string">'DtDdWrapper'</span></span>); $form -&gt; setElementsBelongTo($spec.<span class="hljs-string"><span class="hljs-string">'[]'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;renderform = $form-&gt;render(); <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($options[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;form = $form; } <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($spec, $options); } <span class="hljs-comment"><span class="hljs-comment">/** *   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $value * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> boolean */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_messages = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_errors = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setValue($value); $value = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_array($value) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isRequired()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_messages = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'        '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $result = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_array($value)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key=&gt;$mini_form) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(key_exists($key,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;forms)) { $form = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;forms[$key]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$form-&gt;isValid($mini_form)) $result = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } <span class="hljs-comment"><span class="hljs-comment">/** * Set element value * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $value * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Zend_Form_Element */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_array($value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_value = $value; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $mini_form) { $form = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;form; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;forms[] = $form-&gt;setDefaults($mini_form); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } }</code> </pre><br><br>  As you can see, the required option is supported.  If necessary, the MultiElement element can be expanded by adding processing of additional options, filters and validators. <br><br>  View helper code <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">"ZendX/JQuery/View/Helper/UiWidget.php"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">My_JQuery_View_Helper_MultiElement</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZendX_JQuery_View_Helper_UiWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $id Id HTML- * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $value   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $params     options * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, $value = null, array $params = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *      *    JS */</span></span> $js_var = $id . <span class="hljs-string"><span class="hljs-string">'_subform'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'renderform'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;jquery-&gt;addJavascript(<span class="hljs-string"><span class="hljs-string">'var '</span></span> . $js_var . <span class="hljs-string"><span class="hljs-string">' = '</span></span> . ZendX_JQuery::encodeJson($params[<span class="hljs-string"><span class="hljs-string">'renderform'</span></span>]) . <span class="hljs-string"><span class="hljs-string">';'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> $icon_delete = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;formButton($id . <span class="hljs-string"><span class="hljs-string">'_delete'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);; <span class="hljs-comment"><span class="hljs-comment">/** *          JS */</span></span> $button_id = $id . <span class="hljs-string"><span class="hljs-string">'_add'</span></span>; $button = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;formButton($button_id, <span class="hljs-string"><span class="hljs-string">''</span></span>); $jquery_handler = ZendX_JQuery_View_Helper_JQuery::getJQueryHandler(); $js = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $js[] = sprintf(<span class="hljs-string"><span class="hljs-string">'%s("#%s").next("ul").find("&gt; li").prepend(%s("%s").click(function(){ if(confirm("%s")) %s(this).parent("li").remove(); return false; }));'</span></span>, $jquery_handler, $button_id, $jquery_handler, addslashes($icon_delete), <span class="hljs-string"><span class="hljs-string">'?'</span></span>, $jquery_handler); $js[] = sprintf(<span class="hljs-string"><span class="hljs-string">'%s("#%s").click(function(){ var itr = %s(this).next("ul").find("&gt; li").length-1; var Tmpl = %s.replace(/name=\"%s\[\]\[/g,"name=\"%s["+itr+"]["); var li = %s(this).next("ul").find("li:last").clone(true).insertBefore(%s(this) .next("ul").find("li:last")).append(Tmpl).show(); });'</span></span>, $jquery_handler, $button_id, $jquery_handler, $js_var, $id, $id, $jquery_handler, $jquery_handler); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;jquery-&gt;addOnLoad(join(PHP_EOL,$js)); <span class="hljs-comment"><span class="hljs-comment">/** *      */</span></span> $xhtml = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $xhtml[] = <span class="hljs-string"><span class="hljs-string">'&lt;ul&gt;'</span></span>; $attribs = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($params <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $k=&gt;$v) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(in_array($k,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'class'</span></span>,<span class="hljs-string"><span class="hljs-string">'style'</span></span>))) $attribs[$k] = $v; <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($params[<span class="hljs-string"><span class="hljs-string">'forms'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key=&gt;$form) { $form -&gt; setElementsBelongTo($id . <span class="hljs-string"><span class="hljs-string">'['</span></span>.$key.<span class="hljs-string"><span class="hljs-string">']'</span></span>); $xhtml[] = <span class="hljs-string"><span class="hljs-string">'&lt;li'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_htmlAttribs($attribs) . <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span> . $form-&gt;render() . <span class="hljs-string"><span class="hljs-string">'&lt;/li&gt;'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ""  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($attribs[<span class="hljs-string"><span class="hljs-string">'style'</span></span>])) $attribs[<span class="hljs-string"><span class="hljs-string">'style'</span></span>] .= <span class="hljs-string"><span class="hljs-string">';display:none'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $attribs[<span class="hljs-string"><span class="hljs-string">'style'</span></span>] = <span class="hljs-string"><span class="hljs-string">'display:none'</span></span>; $xhtml[] = <span class="hljs-string"><span class="hljs-string">'&lt;li'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_htmlAttribs($attribs) . <span class="hljs-string"><span class="hljs-string">'&gt;&lt;/li&gt;'</span></span>; $xhtml[] = <span class="hljs-string"><span class="hljs-string">'&lt;/ul&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $button . join(PHP_EOL,$xhtml); } }</code> </pre><br><br>  Form values ‚Äã‚Äãare obtained in a neat hierarchical form. <br><br><pre> <code class="hljs php">[firstname] =&gt;  [lastname] =&gt;  [items] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [name] =&gt;  [type] =&gt; red [price] =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span> ) [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [name] =&gt;  [type] =&gt; blue [price] =&gt; <span class="hljs-number"><span class="hljs-number">2000</span></span> ) ) [logons] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [login] =&gt; username [passw] =&gt; qwerty [type] =&gt; vk ) )</code> </pre><br><br>  Unfortunately, you cannot add a File element to a group of elements because it does not support BelongTo.  I tried to add its support in the File Decorator, but I ran into problems in the Zend_File_Transfer_Adapter due to the lack of processing of multidimensional arrays in the $ _FILES variable. <br><br>  You can try to form the prefix in setBelongTo without [] and process the array of files separately from the group of elements into which they belong, or use some Ajax File Uploader instead of the File element. <br><br>  Download a fully working example <a href="">from here.</a> </div><p>Source: <a href="https://habr.com/ru/post/140178/">https://habr.com/ru/post/140178/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140168/index.html">Digium Switchvox Recognized as the Best Unified Communications Solution for 2011</a></li>
<li><a href="../140169/index.html">"The very goal" in the design to order</a></li>
<li><a href="../140171/index.html">Excursion to the data center "Beeline"</a></li>
<li><a href="../140172/index.html">AndroidLost: remote control of a lost smartphone</a></li>
<li><a href="../140176/index.html">POST card or educational program for the diagnosis of Part II</a></li>
<li><a href="../140179/index.html">Development of PHP parser using ANTLR</a></li>
<li><a href="../140180/index.html">Fans have already collected $ 1.3M on Wasteland 2</a></li>
<li><a href="../140181/index.html">JAX-RS Basics</a></li>
<li><a href="../140182/index.html">SSI loop - Loops in SSI</a></li>
<li><a href="../140184/index.html">Monitor Nginx with ZTC and Zabbix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>