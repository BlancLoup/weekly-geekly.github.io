<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Load Testing Veeam Backup & Replication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the spring of 2018, Selectel launched a backup service for VMware-based Cloud through Veeam¬Æ Backup & Replication ‚Ñ¢ (hereinafter referred to as VBR...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Load Testing Veeam Backup & Replication</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  In the spring of 2018, Selectel launched a backup service for <a href="https://selectel.ru/services/cloud/vmware/">VMware-based Cloud</a> through Veeam¬Æ Backup &amp; Replication ‚Ñ¢ (hereinafter referred to as VBR).  We approached the project implementation thoroughly, planned and executed the following list of works: <br><br><ul><li>  Study documentation and best practices on Veeam products </li><li>  Designing a VBR Service Provider Level </li><li>  Deploying VBR Infrastructure </li><li>  Testing the solution, determining the optimal settings and modes of operation </li><li>  Launch of the solution into industrial (commercial) operation </li></ul><br>  As it turned out - not in vain.  The service is stable, customers can back up their virtual machines, and we have a certain expertise that we want to share. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we want to talk about the results of load testing VBR for the two most popular backup proxy modes of operation, taking into account the variation in the number of parallel tasks. <br><a name="habracut"></a><br>  Here you can see: <br><br><ul><li>  Description of the Selectel production infrastructure used for testing </li><li>  Features of backup proxy (backup proxy) in various transport modes </li><li>  Description of the testing program and VBR component settings for its implementation </li><li>  Quantitative indicators, their comparison and conclusions </li></ul><br><h2>  Test infrastructure configuration </h2><br><h3>  Source Infrastructure </h3><br>  As a platform for testing the performance of VBR, one of the production clusters of the public <a href="https://selectel.ru/services/cloud/vmware/">Cloud based on VMware was made</a> . <br><br><ul><li>  Hardware configuration of hosts in this cluster: </li><li>  Intel¬Æ Xeon¬Æ Gold 6140 Processors </li><li>  NVMe Intel¬Æ DC Drives P4600 and P3520 </li><li>  4 10GbE ports per host </li></ul><br>  The cluster is based on the following solutions: <br><br><ul><li>  Physical network - Ethernet factory on Brocade VDX switches, Leaf-Spine architecture (10GbE ports - connecting hosts, 40GbE uplinks to Spine) </li><li>  Virtualization Environment - VMware vSphere¬Æ 6.5 </li><li>  VM data storage - VMware vSAN ‚Ñ¢ 6.6 (All-Flash vSAN Cluster) </li><li>  Network Virtualization - VMware NSX¬Æ 6.4 </li></ul><br>  The performance of the testing platform is more than enough and is not in doubt.  Of course, for high speed, all this should be properly configured, but since this is production, with lively and satisfied customers, you can be sure that everything is fine in this regard. <br><br>  Together with the VMware-based Cloud, Selectel launched a <a href="https://selectel.ru/services/additional/veeam-backups/">service</a> for its backup on the VBR platform.  Customers receive a self-service web portal where they can backup and restore vApps and VMs from their VDC (virtual data center). <br><br>  Clients access this portal (Veeam¬Æ Enterprise Manager Self-service portal) with the same rights as vCloud Director¬Æ (vCD).  This is possible thanks to the integration of Veeam¬Æ Backup Enterprise Manager (EM) and vCD, while each client, when connected to the EM, is limited to the resources of its VDC, it will not see other VMs. <br><br>  The client does not need to deploy its own VBR and its associated backup infrastructure, which implies costs for computing and network resources, storage, Veeam and MS licenses, administration.  It is long, expensive and difficult.  Selectel provides the basic features of VBR as a BaaS (Backup-as-a-Service) service: instantly, simply, conveniently, economically. <br><br>  To provide this service, VBR provider infrastructure was deployed in Selectel, covering all vSphere and VDC clusters of VMware cloud clients, including the cluster in which this testing was conducted.  Thus, the test results will judge the maximum speed with which customers can back up their VMs. <br><br><h3>  Test VMs </h3><br>  To test backup performance in a vSphere cluster, 6 identical VMs were deployed in the following configuration: <br><br><ul><li>  Windows Server 2016, 2 vCPU, 4GB RAM </li><li>  200GB vDisk </li></ul><br>  The disk is occupied almost completely - 193GB.  In addition to the OS files, a folder has been created on it with distributions of various OS and 60GB of DBMS (unique data).  On the same disc, 3 copies of this folder were created - a total of 180GB of non-system data. <br><br>  No applications for these VMs were installed, only a ‚Äúclean‚Äù OS and ‚Äúcold‚Äù data.  No load, computing or network, started.  This test did not require this. <br><br>  DRS is enabled in the vSphere cluster, so test VMs are automatically optimally distributed to VMware ESXi ‚Ñ¢ hosts for load balancing. <br><br><h3>  Backup proxy </h3><br>  VM with backup proxy is deployed directly in the vSphere cluster described above (source infrastructure, hereinafter referred to as vSphere cluster), this is a necessary condition for testing in the Virtual Appliance mode. <br><br>  VM configuration: <br><br><ul><li>  8 vCPU </li><li>  8GB RAM </li><li>  40GB vDisk </li><li>  10GbE vNIC vmxnet3 </li><li>  Windows Server 2016 </li></ul><br>  The ‚ÄúMax concurrent tasks‚Äù parameter for backup proxy at VBR level is set to 6. This means that backup proxy can simultaneously (in parallel) process up to 6 backup tasks (task).  One task is a backup of one virtual disk VM. <br><br><h3>  Backup repository </h3><br>  The front end of the backup repository is a physical server that acts as a VBR backup repository.  Server configuration: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32GB RAM </li><li>  2 10GbE ports </li></ul><br>  Backend storage - CephFS cluster with NVMe-cache. <br><br>  The backup repository and Ceph nodes communicate over a 10GbE network, each of which is connected to the switches by two ports. <br><br>  A detailed description of the Ceph cluster configuration is beyond the scope of this article.  Note that for reliability and fault tolerance, the data on it is stored in three copies.  The performance of the cluster does not cause complaints and laid with a margin, the test results showed that in none of them the backup storage was not a bottleneck. <br><br>  The ‚ÄúLimit maximum concurrent tasks‚Äù parameter for the backup repository at the VBR level is set to 6. This means that the backup repository can simultaneously (concurrently) process up to 6 backup tasks. <br><br><h3>  Backup network </h3><br>  The physical network of the infrastructure described above is limited by the bandwidth of 10 Gbit / s, 10GbE switches and ports are used everywhere.  This is true not only for the vSAN network, but also for the management interfaces of the ESXi hosts. <br><br>  To host a backup proxy at the VMware NSX level, a dedicated subnet has been created with its logical switch.  For its connectivity with physics and the implementation of routing, the NSX-edge, size X-large, is deployed. <br><br>  Looking ahead, the test results show that the network can handle up to 8 Gbit / s.  This is a very solid bandwidth, which is enough at this stage; if necessary, it can be increased. <br><br><h3>  Component interaction scheme </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Backup proxies and test VMs are deployed within the same VMware vSAN cluster.  After starting the backup task (backup-joby) depending on the selected transport mode, the features of which are discussed below, backup-proxy: <br><br><ul><li>  Retrieves data from backup VMs via vSAN network (HotAdd) or via management network (NBD) </li><li>  Sends the processed data to the backup repository on a dedicated subnet for this purpose. </li></ul><br><h2>  Backup Proxy Transport Modes </h2><br>  Backup proxy (Backup proxy) is a component of the VBR infrastructure that directly performs the processing of a backup job.  It extracts data from the VM, processes it (compresses, deduplicates, encrypts) and sends it to the repository, where it is stored in the backup files. <br><br>  Backup proxy allows you to work in three transport modes: <br><br><ul><li>  Direct storage access </li><li>  Virtual appliance </li><li>  Network </li></ul><br>  VMware Selectel based cloud <a href="https://blog.selectel.ru/vsan-v-oblake-na-baze-vmware/">uses vSAN</a> as storage, in this configuration Direct storage access is not supported, therefore this mode is not considered and has not been tested.  The remaining two modes work fine on each of our vSphere clusters, let's look at them in more detail. <br><br><h3>  Virtual appliance mode (HotAdd) </h3><br>  Virtual appliance is the recommended mode when deploying a backup proxy as a VM.  ESXi hosts on which backup proxies are deployed must have access to all vSphere cluster Datastore storing backed up VMs.  The essence of the mode lies in the fact that the proxy mounts to itself the disks of backup VMs (VMware SCSI HotAdd) and takes data from them as from its own.  Data retrieval occurs from the Datastore over the storage network. <br><br>  In our case, the backup proxy VM should be located on one of the ESXi hosts of the vSAN cluster, which we back up.  Data retrieval takes place over the vSAN network.  Thus, to work in the Virtual appliance mode, at least one backup proxy must be deployed in each vSAN cluster.  Deploy a backup proxy pair (for example, in a management cluster) and backup all vSAN clusters with them. <br><table><tbody><tr><td align="center">  <strong>pros</strong> </td><td align="center">  <strong>Minuses</strong> </td></tr><tr><td>  Fast is usually much faster than NBD, especially in the case of full backup or large increments.  The speed can be inferior only to Direct storage access. </td><td>  The disk mount operation (HotAdd) to the proxy can take up to 2 minutes to disk.  With incremental backups of small portions of data, NBD may be faster. </td></tr><tr><td>  Disposes of the storage network.  Does not load the management interface and hypervisor. </td><td>  Proxy VM consumes part of host resources.  Sometimes there may be problems with removing snapshots. </td></tr></tbody></table><h3>  Network Mode (NBD) </h3><br>  It is the simplest and universal mode, suitable for both physical and virtual backup proxies.  Extraction of data, in contrast to the previous two modes, is not on the storage network.  The backup proxy collects VM data by connecting to the management interface of the ESXi hosts on which they rotate. <br><br>  This approach has the following disadvantages: <br><br><ul><li>  Often, ESXi control interfaces do not hang on the fastest uplinks, usually 1GbE </li><li>  Even if the management interface will have 10GbE ports, ESXi will not give the proxy the entire band - it artificially restricts it and allocates only a certain amount of interface bandwidth for backups </li></ul><table><tbody><tr><td align="center">  <strong>pros</strong> </td><td align="center">  <strong>Minuses</strong> </td></tr><tr><td>  Simple and versatile.  Proxy can be physical and virtual. </td><td>  As a rule, HotAdd is much slower, especially on large volumes of backup and a small number of parallel tasks (tasks). </td></tr><tr><td>  Quickly starts, no delay on mounting disks.  No problems with snapshots. </td><td>  It creates a load (small) on the management interface and the hypervisor. </td></tr></tbody></table>  At the same time, many sources claim that NBD is very slow at 1GbE, but at 10GbE it can be quite fast.  This we will check. <br><br><h2>  Testing program </h2><br>  On the infrastructure described above, it is necessary to backup test VMs and record the following indicators: <br><br><ul><li>  CPU load,% </li><li>  RAM consumption, GB </li><li>  Network load, Gbit / s </li><li>  Backup performance, MB / s </li><li>  Backup time, mm: ss </li></ul><br>  Indicators should be fixed for backup of one test VM and for parallel backup of two, four and six test VMs. <br><br>  Indicators should be fixed for the Virtual appliance and Network backup proxy operation modes.  Every time a full backup should be performed, no increments. <br><br>  Thus, you need to create 4 backup jobs: <br><br><ul><li>  For one test VM </li><li>  For two test VMs </li><li>  For four test VMs </li><li>  For six test VMs </li></ul><br>  As part of testing it is necessary: <br><br><ol><li>  Sequentially run all the tasks in one mode </li><li>  Delete created backups so that there are no increments </li><li>  Repeat runs in the second mode, each time fixing indicators </li></ol><br>  In the settings of each task, you need to manually select the backup proxy prepared for testing, since it is not the only one in the common VBR infrastructure, but by default the proxy is automatically selected. <br><br>  The mode of backup proxy by default is also automatically selected.  Therefore, in the backup proxy settings, before each run, we manually set the required transport mode. <br><br>  The most interesting indicator is the average speed or performance of the backup.  It can be seen in the results of the job in the console VBR.  There will also be shown the backup time. <br><br>  In addition, it is necessary to estimate the load on the backup proxy in each of the tests.  The CPU, memory, and network utilization rates can be monitored using the guest OS tools (Windows 2016) and at the VMware level. <br><br>  In the backup proxy and backup repositories, the parameter for the maximum number of simultaneous tasks is set to 6. This means that as part of testing, all VMs in each task will be processed in parallel, none of them will wait in the queue, and performance will be maximal. <br><br>  Veeam¬Æ recommends that the number of parallel tasks does not exceed the number of processor cores in the proxy and repository.  The recommended amount of RAM in the repository is 2 GB per core, for a total of 12 GB.  The infrastructure configuration shows that all recommendations are followed. <br><br><h2>  Backup speed and load in Virtual Appliance mode (Hot Add) </h2><br><h3>  Backup 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  55-95 </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  2-2.2 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  709 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  70-100 (shelf 100% with sharp short drops to 70%) </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  5-7.7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  816 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  100 (shelf 100% with rare small drops) </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  3-3,5 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  885 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  100 (shelf 100% with rare small drops) </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  4-4,2 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  888 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Backup speed and load in Network mode (NBD) </h2><br><h3>  Backup 1 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  18-24 </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  192 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  18:30 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  25-33 </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  1.5-2.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  269 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  45-55 </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  2.8-3.5 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  2.8-4.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  446 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Load Backup Proxy</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  CPU load,% </td><td align="center">  50-70 </td></tr><tr><td>  RAM consumption, GB </td><td align="center">  3.5-4 </td></tr><tr><td>  Network load, Gbit / s </td><td align="center">  3.5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Backup speed</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Indicator</strong> </td><td align="center">  <strong>Value</strong> </td></tr><tr><td>  Backup performance, MB / s </td><td align="center">  517 </td></tr><tr><td>  Backup time, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Performance and Load Comparison in Virtual Appliance (HotAdd) and Network Mode (NBD) </h2><table><tbody><tr><td align="center">  <strong>Q.V.</strong> </td><td align="center">  <strong>Speed ‚Äã‚Äã- HotAdd, MB / s</strong> </td><td align="center">  <strong>Speed ‚Äã‚Äã- NBD, MB / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  one </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3.69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3.03 </td></tr><tr><td align="center">  four </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1.98 </td></tr><tr><td align="center">  6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1.72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Q.V.</strong> </td><td align="center">  <strong>CPU Load - HotAdd,%</strong> </td><td align="center">  <strong>CPU load - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  one </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3.06-3.96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  four </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1.82-2.22 </td></tr><tr><td align="center">  6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1.43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Q.V.</strong> </td><td align="center">  <strong>RAM Download - HotAdd, GB</strong> </td><td align="center">  <strong>RAM load - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  one </td><td align="center">  2-2.2 </td><td align="center">  1.9-2.1 </td><td align="center">  1.05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1.04-1.05 </td></tr><tr><td align="center">  four </td><td align="center">  3-3,5 </td><td align="center">  2.8-3.5 </td><td align="center">  1-1.07 </td></tr><tr><td align="center">  6 </td><td align="center">  4-4,2 </td><td align="center">  3.5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>Q.V.</strong> </td><td align="center">  <strong>Network load - HotAdd, Gb / s</strong> </td><td align="center">  <strong>Network load - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  one </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3.56-3.92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7.7 </td><td align="center">  1.5-2.5 </td><td align="center">  3.08-3.33 </td></tr><tr><td align="center">  four </td><td align="center">  5-8,2 </td><td align="center">  2.8-4.5 </td><td align="center">  1.79-1.82 </td></tr><tr><td align="center">  6 </td><td align="center">  5-8,2 </td><td align="center">  3.5-5 </td><td align="center">  1.43-1.64 </td></tr></tbody></table><h2>  Conclusions from the test results </h2><br>  The performance indicators of the backup, obtained as a result of testing, unequivocally confirm the fact that the Virtual appliance mode is significantly superior in speed compared to the Network mode, especially in a small number of parallel tasks. <br><br>  Let me remind you that the tests for both modes were run in absolutely identical conditions on the same platform.  The network bandwidth was also the same - the management interfaces through which the proxy collects data in NBD mode give out 10 Gb / s, like the vSAN network for HotAdd mode, we did not set any limits on the bandwidth. <br><br>  Obviously, ESXi really slows down Veeam¬Æ and gives it only a portion of the band in Network mode, hence the differences in backup speed.  However, with an increase in the number of streams ‚Äî simultaneous backup tasks ‚Äî the Network mode significantly reduces the backlog. <br><br>  We see that in the Virtual appliance mode, already on 4 VM backup proxy rests on the processor, it cannot work faster, for 6 VM the backup speed has not changed much.  In this case, the backup speed of 1-2 VM in this mode lags slightly, the capabilities of backup proxy and platform are used to the maximum even on a small number of threads. <br><br>  In Network mode, on the contrary, there is a significant increase in productivity with an increase in the number of simultaneous tasks.  At the same time, the load on the backup proxy processor is much lower than in HotAdd mode, even on 6 threads it does not exceed 70%. <br><br>  The consumption of RAM backup proxy is small and about the same in both modes. <br><br>  The load on the backup proxy network correlates with the backup speed, exceeding it by ~ 10-17%.  Apparently, the proxy takes data from the WM sources somewhat faster than uploads to the repository, since they need to be processed. <br><br>  It is interesting to observe the Load line in the pictures with the results of the execution of the job.  It shows the level of load on various elements of the backup infrastructure: source, proxy, network, repository. <br><br>  In the Virtual appliance mode, we see that the performance of the backup rests on the proxy and the network, they are always about equally loaded.  The source and repository are not a bottleneck. <br><br>  In Network mode, the source is always the bottleneck, even for a single stream.  It can be seen that the remaining elements of the infrastructure can give more, but ESXi does not give them. <br><br><h2>  Summary </h2><br>  Testing has confirmed that backup proxy in the studied transport modes in practice behaves exactly as the theory suggests. <br><br>  ON Veeam¬Æ proved to be very worthy: <br><br><ul><li>  In HotAdd mode, all infrastructure features were utilized efficiently and completely. </li><li>  In NBD mode, performance is expected to be more modest, but this is not a Veeam¬Æ problem, but an ESXi network stack feature. </li></ul><br>  We obtained real indicators of productivity and load, which is very useful for choosing the optimal mode of operation and subsequent scaling of the system. <br><br>  At the moment, we are quite satisfied with the existing performance of the backup, we understand how to properly increase it when such a need arises. </div><p>Source: <a href="https://habr.com/ru/post/431596/">https://habr.com/ru/post/431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431582/index.html">The history of personal data protection: how did GDPR come about?</a></li>
<li><a href="../431584/index.html">Astronautics and testing: mix, but do not shake</a></li>
<li><a href="../431586/index.html">How to handle errors on JVM faster</a></li>
<li><a href="../431588/index.html">The law on self-employed. Information for consideration</a></li>
<li><a href="../431590/index.html">Modernization of obsolete UK wind farms will increase energy generation by 171%</a></li>
<li><a href="../431598/index.html">We bring to the Internet a public QEMU virtual machine without a network card and try to mine</a></li>
<li><a href="../431600/index.html">Raise IDS / NMS: Mikrotik and Suricata with a web-interface</a></li>
<li><a href="../431602/index.html">Russian developers presented a virtual rehabilitation system in London</a></li>
<li><a href="../431604/index.html">Localization in Go using basic packages</a></li>
<li><a href="../431608/index.html">The American company DriveSavers first in the world launched the service of hacking iPhone for individuals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>