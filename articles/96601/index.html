<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET - custom authorization forms. Crib</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many ways to write your own authorization implementation on the site. I will give a fairly simple way to create my own provider for authoriz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET - custom authorization forms. Crib</h1><div class="post__text post__text-html js-mediator-article">  There are many ways to write your own authorization implementation on the site.  I will give a fairly simple way to create my own provider for authorization and writing it in the web config.  This method will allow the use of such standard controls as Login, LoginStatus and the like. <br><a name="habracut"></a><br><h4>  Your MembershipProvider for user authentication </h4><br>  <b>Step 1:</b> inherit from <a href="http://msdn.microsoft.com/ru-ru/library/sfka4yf8.aspx">System.Web.Security.MembershipProvider</a> , implement the class and override the methods we need.  The main one is ValidateUser, which is responsible for authenticating the user to the system. <br><blockquote><code><font color="black"><font color="#0000ff">namespace</font> Providers <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomMembershipProvider : MembershipProvider <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">bool</font> ValidateUser( <font color="#0000ff">string</font> username, <font color="#0000ff">string</font> password) <br> { <br> <font color="#0000ff">return</font> myUserManager.ValidateUser(username, password); <font color="#008000">//   </font> <br> } <br> ... <br> } <br> }</font> <br></code> </blockquote><br>  Methods that you do not want to override can be left as follows: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">bool</font> UnlockUser( <font color="#0000ff">string</font> userName) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">"The method or operation is not implemented."</font> ); <br> }</font> <br></code> </blockquote><br>  if necessary, they can always be implemented. <br><br>  <b>Step 2:</b> in web.config is written: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">system.web</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">membership</font> <font color="#ff0000">defaultProvider</font> <font color="#0000ff">="CustomMembershipProvider"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">providers</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">clear</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">add</font> <font color="#ff0000">name</font> <font color="#0000ff">="CustomMembershipProvider"</font> <font color="#ff0000">type</font> <font color="#0000ff">="Providers.CustomMembershipProvider"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">providers</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">membership</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">system.web</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  Also, do not forget that you need to prescribe that we do the authorization forms: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">authentication</font> <font color="#ff0000">mode</font> <font color="#0000ff">="Forms"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">forms</font> <font color="#ff0000">defaultUrl</font> <font color="#0000ff">="~/Default.aspx"</font> <font color="#ff0000">timeout</font> <font color="#0000ff">="120"</font> <font color="#ff0000">loginUrl</font> <font color="#0000ff">="~/Login.aspx"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">authentication</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  Now you can throw on the Login control login page and use it, not forgetting why you needed authorization: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">authorization</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">deny</font> <font color="#ff0000">users</font> <font color="#0000ff">="?"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">allow</font> <font color="#ff0000">users</font> <font color="#0000ff">="*"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">authorization</font> <font color="#0000ff">&gt;</font> <br></font> <br></code> </blockquote><br><br><h4>  Your RoleProvider to define user roles </h4><br>  <b>Step 1:</b> inherit from <a href="http://msdn.microsoft.com/ru-ru/library/system.web.security.roleprovider%2528VS.90%2529.aspx">System.Web.Security.RoleProvider</a> , implement the class and override the methods we need. <br><blockquote> <code><font color="black"><font color="#0000ff">namespace</font> Providers <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> CustomRoleProvider : RoleProvider <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">string</font> [] GetRolesForUser( <font color="#0000ff">string</font> username) <br> { <br> <font color="#0000ff">return</font> myUserManager.GetUser(username).Roles; <font color="#008000">//      </font> <br> } <br> } <br> }</font> <br></code> </blockquote><br>  Here, also unused methods can be left throwing an exception: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">string</font> [] GetUsersInRole( <font color="#0000ff">string</font> roleName) <br> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">"The method or operation is not implemented."</font> ); <br> }</font> <br></code> </blockquote><br>  <b>Step 2:</b> in web.config is written: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">system.web</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">roleManager</font> <font color="#ff0000">enabled</font> <font color="#0000ff">="true"</font> <font color="#ff0000">defaultProvider</font> <font color="#0000ff">="CustomRoleProvider"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">providers</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">add</font> <font color="#ff0000">name</font> <font color="#0000ff">="CustomRoleProvider"</font> <font color="#ff0000">type</font> <font color="#0000ff">="Providers.CustomRoleProvider"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">providers</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">roleManager</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">system.web</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  Everything can be enjoyed.  For example, like this: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">authorization</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">deny</font> <font color="#ff0000">roles</font> <font color="#0000ff">="Admin"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">authorization</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  And as a conclusion, I will give an example of dependency injection into my providers using Unity: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">if (Roles.Enabled) <br> _unityContext.Container.BuildUp(Roles.Provider.GetType(), Roles.Provider); <br> _unityContext.Container.BuildUp(Membership.Provider.GetType(), Membership.Provider);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/96601/">https://habr.com/ru/post/96601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96591/index.html">10 things on the Internet that are furious, or why the Web will really die</a></li>
<li><a href="../96592/index.html">3D journalism, or what the magazine market misses</a></li>
<li><a href="../96594/index.html">Web development development in the region. A look at the question from the point of view of the top studios runet (part 3)</a></li>
<li><a href="../96595/index.html">Arduino terminal</a></li>
<li><a href="../96598/index.html">World Cup 2010 Widget</a></li>
<li><a href="../96604/index.html">Phone Security Labels - First Law Enacted</a></li>
<li><a href="../96607/index.html">What are they afraid of in cloud computing?</a></li>
<li><a href="../96608/index.html">Commission 30% for Facebook Credits - is this normal?</a></li>
<li><a href="../96609/index.html">Development and modification of firmware for Android phones on the example of HTC Hero GSM. Part 1</a></li>
<li><a href="../96610/index.html">Nagios + SMS using a mobile phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>