<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing and configuring cacti 0.8.8f from scratch under Ubuntu 14.04</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I remember the time when I was assigned a task - to install and configure cacti with 95th Percentile graphs and the ability to aggregate graphs. And t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing and configuring cacti 0.8.8f from scratch under Ubuntu 14.04</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/73c/117/e76/73c117e767af19feef00b0cede947c4f.jpg" alt="image"><br>  I remember the time when I was assigned a task - to install and configure cacti with 95th Percentile graphs and the ability to aggregate graphs.  And these memories caught up with me sadness ... At first I tried to install and configure cacti through ppa turnips - a lot of problems came out with symlinks, rights, etc.  Then he put less directly from official rap problems, but it was necessary to play around with patches, since the version of the program is a bit outdated.  I was looking for installation instructions from source, but under Ubuntu everything was very raw and faced the same problems.  And then he decided to take on the official documentation, which wrote about what to put in general, regardless of the distribution. <br>  I decided to share my experience in <a href="http://sysadm.pp.ua/linux/monitoring-systems/cacti-install-from-source.html">installing cacti 0.8.8f</a> (the latest version at the moment) under the Ubuntu 14.04 distribution. <a name="habracut"></a><br>  Install the necessary packages. <br><pre><code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># apt-get install apache2 php5 php5-mysql php5-snmp snmp php5-gd rrdtool mysql-server php5-ldap zip unzip</span></span></code> </pre> <br>  Next, we check, or we have all the modules needed for cacti php robots.  There should be at least seven of them. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># php -m | egrep '^(mysql|snmp|xml|session|sockets|ldap|gd)$' gd ldap mysql session snmp sockets xml</span></span></code> </pre><br>  All the necessary modules are.  Now download the source code of cacti and unpack it into a local folder.  At the moment - this is version 0.8.8f. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># wget http://www.cacti.net/downloads/cacti-0.8.8f.tar.gz root@cacti:~# tar xzvf cacti-0.8.8f.tar.gz</span></span></code> </pre><br>  We proceed to the preparation of mysql database.  To begin, create a database. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># mysqladmin -p -u root create cacti Enter password:</span></span></code> </pre><br>  The next thing you need to fill the structure of the newly created cacti database. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># mysql -p -u root cacti &lt; cacti-0.8.8f/cacti.sql Enter password:</span></span></code> </pre><br>  And add a user with administration rights. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># mysql -p -u root -e 'GRANT ALL ON cacti.* TO cactiuser@localhost IDENTIFIED BY "your_password"; flush privileges;' Enter password:</span></span></code> </pre><br>  Work with the database is completed, it now remains to register the connection settings to the database in the cacti configuration. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># vim cacti-0.8.8f/include/config.php ‚Ä¶ $database_type = "mysql"; $database_default = "cacti"; $database_hostname = "localhost"; $database_username = "cactiuser"; $database_password = "your_password"; $database_port = "3306"; $database_ssl = false; ‚Ä¶</span></span></code> </pre><br>  Next, we transfer the cacti pages to the / var / www folder (to the folder where the site sources will be stored) and set the owner and the www-data group (the user running the web server). <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># rsync -aP cacti-0.8.8f/ /var/www/cacti/ root@cacti:~# chown -R www-data:www-data /var/www/cacti</span></span></code> </pre><br>  You also need to add cron to work poller-a and put the right to execute it. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># echo '*/5 * * * * www-data php /var/www/cacti/poller.php &gt; /dev/null 2&gt;&amp;1' &gt; /etc/cron.d/cacti root@cacti:~# chmod +x /var/www/cacti/poller.php</span></span></code> </pre><br>  Check / change default apache directory <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># cat /etc/apache2/sites-enabled/000-default.conf | grep DocumentRoot DocumentRoot /var/www</span></span></code> </pre><br>  The final touch reboot the web server. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/apache2 restart * Restarting web server apache2 ... waiting [ OK ]</span></span></code> </pre><br>  Subsequent installation of cacti will take place via the web interface via the link http: // &lt;server_ip&gt; / cacti /. <br>  When you go, you should see the following picture. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti1.jpg" alt="image"></div><br><br>  Read and click Next.  Now they ask us what we want to do - update or install cacti.  In our case - install.  Select and click Next. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti2.jpg" alt="image"></div><br><br>  Now you should see and edit (if necessary) the paths to rrdtool, php, snmp, etc. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti3.jpg" alt="image"></div><br><br>  If all is good, click Next and look at the successful completion of the cacti installation. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti4.jpg" alt="image"></div><br><br>  Now we enter the default login and password - admin / admin, and you will need to immediately change the default password. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti5.jpg" alt="image"></div><br><br>  After entering a new password, you will be taken to cacti GUI.  Now cacti is ready to go. <br>  Next, install the spine poller under cacti 0.8.8f.  Download and unpack to a local folder. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># wget http://www.cacti.net/downloads/spine/cacti-spine-0.8.8f.tar.gz root@cacti:~# tar xzvf cacti-spine-0.8.8f.tar.gz</span></span></code> </pre><br>  Install the necessary packages for compilation and operation. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># apt-get install libmysqlclient-dev libsnmp-dev automake libtool make</span></span></code> </pre><br>  Compile. <br><pre> <code class="bash hljs">root@cacti:~<span class="hljs-comment"><span class="hljs-comment"># cd cacti-spine-0.8.8f root@cacti:~/cacti-spine-0.8.8f# aclocal root@cacti:~/cacti-spine-0.8.8f# libtoolize --force root@cacti:~/cacti-spine-0.8.8f# autoheader root@cacti:~/cacti-spine-0.8.8f# autoconf root@cacti:~/cacti-spine-0.8.8f# automake root@cacti:~/cacti-spine-0.8.8f# ./configure root@cacti:~/cacti-spine-0.8.8f# make root@cacti:~/cacti-spine-0.8.8f# make install make[1]: Entering directory `/home/vagrant/cacti-spine-0.8.8f' test -z "/usr/local/spine/bin" || /bin/mkdir -p "/usr/local/spine/bin" /bin/bash ./libtool --mode=install /usr/bin/install -c spine '/usr/local/spine/bin' libtool: install: /usr/bin/install -c spine /usr/local/spine/bin/spine test -z "/usr/local/spine/etc" || /bin/mkdir -p "/usr/local/spine/etc" /usr/bin/install -c -m 644 spine.conf.dist '/usr/local/spine/etc' make[1]: Leaving directory `/home/vagrant/cacti-spine-0.8.8f'</span></span></code> </pre><br><br>  From the output we can see that the spin-a binary is located along the path / usr / local / spine / bin / spine, and the configuration is here - /usr/local/spine/etc/spine.conf.dist.  In order for cacti to use it, you need to rename and edit spine.conf and set the path to the spine in the GUI.  To begin, rename the configuration file and add access to the database. <br><pre> <code class="bash hljs">root@cacti:~/cacti-spine-0.8.8f<span class="hljs-comment"><span class="hljs-comment"># mv /usr/local/spine/etc/{spine.conf.dist,spine.conf} root@cacti:~/cacti-spine-0.8.8f# vim /usr/local/spine/etc/spine.conf ‚Ä¶ DB_Host localhost DB_Database cacti DB_User cactiuser DB_Pass your_password DB_Port 3306 ‚Ä¶</span></span></code> </pre><br><br>  Now immediately check the spine configuration from the console. <br><pre> <code class="bash hljs">root@cacti:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/spine/bin<span class="hljs-comment"><span class="hljs-comment"># cd /usr/local/spine/bin/ root@cacti:/usr/local/spine/bin# ./spine -V 5 -R</span></span></code> </pre><br>  If you don‚Äôt get a single line of output, then there‚Äôs a problem with accessing the database (reconfigure spine.conf). <br>  It now remains to set the path to the spine and select as default poller.  Login to the cacti web interface and go to Configuration -&gt; Settings -&gt; Paths or direct link http: // &lt;server_ip&gt; /cacti/settings.php?tab=path, set the path to spine (in our case / usr / local / spine / bin / spine) and save all. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti6.jpg" alt="image"></div><br><br>  It remains to activate a new type of poller.  Go to the Poller tab and select the spine. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti7.jpg" alt="image"></div><br><br>  We save, wait for 5-10 minutes and look at the logs for errors <i><b>Utilities -&gt; System Utilities -&gt; View Cacti Log File</b></i> . <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti8.jpg" alt="image"></div><br><br>  As you can see, there are no problems - and all data is normally updated with the new spine method. <br>  In cacti version 0.8.8f, the problem with 64 bit counters for the 95th Percentile and Total Bandwidth graphs continues to be present.  To fix it, you need to add a new template.  I once found it and downloaded it on the cacti forum, but where I can‚Äôt find it for sure.  You can download it <a href="">here</a> . <br>  Now it just needs to be added to cacti.  Go to <i><b>Import / Export -&gt; Import Templates</b></i> or click the link http: // &lt;server_ip&gt; /cacti/templates_import.php, select the file and click Import. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti9.jpg" alt="image"></div><br><br>  And we get this result. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti10.jpg" alt="image"></div><br><br>  Now, when creating graphs on network interface statistics, we will have <i>In / Out Bits with 95th Percentile (64-bit Counters)</i> and <i>In / Out Bits with Total Bandwidth (64-bit Counters)</i> . <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti11.jpg" alt="image"></div><br><br>  Lastly, add aggregate and weathermap plugins. <br>  <b>Aggregate</b> .  This plugin is used in cacti to merge several schedules into one.  For example, if you need to see how much incoming and outgoing traffic the entire CDN as a whole generates, and not its separate server. <br>  Go to the folder with cacti plugins and download the latest version of the aggregate. <br><pre> <code class="bash hljs">root@cacti:~/cacti-spine-0.8.8f<span class="hljs-comment"><span class="hljs-comment"># cd /var/www/cacti/plugins/ root@cacti:/var/www/cacti/plugins# wget http://docs.cacti.net/_media/plugin:aggregate-v0.75.tgz -O aggregate-v0.75.tgz</span></span></code> </pre><br>  Unpack and delete the archive, also do not forget to change the owner and group for all files. <br><pre> <code class="bash hljs">root@cacti:/var/www/cacti/plugins<span class="hljs-comment"><span class="hljs-comment"># tar xzvf aggregate-v0.75.tgz aggregate/ aggregate/setup.php aggregate/aggregate_functions.php aggregate/color_templates_items.php aggregate/aggregate.php aggregate/color_templates.php aggregate/README aggregate/aggregate_manual.pdf aggregate/LICENSE aggregate/color_html.php root@cacti:/var/www/cacti/plugins# rm aggregate-v0.75.tgz root@cacti:/var/www/cacti/plugins# chown -R www-data:www-data aggregate/</span></span></code> </pre><br><br>  Now it remains to go to the web interface, install and activate the plugin. <br>  Go to <i><b>Configuration -&gt; Plugin Management</b></i> and click on the arrow in the Actions field opposite the Aggregate plugin for installation. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti12.jpg" alt="image"></div><br><br>  Then you need to click on the green arrow to activate. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti13.jpg" alt="image"></div><br><br>  Plugin activated.  How to use it you can see in the manual attached with the source. <br><br>  <b><i>Weathermap</i></b> .  This plug-in is used in cacti to build a network map with visualization of all network hops and channel loading.  There are many articles with descriptions and examples, so consider only installation and activation. <br>  Go to the folder with cacti plugins and download the weathermap archive. <br><pre> <code class="bash hljs">root@cacti:/var/www/cacti/plugins<span class="hljs-comment"><span class="hljs-comment"># wget http://network-weathermap.com/files/php-weathermap-0.97c.zip</span></span></code> </pre><br><br>  Unpack and delete the archive. <br><pre> <code class="bash hljs">root@cacti:/var/www/cacti/plugins<span class="hljs-comment"><span class="hljs-comment"># unzip php-weathermap-0.97c.zip root@cacti:/var/www/cacti/plugins# rm php-weathermap-0.97c.zip</span></span></code> </pre><br><br>  We change the owner and group for all files and turn on the weathermap visual editor. <br><pre> <code class="bash hljs">root@cacti:/var/www/cacti/plugins<span class="hljs-comment"><span class="hljs-comment"># chown -R www-data:www-data weathermap/ root@cacti:/var/www/cacti/plugins# vim weathermap/editor.php ... $ENABLED=true; ...</span></span></code> </pre><br><br>  Now it only remains to go to the web interface and activate the plugin. <br>  Go to Configuration -&gt; Plugin Management and click on the arrow in the Actions field opposite the Weathermap plugin to activate. <br><br><div style="text-align:center;"><img src="http://sysadm.pp.ua/wp-content/uploads/2016/02/cacti15.jpg" alt="image"></div><br><br>  Plugin activated.  How to use it you can see on the official pages of the project. <br>  It remains only to add hosts for monitoring - try. </div><p>Source: <a href="https://habr.com/ru/post/277375/">https://habr.com/ru/post/277375/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277363/index.html">Who works in Innopolis?</a></li>
<li><a href="../277367/index.html">Popular reasons for the fall of sites</a></li>
<li><a href="../277369/index.html">How to the developer to "join" the theme of DevOps</a></li>
<li><a href="../277371/index.html">The advantages of using unique shaders in computer games: personal experience and observation</a></li>
<li><a href="../277373/index.html">Eclipse on Java or read stackracks more attentively</a></li>
<li><a href="../277381/index.html">The first reports of PHDays VI: how to break transport maps, set up hacker mousetraps and sell vulnerabilities for $ 100,000</a></li>
<li><a href="../277383/index.html">The glibc library‚Äôs critical vulnerability allows remote code execution</a></li>
<li><a href="../277385/index.html">Microsoft Operations Management Suite - Overview. Part number 1</a></li>
<li><a href="../277389/index.html">The book "Eternity. In search of the ultimate theory of time "</a></li>
<li><a href="../277391/index.html">HPE SPM Portfolio Innovations: Service Manager 9.4, SmartAnalytics, and Propel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>