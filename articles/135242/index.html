<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logging architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My development experience is mainly built around a variety of network services under Windows and Linux. I usually strive to achieve maximum cross-plat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logging architecture</h1><div class="post__text post__text-html js-mediator-article">  My development experience is mainly built around a variety of network services under Windows and Linux.  I usually strive to achieve maximum cross-platform up to binary compatibility.  And of course, a number of stable logging solutions have accumulated. <br><br>  The topic is written as a continuation of this <a href="http://habrahabr.ru/blogs/net/98638">article</a> and will be useful primarily for novice programmers. <br><br>  Here I am going to highlight the following questions: <br><ul><li>  Internal property of the logger and examples of the software that uses it. </li><li>  Volumes, levels and details of log messages. </li><li>  General configuration rules in development, in combat, and in investigation. </li></ul><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, I'll start with my additions to the previous article. <br>  Like the author, I use NLog and, of course, make extensive use of its features.  Of course after <br>  their implementation in any other logger, the practice described below can be applied to them. <br><br>  By the way, log4net continues <a href="https://issues.apache.org/jira/browse/LOG4NET">to evolve</a> . <br><br>  Actually, there are only two required additions to the ‚ÄúFeatures of a respectable logger‚Äù: <br><ol><li>  Observing / reloading a configuration file is no longer just a useful, but a much-needed skill. </li><li>  Minimal intervention in the off state. </li></ol><br><br><h4>  Under the hood NLog </h4><br>  Immediately discuss the usefulness of the second feature. <br><br>  Often, when developing a code, it is necessary to look at the value of any variable during execution.  Usually, a debugger is used and the program is stopped in the place of interest.  For me, this is a clear sign that this place will be useful <i>Trace</i> output.  Complete with unit tests, we immediately get a sweep of this variable in time and a protocol for comparison with tests in other conditions.  Thus, I practically do not use the debugger. <br><br>  Obviously, in combat use, even when turned off, detailed logging can interfere with both execution speed and parallelism. <br><br>  The following techniques are used in NLog: <br><ul><li>  <u>Caching logging level in volatile variable.</u>  It does not require blocking or synchronization of threads. </li><li>  <u>A simple method to determine the need for logging.</u>  Under some conditions, it can lead to inline-insertion of code during jit-compilation.  And this turns the logic into a simple conditional omission of a piece of code and eliminates copying and transferring the parameters of the logging function. </li><li>  <u>Detailed overloading of logging methods.</u>  Minimize type conversion, and also protect from vain boxing, before we figured out the need for logging. </li><li>  <u>Delayed message generation by the delegate.</u>  Allows you to visually and easily define complex message generation. </li></ul><br><br>  The source code of the class can be found <a href="">here</a> . <br><br>  Fine!  For NLog, you can be sure that your detailed messages can be turned off and this will have a minimal impact on performance.  But, this is not a reason to devote half of the code to logging. <br><br><h4>  What and how to log </h4><br><br>  Follow the rules: <br><br><ul><li>  The output to the log should be placed on a separate line. </li><li>  The message should be as short and informative as possible. </li><li>  Only rare or fatal messages can be localized. </li><li>  It is desirable to take the arguments from the local variables of the method or internal variables of the class of this method. </li><li>  It is not advisable to use type conversions. </li></ul><br><br>  In general, when outputting to the log, always note that the number of potentially unnecessary calculations that will be required for the case when the log is disabled. <br><br>  A simple example (a fragment of a class): <br><blockquote> <code><font color="#0600FF">private</font> <font color="#0600FF">static</font> Logger Log <font color="#008000">=</font> LogManager. <font color="#0000FF">GetCurrentClassLogger</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">public</font> <font color="#FF0000">string</font> Request <font color="#000000">(</font> <font color="#FF0000">string</font> cmd, <font color="#FF0000">string</font> getParams <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Uri uri <font color="#008000">=</font> <font color="#008000">new</font> Uri <font color="#000000">(</font> _baseUri, cmd <font color="#008000">+</font> <font color="#666666">"?"</font> <font color="#008000">+</font> getParams <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Debug</font> <font color="#000000">(</font> <font color="#666666">"Request for uri:`{0}'"</font> , uri <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> HttpWebRequest webReq <font color="#008000">=</font> <font color="#000000">(</font> HttpWebRequest <font color="#000000">)</font> WebRequest. <font color="#0000FF">Create</font> <font color="#000000">(</font> uri <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> webReq. <font color="#0000FF">Method</font> <font color="#008000">=</font> <font color="#666666">"GET"</font> <font color="#008000">;</font> &lt;br/&gt; <br> webReq. <font color="#0000FF">Timeout</font> <font color="#008000">=</font> _to <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#FF0000">string</font> respText <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">try</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> <font color="#FF0000">string</font> page <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> WebResponse resp <font color="#008000">=</font> webReq. <font color="#0000FF">GetResponse</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> Stream respS <font color="#008000">=</font> resp. <font color="#0000FF">GetResponseStream</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> StreamReader sr <font color="#008000">=</font> <font color="#008000">new</font> StreamReader <font color="#000000">(</font> respS <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> page <font color="#008000">=</font> sr. <font color="#0000FF">ReadToEnd</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Trace</font> <font color="#000000">(</font> <font color="#666666">"Response page:`{0}'"</font> , page <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">return</font> page <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> <font color="#0600FF">catch</font> <font color="#000000">(</font> Exception err <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Warn</font> <font color="#000000">(</font> <font color="#666666">"Request for uri:`{0}' exception: {1}"</font> , uri, err. <font color="#0000FF">Message</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> throw <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> <font color="#000000">}</font> <br></code> </blockquote> <code><font color="#0600FF">private</font> <font color="#0600FF">static</font> Logger Log <font color="#008000">=</font> LogManager. <font color="#0000FF">GetCurrentClassLogger</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">public</font> <font color="#FF0000">string</font> Request <font color="#000000">(</font> <font color="#FF0000">string</font> cmd, <font color="#FF0000">string</font> getParams <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Uri uri <font color="#008000">=</font> <font color="#008000">new</font> Uri <font color="#000000">(</font> _baseUri, cmd <font color="#008000">+</font> <font color="#666666">"?"</font> <font color="#008000">+</font> getParams <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Debug</font> <font color="#000000">(</font> <font color="#666666">"Request for uri:`{0}'"</font> , uri <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> HttpWebRequest webReq <font color="#008000">=</font> <font color="#000000">(</font> HttpWebRequest <font color="#000000">)</font> WebRequest. <font color="#0000FF">Create</font> <font color="#000000">(</font> uri <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> webReq. <font color="#0000FF">Method</font> <font color="#008000">=</font> <font color="#666666">"GET"</font> <font color="#008000">;</font> &lt;br/&gt; <br> webReq. <font color="#0000FF">Timeout</font> <font color="#008000">=</font> _to <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#FF0000">string</font> respText <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">try</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> <font color="#FF0000">string</font> page <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> WebResponse resp <font color="#008000">=</font> webReq. <font color="#0000FF">GetResponse</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> Stream respS <font color="#008000">=</font> resp. <font color="#0000FF">GetResponseStream</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#0600FF">using</font> <font color="#000000">(</font> StreamReader sr <font color="#008000">=</font> <font color="#008000">new</font> StreamReader <font color="#000000">(</font> respS <font color="#000000">)</font> <font color="#000000">)</font> &lt;br/&gt; <br> page <font color="#008000">=</font> sr. <font color="#0000FF">ReadToEnd</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Trace</font> <font color="#000000">(</font> <font color="#666666">"Response page:`{0}'"</font> , page <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#0600FF">return</font> page <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> <font color="#0600FF">catch</font> <font color="#000000">(</font> Exception err <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Warn</font> <font color="#000000">(</font> <font color="#666666">"Request for uri:`{0}' exception: {1}"</font> , uri, err. <font color="#0000FF">Message</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> throw <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> <font color="#000000">}</font> <br></code> <br><br>  All logging arguments were required for logic.  The <i>Debug</i> message marks the arguments with which we came to the function.  In the error handler, we duplicate the input parameters in case the <i>Debug</i> level is disabled.  And this will give information if necessary to write a unit test.  We do not display the exception stack, since it remains possible to do this by a higher-level handler. <br><br>  In general, in the current error handler, it is useful to detail the context that led to the exception and the specific features of the exception.  In the example, it would be useful to display the <i>Status</i> field for the case of <i>WebException</i> . <br><br><h5>  Guarantees the safety of the log </h5><br><br>  Despite some of the features of NLog on auto logging, there is no guarantee that the log will be safe at the end of the process. <br><br>  Interestingly, the attempt to terminate the recording by processing the <i>AppDomain.ProcessExit</i> event is not entirely correct.  The configuration can be configured in many different ways to write to the log, including over the network.  And the handler of this event is in a limited environment.  In .Net, this time is no more than 2 seconds, and in Mono it is stopped by <i>ThreadPool</i> .  Therefore, it is helpful to take care of completing the process in a more friendly environment. <br><br>  The first thing to do is handle the <i>AppDomain.UnhandledException</i> event.  It should log the complete error information and call <i>LogManager.Flush ()</i> .  The event handler uses the same thread that caused the exception, and when it is finished, it immediately unloads the application. <br><blockquote> <code><font color="#0600FF">private</font> <font color="#0600FF">static</font> <font color="#0600FF">readonly</font> Logger Log <font color="#008000">=</font> LogManager. <font color="#0000FF">GetCurrentClassLogger</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">public</font> <font color="#0600FF">static</font> <font color="#0600FF">void</font> Main <font color="#000000">(</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> args <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> AppDomain. <font color="#0000FF">CurrentDomain</font> . <font color="#0000FF">UnhandledException</font> <font color="#008000">+=</font> OnUnhandledException <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">(</font> ... <font color="#000000">)</font> &lt;br/&gt; <br> LogManager. <font color="#0000FF">Flush</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">static</font> <font color="#0600FF">void</font> OnUnhandledException <font color="#000000">(</font> <font color="#FF0000">object</font> sender, UnhandledExceptionEventArgs e <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Fatal</font> <font color="#000000">(</font> <font color="#666666">"Unhandled exception: {0}"</font> , e. <font color="#0000FF">ExceptionObject</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> LogManager. <font color="#0000FF">Flush</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> <br></code> </blockquote> <code><font color="#0600FF">private</font> <font color="#0600FF">static</font> <font color="#0600FF">readonly</font> Logger Log <font color="#008000">=</font> LogManager. <font color="#0000FF">GetCurrentClassLogger</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">public</font> <font color="#0600FF">static</font> <font color="#0600FF">void</font> Main <font color="#000000">(</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> args <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> AppDomain. <font color="#0000FF">CurrentDomain</font> . <font color="#0000FF">UnhandledException</font> <font color="#008000">+=</font> OnUnhandledException <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">(</font> ... <font color="#000000">)</font> &lt;br/&gt; <br> LogManager. <font color="#0000FF">Flush</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#0600FF">static</font> <font color="#0600FF">void</font> OnUnhandledException <font color="#000000">(</font> <font color="#FF0000">object</font> sender, UnhandledExceptionEventArgs e <font color="#000000">)</font> &lt;br/&gt; <br> <font color="#000000">{</font> &lt;br/&gt; <br> Log. <font color="#0000FF">Fatal</font> <font color="#000000">(</font> <font color="#666666">"Unhandled exception: {0}"</font> , e. <font color="#0000FF">ExceptionObject</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> LogManager. <font color="#0000FF">Flush</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> &lt;br/&gt; <br> <font color="#000000">}</font> <br></code> <br><br>  In addition, you should call <i>LogManager.Flush ()</i> wherever the completion of the process is potentially possible.  At the end of all non-background threads. <br><br>  If your application is a win-service or Asp.Net, then you should handle the corresponding code start and end events. <br><br><h5>  How much to log </h5><br><br>  A serious problem for the developer.  You always want to get more information, but the code starts to look very bad.  I am guided by the following considerations. <br><br>  Logging is essentially a comment.  <i>Trace</i> level <i>logging</i> mostly replaces them. <br>  The levels <i>Trace</i> and <i>Debug are</i> read by the developers, and all that is higher is technical support and admins.  Therefore, to the <i>Info</i> level, messages should accurately answer the questions: ‚ÄúWhat happened?‚Äù, ‚ÄúWhy?‚Äù And, if possible, ‚ÄúHow to fix it?‚Äù.  This is especially true for errors in the configuration files. <br><br>  The qualitative composition of the logging levels has already been analyzed in the previous article; here we consider only the quantitative composition: <br><ul><li>  <b>Trace</b> - output everything in a row.  In case the Debug does not allow to localize the error.  It is useful to mark the calls of various blocking and asynchronous operations. </li><li>  <b>Debug</b> - logging of the moments of calling "large" operations.  Start / stop flow, user request, etc. </li><li>  <b>Info</b> - one-time operations that are repeated very rarely, but not regularly.  (loading config, plugin, running backup) </li><li>  <b>Warning</b> - unexpected call parameters, strange request format, use of default values ‚Äã‚Äãin replacements not correct.  In general, everything that may indicate non-regular use. </li><li>  <b>Error</b> - a reason for the attention of developers.  Here the environment of a specific place of an error is interesting. </li><li>  <b>Fatal</b> - here and so it is clear.  We can display everything we can reach, as the application will not work further. </li></ul><br><br><h4>  Combat Deployment </h4><br><br>  Suppose the development has reached implementation. <br>  Postpone the issues of rotation logs, file size and depth of history.  This is all very specific for each project and is configured depending on the actual operation of the service. <br><br>  I will focus only on the semantic organization of files.  They should be divided into 3 groups.  It may be necessary to separate the logs of the modules into different files, but then I will still talk about one file for each group. <br><br><ol><li>  Group <b>Info</b> , with the appropriate level for all sources.  This is admin information.  There may be the following things: when the application has started, if the configs have been read correctly, if the required services are available, etc.  Its main property: the file resizes only when the application is restarted.  In the process, the file should not grow.  This will help provide automated external control of the success of the application launch.  It is enough to check the absence of the <i>Error</i> and <i>Fatal</i> keywords in the file.  Verification will always take a predictable little time. </li><li>  <b>Warning</b> group.  This is also information for the administrator.  This file during normal operation must be missing or empty.  Accordingly, monitoring of his condition will immediately indicate malfunctions.  Flexibly adjusting the filters for different sources, you can choose a fairly accurate criterion when you should pay attention to the service. </li><li>  Group <b>Observation</b> .  As a rule, during the implementation some problem modules are highlighted.  The information from them in the <i>Debug</i> detail is just sent here. </li></ol><br><br>  If the application is successfully implemented, then only the first two groups remain. <br><br><h5>  Crash Investigation </h5><br><br>  When a running service shows signs of an error, you should not attempt to restart it immediately.  Perhaps we are ‚Äúlucky‚Äù to catch the errors associated with incorrect synchronization of threads.  And it is not known how much next time to wait for her to repeat. <br>  First of all, you should connect previously prepared configs for the monitoring group.  This is exactly what a decent logger should allow to do.  When we received confirmation that the new configuration was successfully applied, we are trying to provoke a failure again.  Preferably several times.  This will provide an opportunity for its reproduction in "laboratory" conditions.  Next is the work of programmers.  In the meantime, you can reboot. <br><br>  The output to the log is desirable to make asynchronous. <br>  Example, combat settings. <br><blockquote> <code><font color="#009900"><font color="#000000">&lt;nlog</font> <font color="#000066">autoReload</font> = <font color="#ff0000">"true"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;targets <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">name</font> = <font color="#ff0000">"fileInfo"</font> <font color="#000066">type</font> = <font color="#ff0000">"AsyncWrapper"</font> <font color="#000066">queueLimit</font> = <font color="#ff0000">"5000"</font> <font color="#000066">overflowAction</font> = <font color="#ff0000">"Block"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">type</font> = <font color="#ff0000">"File"</font> <font color="#000066">fileName</font> = <font color="#ff0000">"${basedir}/logs/info.log"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/target <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">name</font> = <font color="#ff0000">"fileWarn"</font> <font color="#000066">type</font> = <font color="#ff0000">"AsyncWrapper"</font> <font color="#000066">queueLimit</font> = <font color="#ff0000">"5000"</font> <font color="#000066">overflowAction</font> = <font color="#ff0000">"Block"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">type</font> = <font color="#ff0000">"File"</font> <font color="#000066">fileName</font> = <font color="#ff0000">"${basedir}/logs/warn.log"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/target <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/targets <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;rules <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;logger</font> <font color="#000066">name</font> = <font color="#ff0000">"*"</font> <font color="#000066">minlevel</font> = <font color="#ff0000">"Info"</font> <font color="#000066">writeTo</font> = <font color="#ff0000">"fileInfo"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;logger</font> <font color="#000066">name</font> = <font color="#ff0000">"*"</font> <font color="#000066">minlevel</font> = <font color="#ff0000">"Warn"</font> <font color="#000066">writeTo</font> = <font color="#ff0000">"fileWarn"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/rules <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/nlog <font color="#000000">&gt;</font></font></font> <br></code> </blockquote> <code><font color="#009900"><font color="#000000">&lt;nlog</font> <font color="#000066">autoReload</font> = <font color="#ff0000">"true"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;targets <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">name</font> = <font color="#ff0000">"fileInfo"</font> <font color="#000066">type</font> = <font color="#ff0000">"AsyncWrapper"</font> <font color="#000066">queueLimit</font> = <font color="#ff0000">"5000"</font> <font color="#000066">overflowAction</font> = <font color="#ff0000">"Block"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">type</font> = <font color="#ff0000">"File"</font> <font color="#000066">fileName</font> = <font color="#ff0000">"${basedir}/logs/info.log"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/target <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">name</font> = <font color="#ff0000">"fileWarn"</font> <font color="#000066">type</font> = <font color="#ff0000">"AsyncWrapper"</font> <font color="#000066">queueLimit</font> = <font color="#ff0000">"5000"</font> <font color="#000066">overflowAction</font> = <font color="#ff0000">"Block"</font> <font color="#000000">&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;target</font> <font color="#000066">type</font> = <font color="#ff0000">"File"</font> <font color="#000066">fileName</font> = <font color="#ff0000">"${basedir}/logs/warn.log"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/target <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/targets <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;rules <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;logger</font> <font color="#000066">name</font> = <font color="#ff0000">"*"</font> <font color="#000066">minlevel</font> = <font color="#ff0000">"Info"</font> <font color="#000066">writeTo</font> = <font color="#ff0000">"fileInfo"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;logger</font> <font color="#000066">name</font> = <font color="#ff0000">"*"</font> <font color="#000066">minlevel</font> = <font color="#ff0000">"Warn"</font> <font color="#000066">writeTo</font> = <font color="#ff0000">"fileWarn"</font> <font color="#000000">/&gt;</font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/rules <font color="#000000">&gt;</font></font></font> &lt;br/&gt; <br> <font color="#009900"><font color="#000000">&lt;/nlog <font color="#000000">&gt;</font></font></font> <br></code> <br>  When configuring filters, consider the relativity of the logging levels for each of the subsystems.  For example, a module with an <i>Info</i> initialization message can be created for each connected user.  Of course, his output to the <i>Info</i> group should be limited to the <i>Warn</i> level. <br><br><h5>  What should not be done with the logger </h5><br><br>  Logger should be simple and reliable as a hammer.  And he should be clearly outlined the scope in a particular project.  Unfortunately, developers are often hard to keep.  Design patterns, this is mainly useful, but not in this case.  It was often enough to notice the proposals to allocate a generic interface ( <a href="">example</a> ) for the logger, or to implement a wrapper in the project in order to postpone the NLog vs log4net choice meal for later. <br><br>  Whatever the reason, we must remember that in the first place, such conveniences completely kill the possibility of optimization for the compiler. <br><br>  You should not directly display logger information to the user, even with filters.  The problem is that this information depends on the internal structure of the program.  It is unlikely that in the process of refactoring you are trying to save the logger output.  Probably, it‚Äôs just worth thinking about and sharing the functionality.  Perhaps the project just needs another level of logging.  In this case, the wrapper over the logger will be just appropriate. <br><br><h5>  What else is missing in NLog? </h5><br><ul><li>  <u>Additional overloading of logger methods</u> in order to avoid generating classes of lambda functions.  I want to have a call of the form <br>  <i>Log.Trace &lt;TArg1, TArg2&gt; (Func &lt;TArg1, TArg2, string&gt; messageCreater, TArg1 arg1, TArg2 arg2)</i> <br>  But at the moment, the shortest human-readable version implies hidden class generation: <br>  <i>Log.Trace (() =&gt; MessageCreate (arg1, arg2))</i> </li><li>  <u>Binary compatibility.</u>  It helps to quickly test services on different platforms.  NLog has a lot of conditional compilation instructions depending on the platform.  Those.  Mono binaries can unexpectedly work in DotNet.  A very desirable predictability, albeit in a limited configuration. </li><li>  <u>Conditional extensibility.</u>  It is clear that with binary compatibility it is necessary to sacrifice functionality, but we already have a convenient extension mechanism.  It remains only to filter extensions depending on the platform.  Together with the previous opportunity, it also provides a simple deployment through copying the directory with IL-binaries. </li><li>  <u>Logging internal messages in general context.</u>  A list of loggers created in the system would be useful.  Unfortunately, I'm not sure that recursion can be avoided.  For example, when output to a file starts writing output errors to itself. </li></ul><br><br><h5>  NLog, Log4Net, Enterprise Library, SmartInspect ... </h5><br><br>  A variety of logger comparisons between themselves, one important detail missing. <br>  It is important to compare not only the limitations / capabilities, but also the ability to quickly add your own wishes. <br><br>  Therefore, I will be friends with NLog for now. <br>  What you want. </div><p>Source: <a href="https://habr.com/ru/post/135242/">https://habr.com/ru/post/135242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135236/index.html">Volkswagen prohibits emails after hours</a></li>
<li><a href="../135237/index.html">OpenMPT program that surprised me</a></li>
<li><a href="../135239/index.html">Overview of external video cards for laptops</a></li>
<li><a href="../135240/index.html">Importing code from Android into the main Linux kernel</a></li>
<li><a href="../135241/index.html">Most downloaded apps for 2011</a></li>
<li><a href="../135243/index.html">‚ÄúArtificial Intelligence‚Äù by Google</a></li>
<li><a href="../135244/index.html">Viola Jones in own skin, part 1. Setting up the project under OpenCV</a></li>
<li><a href="../135246/index.html">Do I need a criminal liability. for developers whose fault someone suffered damage to health?</a></li>
<li><a href="../135248/index.html">Programming language D - continued</a></li>
<li><a href="../135249/index.html">Jack Goldman passed away - founder and director of Xerox PARC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>