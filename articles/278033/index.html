<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TOM.js is a special library for special cases.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all. 
 I do not know how correctly I described this library in the title, but I want to tell you about it. 



 What is it? 
 The library...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TOM.js is a special library for special cases.</h1><div class="post__text post__text-html js-mediator-article">  <b>Greetings to all.</b> <br>  I do not know how correctly I described this library in the title, but I want to tell you about it. <br><br><img src="https://habrastorage.org/files/b30/a5e/321/b30a5e32164f4886924f29ab216abddb.png"><br><br><h1>  What is it? </h1><br>  The library <b>TOM.js</b> makes it possible to facilitate such tasks as: <br><ul><li>  loading / uploading scripts / stylesheets with dependencies </li><li>  class creation / inheritance </li><li>  interception of functions within the application </li></ul><a name="habracut"></a><br><h1>  Why is it if there are analogues? </h1><br>  I am well aware of the fact that there are all sorts of <b>RequireJS</b> , <b>klass.js,</b> and so on, but this library is a development for several years for specific tasks in the project I'm working on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, I never met the function call interception functionality, but we needed this functionality in the project for developing extensions for all occasions, and later for other tasks.  And there already is the creation of classes with the necessary set of parameters and functions, and, of course, the file loader created taking into account the specifics of our project. <br><br><h1>  TOM.boot - loading modules and scripts with dependencies </h1><br>  Initially it was a small library, which in 4 years was rewritten several times already due to unpleasant dependency bugs.  The last time was an attempt to implement a load using <b>RequireJS</b> , with a small "add-in", but in the end this "add-in" turned out to be so twisted <i>(and also RequireJS had dependencies on its own concepts),</i> which turned out to be easier to implement its bootloader, but without allowing any errors were in past implementations. <br><br><h3>  What can this part of the library? </h3><br><ul><li><h4>  Loading modules and scripts </h4><br>  To load "modules" <i>(I will talk about them a little below)</i> and scripts, you can use about 5 variations of calls <br><br>  <b>1 way</b> , task: download <b>/libraries/jquery/jquery.boot.js</b> and <b>/libraries/scroll/scroll.boot.js</b> <br><pre><code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">'libraries/*'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-string"><span class="hljs-string">'scroll'</span></span> ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span>{ } );</code> </pre> <br>  <b>2 way</b> , task: download <b>/jquery/jquery.boot.js</b> <br><pre> <code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span>{ } );</code> </pre><br>  <b>3 way</b> , task: download <b>/jquery.boot.js</b> <br><pre> <code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span>{ } );</code> </pre><br>  <b>4 way</b> , task: load / <b>jquery.js</b> <br><pre> <code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery.js'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span>{ } );</code> </pre><br>  <b>5 way</b> , task: download <a href="">code.jquery.com/jquery-1.12.0.min.js</a> <br><pre> <code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'https://code.jquery.com/jquery-1.12.0.min.js'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span>{ } );</code> </pre><br>  As you can see from the examples - the structure of the call function is as follows: <br><pre> <code class="javascript hljs">TOM.boot.load( <span class="hljs-string"><span class="hljs-string">'  /'</span></span>, <span class="hljs-string"><span class="hljs-string">' /'</span></span> {  }, <span class="hljs-string"><span class="hljs-string">'callback   '</span></span> );</code> </pre><br>  The logic of selecting the full path is simple here - if there is no extension in the name, then we load the module <i>(* .boot.js)</i> , if there is, then a specific file.  A <b>*</b> <i>(asterisk)</i> in the path substitutes the name of the module / file in this place, which allows you to save a clear directory and file structure in large applications. <br><br></li><li><h4>  Loading scripts from the module with dependencies </h4><br>  To begin with, you should understand what a ‚Äúmodule‚Äù is in the understanding of this library. <br>  A module is a <b>* .boot.js</b> file that contains specific files and their dependencies on other ‚Äúmodules‚Äù and scripts. <br><br>  The contents of <b>* .boot.js</b> look like this: <br><pre> <code class="javascript hljs">TOM.boot.initiate( <span class="hljs-string"><span class="hljs-string">'button'</span></span>, [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: <span class="hljs-string"><span class="hljs-string">'*.style.css'</span></span> }, <span class="hljs-comment"><span class="hljs-comment">//  button.style.css { file: '*.interface.js' }, //  button.interface.js { file: '*.core.js', require: '*.interface.js' }, //  button.core.js    button.interface.js { file: 'testButton.core.js', require: [ 'jquery', '*.core.js' ] } //  testButton.core.js   ] );</span></span></code> </pre><br>  Here the structure is as follows: <br><pre> <code class="javascript hljs">TOM.boot.initiate( <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'     '</span></span> );</code> </pre><br>  Well, the objects themselves downloadable files have the following structure: <br><ul><li>  <b>file</b> is the name of the file to be loaded, where <b>*</b> <i>(asterisk)</i> substitutes the module name </li><li>  <b>require</b> - dependency <i>(list of dependencies)</i> both on the files of the current module and on other modules </li><li>  <b>initialize</b> - function <i>(list of functions)</i> that should be executed after loading the script </li><li>  <b>main</b> - a boolean variable indicating that everything in this module depends on the file </li></ul><br></li></ul><br><h1>  TOM.processor - interception of functions performed within the application </h1><br>  In fact, the interception of functions will take place only where you need it, only in those objects that you ‚Äúproxy‚Äù. <br>  In our project, for example, there are 3 objects that are registered in the <b>window</b> and with which we work, these are our so-called ‚Äúscopes‚Äù: <b>api</b> , <b>core</b> , <b>interface</b> and we work with them, therefore we only proxify them. <br><br>  <b>TOM.js</b> by default creates the <b>core</b> and <b>interface</b> , but working with them or not is a private matter for everyone. <br><br><h3>  How to work with it? </h3><br><ul><li><h4>  Proxy </h4><br>  The first thing that needs to be done is to make ‚Äúproxying‚Äù of the necessary objects in a similar way: <br><pre> <code class="javascript hljs">TOM.processor.proxy( core ); TOM.processor.proxy( interface );</code> </pre><br>  The essence of proxying is simple to ugliness - we pass through the object and wrap the functions with a certain look <i>(add pre-callback and post-callback)</i> . <br><br></li><li><h4>  Handling / Intercepting Function Calls </h4><br>  After processing the necessary objects, the functions called inside them can be processed in a similar way: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     TOM.processor.bind( 'pre-core.test.addTestButton', function( sender ) { //          -    if( !confirm( '  ?' ) ) { return false; } } );</span></span></code> </pre><br>  The handler has the following structure: <br><pre> <code class="javascript hljs">TOM.processor.bind( <span class="hljs-string"><span class="hljs-string">'{pre  post}-    '</span></span>, <span class="hljs-string"><span class="hljs-string">'callback '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> );</code> </pre><br><ul><li>  <b>pre</b> or <b>post</b> is the ‚Äúbefore calling‚Äù processing of the original function, or after ‚Äî respectively </li><li>  <b>parameters</b> is an object with the settings of this handler <br><ul><li>  <b>stage</b> - analogue of pre / post in function name </li><li>  <b>label</b> - ‚Äúlabel‚Äù by which we can remove this particular processor without affecting others. </li><li>  <b>priority</b> - add this handler to the beginning or to the end of the queue? </li></ul><br></li></ul></li><li><h4>  Other features </h4><br>  In addition to the ability to directly add and remove "handlers", you can also: <br><ul><li>  "Initiate fake events": <br><pre> <code class="javascript hljs">TOM.processor.signal( <span class="hljs-string"><span class="hljs-string">'  (pre/post)'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> );</code> </pre> </li><li>  perform one-time event handling: <br><pre> <code class="javascript hljs">TOM.processor.one( <span class="hljs-string"><span class="hljs-string">'       TOM.processor.bind'</span></span> );</code> </pre> </li></ul></li></ul><br><br><h1>  TOM.classes - creating and inheriting classes </h1><br>  This part of the library beats the standard approach to creating and inheriting classes in standard <b>JavaScript</b> , but with a large number of nuances and developments. <br><br><ul><li><h4>  How to create / inherit a class? </h4><br><ul><li>  <b>1st method</b> <br><pre> <code class="javascript hljs">TOM.classes.create( <span class="hljs-string"><span class="hljs-string">'  /      '</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   function constructor( ) { }, // --       -- // function foo( ) { }, function bar( ) { } )</span></span></code> </pre></li><li>  <b>2nd way</b> <br><pre> <code class="javascript hljs">TOM.classes.create( <span class="hljs-string"><span class="hljs-string">'  /      '</span></span>, <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'    '</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   function constructor( ) { }, //      [ function foo( ) { }, function bar( ) { } ] )</span></span></code> </pre></li><li>  <b>3rd way</b> - the same as <b>2nd</b> - but in the array is also a constructor </li></ul><br><br></li><li><h4>  What are the features of this script? </h4><br>  In addition to compatibility with <b>TOM.processor</b> , the function call from the parent works more or less adequately in the created classes with the help of: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.__parentCall__( ); <span class="hljs-comment"><span class="hljs-comment">//      arguments.callee this.__parentFunction__( ' ', '' ); //    </span></span></code> </pre><br>  And many other little things. <br>  <i><b>Note:</b> I know that arguments.callee is bad, and it does not work in <b>strict mode</b> , but I haven‚Äôt yet come up with a convenient replacement.</i> <br></li></ul><br><br>  <b>Demo page:</b> <a href="http://tredsnet.github.io/TOM/">tredsnet.github.io/TOM</a> <br>  <b>GitHub repository:</b> <a href="https://github.com/tredsnet/TOM">github.com/tredsnet/TOM</a> <br><br>  The library, of course, is not very prepared for publication, the code is not ‚Äúcleaned out‚Äù, unnecessary comments and notes are not removed, non-standard behavior is possible somewhere <i>(as it was tested only on our project)</i> .  But everything has its time, perhaps in this form the library will be useful to someone, and in the case of the interest of users, development is also possible in the right direction. <br><br>  Thank you for reading to the end.  I would welcome any comments, but please do not forget that the library was created for specific needs, a specific project. </div><p>Source: <a href="https://habr.com/ru/post/278033/">https://habr.com/ru/post/278033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278019/index.html">Table as parameter in postgresql</a></li>
<li><a href="../278021/index.html">DevTips: Web Developer Tips (49-64)</a></li>
<li><a href="../278023/index.html">Experiment: the creation of an algorithm for predicting the behavior of stock indices</a></li>
<li><a href="../278025/index.html">Security Week 08: Mice theft through a whistle, Blockbuster operation, Linux Mint with backdoor</a></li>
<li><a href="../278031/index.html">Problems of access control based on the access list in ECM systems (part 2)</a></li>
<li><a href="../278037/index.html">Handlersocket protocol in detail</a></li>
<li><a href="../278039/index.html">Again about STL</a></li>
<li><a href="../278041/index.html">Personalize IMGUI and Unity Editor. Part one</a></li>
<li><a href="../278043/index.html">The story of the endless city. On Three.js</a></li>
<li><a href="../278045/index.html">Configuring fault tolerance in 3CX Version 14</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>