<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kafka in Wargaming: a blitz</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why Kafka? What are the general impressions? What is the composition of the clusters? Under the cut - a dozen short questions for Levon Avakyan, who i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kafka in Wargaming: a blitz</h1><div class="post__text post__text-html js-mediator-article">  Why Kafka?  What are the general impressions?  What is the composition of the clusters?  Under the cut - a dozen short questions for Levon Avakyan, who is responsible for reliability, application architecture, infrastructure and production in Wargaming. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97a/0a5/8d7/97a0a58d7aefa424ce5c54754450e195.jpg"><br><a name="habracut"></a><br>  <b>- How did you choose Kafka?</b>  <b>What was used before?</b>  <b>What alternatives were considered?</b> <br><br>  Not a very correct question in relation to tank development.  Apache Kafka was already used in the company for the needs of our Data Warehouse, and the integration task was initially, and only then we saw that Kafka can be used for different tasks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>- How many events are generated by your game cluster?</b> <br><br>  A tank cluster is a cluster of clusters, the system is distributed and generates events in different Kafka.  All clusters generate an average of 12 thousand messages, peaking at about 30 thousand messages per second. <br><br>  <b>- How many clusters do you have and what is their composition?</b> <br><br>  The largest central cluster consists of five iron nodes.  Smaller clusters that serve only tank peripherals are about three nodes plus virtuals.  There are four local clusters for the CIS region. <br><br>  <b>- How many producers and consumers do you have?</b>  <b>What are read / write rates?</b> <br><br>  Good question.  For local peripheral Kafka, one producer is a tank cluster, and consumers are dozens.  According to rates: up to 75 thousand messages per second are written on the central cluster, an average of 12 thousand, up to seven thousand local and three thousand on average. <br><br>  <b>- How big events do you write in Kafka?</b>  <b>Is there a time limit for delivery?</b> <br><br>  Limit 1 MB - no one asked.  There are restrictions on delivery time for some consumer items, for some not.  Some read once a week. <br><br>  <b>- Have you encountered any interesting features and bugs during sharding or replication?</b> <br><br>  Faced with data loss during re-election due to topic settings.  Dirty re-election was allowed and an incorrect ISR was chosen. <br><br>  <b>- Did it happen to rest against the disk or the network?</b> <br><br>  The network did not rested, we have 10 Gbps network interfaces.  In the drive, too, did not rest.  Rested against the ending file descriptors.  Stability came after upgrading from java-1.7.0-openjdk-1.7.0.55-2.4.7.1.el6_5.x86_64 to jdk1.8.0_66-1.8.0_66-fcs.x86_64. <br><br>  <b>‚ÄúWhat overhead does JVM bring in the case of Kafka?‚Äù</b>  <b>Do I need a special gc setting?</b>  <b>How much memory does one instance use in your case?</b> <br><br>  12 GB of memory is allocated, everything else is standard. <br><br>  <b>- Did you have to use any special features Kafka?</b>  <b>Log Compaction?</b> <br>  Used Log Compaction for some topics, but not for the project World of Tanks.  Included on specific topics, but the result is not clear, no one gave feedback.  They also increased offsets.retention.minutes for up to seven days, so that the concierge, who read once a week, continued to read from where they left off. <br><br>  <b>- Which Python libraries used to work with Kafka?</b>  <b>What did you like?</b> <br><br>  Just one of <a href="https://conf.python.ru/2018/abstracts/3848">my reports</a> on Moscow Python Conf ++ will be about the experience of using various Python libraries for Kafka in WoT.  Our assets are Kafka-python, confluent-kafka-python, aiokafka.  Each of these libraries has its pros and cons. <br><br>  <b>- What would you say about the advantages and disadvantages of file-based storage in comparison with in-memory?</b>  <b>For what types of tasks would you recommend one or the other?</b> <br><br>  Here the principle is simple.  The file system is more reliable, but slower.  In memory faster, but also lower reliability.  Plus, there is an important limitation on the volume: you can store terabytes in the file system, and we still operate in gigabytes in memory.  From here you can fantasize a lot, starting from a specific implementation. <br><br>  Based on the above: if you need quickly, the volume is small and safety is not important, then in-memory, otherwise we look at file-based. <br><br>  <b>- General impressions of Kafka?</b>  <b>If you were doing the same task now, would you leave Kafka or look towards other solutions?</b> <br><br>  Kafka is a good and simple tool for providing access to large amounts of data from outside, which can then be slowly processed for different purposes, by different teams in different places.  In WoT, we have many different tools for solving our problems, therefore, where it is appropriate to choose Kafka, we choose Kafka, where not, we look at other tools. <br><br>  Again, if you are interested in the details of our experience with Kafka, come to my report on <a href="https://conf.python.ru/2018">Moscow Python Conf ++</a> .  I hope it will seem interesting and useful to many. </div><p>Source: <a href="https://habr.com/ru/post/425703/">https://habr.com/ru/post/425703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425691/index.html">Conference DEFCON 20. How to fuck the bad guys (and the mafia) using a JavaScript botnet. Part 1</a></li>
<li><a href="../425693/index.html">Search VPS 5 years! 70 hosters give discounts from 10 to 80%</a></li>
<li><a href="../425695/index.html">Reports about the battle of CI and CD, orchestration and secrets of OpenStack</a></li>
<li><a href="../425697/index.html">KotlinConf 2018 - keyout and first videos</a></li>
<li><a href="../425701/index.html">IoT Security Week 38: vulnerabilities in MikroTik, D-Link and TP-Link routers</a></li>
<li><a href="../425705/index.html">Replication from Percona Server for MySQL to PostgreSQL using the pg_chameleon tool</a></li>
<li><a href="../425707/index.html">Notification system from the console to Telegram</a></li>
<li><a href="../425709/index.html">We made a memo for the Chinese who came to you</a></li>
<li><a href="../425711/index.html">Losses in mismatched line</a></li>
<li><a href="../425713/index.html">Integration of HTML engine in native Windows application - choice and architecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>