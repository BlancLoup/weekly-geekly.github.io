<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Pester for testing when developing PowerShell scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I had to write complex, large PowerShell scripts and change them over time, I wanted to find a tool that would simplify the verification of the p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Pester for testing when developing PowerShell scripts</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/264697/"><img src="https://habrastorage.org/files/c1e/d33/484/c1ed3348474f440993d2b57f5c5217ac.png" align="left"></a>  When I had to write complex, large PowerShell scripts and change them over time, I wanted to find a tool that would simplify the verification of the performance of my scripts.  Such a tool turned out to be Pester, a unit testing framework. <br><br>  That he can and the basics of its use, and I will tell. <br><a name="habracut"></a><br>  Pester allows you to write tests to any commands or scripts executed in powershell.  Including functions, cmdlets, modules.  It allows you to group tests, so that you can run all the tests at once, or only the tests of a specific function or the tests of all the functions of a specific script. <br><br>  Pester can be launched in the powershell console or integrated into the development environment.  At the same time, it can be either one of the development environments created for PowerShell (PowerShell ISE, etc.), or Visual Studio using <a href="https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597">PowerShell Tools for Visual Studio 2015</a> .  Pester will help you if you have heard about <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">development through testing</a> and would like to try it for developing your scripts.  And if you have ready-made scripts for which you want to do tests - Pester will also help you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How to start.  Download and integrate Pester with PowerShell ISE </h4><br>  Pester is a powershell module written by Scott Muc and <a href="https://github.com/pester/Pester">published</a> on Github.  In order to use Pester you just need to download it and unpack it into a folder in one of the Modules folders on your computer. <br><br><img src="https://habrastorage.org/files/2d8/41d/ed6/2d841ded68fe485eb4da95ac7d4b8e39.png"><br><br><div class="spoiler">  <b class="spoiler_title">What is the Modules folder?</b> <div class="spoiler_text">  Folders Modules several.  For example, the Modules folder along the% UserProfile% \ Documents \ WindowsPowerShell \ Modules path allows you to store modules that are only needed by your account.  And, as a rule, this folder does not exist until you create it yourself.  And in the folder% windir% \ system32 \ WindowsPowerShell \ v1.0 \ Modules are stored modules that are available to all users. <br><br>  The current list of folders for storage of powershell modules for your system is stored in the $ env: PSModulePath environment variable.  For example, the list of Modules folders from my computer: <br><br><pre><code class="hljs tex">PS C:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">&gt;</span></span></span></span> <span class="hljs-formula"><span class="hljs-formula">$env:PSModulePath -split ';' F:</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Users</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">sgerasimov</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Documents</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">WindowsPowerShell</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Modules</span></span></span></span></span><span class="hljs-formula"> C:</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">system</span></span></span></span></span><span class="hljs-formula">32</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">WindowsPowerShell</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">v</span></span></span></span></span><span class="hljs-formula">1.0</span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name">Modules</span></span></span></span></span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span></span></span></code> </pre> <br>  This list may change when installing software, for example, the Lync Server administration tools add to the list the path to the folder with its modules. <br></div></div><br>  Use the Modules folder in the current user profile.  Create it using Explorer or using powershell, as shown below: <br><br><pre> <code class="hljs php">cd $env:USERPROFILE\documents <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-item -Name WindowsPowerShell -ItemType directory <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-item -Path .\WindowsPowerShell -Name Modules -ItemType directory</code> </pre><br><img src="https://habrastorage.org/files/616/322/69a/61632269a40f415d871887d4d7364075.png"><br><br>  After this, unzip the archive to the Pester folder in the Modules folder. <br><br><img src="https://habrastorage.org/files/6df/530/64e/6df53064ef274fb29cccf16edc164890.png"><br><br>  To integrate Pester with PowerShell ISE, create a file Microsoft.PowerShellISE_profile.ps1 in the% UserProfile% \ Documents \ WindowsPowerShell folder with the following content: <br><br><pre> <code class="hljs pgsql">try { <span class="hljs-keyword"><span class="hljs-keyword">Import</span></span>-Module Pester } catch { <span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">Warning</span></span> "  Pester  " }</code> </pre><br>  If the file already exists, simply add the above code to the file. <br><br>  Now, every time you start the PowerShell ISE module, Pester will load automatically and you just have to use it. <br><br><h4>  How to write tests and execute?  General scheme </h4><br>  Tests are written in separate files.  By default, the following solution is proposed: <br><br>  For each script, a file is created with the name of the script name.Tests.ps1.  For example, you have the CreateUser.ps1 script or you plan to write a script with that name.  Then you put the tests for this script and its functions in the CreateUser.Tests.ps1 file. <br><br>  When you write tests and run them, Pester will view all files with ".Tests." In the name in the current and in the subdirectories and run tests from them.  This allows, for example, to store test files in a subfolder, and not in a folder with scripts. <br><br>  The test file is a powershell script with groups of tests.  You can specify multiple levels of nesting of test groups using the Describe and Context commands.  The It command describes 1 test. <br><br>  Let me give you a very simple example that will show us how to use Pester to write and run tests.  To understand the scheme. <br><br><h5>  <i>Example</i> </h5><br>  Suppose you have a script that returns after performing ‚ÄúHello World!‚Äù And you need to write a test for it. <br><br>  You already have the HelloWorld.ps1 script file: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span></code> </pre><br>  Create a file called HelloWorld.Tests.ps1.  It will contain a test for your script, which will check that the script returns ‚ÄúHello world!‚Äù After launch: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">Describe</span></span> <span class="hljs-string"><span class="hljs-string">"  HelloWorld"</span></span> { it <span class="hljs-string"><span class="hljs-string">"   Hello World!"</span></span> { $<span class="hljs-keyword"><span class="hljs-keyword">result</span></span> = .\HelloWorld.ps1 $<span class="hljs-keyword"><span class="hljs-keyword">result</span></span> | Should Be <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> } }</code> </pre><br>  The Describe block describes in general which script is being tested, and the It block contains the test itself.  First line <br><pre> <code class="hljs perl">$result = .\HelloWorld.ps1</code> </pre>  executes the script and its results, and then the string <br><pre> <code class="hljs perl">$result | Should Be <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span></code> </pre>  describes what should be the result.  To do this, use the command <b>Should</b> which checks the compliance of the obtained value with the specified condition.  And the condition is set by the <b>Be</b> operator, who says that the condition is an equality to the string ‚ÄúHello World!‚Äù. <br><br>  If the test specified by the <b>Should</b> command succeeds, then the test is passed, otherwise the test is considered failed. <br><br>  Copy the code above into the HelloWorld.Tests.ps1 file and save this file. <br>  After that, make sure that the current directory points to the folder where the HelloWorld.ps1 and HelloWorld.Tests.ps1 files are located.  I have this ‚ÄúF: \ Projects \ iLearnPester \ Examples&gt;‚Äù and run the <u>Invoke-Pester</u> command to run the tests: <br><br><img src="https://habrastorage.org/files/5e9/711/f47/5e9711f478184441b5c443fafa859497.png"><br><br>  The test was successful.  This is indicated by the green color of the line with the name of the test (corresponds to the phrase after the block It).  If the test fails, the test name is displayed in red, and the following indicates what went wrong. <br><br><img src="https://habrastorage.org/files/ab8/d14/203/ab8d14203e724855ab29c620ebc39e86.png"><br><br>  The expected string was ‚ÄúHello World!‚Äù, But the script returned the string ‚ÄúHello all!‚Äù.  In addition, the test file and the line on which the failed test is in the test file are indicated. <br><br><blockquote>  If you want to try <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">development through testing</a> .  Then you first write the test, and then the script / function to it. </blockquote><br><br>  The <b>Should</b> command and the statement following it (for example, <b>Be</b> ) together create an Assertion.  Pester has the following statements: <br><ul><li>  Should be </li><li>  Should beExactly </li><li>  Should exist </li><li>  Should Contain </li><li>  Should ContainExactly </li><li>  Should match </li><li>  Should MatchExactly </li><li>  Should throw </li><li>  Should BeNullOrEmpty </li></ul><br>  Inside statement you can always insert Not and make a negative, for example: Should Not Be, Should Not Exist. <br><br><div class="spoiler">  <b class="spoiler_title">I'll tell you more about the approval</b> <div class="spoiler_text"><h5>  <i>Should be</i> </h5><br>  Compares one object to another and throws an exception if the objects are not equal.  Strings are ignored case insensitive, numbers, arrays of numbers and strings.  User objects (pscustomobject) and associative arrays are not compared. <br><br><pre> <code class="hljs mel"># $a = <span class="hljs-string"><span class="hljs-string">""</span></span> $a | Should Be <span class="hljs-string"><span class="hljs-string">""</span></span> #  $a | Should Be <span class="hljs-string"><span class="hljs-string">""</span></span> #  $a | Should Be <span class="hljs-string"><span class="hljs-string">" "</span></span> #  $a | Should Not Be <span class="hljs-string"><span class="hljs-string">" "</span></span> #  # $a = <span class="hljs-number"><span class="hljs-number">10</span></span> $a | Should Be <span class="hljs-number"><span class="hljs-number">10</span></span> #  $a | Should Be <span class="hljs-number"><span class="hljs-number">2</span></span> #  $a | Should Not <span class="hljs-number"><span class="hljs-number">2</span></span> #  #  $a = <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span> $a | Should Be <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span> #  $a | Should Be <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span> #  $a | Should Be <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span> #  #  $a = <span class="hljs-string"><span class="hljs-string">"qwer"</span></span>,<span class="hljs-string"><span class="hljs-string">"asdf"</span></span>,<span class="hljs-string"><span class="hljs-string">"zxcv"</span></span> $a | Should Be <span class="hljs-string"><span class="hljs-string">"qwer"</span></span>,<span class="hljs-string"><span class="hljs-string">"asdf"</span></span>,<span class="hljs-string"><span class="hljs-string">"ZXCV"</span></span> #  $a | Should Be <span class="hljs-string"><span class="hljs-string">"qwer"</span></span>,<span class="hljs-string"><span class="hljs-string">"asdf"</span></span>,<span class="hljs-string"><span class="hljs-string">"zxcv"</span></span>, <span class="hljs-string"><span class="hljs-string">"rrr"</span></span> # </code> </pre><br><h5>  <i>Should beExtactly</i> </h5><br>  Same as Should Be, only strings are compared case sensitive. <br><br><pre> <code class="hljs kotlin">$<span class="hljs-keyword"><span class="hljs-keyword">actual</span></span>=<span class="hljs-string"><span class="hljs-string">"Actual value"</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">actual</span></span> | Should BeExactly <span class="hljs-string"><span class="hljs-string">"Actual value"</span></span> #   $<span class="hljs-keyword"><span class="hljs-keyword">actual</span></span> | Should BeExactly <span class="hljs-string"><span class="hljs-string">"actual value"</span></span> #  </code> </pre><br><h5>  <i>Should exist</i> </h5><br>  Checks that the object exists and is available to one of the PS providers.  The most typical is to check that the file exists.  Essentially executes the test-path cmdlet for the passed value. <br><br><pre> <code class="hljs mel">$actual=(Dir . )[<span class="hljs-number"><span class="hljs-number">0</span></span>].FullName Remove-Item $actual $actual | Should Exist #   import-module ActiveDirectory $ADObjectFQDN = <span class="hljs-string"><span class="hljs-string">"AD:CN=Some User,OU=Users,DC=company,DC=com"</span></span> $ADObjectFQDN | Should Exist #      $registryKey = <span class="hljs-string"><span class="hljs-string">"HKCU:\Software\Microsoft\Driver Signing"</span></span> $registryKey | Should Exist #      .</code> </pre><br>  Note that you can only check for the presence of a registry branch in this way, but not for a specific key, since  PS provider working with the registry gives access to the keys as properties of registry branches.  He does not consider them objects. <br><br><h5>  <i>Should Contain</i> </h5><br>  Checks that the file contains the specified text.  The search is case insensitive and can use regular expressions. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-Content -<span class="hljs-type"><span class="hljs-type">Path</span></span> c:\<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>\file.txt -<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> <span class="hljs-string"><span class="hljs-string">'     '</span></span> <span class="hljs-string"><span class="hljs-string">'c:\temp\file.txt'</span></span> | Should Contain <span class="hljs-string"><span class="hljs-string">' '</span></span> #   <span class="hljs-string"><span class="hljs-string">'c:\temp\file.txt'</span></span> | Should Contain <span class="hljs-string"><span class="hljs-string">'*'</span></span> #  </code> </pre><br><h5>  <i>Should ContainExactly</i> </h5><br>  Checks that the file contains the specified text.  The search is case sensitive and can use regular expressions. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-Content -<span class="hljs-type"><span class="hljs-type">Path</span></span> c:\<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>\file.txt -<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> <span class="hljs-string"><span class="hljs-string">'     '</span></span> <span class="hljs-string"><span class="hljs-string">'c:\temp\file.txt'</span></span> | Should Contain <span class="hljs-string"><span class="hljs-string">' '</span></span> #   <span class="hljs-string"><span class="hljs-string">'c:\temp\file.txt'</span></span> | Should Contain <span class="hljs-string"><span class="hljs-string">'*'</span></span> #  </code> </pre><br><h5>  <i>Should match</i> </h5><br>  Compares two strings using case-insensitive regular expressions. <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">""</span></span> | Should Match <span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-meta"><span class="hljs-meta">#   </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta"> | Should Match ([regex]::Escape(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"."</span></span></span><span class="hljs-meta">)) #  </span></span></code> </pre><br><h5>  <i>Should MatchExactly</i> </h5><br>  Compares two strings using case-sensitive regular expressions. <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">""</span></span> | Should Match <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-meta"><span class="hljs-meta">#   </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta"> | Should Match </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"."</span></span></span><span class="hljs-meta"> #  </span></span></code> </pre><br><h5>  <i>Should throw</i> </h5><br><br>  It is considered true if an exception occurs in the script block being tested.  You can also specify the expected exception text. <br><br>  A script block is passed to the input.  With functions, unfortunately, does not work. <br><br><pre> <code class="hljs swift">{  } | <span class="hljs-type"><span class="hljs-type">Should</span></span> <span class="hljs-type"><span class="hljs-type">Throw</span></span> #   { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"    "</span></span> } | <span class="hljs-type"><span class="hljs-type">Should</span></span> <span class="hljs-type"><span class="hljs-type">Throw</span></span> <span class="hljs-string"><span class="hljs-string">"    "</span></span> #   { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"    "</span></span> } | <span class="hljs-type"><span class="hljs-type">Should</span></span> <span class="hljs-type"><span class="hljs-type">Throw</span></span> <span class="hljs-string"><span class="hljs-string">"    "</span></span> #   {<span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"    "</span></span>} | <span class="hljs-type"><span class="hljs-type">Should</span></span> <span class="hljs-type"><span class="hljs-type">Throw</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> #   { $foo = <span class="hljs-number"><span class="hljs-number">1</span></span> } | <span class="hljs-type"><span class="hljs-type">Should</span></span> <span class="hljs-type"><span class="hljs-type">Not</span></span> <span class="hljs-type"><span class="hljs-type">Throw</span></span> #  </code> </pre><br><h5>  <i>Should BeNullOrEmpty</i> </h5><br>  Checks that the value passed is $ null or empty (for a string, array, etc.).  It is worth recalling that $ null is not 0. <br><br><pre> <code class="hljs mel">$a = $null $b = <span class="hljs-number"><span class="hljs-number">0</span></span> $c = [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-string"><span class="hljs-string">""</span></span> $d = @() $a | Should BeNullOrEmpty #   $b | Should BeNullOrEmpty #   $c | Should BeNullOrEmpty #   $d | Should BeNullOrEmpty #  </code> </pre><br></div></div><br><h4>  What else can he do? </h4><br><h5>  <i>Mock functions.</i> </h5><br><br>  In Pester, there are mock functions that allow you to override any function or cmdlet before calling a test. <br><br>  For example, you are developing a script that will receive the ip-address of the current machine and, depending on which network this address belongs to, prescribe this or that dns-server in the adapter settings.  But your machine, on which you are developing a script, has only 1 ip address and it is troublesome to change it for tests.  Then you just before calling the test redefine the function that receives the ip-address so that it returns not the current address, but the one you need to check. <br><br>  Here is a sketch of our script (let's call it SmartChangeDNS.ps1). <br><br><pre> <code class="hljs mel">$MoskowNetworkMask = <span class="hljs-string"><span class="hljs-string">"192.168.1.0/24"</span></span> $RostovNetworkMask = <span class="hljs-string"><span class="hljs-string">"192.168.2.0/24"</span></span> $IPv4Addresses = GetIPv4Addresses foreach($Address <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $IPv4Addresses) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(CheckSubnet -cidr $MoskowNetworkMask -ip $Address) { # dns <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(CheckSubnet -cidr $RostovNetworkMask -ip $Address) { # dns <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> } }</code> </pre><br>  He knows 2 network masks in Moscow and Rostov.  Receives, using the <i>GetIPv4Addresses</i> function <i>,</i> all IPv4 addresses of the current machine and then, in the <i>foreach loop,</i> checks whether a subnet address is a <i>member of the CheckSubnet</i> function.  The functions <i>GetIPv4Addresses</i> and <i>CheckSubnet</i> you have already written and checked.  Now, to check the functions as a whole, we need to write tests in which we override the function <i>GetIPv4Addresses</i> so that it returns the desired address.  Here is how it is done: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">describe</span></span> <span class="hljs-string"><span class="hljs-string">"SmartChangeDNS"</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">it</span></span> <span class="hljs-string"><span class="hljs-string">"    192.168.1.0/24"</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">Mock</span></span> GetIPv4Addresses {<span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-string"><span class="hljs-string">"192.168.1.115"</span></span>} .\SmartChangeDNS.ps1 <span class="hljs-variable"><span class="hljs-variable">$DNSServerAddres</span></span> = Get-DnsClientServerAddress -InterfaceAlias <span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> -AddressFamily IPv4 | Select -ExpandProperty ServerAddresses <span class="hljs-variable"><span class="hljs-variable">$DNSServerAddres</span></span> | Should Be <span class="hljs-string"><span class="hljs-string">"192.168.1.1"</span></span> } it <span class="hljs-string"><span class="hljs-string">"    192.168.2.0/24"</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">Mock</span></span> GetIPv4Addresses {<span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-string"><span class="hljs-string">"192.168.2.20"</span></span>} .\SmartChangeDNS.ps1 <span class="hljs-variable"><span class="hljs-variable">$DNSServerAddres</span></span> = Get-DnsClientServerAddress -InterfaceAlias <span class="hljs-string"><span class="hljs-string">"Ethernet"</span></span> -AddressFamily IPv4 | Select -ExpandProperty ServerAddresses <span class="hljs-variable"><span class="hljs-variable">$DNSServerAddres</span></span> | Should Be <span class="hljs-string"><span class="hljs-string">"192.168.2.1"</span></span> } }</code> </pre><br>  Now, when the script is executed, it will come to the execution of the <i>GetIPv4Addresses</i> function, it will be executed not in the version indicated in the script, but in the one we defined with the Mock command. <br><br>  Redefining functions with Mock allows you to abstract, when needed, from external systems, modules, or called functions. <br><br><h5>  <i>Testdrive</i> </h5><br>  Pester also provides a temporary PS disk that can be used to work with the file system as part of test execution.  Such a disk exists within a single Describe or Context block. <br><br>  If the disc is created in the Describe block, then it and all files created on it are visible and available for modification in Context blocks.  Files created in the Context block with the completion of this block are deleted and only files created in the Describe block remain. </div><p>Source: <a href="https://habr.com/ru/post/264697/">https://habr.com/ru/post/264697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264685/index.html">Fast mail server on t2.micro with EC2 running CentOS 7</a></li>
<li><a href="../264687/index.html">How to increase the speed of 1C 100 times by direct access to MSSQL</a></li>
<li><a href="../264691/index.html">Combining offices in 3CX (Part 3. Use Raspberry PI)</a></li>
<li><a href="../264693/index.html">DxGetText - GNU Gettext for Delphi and C ++ Builder</a></li>
<li><a href="../264695/index.html">Talking to FPConf speakers</a></li>
<li><a href="../264699/index.html">Yandex added shortcuts for managing search results</a></li>
<li><a href="../264701/index.html">Work with Zip and 7z archives</a></li>
<li><a href="../264705/index.html">Glitches when drawing border-radius in Windows 10</a></li>
<li><a href="../264707/index.html">Writing a Telegram bot in Ruby in 10 lines</a></li>
<li><a href="../264709/index.html">Preparing for publication post with formulas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>