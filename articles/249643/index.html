<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New Year star with Wi-Fi based on ESP8266</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many years I have tried to make an unusual star on a New Year tree. The first option was a star with UV LEDs. They just shone without any chips. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New Year star with Wi-Fi based on ESP8266</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b37/01e/79e/b3701e79e509461aa6e4712f4b1b625c.jpg"><br><br>  For many years I have tried to make an unusual star on a New Year tree.  The first option was a star with UV LEDs.  They just shone without any chips.  The second version of the star was with LED tape.  Again, nothing interesting - just a static glow.  There were ideas to finish the modes, but there was not enough time. <br><br>  For the celebration of 2015, I decided to prepare in advance, starting the development of a new star a month before the new year.  I just got the first batch of new penny ($ 3) SoC ESP8266.  If it is interesting what came out of this, I ask for cat. <br><a name="habracut"></a><br>  ESP8266 is a fairly new platform, but on Habr√© and Hiktatimes there are already a few articles on this topic, for example: <a href="http://habrahabr.ru/company/coolrf/blog/235881/">"ESP8266: A revolution in the world of the Internet of things"</a> and <a href="http://geektimes.ru/post/241842/">"Working with ESP8266: Compiling the compiler and writing the first firmware</a> . <a href="http://geektimes.ru/post/241842/">"</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The last link is a small how-to on setting up the environment for creating firmware for ESP8266. <br><br>  First, I decided what I want to get from the device. <br>  The main requirements were: <br>  1. Ability to enable / disable the entire tree through the HTTP protocol; <br>  2. The ability to set the color of each ray of the star via the HTTP protocol; <br>  3. The presence of various "ready" modes for the star. <br><br>  To highlight the star's rays, I decided to use a pixel garland on an LPD6803 chip (I just had it already). <br><br>  I had two options for creating a device. <br><br>  The first option is to use the ESP8266 bundle with AT and Arduino Pro Mini firmware.  In this case, I would only need to register the logic of work: all the libraries under the Arduino already exist.  And the voltage regulators on board the Arduino Pro Mini are already available.  But this is not interesting ... <br><br>  So I went the second way - using only ESP8266 without an Arduino. <br>  I had in stock ESP8266 modification 01 (the most popular).  Here it is: <br><br><img src="https://habrastorage.org/files/9c1/0ac/b1a/9c10acb1a30a4d7fa0f03efbc420f60c.jpg"><br><br>  This modification has two derived GPIO ports, plus the UART_RX and UART_TX ports can be switched to GPIO mode.  For my crafts, three GPIO ports are required: DATA and CLK for LPD6803 and a port for controlling the switch on / off of the entire tree. <br><br>  For programming ESP8266, I decided to use a USB-UART converter on a PL2303 chip (which is easy to buy on ebay or aliexpress for a couple of dollars).  This converter has four pins: + 5V, GND, RX, TX.  The problem is that ESP8266 runs at 3.3V and 5V is not tolerant.  For this reason (and just for convenience) I decided to do something similar to the development board for ESP8266: <br><br><img src="https://habrastorage.org/files/f3e/c1c/c7a/f3ec1cc7aeb241e58eb122b71a9908eb.jpg"><br><br>  This board lowers the voltage to 3.3V using the LM317 regulator, has pins for outputting GPIO, UART, GND, 3.3V, 5V and DIP switches for putting ESP8266 into firmware mode (GPIO0 to GND, GPIO2 to 3.3V). <br><br>  Now a little about the implementation.  The main part of the whole project is the driver for LPD6803.  I ported it from the <a href="https://github.com/adafruit/LPD6803-RGB-Pixels">AdaFruit</a> Arduino library.  I will not talk about the principles of operation of the LPD6803 in this article, because  material pulls on another article. <br><br>  For those interested I will give some useful links: <br><br>  - <a href="http://www.adafruit.com/datasheets/LPD6803.pdf">Datashit</a> <br>  - <a href="https://github.com/popsodav/esp8266-lpd6803">My code under ESP8266 on github.com</a> <br><br>  In my implementation, GPIO0 is used to connect to DATA LPD6803, and GPIO2 to CLK.  For relyushki I needed to get another GPIO output.  <a href="http://esp8266.ru/esp8266-esp-01-hacked/">There were no dirty hacks to</a> apply, so I just reassigned UART_RX to GPIO (still, my firmware doesn't support any input from the user).  This line of code translates UART_RX to GPIO3: <br><br><pre><code class="hljs lisp">PIN_FUNC_SELECT(<span class="hljs-name"><span class="hljs-name">PERIPHS_IO_MUX_U0RXD_U</span></span>, FUNC_GPIO3)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  As a web server, I <a href="http://www.esp8266.com/viewtopic.php%3Ff%3D6%26t%3D376">used the code</a> from a friend of Sprite_tm.  This web server, as far as I know, is used in almost all amateur projects on ESP8266.  This web server already includes the functionality of connecting the device to the home network.  By default, the device works in the access point mode.  After connecting to this access point, the user can enter the browser at <a href="http://10.10.10.1/wifi">10.10.10.1/wifi</a> .  On this page, he will be able to select the desired network for connection (if necessary, you can select a hidden network and specify a password).  All web server responses can be obtained in JSON format, which is very convenient for integration into various systems and applications. <br><br>  There is nothing more to tell me about the software part, <a href="https://github.com/popsodav/umka-xmas-star-esp8266">the firmware code is available on github.com</a> . <br><br>  Now a little about the iron implementation.  Let's start with the case.  For him, I chose the old star, which once stood incandescent light bulbs.  The body looks like this: <br><br><img src="https://habrastorage.org/files/b08/342/70e/b0834270e92647f08568c21df4858441.jpg"><br><br>  I was lucky, because  RGB-LEDs with chips LPD6803 ideally stood in the clamps for incandescent lamps: <br><br><img src="https://habrastorage.org/files/b73/ae0/5b5/b73ae05b579b480db9e75a9a09284b82.jpg"><br><br>  I decided to place the ESP8266 module directly in the star, since  The quality of the Wi-Fi signal at the top of the tree will be better than under it. <br><br>  Under the tree, I installed a 12V power supply and a self-made motherboard of this type: <br><br><img src="https://habrastorage.org/files/060/4a3/9a4/0604a39a4bce4d479f90ce4df8ce79f6.jpg"><br><br>  As you can see, there are two voltage regulators on it, which give 5V and 3.3V.  5 volts is used LPD6803, and 3.3 volts, as already written above, ESP8266 eats.  In addition to the regulators, there is a 12V relyushka on the board.  Twitches through the transistor.  From the box under the tree to the star goes 4-core cable: 3.3V, 5V, GND and relay control channel. <br><br>  At the moment, there is a problem in the work of this star related to the bug in the TCP \ IP wrapper of the ESP8266 stack. <br>  To solve this problem, you need to switch to the direct use of lwip without a wrapper. <br><br>  There are two things in the development plans of the project: <br>  1. Implement the work through the MQTT protocol; <br>  2. Make a star with <a href="http://www.openhab.org/">OpenHab</a> . <br><br>  And finally, video work.  For management, the Android application is used (raw, so I do not post the source code).  Voiced by wife: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/2_95ADxcsJo%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhgq5av0lGVqxKnEt6b4Z6aOoad2xQ" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/249643/">https://habr.com/ru/post/249643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249633/index.html">What is CRM-systems and how to choose them correctly?</a></li>
<li><a href="../249635/index.html">Yandex killed service Subscriptions</a></li>
<li><a href="../249637/index.html">Twitter-based bot Markov and phrases from the series</a></li>
<li><a href="../249639/index.html">KISS - the design principle, containing all other design principles</a></li>
<li><a href="../249641/index.html">Diablo 3 - Resource Bubbles</a></li>
<li><a href="../249645/index.html">Kernel .Net (GC, JIT, interop, ...) in Open Source</a></li>
<li><a href="../249647/index.html">Making a queue of incoming calls with the callback function</a></li>
<li><a href="../249649/index.html">Configuring Kerio Control Firewall for 3CX Phone System</a></li>
<li><a href="../249651/index.html">1987 - Exhibition "Computer Science in the Life of the United States"</a></li>
<li><a href="../249653/index.html">Isomorphic BEM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>