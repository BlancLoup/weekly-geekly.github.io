<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accepting bank card payments in iOS apps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Following the previously developed SDK for the Windows Universal App ( which we already talked about in Habr√© ) and node.js, in May we developed and p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accepting bank card payments in iOS apps</h1><div class="post__text post__text-html js-mediator-article">  Following the previously developed SDK for the Windows Universal App ( <a href="http://habrahabr.ru/company/payonline/blog/248211/">which we already talked about in Habr√©</a> ) and node.js, in May we developed and published an SDK for iOS.  About what applications on iOS can accept payments through a third-party payment service, why it is needed and how to integrate the payment service into a mobile application, read under the cat.  And also - delicious fresh statistics on the share of mobile users in PayOnline payment traffic for the last 3 years.  Only for residents HabraHabr! <br><br><img src="https://habrastorage.org/files/c69/035/db7/c69035db7c6b454b8b35644006ad2207.png"><br><a name="habracut"></a><br><br>  Before proceeding to a detailed review of the Payment SDK for iOS and discuss the specifics of the requirements for the App Store, we want to share with you the statistics of PayOnline mobile payments for the last three years. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  The explosion of mobile traffic in 2013 - 2015 </h2><br>  When in the early 2010s we launched a product for receiving payments from mobile devices and from mobile applications <a href="http://www.payonline.ru/products/paymobile/about/">Pay-Mobile</a> , we didn‚Äôt even know what wild growth mobile traffic will show in the next few years. <br><br>  Today, the story of the beginning of the era of mobile commerce rushes from each iron, but to get adequate, accurate, and most importantly, statistical data localized in Russia is obtained with difficulty.  By entering into Google the query ‚Äúthe share of iOS in Russia‚Äù, we get a lot of approximate figures based on world statistics and device sales figures according to reports of the largest retail chains. <br><br>  Fortunately, we process tens of thousands of payments every day and have access to real indicators of how Russians pay on the Internet.  Today we will show you the data from 2013 to 2015, for which the read percent of payments from mobile devices turned into one fifth of our payment traffic. <br><br>  In 2013, mobile traffic grew more than 2 times faster than desktop, and in 2014 - more than 6 times.  And, apparently, in the coming years this movement will not stop.  The diagram below shows mobile traffic indicators for the last 3 years, divided by key mobile operating systems. <br><br>  Note that these numbers are distributed to the devices from which payments were successfully made through PayOnline.  Net commercial traffic without admixture of Internet surfers and users of free applications :) <br><br><img src="https://habrastorage.org/files/ab0/642/1c0/ab06421c013c45eb97b81dcfbfde3d64.png"><br><br><h2>  Go to Payment SDK PayOnline for iOS </h2><br>  The Payment SDK for iOS applications allows developers to easily and seamlessly integrate accepting bank card payments into a mobile application.  Why the developer of the Payment SDK application can be found in the material that we published on the blog <a href="http://habrahabr.ru/company/payonline/blog/248211/">at the beginning of the year</a> . <br><br>  What is most important?  The main thing is that by integrating payment acceptance using the iOS SDK, you will avoid WebView.  All elements of the payment process are embedded in the mobile application and customized for its design. <br><br>  Explaining in a nutshell: the SDK allows you to avoid diving into the depths of integration with the payment gateway, implementing the 3-D Secure security protocol and other non-targeted time and effort expenditures.  But before moving on to issues of integration, it is necessary to understand the difficult rules of Apple in relation to third-party payment services in applications. <br><br><h2>  What applications can accept payments in iOS applications other than through the App Store? </h2><br>  The question of whether it is possible at all to accept payments in iOS applications has been worrying the minds of developers and owners for more than a year, causing many discussions. <br><br>  To understand this question, we turned to the original source - ‚ÄúApp Store Review Guidelines‚Äù, chapter 11 ‚ÄúPurchasing and currencies‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Read the source</b> <div class="spoiler_text">  <b>Purchasing and currencies</b> <br>  11.1 Apps that unlock or enable the app Store will be rejected <br>  11.2 IAP Acquisition Purchase (API) IAP to Acquire Content <br>  11.3 Apps using IAP to purchase will be rejected <br>  11.4 Apps that use IAP to purchase currencies within the App <br>  11.5 Apps that use IAP to purchase currencies that expire will be rejected <br>  11.6 Content Subcategories IAP <br>  11.7 Apps for IAP to purchase items <br>  11.8 Apps for use with iOS, such as the camera or the gyroscope, will be rejected <br>  11.9 Apply for a specific approved meeting (eg, films, television, music, books) <br>  11.10 Insurance IAPs <br>  11.11 In general, you will review it <br>  11.12 Apps: IAP, Apple IAP; <br>  11.13 Apps, such as a "buy" button, will be rejected <br>  11.14 App (app) or the app. purchase the approved content.  Apple will only receive a portion of the app. <br>  11.15 Apps may use auto-renewal subscriptions for business and business apps (video, audio, voice, voice), and apps. <br>  11.16 Apps may be used in combination with specific approved physical hardware (such as a toy), so that there is no need for additional features and functionality telescope) or also available through the App without any physical products, such as IAP <br>  App. 17.17. </div></div><br>  If you do not go into the literal translation, the essence of the requirements of Apple is as follows: all goods and services of the virtual and digital plan must be paid through the App Store.  Otherwise, the application will be deleted. <br><br>  Thus, our Payment SDK will not be able to be used by owners of gaming, entertainment applications, digital content sellers, etc.  The issue of virtual goods is borderline, but more often it is also decided in favor of accepting payments through the App Store.  For example, the online store of digital books Liters accepts payments in the Android application through PayOnline, but on iOS - through the App Store. <br><br>  Another thing, if you made a mobile application for your online store, travel agency or ticket office.  The result of the transaction between you and your customer is a physical product or physical document confirming the right to use the service.  In this case, you can safely integrate payment acceptance through a third-party payment service and quickly receive funds to your bank account without losing time and money on the bad App Store commission. <br><br><h2>  How does the PayOnline Payment SDK for iOS work? </h2><br>  To connect the SDK, you need to add the libPayOnlineSdk.a library to the project and the PayOnlineSdk folder containing header files (you can download the library <a href="http://www.payonline.ru/developers/SDK/ios/">here</a> ). <br><br>  <b>To make a payment you need:</b> <br><br>  1. Create a PayOnlineConfiguration configuration object. <br><div class="spoiler">  <b class="spoiler_title">Code example:</b> <div class="spoiler_text"><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">PayOnlineConfiguration</span></span> *payOnlineConfiguration = [PayOnlineConfiguration configurationWithMerchantId:<span class="hljs-number"><span class="hljs-number">12345</span></span> privateKey: @<span class="hljs-string"><span class="hljs-string">"12-34-5"</span></span>];</code> </pre> </div></div><br>  2. Implement PayOnlineDelegate protocol methods. <br><div class="spoiler">  <b class="spoiler_title">Code example:</b> <div class="spoiler_text"><br><pre> <code class="hljs smalltalk">@implementation <span class="hljs-type"><span class="hljs-type">ViewController</span></span> ... <span class="hljs-symbol"><span class="hljs-symbol">#pragma</span></span> mark - <span class="hljs-type"><span class="hljs-type">PayOnlineDelegate</span></span> methods (void)payOnlineSuccess:(<span class="hljs-type"><span class="hljs-type">PayOnlinePayResponse</span></span> *)response { //    } (void)payOnlineDeclined:(<span class="hljs-type"><span class="hljs-type">PayOnlinePayResponse</span></span> *)response { //   } //   <span class="hljs-number"><span class="hljs-number">3</span></span>DS (void)payOnlineThreeDsRequired:(<span class="hljs-type"><span class="hljs-type">PayOnlinePayResponse</span></span> *)response { //      <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> *webView = [[<span class="hljs-type"><span class="hljs-type">UIWebView</span></span> alloc] initWithFrame:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bounds]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view addSubview:webView]; //   -    [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.processing navigateToAcsUrl:response delegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> webView:webView]; } (void)payOnlineError:(<span class="hljs-type"><span class="hljs-type">PayOnlineError</span></span> *)error { //  } @end</code> </pre> </div></div><br>  3. Create payment object PayOnlinePayRequest. <br><div class="spoiler">  <b class="spoiler_title">Code example:</b> <div class="spoiler_text"><br><pre> <code class="hljs objectivec">PayOnlinePayRequest *payRequest = [[PayOnlinePayRequest alloc] init]; payRequest.email = <span class="hljs-string"><span class="hljs-string">@"test@payonline.com"</span></span>; payRequest.cardNumber = <span class="hljs-string"><span class="hljs-string">@"4444333322221111"</span></span>; payRequest.ip = <span class="hljs-string"><span class="hljs-string">@"127.0.0.1"</span></span>; payRequest.cardExpMonth = <span class="hljs-number"><span class="hljs-number">1</span></span>; payRequest.cardExpYear = <span class="hljs-number"><span class="hljs-number">2015</span></span>; payRequest.cardHolderName = <span class="hljs-string"><span class="hljs-string">@"NAME SURNAME"</span></span>; payRequest.cardCvv = <span class="hljs-number"><span class="hljs-number">123</span></span>; payRequest.amount = [<span class="hljs-built_in"><span class="hljs-built_in">NSDecimalNumber</span></span> decimalNumberWithString:<span class="hljs-string"><span class="hljs-string">@"120.00"</span></span>]; payRequest.currency = PayOnlineCurrencyRub; payRequest.orderId = <span class="hljs-string"><span class="hljs-string">@"order12345"</span></span>;</code> </pre> </div></div><br>  4. Create a PayOnlineProcessing object based on the runtime configuration and call the pay method. <br><div class="spoiler">  <b class="spoiler_title">Code example:</b> <div class="spoiler_text"><br><pre> <code class="hljs cs">PayOnlineProcessing *processing = [PayOnlineProcessing processingWithConfig:payOnlineConfiguration]; [processing pay:payRequest <span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span>:payOnlineDelegate];</code> </pre> </div></div><br>  5. The work of the pay method will end with a call to one of the payOnlineDelegate methods. <br><br><h2>  Example of implementation - Ural Airlines mobile app for iOS </h2><br>  One of the first customers of our company to use the SDK to integrate a payment service into a mobile application for iOS was Ural Airlines. <br><br><img src="https://habrastorage.org/files/d86/260/4e9/d862604e931c4255998f420a1f9f3825.PNG"><br><br><div class="spoiler">  <b class="spoiler_title">If you want to see how the process of booking and paying for an in-app purchase occurs, click here.</b> <div class="spoiler_text">  It all starts with the entry of flight parameters: <br><br><img src="https://habrastorage.org/files/675/3f7/ca7/6753f7ca748b4dc69d048c6ad8887914.PNG"><br><br>  In the search results, select the appropriate flight: <br><br><img src="https://habrastorage.org/files/890/20f/960/89020f96092e41aca00b95915cbfca9d.PNG"><br><br>  Confirm the number of passengers and cost: <br><br><img src="https://habrastorage.org/files/3a2/364/e5c/3a2364e5c6194183ae2babca02e83355.PNG"><br><br>  Enter the passenger data: <br><br><img src="https://habrastorage.org/files/04c/e96/214/04ce96214df445b7bfa6c5d02b8cd675.PNG"><br><br>  And data of the payer.  PayOnline will send a payment receipt to the entered email address immediately after the payment is completed: <br><br><img src="https://habrastorage.org/files/ccb/bb7/9ec/ccbbb79ecf034b26bee5c3471023dd15.PNG"><br><br>  After that, the ticket is booked so that at the moment when you make the payment, no one bought your ticket directly ‚Äúin front of you‚Äù (which can be especially offensive if the ticket was last): <br><br><img src="https://habrastorage.org/files/671/6b7/cc6/6716b7cc62b04d44af81caaad510992c.PNG"><br><br>  And finally, payment.  As you can see, the design of the payment form is no different from the design of the rest of the mobile application screens.  And the conciseness of the form allows to minimize the proportion of failures at the payment stage: <br><br><img src="https://habrastorage.org/files/baa/493/41f/baa49341f95d4906babc1cdaf7ef49c7.PNG"><br><br>  The payment processing screen also corresponds to the overall design of the application: <br><br><img src="https://habrastorage.org/files/753/eef/6ad/753eef6ad1e34be5be60f222e0088f45.PNG"><br><br>  We did not make the payment completion screen, because at that time Ekaterinburg nobody was going to fly :) <br>  But monitoring data daily report successful payments through the app. <br></div></div><br><br><h2>  What besides technical integration? </h2><br><h4>  Entity </h4><br>  Only a legal entity or an individual entrepreneur can enter into a contract with PayOnline. <br><br><h4>  Site </h4><br>  The easiest way to connect accept payments in a mobile application, if you already have an online store or another commercial site.  During the connection of accepting payments through the processing center (or through a bank directly) you will be given a so-called ‚Äúterminal‚Äù - your site identifier.  Directly with the mobile applications, the vast majority of banks in Russia do not work.  They are connected after the site and issue an additional terminal to the application. <br><br>  Therefore, if you do not have a website, for a painless and easy connection to accept payments in applications, you will need to make a simple business card site that meets the minimum requirements. <br><br><h4>  Commission rate </h4><br>  The commission rate is determined individually depending on the turnover of payments in the application and the level of risk with your business segment.  The logic is clear: higher turnover - lower rate, higher risks - higher rate. <br><br><h4>  Payouts </h4><br>  Funds are transferred to your bank account on the 2nd or 6th day (depending on the selected base payment product). <br><br><blockquote>  <i>That's all that we wanted to tell today about the Payment SDK for iOS and the specifics of setting payment acceptance in mobile apps on iOS.</i>  <i>We are pleased to answer your questions in the comments!</i> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/258919/">https://habr.com/ru/post/258919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258909/index.html">Customer questions in the negotiations on the development of mobile applications</a></li>
<li><a href="../258911/index.html">The use of simulators in robotics on the example of the Gazebo simulator and the DARwIn-OP robot playing football</a></li>
<li><a href="../258913/index.html">Web page rendering optimization</a></li>
<li><a href="../258915/index.html">Innovations in Cordova 5.0</a></li>
<li><a href="../258917/index.html">Oberon is dead, long live Oberon! Part 1. Some like more active</a></li>
<li><a href="../258921/index.html">First day of PHDays V: from SMS interception to satellite hacking</a></li>
<li><a href="../258925/index.html">Smart Cities and Big Data</a></li>
<li><a href="../258927/index.html">Salesforce Data Migration with Pentaho Data Integration</a></li>
<li><a href="../258929/index.html">10 Tips to Improve Email Support</a></li>
<li><a href="../258931/index.html">Website based on a single HTML page</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>