<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Auto-collection of data about database files and logical disks of the operating system in MS SQL Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 


 It is important for the database administrator to know when the disk space will run out. And in order not to do this manually on each ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Auto-collection of data about database files and logical disks of the operating system in MS SQL Server</h1><div class="post__text post__text-html js-mediator-article"><h3>  Foreword </h3><br><p>  It is important for the database administrator to know when the disk space will run out.  And in order not to do this manually on each server, it is better to automate this process. </p><br><p>  In this article I will give an implementation of the automatic daily collection of information about logical disks and database files. </p><br><a name="habracut"></a><br><h3>  Decision </h3><br><p>  Algorithm: </p><br><p>  1) create a table to store information: <br>  1.1) for database files: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[DBFile]( [DBFile_GUID] [uniqueidentifier] ROWGUIDCOL <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [Drive] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [Physical_Name] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [Ext] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [Growth] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [IsPercentGrowth] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DB_ID] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DB_Name] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [SizeMb] [<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DiffSizeMb] [<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [InsertUTCDate] [datetime] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UpdateUTCdate] [datetime] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [File_ID] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [PK_DBFile] PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED ( [DBFile_GUID] <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span> )<span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (PAD_INDEX = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, STATISTICS_NORECOMPUTE = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, IGNORE_DUP_KEY = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, ALLOW_ROW_LOCKS = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, ALLOW_PAGE_LOCKS = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [PRIMARY] ) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [PRIMARY] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[DBFile] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_DBFile_DBFile_GUID] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (newid()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [DBFile_GUID] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[DBFile] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_DBFile_InsertUTCDate] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">getutcdate</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [InsertUTCDate] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[DBFile] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_DBFile_UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">getutcdate</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  1.2) for logical drives: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers]( [Driver_GUID] [uniqueidentifier] ROWGUIDCOL <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>](<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [TotalSpace] [<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [FreeSpace] [<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DiffFreeSpace] [<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [InsertUTCDate] [datetime] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [UpdateUTCdate] [datetime] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [PK_Drivers] PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED ( [Driver_GUID] <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span> )<span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (PAD_INDEX = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, STATISTICS_NORECOMPUTE = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, IGNORE_DUP_KEY = <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, ALLOW_ROW_LOCKS = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, ALLOW_PAGE_LOCKS = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [PRIMARY] ) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [PRIMARY] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_Driver_GUID] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (newid()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [Driver_GUID] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_Server] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (@@servername) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_TotalSpace] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [TotalSpace] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_FreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [FreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_DiffFreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [DiffFreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_InsertUTCDate] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">getutcdate</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [InsertUTCDate] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [DF_Drivers_UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">getutcdate</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> [UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  The table with logical disks must be filled in advance as follows: <br>  server name - volume label (MyServer - C :). </p><br><p>  2) create the necessary view to collect information about database files: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [inf].[ServerDBFileInfo] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @@Servername <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> , File_id ,<span class="hljs-comment"><span class="hljs-comment">--    .   file_id   1 Type_desc ,--   Name as [FileName] ,--      LEFT(Physical_Name, 1) AS Drive ,-- ,     Physical_Name ,--      RIGHT(physical_name, 3) AS Ext ,--  Size as CountPage, --      8  round((cast(Size*8 as float))/1024,3) as SizeMb, --    Growth, -- is_percent_growth, --   database_id, DB_Name(database_id) as [DB_Name] FROM sys.master_files--database_files GO</span></span></code> </pre> </div></div><br><p>  It uses the <a href="https://technet.microsoft.com/ru-ru/library/ms186782(v%3Dsql.110).aspx">sys.master_files</a> system view <a href="https://technet.microsoft.com/ru-ru/library/ms186782(v%3Dsql.110).aspx">.</a> </p><br><p>  3) create a stored procedure that returns information on the logical drive: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> [srv].[sp_DriveSpace] @DrivePath <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">1024</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- (    'C:') , @TotalSpace float output --    , @FreeSpace float output --    as begin DECLARE @fso int , @Drive int , @DriveName varchar(255) , @Folder int , @Drives int , @source varchar(255) , @desc varchar(255) , @ret int , @Object int --     exec @ret = sp_OACreate 'Scripting.FileSystemObject', @fso output set @Object = @fso if @ret != 0 goto ErrorInfo --      exec @ret = sp_OAmethod @fso, 'GetFolder', @Folder output, @DrivePath set @Object = @fso if @ret != 0 goto ErrorInfo --   exec @ret = sp_OAmethod @Folder, 'Drive', @Drive output set @Object = @Folder if @ret != 0 goto ErrorInfo --     exec @ret = sp_OAGetProperty @Drive, 'TotalSize', @TotalSpace output set @Object = @Drive if @ret != 0 goto ErrorInfo --      exec @ret = sp_OAGetProperty @Drive, 'AvailableSpace', @FreeSpace output set @Object = @Drive if @ret != 0 goto ErrorInfo DestroyObjects: if @Folder is not null exec sp_OADestroy @Folder if @Drive is not null exec sp_OADestroy @Drive if @fso is not null exec sp_OADestroy @fso return (@ret) ErrorInfo: exec sp_OAGetErrorInfo @Object, @source output, @desc output print 'Source error: ' + isnull( @source, 'n/a' ) + char(13) + 'Description: ' + isnull( @desc, 'n/a' ) goto DestroyObjects; end GO</span></span></code> </pre> </div></div><br><p>  This stored procedure was taken from the following article. <a href="http://www.t-sql.ru/post/disk_size.aspx">T-SQL Disk Size</a> </p><br><p>  4) create a stored procedure to collect information: <br>  4.1) for database files: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [srv].[MergeDBFileInfo] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISOLATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEVEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> UNCOMMITTED; ;<span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> [srv].[DBFile] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> [inf].[ServerDBFileInfo] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ff <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> f.File_ID=ff.File_ID <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> f.DB_ID=ff.[database_id] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> f.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]=ff.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">matched</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> UpdateUTcDate = <span class="hljs-keyword"><span class="hljs-keyword">getUTCDate</span></span>() ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] = ff.[FileName] ,[Drive] = ff.[Drive] ,[Physical_Name] = ff.[Physical_Name] ,[Ext] = ff.[Ext] ,[Growth] = ff.[Growth] ,[IsPercentGrowth] = ff.[is_percent_growth] ,[SizeMb] = ff.[SizeMb] ,[DiffSizeMb] = <span class="hljs-keyword"><span class="hljs-keyword">round</span></span>(ff.[SizeMb]-f.[SizeMb],<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">matched</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> target <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> ( [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] ,[Drive] ,[Physical_Name] ,[Ext] ,[Growth] ,[IsPercentGrowth] ,[DB_ID] ,[DB_Name] ,[SizeMb] ,[File_ID] ,[DiffSizeMb] ) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> ( ff.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ,ff.[FileName] ,ff.[Drive] ,ff.[Physical_Name] ,ff.[Ext] ,ff.[Growth] ,ff.[is_percent_growth] ,ff.[database_id] ,ff.[DB_Name] ,ff.[SizeMb] ,ff.[File_id] ,<span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">matched</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> f.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]=@@SERVERNAME <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  4.2) for logical drives: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [srv].[MergeDriverInfo] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISOLATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEVEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> UNCOMMITTED; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @Drivers <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> ( [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>), TotalSpace <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>, FreeSpace <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>, DiffFreeSpace <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> @Drivers ( [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, TotalSpace, FreeSpace ) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>, TotalSpace, FreeSpace <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> srv.Drivers <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]=@@SERVERNAME; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @TotalSpace <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @FreeSpace <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @DrivePath <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">8</span></span>); while(exists(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @Drivers <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> DiffFreeSpace <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) @DrivePath=<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @Drivers <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> DiffFreeSpace <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; exec srv.sp_DriveSpace @DrivePath = @DrivePath , @TotalSpace = @TotalSpace out , @FreeSpace = @FreeSpace out; <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> @Drivers <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> TotalSpace=@TotalSpace ,FreeSpace=@FreeSpace ,DiffFreeSpace=<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> FreeSpace&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">round</span></span>(FreeSpace-@FreeSpace,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=@DrivePath; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ;<span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> @Drivers <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dd <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> d.Name=dd.Name <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> d.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]=dd.[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">matched</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> UpdateUTcDate = <span class="hljs-keyword"><span class="hljs-keyword">getUTCDate</span></span>() ,[TotalSpace] = dd.[TotalSpace] ,[FreeSpace] = dd.[FreeSpace] ,[DiffFreeSpace]= dd.[DiffFreeSpace]; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  5) create views to display information: <br>  5.1) for database files: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [srv].[vDBFiles] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [DBFile_GUID] ,[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] ,[Drive] ,[Physical_Name] ,[Ext] ,[Growth] ,[IsPercentGrowth] ,[DB_ID] ,[File_ID] ,[DB_Name] ,[SizeMb] ,[DiffSizeMb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([SizeMb]/<span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [SizeGb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffSizeMb]/<span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffSizeGb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([SizeMb]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [SizeTb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffSizeMb]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffSizeTb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffSizeMb]/([SizeMb]/<span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffSizePercent] ,[InsertUTCDate] ,[UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [srv].[DBFile]; GO</code> </pre> </div></div><br><p>  5.2) for logical drives: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [srv].[vDrivers] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> [Driver_GUID] ,[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] ,[TotalSpace] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [TotalSpaceByte] ,[FreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpaceByte] ,[DiffFreeSpace] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpaceByte] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([TotalSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [TotalSpaceKb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([FreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpaceKb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffFreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpaceKb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([TotalSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [TotalSpaceMb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([FreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpaceMb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffFreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpaceMb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([TotalSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [TotalSpaceGb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([FreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpaceGb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffFreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpaceGb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([TotalSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [TotalSpaceTb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([FreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpaceTb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffFreeSpace]/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>/<span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpaceTb] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([FreeSpace]/([TotalSpace]/<span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [FreeSpacePercent] ,<span class="hljs-keyword"><span class="hljs-keyword">round</span></span>([DiffFreeSpace]/([TotalSpace]/<span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> [DiffFreeSpacePercent] ,[InsertUTCDate] ,[UpdateUTCdate] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [srv].[Drivers] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  6) create a task in the Agent and run it once a day: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__]; GO exec srv.MergeDBFileInfo; exec srv.MergeDriverInfo;</code> </pre> <br><p>  7) to collect all the information received from the servers (it is also possible through the task of the agent or by other means) </p><br><p>  8) create a stored procedure for generating a report and sending it to administrators.  You can implement in different ways.  Therefore, I will give only an example: </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> [__] <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> QUOTED_IDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [srv].[GetHTMLTableShortInfoDrivers] @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">OUTPUT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ISOLATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEVEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">READ</span></span> UNCOMMITTED; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @tbl <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> ( Driver_GUID uniqueidentifier ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) ,[TotalSpaceGb] <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,[FreeSpaceGb] <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,[DiffFreeSpaceMb] <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,[FreeSpacePercent] <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,[DiffFreeSpacePercent] <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,UpdateUTCDate datetime ,[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) ,<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @Driver_GUID uniqueidentifier ,@<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) ,@TotalSpaceGb <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,@FreeSpaceGb <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,@DiffFreeSpaceMb <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,@FreeSpacePercent <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,@DiffFreeSpacePercent <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ,@UpdateUTCDate datetime ,@<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) ,@<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> @tbl( Driver_GUID ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] ,[TotalSpaceGb] ,[FreeSpaceGb] ,[DiffFreeSpaceMb] ,[FreeSpacePercent] ,[DiffFreeSpacePercent] ,UpdateUTCDate ,[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> Driver_GUID ,[<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] ,[TotalSpaceGb] ,[FreeSpaceGb] ,[DiffFreeSpaceMb] ,[FreeSpacePercent] ,[DiffFreeSpacePercent] ,UpdateUTCDate ,[<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> srv.vDrivers <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> [DiffFreeSpacePercent]&lt;=<span class="hljs-number"><span class="hljs-number">-5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> [FreeSpacePercent]&lt;=<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span>; if(exists(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @tbl)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=<span class="hljs-string"><span class="hljs-string">'       ,        15%,      5%  :&lt;br&gt;&lt;br&gt;'</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TABLE BORDER=5&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TR&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'‚Ññ /'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">', .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">', .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'  , .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">', %'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'  , %'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'UTC  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TR&gt;'</span></span>; while((<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @tbl)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TR&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> top <span class="hljs-number"><span class="hljs-number">1</span></span> @Driver_GUID = Driver_GUID ,@<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> ,@TotalSpaceGb = TotalSpaceGb ,@FreeSpaceGb = FreeSpaceGb ,@DiffFreeSpaceMb = DiffFreeSpaceMb ,@FreeSpacePercent = FreeSpacePercent ,@DiffFreeSpacePercent = DiffFreeSpacePercent ,@UpdateUTCDate = UpdateUTCDate ,@<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>] ,@<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @tbl; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@Driver_GUID <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@TotalSpaceGb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@FreeSpaceGb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@DiffFreeSpaceMb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@FreeSpacePercent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(@DiffFreeSpacePercent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+rep.GetDateFormat(@UpdateUTCDate, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+rep.GetTimeFormat(@UpdateUTCDate, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TD&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> @tbl <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TR&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;/TABLE&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>=@<span class="hljs-keyword"><span class="hljs-keyword">body</span></span>+<span class="hljs-string"><span class="hljs-string">'&lt;br&gt;&lt;br&gt;       SRV.srv.vDrivers&lt;br&gt;&lt;br&gt;          __.srv.vDBFiles'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre> </div></div><br><p>  This stored procedure generates an HTML report on logical disks that have either less than 15% of free space left, or less than 5% of free space per day.  The latter indicates the strange activity of the recordings (someone writes too often and on this disc a lot).  The first may be due to one of several reasons: <br>  1) it's time to increase the disk <br>  2) it is necessary to remove unused space on the logical disk <br>  3) clean and compress log files, as well as informational and other tables. </p><br><h3>  Result </h3><br><p>  This article has reviewed an example of the implementation of the system of daily automatic collection of information about local disks and database files.  This information allows you to know in advance on which disk free space is getting smaller, as well as which database files are growing significantly.  This allows you to prevent the case when there is no disk space left, and also to identify the reason why a process takes up a significant part of the disk space with its own records, etc. </p><br><h3>  Sources: </h3><br><p>  ¬ª <a href="https://technet.microsoft.com/ru-ru/library/ms186782(v%3Dsql.110).aspx">Sys.master_files</a> <br>  " <a href="http://www.t-sql.ru/post/disk_size.aspx">T-SQL Disk Capacity</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/314522/">https://habr.com/ru/post/314522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314510/index.html">6 functional programming concepts. Use and examples of use</a></li>
<li><a href="../314512/index.html">Names of large numbers in idle games</a></li>
<li><a href="../314514/index.html">Sudoku: so how many of them? Part 2/2</a></li>
<li><a href="../314518/index.html">Working with the VKontakte C # API</a></li>
<li><a href="../314520/index.html">Measurement of resistance and inductance of a DC motor</a></li>
<li><a href="../314524/index.html">.NET Tools. Interview with Sergey Shkredov (JetBrains), Pavel Avsenin and Alexander Zakharov (DevExpress)</a></li>
<li><a href="../314528/index.html">The power of ITIL and the problem with the guru</a></li>
<li><a href="../314532/index.html">Procedural vegetation on OpenGL and GLSL</a></li>
<li><a href="../314534/index.html">Bug Inside: a tiny chance to make a huge mistake on the Pentium</a></li>
<li><a href="../314536/index.html">Mars Rover, Introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>