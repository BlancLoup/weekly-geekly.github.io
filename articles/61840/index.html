<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UserJS. Part 3: Security</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes how dangerous some userjs tricks are and how to cope with this danger. 

 Other articles in the series: 

- Part 1: Introductio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UserJS. Part 3: Security</h1><div class="post__text post__text-html js-mediator-article">  This article describes how dangerous some userjs tricks are and how to cope with this danger. <br><br>  Other articles in the series: <ul><li>  <a href="http://habrahabr.ru/blogs/opera/61835/">Part 1: Introduction</a> </li><li>  <a href="http://habrahabr.ru/blogs/opera/61837/">Part 2: Tricks</a> </li><li>  <a href="http://habrahabr.ru/blogs/opera/62045/">Part 4: libretki framework</a> </li></ul><br><a name="habracut"></a><br><h4>  LiveConnect </h4><br>  The danger of this technology is obvious.  As soon as you allow access from some address to advanced features (for example, work with the clipboard), all scripts from this address can use advanced features for their own purposes (for example, send the contents of the clipboard to the site - suddenly there is a password). <br><br>  The solution is to allow access to only one address - ‚Äúhttp://0.0.0.0/‚Äù; open a frame with this address and perform all actions via XDM.  The disadvantage is that all calls become asynchronous.  But what can't you do for the sake of safety.  Yes, and there is some plus in this - the scripts on the page will not hang waiting for some long synchronous call. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now you need to secure XDM. <br><br><h4>  Xdm </h4><br>  Any script on the page can find the iframe and send it a message.  It is enough to know the format of messages.  Finding is not a problem if userjs is online.  Yes, even if userjs is written by you and for yourself, it is often easy to guess the format. <br><br>  So, the task is to make the format unstable.  For this you need: <br><ul><li>  for each user to generate a password; </li><li>  add to the beginning of each message; </li><li>  use the ‚ÄúBeforeEvent.message‚Äù event to be the first to know about the message; </li><li>  process only messages with a suitable password; </li><li>  use the ‚ÄúEvent.preventDefault‚Äù function to prevent the script from receiving messages on the page. </li></ul><br><br><h4>  Canned functions </h4><br>  But this is still not enough to ensure safety. <br><br>  Unfortunately, userjs are running in the context of the page.  So all modifications of objects by scripts from the page are reflected in userjs. <br><br>  Suppose password checking in userjs is done as follows: <br><pre> if (ev.data.substring (0, password.length) == password) {...}
</pre><br><br>  Then the script on the page can execute: <br><pre> String.prototype.substring = function (start, len) {alert (this);  }
</pre><br>  and get a password! <br><br>  It is necessary to save the functions used in critical places of userjs: <br><pre> // At the very beginning of the script.
 var functionCall = Function.prototype.call;
 var stringSubstring = String.prototype.substring;

 // In the event handler.
 stringSubstring.call = functionCall;
 if (stringSubstring.call (ev.data, 0, password.length) == password) {...}
</pre></div><p>Source: <a href="https://habr.com/ru/post/61840/">https://habr.com/ru/post/61840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61833/index.html">Expand comment</a></li>
<li><a href="../61835/index.html">UserJS. Part I: Introduction</a></li>
<li><a href="../61836/index.html">Is the end of Beltelecom's monopoly close?</a></li>
<li><a href="../61837/index.html">UserJS. Part 2: Tricks</a></li>
<li><a href="../61839/index.html">FMSPy, Alpha release (0.1)</a></li>
<li><a href="../61842/index.html">Preventive protection of your and not your scripts</a></li>
<li><a href="../61845/index.html">Determine the order of the columns in the composite index</a></li>
<li><a href="../61847/index.html">New beta: Flash Builder 4, Flash Catalyst, Flex SDK 4</a></li>
<li><a href="../61848/index.html">Accelerate Windows 7. Part last</a></li>
<li><a href="../61849/index.html">Hypertext generator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>