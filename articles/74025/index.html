<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cooking plugin for qutIM at home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will be engaged in the preparation of the plugin for qutIM, but not for the one that was recently released, but for the future, which is bein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cooking plugin for qutIM at home</h1><div class="post__text post__text-html js-mediator-article">  Today we will be engaged in the preparation of the plugin for qutIM, but not for the one that was recently released, but for the future, which is being actively developed now. <br>  First I would like to say a few general words: <br><ol><li>  In sdk03, we tried to take into account all the "mistakes of stormy youth" </li><li>  It is completely incompatible with the old skd02 </li><li>  Most likely, there will not be more such abrupt API transitions between versions. </li></ol><br>  And that is why I recommend to anyone who has never written plug-ins for Kutima to orient themselves on sdk03 <br>  I want to note the important fact that now the development is carried out with the use of Qt 4.6, it provides huge additional features that are simply a sin to refuse. <br>  If you are eager to realize something interesting, but do not know where to direct your energy, then this article is for you! <br><a name="habracut"></a><br>  In the summer, we came to the conclusion that the current implementation of the plug-in system brought the program to a standstill: <br>  It became very hard to increase the functionality, the program has long ceased to be lightweight and on weak machines, when loading a long contact sheet, it slowed down.  It took a lot of time to fix bugs. <br>  Therefore, the development of libqutim began, in which we tried to take into account all the mistakes of the old plug-in system, and to make the development of Kutima as simple and pleasant as possible. <br><blockquote>  The structure of the new qutIM: </blockquote><br><ul><li>  Microkernel - it contains the implementation of the module manager.  It is responsible for loading and correct operation of all parts of qutIM.  It has a choice of which modules to load and which not.  Plus, it has the ability to track dependencies, which can be indispensable for modules that rely on other components in their work.  In addition, active modules can be switched directly in runtime, which, for example, is actively used in configbackend </li><li>  libqutim - this library stores the interfaces of all modules, as well as a set of the most useful and frequently used functions </li><li>  corelayers - the set of modules that is compiled directly with the application, if desired, it can be easily changed, as will be discussed below </li><li>  plugins - traditional shared libraries that are currently easiest to place in the plugins folder next to the executable file, best suited for protocols </li></ul><br><br>  The first step is to install the Qt4.6 library, for Windows and Macos X they are on the <a title="Nokia" href="http://qt.nokia.com/developer/qt-4.6-preview">official site</a> . <br>  Ubunt users can use the kubuntu-experimental repository, you can add it with the command: <br>  $ add-apt-repository ppa: kubuntu-experimental <br>  Gentushnikami enough unmask the corresponding ebuild'y.  For the rest, it will not be difficult to find the necessary packages or assemble them yourself. <br>  The source code is taken from here: <br>  <a href="http://www.qutim.org/svn/qutim/branches/sdk03/">www.qutim.org/svn/qutim/branches/sdk03</a> <br>  After as usual we command in the terminal <br> <code>$ mkdir build &amp;&amp; cd build &amp;&amp; cmake ..</code> <br>  As a result, cmake will create a Makefile for you, if it turns out that not all dependencies for the build are satisfied, then install the missing packages. <br>  Please pay attention to the lines of the type <br> <code>+ layer KINETICPOPUPS added to build <br> + layer XSETTINGSDIALOG added to build <br> + layer ADIUMCHAT added to build <br></code> <br>  To date, in the cmake script, autodetection of the layers used is implemented.  You just need to put the source code of your plug-in in scr / corelayers / name_layer, so that it is recognized by the system.  This opens up huge prospects for creating your own builds, and simplifies development. <br>  In this article I will describe how to implement the settings dialog: <br>  Create a subdirectory simplesettingsdialog in the src / corelayers directory. <br>  Create a settingslayerimpl class and inherit it from libqutim's SettingsLayer class, as shown below: <br>  <strong>settingslayeriml.h</strong> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"libqutim/settingslayer.h"</font> <br> <br> <font color="#0000ff">class</font> SettingsDialog; <br> <font color="#0000ff">using</font> <font color="#0000ff">namespace</font> qutim_sdk_0_3; <br> <br> <font color="#0000ff">class</font> SettingsLayerImpl : <font color="#0000ff">public</font> SettingsLayer <br> { <br> Q_OBJECT <br> <font color="#0000ff">public</font> : <br> SettingsLayerImpl(); <br> <font color="#0000ff">virtual</font> ~SettingsLayerImpl(); <br> <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> close(); <br> <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> show ( <font color="#0000ff">const</font> SettingsItemList&amp; settings ); <br> <font color="#0000ff">private</font> : <br> QPointer&lt;SettingsDialog&gt; m_dialog; <br> };</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <strong>settingslayeriml.cpp</strong> <br><br>  Attention: if you compile the module directly into a binary file, then you need to include the header files as shown in the example.  If you bring it into a plugin, then you need to <code>&lt;libqutim/&gt;</code> replace it with <code>&lt;qutim/&gt;</code> <br>  The operation of the layer is very simple: upon a show request, a list of settings that must be displayed is transmitted. <br>  <strong>settingslayeriml.cpp</strong> <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"settingslayerimpl.h"</font> <br> #include <font color="#A31515">"settingsdialog.h"</font> <br> #include <font color="#A31515">"modulemanagerimpl.h"</font> <br> #include &lt;libqutim/icon.h&gt; <br> <font color="#0000ff">static</font> Core::CoreModuleHelper&lt;SettingsLayerImpl&gt; settings_layer_static( <font color="#008000">//  ,       </font> <br> QT_TRANSLATE_NOOP( <font color="#A31515">"Plugin"</font> , <font color="#A31515">"Simple Settings dialog"</font> ), <font color="#008000">//,  QT_TRANSLATE_NOOP       </font> <br> QT_TRANSLATE_NOOP( <font color="#A31515">"Plugin"</font> , <font color="#A31515">"SDK03 example"</font> ) <br> ); <br> <br> <font color="#0000ff">void</font> SettingsLayerImpl::show ( <font color="#0000ff">const</font> SettingsItemList&amp; settings ) <br> { <br> <font color="#0000ff">if</font> (m_dialog.isNull()) <br> m_dialog = <font color="#0000ff">new</font> SettingsDialog(settings); <font color="#008000">// ,     </font> <br> m_dialog-&gt;show(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  There is nothing tricky in the implementation of the settings dialog either, it is only important to remember that the SettingsItem only generates a settings widget on demand to minimize memory costs. <br>  Next, create the dialog itself: <br>  <strong>settingsdialog.cpp</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"settingsdialog.h"</font> <br> #include <font color="#A31515">"ui_settingsdialog.h"</font> <br> #include &lt;libqutim/settingswidget.h&gt; <br> SettingsDialog::SettingsDialog ( <font color="#0000ff">const</font> qutim_sdk_0_3::SettingsItemList&amp; settings) <br> : ui ( <font color="#0000ff">new</font> Ui::SettingsDialog) <br> { <br> m_setting_list = settings; <br> ui-&gt;setupUi( <font color="#0000ff">this</font> ); <br> <br> <font color="#0000ff">foreach</font> (SettingsItem *settings_item, m_setting_list) <font color="#008000">//         </font> <br> { <br> QListWidgetItem *list_item = <font color="#0000ff">new</font> QListWidgetItem (settings_item-&gt;icon(), <br> settings_item-&gt;text(), <br> ui-&gt;listWidget <br> ); <br> } <br> connect(ui-&gt;listWidget,SIGNAL(currentRowChanged( <font color="#0000ff">int</font> )),SLOT(currentRowChanged( <font color="#0000ff">int</font> ))); <font color="#008000">//   </font> <br> ui-&gt;listWidget-&gt;setCurrentRow(0); <br> } <br> <br> <font color="#0000ff">void</font> SettingsDialog::currentRowChanged ( <font color="#0000ff">int</font> index) <br> { <br> SettingsWidget *widget = m_setting_list.at(index)-&gt;widget(); <font color="#008000">//      ,   </font> <br> <font color="#0000ff">if</font> (widget == 0) <br> <font color="#0000ff">return</font> ; <br> <font color="#0000ff">if</font> (ui-&gt;stackedWidget-&gt;indexOf(widget) == -1) <font color="#008000">//     ,   </font> <br> { <br> widget-&gt;load(); <br> ui-&gt;stackedWidget-&gt;addWidget(widget); <br> } <br> ui-&gt;stackedWidget-&gt;setCurrentWidget(widget); <font color="#008000">//   </font> <br> } <br> <br> SettingsDialog::~SettingsDialog() <br> { <br> delete ui; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  After adding files, do not forget to run the command again: <br> <code>$ cmake ..</code> <br>  If the line below appears in the output, then you did everything right. <br> <code>+ layer SIMPLESETTINGSDIALOG added to build</code> <br>  Now you need to add a call to the Settings: showWidget () function somewhere, I usually add it to the constructor of one of the layers. <br>  When everything is ready, you can run the application.  Eventually there will be such a pretty window. <br><img src="http://sauron.me/images/qutim/settingswindow.png"><br><br><br>  I hope you made sure that writing plugins is now quite simple.  As you can see, the settings are not yet thick, so go for it, fill in the gaps, and the best plug-ins will fall into the core! <br>  I hope that this is not the last article about the development of the new Kutim, in the future I plan to talk about the work of the settings engine, how convenient the json format is for storing them, and about many other things. <br><br>  Thank you all for your attention, the <a href="">source code can be downloaded here.</a> <br></div><p>Source: <a href="https://habr.com/ru/post/74025/">https://habr.com/ru/post/74025/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../74017/index.html">For the first time, Asustek will supply e-books with modules for accessing WiMAX (4G) networks</a></li>
<li><a href="../74018/index.html">Version 1.1 beta</a></li>
<li><a href="../74021/index.html">DJing at Ableton Live. Part 2. Deratization</a></li>
<li><a href="../74022/index.html">4 days left before the start of the new MacHeist</a></li>
<li><a href="../74023/index.html">Users and data compression</a></li>
<li><a href="../74026/index.html">Extend ReSharper - Context Actions</a></li>
<li><a href="../74027/index.html">How I built my data center - part one, preparatory</a></li>
<li><a href="../74028/index.html">Linkchka open!</a></li>
<li><a href="../74029/index.html">Experience upgrade XP to Windows7</a></li>
<li><a href="../74030/index.html">Wefi - Wi-Fi hotspots around the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>