<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VMware vSphere 6 Storage Technology. Part 2.1 - New School: SPBM and VAIO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I present to you the second part of a series of publications on VMware vSphere storage technologies. It will consider new features that have become av...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VMware vSphere 6 Storage Technology. Part 2.1 - New School: SPBM and VAIO</h1><div class="post__text post__text-html js-mediator-article">  I present to you the second part of a series of publications on VMware vSphere storage technologies.  It will consider new features that have become available in version 6 of the product.  Due to the large volume, the 2nd part will be split into 2 articles: part 2.1 with a description of the SPBM and VAIO technologies (this article), part 2.2 with a description of VVOL (the next article). <br><a name="habracut"></a><br><h3>  Storage Policy-Based Management (SPBM).  Policy-based storage management </h3><br>  The policy-based storage management technology allows you to set storage requirements for VMs (virtual machines) and ensure the implementation of a number of services for these VMs.  In conditions of large infrastructures with this approach, the process of providing storage for the VM becomes more efficient and convenient. <br><br>  The administrator creates and edits a set of policies needed by the data center; after binding the desired policy to a specific VM, the virtual infrastructure selects from a set of data center storages a limited set of storages that meets the requirements of the policy.  In addition, a policy can ensure that services such as caching and data replication are implemented for VMs, if appropriate rules are set in it, and I / O filters (VAIO) are deployed in the infrastructure. <br><br><h4>  Categories of rules used in policies </h4><br>  The rules on which SPBM policies are based are divided into 3 categories. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Common rules</b> are based on data services and do not depend on the type of storage, are common to any type of storage.  Services in this case are understood as manipulations with the data flow carried out by input-output filters developed on the basis of VAIO, namely caching and replication of data at the level of individual VMs. <br><br>  General rules do not establish requirements for the choice of storage and its characteristics, they guarantee and ensure the application of certain services (input / output filters) to VMs.  The application of common rules becomes available only with the appropriate I / O filters that must be installed on vCenter and ESXi hosts / clusters. <br><br>  <b>Rules based on storage services (Rules Based on Storage-Specific Data Services)</b> are defined by data services that provide certain types of storage such as Virtual SAN and VVol.  The key point is services specific to this particular storage. <br><br>  Storage providers (storage providers, also known as VASA providers) collect information about the characteristics and capabilities (services) of the storage and provide it to vCenter.  Thus, a certain storage profile is formed, containing information about all its services and, accordingly, about the quality of service it can provide. <br><br>  The policy is based on the rules that guarantee a certain level of service and use of data services.  Being tied to a specific VM, such a policy will guarantee its placement on the storage with a given level of service and characteristics: capacity, performance, availability, fault tolerance, etc. <br><br>  <b>Rules based on labels (Rules Based on Tags)</b> - created on the basis of labels, which you can manually mark the various stores. <br><br>  Shortcuts or tags are mainly used in 2 cases: <br><br>  ‚Ä¢ If you want to mark storage not represented by providers (VASA), such as VMFS or NFS. <br>  ‚Ä¢ To indicate characteristics not covered by VASA, such as geographic location of storage facilities or administrative affiliation. <br><br>  In consequence, tags assigned to the repositories can be used when generating rules in policies. <br><br><h4>  Formation and application of policies </h4><br>  Policies can contain general rules and several sets of rules containing rules based on storage services and based on labels.  The relationship between sets of rules in a policy is a logical ‚ÄúOR‚Äù, the relationship between the rules in a set is a logical ‚ÄúAND‚Äù.  Therefore, to host a VM, you can choose one of the repositories that will fully comply with the rules of one of the sets of policies associated with this VM.  Also, the general rules specified in this policy should be applied to this VM. <br><br><h3>  VAIO - vSphere APIs for IO Filtering.  I / O Filtering API Kit </h3><br>  vSphere APIs for IO Filtering (VAIO) are designed to create third-party software components called input / output filters (I / O filters).  These filters can be installed on ESXi hosts and perform additional manipulations on VM data by processing I / O requests between VMs and their virtual disks. <br><br>  I / O filters gain direct access to the I / O (data) path between a VM and its virtual disk, regardless of the storage infrastructure used. <br><br>  I / O filters must be created by third-party developers and distributed as packages, the components of which are installed on the vCenter server and ESXi hosts.  After installing filters on ESXi hosts, the vCenter server automatically configures and registers the I / O filter storage provider (VASA provider for I / O filters) for these hosts.  These VASA providers allow you to integrate the I / O filter mechanism with SPBM, with the result that the settings of the data services provided by the filters are available for management through policies - the ‚Äúcommon‚Äù rules in the VM Storage Policies interface.  Accordingly, after binding the desired policy to the VM disks, they will be subject to the I / O filter actions specified in the policy. <br><br>  Theoretically, third-party developers can create any I / O filters.  However, the current release of vSphere 6.2 only supports 2 categories of filters: <br><br>  ‚Ä¢ Caching filters - can use local flash drives to cache VM data on virtual disks. <br>  ‚Ä¢ Replication filters - replicate all write operations for a specific VM to external storage (host or cluster). <br>  It is possible to install multiple filters, even of one category (for example, caching), on one ESXi host. <br><br>  I / O filter components: <br><br>  ‚Ä¢ VAIO Filter Framework - VMware framework for I / O filters. <br>  ‚Ä¢ I / O Filter Plug-In is a third-party software component that intercepts and filters data between the guest OS and the VM virtual disk. <br>  ‚Ä¢ CIM Provider is an optional third-party component for configuring and managing I / O Filter plugins. <br>  ‚Ä¢ vSphere Web Client Plug-In is an optional third-party component for managing the CIM provider from the vSphere Web Client. <br>  ‚Ä¢ I / O Filter Daemon - an optional third-party component, can be used as a service to interact with specific filters with the ability to establish network interaction between hosts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c34/57d/c80/c3457dc80ecbe15ea2fd35074ef56e62.png" alt="image"></div><br>  Each Virtual Machine Executable (VMX) VM component contains a Filter Framework that manages the I / O Filter plugins associated with the virtual disks of the VM.  The Filter Framework calls filters when I / O requests appear between the VM and its virtual disks, so that any VM disk operations are intercepted by filters. <br><br>  Filters are executed sequentially in a specific order, for example, first replication filters, then caching filters.  Several filters can be associated with a single virtual disk, but only in one of a certain category. <br><br>  After the I / O request has been processed by all filters attached to the virtual disk, this request is sent to the destination (to the VM or its disk). <br><br>  Errors caused by the operation of filters may affect the performance of the VMs to which they are attached, but they will not affect the operation of the host and other VMs. <br><br><h4>  Local Flash Cache for I / O Filters </h4><br>  The caching I / O filters require * local flash resources, which are formed by installing flash drives (SSD) on ESXi hosts.  Installed flash drives are combined into a shared resource within the host - a virtual flash resource (virtual flash resource) formatted in VFFS.  VFFS is a file system optimized for working with flash drives and is derived from the vSphere base file system - VMFS. <br><br>  During I / O processing, filters form a cache for a VM and allocate it to a VFFS resource. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/446/56e/9a4/44656e9a4ac36ba16c45281f0287f35a.png" alt="image"></div><br>  Features of virtual flash resources: <br><br>  ‚Ä¢ Only one virtual flash resource (VFFS partition) can be placed on a single host. <br>  ‚Ä¢ Virtual flash resources are for caching purposes only and cannot be used to host VMs or other tasks. <br>  ‚Ä¢ Virtual flash resources can use only local flash drives. <br>  ‚Ä¢ Virtual flash resources can be formed from various devices, including  with various interfaces (SATA, SAS, PCIe, NVMe). <br>  ‚Ä¢ Flash drives are entirely available to a virtual flash resource; they cannot be used for other purposes, for example, Virtual SAN or VMFS. <br><br><h4>  Note: </h4><br>  <i>Virtual flash resources can also be used by Host swap cache and Flash Read Cache mechanisms, and one VFFS resource can be shared by both mechanisms.</i> <i><br><br></i>  <i>Host swap cache - designed to host VM swap files.</i>  <i>If the ESXi host does not have enough physical memory (RAM) for the VM, then the missing amounts of RAM required by the VM are transferred to the array in the form of swap files.</i>  <i>Host swap cache allows you to move these files to resources faster than the main storage of VM disks.</i> <i><br><br></i>  <i>Flash Read Cache - earlier than cache VAIO-filters, data caching technology for VM, supports only cache for reading.</i>  <i>The technology appeared in vSphere 5.5 and is a built-in VMware tool.</i>  <i>For its operation, you must specify the size of the reserved cache for each VM.</i>  <i>The effectiveness of the technology depends on the type of load, a tangible increase in performance can be expected in the case of a large flow of reading operations.</i> <i><br><br></i>  <i>* There is an assumption that it is not necessary to use the VFFS partition to work with caching I / O filters; the developer of VAIO filters can implement VM cache storage in another, perhaps more efficient way.</i> <br><br>  Thank you for your attention, to be continued. </div><p>Source: <a href="https://habr.com/ru/post/314604/">https://habr.com/ru/post/314604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314592/index.html">‚ÄúA bit about platforms‚Äù: Backend-as-a-Service</a></li>
<li><a href="../314594/index.html">We invite you to the Russian AI Cup 2016</a></li>
<li><a href="../314596/index.html">"Planning Issues": Cloud ERP Hosting</a></li>
<li><a href="../314600/index.html">Ratings instead of money</a></li>
<li><a href="../314602/index.html">PVS-Studio conquers the Internet</a></li>
<li><a href="../314606/index.html">Some facts about python asyncio</a></li>
<li><a href="../314608/index.html">How to increase the effectiveness of your email list</a></li>
<li><a href="../314610/index.html">Update Vivaldi 1.4 for Linux - the hunt for flash plugin</a></li>
<li><a href="../314612/index.html">Data Center and Digital Transformation</a></li>
<li><a href="../314616/index.html">A person. Anders Hejlsberg - creator of Turbo Pascal, Delphi and C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>