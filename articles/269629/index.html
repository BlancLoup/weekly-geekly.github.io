<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco switch stacking. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all! 
 In the first part of this article, we looked at the rather old stacking technologies for the Cisco 3750 family of switches, namely...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco switch stacking. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d76/be8/41d/d76be841d8304241a342c19ef29d75f6.jpg"><br>  Greetings to all! <br>  In the <a href="http://habrahabr.ru/company/cbs/blog/269529/">first</a> part of this article, we looked at the rather old stacking technologies for the Cisco 3750 family of switches, namely StackWise and StackWise Plus.  Today I propose to continue the consideration of other technologies.  Let me remind you, we still have StackWise-160, StackWise-480, FlexStack and FlexStack Plus. <a name="habracut"></a><br><br>  <b>StackWise-160</b> <br><br>  The StackWise-160 technology emerged with the advent of 3650 series switches. It is not compatible with other versions of stacking technologies.  The main algorithms are borrowed from StackWise Plus.  At the same time there are differences.  The first is the new architecture of the switch itself, built on the basis of the new ASICs (Unified Access Data Plane (UADP) ASIC). <br><div style="text-align:center;"><img src="https://habrastorage.org/files/edf/461/d51/edf461d5114a43ccaf6d3487d932e6e4.jpg"></div>  New ASICs are endowed with sufficient intelligence to provide switching functions.  Because of this, unlike the 3750E / 3750X, there is no longer a dedicated switching fabric.  An interesting point is that traffic switching between ports served by different ASICs is provided via a stack interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I would like to remind you that in the old ASICs (in the 3750E / 3750X switches), the elements responsible for processing incoming packets and the elements responsible for processing outgoing packets are separated.  They do not have a common bus inside the ASIC.  Therefore, even if a packet is transmitted between ports serviced by the same ASIC, this packet necessarily falls on the switching fabric. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/e2a/279/252/e2a27925274d4bbbb6ee94ea4397144d.jpg"></div>  The second difference with StackWise-160 is the increased throughput of the stacked bus.  The capacity of the stack cable is now equal to 40 Gbps (full duplex).  Thus, the throughput of the entire stack bus for StackWise-160 technology: <br>  40 Gbit / s * 2 (in each direction) * 2 (number of ports) = 160 Gbit / s <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9e1/aad/c6c/9e1aadc6c814462a8a54a360dd5de70e.jpg"></div>  It should be noted that, unlike the 3750 series of switches, the stack set for the 3650 is purchased separately. <br>  For StackWise-160 technology, the general stack operation scheme at the program level has been changed.  The Stateful Switch Over (SSO) scheme is now used for fault tolerance.  As we remember, in previous technologies (StackWise and StackWise Plus) a simpler failover scheme was used.  One of the switches is selected as the master (stack master).  It performs logic operations (control-plane) for the entire stack.  Only hardware tables (MAC tables and CEF tables (FIB / Adj)) are synchronized between stack switches.  The remaining tables, including the routing table, are re-filled on the new master.  Those.  control-plane starts from scratch.  On the 3650 switches, a more advanced scheme - Nonstop Forwarding with Stateful Switchover (NSF / SSO) - was used to ensure resiliency.  There is no such thing as a master.  Now use the Active-Standby scheme.  One of the switches is selected by the main (Active), another one - by its hot standby (Standby), which synchronizes with the main all the necessary information (L2 and L3).  Control-plane now works in Active-Standby mode.  This minimized the time required for recovery in the event of a primary switch failure. <br><br>  <b>StackWise-480</b> <br><br>  Let's now take a look at StackWise-480 technology.  Using it, you can stack 3850 series switches into a stack. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/de6/615/d9c/de6615d9c2b34a3db033af9194ef9622.jpg"></div>  Switches 3650 and 3850 are very similar.  Both of these series are based on UADP ASIC.  Accordingly, the algorithms of the StackWise-480 and StackWise-160 stack are similar.  Truth is the difference.  The StackWise-480 technology uses three physical stack rings.  This is achieved by the fact that within one stack cable for 3850 switches, there are three wires (Fig. 6).  Each with a capacity of 40 Gbps (full duplex). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dae/bf7/079/daebf70790ed41cb9da7db7acc30e675.jpg"></div>  Capacity of the entire stack bus for StackWise-480 technology: <br><br>  40 Gbit / s * 2 (in each direction) * 3 (number of wires) * 2 (number of ports) = 480 Gbit / s <br><br>  At the logical level, the stack is represented in six ways (two logical paths per wire).  Packages in three logical paths ‚Äúspin‚Äù in one direction, and in the other three - in the other (Fig. 7). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c1b/e1b/fe6/c1be1bfe667f4a20873c7b00db77f0a2.jpg"></div>  The choice of path is carried out in the same way as before, with the help of tokens. <br><br>  <b>Flexstack</b> <br><br>  On this with an overview of the stacking technology family Stackwise suggest to finish.  Let's now take a look at the 2960 switch family and the FlexStack and FlexStack Plus stacking technologies. <br><br>  Stacking for the 2960 first appeared on the 2960-S switches.  To integrate switches using the FlexStack technology, a stack module and specialized cables with a capacity of 10 Gbps (full duplex) are used.  Each stack module has two ports.  When combined, switches are connected to a ring (although this is not necessary).  The total bandwidth of the entire stack bus is: <br><br>  10 Gbit / s * 2 (in each direction) * 2 (number of ports) = 40 Gbit / s. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/36f/436/72b/36f43672b2ee4995a32263a373615ff0.jpg"></div>  For the FlexStack stack, packet transfer between switches occurs device-by-device.  The switch for each packet determines where to send it: to the regular or stack ports.  This interaction resembles the work of several switches connected to each other via Ethernet.  The difference is that the communication between stack switches is provided by the FlexStack protocol.  The choice of which of the stack ports to send a packet is determined by a special algorithm resembling the work of OSPF.  Those.  the shortest path to the switch in the stack on which the destination port is located is selected.  If any changes occur (for example, one of the switches failed or the stack cable is disconnected), this algorithm recalculates the paths again. <br><br>  Separately, it should be noted a mechanism to prevent traffic looping.  We are talking about traffic, where there is no exact recipient (broadcast, multicast, unknown unicast).  Since this traffic hits all switches in the stack, there must be a mechanism that prevents it from looping if the switches are connected in a ring (all stack ports are involved).  For this, the passive link mechanism is used.  For each switch in the stack, a stack connection is selected that is located as far as possible from the switch in question.  This connection becomes passive.  Each switch in the stack will have its own connection.  When passing through it, all broadcast, multicast and unknown unicast traffic is dropped, which is pushed onto the stack through the switch for which this connection is passive.  Those.  we just open the ring.  But unlike STP, for each switch in the stack, the ring is opened in different places.  This gives more efficient traffic than in the case of classic STP. <br><br>  At the program level, the FlexStack operation scheme resembles StackWise / StackWise Plus.  One of the switches is chosen by the master and the control-plane is launched only on it. <br><br>  <b>FlexStack Plus</b> <br><br>  The stack of FlexStack Plus differs from its predecessor in that up to 8 switches can be combined into a stack (for a FlexStack, this figure is 4) and the bandwidth over a dedicated cable is increased to 20 Gbit / s.  Thus, the total bandwidth of the stack bus is - 80 Gb / s. <br><br>  <b>Conclusion</b> <br><br>  In conclusion, I would like to note a few points. <br>  All the considered technologies allow to combine switches into a stack, which are next to each other.  The maximum length of the stack cable is 3 meters.  This, of course, is not very convenient.  True, Cisco does not position the data of a series of switches for building distributed stacks.  For this, in particular, Virtual Switching System (VSS) virtualization technology is proposed.  Its support begins on Cisco 4k series switches. <br><br>  Judging by the temporal characteristics of disaster recovery, StackWise technologies are faster than FlexStack technologies.  This is partly due to the fact that FlexStack handles all types of failures programmatically.  In principle, this is not surprising, since the Cisco 2960 series is younger.  The most interesting of these are Stackwise-160 and 480, since they support ‚Äúadult‚Äù SSO. <br><br>  On the 3750X and 3850 switches, another type of stack appeared - the Power Stack (StackPower).  It is designed to redistribute the "extra" power between the power supply units of the switches, combined into this type of stack.  This allows you to ensure the operation of the switch stack, in case of failure of its local power supply.  Or provide an additional PoE budget. <br><br>  From practice I can say that I often had to push it with Stackwise stacks (and its extensions).  There were no particular problems with their work.  There are examples where such stacks worked fine for 5-7 years as a network core in relatively large networks.  FlexStack is less common in practice.  True, and with them there were no special problems. <br><br>  <b>UPD (March 2017)</b> <br><br>  Since IOS XE 16.3.3, there is support for <b>StackWise Virtual</b> technology.  It allows you to stack two switches 3850-48-XS.  This technology is not compatible with other versions of StackWise.  Normal Ethernet ports (10 Gb / s or 40 Gb / s) are used as a stacked bus.  You can use up to four ports.  StackWise Virtual supports SSO / NSF (stateful switching and packet transfer at the moment of switching).  StackWise Virtual in terms of work is similar to <a href="https://habrahabr.ru/company/cbs/blog/271595/">VSS</a> technology. </div><p>Source: <a href="https://habr.com/ru/post/269629/">https://habr.com/ru/post/269629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269615/index.html">Analyze it: how to get additional benefit from client logs</a></li>
<li><a href="../269619/index.html">Introduction to working with ORTC in Microsoft Edge</a></li>
<li><a href="../269621/index.html">Duke, take out the trash! - Part 1</a></li>
<li><a href="../269625/index.html">VII Hi-Tech Tour "Cloudy Oktoberfest". How it was?</a></li>
<li><a href="../269627/index.html">We saw a simple Binder ...</a></li>
<li><a href="../269631/index.html">About professional punishments of subordinates in the intellectual IT environment</a></li>
<li><a href="../269633/index.html">About spam countering techniques</a></li>
<li><a href="../269635/index.html">Data ONTAP 8.3 ADP: Root-Data Partitioning</a></li>
<li><a href="../269637/index.html">Forecasting in the gaming industry. Part 1: All About Prediction</a></li>
<li><a href="../269639/index.html">Welcome to #PostgreSQLRussia November 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>