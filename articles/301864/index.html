<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel Internet Gateway: I sign and install RPM packages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If an SRM-enabled operating system is installed on your IoT gateway, each RPM package must be signed before installation, even if IMA security is not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel Internet Gateway: I sign and install RPM packages</h1><div class="post__text post__text-html js-mediator-article">  If an SRM-enabled operating system is installed on your IoT gateway, each RPM package must be signed before installation, even if IMA security is not used.  From this material, you will learn how to sign and install RPM packages in gateway operating systems with SRM turned on and off. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a81/a64/2a7/a81a642a7ce94fb897cbca1aef7099ff.jpg"></div><br>  What we are going to talk about here applies to Intel IoT gateways based on Intel Atom, Intel Core and Intel Quark processors.  Having mastered this guide, you will learn how to work with RPM-packages.  Namely, sign them, install, uninstall.  We will also consider the OS build for gateways and work with keys. <br><a name="habracut"></a><br>  The reader is expected to have the following knowledge and skills: <br><br><ul><li>  Execute Linux commands. </li><li>  Creating, editing, executing scripts. </li><li>  Installing and configuring software for Linux </li><li>  Using a terminal emulator, like Putty, with a connection between computers over a serial interface. </li></ul><br>  Here, the term "gateway" we will understand "Intel Gateway for the Internet of Things" ("Intel IoT Gateway").  A ‚Äúcomputer‚Äù is a Linux system (preferably with Ubuntu 14.0.4 Base), which is used to develop applications for gateways. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#209e5f">This will highlight commands, API names, parameters, names of regular and executable files, paths in the file system.</font> <br><br>  <b>Boldface is used to highlight references to user interface elements, on-screen buttons, and key names on the keyboard.</b> <br><br><pre><code class="bash hljs"> ,    ‚Äì  ,            .</code> </pre> <br>  <i><b><font color="#209e5f">And so highlighted blocks of text that demonstrate the system's response to the execution of the script or the execution of a command entered from the keyboard.</font></b></i> <br><br>  In order to experience in practice what is going to be discussed, you must have a <a href="https://software.intel.com/en-us/SetupGateway-hardware">gateway prepared for work</a> .  The computer must have <a href="https://software.intel.com/en-us/Setup-IDP-DevelopmentTools">a Wind River development environment</a> . <br><br><h2>  <font color="#0071c5">SRM in the gateway operating system</font> </h2><br>  Consider how to build and install an operating system with the security function (SRM) on the gateway.  When security is enabled, they must be signed before installing the RPMs on the gateway.  To begin, modify the gateway's operating system configuration script. <br><br><ol><li>  When installing the development environment on a computer, the config.sh script was created, which is located in the $ HOME / Project folder.  Edit this script as follows: <br><br>  Include this: <br><br>  <font color="#209e5f">--with-layer = wr-ima-appraise</font> <font color="#209e5f"><br></font>  <font color="#209e5f">--without-layer = wr-mcafee</font> <br><br>  Find and delete the following: <br><br>  <font color="#209e5f">wr-ima-appraise</font> from <font color="#209e5f">--without-layer =.</font> <font color="#209e5f"><br></font>  <font color="#209e5f">wr-mcafee</font> from the expression <font color="#209e5f">--with-layer =</font> . <br><br></li><li>  Save and close the <font color="#209e5f">config.sh</font> file. <br><br></li><li>  Run <font color="#209e5f">config.sh</font> </li></ol><br>  Now we will assemble the gateway operating system.  To do this, in the $ HOME / Projects folder, run the following command: <br><br><pre> <code class="bash hljs">make fs</code> </pre> <br>  Please note that it may take several hours to complete the command that builds the operating system image for installation on the gateway.  It all depends on the power of the computer that is used for development. <br><br><h2>  <font color="#0071c5">Transferring the OS image to a flash drive</font> </h2><br>  Copy the assembled image to a bootable flash disk.  Its capacity should be at least 4 GB.  In this case, keep in mind that when recording an OS image, all data from the disk will be deleted. <br><br><ol><li>  Display a list of computer drives: <br><br><pre> <code class="bash hljs">ls /dev/sd?</code> </pre> <br></li><li>  Connect the USB drive to the computer. <br><br></li><li>  Execute the command from step 1 again and compare its results with those obtained before connecting the disk.  It is necessary to determine how the new flash disk is displayed on the system: <br><br><pre> <code class="bash hljs">ls /dev/sd?</code> </pre> <br>  Here is what the implementation of the above sequence of actions looks like. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d06/826/026/d06826026c7ec3db1b2b28af3c6b673a.png"><br>  <font color="#999999"><i>Display a list of storage devices connected to a computer</i></font> <br><br>  In the next step, you will need to know the name of the USB disk in the system.  In our case, this is / dev / sdb. <br><br></li><li>  Navigate to the $ HOME / Project folder: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project</code> </pre> <br></li><li>  Deploy the gateway OS image to a USB disk.  The compiled file of the operating system has a name corresponding to the processor type of the gateway.  Use the command that is appropriate for the gateway on which you intend to install the OS, while replacing ???  in the name of the flash drive, found out above.  Image capture takes about 15 minutes. <br><br>  Command for gateways with an Intel Atom processor: <br><br><pre> <code class="bash hljs">sudo ./deploy.sh -u -f <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-baytrail-64-idp-idp-dist.tar.bz2 \-d /dev/??? -y; sync</code> </pre><br>  Command for gateways with an Intel Core processor: <br><br><pre> <code class="bash hljs">sudo ./deploy.sh -u -f <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-haswell-64-idp-idp-dist.tar.bz2 \-d /dev/??? -y; sync</code> </pre> <br>  Command for gateways with an Intel Quark processor: <br><br><pre> <code class="bash hljs">sudo ./deploy.sh -u -f <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-quark-idp-idp-dist.tar.bz2 \-d /dev/??? -y -u -b cross-hill; sync</code> </pre><br></li><li>  If necessary, enter the password and click OK.  When you see the message DONE !, it will indicate that a bootable USB disk has been created. <br><br></li><li>  Disconnect the drive from the computer and reconnect it.  After mounting, it will look like two sections, one of which is available at <br><br><pre> <code class="bash hljs"> /media/&lt;username&gt;/wr_usb_boot</code> </pre><br></li><li>  Copy the gateway operating system image file to a flash disk using the appropriate command.  In this case, replace the <i>username</i> with the username under which you work in Linux. <br>  Command for gateways with an Intel Atom processor: <br><br><pre> <code class="bash hljs">sudo cp <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-baytrail-64-idp-idp-dist.tar.bz2 /media/&lt;username&gt;/wr_usb_boot/opt/; sync</code> </pre><br>  Command for gateways with an Intel Core processor: <br><br><pre> <code class="bash hljs">sudo cp <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-haswell-64-idp-idp-dist.tar.bz2 /media/&lt;username&gt;/wr_usb_boot/opt/; sync</code> </pre><br>  Command for gateways with an Intel Quark processor: <br><br><pre> <code class="bash hljs">sudo cp <span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/intel-quark-idp-idp-dist.tar.bz2 /media/&lt;username&gt;/wr_usb_boot/opt/; sync</code> </pre><br></li><li>  Unplug flash drive from computer </li></ol><br><h2>  <font color="#0071c5">Install the OS on the gateway</font> </h2><br>  Now install the operating system on the gateway.  Please note that before loading the gateway from a flash disk, you need to make the appropriate changes in the BIOS.  <a href="https://software.intel.com/en-us/SetupGateway-hardware">Here</a> , in the ‚ÄúAppendix: Setup BIOS Boot from USB‚Äù section, you can find details about this.  When the gateway is ready to boot from external media, follow these steps: <br><br><ol><li>  Turn off power to the gateway, connect a USB disk to it, and turn on the power.  Log in with the username <font color="#209e5f">root</font> and the same password. <br><br></li><li>  Install the operating system on the gateway using the appropriate command: <br><br>  The command for gateways with an Intel Atom and Intel Core processor: <br><br><pre> <code class="bash hljs">tgt=/dev/sda /sbin/reset_media</code> </pre><br>  Command for gateways with an Intel Quark processor: <br><br><pre> <code class="bash hljs">/sbin/reset_media</code> </pre><br>  Answer the question <font color="#209e5f">Restore the boot media to its factory defaults</font> <font color="#209e5f">yes</font> .  Installation may take about 20 minutes. <br>  If you encounter an error message with the following content: <font color="#209e5f">ERROR: Unmount / dev / sda1 failed!</font>  This means that the gateway could not boot from the flash disk.  Check the boot order and UEFI parameters to see if the external drive is the first boot device. <br><br></li><li>  Message <font color="#209e5f">DONE!</font>  will mean that the OS installation is complete.  Turn off the gateway with this command: <br><br><pre> <code class="bash hljs">poweroff</code> </pre><br></li><li>  Disconnect the USB drive from the gateway and power on the device. <br>  If at this stage you encounter an error message, for example, with this: <font color="#209e5f">Reboot and select proper boot device</font> , check the BIOS settings of the gateway.  Namely, it is necessary that the built-in drive be in the first place in the download list. <br><br></li><li>  Log in using <font color="#209e5f">root</font> as the username and password. <br></li></ol><br><h2>  <font color="#0071c5">We collect unprotected RPM-package</font> </h2><br>  Create a project that includes an unprotected RPM package.  Let's call it <i>hello</i> .  Since security (SRM) is disabled in this package, you can use it to experiment with signatures. <br><br>  The following steps need to be performed on the computer. <br><br><ol><li>  Create a project directory: <br><br><pre> <code class="bash hljs">mkdir -p <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm</code> </pre><br><br></li><li>  Select the command that corresponds to the gateway you are using, and copy it to the Linux command line, execute.  This will set up the development environment to build the training package without SRM. <br><br>  Command for gateways with an Intel Atom processor: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/WindRiver/wrlinux-7/wrlinux/configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-addons=wr-idp --enableboard=intel-baytrail-64 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-kernel=idp --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-rootfs=idp --with-layer=wriot,wr-wks-oneagent-oma-dm-ia --with-template=feature/recovery,feature/openjdkbin,feature/realtek --without-layer=wr-srm</code> </pre><br>  Command for gateways with an Intel Core processor: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/WindRiver/wrlinux-7/wrlinux/configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-addons=wr-idp --enableboard=intel-haswell-64 --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-kernel=idp --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-rootfs=idp --with-layer=wriot,wr-wks-oneagent-oma-dm-ia --with-template=feature/recovery,feature/openjdkbin,feature/realtek --without-layer=wr-srm</code> </pre><br>  Command for gateways with an Intel Quark processor: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/WindRiver/wrlinux-7/wrlinux/configure --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-addons=wr-idp --enableboard=intel-quark --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-kernel=idp --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-rootfs=idp --with-layer=wr-iot,wrwks-oneagent-oma-dm-ia --with-template=feature/recovery,feature/openjdkbin,feature/realtek --without-layer=wr-srm</code> </pre><br><br></li><li>  Build the <b>hello</b> package: <br><br><pre> <code class="bash hljs">make -C build hello</code> </pre><br>  Package will be compiled and saved. <br><br></li><li>  The exact name of the folder and package file will differ depending on the gateway for which this package was prepared.  Find out the name and location of the package, you can do it like this: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm/bitbake_build/ find . -name hello*.rpm</code> </pre><br>  Write down what you found out.  We will need this information in the next section.  There we will copy the hello package into three folders and figure out how to sign packages correctly. </li></ol><br><h2>  <font color="#0071c5">Package copies and correct key</font> </h2><br>  Create three folders in which you want to copy the hello package.  In one of them put the keys that are needed in order to sign the package.  For educational purposes, we will consider not only the correct way of signing and installing packages, but also the wrong one. <br><br>  The following steps need to be performed on the computer. <br><br><ol><li>  Create directories to be used for experimenting with a signed, unsigned, and incorrectly signed package.  They will, accordingly, have such names: goodkeys, notsigned, badkeys.  And they will be located in the rpmtest folder. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm/ mkdir rpmtest mkdir rpmtest/notsigned mkdir rpmtest/badkeys mkdir rpmtest/goodkeys</code> </pre><br></li><li>  Copy the unsigned <i>hello</i> package into each of the folders.  Entering commands, replace [RPM directory] and [hello file] with the appropriate folder and package file names from your project: <br><br><pre> <code class="bash hljs">cp <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project/bitbake_build/tmp/deploy/[RMP directory]/[hello file].rpm rpmtest/notsigned cp <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project/bitbake_build/tmp/deploy/[RMP directory]/[hello file].rpm rpmtest/badkeys cp <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project/bitbake_build/tmp/deploy/[RMP directory]/[hello file].rpm rpmtest/goodkeys</code> </pre><br></li><li>  As a result of the operations described in the SRM section in the gateway operating system, you, among other things, created the right keys (certificates) that are suitable for signing packages with them.  Copy these keys to the goodkeys folder. <br><br><pre> <code class="bash hljs">cp <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project/layers/wr-idp/wr-srm/files/keys/*.pem rpmtest/goodkeys</code> </pre><br></li><li>  Check whether the files with the keys were copied to the folder.  Namely, there should be five files necessary for further work: a package RPM file, two keys (certificate) of the owner (owner keys) and two keys of the supplier (vendor keys).  Run the following command: <br><br><pre> <code class="bash hljs">ls -1 rpmtest/goodkeys</code> </pre><br>  If everything is done as it should, it should produce the following list of files: <br>  <font color="#209e5f"><i><b>[hello file] .rpm</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>owner-cert.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>owner-private.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>vendor-cert.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>vendor-private.pem</b></i></font> <br><br>  As a result, at this stage you should have the following: <br><br>  - The <font color="#209e5f">notsigned</font> and <font color="#209e5f">badkeys folders</font> contain the <b>hello</b> package, but there are no files with keys in them. <br>  - The <font color="#209e5f">goodkeys</font> folder contains the <b><i>hello</i></b> package and the correct key files.  The package has not been signed yet. </li></ol><br><br><h2>  <font color="#0071c5">Create keys</font> </h2><br>  In the ‚ÄúSRM in the gateway operating system‚Äù section, keys were created that are suitable for signing RPM packages.  In the previous section, we copied these keys and the <b>hello</b> package to the <font color="#209e5f">$ HOME / project_nonsrm / rpmtest / goodkeys folder</font> . <br><br>  Now we will create our own set of keys, which we will place in the badkeys folder.  And, although these keys are quite normal, they are not suitable for signing a package, so we consider them "wrong."  The purpose of creating these keys is to see what happens if you use the wrong keys to sign the package. <br><br>  The following steps need to be performed on the computer. <br><br><ol><li>  The tool for working with keys is located in the <font color="#209e5f">$ HOME / Project</font> project folder, which uses SRM.  In the project folder where SRM does not apply, create a symbolic link to the key tool: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nonsrm/rpmtest ln -s <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/Project/SST SST</code> </pre><br></li><li>  Create an owner key and place it in the <font color="#209e5f">$ HOME / project_nonsrm / rpmtest / badkeys folder</font> .  This is quite a working key, but it is not suitable for signing an RPM package. <br><br><pre> <code class="bash hljs">./SST create-key --role=owner --name=badowner --output-dir=./badkeys/</code> </pre><br></li><li>  Create a supplier key and place it in the same folder: <br><br><pre> <code class="bash hljs">./SST create-key --role=vendor --issuer=badowner --name=badvendor --output-dir=./ badkeys</code> </pre><br></li><li>  Check if the <font color="#209e5f">$ HOME / project_nonsrm / rpmtest / badkeys folder contains</font> all the necessary files: <br>  <i>ls -1 ./badkeys</i> <br>  If done correctly, the command will display the following list: <br><br>  <font color="#209e5f"><i><b>badowner-cert.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>badowner-private.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>badvendor-cert.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>badvendor-private.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>[hello file] .rpm</b></i></font> <br><br>  This is what we now have: <br><br>  - Package <b>hello</b> and keys suitable for signing it in the <font color="#209e5f">goodkeys</font> folder. <br>  - Package <b>hello</b> and unsuitable keys in the <font color="#209e5f">badkeys</font> folder. <br>  - The <b>hello</b> package in the notsigned folder without any keys. <br><br>  Our package is still not signed, let's do it in the next section. </li></ol><br><br><h2>  <font color="#0071c5">Sign the RPM package</font> </h2><br>  Packages are signed with the supplier's private key, and when the package is installed on the gateway, the key <font color="#209e5f">vendor-cert.pem is</font> installed along with them.  It is used to verify the signature.  Now we, with the help of the <font color="#209e5f">SST sign-rpm</font> command, will sign packages located in folders with inappropriate and suitable keys. <br><br><ol><li>  Navigate to the folder that contains the package and inappropriate keys: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm/rpmtest/badkeys</code> </pre><br></li><li>  Sign the <b>hello</b> package, which is in this folder, with the wrong key, replacing <font color="#209e5f">[hello file]</font> in the command below with the name of the package file: <br><br><pre> <code class="bash hljs">../SST sign-rpm --mode=rpm --priv-key=badvendor-private.pem ./[hello file].rpm</code> </pre><br></li><li>  Go to the folder with the appropriate keys: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm/rpmtest/goodkeys</code> </pre><br></li><li>  Sign with them the package in the same folder: <br><br><pre> <code class="bash hljs">../SST sign-rpm --mode=rpm --priv-key=badvendor-private.pem ./[hello file].rpm</code> </pre><br></li><li>  Since the symbolic link to the key tool is no longer needed, delete it. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm/rpmtest rm SST</code> </pre><br></li><li>  Connect a USB drive to your computer. <br><br></li><li>  At this stage there are the following files and folders: <br><br>  - Package <b>hello</b> , signed with a suitable key in the folder <font color="#209e5f">goodkeys</font> . <br>  - Package <b>hello</b> , signed by the wrong key in the folder <font color="#209e5f">badkeys</font> . <br>  - Unsigned <b>hello</b> package in the <font color="#209e5f">notsigned</font> folder. <br><br>  Put all three folders into a tarball and copy it to a USB drive.  In this example, the USB disk is mounted as <font color="#209e5f">/ media / rpmflash</font> .  Edit the commands below to reflect how the drive is displayed on your system. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/project_nosrm tar czvf rpmtest.tar.gz rpmtest cp rpmtest.tar.gz /media/rpmflash</code> </pre><br></li><li>  Unmount the USB drive, disconnect it from the computer, and plug it into the USB port of the gateway. <br><br></li><li>  Copy the <font color="#209e5f">rpmtest.tar.gz</font> file to the gateway drive and unpack the archive in the same directory where you copied it.  In this example, the USB disk is mounted as <font color="#209e5f">/ media / sdb1</font> , edit the command to match the state of your gateway: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> root cp /media/sdb1/rpmtest.tar.gz /root tar xzvf rpmtest.tar.gz</code> </pre><br></li><li>  Check the MD5 package signatures: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> rpmtest find . -name hello* -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> md5sum {} \;</code> </pre><br>  What you get will be similar to the output shown below, but the signatures will be different.  Most importantly, make sure they are all different. <br><br>  <font color="#209e5f"><b><i>2430f938a6f96a0eeff2459ccb7b4ee8 ./badkeys/[hello file] .rpm</i></b></font> <font color="#209e5f"><b><i><br></i></b></font>  <font color="#209e5f"><b><i>0f631d629b8a7aa4c8e86ee13bdb9cfb ./notsigned/[hello file] .rpm</i></b></font> <font color="#209e5f"><b><i><br></i></b></font>  <font color="#209e5f"><b><i>a83507c6f5b1eeec49b034a2aae44968 ./goodkeys[hello file] .rpm</i></b></font> </li></ol><br><br><h2>  <font color="#0071c5">Install packages</font> </h2><br>  Consider installing packages on the gateway.  Recall that for educational purposes we are trying to install the following packages: <br><br><ul><li>  Unsigned package. </li><li>  Package signed by the wrong key. </li><li>  Package signed with the correct key. </li></ul><br>  These actions must be performed on the gateway. <br><br><ol><li>  Try installing an unsigned package by replacing <font color="#209e5f">[hello file]</font> with the name given to your file: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/rpmtest/notsigned rpm -ivh [hello file].rpm</code> </pre><br>  As a result of this command, an error message will be displayed: <br>  <font color="#209e5f"><b><i>RPM [hello file] .rpm is not signed with extend openssl signature</i></b></font> <br><br></li><li>  Try to install a package that is signed with the wrong key.  As in the first paragraph, use the name of your .rpm file in the command: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/rpmtest/badkeys rpm -ivh [hello file].rpm</code> </pre><br>  At the output, we again receive an error message, but of a different content: <br><br>  <font color="#209e5f"><i><b>MD5 Code: e91148db3dd3a5e0bdb76ea5a8fa8e34</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Can not find the right certificate for RPM [hello file] .rpm</b></i></font> <br><br></li><li>  Now install the correctly signed package. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/rpmtest/goodkeys rpm -ivh [hello file].rpm</code> </pre><br>  In this case, we have a message about the successful installation. <br><br>  <font color="#209e5f"><i><b>MD5 Code: e91148db3dd3a5e0bdb76ea5a8fa8e34</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Find right certificate: vendor-cert.pem</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Certificate vendor-cert.pem is verified successfully</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>RPM package [hello file] .rpm is verified successfully</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Preparing ... ########################################### [100%]</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>1: hello ########################################### [100%]</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Import IMA signatures successfully Update IMA signatures successfully</b></i></font> <br><br></li><li>  Test the installed package: <br>  <i>hello</i> <br>  If the program was successfully completed, this is what it displays: <br>  <font color="#209e5f"><i><b>Hello world</b></i></font> </li></ol><br><br><h2>  <font color="#0071c5">Uninstalling the packages</font> </h2><br>  Above, we successfully installed a correctly signed package.  Now remove it. <br><br><ol><li>  Check whether the <b>hello</b> package is installed.  In the previous section, we tested this by running the program, here we proceed differently: <br><br><pre> <code class="bash hljs">rpm -qa | grep hello</code> </pre><br>  This command will print the name of the package, indicating that it is installed. <br><br></li><li>  Remove the package: <br><br><pre> <code class="bash hljs">rpm -e hello</code> </pre><br></li><li>  Check if the package is really removed: <br><br><pre> <code class="bash hljs">rpm -qa | grep hello hello</code> </pre><br>  As expected, an error message appeared: <br>  <font color="#209e5f"><i><b>-sh: hello: command not found</b></i></font> </li></ol><br><h2>  <font color="#0071c5">Certificates: get information, remove and install</font> </h2><br>  Consider the methods of working with certificates on the gateway. <br><br><ol><li>  Run a command that lists the certificates: <br><br><pre> <code class="bash hljs">imtools --listcert</code> </pre><br>  It will report the certificate that was copied to the <font color="#209e5f">$ HOME / project_nosrm / rpmtest / goodkeys folder</font> in the ‚ÄúPackage copies and correct key‚Äù section. <br>  <font color="#209e5f"><i><b>vendor-cert.pem</b></i></font> <br><br></li><li>  Remove certificate: <br><pre> <code class="bash hljs">imtools --removecert vendor-cert.pem</code> </pre><br>  The output will be the following message: <br>  <font color="#209e5f"><i><b>Remove certificate vendor-cert.pem successfully</b></i></font> <br><br></li><li>  Return the list of certificates again to check whether the certificate has really been deleted: <br><br><pre> <code class="bash hljs">imtools ‚Äìlistcert</code> </pre><br>  Since the certificate is deleted, nothing will be output as a result of the command. <br><br></li><li>  Check if the certificate can be installed from the <font color="#209e5f">$ HOME / project_nosrm / rpmtest / goodkeys folder</font> .  If so, install it. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/rpmtest/goodkeys imtools --verifycert vendor-cert.pem</code> </pre><br>  This pair of commands will display messages about the successful verification and installation of the certificate: <br><br>  <font color="#209e5f"><i><b>Certificate vendor-cert.pem is verified successfully</b></i></font> <font color="#209e5f"><i><b><br></b></i></font>  <font color="#209e5f"><i><b>Certificate vendor-cert.pem is installed successfully</b></i></font> </li></ol><br><h2>  <font color="#0071c5">Results</font> </h2><br>  Here is what you learned from this material: <br><br><ul><li>  How to enable SRM support on the gateway. </li><li>  How to create a project to prepare an RPM package with SRM disabled for testing purposes. </li><li>  How to create signed, unsigned and incorrectly signed packages in order to check the OS response of the gateway to the installation of such pacts. </li><li>  How to install and uninstall packages on the gateway. </li><li>  How to view, add and delete certificates on the gateway. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/301864/">https://habr.com/ru/post/301864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301852/index.html">Android development using qt and android studio</a></li>
<li><a href="../301854/index.html">The design and operation of the Arcserve UDP software for data backup and recovery</a></li>
<li><a href="../301858/index.html">Great interview with Hannes Dorfman, creator of Mosby framework for Android</a></li>
<li><a href="../301860/index.html">Electronic "emitter of information" at the lowest cost</a></li>
<li><a href="../301862/index.html">New derivatives of Bessel functions are derived using the Wolfram Language.</a></li>
<li><a href="../301868/index.html">How docker helped us in writing tests</a></li>
<li><a href="../301874/index.html">Bootstrapping is a business from scratch. Part 2. Money</a></li>
<li><a href="../301878/index.html">Small spool, yes roads: in a nutshell about the VMware Host Client</a></li>
<li><a href="../301880/index.html">Overcoming user incompetence as a key service problem</a></li>
<li><a href="../301882/index.html">Assembler / disassembler of Windows keyboard layouts using flat assembler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>