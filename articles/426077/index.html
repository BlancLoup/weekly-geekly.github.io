<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New backdoor of the TeleBots cyber group: the first proof of the link between Industroyer and NotPetya</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A study of the new backdoor of the TeleBots cyber group behind the NotPetya epidemic revealed a significant similarity between the code and the main b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New backdoor of the TeleBots cyber group: the first proof of the link between Industroyer and NotPetya</h1><div class="post__text post__text-html js-mediator-article">  A study of the new backdoor of the TeleBots cyber group behind the NotPetya epidemic revealed a significant similarity between the code and the main backdoor of Industroyer, which confirms the interconnection previously rumored. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9x/gy/6j/9xgy6jvrselsayjand3fqqjfzuk.jpeg"></div><br>  Among the largest cyber incidents of recent years are <a href="https://habr.com/company/eset/blog/274503/">attacks</a> on Ukrainian <a href="https://habr.com/company/eset/blog/330730/">energy enterprises</a> and the <a href="https://habr.com/company/eset/blog/332058/">epidemic of the NotPetya coder</a> .  In the post we will look at the relationship between these events. <br><br><a name="habracut"></a>  The first in the history of massive power outages caused by cyber attacks occurred in December 2015, its cause is the <a href="https://habr.com/company/eset/blog/274503/">BlackEnergy</a> malware complex.  ESET specialists <a href="https://www.welivesecurity.com/2014/10/14/cve-2014-4114-details-august-blackenergy-powerpoint-campaigns/">monitored the</a> activity of the ART group using BlackEnergy, both before and after this event.  After the blackout of 2015, the group seems to have turned to active work with BlackEnergy and evolved into what we now call <a href="https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/">TeleBots</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here it should be noted that, speaking of the ART group, we mean the general technical indicators: code similarity, common network (C &amp; C) infrastructure, chains of execution of malicious programs, etc. As a rule, we do not directly participate in the investigation and identification of developers or operators.  The term ‚ÄúART group‚Äù is not clearly defined and is often used to characterize malware parameters.  For these reasons, we refrain from assumptions about the source of attacks, national or state identity of the attackers. <br><br>  In any case, we found a connection between the attacks of BlackEnergy (aimed at the Ukrainian energy companies, as well as other industries and high-ranking facilities) and the campaigns of the TeleBots group (mainly against the Ukrainian financial sector). <br><br>  In June 2017, companies around the world suffered from <a href="https://habr.com/company/eset/blog/332058/">Diskcoder.C wiper</a> (better known as Petya / NotPetya) - the massive nature of the infection seems to have been a side effect.  Studying the incident, we found out that companies infected with the <a href="https://habr.com/company/eset/blog/332472/">backdoor of the TeleBots group</a> became the ‚Äúzero patient‚Äù of this epidemic as a result of the compromise of the popular MEDoc accounting software in Ukrainian companies. <br><br>  The question is, what does <a href="https://habr.com/company/eset/blog/330730/">Industroyer</a> have to do with this story - a complex malicious complex that caused the blackout in Kiev in December 2016.  Immediately after the publication of the ESET report, some security companies and the media suggested that Industroyer also developed the BlackEnergy / TeleBots group (sometimes also called Sandworm).  However, evidence to date has not been provided. <br><br>  In April 2018, we recorded a new activity of the TeleBots group - an attempt to deploy a new <b>Win32 / Exaramel backdoor</b> .  Our analysis showed that this backdoor is an improved version of the main backdoor of Industroyer - which was the first proof. <br><br><img src="https://habrastorage.org/webt/wr/q4/8t/wrq48tqiohrrau3omuybnkgekh8.png"><br><br><h2>  Win32 / Exaramel backdoor analysis </h2> <br>  The Win32 / Exaramel backdoor is initially installed using a dropper.  According to the dropper metadata, the backdoor is compiled into Microsoft Visual Studio just before being deployed to a particular compromised computer. <br><br><img src="https://habrastorage.org/webt/cn/ad/2j/cnad2jaagghbga--dtzrfttj6o8.png"><br>  <i>Figure 1. Win32 / Exaramel backdoor PE dropper timestamp</i> <br><br>  After execution, the dropper places the Win32 / Exaramel binary file in the Windows system directory and starts the Windows service named <code>wsmproav</code> with the description ‚ÄúWindows Check AV‚Äù.  The file name and description of the Windows service is hard-coded in the dropper. <br><br><img src="https://habrastorage.org/webt/5z/sp/5l/5zsp5lzsejmdmt3b5jlr0un7rlo.png"><br>  <i>Figure 2. Windows service registry settings created by Win32 / Exaramel backdoor</i> <br><br>  In addition, the dropper writes the backdoor configuration to the Windows registry in XML format. <br><br><img src="https://habrastorage.org/webt/ra/id/sr/raidsre0afcy2xxbvvapqpt9tmq.png"><br>  <i>Figure 3. Win32 / Exaramel XML configuration</i> <br><br>  The configuration consists of several blocks: <br><br>  - <i>Interval</i> - time in milliseconds, used for the Sleep function <br>  - <i>Servers</i> - list of command servers (C &amp; C) <br>  - <i>Check</i> ‚Äî The website used to determine if the host has access to the Internet. <br>  - <i>Proxy</i> - proxy server in host network <br>  - <i>Storage</i> - the path used to store files for exfiltration <br><br>  As can be seen from the first configuration line, attackers group targets based on the antivirus products used.  A similar approach is used in the Industroyer complex - in particular, some Industroyer backdoors were also disguised as antivirus related service (deployed as <code>avtask.exe</code> ) and used the same approach to group formation. <br><br>  Another interesting fact is that the backdoor uses C &amp; C servers whose domain names mimic domains belonging to ESET.  In addition to the <code>esetsmart[.]org</code> from the above configuration, we discovered a similar domain, <code>um10eset[.]net</code> , which was used by the recently discovered Linux version of the TeleBots malware.  It is important to note that these controlled by attacking servers are not related to the <a href="https://support.eset.com/kb332/%3Flocale%3Den_US%26viewlocale%3Den_US">legitimate network infrastructure of ESET</a> .  At present, we have not found that Exaramel uses domains that mimic the infrastructure of other information security companies. <br><br>  After launching, the backdoor establishes a connection with the C &amp; C server and receives commands for execution on the system.  Below is a list of available commands: <br><br>  - Start process <br>  - Run the process from a specific Windows user <br>  - Writing data to a file at a specified path <br>  - Copy file to storage subdirectory (Download file) <br>  - Run shell command <br>  - Run a shell command from a specific Windows user <br>  - Execute VBS code using <code>MSScriptControl.ScriptControl.1</code> <br><br>  The command cycle code and the implementation of the first six commands in Win32 / Exaramel are very similar to the backdoor from the Industroyer software. <br><br><img src="https://habrastorage.org/webt/dh/2m/z7/dh2mz7u12gct6ja5rcogi2nfqze.png"><br>  <i>Figure 4. Comparison of the decompiled Win32 / Exaramel backdoor code (left) and Win32 / Industroyer (right)</i> <br><br>  Both families of malware use a report file to store the output of executed shell commands and running processes.  In the case of the Win32 / Industroyer backdoor, the report file is stored in a temporary folder with a random name;  in Win32 / Exaramel, the report file is called <code>report.txt</code> , and its path to the repository is specified in the backdoor configuration file. <br><br>  To redirect standard output (stdout) and standard error (stderr) to the report file, both backdoors set the <code>hStdOutput</code> and <code>hStdError</code> parameters to the report file descriptor.  This is another similarity between these malware families. <br><br><img src="https://habrastorage.org/webt/1b/hu/13/1bhu13rxf11if_z6tz-hwazje1c.png"><br>  <i>Figure 5. Comparison of the decompiled Win32 / Exaramel and Win32 / Industroyer backdoors, respectively</i> <br><br>  If the malware operators want to exfilter the files from the victim‚Äôs computer, all they have to do is copy these files to the <code>data</code> storage subdirectory specified in the configuration.  Before establishing a new connection with the C &amp; C server, the backdoor will automatically compress and encrypt these files before sending them. <br><br>  The main difference between the backdoor Industroyer and the new backdoor TeleBots is that the latter uses the XML format for communication and configuration instead of the custom binary format. <br><br><h2>  Malicious password theft tools. </h2><br>  Together with Exaramel, the TeleBots group uses some of the old tools, including a password theft tool (internal name is CredRaptor or PAI) and slightly modified Mimikatz. <br><br>  The improved CredRaptor password theft tool, used only by this group since 2016, has been improved.  Unlike previous versions, it collects saved passwords not only from browsers, but also from Outlook and a number of FTP clients.  Below is a list of supported applications: <br><br>  - BitKinex FTP <br>  - BulletProof FTP Client <br>  - Classic FTP <br>  - CoffeeCup <br>  - Core FTP <br>  - Cryer WebSitePublisher <br>  - CuteFTP <br>  - FAR Manager <br>  - FileZilla <br>  - FlashFXP <br>  - Frigate3 <br>  - FTP Commander <br>  - FTP Explorer <br>  - FTP Navigator <br>  - Google Chrome <br>  - Internet Explorer 7 - 11 <br>  - Mozilla Firefox <br>  - Opera <br>  - Outlook 2010, 2013, 2016 <br>  - SmartFTP <br>  - SoftX FTP Client <br>  - Total Commander <br>  - TurboFTP <br>  - Windows Vault <br>  - WinSCP <br>  - WS_FTP Client <br><br>  Improvements allow attackers to collect data from webmaster accounts of web sites and from servers in the internal infrastructure.  Having access to such servers, you can install additional backdoors.  Quite often, these servers have an operating system different from Windows, so attackers have to adapt backdoors. <br><br>  During incident response activities, we discovered the TeleBots <b>Linux</b> backdoor ‚Äî <b>Linux / Exaramel.A</b> . <br><br><h2>  Linux / Exaramel backdoor analysis </h2><br>  The backdoor is written in the Go programming language and compiled as a 64-bit ELF binary file.  Attackers can deploy the backdoor in the selected directory under any name. <br><br>  If the backdoor is executed by attacking with the string 'none' as a command line argument, it tries to use persistence mechanisms to automatically start after a reboot.  If the backdoor is not running as root, it uses the <code>crontab</code> file.  However, if it is running as root, it supports various Linux <code>init</code> systems.  It determines which <code>init</code> system is currently being used by executing the command: <br><br> <code>strings /sbin/init | awk 'match($0, /(upstart|systemd|sysvinit)/){ print substr($0, RSTART, RLENGTH);exit; }'</code> <br> <br>  Depending on the result, the backdoor uses the following hard-coded locations to ensure persistence (hereinafter referred to as the Init system and its location): <br><br>  <b>sysvinit</b> - /etc/init.d/syslogd <br>  <b>upstart</b> - /etc/init/syslogd.conf <br>  <b>systemd</b> - /etc/systemd/system/syslogd.service <br><br>  During startup, the backdoor tries to open a configuration file that is stored in the same directory as the backdoor, under the name <code>config.json</code> .  If the configuration file does not exist, a new file is created.  The configuration is encrypted using the key <b>s0m3t3rr0r</b> and the RC4 algorithm. <br><br><img src="https://habrastorage.org/webt/rl/5w/yf/rl5wyfa7qmt6ryiafwrdejw_ezu.png"><br>  <i>Figure 6. Decrypted JSON configuration of the Linux / Exaramel backdoor</i> <br><br>  The backdoor connects to a hard-coded C &amp; C (by default 176.31.225 [.] 204 in the sample we saw) or to the C &amp; C server specified in the configuration file in the <code>Hosts</code> value.  Communications are carried out via HTTPS.  The backdoor supports the following commands: <br><br>  <b>App.Update</b> - update to the new version <br>  <b>App.Delete</b> - self- <b>deletion</b> from the system <br>  <b>App.SetProxy</b> - set proxy server settings in the configuration <br>  <b>App.SetServer</b> - update the C &amp; C server in the configuration <br>  <b>App.SetTimeout</b> - setting the timeout value (intervals between connections with the C &amp; C server) <br>  <b>IO.WriteFile</b> - download a file from a remote server <br>  <b>IO.ReadFile</b> - upload file from local disk to C &amp; C server <br>  <b>OS.ShellExecute</b> - execute shell command <br><br><h2>  Conclusion </h2><br>  The discovery of Exaramel shows that the TeleBots group remains active in 2018, and the attackers continue to improve tactics and tools. <br><br>  The significant similarity between the Win32 / Exaramel code and the Industroyer main backdoor is the first publicly presented evidence linking Industroyer with the TeleBots group and, therefore, with NotPetya and BlackEnergy cyber campaigns.  Establishing a connection between the sources of cyber attacks, we should take into account the possibility of error or deliberate deception, but in this case we consider this unlikely. <br><br>  It is worth noting that Win32 and Linux versions of Exaramel backdoor were found in an organization that is not relevant to the industry.  ESET specialists reported the finding to the investigative authorities of Ukraine, due to which the attack was promptly localized and prevented. <br><br>  ESET continues to monitor the activity of this cyber group. <br><br><h2>  Compromise Indicators (IoCs) </h2><br><h4>  Detection by ESET products </h4><br> <code>Win32/Exaramel trojan <br> Win32/Agent.TCD trojan <br> Linux/Agent.EJ trojan <br> Linux/Exaramel.A trojan <br> Win32/PSW.Agent.OEP trojan <br> Win32/RiskWare.Mimikatz.Z application <br> Win64/Riskware.Mimikatz.AI application</code> <br> <br><h4>  Hashi SHA-1 </h4><br>  <b>Backdoor Win32 / Exaramel of the TeleBots cyber group</b> <br> <code>65BC0FF4D4F2E20507874F59127A899C26294BC7 <br> 3120C94285D3F86A953685C189BADE7CB575091D</code> <br> <br>  <b>Password Theft Tool</b> <br> <code>F4C4123849FDA08D1268D45974C42DEB2AAE3377 <br> 970E8ACC97CE5A8140EE5F6304A1E7CB56FA3FB8 <br> DDDF96F25B12143C7292899F9D5F42BB1D27CB20 <br> 64319D93B69145398F9866DA6DF55C00ED2F593E <br> 1CF8277EE8BF255BB097D53B338FC18EF0CD0B42 <br> 488111E3EB62AF237C68479730B62DD3F52F8614</code> <br> <br>  <b>Mimikatz</b> <br> <code>458A6917300526CC73E510389770CFF6F51D53FC <br> CB8912227505EF8B8ECCF870656ED7B8CA1EB475</code> <br> <br>  <b>Linux / Exaramel</b> <br> <code>F74EA45AD360C8EF8DB13F8E975A5E0D42E58732</code> <br> <br><h4>  C &amp; C Servers </h4><br> <code>um10eset[.]net (IP: 176.31.225.204) <br> esetsmart[.]org (IP: 5.133.8.46)</code> </div><p>Source: <a href="https://habr.com/ru/post/426077/">https://habr.com/ru/post/426077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426063/index.html">HPE MSA Entry Level Innovation Arrays: A More Available Flash Array And Rich Decision Integration</a></li>
<li><a href="../426065/index.html">Smart TV, which itself determines the most interesting channel, or an unusual solution to sudoku for video content</a></li>
<li><a href="../426067/index.html">Moving like two fires? Once again about the relocation of staff</a></li>
<li><a href="../426071/index.html">What promotions are clothes shops luring customers to?</a></li>
<li><a href="../426073/index.html">Import substitution, fairy tales continue (continued)</a></li>
<li><a href="../426079/index.html">Authorization without authorization: do not collect personal data</a></li>
<li><a href="../426081/index.html">How to organize long-term archival storage of electronic documents</a></li>
<li><a href="../426083/index.html">What skills does an iOS developer need to get well settled?</a></li>
<li><a href="../426085/index.html">How to order the development of the site without unpleasant surprises: 3 expert advice</a></li>
<li><a href="../426087/index.html">Signing a PDF on JS and inserting a signature on C # using Krypto PRO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>