<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stylish Python code, or learning to use Flake8</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Author: Anatoly Solovey, developer 

 The Python programming language is very much in demand in the modern market, it develops every day, and an activ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stylish Python code, or learning to use Flake8</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/839/634/9c3/8396349c3e804e45833b14213ed0efd3.png"><br>  <i>Author: Anatoly Solovey, developer</i> <br><br>  The Python programming language is very much in demand in the modern market, it develops every day, and an active community has developed around it.  In order to avoid conflicts between pythonist developers, the language creators wrote a PEP 8 agreement describing code design rules, but even there it was noted that: <br><blockquote>  Many projects have their own coding style guidelines.  In the event of any conflicts, such project-specific guides take precedence for that project. </blockquote><br>  As a result of the addition of new rules, the number of code design requirements has increased so much that it has become very difficult to keep them in mind.  At the same time, referring to guides can take a lot of time and distract from the development process. <br><br>  For a long time, programmers have developed their own style of writing code, preferences in the style guides, and other trifles that leave the author's seal on the developer‚Äôs programs.  Convincing developers to abandon their usual code styles is very difficult, but even if they succeed, there is a great chance that old code added by virtue of habit will slip through their code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When each update passes a strict revision code that includes style checking, such errors can slow down the development process very much.  And if the mistakes are not noticed in the end, even during the review process, a bunch of unreadable and incomprehensible code will appear in the project version control system very soon. <br><br>  Linters come to the rescue in this case - tools that control the design of the code in the project.  They help to maintain its purity and, in our case, prevent the creation of commits that may contain errors.  I use Flake8 for quality control and now I will try to explain why I chose it, and tell you how to set it up in order to get the maximum result.  Interested?  Welcome under cat. <br><a name="habracut"></a><br><h2>  Flake8: Your Tool For Style Guide Enforcement </h2><br>  Flake8 itself is a tool that allows you to scan a project code and detect stylistic errors and violations of various conventions of Python code in it. <br><br>  Flake8 is able to work not only with PEP 8, but also with other rules, besides it supports custom plugins, so in the future in this article I will start from the rules from <a href="https://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a> . <br><br><h2>  Why Flake8? </h2><br><h3>  Flake8: pep8 + pyflakes + more </h3><br>  The creator of Flake8, Tarek Ziade, set himself the goal of combining the main popular code style control tools in one library, which he successfully coped with in the end - Flake8 was truly universal. <br><br><h3>  Easy installation and configuration </h3><br>  To check whether the code in your project meets the basic requirements of PEP 8, it is enough to install Flake: <br><br><pre><code class="python hljs">$ pip install flake8</code> </pre> <br>  and run it - just type on the command line: <br><br><pre> <code class="python hljs">$ flake8 my_project</code> </pre> <br>  after which you will receive a list with file names and line numbers where errors were made, and a detailed description of the errors themselves: <br><br><pre> <code class="python hljs">$ flake8 my_project myfile.py:<span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-string"><span class="hljs-string">'sys'</span></span> imported but unused myfile.py:<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>: E302 expected <span class="hljs-number"><span class="hljs-number">2</span></span> blank lines, found <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Great, isn't it?  But that's not all.  If you are not a fan of working with the console, then you can configure Flake8 to integrate with the IDE or the editor you prefer. <br><br><h3>  Flake8 integration with editors and IDE </h3><br>  <b>PyCharm integration</b> <br>  <i>Also relevant for any other JetBrains IDE.</i> <br>  Integration is carried out in just a couple of easy steps. <br><br>  Open the <b>External Tools</b> settings in <b>File ‚Üí Settings ‚Üí Tools</b> and click on ‚Äú+‚Äù, then fill in the fields using this template: <br><br><img src="https://habrastorage.org/files/850/84c/553/85084c5536204b83ac61ab31586ab128.png"><br><br>  After that, click on Output Filters, and then on ‚Äú+‚Äù to add a new rule to display messages from the flick: <br><br><img src="https://habrastorage.org/files/8e1/31d/5b5/8e131d5b5b9c49759ef285cd8cdf5309.png"><br>  <i>Here we tell PyCharm that we want the output of the string with errors to be clickable and to open the file and the place with the error in the editor.</i> <br><br>  Everything.  Flake8 integration with PyCharm is complete.  In order to call up the flick and check your code, right-click on the file / directory that we want to check, and select External Tools ‚Üí Flake8 in the context menu. <br><br><img src="https://habrastorage.org/files/584/8f2/d78/5848f2d787ff46c19bdcff25f84cd581.png"><br><br>  The PyCharm output will display a clickable list of violations in the selected file / directory: <br><br><img src="https://habrastorage.org/files/539/150/d68/539150d68b744277b330b0b80abb6fb8.png"><br><br>  <b>Atom integration</b> <br>  To install the Flake8 tool for Atom, use the Atom package manager in <b>Settings</b> and find linter-flake8 there: <br><br><img src="https://habrastorage.org/files/a41/997/109/a4199710968043b8a3168202fa6cc68e.png"><br><br>  Or call <br><br><pre> <code class="python hljs">apm install flake8</code> </pre> <br>  from the command line. <br><br>  Then go to linter-flake8 settings and specify the path to the directory where flake8 is installed: <br><br><img src="https://habrastorage.org/files/39c/f8f/d44/39cf8fd4416d4ad9a379ad79d66cc302.png"><br><br>  Linter-flake8 has its own customization readme, which, if you wish, can be found on the linter-flake8 page in Atom itself. <br><br><h3>  Availability of Version Control Hooks </h3><br>  That is what I consider to be the main advantage of Flake8, which distinguishes it from other linters.  Unlike most of these tools, where entire separate libraries and modules are used to configure VCS hooks (as, for example, in Pylint), the hook configuration in a flake is literally two lines. <br><br>  At the time of this writing, Flake8 knows how to use pre-commit hooks for Git and Mercurial.  These hooks allow, for example, to prevent the creation of a commit if any rules for execution are violated. <br><br>  Install a hook for Git: <br><br><pre> <code class="python hljs">$ flake8 --install-hook git</code> </pre> <br>  And configure the git itself to take into account the rules of Flake8: <br><br><pre> <code class="python hljs">$ git config --bool flake8.strict true</code> </pre> <br>  I will demonstrate how Git hook works on a project that I used for the example of integrating Flake8 with PyCharm.  In the flake8tutorial.py module, we see obvious errors: imported and unused modules, the absence of pre-stringing and the empty line at the end of the file. <br><br>  First of all, we initialize a git-0 repository in this project, install a flake8 hook and tell our git that it should chase the flake before commits: <br><br><img src="https://habrastorage.org/files/c74/845/f44/c74845f44b3b4f6d93e6ad004a2cdd7f.png"><br><br>  Then we will try to make the first commit: <br><br><img src="https://habrastorage.org/files/f12/080/ffd/f12080ffd3d142768f3021bb353ae3f1.png"><br><br>  As you can see, flake8 was called before the commit and did not allow us to commit invalid changes. <br><br>  Now fix the errors marked with a flick and try to commit a valid code: <br><br><img src="https://habrastorage.org/files/0d2/236/322/0d2236322b544daf920136b008ec921e.png"><br><br>  Commit has been successfully created.  Fine! <br><br>  The Flake8 setting for Mercurial is almost identical.  First you need to install Flake8 Mercurial Hook: <br><br><pre> <code class="python hljs">$ flake8 --install-hook mercurial</code> </pre> <br>  And configure Mercurial itself: <br><br><pre> <code class="python hljs">$ hg config flake8.strict true</code> </pre> <br>  That's all, the hook for Mercurial is installed, configured and ready to use! <br><br><h2>  Details on the Flake8 configuration </h2><br><h3>  Basic configuration </h3><br>  A list of additional options and rules can be passed directly when called from the command line in the following way: <br><br><pre> <code class="python hljs">flake8 --select E123</code> </pre> <br>  <i>(in this example, using the select option, we say that Flake only reports violations of the E123 rule (this is the ‚Äúclosing bracket does not match indentation of opening bracket's line‚Äù rule code))</i> . <br><br>  By the way, a full list of options with a description can be found in the <a href="http://flake8.pycqa.org/en/latest/user/options.html">documentation for the library itself</a> . <br><br>  In my opinion, where it is preferable to configure Flake using configuration files, you can store the settings in one of the files setup.cfg, tox.ini or .flake8.  For clarity, I prefer to use the latter option. <br><br>  The settings file allows you to control the use of the library of the same options that are configured for the command line, the basic configuration file looks like this: <br><br><pre> <code class="python hljs">[flake8] ignore = D203 exclude = .git,__pycache__,docs/source/conf.py,old,build,dist</code> </pre> <br>  In this file, we tell Flake that it should not notify us of violations of the D203 rule (‚Äú1 blank line required before class docstring‚Äù), and should not check the .git, __ pycache__, docs / source / conf.py files and the old directories , build, dist. <br><br>  You can leave comments in the configuration files, this is useful if you provide a large list of rules that Flake should ignore: <br><br><pre> <code class="python hljs">[flake8] <span class="hljs-comment"><span class="hljs-comment"># it's not a bug that we aren't using all of hacking ignore = # F812: list comprehension redefines ... F812, # H101: Use TODO(NAME) H101, # H202: assertRaises Exception too broad H202, # H233: Python 3.x incompatible use of print operator H233, # H301: one import per line H301, # H306: imports not in alphabetical order (time, os) H306, # H401: docstring should not start with a space H401, # H403: multi line docstrings should end on a new line H403, # H404: multi line docstring should start without a leading new line H404, # H405: multi line docstring summary not separated with an empty line H405, # H501: Do not use self.__dict__ for string formatting H501</span></span></code> </pre><br>  You can also add a separate line in the exceptions in your module, simply by leaving a comment <i>noqa</i> on this line.  Then, when checking the Flake8 module, it will ignore errors found in the lines marked with this comment: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># noqa</span></span></code> </pre> <br><h3>  Modules that extend the functionality </h3><br>  Since Flake allows you to create and use custom plugins, you can find a large number of open-source plugins for it.  I will describe only those that I use myself and find it especially useful: <br><br>  <b>flake8-import-order</b> <br><br>  The plugin that checks the order of imports in the project: in the standard configuration, the standard libraries (stdlib) should be the first to import, then third-party library imports, and then local packages, each group separated by an empty line and sorted in alphabetical order. <br><br>  This plugin expands the list of Flake alerts by adding three new ones there: <br><br><ul><li>  I100: Your import statements are in the wrong order. </li><li>  I101: The names are in the wrong order. </li><li>  I201: Missing newline between sections or imports. </li></ul><br>  Installation: <br><br><pre> <code class="python hljs">pip install flake8-<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>-order</code> </pre> <br>  Configuration: <br><br><pre> <code class="python hljs">[flake8] application-<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>-names = my_project, tests <span class="hljs-comment"><span class="hljs-comment">#   ,     . import-order-style = google #    ,      .     ,    Google Style Guide.</span></span></code> </pre> <br>  More information about setting flake8-import-order can be found on <a href="https://github.com/PyCQA/flake8-import-order">the library page</a> on Github. <br><br>  <b>flake8-docstrings</b> <br><br>  The plugin that adds functionality support from pydocstyle - checks dockstrings for compliance with Python conventions. <br><br>  Installation: <br><br><pre> <code class="python hljs">pip install flake8_docstrings</code> </pre> <br>  The list of rules added by this library can be found in the <a href="http://www.pydocstyle.org/en/latest/error_codes.html">pydocstyle documentation</a> . <br><br>  Configuration: <br><br>  By itself, this library is not configured in any way, however, the added rules can be added to the exceptions if one of them is irrelevant for your project: <br><br><pre> <code class="python hljs">[flake8] ignore = D101 <span class="hljs-comment"><span class="hljs-comment">#  docstrings  ‚ÄúMissing docstring in public class‚Äù</span></span></code> </pre><br>  Library page on Github <a href="https://github.com/PyCQA/flake8-docstrings">here</a> . <br><br>  <b>flake8-builtins</b> <br><br>  Plugin checking code for using embedded names as variables or parameters. <br><br>  Installation: <br><br><pre> <code class="python hljs">pip install flake8-builtins</code> </pre> <br>  Configuration: <br><br>  As in the case of flake8-docstrings, the plugin does not have additional settings, but the rules it added can, for example, add flake exceptions: <br><br><pre> <code class="python hljs">[flake8] ignore = B001 <span class="hljs-comment"><span class="hljs-comment">#  builtins  ‚Äú&lt;some_builtin&gt; is a python builtin and is being shadowed, consider renaming the variable‚Äù</span></span></code> </pre> <br>  More information about this plugin can be found on <a href="https://github.com/gforcada/flake8-builtins">this</a> Github <a href="https://github.com/gforcada/flake8-builtins">plugin page</a> . <br><br>  <b>flake8-quotes</b> <br><br>  A plugin that allows you to control the type of quotes that will be used in the project. <br><br>  Installation: <br><br><pre> <code class="python hljs">pip install flake8-quotes</code> </pre> <br>  Configuration: <br><br><pre> <code class="python hljs">[flake8] inline-quotes = <span class="hljs-string"><span class="hljs-string">" # ,        </span></span></code> </pre> <br>  More information about this plugin can be found on <a href="https://github.com/zheller/flake8-quotes">this</a> Github <a href="https://github.com/zheller/flake8-quotes">plugin page</a> . <br><br><h3>  Afterword </h3><br>  Although the settings described above can prevent poor-quality code from appearing in the repository in 97.5% of cases, it can be run in some way (for example, if the girl was too lazy to enter two lines to configure the pre-commit hook).  Therefore, I highly recommend adding Flake8 call on the build-pull request stage in the continuous integration system you are using to prevent merge invalid pull-requests and errors from entering the master. <br><br>  I hope this article was useful to you and will allow you to further maximally flexibly and efficiently customize the workflow and style guides in your Python projects.  All the best. <br><br>  List of sources: <br><br><ul><li>  <a href="http://flake8.pycqa.org/en/latest/index.html">Flake8 documentation</a> </li><li>  <a href="https://dancallahan.info/journal/python-flake8/">Useful Python Modules: Flake8</a> </li><li>  <a href="https://google.github.io/styleguide/pyguide.html">Google Python Style Guide</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/318776/">https://habr.com/ru/post/318776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318766/index.html">Founder's advice. Evgeny Kobzev, technical director and co-founder of the company "Button"</a></li>
<li><a href="../318768/index.html">Second Coming GOST 28147-89: Honest Tests</a></li>
<li><a href="../318770/index.html">Cdr. Save and Grow</a></li>
<li><a href="../318772/index.html">Pimcore licensing FAQ</a></li>
<li><a href="../318774/index.html">About recovery. Is RAID on a VPS SSD advisable in case of dedicated drives? Analog server until February for free</a></li>
<li><a href="../318778/index.html">PHPixie Cache: PSR-6, PSR-16 and some interesting features</a></li>
<li><a href="../318780/index.html">Approaches to design in virtual reality</a></li>
<li><a href="../318782/index.html">Java socket framework</a></li>
<li><a href="../318784/index.html">Can your code reason?</a></li>
<li><a href="../318786/index.html">Competitiveness: Cooperativeness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>