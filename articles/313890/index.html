<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How git works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This essay describes the Git workflow. It is assumed that you are familiar with Git enough to use it to control the versions of your projects. 

 The ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How git works</h1><div class="post__text post__text-html js-mediator-article">  This essay describes the Git workflow.  It is assumed that you are familiar with Git enough to use it to control the versions of your projects. <br><br>  The essay focuses on the structure of the graph on which Git is based, and how the properties of this graph determine the behavior of Git.  Studying the basics, you build your presentation on reliable information, and not on hypotheses derived from experiments with API.  The correct model will allow you to better understand what Git did, what it does and what it is going to do. <br><br>  The text is divided into a series of teams working with a single project.  Sometimes there are observations about the data structure of the graph underlying Git.  The observations illustrate the property of the graph and the behavior based on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After reading for an even deeper immersion, you can refer to the abundantly commented source code of my Git implementation in JavaScript. <br><a name="habracut"></a><br><h3>  Project creation </h3><br><pre><code class="hljs dos">~ $ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> alpha ~ $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> alpha</code> </pre> <br>  User creates an alpha directory <br><br><pre> <code class="hljs kotlin">~/alpha $ mkdir <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> ~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'a'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/letter.txt</code> </pre> <br>  It moves to this directory and creates a data directory.  Inside, he creates a letter.txt file with the contents of "a."  The alpha directory looks like this: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">alpha</span></span> └── <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> └── letter.txt</span></span></code> </pre> <br><h3>  Initialize the repository </h3><br><pre> <code class="hljs swift">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-type"><span class="hljs-type">Initialized</span></span> empty <span class="hljs-type"><span class="hljs-type">Git</span></span> repository</code> </pre> <br>  git init adds the current directory to the git repository.  To do this, it creates a .git directory and creates several files in it.  They define the entire Git configuration and project history.  These are ordinary files - no magic.  The user can read and edit them.  That is - the user can read and edit the history of the project as easy as the files of the project itself. <br><br>  Now the alpha directory looks like this: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">alpha</span></span> ├── <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> | └── letter.txt └── .git ├── objects etc...</span></span></code> </pre> <br>  The .git directory with its contents belongs with Git.  All other files are called working copy and belong to the user. <br><br><h3>  Add files </h3><br><pre> <code class="hljs haskell">~/alpha $ git add <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt</span></span></code> </pre> <br>  The user runs git add on data / letter.txt.  Two things happen. <br><br>  First, a new blob file is created in the .git / objects / directory.  It contains the compressed content of data / letter.txt.  Its name is the generated hash based on the content.  For example, Git makes a hash from a and gets 2e65efe2a145dda7ee51d1741299f848e5bf752e.  The first two characters of the hash are used for the directory name in the object database: .git / objects / 2e /.  The remainder of the hash is the name of the blob file containing the internals of the added file: .git / objects / 2e / 65efe2a145dda7ee51d1741299f848e5bf752e. <br><br>  Notice that simply adding a file to Git saves its contents in the objects directory.  It will be stored there if the user deletes data / letter.txt from the working copy. <br><br>  Second, git add adds the file to the index.  The index is a list containing all the files that Git was told to follow.  It is stored in .git / index.  Each line gives a hash of its contents and the time of addition to the monitored file.  This is what the index contents after the git add command is: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt 2e65efe2a145dda7ee51d1741299f848e5bf752e</span></span></code> </pre> <br>  The user creates the data / number.txt file containing 1234. <br><br><pre> <code class="hljs kotlin">~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'1234'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/number.txt</code> </pre> <br>  The working copy looks like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">alpha</span></span> └── <span class="hljs-selector-tag"><span class="hljs-selector-tag">data</span></span> └── <span class="hljs-selector-tag"><span class="hljs-selector-tag">letter</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> └── <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span></code> </pre> <br>  The user adds the file to Git. <br><br><pre> <code class="hljs haskell">~/alpha $ git add <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span></span></code> </pre> <br>  The git add command creates a blob file that stores the contents of data / number.txt.  It adds an entry to the index for data / number.txt pointing to a blob.  Here is the index content after re-running git add: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt 2e65efe2a145dda7ee51d1741299f848e5bf752e </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt 274c0052dd5408f8ae2bc8440029ff67d79bc5c3</span></span></code> </pre> <br>  Notice that the index lists only files from the data directory, although the user gave the git add data command.  The data directory itself is not specified separately. <br><br><pre> <code class="hljs kotlin">~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'1'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/number.txt ~/alpha $ git add <span class="hljs-keyword"><span class="hljs-keyword">data</span></span></code> </pre> <br>  When the user created data / number.txt, he wanted to write 1, not 1234. He makes a change and adds the file to the index again.  This command creates a new blob with new content.  It updates the index entry for data / number.txt indicating the new blob. <br><br><h3>  Making a commit </h3><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'a1'</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span> (root-<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>) <span class="hljs-number"><span class="hljs-number">774</span></span>b54a] a1</code> </pre> <br>  User makes commit a1.  Git displays information about it.  We will explain them soon. <br><br>  The commit command has three steps.  It creates a graph representing the contents of the version of the project that is committed.  It creates a commit object.  It sends the current branch to a new commit object. <br><br><h3>  Creating a graph </h3><br>  Git remembers the current state of the project by creating a tree graph from the index.  This graph records the location and contents of each file in the project. <br><br>  The graph consists of two types of objects: blobs and trees.  Blobs are saved via git add.  They represent the contents of the files.  Trees are saved at commit.  The tree represents the directory in the working copy.  Below is the tree object that recorded the contents of the data directory with a new commit. <br><br><pre> <code class="hljs css">100664 <span class="hljs-selector-tag"><span class="hljs-selector-tag">blob</span></span> 2<span class="hljs-selector-tag"><span class="hljs-selector-tag">e65efe2a145dda7ee51d1741299f848e5bf752e</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">letter</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> 100664 <span class="hljs-selector-tag"><span class="hljs-selector-tag">blob</span></span> 56<span class="hljs-selector-tag"><span class="hljs-selector-tag">a6051ca2b02b04ef92d5150c9ef600403cb1de</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span></code> </pre> <br>  The first line records everything needed to reproduce data / letter.txt.  The first part stores file permissions.  The second is that the contents of the file are stored in a blob, and not in a tree.  The third is a blob hash.  The fourth is the file name. <br><br>  The second line in the same way applies to data / number.txt. <br><br>  Below is the tree object for alpha, the root directory of the project: <br><br><pre> <code class="hljs haskell"><span class="hljs-number"><span class="hljs-number">040000</span></span> tree <span class="hljs-number"><span class="hljs-number">0</span></span>eed1217a2947f4930583229987d90fe5e8e0b74 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span></span></code> </pre> <br>  A single line points to the data tree. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/994/586/204/9945862040afc138dd73213feb0d6661.png"></div><br><br>  In the above graph, the root tree points to the data tree.  The data tree indicates blobs for data / letter.txt and data / number.txt. <br><br><h3>  Creating a commit object </h3><br>  git commit creates a commit object after creating a graph.  A commit object is another text file in .git / objects /: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">tree</span></span> ffe298c3ce8bb07326f888907996eaa48d266db4 author Mary Rose Cook &lt;mary<span class="hljs-variable"><span class="hljs-variable">@maryrosecook</span></span>.com&gt; <span class="hljs-number"><span class="hljs-number">1424798436</span></span> -<span class="hljs-number"><span class="hljs-number">0500</span></span> committer Mary Rose Cook &lt;mary<span class="hljs-variable"><span class="hljs-variable">@maryrosecook</span></span>.com&gt; <span class="hljs-number"><span class="hljs-number">1424798436</span></span> -<span class="hljs-number"><span class="hljs-number">0500</span></span> a1</code> </pre> <br>  The first line indicates the tree of the graph.  The hash is for the tree object representing the root of the working copy.  That is, alpha directories.  The last line is a commit comment. <br><br><div style="text-align:center;"><img src="https://codewords.recurse.com/images/two/git-from-the-inside-out/2-a1-commit.png"></div><br><br><h3>  Send current branch to new commit </h3><br>  Finally, the commit command directs the current branch to a new commit object. <br><br>  What is our current branch?  Git goes to the HEAD file in .git / HEAD and sees: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">ref</span></span>: refs/heads/master</code> </pre> <br>  This means HEAD points to master.  master is the current branch. <br><br>  HEAD and master are links.  A link is a label used by Git, or by the user, to identify a specific commit. <br><br>  The file representing the master link does not exist, as this is the first commit in the repository.  Git creates a file in .git / refs / heads / master and sets its contents — the hash of the commit object: <br><br><pre> <code class="hljs">74ac3ad9cde0b265d2b4f1c778b283a6e2ffbafd</code> </pre> <br>  (If you are typing into Git commands in parallel with reading, your a1 hash will be different from mine. The hash of content objects — blobs and trees — is always the same. But no commits, because they take into account the dates and names of the creators). <br><br>  Add Git HEAD and master to the graph: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/441/439/dcb/441439dcbf089828f916b34f4c4a3ab7.png"></div><br><br>  HEAD points to master, just as before the commit.  But now master exists and points to a new commit object. <br><br><h3>  We make not the first commit </h3><br>  Below is the graph after commit a1.  Working copy and index included. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/d53/6a9/e87d536a933bfdd133c2ac4405b1230a.png"></div><br><br>  Notice that the working copy, index, and commit have the same content data / letter.txt and data / number.txt.  Index and HEAD use hashes to indicate blobs, but the contents of the working copy are stored as text elsewhere. <br><br><pre> <code class="hljs kotlin">~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'2'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/number.txt</code> </pre> <br>  The user changes the data / number.txt contents to 2. This updates the working copy, but leaves the index and HEAD unchanged. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/58b/7db/b62/58b7dbb62f69cc32db5a3fec7ae7b840.png"></div><br><br><pre> <code class="hljs haskell">~/alpha $ git add <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt</span></span></code> </pre> <br>  The user adds the file to Git.  This adds a blob containing 2 to the objects directory.  Index entry pointer for data / number.txt points to a new blob. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9f/d32/ab9/a9fd32ab904f7f0ad3b8ecaac8964d3c.png"></div><br><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'a2'</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span> f0af7e6] a2</code> </pre> <br>  The user makes a commit.  His steps are the same as before. <br><br>  First, a new tree graph is created to represent the contents of the index. <br><br>  The entry in the index for data / number.txt has changed.  The old data tree no longer reflects the indexed state of the data directory.  You need to create a new data tree object. <br><br><pre> <code class="hljs css">100664 <span class="hljs-selector-tag"><span class="hljs-selector-tag">blob</span></span> 2<span class="hljs-selector-tag"><span class="hljs-selector-tag">e65efe2a145dda7ee51d1741299f848e5bf752e</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">letter</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span> 100664 <span class="hljs-selector-tag"><span class="hljs-selector-tag">blob</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">d8263ee9860594d2806b0dfd1bfd17528b0ba2a4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span></code> </pre> <br>  The hash of the new object is different from the old data tree.  You need to create a new root tree to write this hash. <br><br><pre> <code class="hljs haskell"><span class="hljs-number"><span class="hljs-number">040000</span></span> tree <span class="hljs-number"><span class="hljs-number">40</span></span>b0318811470aaacc577485777d7a6780e51f0b <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span></span></code> </pre> <br>  Secondly, a new commit object is created. <br><br><pre> <code class="hljs mel">tree ce72afb5ff229a39f6cce47b00d1b0ed60fe3556 <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-number"><span class="hljs-number">774</span></span>b54a193d6cfdd081e581a007d2e11f784b9fe author Mary Rose Cook &lt;mary@maryrosecook.com&gt; <span class="hljs-number"><span class="hljs-number">1424813101</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> committer Mary Rose Cook &lt;mary@maryrosecook.com&gt; <span class="hljs-number"><span class="hljs-number">1424813101</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> a2</code> </pre> <br>  The first line of the commit object points to the new root object.  The second line indicates a1: parent commit.  To find the parent commit, Git goes to HEAD, goes to master and finds the hash of a1. <br><br>  Third, the contents of the master branch file are changed to the hash of the new commit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c5/9da/c85/8c59dac85bb79c2e4ded140b6b0c2125.png"></div><br>  <em>Commit a2</em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/8fa/1a5/e998fa1a51ac952f525f662fad35b541.png"></div><br>  <em>Git graph without working copy and index</em> <br><br>  Properties of the graph: <br><br>  • Content is stored as a tree of objects.  This means that only changes are stored in the database.  Take a look at the graph above.  Commit a2 reuses a blob made before commit a1.  In the same way, if the entire directory from commit to commit does not change, its tree and all blobs and underlying trees can be reused.  Usually the changes between commits are small.  This means that Git can store large commit stories, taking up little space. <br><br>  • Each commit has an ancestor.  This means that the history of the project can be stored in the repository. <br><br>  • Links - input points for a particular commit history.  This means that commits can be given meaningful names.  The user organizes the work in the form of a pedigree, meaningful for his project, with links like fix-for-bug-376.  Git uses symbolic links like HEAD, MERGE_HEAD and FETCH_HEAD to support the commit history editing command. <br><br>  • The nodes in the objects / directory are immutable.  This means that the content is edited but not deleted.  Every piece of content added ever, every commit made is stored somewhere in the objects directory. <br><br>  • Links are changeable.  Hence, the meaning of the link may change.  The commit pointed to by master may be the best version of the project at the moment, but it may soon be replaced by a new commit. <br><br>  • Working copy and referenced commits are immediately available.  Other commits are not.  This means that recent history is easier to call, but it also changes more often.  We can say that the memory of Git is constantly disappearing, and it must be stimulated by more and more hard butting. <br><br>  A working copy is easiest to retrieve from history because it is at the root of the repository.  Her call doesn't even require a git command.  But it is also the most inconstant point in history.  A user can make a dozen versions of a file, but Git will not write any of them until they are added. <br><br>  The commit that HEAD points to is very easy to call.  It is at the end of the confirmed branch.  To view its contents, the user can simply save and then examine the working copy.  And at the same time, HEAD is the most frequently changing link. <br><br>  The commit to which a particular link points is easy to call.  The user simply confirms this thread.  The end of a branch changes less often than HEAD, but it is enough to change the meaning of the name of the branch. <br><br>  It is difficult to cause a commit that is not referenced.  The further the user moves away from the link, the harder it is for him to recreate the meaning of the commit.  But the farther he goes into the past, the less likely it is that someone has changed the story since their last viewing. <br><br><h3>  Confirm (check out) commit </h3><br><pre> <code class="hljs cs">~/alpha $ git checkout <span class="hljs-number"><span class="hljs-number">37888</span></span>c2 You are <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'detached HEAD'</span></span> state...</code> </pre> <br>  The user confirms commit a2 using his hash.  (If you run these commands, then this command will not work for you. Use git log to find out the hash of your commit a2). <br><br>  The confirmation consists of four steps. <br><br>  First, Git gets commit a2 and the graph it points to. <br><br>  Secondly, he takes notes on the files in the graph in the working copy.  As a result, no changes occur.  The working copy already contains the contents of the graph, since HEAD already pointed to a2 commit via master. <br><br>  Thirdly, Git makes entries about the files in the graph in the index.  Here, too, changes do not occur.  The index already contains commit a2. <br><br>  Fourth, the HEAD content is assigned to the a2 commit hash: <br><br><pre> <code class="hljs">f0af7e62679e144bb28c627ee3e8f7bdb235eee9</code> </pre> <br>  Writing a hash in HEAD results in a repository in a state with a separate HEAD.  Notice in the box below that HEAD points directly to commit a2, and not to master. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b6/808/6f4/2b68086f4ab08e45b1eff6714c5a186e.png"></div><br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'3'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'a3'</span></span> [detached <span class="hljs-type"><span class="hljs-type">HEAD</span></span> <span class="hljs-number"><span class="hljs-number">3645</span></span>a0e] a3</code> </pre> <br>  The user writes the value 3 to the contents of data / number.txt and commits the change.  Git goes to HEAD to get the parent of commit a3.  Instead of finding and following a link to a branch, it finds and returns the a2 commit hash. <br><br>  Git is updating HEAD so that it points to the hash of new commit a3.  The repository is still in a state with a separate HEAD.  It is not on a branch, since no commit indicates either a3 or any of its descendants.  It's easy to lose. <br><br>  Next we will omit the trees and blobs from the graph charts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/448/070/0a9/4480700a9dfb77684c46765b6773b3bf.png"></div><br><br>  Create a branch <br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git branch deputy</code> </pre> <br>  The user creates a new branch called deputy.  As a result, a new file in .git / refs / heads / deputy appears, containing the hash pointed to by HEAD: commit a3 hash. <br><br>  Branches are only links, and links are only files.  This means that Git branches weigh very little. <br><br>  Creating a deputy branch places a new commit a3 on the branch.  HEAD is still separated because it still points directly to the commit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/242/124/ae4/242124ae4f181c24e26e31dec0eaae65.png"></div><br><br><h3>  Confirm branch </h3><br><pre> <code class="hljs pgsql">~/alpha $ git checkout master Switched <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> branch <span class="hljs-string"><span class="hljs-string">'master'</span></span></code> </pre> <br>  The user confirms the master branch. <br><br>  First, Git gets the commit a2, pointed to by master, and gets the graph pointed to by commit. <br><br>  Secondly, Git makes file entries in the graph in the working copy files.  This changes the data / number.txt content to 2. <br><br>  Third, Git makes file entries in the index graph.  This updates the entry for data / number.txt on the hash of the blob 2. <br><br>  Fourth, Git sends HEAD to master, changing its contents from hash to <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">ref</span></span>: refs/heads/master</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/47e/157/84847e15764ecc2a3026af40cd3c32f2.png"></div><br><br>  Confirm branch incompatible with working copy <br><br><pre> <code class="hljs pgsql">~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'789'</span></span> &gt; data/number.txt ~/alpha $ git checkout deputy Your changes <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> these files would be overwritten <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> checkout: data/number.txt <span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span> your changes <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> stash them <span class="hljs-keyword"><span class="hljs-keyword">before</span></span> you switch branches.</code> </pre> <br>  The user accidentally assigns the content to data / number.txt a value of 789. He is trying to confirm the deputy.  Git prevents confirmation. <br><br>  HEAD points to the master pointing to a2, where it is recorded in data / number.txt 2. deputy points to a3, where it is recorded in data / number.txt 3. In the working copy version for data / number.txt, 789 is written. All these versions different, and the difference needs to be somehow eliminated. <br><br>  Git can replace the version of the working copy with the version from the confirmed commit.  But he avoids data loss with all his might. <br><br>  Git can merge the version of the working copy with the confirmed version.  But it is difficult. <br><br>  Therefore, Git rejects confirmation. <br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'2'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout deputy <span class="hljs-type"><span class="hljs-type">Switched</span></span> to branch <span class="hljs-string"><span class="hljs-string">'deputy'</span></span></code> </pre> <br>  The user notices that he accidentally edited data / number.txt and assigns him back 2. Then he successfully confirms the deputy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c8/d38/b7f/7c8d38b7fab57d8838c513dd73eac084.png"></div><br><br><h3>  Ancestor Union </h3><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> Already up-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-date.</code> </pre> <br>  User includes master in deputy.  Merging two branches means merging two commits.  The first commit is the one pointed to by the deputy: the receiver.  The second commit is the one pointed to by master: the giver.  Git does nothing to merge.  He reports that he is already "Already up-to-date". <br><br>  A series of associations in the graph is interpreted as a series of changes to the repository contents.  This means that when merged, if the commit of the giver is obtained as the ancestor of the host commit, Git does nothing.  These changes have already been made. <br><br><h3>  Association with the descendant </h3><br><pre> <code class="hljs pgsql">~/alpha $ git checkout master Switched <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> branch <span class="hljs-string"><span class="hljs-string">'master'</span></span></code> </pre> <br>  The user confirms the master. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/47e/157/84847e15764ecc2a3026af40cd3c32f2.png"></div><br><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> deputy <span class="hljs-keyword"><span class="hljs-keyword">Fast</span></span>-forward</code> </pre> <br>  It includes a deputy in the master.  Git discovers that the commit commit, a2, is the ancestor of the giver’s commit, a3.  It can do the fast forward forwarding. <br><br>  He takes the commit of the giver and the graph to which he points.  It makes file entries in the working copy and index columns.  Then he “rewinds” the master to point to a3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab6/3a2/78f/ab63a278fff3b2bcdc65b2302ee42505.png"></div><br><br>  A series of commits on a graph is interpreted as a series of changes to the repository contents.  This means that when combined, if the giver is a descendant of the receiver, the story does not change.  There is already a sequence of commits describing the necessary changes: a sequence of commits between the receiver and the giver.  But, although the history of Git does not change, the Git graph is changing.  The specific link that HEAD points to is updated to indicate the commit's commit. <br><br><h3>  Merge two commits from different pedigrees </h3><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'4'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'a4'</span></span> [master <span class="hljs-number"><span class="hljs-number">7</span></span>b7bd9a] a4</code> </pre> <br>  The user writes 4 to the contents of number.txt and commits the change to master. <br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout deputy <span class="hljs-type"><span class="hljs-type">Switched</span></span> to branch <span class="hljs-string"><span class="hljs-string">'deputy'</span></span> ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'b'</span></span> &gt; data/letter.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/letter.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'b3'</span></span> [deputy <span class="hljs-number"><span class="hljs-number">982</span></span>dffb] b3</code> </pre> <br>  The user confirms the deputy.  He writes “b” to the contents of data / letter.txt and commits the change to deputy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/5d1/47f/66b5d147f2b01c091a4b6abb4c0f7cc7.png"></div><br><br>  Commits can have common parents.  This means that in the history of commits you can create new genealogies. <br><br>  A commit can have multiple parents.  This means that different pedigrees can be combined by a commit with two parents: a unifying commit. <br><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> -m <span class="hljs-string"><span class="hljs-string">'b4'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Merge</span></span> made <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the <span class="hljs-string"><span class="hljs-string">'recursive'</span></span> strategy.</code> </pre> <br>  User merges master with deputy. <br><br>  Git discovers that the receiver, b3, and the giver, a4, are in different pedigrees.  He performs a commit commit.  This process has eight steps. <br><br>  <strong>1.</strong> Git writes the hash of the commit commit to the alpha / .git / MERGE_HEAD file.  The presence of this file tells Git that it is in the process of being merged. <br><br>  <strong>2.</strong> Secondly, Git finds the base commit: the newest ancestor, common to the giving and receiving commits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/5d1/47f/66b5d147f2b01c091a4b6abb4c0f7cc7.png"></div><br><br>  Commits have parents.  This means that you can find the point at which the two pedigrees are divided.  Git tracks the chain back from b3 to find all its ancestors, and back from a4 for the same purpose.  He finds the newest of their common ancestors, a3.  This is a basic commit. <br><br>  <strong>3.</strong> Git creates indices for base, giver and host commits from their tree graphs. <br><br>  <strong>4.</strong> Git creates a diff that merges the changes that the commit and giver commits to the baseline.  This diff is a list of file paths that indicate changes: add, delete, modify, or conflict. <br><br>  Git gets a list of all the files in the indices of the base commit that receives and gives.  For each, he compares the entries in the indexes and decides how to change the file.  He writes the corresponding entry in diff.  In our case, there are two entries in diff. <br><br>  The first entry for data / letter.txt.  The contents of this file are “a” in the base file, “b” in the receiver and “a” in the giver.  The content of the base and the receiver is different.  But at the base and the giver - the same.  Git sees that the content has been changed by the recipient, not the giver.  The diff entry for data / letter.txt is a change, not a conflict. <br><br>  The second entry in diff is for data / number.txt.  In this case, the content is the same for the base and the receiver, and for the one who gives it is different.  The diff entry for data / number.txt is also a change. <br><br>  It is possible to find a base commit association.  This means that if a file differs from the base only in the recipient or the giver, Git can automatically merge the file.  This reduces the work that the user must do. <br><br>  <strong>5. The</strong> changes described by the diff entries apply to the working copy.  The contents of data / letter.txt are set to b, and the contents of data / number.txt are set to 4. <br><br>  <strong>6. The</strong> changes described by the diff entries apply to the index.  The entry for data / letter.txt points to blob b, and the entry for data / number.txt points to blob 4. <br><br>  <strong>7.</strong> Confirmed updated index: <br><br><pre> <code class="hljs mel">tree <span class="hljs-number"><span class="hljs-number">20294508</span></span>aea3fb6f05fcc49adaecc2e6d60f7e7d <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-number"><span class="hljs-number">982</span></span>dffb20f8d6a25a8554cc8d765fb9f3ff1333b <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>b7bd9a5253f47360d5787095afc5ba56591bfe7 author Mary Rose Cook &lt;mary@maryrosecook.com&gt; <span class="hljs-number"><span class="hljs-number">1425596551</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> committer Mary Rose Cook &lt;mary@maryrosecook.com&gt; <span class="hljs-number"><span class="hljs-number">1425596551</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> b4</code> </pre> <br>  Please note that a commit has two parents. <br><br>  <strong>8.</strong> Git sends the current branch, the deputy, to a new commit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fae/dab/f23/faedabf234364e78c2ec238991928fcd.png"></div><br><br><h3>  Combining two commits from different pedigrees, changing the same file </h3><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout master <span class="hljs-type"><span class="hljs-type">Switched</span></span> to branch <span class="hljs-string"><span class="hljs-string">'master'</span></span> ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git merge deputy <span class="hljs-type"><span class="hljs-type">Fast</span></span>-forward</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user confirms the master. </font><font style="vertical-align: inherit;">He combines the deputy and master. </font><font style="vertical-align: inherit;">This causes the master to rewind to commit b4. </font><font style="vertical-align: inherit;">Now master and deputy point to the same commit.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c83/fae/2b9/c83fae2b9199739d48b56d213d4c4075.png"></div><br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout deputy <span class="hljs-type"><span class="hljs-type">Switched</span></span> to branch <span class="hljs-string"><span class="hljs-string">'deputy'</span></span> ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'5'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'b5'</span></span> [deputy bd797c2] b5</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user confirms the deputy. </font><font style="vertical-align: inherit;">It sets the contents of data / number.txt to 5 and confirms the change in the deputy.</font></font><br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout master <span class="hljs-type"><span class="hljs-type">Switched</span></span> to branch <span class="hljs-string"><span class="hljs-string">'master'</span></span> ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'6'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'b6'</span></span> [master <span class="hljs-number"><span class="hljs-number">4</span></span>c3ce18] b6</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user confirms the master. </font><font style="vertical-align: inherit;">It sets the contents of data / number.txt to 6 and confirms the change to master.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/d51/429/75cd51429ac0c90c3e74fe939889da71.png"></div><br><br><pre> <code class="hljs pgsql">~/alpha $ git merge deputy <span class="hljs-keyword"><span class="hljs-keyword">CONFLICT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data/number.txt Automatic merge failed; fix conflicts <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> the result.</code> </pre> <br>   deputy  master.     .          ,      :  .git/MERGE_HEAD,   ,    ,    ,  diff,      . -            .      ,  . <br><br> <strong>1.</strong> Git       .git/MERGE_HEAD. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e6/a9b/0ff/6e6a9b0ff9e94dfe3e04a57f657a2272.png"></div><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git finds a base commit, b4. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git generates indices for basic, committing and giving commits. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git generates a diff that combines changes to the base commit made by the receive and give commits. This diff is a list of paths to files indicating changes: add, delete, modify, or conflict. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, diff contains only one entry: data / number.txt. It is marked as a conflict, since the content of data / number.txt is different in the giving, receiving and basic commits. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Changes made by diff entries apply to the working copy. In the conflict area, Git prints both versions to a working copy file. The contents of the ata / number.txt file becomes the following:</font></font><br><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;&lt;&lt;&lt;&lt;&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">HEAD</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">6</span></span></span></span><span class="xml"><span class="hljs-tag"> ======= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">5</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">&gt;&gt;&gt;&gt;&gt;&gt; deputy</span></span></code> </pre> <br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. The</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> changes defined by the diff entries apply to the index. </font><font style="vertical-align: inherit;">Entries in the index have a unique identifier in the form of a combination of file path and stage. </font><font style="vertical-align: inherit;">For a file entry without conflict, the stage is 0. Before the union, the index looked like this, where the zeros are the numbers of the stages:</font></font><br><br><pre> <code class="hljs haskell"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748 0 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt 62f9457511f879886bb7728c986fe10b0ece6bcb</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After writing diff to the index, it looks like this: </font></font><br><br><pre> <code class="hljs haskell"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748 1 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt bf0d87ab1b2b0ec1a11a3973d2845b42413d9767 2 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt 62f9457511f879886bb7728c986fe10b0ece6bcb 3 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/number.txt 7813681f5b41c028345ca62a2be376bae70b7f61</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The data / letter.txt entry in step 0 is the same as it was before the merge. </font><font style="vertical-align: inherit;">The entry for data / number.txt with step 0 disappeared. </font><font style="vertical-align: inherit;">Instead, there are three new ones. </font><font style="vertical-align: inherit;">The entry with stage 1 hash from the base content of data / number.txt. </font><font style="vertical-align: inherit;">The entry with stage 3 hash from the content of the data / number.txt giver. </font><font style="vertical-align: inherit;">The presence of three entries tells Git that a conflict has arisen for data / number.txt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merging is suspended.</font></font><br><br><pre> <code class="hljs kotlin">~/alpha $ printf <span class="hljs-string"><span class="hljs-string">'11'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/number.txt ~/alpha $ git add <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>/number.txt</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user integrates the contents of the two conflicting versions, setting the contents of data / number.txt to 11. It adds the file to the index. </font><font style="vertical-align: inherit;">Git adds a blob containing 11. Adding a conflict file tells Git that the conflict has been resolved. </font><font style="vertical-align: inherit;">Git removes the data / number.txt occurrences for steps 1, 2 and 3 from the index. </font><font style="vertical-align: inherit;">It adds an entry for data / number.txt in step 0 with a hash from the new blob. </font><font style="vertical-align: inherit;">Now the index contains entries:</font></font><br><br><pre> <code class="hljs sql">0 data/letter.txt 63d8dbd40c23542e740659a7168a0ce3138ea748 0 data/number.txt 9d607966b721abde8931ddd052181fae905db503 ~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'b11'</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span> <span class="hljs-number"><span class="hljs-number">251</span></span>a513] b11</code> </pre> <br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User commits. </font><font style="vertical-align: inherit;">Git sees it in the .git / MERGE_HEAD repository, which tells it that merging is in progress. </font><font style="vertical-align: inherit;">It checks the index and does not detect conflicts. </font><font style="vertical-align: inherit;">He creates a new commit, b11, to record the contents of the allowed join. </font><font style="vertical-align: inherit;">It deletes the .git / MERGE_HEAD file. </font><font style="vertical-align: inherit;">This completes the merger. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git sends the current branch, master, to the new commit.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c04/e33/88c/c04e3388ca799ec14824bc64a101134f.png"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Delete file </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The chart for the Git graph includes the commit history, trees and blobs of the last commit, working copy and index: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3e/e6d/919/e3ee6d919a069e5331548647dec0422d.png"></div><br><br><pre> <code class="hljs haskell">~/alpha $ git rm <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt rm '</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/letter.txt'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User instructs Git to remove data / letter.txt. </font><font style="vertical-align: inherit;">The file is deleted from the working copy. </font><font style="vertical-align: inherit;">An entry is removed from the index.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b7/863/6e2/6b78636e2218aa5213919a5a274ac429.png"></div><br><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'11'</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">master</span></span> d14c7d2] <span class="hljs-number"><span class="hljs-number">11</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user makes a commit. </font><font style="vertical-align: inherit;">As usual with commits, Git builds a graph representing the contents of the index. </font><font style="vertical-align: inherit;">data / letter.txt is not included in the graph since it is not in the index.</font></font><br><br><div style="text-align:center;"><img src="https://codewords.recurse.com/images/two/git-from-the-inside-out/25-11.png"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Copy repository </font></font></h3><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>cd .. ~ <span class="hljs-string"><span class="hljs-string">$ </span></span>cp -<span class="hljs-type"><span class="hljs-type">R</span></span> alpha bravo</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user copies the contents of the alpha / repository to the bravo / directory. </font><font style="vertical-align: inherit;">This leads to the following structure:</font></font><br><br><pre> <code class="hljs haskell">~ ├── alpha | └── <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> | └── number.txt └── bravo └── </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> └── number.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now in the bravo directory there is a new Git graph: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/880/55a/189/88055a18933db95ee82223c26a8df17a.png"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Associate a repository with another repository. </font></font></h3><br><pre> <code class="hljs ruby"> ~ $ cd alpha ~<span class="hljs-regexp"><span class="hljs-regexp">/alpha $ git remote add bravo ../bravo</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user is returned to the alpha repository. </font><font style="vertical-align: inherit;">He assigns bravo to the remote repository for alpha. </font><font style="vertical-align: inherit;">This adds several lines to the alpha / .git / config file:</font></font><br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">remote </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"bravo"</span></span></span></span>] url = ../bravo/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The lines say that there is a bravo remote repository in the ../bravo directory. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get a branch from a remote repository </font></font></h3><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>cd ../bravo ~/bravo <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'12'</span></span> &gt; data/number.txt ~/bravo <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/bravo <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'12'</span></span> [master <span class="hljs-number"><span class="hljs-number">94</span></span>cd04d] <span class="hljs-number"><span class="hljs-number">12</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user goes to the bravo repository. </font><font style="vertical-align: inherit;">It sets the content of data / number.txt to 12 and commits the change to master to bravo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e0/dd0/847/7e0dd08474a5df4cd39082f8d697c96a.png"></div><br><br><pre> <code class="hljs pgsql">~/bravo $ cd ../alpha ~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> bravo master Unpacking objects: <span class="hljs-number"><span class="hljs-number">100</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> ../bravo * branch master -&gt; FETCH_HEAD</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user goes to the alpha repository. </font><font style="vertical-align: inherit;">It copies the master from bravo to alpha. </font><font style="vertical-align: inherit;">This process has four steps. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git gets the commit hash that master points to in bravo. </font><font style="vertical-align: inherit;">This is a hash of commit 12. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Git makes a list of all objects on which commit 12 depends: the commit object itself, the objects in its graph, commits of the ancestor of commit 12, and objects from their graphs. </font><font style="vertical-align: inherit;">It removes from this list all the objects that already exist in the alpha database. </font><font style="vertical-align: inherit;">He copies the rest to alpha / .git / objects /. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. The</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> content of the specific reference file in alpha / .git / refs / remotes / bravo / master is assigned the hash of commit 12. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. The</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> content of alpha / .git / FETCH_HEAD becomes the following:</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">94</span></span>cd04d93ae88a1f53a4646532b1e8cdfbc0977f branch <span class="hljs-string"><span class="hljs-string">'master'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ../bravo</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This means that the most recent fetch command got commit 12 from master with bravo. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/455/fa9/c1d/455fa9c1de4bee7b63b832729208dff2.png"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objects can be copied. </font><font style="vertical-align: inherit;">This means that different repositories can have a common story. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositories can store links to remote branches of the type alpha / .git / refs / remotes / bravo / master. </font><font style="vertical-align: inherit;">This means that the repository can locally record the state of the branch of the remote repository. </font><font style="vertical-align: inherit;">It is correct when it is copied, but will become obsolete if the remote branch changes.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FETCH_HEAD union </font></font></h3><br><pre> <code class="hljs sql">~/alpha $ git <span class="hljs-keyword"><span class="hljs-keyword">merge</span></span> FETCH_HEAD Updating d14c7d2.<span class="hljs-number"><span class="hljs-number">.94</span></span>cd04d <span class="hljs-keyword"><span class="hljs-keyword">Fast</span></span>-forward</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User merges FETCH_HEAD. </font><font style="vertical-align: inherit;">FETCH_HEAD is just another link. </font><font style="vertical-align: inherit;">She points to commit 12, giving. </font><font style="vertical-align: inherit;">HEAD points to commit 11, the host. </font><font style="vertical-align: inherit;">Git does a rewind join and sends the master to commit 12.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be5/421/6ac/be54216acb1e92f6d2af18f6c389a442.png"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get remote repository branch </font></font></h3><br><pre> <code class="hljs pgsql">~/alpha $ git pull bravo master Already up-<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>-<span class="hljs-type"><span class="hljs-type">date</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User transfers master from bravo to alpha. </font><font style="vertical-align: inherit;">Pull is short for “copy and merge FETCH_HEAD”. </font><font style="vertical-align: inherit;">Git executes both commands and reports that the master is “Already up-to-date”.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clone repository </font></font></h3><br><pre> <code class="hljs bash">~/alpha $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. ~ $ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> alpha charlie Cloning into <span class="hljs-string"><span class="hljs-string">'charlie'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user moves to the top directory. </font><font style="vertical-align: inherit;">He clones alpha into charlie. </font><font style="vertical-align: inherit;">Cloning produces results similar to the cp command that the user performed to create the bravo repository. </font><font style="vertical-align: inherit;">Git creates a new charlie directory. </font><font style="vertical-align: inherit;">It initializes charlie as a repository, adds alpha as remote as origin, gets origin, and combines FETCH_HEAD.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Place (push) the branch on the confirmed branch on the remote repository </font></font></h3><br><pre> <code class="hljs smalltalk"> ~ <span class="hljs-string"><span class="hljs-string">$ </span></span>cd alpha ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'13'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'13'</span></span> [master <span class="hljs-number"><span class="hljs-number">3238468</span></span>] <span class="hljs-number"><span class="hljs-number">13</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user is returned to the alpha repository. </font><font style="vertical-align: inherit;">Sets the content of data / number.txt to 13 and commits the change to master to alpha.</font></font><br><br><pre> <code class="hljs cs">~/alpha $ git remote <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> charlie ../charlie</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It assigns charlie the remote alpha repository </font></font><br><br><pre> <code class="hljs pgsql">~/alpha $ git push charlie master Writing objects: <span class="hljs-number"><span class="hljs-number">100</span></span>% remote error: refusing <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> checked <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> branch: refs/heads/master because it will make the <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span> tree inconsistent</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">He places the master on charlie. All objects needed for commit 13 are copied to charlie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this point, the placement process stops. Git, as always, tells the user what went wrong. He refuses to post on a branch that is confirmed remotely. It makes sense. Placement would update the remote index and HEAD. This would cause confusion if someone else edited a working copy on a remote repository.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this point, the user can create a new branch, merge commit 13 with it, and place this branch on charlie. </font><font style="vertical-align: inherit;">But users need a repository on which you can post anything. </font><font style="vertical-align: inherit;">They need a central repository, on which they can be placed, and from which they can be received (pull), but to which no one directly commits. </font><font style="vertical-align: inherit;">They need something like a remote github. </font><font style="vertical-align: inherit;">They need a clean (bare) repository.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We clone clean (bare) repository </font></font></h3><br><pre> <code class="hljs bash">~/alpha $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. ~ $ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> alpha delta --bare Cloning into bare repository <span class="hljs-string"><span class="hljs-string">'delta'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user goes to the top directory. </font><font style="vertical-align: inherit;">It creates a delta clone as a clean repository. </font><font style="vertical-align: inherit;">This is a common clone with two features. </font><font style="vertical-align: inherit;">The config file says that the repository is clean. </font><font style="vertical-align: inherit;">And the files usually stored in the .git directory are stored in the root of the repository:</font></font><br><br><pre> <code class="hljs lua">delta ├── HEAD ├── <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> ├── objects └── refs</code> </pre> <br><div style="text-align:center;"><img src="https://codewords.recurse.com/images/two/git-from-the-inside-out/30-13-alpha-cloned-to-delta-bare.png"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Put a branch in a clean repository </font></font></h3><br><pre> <code class="hljs ruby"> ~ $ cd alpha ~<span class="hljs-regexp"><span class="hljs-regexp">/alpha $ git remote add delta ../delta</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user is returned to the alpha repository. </font><font style="vertical-align: inherit;">It assigns the delta as the remote repository for alpha.</font></font><br><br><pre> <code class="hljs smalltalk">~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>printf <span class="hljs-string"><span class="hljs-string">'14'</span></span> &gt; data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git add data/number.txt ~/alpha <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit -m <span class="hljs-string"><span class="hljs-string">'14'</span></span> [master cb51da8] <span class="hljs-number"><span class="hljs-number">14</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It sets the content to 14 and commits the change to master to alpha. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/45f/235/5a845f23510f47c2644a1543b48b6ab8.png"></div><br><br><pre> <code class="hljs pgsql">~/alpha $ git push delta master Writing objects: <span class="hljs-number"><span class="hljs-number">100</span></span>% <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> ../delta <span class="hljs-number"><span class="hljs-number">3238468.</span></span>.cb51da8 master -&gt; master</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It places the master in delta. </font><font style="vertical-align: inherit;">Placement takes place in three stages. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All objects required for commit 14 on the master branch are copied from alpha / .git / objects / to delta / objects /. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> delta / refs / heads / master is updated to commit 14. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alpha / .git / refs / remotes / delta / master is sent to commit 14. The current status record delta is in alpha.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/857/20b/d48/85720bd485c71fb7a6f06b64a52994d6.png"></div><br><h3>  Total </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Git is built on a graph. </font><font style="vertical-align: inherit;">Almost all Git commands manipulate this graph. </font><font style="vertical-align: inherit;">To understand Git, focus on the properties of the graph, not the procedures or commands. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To learn more about Git, explore the .git directory.</font></font> It's not scary.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Look inside. </font><font style="vertical-align: inherit;">Change the contents of the files and see what happens. </font><font style="vertical-align: inherit;">Create a commit manually. </font><font style="vertical-align: inherit;">Try to see how hard you can break the repository. </font><font style="vertical-align: inherit;">Then fix it.</font></font></div><p>Source: <a href="https://habr.com/ru/post/313890/">https://habr.com/ru/post/313890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313880/index.html">Lectures Tehnotreka. 1 semester Java Development (Spring 2016)</a></li>
<li><a href="../313882/index.html">Security Week 43: Dyn server attack, fake tech support life, Linux vulnerability</a></li>
<li><a href="../313884/index.html">Heavenly path in php</a></li>
<li><a href="../313886/index.html">400 musical instruments for Javascript</a></li>
<li><a href="../313888/index.html">Purely experimental techniques for porting the Stream API from Java 8 to Java 6</a></li>
<li><a href="../313892/index.html">Tensor expansions and their applications. Lecture in Yandex</a></li>
<li><a href="../313894/index.html">In search of the limit. 6 myths of efficiency, which I dispelled, working 14 hours a day for a month</a></li>
<li><a href="../313898/index.html">As we Wednesday Arduino on 8051, or OS on one process</a></li>
<li><a href="../313904/index.html">Mitch Kapor: business in the lotus position, second life and electronic frontier</a></li>
<li><a href="../313906/index.html">[Bookmark] Zoo neural network architectures. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>