<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Electron microscope in the garage. Image capture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the first time, see a microscope in a garage? Then start a fascinating reading with the first issue . 

 Since the previous publication, a lot of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Electron microscope in the garage. Image capture</h1><div class="post__text post__text-html js-mediator-article">  For the first time, see a microscope in a garage?  Then start a fascinating reading with the <a href="https://geektimes.ru/post/282268/">first issue</a> . <br><br>  Since the previous publication, a lot of time has passed, it‚Äôs time to talk about successes :) All this time I devoted to the practical study of electronics (digital and analog), made about a dozen printed circuit boards (LUT method turned out to be quite good!), Looked through hundreds of circuits from different electron microscopes of various prescription of manufacture.  And even gathered a couple of projects on the Arduino to practice on something. <br><br>  After receiving the necessary experience and knowledge, he began to develop electronics and software for the microscope. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/TptBI1Rn9_c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In the video - a demonstration of how implemented scanning and image capture.  The board is not connected to anything yet, but the data is real (from the gradients of gray you can guess the moments when I connect the input to the scan outputs in X and Y). <br><br>  The whole system was divided into the following independent modules: <br><br><ul><li>  Image capture and PC interface. </li><li>  Power supply for precise elements, and power supply for power elements (relays, valve, etc.) </li><li>  Management of magnetic lenses, static.  Condenser, focus, beam shift at the beginning, stigmator - all this is set independently of the scan. </li><li>  Control beam deflection.  Directly responsible for moving the beam along the pattern.  The increase is set here. </li><li>  Vacuum system control </li><li>  High voltage and cathode glow control </li><li>  -1kV High Voltage Source for PMT in Secondary Electron Detector ( <i>SED</i> ) </li><li>  High voltage source + 12kV for SED collector (without it, the detector will operate in the registration of elastically reflected electrons - BSE) </li></ul><a name="habracut"></a><br>  I will make a reservation that the solutions described here do not claim to be the best and most optimal.  At this stage, the most important is to achieve results with the least amount of time.  Therefore, I will be very pleased with your constructive suggestions in the comments on how to do something better. <br><br><h2>  I. Image Capture </h2><br>  I think this is the most "tasty" part of the whole project.  What a person will deal with when working with a microscope: see the image, adjust the settings - what <a href="https://www.youtube.com/watch%3Fv%3DswR7QNcr3II">the control panel</a> used to serve. <br><br><h3>  Hardware </h3><br>  The basis is Arduino Due, which has two digital-to-analog converters (D / A converters), which will be used to deflect the beam along the X and Y axes, and several analog-to-digital converters (ADC) to digitize the signal received from the sensors.  The point is that the steps to install the beam at the desired point and read the signal are performed synchronously. <br>  Generally, there are two different options for how to do a scan. <br><br><ol><li>  Two cycles of X and Y, inside the installation of the beam at the desired point by outputting the desired values ‚Äã‚Äãto the analog output through the DAC, and digitizing the value from the sensor. </li><li>  Managed sawtooth generators with sync pulses, and the Arduino continuously digitizes the signal, breaking it in sync pulses. </li></ol><br>  Due to the greater versatility, I implemented the first option.  Then, if you wish, there is an opportunity to ‚Äúshine‚Äù the beam to the desired point, and in the future you can even control the focusing in order to provide dynamic focus through the image.  Write in the comments if you think that the second option is better.  Continuous digitization of the signal in this microcontroller ( <i>MK</i> ) will be much faster, perhaps even it will be possible to achieve the frequency of 1 MHz. <br><br><img src="https://habrastorage.org/webt/yc/be/ta/ycbetax7c9-5hb6ntzhtpcw0e30.jpeg"><br><br>  This is the line deviation signal generated by the board's DAC.  That is, we read from left to right, then the next line from right to left, etc., you yourself understand why. <br><br>  With computer MK communicates through a separate USB-interface. <br><br><h3>  Software part </h3><h3></h3><h4>  MK firmware </h4><br>  The firmware of the MC itself is implemented by standard means using the Arduino IDE, but using direct access through the ports instead of the Arduino library function, which gives a significant increase in scanning speed.  This topic has already been described in sufficient detail, but the essence is very simple: Arduino functions are universal and therefore have to do what is not necessary to do.  For example, when reading a value from the same input tens of thousands of times per second, it is not at all necessary to set the number of the input being read, it is enough to do this before the cycle. <br><br><h4>  Messaging protocol </h4><br>  For fast data exchange with a PC, I developed a simple binary variable-messaging protocol.  Each message contains a required header. <br><br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> magic; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> type; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> len; } MSG_HEADER;</code> </pre> <br>  and the next payload. <br><br>  For example, a scanned image line. <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> lineNumber; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pixels[MAX_SCAN_WIDTH]; } MSG_SCANLINE;</code> </pre> <br>  I was already advised to use the USB Bulk Transfer mode instead of the serial port simulation, but I have not yet mastered this method of working with Arduino Due. <br><br><h4>  Client part </h4><br>  This is not so trivial.  I made the client part as a server on Node.JS + React.JS so that the microscope could be used not only locally.  The <a href="https://github.com/node-serialport/node-serialport">serialport</a> module provides good performance, and the image output is implemented through the <a href="https://ru.wikipedia.org/wiki/Canvas_(HTML)">element Canvas</a> . <br>  A visual demonstration of the work of all this is placed at the beginning of the article. <br><br><h2>  Ii.  Power Supply </h2><br>  Separately, I dwell on the fact that a microscope requires a power source that not only has a large power reserve (due to possible impulse loads when controlling magnetic lenses), but also ensures a low level of output voltage ripple under load.  A simple ATX power supply on the + 12V line could not provide decent quality, so a linear power supply unit based on a transformer from 1kVA <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D1%2581%25D1%2582%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B8%25D0%25BA_%25D0%25B1%25D0%25B5%25D1%2581%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BE%25D0%25B9%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BF%25D0%25B8%25D1%2582%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">UPS</a> was designed, the secondary (former primary) windings of which were disconnected to obtain an independent AC voltage of about 15V. <br><br>  From the constructed block it is required to receive bipolar food +12 and -12, and bipolar +5 and -5 volts. <br><br>  The scheme is quite simple: <br><br><img src="https://habrastorage.org/webt/of/av/ow/ofavowbfl8kkk5bv0_ebthycwti.png"><br><br>  Two rectifiers, 33000 microfarads buffer capacitors, LM317 for each 12 volt channel with a TIP127 <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D1%2581%25D1%2582%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B7%25D0%25B8%25D1%2581%25D1%2582%25D0%25BE%25D1%2580">Darlington</a> transistor, and a pair of L7805 for a 5 V channel. <br><br>  Double-sided PCB, LUT method: <br><br><img src="https://habrastorage.org/webt/-e/lj/xl/-eljxljaex0gcktqan1_0qfbaxw.jpeg"><br><br>  After soldering components, the board looks like this: <br><br><img src="https://habrastorage.org/webt/-9/0u/xi/-90uxivwuiob7x_4t6rfhg1ly3s.jpeg"><br><br>  Some of the parts were reused from the failed ATX computer power supplies, including the wires.  As the case is used the native case of the same UPS. <br><br><h2>  Iii.  High voltage and cathode glow control </h2><br>  I already partially told about him in the <a href="https://geektimes.ru/post/287598/">last article</a> , but the main thing that remained was to learn how to manage it all and to do everything qualitatively, because  after all, 30kV at high current is not a toy. <br><br>  The basis of the high voltage control module - Arduino Nano, connected by its outputs to: <br><br>  - D / A converter that sets the reference voltage for the high-voltage unit <br>  - the driver of the motor moving the slider on the cathode glow transformer <br>  - the driver of the motor, which regulates (via a long dielectric rod) a variable resistor, which sets the voltage shift of the cathode relative to the Weelth cylinder <br>  - control of the cathode ignition relay using the scheme that I mentioned in the last article <br><br>  I also made a measurement of the filament current, but I did not fully test this circuit and it turned out that the sensitivity is too low, it will be necessary to redo it later. <br><br>  With the cover removed, the device looks like this: <br><br><img src="https://habrastorage.org/webt/5y/ng/x4/5yngx4fpdz5rx6iz-zgfexg45ii.jpeg"><br><br>  All these wires are neatly tidied up into the iron case from a former television receiver (or something like that), which well shields possible interference from the ‚Äúaquarium‚Äù.  At least, after all this was placed in the case and done ‚Äúproperly‚Äù, the Arduino Nano stopped hanging shortly after switching on the high voltage.  Yes, and aesthetically design the finished, working modules in boxes - quite nice and convenient. <br><br><h2>  Go ahead! </h2><br>  Many people already ask when the microscope will finally work.  So - soon!  :) <br>  It remains to make a sensor of secondary electrons (-1kV source, + 12kV source, amplifier), or connect an absorbed current amplifier (ready, but the picture from it will not be as beautiful as with SED). <br><br>  And to deal with the amplifier for the beam deflection system, there are some tricks there. <br><br>  I manage the lenses just from the laboratory power supply, but I plan to buy DACs (even 10-bit will go, but first I‚Äôll find out which ones are better), they will probably need about a dozen there, considering how many adjustment possibilities there are in this column, and make for them a common control board on the SPI-bus, for example. <br><br><h2>  PS </h2><br>  Visiting the country in which <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25BE%25D1%2580%25D1%2580%25D0%25B8%25D1%2587%25D0%25B5%25D0%25BB%25D0%25BB%25D0%25B8,_%25D0%25AD%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B4%25D0%25B6%25D0%25B5%25D0%25BB%25D0%25B8%25D1%2581%25D1%2582%25D0%25B0">Evangelista</a> was born and lived, <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25BE%25D1%2580%25D1%2580%25D0%25B8%25D1%2587%25D0%25B5%25D0%25BB%25D0%25BB%25D0%25B8,_%25D0%25AD%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B4%25D0%25B6%25D0%25B5%25D0%25BB%25D0%25B8%25D1%2581%25D1%2582%25D0%25B0">Torricelli</a> could not resist and went to the <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B8%25D0%25BC%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%2583%25D0%25BD%25D0%25B8%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%2582%25D0%25B5%25D1%2582_%25D0%259B%25D0%25B0_%25D0%25A1%25D0%25B0%25D0%25BF%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2586%25D0%25B0">University of Rome</a> , where the thematic exhibition of Nano-Innovations devoted to various equipment, including microscopes, was held. <br><br>  Greetings to all readers from this sunny country! <br><br><img src="https://habrastorage.org/webt/dw/al/pc/dwalpc85obdc5jr3rc4ak3uptwm.jpeg"><br><br>  <b>In the <a href="https://geektimes.ru/post/296821/">next series</a> - a story about electron detectors</b> </div><p>Source: <a href="https://habr.com/ru/post/373945/">https://habr.com/ru/post/373945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../373933/index.html">A brief history of Lambda, or why Ethan instills</a></li>
<li><a href="../373937/index.html">Russia's largest robot fights already on October 29</a></li>
<li><a href="../373939/index.html">Weekday experimental physicist</a></li>
<li><a href="../373941/index.html">About Tulpah</a></li>
<li><a href="../373943/index.html">Electrons: At the Back of Atoms</a></li>
<li><a href="../373947/index.html">Hard test lithium cans 18650, lithium polymer cans</a></li>
<li><a href="../373951/index.html">Blockchain will answer: how to solve the main problems of ineffective and annoying online advertising</a></li>
<li><a href="../373953/index.html">Just buy yourself some damn robots.</a></li>
<li><a href="../373955/index.html">Mars 2020 will record a 3D video of its landing</a></li>
<li><a href="../373959/index.html">Wired Internet in Russia becomes more expensive</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>