<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The structure of the code in Unity3d - personal opinion and a couple of tricks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to share my personal impressions about the development of mobile games based on Unity3d. Initially I thought to fit in one post all the s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The structure of the code in Unity3d - personal opinion and a couple of tricks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8c3/f68/07d/8c3f6807d5be4a8992b5befae0f08c3f.png" alt="image" align="left"><br>  I would like to share my personal impressions about the development of mobile games based on Unity3d.  Initially I thought to fit in one post all the small ‚ÄúTip &amp; Trick‚Äù that I encountered when working with Unity3d lately.  But they turned out too much.  So in this post there will be only those that relate directly to writing code. <br><br>  The main theme of the post is the division of classes into "layers", linking them through events and a little bit about how to organize the interaction of objects on the stage. <br>  Who cares - welcome under the cat! <br><br><a name="habracut"></a><br><h3>  Application structure </h3><br><img src="https://habrastorage.org/files/f2d/6d5/626/f2d6d5626181425585ffdf74458e64da.png" alt="image" align="right"><br>  Initially, I did not think through any structure - I knew Unity too badly, I didn‚Äôt understand what could be separated from what, what to combine and how to connect it.  However, in the development process in the application, the following weakly interconnected layers somehow emerged: <br><ol><li>  Interface - this includes all sorts of menus and controls. </li><li>  Game objects - everything that is on the stages of the levels and is directly related to the geymplay. </li><li>  The state of the game - these are the classes that are responsible for the process of passing the game.  What level is the player passed?  In what time?  How many points did you score?  What level does he need to download now?  Do I need to unlock any content?  Etc. </li><li>  Interaction with Google services - classes that are responsible for posting the result and unlocking the achivok. </li><li>  Advertising - classes that are responsible for displaying advertising. </li><li>  Social services - posting on Facebook, VKontakte, etc. </li></ol><br>  This list is a personal example in the case of a pair of specific applications.  In other applications, it can be very different.  But the general idea of ‚Äã‚Äãit will be clear. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When these layers somehow formed in my head, the question arose - how to establish interaction between them?  Those.  I understood that the class that is responsible for loading the next level should not be tied to the corresponding button in the menu.  But how to do that? <br>  The problem was solved through static classes and events. <br><br>  The general idea is that the objects of each layer do not interact with the objects of the other layer.  They only cause static events on their layer, and they are already subscribed to all who need it. <br>  Why are events static? <br><br>  The fact is that to subscribe to the events of a particular object in the scene, you need to have a link to it.  And this adds a bunch of extra connections and the idea of ‚Äã‚Äãseparating the ‚Äúlayers‚Äù is lost. <br>  In some cases, the solution was even simpler - it was enough to add a singleton to communicate with the layer, and the interaction was greatly simplified. <br>  Next, I will try to use examples to describe how this works in each layer. <br><br><h3>  Interface </h3><br><img src="https://habrastorage.org/files/24e/138/3cf/24e1383cf1734922a595ca259d2e6ca9.png" alt="image" align="right"><br>  Unity tutorials are full of such examples: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExampleClass</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject projectile; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fireRate = <span class="hljs-number"><span class="hljs-number">0.5F</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> nextFire = <span class="hljs-number"><span class="hljs-number">0.0F</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetButton(<span class="hljs-string"><span class="hljs-string">"Fire1"</span></span>) &amp;&amp; Time.time &gt; nextFire) { nextFire = Time.time + fireRate; Instantiate(projectile, transform.position, transform.rotation) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GameObject; } } }</code> </pre> <br>  This, by the way, from official documentation. <br>  What is wrong here? <br><br>  During development and debugging in Unity, using buttons is very convenient.  But when switching to a mobile device, they are replaced with interface elements.  If you tied to the buttons - then you have to edit the class of the game object.  In addition, what to do if several objects should respond to a button click? <br>  It turned out to be more convenient to create a separate class, for example, UserInterface, to declare the OnFireButtonClick global event in it, and subscribe to it wherever necessary. <br><br>  The basic idea of ‚Äã‚Äãthe interface is this: do not do Input processing in game objects.  Make separate interface objects that will receive all commands from the user, and in game objects subscribe to events.  It is better to generate events in a singleton, since specific objects of the interface can change, and this should not affect game objects. <br>  Brrr ... Somehow it turned out messy, but I hope I shared the general idea. <br><br>  By the way, if you subscribe to events, do not forget to add a "unsubscribe": <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { &lt;_&gt; -= &lt;_&gt;; }</code> </pre><br><br>  And then it will be a funny situation when the scene is closed, and the object lives and processes the event.  And the garbage collector will not work correctly.  You can only unsubscribe if the object causing the event is in the same scene as the handler and will be deleted with it. <br><br>  There is an incomprehensible situation - I assumed that closing the scene means the destruction of all its objects and the automatic ‚Äúreply‚Äù from everything.  It turned out that it is not.  It looks more like the application just exits the block responsible for the scene.  It is assumed that the objects are no longer referenced and will be deleted by the garbage collector.  I did not understand, this is a bug or a feature.  If anyone understands the essence of this situation - share, plizz, knowledge.  Really curious. <br><br><h3>  Game objects </h3><br><img src="https://habrastorage.org/files/339/b29/f88/339b29f8886840d3a26cc8054a6865e7.png" alt="image" align="right"><br>  This is all that runs, jumps, spins, shoots and interacts with each other on our stage. <br>  Unity offers several approaches for their communication. <br><br>  1. Link them through public properties.  It looks like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PlatformMoveController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Player; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCollisionStay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collision col</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (col.gameObject.name == Player.name) onTheGround = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } ... }</code> </pre><br>  The downside is that we need to link the objects together.  And if we dynamically generate them? <br><br>  This is where the second approach comes to help: <br><br>  2. Find an object in the scene by name or tag.  For example: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject _car; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _car = GameObject.Find (<span class="hljs-string"><span class="hljs-string">"Car"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_car == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityException (<span class="hljs-string"><span class="hljs-string">"Cannot find 'Car' object!"</span></span>); _car.OnCrash += DoSomething(); } ‚Ä¶</code> </pre><br>  The minus of this method is seen in the example itself - the desired object in the scene may not be.  Well, if he's not there at all, and we can do nothing, but what if it was added there, but with a different name? <br><br>  Here again we can bypass through a static event.  If each Car Instance will forward its collision through a static class event (CarManager), we will not have to search for an object or bind to it. <br><br>  It will turn out something like: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Car</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... CarManager.CrashCar(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CarManager</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CrashCar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OnCarCrash != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) OnCarCrash(); } }</code> </pre><br><br>  Handler: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CarManager.OnCarCrash += DoSomething(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CarManager.OnCarCrash -= DoSomething(); }</code> </pre><br><br>  This approach has its drawbacks and pitfalls, so that they need to use it carefully and do not forget to unsubscribe from the events.  But sometimes he helps a lot. <br><br><h3>  Game state </h3><br>  The state of the game is the generic name of the classes responsible for fixing the passage of the levels, loading the next, scoring points, etc. <br>  The main thing that you need to take into account here is that you don‚Äôt need to do Application.LoadLevel (&lt;stage_name&gt;);  from game objects - sooner or later, you will need to enter additional checks, calculations, intermediate screens, etc. It is better to bring all this into a separate class.  There you can also take commands to pause and restore the game, etc. <br><br><div class="spoiler">  <b class="spoiler_title">for example</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EmptyVoidEventType OnPause; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EmptyVoidEventType OnResume; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EmptyVoidEventType OnReplay; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PauseGame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OnPause != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) OnPause (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResumeGame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Time.timeScale = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OnResume != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) OnResume (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReplayGame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { LevelManager.LoadLastLevel(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OnReplay != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) OnReplay (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FinishLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadLastLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToMenu</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... } ... }</code> </pre><br></div></div><br>  Those.  in the scene, you no longer have to worry about what you need to do at the end of the level and what is the name of the previous scene if the player suddenly wants to replay it.  Just call the class manager and that's it. <br>  Similarly, if we need to respond to a pause in the scene, for example, set Time.timeScale = 0;  just subscribe to the appropriate event. <br>  All these little things greatly simplify development. <br><br><h3>  Interaction with Google services </h3><br><img src="https://habrastorage.org/files/a7d/458/91f/a7d45891fbf4466ea5ba335de9e55404.png" alt="image" align="left"><br>  Google has become generous with great services that can be called from a mobile toy.  Now you do not need to write your own leaderboards, achivki and much more.  In addition, these services are developing and promise to become some kind of super-duper wunder. <br>  Considering all this, it seems logical not to smear their call with a thin layer throughout the application, but to concentrate in one or two classes, associating it with the rest of the application through events.  This will allow the development of the ‚Äúsocial‚Äù component of the game not greatly influencing the geymplay. <br><br><div class="spoiler">  <b class="spoiler_title">A little trick how to quickly and easily check whether there is a connection with Google</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient()) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient().OpenRead(<span class="hljs-string"><span class="hljs-string">"http://www.google.com"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  Not sure that this is the best option, but it looks the most simple and straightforward. <br></div></div><br><br><h3>  Advertising </h3><br><img src="https://habrastorage.org/files/27c/5bf/382/27c5bf382f6b49e1b6d682294e9c1a62.png" alt="image" align="left"><br>  Each advertising provider provides its own tools for display.  To understand the game classes with all this zoo there is no desire.  I made for myself a simple statically class AdsController, with one public method: ShowBanner () and call it where I want to show ads.  All the work with AdMob is hidden inside and, if I decide to switch to something else, I will not have to climb the code and catch calls.  Trifle, but nice. <br>  You can also get involved through events, but in my case, the singleton came up more, since I‚Äôll hardly change the interface for calling the ad unit, but the game events can change. <br><br><div class="spoiler">  <b class="spoiler_title">A little trick to save the player's nerve cells</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AdsController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DateTime lastAdCloseTime; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TimeSpan AdsInterval = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//   -      static void AdClosed(object sender, System.EventArgs e) { lastAdCloseTime = DateTime.Now; } public static void ShowBanner() { if (DateTime.Now - lastAdCloseTime &gt; AdsInterval) &lt;_&gt; } ... }</span></span></code> </pre><br><br>  Those.  We introduce a limit on the frequency of successful hits.  Actual for displaying banners.  For example, I show them at the end of a level or death.  But the first levels are traversed in ten seconds.  In order not to irritate the player, added such a restriction. <br>  The main thing is to take into account successful shows.  And then with glitches with the connection, the player will never see the advertisement and will be upset that he did not thank the developer for his attention. <br></div></div><br><br><h3>  Social services </h3><br>  This ‚Äúlayer‚Äù in its role is very similar to the advertising one, but its essence is even simpler - all teams for social networks should be heaped in, expose one static class with methods: PostToFacebook, PostToVk, etc. All that can be hidden is hidden inside classes.  Pass parameters through a minimum.  I have it come down to one parameter - the number of points scored.  In principle, the use of this class is reduced simply to calling the desired method when the user presses the Share button. <br>  In this form, it can be dragged from project to project almost unchanged. <br><br><h3>  Conclusion </h3><br>  I hope that this stream of thoughts turned out to be useful to someone.  I know that I didn‚Äôt say anything special and that people working with Unity have long and intelligently know all this and another 100 more suitable ways to do the same.  I hope that I helped the newbies, and the experts will share their experiences in the comments. <br><br>  If there is interest, I can tell you about the bumps that I crammed when importing 3d objects and building the project structure. <br><br><div class="spoiler">  <b class="spoiler_title">Prehistory of the post for the curious</b> <div class="spoiler_text">  About a year ago I wrote on Habr about how the development of mobile games became my hobby: <a href="http://habrahabr.ru/post/204494/">GameDev as a hobby</a> .  After this post, I learned a lot more and a lot of what I ‚Äúburned‚Äù.  After each ‚Äúunexpected‚Äù experience, there was a desire to sit down and write about him, but there was either laziness, or I wanted to get a better idea and then share it. <br>  I set up "didlay" for myself - update the toy to the second version and sit down to write the post.  But since another project went in parallel and at work was strained, this process dragged on for half a year.  Therefore, there were many thoughts, and the post turned out to be quite confused. </div></div></div><p>Source: <a href="https://habr.com/ru/post/238581/">https://habr.com/ru/post/238581/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238569/index.html">How to solve user problems not in a day, but in minutes: we speed up the search in logs</a></li>
<li><a href="../238571/index.html">QJack thermometer helps turn temperature measurement into a game</a></li>
<li><a href="../238573/index.html">Sony: we will teach you to look at the world with alien eyes</a></li>
<li><a href="../238575/index.html">FTN-based messenger</a></li>
<li><a href="../238577/index.html">Facebook opened the veil to its technology</a></li>
<li><a href="../238587/index.html">Catch - framework for unit-tests</a></li>
<li><a href="../238589/index.html">Selection of a two-factor authentication solution provider. Part 1 of 2</a></li>
<li><a href="../238591/index.html">Pebble Steel - the evolution of Pebble smart watches</a></li>
<li><a href="../238595/index.html">Adobe introduced the streaming version of Photoshop for ChromeOS</a></li>
<li><a href="../238597/index.html">The realities of the investment market in startups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>