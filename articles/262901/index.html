<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity Integration with Google Spreadsheets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sooner or later, in the process of developing even the simplest game, its creators are faced with the task of data management, these can be the parame...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity Integration with Google Spreadsheets</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e1a/7c4/302/e1a7c43025a047499a039b16efa53691.png"><br><br>  Sooner or later, in the process of developing even the simplest game, its creators are faced with the task of data management, these can be the parameters of in-game items (units, weapons, skills), the economy in the game, localization, or data necessary for the application to work. <br><br>  Spreadsheets can be a convenient tool for solving this problem.  They are well suited for visual data display and visualization.  Sorting and using formulas will help achieve mathematical accuracy in calculating the economy, game cycles and level management.  The advantage of Google spreadsheets is that a large number of people can work with them simultaneously online, which significantly increases the speed of development, establishes reliable and understandable communication between team members: programmers, artists, game designers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, I want to tell you how good spreadsheets have brought to me, what difficulties I encountered when I was preparing the game for working with Google spreadsheets and also want to share a small tutorial on integrating the Unity project with Google Spreadsheets. <br><a name="habracut"></a><br><br>  If we consider the case of our game, we used Google tables to store data and systematize the color schemes of the characters, miscalculate their value in the in-game currency and build a task system for the player.  For me, as a person who is responsible for the software part of the application, using tables has saved a lot of time, especially when it came to graphics data and collaboration with the designer. <br><br><img src="https://habrastorage.org/files/717/a0c/a5b/717a0ca5b85d4f69b99b66461d57aae0.png"><br><br>  As you may have noticed, different color schemes added zest to a fairly simple game, made it a little more attractive and interesting for the user.  Without data systematization, this would be almost impossible. <br><br><img src="https://habrastorage.org/files/28e/5a3/775/28e5a37756a648b2a953011e7451504e.png"><br><br>  Formulas and sorting techniques helped to calculate all the parameters of in-game tasks (challenges): order, purpose, reward.  The right approach to building an economy is very important for keeping the user in the game, and the mobility in changing data that tables provide is playing into this case. <br><br><img src="https://habrastorage.org/files/7a1/dbf/c80/7a1dbfc8057c44fca4e8b7075efbbe04.png"><br><br>  Now let's move on to the technical aspect of integrating Google spreadsheets with Unity.  The Unity game engine provides many ways to interact with Internet resources, including Google tables, one of which is integration based on a standalone application.  But the main challenge in this case could be the use of the .NET 2.0 engine. <br><br>  Since May 5, 2015, Google has stopped supporting the outdated OAuth 1.0 authorization protocol, and all those applications that have not switched to the new OAuth 2.0 have stopped working.  It <a href="https://github.com/kimsama/Unity3D-GDataDB">turned</a> out that the developers of free plug-ins that I used, <a href="https://github.com/kimsama/Unity3D-GDataDB">Unity-GData</a> and its updated version of <a href="https://github.com/kimsama/Unity-QuickSheet">Unity-Quicksheet</a> did not take care of this, and I had no choice but to look for a solution myself. <br><br>  At first it seemed to me that problems with authorization on Unity and  # should not arise, because the <a href="https://developers.google.com/google-apps/spreadsheets/">documentation</a> on this topic is exhaustive.  But it turned out not so simple. <br><br>  Firstly, there were interruptions to the authorization process itself, as some parameters for the OAuth 2.0 request were not specified in the Google Spreadsheets documentation, for example, ‚ÄúAccess Type‚Äù and ‚ÄúToken Type‚Äù. <br><br>  Secondly, in some updated Google Data API. DLL libraries that I imported from the <a href="https://code.google.com/p/google-gdata/downloads/detail%3Fname%3Dlibgoogle-data-mono-2.1.0.0.tar.gz%26can%3D2%26q%3D">Google Data API SDK</a> for mono, errors occurred during Unity during compilation, it was the same with a number of old .dll from the Unity-GData plugin.  I had to combine. <br><br>  Thirdly, it was necessary to add another suitable Newtonsoft library for working with JSON requests. <br><br>  <b>Let's get down to business</b> .  The process of integrating Google tables with Unity can be divided into several stages. <br><ul><li>  Pre-set up your google account </li><li>  Setting up access to the Google Drive API </li><li>  Retrieving and saving data from google spreadsheets </li></ul><br>  First you need to download the <a href="https://github.com/deepnavy/Unity-Google-Spreadsheets/blob/master/unity-google-spreadsheets.unitypackage">unitypackage</a> , which already has all the necessary libraries and scripts. <br><br>  <b>Pre-set up your google account</b> <br><br><ul><li>  Log in to your account. </li><li>  Follow the link and create a new project ‚ÄúCreate new project‚Äù. </li><li>  On the sidebar of the developer console in the section ‚ÄúAPIs &amp; Auth‚Äù select the tab ‚ÄúAPIs‚Äù. </li><li>  Go to the ‚ÄúDrive API‚Äù settings in the ‚ÄúGoogle Apps Api‚Äù group and connect this API to our application with the ‚ÄúEnable API‚Äù button. </li><li>  In the same section ‚ÄúAPIs &amp; Auth‚Äù select the tab ‚ÄúConsent screen‚Äù.  Enter the product name ‚ÄúProduct name‚Äù and optionally specify the home page address, logo and other parameters. </li><li>  Again in the ‚ÄúAPIs &amp; Auth‚Äù section, select the ‚ÄúCredentials‚Äù tab.  Create a new Client ID to work with Auth 2.0 - ‚ÄúCreate client ID‚Äù button.  In the dialog box, mark ‚ÄúApplication type‚Äù as ‚ÄúInstalled application‚Äù, and ‚ÄúInstalled application type‚Äù, as ‚ÄúOther‚Äù.  Confirm by clicking the ‚ÄúCreate Client ID‚Äù button. </li><li>  We got the Client ID, Client Secret values ‚Äã‚Äãthat will be needed later. </li></ul><br><img src="https://habrastorage.org/files/586/350/029/586350029eb349ecbb63bb6ec2a0f21a.png"><br><br>  <b>Setting up access to the Google Drive API</b> <br><br><ul><li>  After you have imported unitypackage, the ‚ÄúSpreadsheetEntity.cs‚Äù script should automatically start its work when you start Unity.  Open the script for editing, and enter the information for authorization. </li><li>  Assigning the _ClientId and _ClientId values ‚Äã‚Äãto Client ID and Client Secret to the variables obtained from the developer console. </li><li>  We start Unity the project.  It automatically follows the link where after authorization, you can get the Access Code so that the application can successfully log in with Google. </li><li>  Copy the Access Code and assign its value to the _AccessCode variable in the ‚ÄúSpreadsheetEntity.cs‚Äù script. </li><li>  After that, we run the project again and get the OAuth 2.0 Access Token and Refresh Token values ‚Äã‚Äãfrom the Unity console log, which we need for constant access to Google tables.  We assign these values ‚Äã‚Äãto the _AccessToken and _RefreshToken variables, respectively. </li></ul><br>  I will give an example of the script. <br><div class="spoiler">  <b class="spoiler_title">There is a script</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Google.GData.Client; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Google.GData.Spreadsheets; [InitializeOnLoad] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SpreadsheetEntity</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">// enter Client ID and Client Secret values const string _ClientId = ""; const string _ClientSecret = ""; // enter Access Code after getting it from auth url const string _AccessCode = ""; // enter Auth 2.0 Refresh Token and AccessToken after succesfully authorizing with Access Code const string _RefreshToken = ""; const string _AccessToken = ""; const string _SpreadsheetName = ""; static SpreadsheetsService service; public static GOAuth2RequestFactory RefreshAuthenticate() { OAuth2Parameters parameters = new OAuth2Parameters() { RefreshToken = _RefreshToken, AccessToken = _AccessToken, ClientId = _ClientId, ClientSecret = _ClientSecret, Scope = "https://www.googleapis.com/auth/drive https://spreadsheets.google.com/feeds", AccessType = "offline", TokenType = "refresh" }; string authUrl = OAuthUtil.CreateOAuth2AuthorizationUrl(parameters); return new GOAuth2RequestFactory("spreadsheet", "MySpreadsheetIntegration-v1", parameters); } static void Auth() { GOAuth2RequestFactory requestFactory = RefreshAuthenticate(); service = new SpreadsheetsService("MySpreadsheetIntegration-v1"); service.RequestFactory = requestFactory; } // Use this for initialization static SpreadsheetEntity(){ if (_RefreshToken == "" &amp;&amp; _AccessToken == "") { Init(); return; } Auth(); Google.GData.Spreadsheets.SpreadsheetQuery query = new Google.GData.Spreadsheets.SpreadsheetQuery(); // Make a request to the API and get all spreadsheets. SpreadsheetFeed feed = service.Query(query); if (feed.Entries.Count == 0) { Debug.Log("There are no spreadsheets in your docs."); return; } AccessSpreadsheet(feed); } // access spreadsheet data static void AccessSpreadsheet(SpreadsheetFeed feed) { string name = _SpreadsheetName; SpreadsheetEntry spreadsheet = null; foreach (AtomEntry sf in feed.Entries) { if (sf.Title.Text == name) { spreadsheet = (SpreadsheetEntry)sf; } } if (spreadsheet == null) { Debug.Log("There is no such spreadsheet with such title in your docs."); return; } // Get the first worksheet of the first spreadsheet. WorksheetFeed wsFeed = spreadsheet.Worksheets; WorksheetEntry worksheet = (WorksheetEntry)wsFeed.Entries[0]; // Define the URL to request the list feed of the worksheet. AtomLink listFeedLink = worksheet.Links.FindService(GDataSpreadsheetsNameTable.ListRel, null); // Fetch the list feed of the worksheet. ListQuery listQuery = new ListQuery(listFeedLink.HRef.ToString()); ListFeed listFeed = service.Query(listQuery); foreach (ListEntry row in listFeed.Entries) { //access spreadsheet data here } } static void Init() { //////////////////////////////////////////////////////////////////////////// // STEP 1: Configure how to perform OAuth 2.0 //////////////////////////////////////////////////////////////////////////// if (_ClientId == "" &amp;&amp; _ClientSecret == "") { Debug.Log("Please paste Client ID and Client Secret"); return; } string CLIENT_ID = _ClientId; string CLIENT_SECRET = _ClientSecret; string SCOPE = "https://www.googleapis.com/auth/drive https://spreadsheets.google.com/feeds https://docs.google.com/feeds"; string REDIRECT_URI = "urn:ietf:wg:oauth:2.0:oob"; string TOKEN_TYPE = "refresh"; //////////////////////////////////////////////////////////////////////////// // STEP 2: Set up the OAuth 2.0 object //////////////////////////////////////////////////////////////////////////// // OAuth2Parameters holds all the parameters related to OAuth 2.0. OAuth2Parameters parameters = new OAuth2Parameters(); parameters.ClientId = CLIENT_ID; parameters.ClientSecret = CLIENT_SECRET; parameters.RedirectUri = REDIRECT_URI; //////////////////////////////////////////////////////////////////////////// // STEP 3: Get the Authorization URL //////////////////////////////////////////////////////////////////////////// parameters.Scope = SCOPE; parameters.AccessType = "offline"; // IMPORTANT and was missing in the original parameters.TokenType = TOKEN_TYPE; // IMPORTANT and was missing in the original // Authorization url. string authorizationUrl = OAuthUtil.CreateOAuth2AuthorizationUrl(parameters); Debug.Log(authorizationUrl); Debug.Log("Please visit the URL above to authorize your OAuth " + "request token. Once that is complete, type in your access code to " + "continue..."); parameters.AccessCode = _AccessCode; if (parameters.AccessCode == "") { Application.OpenURL(authorizationUrl); return; } //////////////////////////////////////////////////////////////////////////// // STEP 4: Get the Access Token //////////////////////////////////////////////////////////////////////////// OAuthUtil.GetAccessToken(parameters); string accessToken = parameters.AccessToken; string refreshToken = parameters.RefreshToken; Debug.Log("OAuth Access Token: " + accessToken + "\n"); Debug.Log("OAuth Refresh Token: " + refreshToken + "\n"); } }</span></span></code> </pre> <br></div></div><br>  I will note a certain feature: this script is executed when the Unity editor is launched, it is very convenient, because all the data will already be in place before executing the main application code, for more details, <a href="http://docs.unity3d.com/Manual/RunningEditorCodeOnLaunch.html">click here</a> . <br><br>  After you have completed all the necessary steps, the project is ready for working with Google spreadsheets. <br><br>  <b>Retrieving and storing data from Google spreadsheets</b> <br><br>  At Google, the process of working with tables is well described in the above <a href="https://developers.google.com/google-apps/spreadsheets/">documentation</a> for developers.  But for clarity, I will give a small example.  To retrieve data, I use list-based requests (list-based feeds), and XML files for storage.  More information on working with XML in Unity can be found <a href="http://wiki.unity3d.com/index.php%3Ftitle%3DSaving_and_Loading_Data:_XmlSerializer">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Code example</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// modified AccessSpreadsheet Method void AccessSpreadsheet(SpreadsheetFeed feed) { string name = _SpreadsheetName; SpreadsheetEntry spreadsheet = null; foreach (AtomEntry sf in feed.Entries) { if (sf.Title.Text == name) { spreadsheet = (SpreadsheetEntry)sf; } } if (spreadsheet == null) { Debug.Log("There is no such spreadsheet with such title in your docs."); return; } // Get the first worksheet of the first spreadsheet. WorksheetFeed wsFeed = spreadsheet.Worksheets; WorksheetEntry worksheet = (WorksheetEntry)wsFeed.Entries[0]; // Define the URL to request the list feed of the worksheet. AtomLink listFeedLink = worksheet.Links.FindService(GDataSpreadsheetsNameTable.ListRel, null); // Fetch the list feed of the worksheet. ListQuery listQuery = new ListQuery(listFeedLink.HRef.ToString()); ListFeed listFeed = service.Query(listQuery); //create list to add dynamic data List&lt;TestEntity&gt; testEntities = new List&lt;TestEntity&gt;(); foreach (ListEntry row in listFeed.Entries) { TestEntity entity = new TestEntity(); entity.name = row.Elements[0].Value; entity.number = int.Parse(row.Elements[1].Value); //use Parse method to get int value Debug.Log("Element: " + entity.name + ", " + entity.number.ToString()); testEntities.Add(entity); } TestContainer container = new TestContainer(testEntities.ToArray()); container.Save("test.xml"); } // classes for xml serialization public class TestEntity { public string name; public int number; public TestEntity(){ name = "default"; number = 0; } } [XmlRoot("TestCollection")] public class TestContainer { [XmlArray("TestEntities")] [XmlArrayItem("testEntity")] public TestEntity[] testEntities;// = new skinEntity[]; public TestContainer(){ } public TestContainer(TestEntity[] arch){ testEntities = arch; } public void Save(string path) { var serializer = new XmlSerializer(typeof(TestContainer)); using(var stream = new FileStream(path, FileMode.Create)) { serializer.Serialize(stream, this); } } public static TestContainer Load(string path) { var serializer = new XmlSerializer(typeof(TestContainer)); using(var stream = new FileStream(path, FileMode.Open)) { return serializer.Deserialize(stream) as TestContainer; } } }</span></span></code> </pre><br></div></div><br>  It is also worth adding that the script only works in the editor, you cannot use the Google table functionality on the device, at least with the versions of plug-ins that I found, this is due to compatibility problems of some libraries with some platforms.  The libraries offered by me in unitypackage will not be compiled for any platform other than the editor.  If you still need to use the tables on the device, then in version 5 of Unity, you can choose the platform that the plugin should support, using the Plugin Inspector, and in earlier versions, put the plugin in the right folder, read more <a href="http://docs.unity3d.com/Manual/PlatformDependentCompilation.html">here</a> . <br><br>  So, spreadsheets are indispensable tools in the game development process.  They help to optimize the routine work and improve the interaction of the whole team, visualize huge data arrays and use mathematics to calculate them.  Integrating Google Spreadsheets with Unity is a simple process, but it requires a little knowledge and effort. <br><br>  Here is the <a href="https://github.com/deepnavy/Unity-Google-Spreadsheets">link</a> to the GitHub project. <br><br>  Thank you for your attention, I hope the article was useful to you. </div><p>Source: <a href="https://habr.com/ru/post/262901/">https://habr.com/ru/post/262901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262889/index.html">Why Go and Rust are not enemies, but friends</a></li>
<li><a href="../262891/index.html">Six ways to reliably protect your organization from external and internal threats</a></li>
<li><a href="../262893/index.html">Gigahertz does not happen much</a></li>
<li><a href="../262895/index.html">Information about the members of the community Vkontakte online</a></li>
<li><a href="../262897/index.html">RC4 NOMORE: break the RC4 stream for tens of hours in TLS and WPA-TKIP</a></li>
<li><a href="../262903/index.html">Rendering in MAPS.ME</a></li>
<li><a href="../262905/index.html">DIY Roaming</a></li>
<li><a href="../262911/index.html">Cat Recognition Service</a></li>
<li><a href="../262913/index.html">Bichrome interface in the new browser assembly Vivaldi 1.0.228.3</a></li>
<li><a href="../262917/index.html">Another way to prepare one-page applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>