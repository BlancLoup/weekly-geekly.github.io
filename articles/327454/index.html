<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Everything is not so simple with Ctrl + Z: about undo in fast editing ONLYOFFICE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Randomly nakosyachili in the document that you just fumbled? Drag-n-drove somewhere a piece of someone else's text and do not know how to live on? Did...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Everything is not so simple with Ctrl + Z: about undo in fast editing ONLYOFFICE</h1><div class="post__text post__text-html js-mediator-article">  Randomly nakosyachili in the document that you just fumbled?  Drag-n-drove somewhere a piece of someone else's text and do not know how to live on?  Did you drop your colleague's cell in the cell and destroy its data?  Ctrl + Z more than once saved our lives and reputations of respectable colleagues who do not spoil other people's (and their) documents. <br><br>  In the last issue, we added the ability to make Undo in quick co-editing.  Why it was not there before, how everything is arranged there, and why it happens that you press undo all the way, and the document still does not remain empty, you will learn from this article. <br><br><img src="https://habrastorage.org/files/0d3/0f1/b51/0d30f1b515cc408e9fd7421367fe8ec3.jpg"><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Undo in the fast mode of joint editing appeared together with footnotes in version 4.3.  You can learn more about the release from our <a href="https://habrahabr.ru/company/teamlab/blog/326118/">previous article</a> (you will only learn about undo from this article). <br><br><h1>  Fast, strict, angry </h1><br>  A short reference to the differences between codediting modes: <br><br><ul><li>  Fast.  You see what your collaborator is typing.  (‚ÄúWhat nonsense are you typing, Nikolai ?!‚Äù) </li><li>  Strict.  You calmly work on your piece of text, and you see the edits of the co-author only after saving.  (‚ÄúWhat nonsense are you typing, Gennady ?!‚Äù) </li></ul><br>  Fast co-authoring is enabled by default in ONLYOFFICE editors.  Previously, it was not undo. <br><br><h1>  Why earlier in the fast mode was not undo </h1><br>  We thought it was dangerous for the document.  Suppose Nikolai inserts an autoshape, and Gennady drags into it a piece of text from a document.  Then Nicholas cancels the action, as a result of which the autoshape is deleted.  And with it, and part of the text, which is already not to return.  Gennady and Nikolai sadly go to drink tea, discussing how to recover the lost text. <br><br>  Nevertheless, we came to the conclusion that even in fast mode, the ability to cancel the last action is needed.  It is just convenient.  For example, in the situation described at the beginning of this text, when you, selecting the text for more attentive reading, accidentally dragged it with a mouse, while at that time someone else edited the document.  Or did not even edit, but simply forgot to close it.  Or you yourself forgot to close the same document in the next tab.  In general, the need is possible to automatically roll back the last action. <br><br>  Undo, of course, must be treated with caution (but in fact, you run the risk of just fumbling for someone with an editable document).  But we will tell you how everything works to minimize the risks. <br><br><h1>  Google and we </h1><br>  We are constantly asked (actually asked): Did you do this like Google Docs?  Not. <br><br>  Yes, they have joint editing and the ability to do undo, and we also have these things.  But this does not mean that everything inside us is the same. <br><br>  <b>Like Google</b> .  The document is on the server, all edits are sent there, and the final version of the document is being compiled there.  For example: Nikolai singled out some word in <b>bold</b> , and Gennady <i>in italics</i> .  Both two send their changes to the server, which is already resolving this embarrassment: in particular, tells Nicholas to add <i><b>italics</b></i> , and Gennady to make his <i>italics</i> <i><b>bold</b></i> .  In such a scheme, a situation in which the same document looks on different clients differently is possible (for a very short period of time, of course). <br><br>  <b>Like ONLYOFFICE</b> .  If Google‚Äôs document core is edited on the server, then we have it all happening on every client.  The server is used as a database in which changes are stored.  How should such a scheme change the situation when Nikolai singled out some word in bold and Gennady in italics?  The changes will be consistent, with the sequence being the same on each client.  The situation in which Nikolay and Gennady have documents look different at some point in time is impossible. <br><br>  How is this generally related to undo, you ask (in fact, we have no idea whether you ask or not, but imagine as if you asked).  From the next point in our story you will understand how. <br><br><h1>  What happens when you press Ctrl + Z </h1><br>  As we have said, in ONLYOFFICE all the most important things happen directly on the client.  There is also a list of actions - not only their own, but also others.  Your own actions are flagged so that you can roll back later. <br><br>  And here we come to how undo actually happens.  When a person edits a document in solitude everything, in principle, is understandable.  The block of changes stores the actions of one person and, if necessary, we simply take the last action and produce an anti-action.  The block of actions is reduced by one. <br><br>  In collaborative editing, the scheme is more complicated simply because the actions of several people are stored in the list of changes. <br><br>  Consider a simple example.  The document contains the following text: <br><br>  <i>a B C</i> <br><br>  Nikolay added the letter d at the end and received the text: <br><br>  <i>abvd</i> <br><br>  Seeing the result, Nikolai changed his mind and wanted to cancel the input of the letter D. At the same time, picky Gennady deleted the letter b and the following text remained in the document: <br><br>  <i>avd</i> <br><br>  Nikolai presses undo.  Deletion and addition of text occurs by position.  With his first action, Nikolay added a letter to position 3. In normal editing, undo would work simply as deleting a letter from the third position.  But Gennady has already tried and removed the letter b from position 2 and the letter d has moved to its place.  Thus, in the third position, it is now just empty and there is absolutely nothing to remove from there. <br><br>  This means that the simple scheme does not roll, and before canceling Nicholas's actions, you need to overtake them at the very end of the block, as if they were the last (after all other people's actions). <br><br>  If you transfer the action of Nikolai to add the letter d to the very end of the block, that is, after Gennady villainally removed the letter b from the second position, it turns out that Nikolai added the letter D to position 2. Do the opposite: removing from position 2. Undo passes <br><br>  Thus, the basic principle is as follows: we take a pack of actions of the client who wants to undo, we switch them (we stop through someone else's actions according to certain rules) and form a new block of reverse actions, as in the usual undo. <br><br>  The client of Nicholas, who has done undo, has an anti-action, and the rest is sent just a bundle of his actions, that is, for them there is no difference whether he made undo or simply deleted the letter with his hands. <br><br>  With undo, of course, various interesting problems, for example <br><br><h1>  Unrolled action </h1><br>  Another simple example: <br><br>  1. Nikolai adds text 12. <br>  2. Gennady removes 2. <br>  3. Nikolai does undo 2 times. <br>  4. Gennady does undo. <br><br><img src="https://habrastorage.org/files/fd6/7c9/039/fd67c90392594497b279e710db9e106a.gif"><br><br>  So, both users rolled back all their actions and both did not have a single undo in their sleeve.  However, the initially empty document did not remain empty after canceling all actions performed in it.  The number 2 proudly flaunts in it. It is impossible to roll it back with the help of undo. <br><br><h1>  Vanishing elements </h1><br>  Consider again the case of Gennady and Niklai at the beginning of the article: <br><br>  1. Nikolai adds an autoshape. <br>  2. Gennady typing text in the autoshape. <br>  3. Unstable Nicholas makes undo autoshapes. <br>  4. Along with the autofigure, the text typed by Gennady inside it also disappears.  Finally. <br><br>  Any problem with undo in fast joint editing is due to the fact that the sequence of real actions in the document and the sequence in which undo is pressed are not the same. <br><br>  These are not the drawbacks of our implementation of undo.  It works correctly.  It will be ideal if you and your colleagues work on different objects at the same time.  And here is our parting word for you: be, as it is now fashionable to say, mindful, working with documents.  Switch between co-editing modes and use wisely undo. </div><p>Source: <a href="https://habr.com/ru/post/327454/">https://habr.com/ru/post/327454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327444/index.html">Sports data analysis, or how to become a data science specialist</a></li>
<li><a href="../327446/index.html">Your recruitment is not social: features of social networks, lifehacks and tools for HR</a></li>
<li><a href="../327448/index.html">Learning from the masters: design levels Legend Of Zelda</a></li>
<li><a href="../327450/index.html">Operator overloading in freepascal on the example of ordinary fractions</a></li>
<li><a href="../327452/index.html">Mobile application prototyping: from idea to desktop</a></li>
<li><a href="../327456/index.html">Container lsp</a></li>
<li><a href="../327458/index.html">Revision # 1. The key to start</a></li>
<li><a href="../327460/index.html">Compare Java 8, RxJava, Reactor</a></li>
<li><a href="../327464/index.html">Do you need video calls in VR?</a></li>
<li><a href="../327466/index.html">Several lines of JS code to call from browser to mobile phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>