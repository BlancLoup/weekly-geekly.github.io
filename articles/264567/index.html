<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cthulhi in the bank: how we solved ICFPC 2015</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A small report on how we solved the ICFP Contest 2015 . We participated in this competition for the first time, but the result was pretty good. You ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cthulhi in the bank: how we solved ICFPC 2015</h1><div class="post__text post__text-html js-mediator-article">  A small report on how we solved the <a href="http://icfpcontest.org/">ICFP Contest 2015</a> .  We participated in this competition for the first time, but the result was pretty good.  You can search us in the <a href="http://icfpcontest.org/leader_board.html">table of intermediate results</a> under the name "WILD BASHKORT MAGES".  The final results are expected in the next few weeks, when the organizers will test all solutions on the full test suite. <br><br><img src="https://habrastorage.org/files/aaa/9a3/756/aaa9a3756e4b495797f986c07c06d153.png"><br><br>  This year, as a task, it was proposed to write a solver (or AI, as it is more convenient for someone) for the hexagonal tetris.  Just like in the usual Tetris - we put the figures, remove the filled lines, get points for it.  The solution should work for different sizes of the playing field and stacked figures of arbitrary configuration.  Action commands with figures (movements and turns) are encoded with ordinary characters, as a result the decision is a string of commands.  For special secret sequences of characters in the decision string, called power words, additional bonus points are given.  In the story - these lines were called <i>davar</i> , and the organizers collected it in order to delay the awakening of Cthulhu. <br><a name="habracut"></a><br><h1>  Introduction </h1><br>  There were three of us in the team, except for two cats - Damir, Maxim and me.  Damir and I are retired olympiadists; Maxim has a lot of experience in writing compilers.  As a preliminary preparation, we raised a git-repository, read some information about cryptography (because it was mentioned for some reason in the <a href="http://icfpcontest.org/OGA-BAA-15-18.pdf">announcement</a> ), I checked that my Ubuntu was working on a virtual machine (I'm a Windows host, unlike teammates).  And, of course, we slept well before the performance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Although the competition lasted for three days, in this narrative everything will be divided into 4 days in connection with our time zone.  In our local time, the contest began on Friday at 17:00, ending on Monday at 17:00.  That is, day 1 and day 4 will be slightly curtailed, which in the end will give exactly three days.  The time in the narrative is approximate, nobody recorded it specifically, it was restored from the git repository. <br><table><tbody><tr><td></td><td>  The technical details of our solution are highlighted in such a frame. <br></td><td></td></tr></tbody></table><br>  If you do not want to delve into the technical subtleties - you can safely skip, if you are interested in the implementation details, it will be easier to find them.  This whole thing was not hidden in spoilers because of the pictures, which still makes sense to catch a glimpse. <br><br><h1>  Day 1. Start </h1><br>  So, the contest started at 17:00.  The guys have already gathered, I am still at work at this time, I am already going to leave.  Before leaving, I ran through the <a href="http://icfpcontest.org/spec.html">condition of the problem</a> .  At first, it didn‚Äôt come to the point that it was a question of tetris, except that it was clear that we were dealing with a hexaconal field in which some units moved.  ‚ÄúIs there a need to write an AI for a strategy?‚Äù - I thought.  I approached the team at about 6:00 pm, looking on the way to the store for provisions and such a strategically important resource as coffee. <br><br>  About an hour, we discuss the condition of the problem, Damir simultaneously writes a visualizer in Python.  It is clear that Python may be too slow for a final solution, so I am starting to write basic operations with a field and figures in C ++. <br><br>  Maxim decides to write the same thing, only on OCaml.  It was supposed to go in several directions at once, and then weed out the obviously unpromising ones.  And there was nothing special to do anything at the beginning of the contest.  As a utopian option, you could then combine several heuristics in different languages, run everything on each test, and then choose the best option. <br><br>  At about 19:30 the first version of the visualizer is ready, you can see what tests the organizers have prepared there.  On the field in some of them strange messages are visible, aren‚Äôt it power words? <br><br><img src="https://habrastorage.org/files/c62/0b0/72e/c620b072ea884b3cb05a29d8b58013ad.png"><br><br>  We also found it there: <br><br><img src="https://habrastorage.org/files/c2f/098/848/c2f098848e934d7daead8ca2c25b3469.png"><br><br>  In the meantime, I tinker with the execution of basic commands on the figures.  Shifting something on a hexagonal grid can be easy, but turning it is not quite trivial. <br><table><tbody><tr><td></td><td>  In the end, after some hard work on a piece of paper and the analysis of cases, the following code came out: <br><br><pre><code class="hljs dos">void move_pnt( PAR &amp; p, int <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>, int d ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { d *= -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> += <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>&gt;=<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> -= <span class="hljs-number"><span class="hljs-number">6</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((pY &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>)==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>) { pX -= d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span>) { pX -= ((d+<span class="hljs-number"><span class="hljs-number">1</span></span>)&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span>) { pX += (d&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">3</span></span>) { pX += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">4</span></span>) { pX += (d&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY -= d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">5</span></span>) { pX -= ((d+<span class="hljs-number"><span class="hljs-number">1</span></span>)&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY -= d; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>) { pX -= d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span>) { pX -= (d&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">2</span></span>) { pX += ((d+<span class="hljs-number"><span class="hljs-number">1</span></span>)&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">3</span></span>) { pX += d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">4</span></span>) { pX += ((d+<span class="hljs-number"><span class="hljs-number">1</span></span>)&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY -= d; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>==<span class="hljs-number"><span class="hljs-number">5</span></span>) { pX -= (d&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>); pY -= d; } } }</code> </pre> <br><br>  This is a very important feature.  She shifts the point that she slipped on d cells in the direction of dir.  After this, parallel shift operations become quite trivial, and turns are very easy to make.  For this, for each cell in the figure, it is necessary to calculate its shifts relative to the point of rotation in two non-collinear directions, and then find the cell shifted relative to the point of rotation to the same displacements, only in slightly different directions: <br><br><img src="https://habrastorage.org/files/01e/9e4/502/01e9e45028b64df3aa322753dc841bab.png"><br></td><td></td></tr></tbody></table><br>  The code had to be slightly patched, by 22:00 everything was tested, at the same time the function of inserting and positioning new figures on the field was added, as well as checking for intersection with the walls and occupied cells.  Damir takes my code and rewrites it in Python to insert it into the visualizer.  Maxim also rewrites my OCaml code for use in his version of the solution. <br><br>  Dinner, as such, was not.  Interrupted by sandwiches with sausage and tea / coffee without departing from jobs.  Maksim remembered that there was a chicken in the fridge and it had to be cooked and eaten until it had deteriorated.  But we decided that nothing would happen to her until the morning. <br><br>  Midnight.  Damir fastened the ability to play decisions to the visualizer: now you can feed him davar, and then follow the moves to keep track of what is happening on the board.  True, so far we have no dawar, nothing to watch. <br><br>  By 03:00, I added a code for finding all positions where you can stick a figure before ‚Äúfreezing‚Äù.  Together with the sequence of commands that leads to this position.  Maxim implemented all the basic operations on OCaml, fixing a couple of bugs in my code along the way.  Damir added the ability to interactively control figures from the keyboard to the visualizer: now you can play this Tetris naturally!  And save decisions. <br><br>  Unfortunately, the game is not enough power - it's time to sleep.  On this day we decided not to save on a dream. <br><br><h1>  Day 2. Episode 1: Lightning Division </h1><br>  We wake up around 11 o'clock in the morning.  Morning coffee - and again for work. <br><br>  Damir gets a library for working with JSON from the C ++ bins, I fasten it, add a pseudo-random number generator, stupid move choice heuristics (choose the one where the figure will end up below).  And here it is - a solution that makes at least something is ready!  There is a bit of testing, debugging and testing of qualification tests - and by 14:00 we have the first davar. <br><br>  During this time, Damir also does not sit idle - pumps the visualizer, fixes bugs.  Now it is possible to scroll back and forth decisions in it, including step by step.  Maxim has been picking his OCaml solution all this time. <br><br>  Dinner time.  For dinner, the chicken is too lazy to cook, so we order two pizzas.  Yes, and time, in fact, especially not - at 17:00 ends the so-called Lightning Division.  This is a special nomination, in which decisions were made that were written in just a day, which solve something already without taking into account power-words.  And I really wanted to send something there, especially since something was already on hand. <br><br>  As soon as the first decisions were received, Maxim began to sort out the question ‚ÄúHow is it possible to send davar and solutions at all?‚Äù, And Damir and I look at the visualizer what our stupid solver told us.  In principle, it behaves quite adequately, it even gets some points.  On some tests, there are amusing quantum tunnel effects for figures, in which the turning point is far from the actual figure: <br><br><img src="https://habrastorage.org/files/e8b/2b2/930/e8b2b29306014842b1dea70aab61b34f.gif"><br><br>  By 3:45 pm, parallel with the absorption of pizza, I added a heuristic to the solution, which additionally takes into account the disappearing lines, Damir screwed up the command line according to the specification to my decision, Maxim wrote an automated sending of solutions directly to the server. <br><br>  It's time to prepare the archive for the Lightning Division.  Maxim writes Makefile and README, collects tarball.  Damir and I are reviewing davar, obtained from the last decision.  It seems to be no particular errors, the tarball is compiled and tested, and at 16:47 we send the archive to the server of the organizers along with the latest solutions. <br><br>  Here Damir finds obviously inadequate davar.  Starting from a certain moment, the decision begins to behave very strangely - to miss the holes and sculpt the figures to the ceiling.  And this ugliness happens after the two adjacent lines are completely filled and deleted!  Almost immediately it became clear that this is nothing more than a bug in my C ++ code in the place where the deletion of the filled lines occurs.  That is, in the visualizer, it deletes all the lines correctly, but in my implementation one of the lines remains - hence the desynchronization. <br><br>  Then everything happens as in Hollywood cinema (approximate timings): <br><blockquote>  <b>16:50</b> I quickly, but accurately correct the bug, retesting all the tasks with the new version. <br>  <b>16:54</b> commits changes to git, Damir tries to pull away my corrections to check in the visualizer.  But he made some changes and forgot to commit them when he parked, as a result, after pull'a, he gets some kind of porridge and we have to solve a terrible merge.  Damir just sat on hg all his life, and didn‚Äôt get a git on his hand. <br>  <b>16:55</b> Maxim hurries to help Damir, realizes that he has some kind of tin there, hurries back to his computer.  In the meantime, I‚Äôm running a problem test in my room - there‚Äôs no more glitches. <br>  <b>16:56</b> Maxim draws down my edits and quickly assembles a new tarball. <br>  <b>16:58</b> starts the script for sending the last solution to the server. <br>  <b>16:59</b> loads the tarball on the server, in the meantime I am watching the time <a href="http://www.timeanddate.com/countdown/generic%3Fp0%3D1440%26iso%3D20150808T12%26msg%3DICFP%2520Programming%2520Contest%25202015">here</a> .  In the script for sending dawar, we have a delay between separate tests so that we are not banned accidentally (it spoiled our nerves!), So sending slows down.  The score is already in seconds: 5, 4, 3 ... </blockquote><br>  Wow, had time!  3 seconds before the deadline.  Moral: the use of unfamiliar tools can create problems out of the blue, at the crucial moment. <br><br>  A little later, we still asked the organizers whether we had time or not.  The answer came: <br><blockquote>  &lt;galois_kiniry&gt; We see two tarballs submitted by your team, at 11:47 and 11:59.  Both are well-formed. <br>  &lt;galois_kiniry&gt; But is it a C ++?  ;) </blockquote><br><br><h1>  Day 2. Episode 2: Snakes, Cylinders and Finite Automaton </h1><br>  Well, one of the most tense moments behind, it's time to come up with a normal solution.  For example, which takes into account the use of power-word.  In fact, the idea was already in the air for a long time, almost in the first hours of the contest, but we decided to develop it after the Lightning round - for him the use of power-words was not necessary.  We sat down for an hour, formalized the idea, and the result was the following: <br><table><tbody><tr><td></td><td>  Let us somehow put the figure in the final position and ‚Äúfreeze‚Äù.  You can come to this position in a very large number of ways - initially we can even smash our figure across the entire field by stuffing power-words before putting it in the right place.  We can search for this optimal path using <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">dynamic programming</a> . <br><br>  We need to push all the information about the position of the figure into the state of dynamics.  Namely: the position of the pivot point, the current turn, as well as information about which commands we have already entered to catch the appearance of new power-words in the sequence of commands. <br><br>  The <a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite automaton</a> constructed as follows will perfectly cope with the second part of the state.  Suppose we have n power-words, then the state of the automaton can be represented as a vector of length n, the i-th element of which denotes the length of the i-th power-word prefix, which we have already typed.  Transitions between states occur when we add a new letter to the command line.  At the same time, some prefixes already typed are extended by one; others are shortened or even reset to zero length.  When power-word is typed completely, we also mark this information in the machine, and as the prefix we indicate the longest one that matches the suffix. <br><br>  An example of building an automaton can be seen in the picture below.  Three words are used here: <b>aba</b> , <b>acac</b> and <b>bc</b> .  On the edges are the characters that we are going to, the number of the word that we have just typed is indicated in brackets. <br><br><img src="https://habrastorage.org/files/619/54b/d13/61954bd13e124d33a387bfb3dc400387.png"><br><br>  We have few power-words, there are not so many letters in them either, so the machine can be built head-on, not really worrying about the effectiveness of the solution - it will still be fast. <br><br>  With the first part of the state of the dynamics had to sweat.  The fact is that when we move a figure to its destination, we cannot come to the same states.  In total, we have 6 options for action with a figure: move it to the left, move it to the right, move it down-and-left, move it down-and-right, turn clockwise, turn counterclockwise.  Everything is clear with ‚Äúmove down-and-left‚Äù and ‚Äúmove down-and-right‚Äù - as soon as we move the figure down, we can no longer drag it back up.  Repetitions can be when we move the figure left and right in the same line and at the same time rotate. <br><br>  It turns out the next thing.  All positions of the figures in the line can be represented as a rectangular table.  Its width is the width of the field, and the height is the number of possible turns (1, 2, 3, or 6 depending on the symmetry of the figure).  In this case, the upper side of the table is glued to the bottom - it turns out a kind of cylinder.  And we move our cells from neighboring cells along the edge.  As a result, all the moves on one line of the playing field can be represented as a snake, which crawls on our cylinder and tries not to bite off its tail: <br><br><img src="https://habrastorage.org/files/4ee/8ea/fdc/4ee8eafdc22c4ff49c0aef3b200cc1c4.png"><br><br>  Unfortunately, with this approach we would have to keep in a state of dynamics all the visited cells of each cylinder.  In this case, the total number of states grows exponentially.  We had to do something about it.  We decided to limit the movement of the snake in the following way: if we left with a line, then we never visit it again.  Then all sorts of snake paths degenerate into squiggles of the following form: <br><br><img src="https://habrastorage.org/files/ddb/a9f/7be/ddba9f7be5004f2cafeaa6e9f75eedb9.png"><br><br>  All already visited lines form a certain segment (a snake cannot teleport, say, through a line).  Hence, in order to remember which lines we visited, we need a maximum of 36 states.  Add one more parameter here: where we come from - left, right or top / bottom / c-another-line-playing-field - and this will be enough so that the snake itself does not chop off the tail. <br><br>  Of course, we will now go through far from all possible sequences of commands, and not all possible words we can then take into account.  But, we drew all the potential power-words found so far and saw that only the word <b>watermelon</b> cannot be <b>typed</b> .  We decided that while we manage without it. <br><br>  Total state of the dynamics: <br><blockquote>  x, y // position of the figure, or rather its point of rotation <br>  rotation // current turn <br>  rot_seg_left, rot_seg_right // segment of already visited turns <br>  from // where we come from: left, right, or top / bottom / c-another-line-playing-field <br>  node // vertex number from the state machine </blockquote><br><br>  In each state, we considered a weighted evaluation function according to three parameters: the evaluation of the playing field when we ‚Äúfreeze‚Äù the figure, the maximum length of the used power-word and the total length of all the words used.  The second parameter was added for the future: so that it was possible to force the dynamics to choose a path with previously unused words (the organizers gave 300 points for each power-word if it occurs at least once and additional points (double the number of letters in the word) for each reiteration). <br><br>  The essence of the dynamics: for each state, we consider the maximum of the evaluation function, which we can get by making some moves from the current state to some ‚Äúfrozen‚Äù state.  We try to do all sorts of moves, recursively process them, update the evaluation function if we have finished some words with the current move, select the maximum and save.  A rather subtle point for reflection: it would seem that information about what words we ended up with comes from direct passage through recursion, but in fact all the necessary information is stored in the state of dynamics itself.  Well, all the found words we consider in the reverse order of their end. <br><br>  Dynamics can be considered <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazy</a> with the use of <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a> (well, finally, at least some hint of functionalism!).  We simply start it from the initial position of the figure and ... freeze it, we calculate all the positions of the figure, where it can be ‚Äúfrozen‚Äù.  If you add a symbol to each state that you need to go through to achieve the optimum, then you can easily restore the desired sequence of commands. <br></td><td></td></tr></tbody></table><br>  Somewhere by 19:00 the decision was formalized, it remains only to write it.  Damir sat down to write a finite state machine, and I write dynamics itself (more precisely, most of the time was spent on registering the limitations that the state of dynamics gives us).  Maxim continues to pick his OCaml implementation. <br><br>  By 20:45, Damir appends the automaton, and a couple of minutes later I finish the dynamics.  Merge code, see what happened.  It turned out Stack Overflow.  Well, I nakosyachil somewhere in the dynamics, so it cycles.  It took quite a lot of time to search for the bug (it turned out to be a silly typo).  After that, I started to run all sorts of tests and check that the solution does not fall anywhere else.  I make commit with the corrected decision at 23:45 with davar for test 0. We send it to the server ... and we leave on the first line on this test! <br><br>  At this time we change the name of the team.  In fact, initially we were called ‚ÄúTeam Bashkortostan <a href="https://github.com/cakeplus/icfp-2015-wild-bashkort-mages/blob/master/ANTHEM">‚Äù</a> .  And when they came out on the first line of test 0, they thought that the name was somehow non-creative.  Renamed to "WILD BASHKORT MAGES".  They remembered the chicken, thinking what to do with it.  We decided: if we do not throw it away tomorrow, then we throw it out the day after tomorrow. <br><br>  While I was stupid with searching for a bug in dynamics, Damir didn‚Äôt sit idle: I twirled the construction of the machine a little, added support for power-words to the visualizer, wrote a module for counting the number of points that should be given for davar (this module was further used as in the visualizer, and from the outside for automatic scoring and generation of tablets for comparison).  There is no place to work with a visualizer more comfortable: <br><br><img src="https://habrastorage.org/files/299/133/d6b/299133d6b51e45e1932aaa436b058409.png"><br><br>  Maxim continued to mess with his OCaml solution until the moment when we sent davar of test 0 to the server.  After that, he made a volitional decision to score on his development and focus on testing solutions (in order to keep track of whether we had broken the solution after some ‚Äúimprovements‚Äù), as well as searching for new power-words.  Not to say that writing a solution on OCaml was a big waste of time - rather, it was an insurance in case I blunted with my C ++ solution. <br><br>  Somewhere at 00:15 I added another heuristic to the evaluation function.  Namely - fines for creating ‚Äúholes‚Äù in the filled part of the field.  The essence of heuristics is very simple: we consider the number of such neighboring cells that one of them is filled and the other is empty.  Then the lonely ‚Äúhole‚Äù left on the field gives a penalty of 6. After this, the decision began to work much better. <br><br>  Although the solution for test 0 was good, there were some difficulties with other tests.  The fact is that the current solution was <i>inhibited</i> .  For test 14, it worked 3 hours.  Funny point: I actually wanted to launch a solution for test 13, which is much smaller in size and only 100 turns (and test 14 is the pentagram in the picture above with 500 moves), but I confused the numbers of tests a little.  Well, I sit waiting for it to count.  And it all does not count.  After half an hour of the program, it has become a matter of principle to wait for completion.  And an hour after launch, it finally came to the conclusion that I had launched 14 tests, and not 13. Apparently, fatigue had already affected.  It counted only by 03:45. <br><br>  While I was waiting for the end of the ill-fated 14th test (I didn‚Äôt have any strength left to expect but I didn‚Äôt fall asleep), Maxim drove some more tests with the correct solution and tried to send them to the server.  They managed to check a couple, but the latter does not want to be checked.  More precisely, it is not clear what is there with it - the table of results is simply not updated.  In addition, for some of the tests that were already sent, the score in the results table and our own did not coincide a bit.  Damir is looking for an error in the account evaluation module.  Already sort of rechecked everything - there is no error.  After this, the table of results completely falls - it turned out that someone sent an incorrect davar (bad davar, poor quality) to the server and thus broke the testing system.  The organizers soon fixed the bug, restored the table, and told the participants not to send more bad davar: <br><br><img src="https://habrastorage.org/files/339/2f0/443/3392f044358143f491e36db9429cc4f1.png"><br><br>  The bug fix with the table happened around the same time when I had the 14th test.  In the updated table, the score for each test coincided with our locally calculated - i.e.  The bug was not with us and we were looking for it in vain. <br><br>  They sent 14 tests and he also gave a very good result.  After that, until 06:00, we were engaged in sending freshly considered davar, Maxim tried to check-search for new power-words with his hands.  Unfortunately, no new ones were found, but all those words that were found in the tests (‚ÄúEi!‚Äù, ‚ÄúIa! Ia!‚Äù, ‚ÄúR'lyeh‚Äù and ‚ÄúYuggoth‚Äù) really turned out to be power-words. <br><br>  The goal for tomorrow has become clear: to speed up the current decision.  Fortunately, there was quite a lot of room for optimizations. <br><br><h1>  Day 3. Optimization and improvements </h1><br>  Woke up at about 15:30.  Maxim woke up a little earlier and finally cooked a chicken.  With potatoes.  Just by the time we woke up with Damir.  We had breakfast (although it was probably better to have lunch (or had dinner?)). <br><br>  At 16:00 we return to our decision.  It turned out that Damir did not sleep yesterday, and he didn‚Äôt go to bed at 6 am  All this time he has optimized my solution.  Carried out the calculation of the values ‚Äã‚Äãof the evaluation function in a separate procedure and cached (which greatly reduced the number of calculations of the same).     (    std::map)     int64.    ,        power-.        ,  -  .    ,     ,     . <br><br>           ,          .             .     17:00.     14 ,     3 ,   5 ! <br><br>    .        ¬´apocalypse_1¬ª. <br><br>      ,      git   .      , ,      .        ,       . ,  .        git  Dropbox  ,  -    2  :      ¬´solution_%PROBLEM_ID%_%TAG%_%TAG_INDEX%.json¬ª       (     ).    .       : ,   ,     Dropbox    ¬´ -  ¬ª      .   ! <br><br>      Dropbox.  -            .    i5,    i3,    ‚Äî -  .        ‚Äî    <i></i> .        . , ,  ,              .   ,            ‚Äî     (   ).  Dropbox   .  No sooner said than done.            ,   Dropbox      .  Beauty! <br><br>         .         . ! <br><br>  ,       ,   .   :  std::map  -      (   O( ),      O(   )).   -,   .        ,   ¬´¬ª ‚Äî       power-.       .  22:30   .  -  14    3. <br><br>      ¬´¬ª      power-word'.    : <br><ul><li>     ,    power. </li><li>   ,         . </li><li>          . </li><li>        ,      . </li><li>       ¬´¬ª  . </li></ul><br><br>        .  , ,         <i></i> ‚Äî         power-word'. <i></i>   ,     ,     ,    ,    ,  .      -        ,        .  ,       4, 9, 13  23.         2  . <br><br>               ¬´Hack the pool¬ª  ¬´Hack the loop¬ª.    <i></i> ‚Ä¶   ¬´Hack the poop¬ª.  ,   : <br><br><img src="https://habrastorage.org/files/e76/495/e45/e76495e45c194e5184592c597a5be067.png"><br><br>   irc-     ¬´   ?¬ª,    .       ¬´WILD BASHKORT MAGES¬ª.  ‚Äî  . <br><br> 03:00.     2  .        ,  ,  ,  .     ‚Äî      ,   !  ,   - .  ,    ‚Äî          .      ‚Äî  . <br><table><tbody><tr><td></td><td>    - : <br><br><img src="https://habrastorage.org/files/517/a97/c19/517a97c1944b490d9eeda3ba306ad5e5.gif"><br><br>    : ¬´     ,      ‚Äî   ...¬ª.     .     : ¬´      ,      ‚Äî   ...¬ª.       .       ,     : ¬´     ,  !¬ª.      ,            power-word'.     ¬´   ¬ª:     ,    -      ,  ,       . <br></td><td></td></tr></tbody></table><br>        4 . ,  ,    . ,       random seed, : ¬´,   ¬ª.  : ¬´,        ¬ª. ,   -   3  .  ,   2        ,     .         :    . <br><br>      2  ,     ,    9.      ,      ,      ,  ,  .    - : <br><br><img src="https://habrastorage.org/files/2b4/eb9/bdb/2b4eb9bdb47841369ca8b460a1d9a2ec.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the same time, it fell on 35 of the 400 possible moves. Unfortunately, Damir did not invent anything working that late evening. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim collected all this time suspicious words and tested them for the fact that they are power-words. By 3:00 it was found either 6, or 8 such words (along with those 4 that we found earlier). In parallel, he launched our solution with more and more ‚Äúmagic‚Äù words found and sent the resulting davar to the server. Thus, 3 more apocalypses have passed, i.e. The last mass testing tag was "apocalypse_4".</font></font><br><br>    3   (    -   +  +  ,     )    (-     ),       ,      . <br><br>      O( )  O(   )   5:00.  ‚Äî   ,       3 .     ,     3-4 . <br><br><h1>  4.   </h1><br>   -  9-10 ,   . <br><br>     (       ).       ¬´¬ª ,        ,       .   power-word'  10.  : <br><blockquote> <b>ei! <br> yuggoth <br> ia! ia! <br> r'lyeh <br> necronomicon <br> planet 10 <br> monkeyboy <br> john bigboote <br> in his house at r'lyeh dead cthulhu waits dreaming. <br> yoyodyne</b> </blockquote><br>  ,    ,          . ,  ¬´Yog-Sothoth¬ª  ,    . ,  ¬´YogSothoth¬ª ( !)  power-word'!  ,       .  :    ¬´laundry¬ª,     ¬´the laundry¬ª.     ¬´ph'nglui mglw'nafh cthulhu r'lyeh wgah'nagl fhtagn.¬ª.    ¬´¬ª,     -  . <br><br>         10  ¬´¬ª . <br><br>      ,       (   ),        . <br><br>     :      3  ,       9  (   -  ),    ,      ,    /seed'      . <br><br>   12:30        ,       9:   110   400,   35,   .  ,   ,     2 :     ,   .            ,   .              README  . <br><br>     3   14:00.    :    ,   .  ,       (    ),  :       ,   <i></i> .         ¬´¬ª,        .      10        ¬´¬ª:            10  . <br><br> ,  ,  4     . <i></i>    random seed    200   200.           : <br><br><img src="https://habrastorage.org/files/43d/3f4/2d2/43d3f42d2f734d94a78750f2fbf91270.gif"><br><br>  14:40       .      .       .       ¬´panopticum¬ª,    . <br><br>      .   (17:00)    . <br><br>      :   , ,   ? ,     ,     ?   ,        ,     +      .             .  ,      ‚Äî     . -    . <br><br>      ,    ,  ,        .          .            4, 6  24.   ,  4  6     ,       3  .  ,     50  ( random seed)  150  200 .    3       ,   , , ,   4    3  .     3  !  24    :    1 ,      1620    ‚Äî      3 . <br><br>       6  24 ,  4    5  ( 10   ),    ,    .  No sooner said than done. .  16:00 (   )   <i>   </i> . ,   ,  ,    2  5   . ,   ‚Äî      .   ,      2            .  16:20    ,  .   ,       int64,   64- ,    32- . <br><br>   ,  , .      <i></i>   README ,  ,        (   -   ). <br><br><h1>  Epilogue </h1><br>      ‚Äî       .      Unagi      . <br><br>           (,          ,     ),          ‚Äî . <br><br>      <a href="https://github.com/cakeplus/icfp-2015-wild-bashkort-mages"></a> (        ,     ).  /  /.        ,    <a href="https://github.com/cakeplus/icfp-2015-wild-bashkort-mages/blob/master/data/power-words.txt">18 power-word'</a> ,      . <br><br><img src="https://habrastorage.org/files/9db/d1e/de4/9dbd1ede43da4cef85c73bc77846d11d.png"><br><br>  ,    ! </div><p>Source: <a href="https://habr.com/ru/post/264567/">https://habr.com/ru/post/264567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264555/index.html">We get access to the XenServer cloud through access to one virtual machine</a></li>
<li><a href="../264557/index.html">Webinar "Meet the FlyElephant"</a></li>
<li><a href="../264559/index.html">The benefits of learning the languages ‚Äã‚Äãof the family C</a></li>
<li><a href="../264561/index.html">An example of working with iBeacon technology using Swift</a></li>
<li><a href="../264565/index.html">Crowdsourcing map service for works of art</a></li>
<li><a href="../264569/index.html">BEMIT: The next step in the development of BEM according to Harry Roberts</a></li>
<li><a href="../264571/index.html">Incremental update backup as DBMS backup strategy</a></li>
<li><a href="../264573/index.html">How not to build networks</a></li>
<li><a href="../264575/index.html">I have no idea what the hell I'm doing</a></li>
<li><a href="../264577/index.html">Game Development with Unity and Intel RealSense 3D Cameras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>