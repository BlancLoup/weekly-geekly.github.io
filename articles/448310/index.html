<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a telegram bot in python using the telebot library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lyrical digression 
 Bots today are a multifunctional tool for both business and entertainment. Personally, I think that they have a future. Of course...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a telegram bot in python using the telebot library</h1><div class="post__text post__text-html js-mediator-article"><h2>  Lyrical digression </h2><br>  Bots today are a multifunctional tool for both business and entertainment.  Personally, I think that they have a future.  Of course, after reading this article, you will not be able to create large projects, but to become interested and start is completely. <br><br><h2>  Installation and Setup </h2><br>  To get started, let's download the python itself.  You can do this on the <a href="https://www.python.org/">official website</a> .  Do not forget to tick add to PATH during installation!  After installing python, we need a good code editor.  JetBrains comes to the rescue with its free <a href="https://www.jetbrains.com/pycharm/download/">PyCharm</a> .  We are already close, it remains to download the telebot library.  To do this, go to the command line and write: <br><br><pre><code class="python hljs">pip install telebot</code> </pre> <br>  If everything went well, we can continue! <br><a name="habracut"></a><br><h2>  VPN </h2><br>  I think everyone knows about the blocking telegram in Russia and the only solution as always remains vpn.  I personally recommend <a href="https://rus.windscribe.com/">Windscribe</a> , because  they give you 2 GB.  traffic completely free! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Bot Father </h2><br>  In the search for a telegram, we find Bot Farher'a and create our bot using the / newbot command.  Then enter the name and username.  Please note that the username must end in bot! <br><br><img src="https://habrastorage.org/webt/wo/5q/ol/wo5qol8zqfljoiv5qvpm83sm5ag.png" alt="image"><br><br>  As you see, we were given a special api token with which you can control your bot (in my case it is: <i>776550937: AAELEr0c3H6dM-9QnlDD-0Q0Fcd65pPyAiM</i> ).  You can remember your token, but I recommend writing it down. <br><cut></cut><br><h2>  Code </h2><br>  The time has come that everyone has been waiting for.  Open PyCharm and create a new project. <br><br><img src="https://habrastorage.org/webt/wv/x1/ek/wvx1ekh5i4fzwmohaedrqrdsuf4.png" alt="image"><br><br>  Here I recommend to put everything as I have (the name, of course, you can change).  After creating the project, let's create a file that contains our code.  Right click on the folder with your project, then New ‚Üí Python File.  Great, let's start writing code.  Import the telebot library using: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot</code> </pre> <br>  Now you need to create a bot variable.  In fact, the variable name can be anything, but I'm used to writing bot. <br><br><pre> <code class="python hljs">bot = telebot.TeleBot(<span class="hljs-string"><span class="hljs-string">' '</span></span>)</code> </pre> <br>  Let's write a decorator <a href="https://habr.com/ru/users/bot/" class="user_link">bot.</a> Message_handler (), with the help of which our bot will rerogate to the / start command.  To do this, in parentheses we write commands = ['start'].  As a result, we should have this: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(commands=['start'])</span></span></code> </pre> <br>  If you try to start your bot (PCM-&gt; Run), then nothing will work out for you.  First, at the end of the code we need to register bot.polling ().  This is necessary so that the bot does not turn off immediately, but works and checks if there is a new message on the server.  And secondly, if our bot will check for messages, it will still not be able to answer anything.  It's time to fix it!  After our decorator, we create the start_message function, which will take the message parameter (the name of the function can be any).  Next, let's implement the sending of the message from the bot itself.  In the function, write bot.send_message (message.chat.id, 'Hi, you wrote / start').  See what you should get: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot bot = telebot.TeleBot(<span class="hljs-string"><span class="hljs-string">'776550937:AAELEr0c3H6dM-9QnlDD-0Q0Fcd65pPyAiM'</span></span>) @bot.message_handler(commands=[<span class="hljs-string"><span class="hljs-string">'start'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',    /start'</span></span>) bot.polling()</code> </pre> <br>  Check it out ... <br><br><img src="https://habrastorage.org/webt/yc/j_/ib/ycj_iba4bvugurlniy1vbbwsahi.png" alt="image"><br><br>  Great, our bot is working!  That he responded not only to commands, but also to messages, we will create a new decorator <a href="https://habr.com/ru/users/bot/" class="user_link">bot.</a> Message_handler (), and in round brackets we will write content_types = ['text'].  In general, there are many types of content, for example, location, photo, audio, sticker, etc.  But we need to respond to the text, right?  Therefore, we create the function send_text, which takes the message parameter.  In the function we write the condition: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@bot.message_handler(content_types=['text']) def send_text(message): if message.text == '': bot.send_message(message.chat.id, ',  ') elif message.text == '': bot.send_message(message.chat.id, ', ')</span></span></code> </pre> <br>  If the text of the message is "Hello", the bot responds "Hello, my creator", and if the text of the message is "Bye", the bot will reply "Farewell, creator".  Here I think everything is clear.  But you probably wondered, and if the user says ‚Äúhello‚Äù, well, or ‚Äúsend‚Äù, how to be in this situation?  It's simple enough!  In the condition, after the message.text write the function .lower (), and in the text replace all capital letters with lowercase.  Now our bot responds not only to ‚Äúhello‚Äù, but also to ‚ÄúPreveT‚Äù, and even ‚ÄúPRIVET‚Äù. <br><br><img src="https://habrastorage.org/webt/fj/4f/ha/fj4fhaph66c_szwnv6vy4n4ytqu.png" alt="image"><br><br>  Here is what you should get: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot bot = telebot.TeleBot(<span class="hljs-string"><span class="hljs-string">'776550937:AAELEr0c3H6dM-9QnlDD-0Q0Fcd65pPyAiM'</span></span>) @bot.message_handler(commands=[<span class="hljs-string"><span class="hljs-string">'start'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',    /start'</span></span>) @bot.message_handler(content_types=[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message.text.lower() == <span class="hljs-string"><span class="hljs-string">''</span></span>: bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',  '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> message.text.lower() == <span class="hljs-string"><span class="hljs-string">''</span></span>: bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">', '</span></span>) bot.polling()</code> </pre> <br>  Well, we figured out the text, but how to send a sticker for example?  It's simple!  Each sticker has its own id, so if we know the id, we can send it.  There are two ways to get the sticker id.  The first (simple) - through a special bot "What's the sticker id?" <br><br><img src="https://habrastorage.org/webt/qy/aa/r2/qyaar20gutlmozp-q82sq5v4r1u.png" alt="image"><br><br>  Well, the second way, for those who are not looking for easy ways.  Create a new decorator <a href="https://habr.com/ru/users/bot/" class="user_link">bot.</a> Messages_handler (), that's just in the brackets we write content_types = ['sticker'].  Then everything is as usual.  We create a function that accepts the message parameter, but in it we write print (message).  Run the bot. <br><br><img src="https://habrastorage.org/webt/kc/2i/4b/kc2i4bybrgm7wxpn9iivds0rspa.png"><br><br>  See, as soon as I sent the sticker, it immediately output the information to the console, and at the very end there will be our sticker id (file_id).  Let's make sure that when the user sends the bot ‚ÄúI love you‚Äù, the bot responded with a sticker.  It is not necessary to create a new decorator, we just add the condition that existed before.  But instead of bot.send_message (), we will write bot.send_sticker (), and instead of the text, we write the sticker id. <br><br><img src="https://habrastorage.org/webt/ko/vd/nu/kovdnuuzi4vtdzqv8pbwxxep4mi.png" alt="image"><br><br>  Congratulations, everything turned out!  I think how to send audio, photos, and geolocation, you figure it out.  I want to show you how to make the keyboard that the bot will show you at startup.  This will be more difficult to do.  Create a keyboard1 variable in which we write telebot.types.ReplyKeyboardMarkup ().  This function calls the keyboard.  Next, create rows, but remember that rows can be no more than 12!  To create them, write keyboard1.row ().  Write down what you want in round brackets, personally I will write ‚ÄúHello‚Äù and ‚ÄúBye‚Äù.  Now, to call the keyboard, we add reply_markup = keyboard1 to the function of sending a message at the start.  Here's what you should get: <br><br><pre> <code class="python hljs">keyboard1 = telebot.types.ReplyKeyboardMarkup() keyboard1.row(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) @bot.message_handler(commands=[<span class="hljs-string"><span class="hljs-string">'start'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',    /start'</span></span>, reply_markup=keyboard1)</code> </pre> <br>  Run the bot ... <br><br><img src="https://habrastorage.org/webt/wk/_w/zm/wk_wzmzm2escg0e4mllmymems0y.png"><br><br>  You see that the keyboard is kind of big.  To fix this, you just need to set True in the ReplyKeyboardMarkup ().  Well, if you want the keyboard to hide as soon as the user clicks on it, write another one True.  Read more about what these True mean to you in the <a href="https://core.telegram.org/bots/api">official documentation</a> . <br><br><pre> <code class="python hljs">keyboard1 = telebot.types.ReplyKeyboardMarkup(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br>  Well, that's all!  Of course, this is not all possible bots in the telegram, but I showed you the main features.  Thanks for attention. <br><br>  Source: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> telebot bot = telebot.TeleBot(<span class="hljs-string"><span class="hljs-string">'&lt; &gt;'</span></span>) keyboard1 = telebot.types.ReplyKeyboardMarkup() keyboard1.row(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) @bot.message_handler(commands=[<span class="hljs-string"><span class="hljs-string">'start'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',    /start'</span></span>, reply_markup=keyboard1) @bot.message_handler(content_types=[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message.text.lower() == <span class="hljs-string"><span class="hljs-string">''</span></span>: bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">',  '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> message.text.lower() == <span class="hljs-string"><span class="hljs-string">''</span></span>: bot.send_message(message.chat.id, <span class="hljs-string"><span class="hljs-string">', '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> message.text.lower() == <span class="hljs-string"><span class="hljs-string">'  '</span></span>: bot.send_sticker(message.chat.id, <span class="hljs-string"><span class="hljs-string">'CAADAgADZgkAAnlc4gmfCor5YbYYRAI'</span></span>) @bot.message_handler(content_types=[<span class="hljs-string"><span class="hljs-string">'sticker'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sticker_id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message)</span></span></span><span class="hljs-function">:</span></span> print(message) bot.polling()</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/448310/">https://habr.com/ru/post/448310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448298/index.html">GLTF and GLB format basics, part 2</a></li>
<li><a href="../448300/index.html">Conference mailto: CLOUD - about the clouds and around</a></li>
<li><a href="../448302/index.html">Vulnerability in AdBlock and uBlock filters allows arbitrary code execution on the user side.</a></li>
<li><a href="../448304/index.html">The book "Vue.js in action"</a></li>
<li><a href="../448308/index.html">Data Science Digest (April 2019)</a></li>
<li><a href="../448316/index.html">Determine the breed of the dog: the full development cycle, from the Python neural network to the application on Google Play</a></li>
<li><a href="../448318/index.html">What ‚Äúdraftsman‚Äù to use for Confluence?</a></li>
<li><a href="../448320/index.html">Why silicon and why CMOS?</a></li>
<li><a href="../448322/index.html">C ++ Russia 2019: free broadcast of the first hall and a little about what will be at the conference</a></li>
<li><a href="../448324/index.html">Create procedural planets globes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>