<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GoogleDocs integration with Redmine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 If you are tied to the development, then one way or another faced with the bug-tracker systems. Nowadays, to do without them in the pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GoogleDocs integration with Redmine</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5fb/a2e/84a/5fba2e84a022b058eef91285f5744245.jpg"><br><h4>  Introduction </h4><br>  If you are tied to the development, then one way or another faced with the bug-tracker systems.  Nowadays, to do without them in the process of software development is not just difficult, but impossible.  Naturally, it did not pass us by.  In the company we use the Redmine system.  Here is all we need: <br><br>  - Tracking task status <br>  - Grouping tasks in the tracker <br>  - in-project discussion if necessary <br>  - Record keeping (although the possibilities are very limited) <br>  - Accounting time of employees and their activities <br><br>  All this data is collected for a reason.  Each of these components is somehow included in the company's internal metrics, which allow evaluating the efficiency of the production process and analyzing the weak points of the projects so as not to repeat mistakes and do better next time. <br><a name="habracut"></a><br><h4>  Task </h4><br>  Obviously, data collection should be done constantly, so that you can quickly respond to negative changes and try to direct efforts in the right direction.  However, due to the large amount of data that you have to work with, manual processing becomes problematic.  In addition, it is necessary to provide employees with access to such a document so that everyone can enter and assess the situation on the project independently. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The problem that follows from this problem is to automate the collection of data from the bug-tracker system into more convenient sources for reading and visualization. <br><br><h4>  Selection of solutions </h4><br>  The spreadsheet is ideally suited as a convenient source - the data in it can be well structured so that it is readable, and it is also possible to use the data array visualization functions (graphs, charts, etc.). <br><br>  The set of GoogleDocs has spreadsheets with which you can work from anywhere in the world, if you have the Internet, as well as manage access rights to them.  GoogleDocs also provides the ability to use GoogleScript service to process data both inside and outside the document.  Access and management of external resources is carried out through the API of the corresponding service. <br><br>  Redmine provides the ability to retrieve data using <a href="http://www.redmine.org/projects/redmine/wiki/Rest_api">its API</a> . <br><br>  This combination is ideal because it solves the problem. <br><br><h4>  Where to begin? </h4><br>  First you need to connect from the table to the Redmine API.  To do this, we perform a number of simple actions: <br>  1. Create a new script inside our table (Tools -&gt; Script Editor ...) <br><img src="https://habrastorage.org/getpro/habr/post_images/1f7/8f9/6ea/1f78f96eaf5862f22d7c92e8b63f04a6.png" alt="image"><br><br>  2. In the window that opens with the script, you need to remove the created function - we will write our own. <br><br>  To begin, we need the following information: a link that is available Redmine and API-key.  There should be no problems with the first one - if you use a bug tracker, then you know for sure what address the start page is available at (for example, we have <a href="http://redmine.greensight.ru/">redmine.greensight.ru</a> ).  The key is a little more complicated.  You can get it by sending a request to the API.  Open FireFox, and try, for example, to get a list of projects.  To do this, in the address bar, enter &lt;link to redmain&gt; /projects.xml: <br><img src="https://habrastorage.org/getpro/habr/post_images/d32/fc2/013/d32fc20133b61b0a9638bb54ec2ed884.png" alt="image"><br><br>  Enter the username and password of a user registered in the system.  Next, in the developer‚Äôs panel, go to the ‚ÄúNetwork‚Äù tab in the ‚ÄúRequest Headers‚Äù subsection.  What is written in the ‚ÄúAuthorization‚Äù field after the word ‚ÄúBasic‚Äù will be the key we need. <br><img src="https://habrastorage.org/getpro/habr/post_images/160/8a6/05e/1608a605e43d231c01f1401f9065b68b.png" alt="image"><br><br>  Now let's try to get the same using GoogleScript.  We return to the script we created in the table and write the following code: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseUrl = <span class="hljs-string"><span class="hljs-string">"&lt;  Redmine&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = <span class="hljs-string"><span class="hljs-string">"&lt;API-key&gt;"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">APIRequest</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reqUrl</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-built_in"><span class="hljs-built_in">encodeURI</span></span>(baseUrl + reqUrl); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-string"><span class="hljs-string">'Authorization'</span></span> : <span class="hljs-string"><span class="hljs-string">'Basic '</span></span> + key}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> opt = { <span class="hljs-string"><span class="hljs-string">'method'</span></span> : <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'headers'</span></span> : payload, <span class="hljs-string"><span class="hljs-string">'muteHttpExceptions'</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = UrlFetchApp.fetch(url, opt); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> XmlService.parse(response.getContentText()).getRootElement(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRedmineProjects</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = APIRequest (<span class="hljs-string"><span class="hljs-string">'projects.xml'</span></span>); Logger.log(response); }</code> </pre> <br>  Here it is necessary to replace &lt;link in Redmine&gt; and &lt;API-key&gt; with what you received above.  Now a little more detail about what we have done. <br><br>  The baseURL variable holds the link to the Redmine main page.  It is needed so that in the future once again not to register it in the functions of calling API methods.  Accordingly, the key variable is needed for Redmine to provide data in response to a request (you can read more about any article on Basic Authorization).  The APIRequest function queries the Redmine and returns a response from it.  opt is an object that stores API call parameters - the GET method, headers containing data about the user who makes the request, ignoring exceptions. <br><br>  UrlFetchApp is a GoogleScript class that allows you to work with requests to external services.  In this case, we use the <a href="https://developers.google.com/apps-script/reference/url-fetch/url-fetch-app%3Fcsw%3D1">fetch</a> method, in which we pass the request and its parameters. <br><br>  Redmine can return responses to requests in two different forms - xml and JSON.  In this variant, I used the xml-representation of the response, so the <a href="https://developers.google.com/apps-script/reference/xml-service/xml-service">XmlService.parse ()</a> is in the function to return the response to the request.  The getRedmineProjects function gets a list of projects and displays them in the script execution log (to execute the script, select Run -&gt; getRedmineProjects in the menu, and press Ctrl + Enter to view the results). <br><br><h4>  We collect data </h4><br>  To collect data, it remains only to refer to the results of the APIRequest function and correctly retrieve data from them.  I will show on the example of one xml-file how to take data.  The collection mechanism for the rest is similar, and the list of available files is described in the link above.  Let it be one of the metrics that will be useful to everyone - time written off (this metric is taken as an example to show how to get data, we have, of course, more complex metrics on projects).  To do this, we will take data from the time_entries.xml file.  They can be filtered by means of Redmine, for example, the parameter spent_on is responsible for the time written off on a certain date or period, and the project_id - on the time written off in a specific project (for a more detailed description, see the API documentation).  Let's see what this file is: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_entries</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">total_count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"11"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">limit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_entry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>11510<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">issue</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7666"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"62"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hours</span></span></span><span class="hljs-tag">&gt;</span></span>1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hours</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comments</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spent_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spent_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">created_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-09T20:23:34Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">created_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-09T20:23:34Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_entry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_entry</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>11520<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"87"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">issue</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7484"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hours</span></span></span><span class="hljs-tag">&gt;</span></span>7.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hours</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">comments</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spent_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spent_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">created_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-10T07:57:09Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">created_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated_on</span></span></span><span class="hljs-tag">&gt;</span></span>2014-06-10T07:57:09Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated_on</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_entry</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The parent node shows the information that we also need when processing information: total_count - how many records were found for this request, limit - the number of records per page, offset - indent from the beginning of the list.  The limit and offset parameters can also be adjusted in the request itself.  For example, it is worth making limit more so that there are fewer requests when collecting data. <br><br>  As we can see, the file has a very clear structure.  We proceed to its processing.  Suppose we need to write a function that collects all the time written off today on a specific project and calculate how much was spent on management and development: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTimes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> time = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = APIRequest (<span class="hljs-string"><span class="hljs-string">"time_entries.xml?project_id="</span></span> + id + <span class="hljs-string"><span class="hljs-string">"&amp;spent_on=&gt;&lt;"</span></span> + params + <span class="hljs-string"><span class="hljs-string">"&amp;offset="</span></span>+offset + <span class="hljs-string"><span class="hljs-string">"&amp;limit=100"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;response.getChildren(<span class="hljs-string"><span class="hljs-string">'time_entry'</span></span>).length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); obj.push(response.getChildren(<span class="hljs-string"><span class="hljs-string">'time_entry'</span></span>)[i].getChild(<span class="hljs-string"><span class="hljs-string">'activity'</span></span>).getAttribute(<span class="hljs-string"><span class="hljs-string">'name'</span></span>).getValue()); obj.push(response.getChildren(<span class="hljs-string"><span class="hljs-string">'time_entry'</span></span>)[i].getChild(<span class="hljs-string"><span class="hljs-string">'hours'</span></span>).getText()); time.push(obj); } offset += <span class="hljs-number"><span class="hljs-number">100</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (response.getChildren(<span class="hljs-string"><span class="hljs-string">'time_entry'</span></span>).length != <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> manage = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dev = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;time.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time[i][<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">''</span></span>) { manage += +time[i][<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dev += +time[i][<span class="hljs-number"><span class="hljs-number">1</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (manage/(manage+dev)); }</code> </pre><br>  Inside the loop, each time we retrieve information about the time written off in the project with id = id (you can see the project id also through the API request for projects.xml) spent during params.  Each request to Redmine receives 100 records and, if that is not enough, we move to offset. <br><br>  Next, in the loop, we execute response.getChildren ('time_entry') [i] .getChild ('activity'). GetAttribute ('name'). GetValue ().  This command gets the name of the activity from each time logged entry: <br><img src="//habrastorage.org/files/659/ca7/813/659ca7813288486f88a08e85cc52c287.png"><br><br>  Thus, we can get any name of the parameter of any nesting of any of the children of the root element of the xml-file. <br><br>  To get the values ‚Äã‚Äãthemselves, use response.getChildren ('time_entry') [i] .getChild ('hours'). GetText ().  By analogy with the command above, we get retired time: <br><img src="//habrastorage.org/files/96c/bb7/d05/96cbb7d052184c4d93bf0f649918578b.png"><br><br>  Further actions of the function are aimed at calculating the management time and development time for the project. <br><br>  Now we need only to organize the output of the calculated indicators.  To do this, you need to write a small function that inserts the resulting value in the desired cells of our table: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllTimes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value; SpreadsheetApp.getActive().setActiveSheet(SpreadsheetApp.getActive().getSheetByName(<span class="hljs-string"><span class="hljs-string">'Project'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = SpreadsheetApp.getActive().getDataRange().getValues(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k=<span class="hljs-number"><span class="hljs-number">0</span></span>; k&lt;data.length; k++) { value = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((data[k][<span class="hljs-number"><span class="hljs-number">2</span></span>].toLowerCase()==<span class="hljs-string"><span class="hljs-string">''</span></span>)&amp;&amp;(data[k][<span class="hljs-number"><span class="hljs-number">1</span></span>].toString()!=<span class="hljs-string"><span class="hljs-string">''</span></span>)) { value = getTimes(data[k][<span class="hljs-number"><span class="hljs-number">1</span></span>], data[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">9</span></span>]); SpreadsheetApp.getActive().setActiveSelection(<span class="hljs-string"><span class="hljs-string">"K"</span></span> + (k+<span class="hljs-number"><span class="hljs-number">1</span></span>)).setValue(value); } } }</code> </pre><br>  To understand this requires a little explanation.  The list of projects we have is stored on a sheet called ‚ÄúProject‚Äù.  There are metrics in different columns.  The time interval for which the time is filtered is recorded in the same cell as well.  The data variable reads all information from the table.  The cycle then finds all projects in the ‚ÄúActive‚Äù status with the project id from Redmine present, calls the counting function of a specific metric for this project, and writes the result to the K column (in this case). <br><br>  The only thing left now is to execute our script.  To do this, select the menu item Run-&gt; &lt;function name&gt;.  You can also customize the execution of necessary functions from the document menu or by dynamic trigger for a periodic launch. <br><br>  Here is such a way to automate the removal of metrics for the project.  Using the capabilities of the Redmine API, you can automatically receive arbitrarily complex data and not waste time on manual calculations. <br><br><h4>  Rake </h4><br>  Naturally, in the process of performing the task, we had to face some unobvious problems.  I will try to bring the main. <br><br>  1. Restriction on the output of the number of records on request - no more than 100 pieces.  Even if you write in the request limit = 500, it will still output no more than 100. <br><br>  2. In order to display tasks in all statuses, you need to add ‚Äústatus_id = *‚Äù to the request, otherwise, tasks in the ‚ÄúClosed‚Äù, ‚ÄúCanceled‚Äù, etc. status will not be included in the selection. <br><br>  3. You can try to make a custom function and then insert it into the table cell just as we use any other formulas in the table (for example, ‚Äú= gettimes (id, params)‚Äù).  This method will fail with a large amount of data and instead of seeing the project data, you <br>  will see in the cells error. <br><br>  4. It is not recommended to output data through the Logger to the console.  There is a similar problem with paragraph 3 - the script is not fully executed and, as a result, we have not a complete picture. <br><br>  5. Watch the data that may emerge very carefully (mostly, this is in the user fields) - if it is absent, an attempt to read such a field or property in the record via getChild () will result in a null object and further work with it is impossible. </div><p>Source: <a href="https://habr.com/ru/post/227281/">https://habr.com/ru/post/227281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227267/index.html">How a startup can fly out of the index overnight</a></li>
<li><a href="../227273/index.html">Interactive redirection to an exploit kit</a></li>
<li><a href="../227275/index.html">City drones and smart cities</a></li>
<li><a href="../227277/index.html">How we wrote helpdesk</a></li>
<li><a href="../227279/index.html">Who and why is ‚Äúspying‚Äù on Yandex?</a></li>
<li><a href="../227283/index.html">Swift hackathon based on WWDC 2014 from CocoaHeads Moscow</a></li>
<li><a href="../227285/index.html">Own WebGL engine. Article number 2. Matrix</a></li>
<li><a href="../227287/index.html">Installing Google Chromium and Flash on a Linux ARM device</a></li>
<li><a href="../227289/index.html">Automatic import of users' full names from Active Directory to Lightsquid</a></li>
<li><a href="../227293/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ2 (June 16 - 23, 2014)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>