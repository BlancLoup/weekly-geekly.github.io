<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Diamond Dash again</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As soon as I read in a recent article about writing a bot for Diamond Dash on Google+, a little less than 2 million points, my hands started to write ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Diamond Dash again</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/07707012/8df88ffb/42fb30ca/a33501cc.jpg" align="right" alt="16 " title="16 million">  As soon as I read in a <a href="http://habrahabr.ru/blogs/gdev/126957/">recent article</a> about writing a bot for Diamond Dash on Google+, a little less than <b>2 million</b> points, my hands started to write a similar bot that would achieve this goal - and, after several days of experiments, <a href="http://habrahabr.ru/blogs/gdev/126739/">the result was really achieved</a> . <br><br>  However, now this was not enough - using a <a href="http://habrahabr.ru/blogs/gdev/127110/">different approach</a> , at that time my feat was already <a href="http://habrahabr.ru/blogs/gdev/126739/">overtaken</a> and even <a href="http://habrahabr.ru/blogs/gdev/126739/">surpassed</a> (the final result, judging by the article, approaches <b>4 million</b> points).  So I decided to take another obvious step - try to simply replace the request to the server with the result of the game.  As you can see from the screenshot, the attempt ended more than successfully. <br><a name="habracut"></a><br><h2>  Principle </h2><br>  The principle of this approach to cheating is simple to ugliness.  In games that require lightning-fast reactions from the player, it is inefficient to check every ‚Äúmove‚Äù on the server ‚Äî the slightest podlagivanie Internet and fast players immediately turn into embittered players.  And the load on the servers is superfluous - who wants to check a dozen requests per second from just one player?  Therefore, without further ado, the creators of the game transfer the game logic to the client side - and only the calculated number of points is sent to the server.  If we send a fake to the server instead of the real result - the next time we start the game, we will be able to admire a picture similar to the one I quoted above. <br><br>  How to protect the server from such fakes?  Strictly speaking - no way, it is impossible in this situation in principle.  A request informing the server of the result of the game is created on the client - it means that we have all the rules for its formation.  Nevertheless, the task for the hackers can be complicated in the following ways (and their combinations, of course): <ul><li>  by signing the transmitted information with the key sewn into the client, </li><li>  by signing the transmitted information with a key received from the server, </li><li>  signing the transmitted information by the current time (transmitted by a separate field), </li><li>  encrypting the transmitted information </li><li>  Obfuscating the client code to prevent the encryption algorithm, the signature algorithm and the value of the firmware key from being found. </li></ul><br>  Let's see which of these techniques was applied by the developers of the game in question. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Operation "interception" </h2><br>  We put some web traffic sniffer - for example, <a href="http://www.fiddler2.com/">Fiddler</a> .  He knows how to intercept only HTTP (and even then not always), but here we have enough of it.  Start the sniffer, open the page with the game, and play one game.  Return to Fiddler, look. <br><br><img src="https://habrastorage.org/storage1/c4ba04ef/a286a8ed/8d3461f3/7260cb49.png"><br><br>  Yeah, requests to the toy servers (ddg.wooga.com) are sparse - everything is as expected.  You can clearly see the beginning of the game (request to <b>/ game / use_life /</b> - use the heart of life that is spent with each game) and its ending ( <b>/ game / eor /</b> - end of round), and nothing in between. <br><br>  The requests at the end of the game are two - one to <b>ddg.wooga.com/game/eor</b> , the other to <b>ddg.t.wooga.com/w/eor</b> .  Let's begin to dissect the first. <br><br>  Request: <br><blockquote><code><a href="http://ddg.wooga.com/game/eor/%3Ftimestamp%3D1314395650744%26signature%3DV5rwMEQJS_2diWc...ulj2VBs%253D%26session%3D1100447b5bb0d08c12"></a> <a href="https://8kubpeu8314p2efdd7ljdo-a-oz-opensocial.googleusercontent.com/"></a> <b>POST ddg.wooga.com/game/eor/?timestamp=1314395650744&amp;signature=V5rwMEQJS_2diWc...ulj2VBs%3D&amp;session=1100447b5bb0d08c12 HTTP/1.1</b> <br> Host: ddg.wooga.com <br> Connection: keep-alive <br> Content-Length: 99 <br> Origin: 8kubpeu8314p2efdd7ljdo-a-oz-opensocial.googleusercontent.com <br> User-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.215 Safari/535.1 <br> content-type: application/json <br> Accept: */* <br> Accept-Encoding: gzip,deflate,sdch <br> Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4 <br> Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.3 <br> Cookie: _dd_rails_session=BAh7BkkiD3Nlc3Npb25faWQGOgZFRiIljA4NmUzZDZiNjk5MGYxZDQzNWQ%3D--3e580eae77a1037b347dae6229bb6d <br> <br> <b>{"user_id":"104465643407894900734","level":21,"sound":1,"score":144768,"xp":130,"gems_removed":348}</b></code> </blockquote> <br>  Answer: <br><blockquote> <code><b>HTTP/1.1 200 OK</b> <br> Server: nginx <br> Date: Fri, 26 Aug 2011 21:54:12 GMT <br> Content-Type: text/html; charset=utf-8 <br> Connection: close <br> Vary: Accept-Encoding <br> Status: 200 OK <br> Cache-Control: no-cache <br> X-UA-Compatible: IE=Edge,chrome=1 <br> Set-Cookie: _dd_rails_session=BAh7BkkiD3GOgZFR...wNDUxNTc%3D--b85c8953db82adcb0; path=/; HttpOnly <br> X-Runtime: 0.009475 <br> Content-Length: 120 <br> <br> <b>{"timestamp":"1314395652","user_id":"104465643407894900734","signature":"PAfgcneDa83-fR5_-CzJWpQ="}</b></code> </blockquote>  <font color="gray"><i>(hereinafter, some lines are shortened just to fit without hyphenation)</i></font> <br><br>  Simple and clear JSON, not encrypted.  However, the <b>timestamp</b> , <b>signature,</b> and <b>session</b> are transmitted in the address ‚Äî so there is some kind of signature.  The answer, in fact, is not very informative - the server, for its part, also spits out the signature data. <br><br><h2>  Active activities </h2><br>  Well, let's try it out: <u>not</u> even <u>starting a game</u> , send a completely identical request, replacing only the <b>score</b> field value with 99999999. Fortunately, Fiddler has a suitable tool for this - Request Builder. <br><br>  Strangely enough, in response we get exactly the same 200 OK, except with a different timestamp and signature.  We are surprised by the careless reaction of the server, we climb to update the page with the game.  Updating, we are surprised even more: the game believed us, only instead of 99 million, 16,777,215 were counted. It looks like this is a ‚Äúceiling‚Äù - in the database it is most likely stored as something like UNSIGNED MEDIUMINT (three byte integer), which has maximum value. <br><br>  It seems that you can stop at this, but after such sags in terms of the ‚Äúsecurity‚Äù of the application, you involuntarily ask yourself: are there any more holes? <br><br><h2>  Go ahead </h2><br>  As we see, in the request to the server our <b>user_id</b> is <b>passed</b> - the identifier of our Google+ page.  And the signature, apparently, is needed so that the third-party server can understand whether this user_id really belongs to us.  Hmm, does he really understand this?  Or maybe he is so trusting that he can ‚Äúwin‚Äù even on someone else‚Äôs name? <br><br>  We climb to the page of one of the friends, dragging his id from the address, slip all the same request (scoring even for the timestamp fix).  Yeah, it feels good here: 400 Bad Request ... But no, wait a minute: <br><blockquote> <code><b>HTTP/1.1 400 Bad Request</b> <br> Server: nginx <br> Date: Fri, 26 Aug 2011 22:07:06 GMT <br> Content-Type: text/html; charset=utf-8 <br> Connection: close <br> Status: 400 Bad Request <br> Cache-Control: no-cache <br> X-UA-Compatible: IE=Edge,chrome=1 <br> Set-Cookie: _dd_rails_session=BAh7BkkiZ...Tk5NmFkOTA%3D--b96793945142dd62b0e5ea9a; path=/; HttpOnly <br> X-Runtime: 0.002774 <br> Content-Length: 124 <br> <br> <b>Signature mismatch! Got: V5rwMEQJS_2diQ8sdZMXBs= computed: gcLO6NdBJtwBtOwrWIpwL9LliuA=</b></code> </blockquote> <br>  Computed ?!  In fact, the situation is approximately as follows: we are trying to log into someone else's account;  without knowing the password, we enter that horrible;  in response, we receive not only an error message, but also the correct password.  Perfectly. <br><br>  Obediently we copy the signature from the answer, we substitute in request, we send.  You probably already guessed that the answer comes completely benevolent 200 OK.  And quite expected result: <br><br><img src="https://habrastorage.org/storage1/f7ee13fd/f22bcd5e/53819ac5/a8a0ba23.jpg"><br>  (above - my account, below - "experimental" friend) <br><br><h2>  Conclusion or Why all this is ‚Äúunreal‚Äù cheating </h2><br>  The Diamond Dash game development team would probably have to be blamed for negligence - it was obviously not worth showing the correct signature in response to the erroneous one ... But you shouldn‚Äôt be too strict with them.  In the end - it is only a casual toy, and cheating it can not be avoided, as already mentioned in the beginning.  In fact, the only correct way to combat cheating was used in it: the rating table is made up only of the user's friends.  Thus, the <b>results of the markups remain visible only to the friends of the cheaters</b> (however, given the bug with the signature, this is not quite the case). <br><br>  Thank you for paying attention - and I hope my article will be primarily useful not for cheating, but when developing defenses against it :) </div><p>Source: <a href="https://habr.com/ru/post/127168/">https://habr.com/ru/post/127168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127161/index.html">Video analytics demonstration in Minsk</a></li>
<li><a href="../127163/index.html">kedDroid - S04E07. Video review software for Android</a></li>
<li><a href="../127164/index.html">Protection and hacking of the database on the example of the program "Parts Catalog"</a></li>
<li><a href="../127165/index.html">We catch the horizon with Arduino</a></li>
<li><a href="../127167/index.html">Apple Developers Community # 8. School iOs first release</a></li>
<li><a href="../127169/index.html">TURNKEY INTRODUCTION: mutual understanding of the parties</a></li>
<li><a href="../127170/index.html">Record labels are suing a site that allows you to download videos from YouTube</a></li>
<li><a href="../127171/index.html">Convenient device for cloning hard drives</a></li>
<li><a href="../127172/index.html">SignalGuru program for predicting traffic signals</a></li>
<li><a href="../127173/index.html">QNX RTOS: Inter-Task Interaction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>