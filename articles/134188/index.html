<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco ASA in GNS3: Possible Scenarios and Related Bugs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than one article was devoted to the GNS3 emulator, and I think that many who work with Cisco equipment faced with the need to run network equipme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco ASA in GNS3: Possible Scenarios and Related Bugs</h1><div class="post__text post__text-html js-mediator-article">  More than one article was devoted to the GNS3 emulator, and I think that many who work with Cisco equipment faced with the need to run network equipment in a virtual environment to check topologies and solutions of interest, when debugging non-working configurations, or just preparing for certification or learning a particular technology. <br><br>  The latest versions of GNS3 have the ability to emulate a device like the Cisco ASA.  This device is a multifunctional firewall, can work in various modes (routed / transparent; single / multiple context), used in fault-tolerant configurations (active / standby; active / active), etc.  The article presents test results and conclusions on how fully this functionality is supported when virtualizing this device in GNS3. <br><a name="habracut"></a><br>  I hope that this article will help you decide whether to emulate this or that topology in GNS3, and also save time when debugging your solution in a virtual environment. <br><br>  Initial data <br>  Testing was conducted using the following tools: <br>  1. Windows Server 2003 R2 Standard Virtual Machine (Intel Xeon E5420 2.50GHz, 4Gb RAM); <br>  2. Emulator GNS3 v.0.7.4; <br>  3. Cisco ASA 8.0 OS Image (2); <br>  4. Cisco ASDM 6.4 (5) graphics management and monitoring tool; <br>  5. Cisco IOS OS image for routers 3725 (c3725-adventerprisek9-mz.124-25d); <br>  6. Cisco ACS 4.2 Access Control Server; <br>  7. FTP-, TFTP-, syslog-server based on 3CDaemon. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Test topologies and verification techniques were taken from the first workbook (WB) of Internetwork Expert (INE) to prepare for CCIE Security.  I will omit the tasks and description of the technologies being tested, leaving only the results. <br><br>  A description of how to run Cisco ASA in GNS3 can be found at the links - in <a href="http://forum.gns3.net/topic2405.html%3Fsid%3D7c471c60de8de04d8881b985fbb35eb5">English</a> , and even in <a href="http://go-to-easyit.blogspot.com/2011/06/asa-gns3-windows-7.html">Russian</a> . <br><br><h4>  Test Topologies and Validations </h4><br><h5>  1. Dynamic routing </h5><br><br>  In the first test, the Cisco ASA firewall (hereinafter referred to as MU) was launched in routed and single modes (without support for virtual contexts). <br>  The topology is shown in the figure: <br><img src="https://habrastorage.org/storage1/b02eac27/8aed0106/188e4f5f/9757e362.png"><br><br>  As part of these checks, the work of dynamic routing protocols (RIP, OSPF, EIGRP), redistribution, IP SLA tracking was checked. <br>  In cases where there was a need for a managed switch, a Cisco 3725 router with an NM-16ESW module was used. <br><br>  A list of unsupported L2 functions when using the NM-16ESW module is provided on the official <a href="http://www.gns3.net/hardware-emulated">website</a> . <br>  The command line interface is slightly different from the Cisco Catalyst switches.  Be careful. <br><br>  Actually, the tasks described in WB1 INE did not cause any problems with Cisco ASA emulation.  And in general, looking ahead, I‚Äôll say that only routed / single modes work more or less fully in GNS3 at the moment. <br>  However, at this stage a number of auxiliary bugs appeared.  Perhaps the word "bug" does not quite correctly reflect the difficulties and errors that occurred during emulation, however, for the purposes of unity of classification, I will use it. <br><br>  <i>Bug number 1.</i>  The need to reboot the Cisco ASA after setting the base configuration in case switching was performed after the device started.  Otherwise, the connectivity was not established, the devices did not see each other. <br><br>  <i>Bug number 2.</i>  In general, this is not a bug, but a feature of the basic GNS3 settings.  Because  on the machine where GNS3 was started, Cisco ACS4.2 was installed, then ports 2000-2002 were listened directly by ACS itself.  And GNS3 uses ports from 2000 as default console ports for routers. Therefore, be careful, you need to change these ports when adding a router. <br><br>  <i>Bug number 3.</i>  The configuration of routers after turning off and turning on GNS3 is not saved.  This bug was observed in older versions of GNS3 on some IOS images, particularly when working with the 3700 series routers. In the current version, I have no problems working with the 3725, but there is information that the problem remains with 3745 ... Although everything is possible here depends on the emulated image.  In general, if someone collides, you can try to solve this problem <a href="http://forum.gns3.net/topic1677.html%3Fsid%3D423dc1c0ed47b8f60833f26b9db58fee">in this</a> way. <br><br><h5>  2. Network settings </h5><br><br>  In the second test, the DOE Cisco ASA also started in routed, single modes. <br><img src="https://habrastorage.org/storage1/189efa55/5f30f71f/368f8c56/62fc40c3.png"><br><br>  In this test, we checked the operation of access lists (ACLs), various variants of NAT (dynamic NAT, PAT; static NAT, PAT; dynamic policy NAT, static policy NAT, PAT; Identity NAT; NAT Exemption; Outside Dynamic NAT), the ability to control using ASDM, DNS Doctoring function, processing of fragmented traffic, passing BGP connections through ME, multicasting, NTP operation, event logging (syslog, SNMP), ME operation as a DHCP server, policing and shaping. <br><br>  Small difficulties have arisen with management with the help of ASDM (you can watch <a href="http://www.youtube.com/watch%3Fv%3DbPIZwtt7ZYE">video instructions</a> on how to set up ASDM operation in GNS3).  After enabling the ASDM, the device log is filled up with the following messages: <br> <code>%ASA-5-402128: CRYPTO: An attempt to allocate a large memory block <br> failed, size: size, limit: limit</code> <br>  which somewhat complicates debugging.  You can use filters, or disable the logging of this message altogether ( <code>no logging message 402128</code> ). <br><br>  Of the critical flaws: <br>  <i>Bug number 4.</i>  DOE Cisco ASA as a DHCP server in a GNS3 environment does not work. <br><br><h5>  3. Cisco ASA in Transparent mode </h5><br>  In the third test, the work of ME in a transparent mode was checked.  ASA in transparent mode can use only two interfaces (in single mode) for data transfer (and one dedicated interface for control traffic), despite the fact that it may have more interfaces. <br><img src="https://habrastorage.org/storage1/760cdea8/91c713c2/ad820082/fa0ed1e3.png"><br><br>  In this mode, full-fledged work of Cisco ASA in the GNS3 environment is not supported.  The Mgmt interface is available when checking from routers, but traffic through the firewall does not pass, despite the fact that attempts to establish a connection are displayed on the firewall. <br>  Actually because of this, it was not possible to verify the operation of such mechanisms as ARP Inspection, Ethertype ACL, Transparent Firewall NAT. <br><br>  <i>Bug number 5.</i>  Transparent mode in Cisco ASA in GNS3 environment is not supported. <br><br><h5>  4. Cisco ASA in Virtual Contexts Mode </h5><br>  In this mode, two virtual contexts were created: CustomerA, CustomerB. <br>  Interfaces used by the CustomerA context: E0 / 1.121 (InsideA), E0 / 2 (DMZ), E0 / 0 (Outside) <br>  Interfaces used by the CustomerB context: E0 / 1.122 (InsideB), E0 / 2 (DMZ), E0 / 0 (Outside) <br><img src="https://habrastorage.org/storage1/452467c3/0fd926ac/02e2e55d/0fb97672.png"><br><br>  The DMZ and Outside interfaces are divided between contexts. <br><br>  In GNS3, this mode will be supported only when the <code>mac-address auto</code> command is disabled ( <code>no mac-address auto</code> ).  This command generates a virtual mac-address on a shared interface for each context.  Virtual mac is one of the criteria for classifying a package for delivery to the desired context.  Therefore, when disabled, other criteria for classification will be used (entries in active NAT translations). <br>  If your script does not use network address translation, you will not be able to use the same IP and MAC on a shared interface in several contexts. <br><br>  <i>Bug number 6.</i>  The use of virtual contexts is possible only when the <code>mac-address auto</code> command is disabled, which imposes restrictions on the possible deployment scenarios of a Cisco ASA ME. <br><br><h5>  5. Failover configuration in Active / Standby mode </h5><br><br>  In this mode, only one device is active, the second is in a passive state.  The devices synchronize the configuration with each other, as well as the table of connection states, which allows in case of failure of the active part not to break the already established connections. <br><img src="https://habrastorage.org/storage1/c697396a/af36ee94/1e39d77d/0158eb9a.png"><br><br>  During the test, router R1 established a telnet connection to router R2, after which a failure was simulated (by turning off the switch port SW1 connected to the active ME).  Logically, the failover pair should switch, the telnet connection should continue to work, because  between the ME is configured statefull-link. <br>  However, in the GNS3 virtual environment, the result was different.  The failover pair switching occurred, but the telnet session was interrupted.  Moreover, traffic through firewalls stopped going altogether.  This is due to the fact that, despite the fact that the active part has changed, the cluster continued to respond to ARP requests with the MAC address of the first firewall (although it has already switched to passive mode).  After a complete reboot of the cluster pair, the situation has not changed. <br><br>  Bug number 7.  Cisco ASA in Active / Standby failover mode, after switching the active device to passive, ceases to pass traffic through itself due to incorrect responses to ARP requests. <br><br>  As far as I know, such a problem does not arise when emulating Cisco PIX 7 versions.  Therefore, if necessary, use this solution. <br><br><h5>  6. Failsafe configuration in Active / Active mode </h5><br><br>  In this mode, both devices are active.  This is achieved by using several virtual contexts, some of which are active on one part of the cluster, and some on the other. <br><img src="https://habrastorage.org/storage1/52977bf2/7d90778f/02f34aa8/72108fb7.png"><br><br>  The check was planned similar to that described in the previous paragraph.  However, it ended somewhat earlier.  The reason is as follows: the devices are united in a cluster, but the traffic does not pass through it, because  in the fault-tolerant Active / Active configuration, virtual mac-addresses are used. <br><br>  <i>Bug number 8.</i>  Traffic does not pass through the Cisco ASA cluster in Active / Active failover mode. <br><br><h5>  7. Redundant interfaces </h5><br><br>  In the last test, a scheme with redundant interfaces on the Cisco ASA was assembled, which allows you to combine several physical interfaces into a logical one.  In this case, only one interface is active, the second is activated only after the first one fails. <br><img src="https://habrastorage.org/storage1/362cc11c/f12b4422/63a052ee/d66504ea.png"><br><br>  The test disconnected the port of the switch connected to the active ASA interface.  After detecting the failure, the second interface of the ME should be active.  However, in the GNS3 environment, the DOE did not detect for its part the disabling of the port on the switch, and accordingly the non-working interface continued to be in an active state. <br><br>  <i>Bug number 9.</i>  Switching of the redundant interface does not occur when a physical connection fails on a neighboring device. <br><br><h4>  findings </h4><br>  Tests have shown that not all Cisco ASA Modes in GNS3 are fully supported.  Least of all problems arose when using routed, single mode modes.  In general, this mode is the most popular and most complete in terms of functionality.  In transparent mode, to achieve correct operation of the firewall failed. <br>  The mode using virtual contexts is possible in GNS3, but under the condition that the virtual mac-address generation function is disabled, which will not allow implementing a number of scenarios when working with Cisco ASA. <br>  If your goal is to test the merging of two ASA devices into a failover cluster, then you can use GNS3.  However, in the case of Active / Standby mode, the traffic will not pass through the cluster pair when switching (in case of failure), and in the case of Active / Active in all cases. <br>  The situation similar to that with the Active / Standby mode occurs when using redundant interfaces.  If the active interface fails, traffic through the ASA will not pass. <br><br>  I note that all configurations used in the tests were tested on real equipment and worked without any complaints. <br><br>  Perhaps there are ways to fully launch one or another Cisco ASA mode in GNS3, in which case you can arrange a disclosure session and share this knowledge in the comments. <br><br>  If for someone this solution is new, then you can get to know him on the official <a href="http://www.gns3.net/">website</a> - and also watch a ‚Äúsmall‚Äù 40-minute <a href="http://www.cbtnuggets.com/standalone%3Fvideo%3D/freevideo/csco_642_902_02.mp4">video</a> from the well-known author of textbooks CBT Nuggets to prepare for Cisco exams - Jeremy Cioara. </div><p>Source: <a href="https://habr.com/ru/post/134188/">https://habr.com/ru/post/134188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134181/index.html">Amazon EC2 + PHP-fpm + Nginx</a></li>
<li><a href="../134183/index.html">Migrate java application to Fork / Join or what you need to remember</a></li>
<li><a href="../134184/index.html">Writing a program for the simplest FTP file synchronization for Android using SL4A + Python</a></li>
<li><a href="../134186/index.html">Universal ImageLoader for Android</a></li>
<li><a href="../134187/index.html">Problems updating modules with the same ComponentId</a></li>
<li><a href="../134189/index.html">But the holidays very soon!</a></li>
<li><a href="../134190/index.html">GLPI + Fusion Inventory</a></li>
<li><a href="../134192/index.html">All your impressions about dishes and tastes in Evernote Food</a></li>
<li><a href="../134194/index.html">Color Schemes in Vim</a></li>
<li><a href="../134195/index.html">DARPA is looking for developers of mobile applications for military purposes.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>