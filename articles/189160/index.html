<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quickly create basic vagrant images using veewee</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many have probably heard about the utility to automate the creation of vagrant virtual machines. 

 Following the instructions from off.sayta you can ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quickly create basic vagrant images using veewee</h1><div class="post__text post__text-html js-mediator-article">  Many have probably heard about the utility to automate the creation of <a href="http://www.vagrantup.com/">vagrant</a> virtual machines. <br><br>  Following the instructions from off.sayta you can get a working virtual machine by executing only 3 commands. <br><br><pre><code class="bash hljs">vagrant box add lucid32 http://files.vagrantup.com/lucid32.box vagrant init lucid32 vagrant up</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this case, vagrant will download the box from the site and create a virtual machine based on it.  Box is a tar archive with a virtual machine and additional configuration.  Also, on the site <a href="http://www.vagrantbox.es/">www.vagrantbox.es</a> there are a bunch of pre-installed boxes. <br><br>  But there may be situations when you need to create your box, and create virtuals based on it.  The vagrant website <a href="http://docs-v1.vagrantup.com/v1/docs/boxes.html">describes the</a> process of creating a box.  In this article, I would like to show how to automate this part using the <a href="https://github.com/jedi4ever/veewee">veewee</a> utility. <br><a name="habracut"></a><br><br>  I‚Äôll just say that I‚Äôm not familiar with ruby, so if you think that there is an easier way to set up a ruby ‚Äã‚Äãenvironment, I‚Äôll be glad to have constructive suggestions in the comments. <br><br>  For example, let's take Ubuntu 12.04 as a working OS, and select CentOS 6 for the virtual environment. <br>  The settings for vagrant will be stored in the vagrant, veewee directory, respectively, in the veewee directory. <br><br>  The first problem I encountered was: veewee refused to work with the version of ruby, which was installed from the Ubuntu repository. <br>  I had to remove ruby-rvm from the OS, and install a more recent version, in more detail <a href="http://stackoverflow.com/a/9056395/497756">here</a> in English: <br><br><pre> <code class="bash hljs">sudo apt-get --purge remove ruby-rvm sudo rm -rf /usr/share/ruby-rvm /etc/rvmrc /etc/profile.d/rvm.sh curl -L https://get.rvm.io | bash -s stable --ruby --autolibs=<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> --auto-dotfiles</code> </pre><br><br>  Next, install ruby, and several dependencies: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> ~/.rvm/scripts/rvm sudo apt-get install libxslt-dev libxml2-dev rvm install ruby-1.9.2-p320</code> </pre><br><br>  When installing ruby, rvm tried to download the distribution kit at: <a href="">ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.2-p320.tar.bz2</a> and received 404 in response.  If you have the same problem, open the file ~ / .rvm / config / db, find the line ruby_1.9_url and replace http: // with ftp: //, then try installing ruby ‚Äã‚Äãagain. <br><br>  Now go directly to the creation of the box.  Create the necessary directories: <br><br><pre> <code class="bash hljs">mkdir {vagrant,veewee}</code> </pre><br><br>  Download the current version of veewee: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> veewee git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jedi4ever/veewee . bundle install</code> </pre><br><br>  veewee contains templates for most popular OS versions, including Windows: <br><br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> veewee vbox templates | grep -i centos-6.4</code> </pre><br><br>  Create an OS configuration file based on the selected template.  Let's call our OS 'centos6-x86_64-minimal'.  Accordingly, the veewee template for CentOS 6 is set to 'CentOS-6.4-x86_64-minimal': <br><br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> veewee vbox define <span class="hljs-string"><span class="hljs-string">'centos6-x86_64-minimal'</span></span> <span class="hljs-string"><span class="hljs-string">'CentOS-6.4-x86_64-minimal'</span></span></code> </pre><br><br>  In the 'definitions / centos6-x86_64-minimal / definition.rb' file, you can specify various settings for the virtual machine, for example, memory size, disk size, etc. <br><br>  Create a virtual machine for Virtual Box: <br><br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> veewee vbox build <span class="hljs-string"><span class="hljs-string">'centos6-x86_64-minimal'</span></span> --workdir=.</code> </pre><br><br>  If you have a CentOS-6.4-x86_64-minimal.iso pre-downloaded distribution, you can copy it to the iso directory in the current directory.  You can also copy VBoxGuestAdditions.iso for your version of VirtualBox.  If veewee does not find the iso image of the installed OC, the utility will offer to download it during the creation of the virtual machine. <br><br>  Veewee will create a virtual machine, which will also be available through the Virtual Box GUI.  If desired, you can install the necessary software, configure the OS, and so on, before creating a vagrant box based on it.  This can be done manually or automated.  Veewee supports post installation scripts - a set of commands that will be executed in a virtual machine immediately after its installation. <br><br>  Also, veewee will create port 22 redirection in the virtual machine to port 7222 in the main OS. <br><br>  Now you can create a vagrant box: <br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> veewee vbox <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> <span class="hljs-string"><span class="hljs-string">'centos6-x86_64-minimal'</span></span></code> </pre><br><br>  The file 'centos6-x86_64-minimal.box' will be created in the current directory. <br><br>  Add a new box to vagrant: <br><pre> <code class="bash hljs">vagrant box add <span class="hljs-string"><span class="hljs-string">'centos6-x86_64-minimal'</span></span> centos6-x86_64-minimal.box</code> </pre><br><br>  We can remove the 'centos6-x86_64-minimal.box' from the current directory. <br><br>  Now we can create virtual machines based on the newly created box: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../vagrant mkdir centos6-x86_64-minimal <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> centos6-x86_64-minimal vagrant init <span class="hljs-string"><span class="hljs-string">'centos6-x86_64-minimal'</span></span> vagrant up vagrant ssh</code> </pre><br><br>  If you need to change the settings of the box, there is nothing easier than deleting the current box, setting up a virtual machine and rebuilding the box using veewee. <br><br>  Example Vagrantfile for virtual OS. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- mode: ruby -*- # vi: set ft=ruby : # Vagrantfile API/syntax version. Don't touch unless you know what you're doing! VAGRANTFILE_API_VERSION = "2" Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.define :vm1 do |vm1config| vm1config.vm.box = "centos6-x86_64-minimal" vm1config.vm.network :private_network, ip: "192.168.11.10" vm1config.vm.provider :virtualbox do |vb| vb.customize ["modifyvm", :id, "--memory", "1024"] end end end</span></span></code> </pre><br><br>  I intentionally specified vm1 in the config.  Thus, it is possible to start several virtual machines with different parameters from the same box.  This is called multivm and is described <a href="http://docs-v1.vagrantup.com/v1/docs/multivm.html">here</a> . <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/189160/">https://habr.com/ru/post/189160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189146/index.html">Flashing LED string for stop light on Arduino Pro Mini</a></li>
<li><a href="../189148/index.html">Implementing a VoIP card platform on FreeSWITCH using RADIUS</a></li>
<li><a href="../189150/index.html">Value of beauty</a></li>
<li><a href="../189154/index.html">New experiment from NASA: one twin brother in orbit, the second - on Earth</a></li>
<li><a href="../189158/index.html">CloudLinux - divide and conquer</a></li>
<li><a href="../189162/index.html">The story of unsuccessful attempts to introduce open source software in a single state office</a></li>
<li><a href="../189164/index.html">The turning point in the fight against the regime of copyright monopoly is much closer than it seems</a></li>
<li><a href="../189166/index.html">Future digital photography</a></li>
<li><a href="../189168/index.html">Plugin for webstorm and auto-complement</a></li>
<li><a href="../189170/index.html">Change the appearance of the widget "User Ribbon"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>