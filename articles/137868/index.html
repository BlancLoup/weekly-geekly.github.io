<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determining the dominant tones in the image [v 1.1]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the publication of the last article , I completely scored an attempt to perform an algorithm using the HSV or Lab coordinates. Scored on the use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determining the dominant tones in the image [v 1.1]</h1><div class="post__text post__text-html js-mediator-article">  After the publication of the last <a href="http://habrahabr.ru/blogs/web_design/136530/">article</a> , I completely scored an attempt to perform an algorithm using the HSV or Lab coordinates.  Scored on the use of color libraries and in general on the script itself scored. <br><br>  But something became boring and again it was done to work with the images and at the same time I wanted to correct the existing algorithm. <br>  Script: <a href="http://blog.assorium.ru/jpeg">link</a> <br><img src="https://habrastorage.org/storage2/d9f/ec4/516/d9fec45165ed968b211b1bce5ad9ed69.jpg"><br><a name="habracut"></a><br><h5>  Decision </h5><br>  The ill spot of the algorithm was the identification of similar tones.  It was sick because of not taking into account the brightness of similar colors.  At the time of writing, I perfectly represented the problem that I would have to face in determining the brightness and I decided not to take it into account.  It turned out that black and white images were not processed.  Also quite saturated with colors and contrasting images gave out strange tones, which, as it were, were not in the picture. <br><br>  It was all this why.  The unique color identifier was defined as <b>(rg) * 1,000,000 + (rb) * 1000 + (gb)</b> .  Accordingly, colors having the same identifiers were similar.  During processing, an ever greater error was introduced into the r, g, and b components of the color.  Made the simplest rounding: <b>round (round ((rg) / $ error) * $ error) and</b> so on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, the solution turned out to be extremely simple, but not without a nuance.  I first determined the brightness of the color.  This is the simplest arithmetic average, only reduced to an integer scale from 0 to n, where n in this case is the number of brightness intervals.  Actually there is a big problem, the colors will actually be similar, but they will be processed separately and each one will be displayed.  But it will be noticeable only in the images, where the colors located on opposite sides of the border will be caught.  Ideally, such boundaries should not be strictly broken, i.e.  depending on the current palette are shifted to one side or the other. <br><br>  Also, due to the division of tones into brightness intervals, we had to increase the number of processed colors.  Now, instead of 60,000, the algorithm processes 500,000 colors and the verification step is reduced from 20px to 10px.  So perhaps slowing down. <br><br><h5>  Result </h5><br>  As a result, the picture has changed a lot for the better!  The script produces more or less adequate colors on most images.  B / W images also work, although bugs are possible with them. <br>  Below are a few examples of work: <br><img src="https://habrastorage.org/storage2/6b1/f83/8cb/6b1f838cb40ac99ce62ab57191ad0434.jpg"><br><img src="https://habrastorage.org/storage2/65e/91e/6f8/65e91e6f8daa6ac9d9a2ef547d424b37.jpg"><br><img src="https://habrastorage.org/storage2/bc6/f80/37c/bc6f8037cddee62a88ec3c3f81ed8be1.jpg"><br><img src="https://habrastorage.org/storage2/e04/6f9/0ec/e046f90ec0dbdeaa8dcf3677b296c289.jpg"><br><img src="https://habrastorage.org/storage2/304/7a3/fea/3047a3feabbd75488eb37105192da6bb.jpg"><br><br><h5>  Additionally </h5><br>  I did not publish to the blog "Algorithms", because  This is just a small change in the work of the previous version. <br>  Many asked the script to determine the colors in the image.  Actually <a href="">here</a> .  Inside there is a description. <br><br>  <b>UPD_1</b> At the request of some users, added color output in hex format after image processing.  RGB need? <br>  <b>UPD_2</b> Added support for PNG. <br>  <b>UPD_3</b> Author of the photo of the red-haired girl: Elena Serebriakova. <br><br>  <b>UPD_4</b> Brightness recalculation according to the formula 0.299 * R + 0.587 * G + 0.114 * B.  Changed the error.  Added the ability to transfer colors from HEX to RGB format. <br>  <b>UPD_5 Reduced</b> threshold error.  Added the ability to define colors in the loaded photo.  Just click in the right place on the image. </div><p>Source: <a href="https://habr.com/ru/post/137868/">https://habr.com/ru/post/137868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137861/index.html">The app in honor of Valentine's Day on libgdx</a></li>
<li><a href="../137862/index.html">Can you trust WebVizor from Yandex?</a></li>
<li><a href="../137863/index.html">Background Information Update</a></li>
<li><a href="../137864/index.html">Pseudorandom vs. Truly Random</a></li>
<li><a href="../137865/index.html">CISM certification experience</a></li>
<li><a href="../137869/index.html">Windows Phone 7 XNA: we are pixels or not shaders</a></li>
<li><a href="../137870/index.html">JavaScript | HTML Preprocessor</a></li>
<li><a href="../137871/index.html">Digital October - the lair of crazy ideas and coworking center</a></li>
<li><a href="../137875/index.html">We integrate Copy-Paste-Detection into Xcode, and not only</a></li>
<li><a href="../137876/index.html">Startup - Abstruse Goose</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>