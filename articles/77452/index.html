<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HabraKarma - writing an application in Python for s60</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After we warmed up the appetite for Python for s60 and started learning to write applications, I want to suggest continuing to comprehend programming ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HabraKarma - writing an application in Python for s60</h1><div class="post__text post__text-html js-mediator-article"><img src="http://mobile-master.org/temp/for-habra/2/screenshot.png" alt="image" align="left">  After we <a href="http://habrahabr.ru/blogs/PyS60/73714/">warmed up the appetite</a> for Python for s60 and <a href="http://habrahabr.ru/blogs/PyS60/73951/">started learning to</a> write applications, I want to suggest continuing to comprehend programming for symbain in the wonderful programming language python. <br><br>  This time we will do something useful, namely, we will write an application that will show karma.  Do not just show, but display on top of all the ‚Äúwindows‚Äù a sign, on which will be the value of karma and the difference with the previous value.  In addition, the program will publish a victorious gong with an increase in karma and a cry of despair as it decreases.  Everything else, we run it as a server, that is, it will not appear in the list of running programs. <br><br>  For those who are more important result than the process, welcome to the end of the article, where you expect a <b>ready application HabraKarma 1.0 !!!</b> <br><a name="habracut"></a><br>  This time, I will not comment on every line in the program.  I mean that you are at least a little familiar with python, know how to read the <a href="http://pys60.garage.maemo.org/doc/">documentation</a> , and at least understand something from <a href="http://habrahabr.ru/blogs/PyS60/73951/">my previous article</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  General principles of work </h4><br>  The program itself will consist of 2 parts: the server itself, which does all the work, and the GUI, in which we will configure the server, start it and stop it. <br><br>  The server itself is started by the start_server function from the e32 module.  The function has only one parameter - the full path to the Python script, which should be run as a server.  Yes, yes, everything is so simple, but with some restrictions. <br><br>  Since the server is running in the background, it cannot use the appuifw UI module.  But we don‚Äôt need it, because we‚Äôll show the result of work using the topwindow module, which allows you to display images on top of all the ‚Äúwindows‚Äù.  In addition, another module is available to us, called globalui, which also allows you to display such things as various requests, warnings, notifications, etc. on top of all the ‚Äúwindows‚Äù. This will also be used to demonstrate the start and stop of the server. <br><br>  Another limitation is the inability to access files located in the application folder (x: / private / UID).  Therefore, if we want to use various multimedia files, configuration files, we need to put it in some neutral place, for example, in the x: / system / data / AppName folder.  This folder has the attribute "hidden", so the pictures placed there will not be visible in the gallery, and the audio files in the library. <br><br>  Another problem is the ‚Äúisolation‚Äù of the server from the main program.  That is, we can start it, but it is impossible to find out whether it is running or to stop when using standard modules.  In our program we will proceed as follows: <br><br>  The server, when launched, creates a file with the name habra_flag in the root of drive D. When the server is shut down, this file will be deleted.  Now, when starting the shell, check if the file you are searching for exists.  If yes, then the server is considered running.  In addition, you need the ability to stop the server.  For this, in this very file we will write down something, and on the server, in a loop, we will check.  If the file is longer than zero, stop the work. <br><br>  Some may have a question, what kind of disk D, to which we are going to write the file habra_flag.  This is a ram disk, of small volume, which is cleared on reboot  Using it, we kill two birds with one stone: when you restart the phone, manually shut down our server, the flag file will disappear, and the file system on the ram disk has great performance.  For more complex interaction with the server, you can use sockets. <br><br><h4>  Writing UI </h4><br>  The muzzle of the application, which will be launched by clicking on the program icon, will be the Form class, which is practically completely described in <a href="http://wiki.forum.nokia.com/index.php/How_to_use_Form_in_Python_for_S60">this wiki article</a> .  It looks like this: <br><br><img src="http://mobile-master.org/temp/for-habra/2/form.jpg" alt="image"><br><br>  And here is the program code itself with my comments: <br><br><blockquote><ol><li>  <font color="#808080">#coding: utf-8</font> </li><li>  <font color="#ff7700">from</font> appuifw <font color="#ff7700">import</font> <font color="#66cc66">*</font> </li><li>  <font color="#ff7700">import</font> e32 </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">os</font> </li><li>  <font color="#808080"># folder in which settings files, media files, etc. are located.</font> </li><li>  data_path = <font color="#dc143c">os</font> .  <font>getcwd</font> <font>(</font> <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> + u <font color="#483d8b">': <font color="#000099">\\</font> System <font color="#000099">\\</font> data <font color="#000099">\\</font> HabraKarma <font color="#000099">\\</font> '</font> </li><li></li><li>  <font color="#ff7700">class</font> Main: </li><li>  <font color="#ff7700">def</font> <font color="#0000cd">__init__</font> <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  app.  <font>screen</font> = <font color="#483d8b">'normal'</font> </li><li>  <font color="#808080"># read the settings file, which is a dictionary,</font> </li><li>  <font color="#808080"># stupidly saved via repr :)</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> = <font color="#008000">eval</font> <font>(</font> <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'set.dat'</font> <font>)</font> . <font>read</font> <font>(</font> <font>)</font> <font>)</font> </li><li>  <font color="#808080"># List of fields for our form, insert the saved values ‚Äã‚Äãinto its fields.</font> </li><li>  <font color="#008000">self</font> .  <font>fields</font> = <font>[</font> </li><li>  <font>(</font> u <font color="#483d8b">'Habrayuzer'</font> , <font color="#483d8b">'text'</font> , <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'user'</font> <font>]</font> <font>)</font> , </li><li>  <font>(</font> u <font color="#483d8b">"Auto update (min.)"</font> , <font color="#483d8b">'number'</font> , <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'time'</font> <font>]</font> <font>)</font> , </li><li>  <font>(</font> u <font color="#483d8b">"Enable sound?"</font> , <font color="#483d8b">'combo'</font> , <font>(</font> <font>[</font> u <font color="#483d8b">'Yes'</font> , u <font color="#483d8b">'No'</font> <font>]</font> , <font color="#008000">int</font> <font>(</font> <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'sound'</font> <font>]</font> <font>)</font> <font>)</font> <font>)</font> , </li><li>  <font>(</font> u <font color="#483d8b">"Count the difference"</font> , <font color="#483d8b">'combo'</font> , <font>(</font> <font>[</font> u <font color="#483d8b">'Since the beginning of work'</font> , u <font color="#483d8b">'Since last update'</font> <font>]</font> , <font color="#008000">int</font> <font>(</font> <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'diff'</font> <font>]</font> <font>)</font> <font>)</font> <font>)</font> </li><li>  <font>(</font> u <font color="#483d8b">"Position X"</font> , <font color="#483d8b">'number'</font> , <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'X'</font> <font>]</font> <font>)</font> , </li><li>  <font>(</font> u <font color="#483d8b">"Position Y"</font> , <font color="#483d8b">'number'</font> , <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'Y'</font> <font>]</font> <font>)</font> , </li><li></li><li>  <font>]</font> </li><li>  <font color="#808080"># create a form with flags</font> </li><li>  <font color="#008000">self</font> .  <font>form</font> = Form <font>(</font> <font color="#008000">self</font> . <font>fields</font> , flags = FFormDoubleSpaced | FFormEditModeOnly <font>)</font> </li><li>  <font color="#808080"># set the function that will save the values ‚Äã‚Äãfrom the form</font> </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>save_hook</font> = <font color="#008000">self</font> .  <font>save</font> </li><li>  <font color="#808080"># if the server is already running, then the menu should be "stop" and vice versa</font> </li><li>  <font color="#ff7700">if</font> <font color="#dc143c">os</font> .  <font>path</font> .  <font>exists</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>menu</font> = <font>[</font> <font>(</font> u <font color="#483d8b">'Stop'</font> , <font color="#008000">self</font> . <font>stop</font> <font>)</font> <font>]</font> </li><li>  <font color="#ff7700">else</font> : </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>menu</font> = <font>[</font> <font>(</font> u <font color="#483d8b">'Run'</font> , <font color="#008000">self</font> . <font>start_server</font> <font>)</font> <font>]</font> </li><li>  <font color="#808080"># "execute" the form, that is, it will be displayed on the screen, as long as</font> </li><li>  <font color="#808080"># we will not leave it.</font> </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>execute</font> <font>(</font> <font>)</font> </li><li>  <font color="#808080"># after exiting the form, check if the server is running and suggest to start it</font> </li><li>  <font color="#ff7700">if</font> <font color="#ff7700">not</font> <font color="#dc143c">os</font> .  <font>path</font> .  <font>exists</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> <font>)</font> : </li><li>  <font color="#ff7700">if</font> query <font>(</font> u <font color="#483d8b">'Run?'</font> , <font color="#483d8b">'query'</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>start_server</font> <font>(</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> start_server <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># actually server startup function</font> </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>menu</font> = <font>[</font> <font>(</font> u <font color="#483d8b">'Stop'</font> , <font color="#008000">self</font> . <font>stop</font> <font>)</font> <font>]</font> </li><li>  e32.  <font>start_server</font> <font>(</font> data_path + <font color="#483d8b">'server.py'</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> stop <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># server stop function.</font> </li><li>  <font color="#008000">self</font> .  <font>form</font> .  <font>menu</font> = <font>[</font> <font>(</font> u <font color="#483d8b">'Run'</font> , <font color="#008000">self</font> . <font>start_server</font> <font>)</font> <font>]</font> </li><li>  <font color="#008000">open</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> , <font color="#483d8b">'w'</font> <font>)</font> .  <font>write</font> <font>(</font> <font color="#483d8b">'stop'</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> save <font>(</font> <font color="#008000">self</font> , arg = <font color="#008000">None</font> <font>)</font> : </li><li>  <font color="#808080"># take values ‚Äã‚Äãfrom the form and save them to the settings file.</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'user'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">0</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'time'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">1</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'sound'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">2</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> <font>[</font> <font color="#ff4500">1</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'diff'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">3</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> <font>[</font> <font color="#ff4500">1</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'X'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">4</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'Y'</font> <font>]</font> = arg <font>[</font> <font color="#ff4500">5</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'set.dat'</font> , <font color="#483d8b">'w'</font> <font>)</font> .  <font>write</font> <font>(</font> <font color="#dc143c">repr</font> <font>(</font> <font color="#008000">self</font> . <font>settings</font> <font>)</font> <font>)</font> </li><li>  <font color="#ff7700">return</font> <font color="#008000">true</font> </li><li></li><li>  a = Main <font>(</font> <font>)</font> </li></ol></blockquote><br><br><h4>  It remains to write the server :) </h4><br><br><blockquote><ol><li>  <font color="#808080"># - * - coding: utf-8 - * -</font> </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">os</font> </li><li>  <font color="#ff7700">import</font> e32 </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">sys</font> </li><li>  <font color="#808080"># redirect errors to the file.</font> </li><li>  <font color="#dc143c">sys</font> .  <font>stderr</font> = <font color="#008000">open</font> <font>(</font> <font color="#483d8b">'d: <font color="#000099">\\</font> err.txt'</font> , <font color="#483d8b">'w'</font> <font>)</font> </li><li>  <font color="#ff7700">import</font> globalui <font color="#ff7700">as</font> ui </li><li>  <font color="#ff7700">import</font> topwindow </li><li>  <font color="#ff7700">from</font> graphics <font color="#ff7700">import</font> <font color="#66cc66">*</font> </li><li>  <font color="#ff7700">import</font> <font color="#dc143c">urllib</font> </li><li>  <font color="#ff7700">import</font> audio </li><li>  <font color="#008000">open</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> , <font color="#483d8b">'w'</font> <font>)</font> .  <font>write</font> <font>(</font> <font color="#483d8b">''</font> <font>)</font> </li><li></li><li></li><li>  data_path = <font color="#dc143c">os</font> .  <font>getcwd</font> <font>(</font> <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> + u <font color="#483d8b">': <font color="#000099">\\</font> System <font color="#000099">\\</font> data <font color="#000099">\\</font> HabraKarma <font color="#000099">\\</font> '</font> </li><li>  <font color="#808080"># show that we started.</font> </li><li>  ui.  <font>global_note</font> <font>(</font> u <font color="#483d8b">'Habrastart!'</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">class</font> Habra: </li><li></li><li>  <font color="#ff7700">def</font> <font color="#0000cd">__init__</font> <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># open images</font> </li><li>  <font color="#008000">self</font> .  <font>habr_img</font> = Image.  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'habr.png'</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>update_img</font> = Image.  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'update.png'</font> <font>)</font> </li><li>  <font color="#808080"># read settings</font> </li><li>  <font color="#008000">self</font> .  <font>settings</font> = <font color="#008000">eval</font> <font>(</font> <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'set.dat'</font> <font>)</font> . <font>read</font> <font>(</font> <font>)</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>last_karma</font> = <font color="#008000">eval</font> <font>(</font> <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'karma.dat'</font> <font>)</font> . <font>read</font> <font>(</font> <font>)</font> <font>)</font> </li><li>  <font color="#808080"># open sound</font> </li><li>  <font color="#008000">self</font> .  <font>bad_sound</font> = audio.  <font>Sound</font> .  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'bad.wav'</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>good_sound</font> = audio.  <font>Sound</font> .  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'good.wav'</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>loop</font> = <font color="#008000">True</font> </li><li>  <font color="#808080"># create a TopWindow window</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> = topwindow.  <font>TopWindow</font> <font>(</font> <font>)</font> </li><li>  <font color="#808080"># specify rounding</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>corner_type</font> = <font color="#483d8b">'corner5'</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>size</font> = <font>(</font> <font color="#ff4500">170</font> , <font color="#ff4500">35</font> <font>)</font> </li><li>  <font color="#808080"># set the position from the settings file</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>position</font> = <font>(</font> <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'X'</font> <font>]</font> , <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'Y'</font> <font>]</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>show</font> <font>(</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>karma_screen</font> <font>(</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>mainloop</font> <font>(</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> stop <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#008000">self</font> .  <font>loop</font> = <font color="#008000">False</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>hide</font> <font>(</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> karma_screen <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># function called for update</font> </li><li>  <font color="#008000">self</font> .  <font>update_screen</font> <font>(</font> <font>)</font> </li><li>  e32.  <font>ao_sleep</font> <font>(</font> <font color="#ff4500">0.2</font> <font>)</font> </li><li>  <font color="#808080"># pull info from harba api</font> </li><li>  data = <font color="#dc143c">urllib</font> .  <font>urlopen</font> <font>(</font> <font color="#483d8b">'http://habrahabr.ru/api/profile/'</font> + <font color="#008000">self</font> . <font>settings</font> <font>[</font> <font color="#483d8b">'user'</font> <font>]</font> <font>)</font> .  <font>read</font> <font>(</font> <font>)</font> </li><li>  <font color="#808080"># they probably stumble me, but I don't want to drag it</font> </li><li>  <font color="#808080"># case library for parsing xml</font> </li><li>  karma = <font color="#008000">float</font> <font>(</font> data. <font>split</font> <font>(</font> <font color="#483d8b">'&lt;karma&gt;'</font> <font>)</font> <font>[</font> <font color="#ff4500">1</font> <font>]</font> . <font>split</font> <font>(</font> <font color="#483d8b">'&lt;/ karma&gt;'</font> <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> <font>)</font> </li><li>  <font color="#808080"># compare new karma with old and</font> </li><li>  <font color="#808080"># depending on the situation, collect the text, specify the color</font> </li><li>  <font color="#808080"># and play the sound, if it is set in the settings</font> </li><li>  <font color="#ff7700">if</font> <font color="#008000">self</font> .  <font>last_karma</font> <font color="#66cc66">&lt;</font> karma: </li><li>  karma_diff = u <font color="#483d8b">'(+'</font> + <font color="#008000">str</font> <font>(</font> <font color="#008000">abs</font> <font>(</font> <font color="#008000">self</font> . <font>last_karma</font> -karma <font>)</font> <font>)</font> + u <font color="#483d8b">')'</font> </li><li>  karma_color = 0x009f31 </li><li>  <font color="#ff7700">if</font> <font color="#ff7700">not</font> <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'sound'</font> <font>]</font> : </li><li>  <font color="#008000">self</font> .  <font>good_sound</font> .  <font>play</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">elif</font> <font color="#008000">self</font> .  <font>last_karma</font> <font color="#66cc66">&gt;</font> karma: </li><li>  karma_diff = u <font color="#483d8b">'(-'</font> + <font color="#008000">str</font> <font>(</font> <font color="#008000">abs</font> <font>(</font> <font color="#008000">self</font> . <font>last_karma</font> -karma <font>)</font> <font>)</font> + u <font color="#483d8b">')'</font> </li><li>  karma_color = 0xc30202 </li><li>  <font color="#ff7700">if</font> <font color="#ff7700">not</font> <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'sound'</font> <font>]</font> : </li><li>  <font color="#008000">self</font> .  <font>bad_sound</font> .  <font>play</font> <font>(</font> <font>)</font> </li><li>  <font color="#ff7700">else</font> : </li><li>  karma_diff = u <font color="#483d8b">''</font> </li><li>  karma_color = 0xffffff </li><li></li><li>  <font color="#ff7700">if</font> <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'diff'</font> <font>]</font> : </li><li>  <font color="#008000">self</font> .  <font>last_karma</font> = karma </li><li>  <font color="#008000">open</font> <font>(</font> data_path + <font color="#483d8b">'karma.dat'</font> , <font color="#483d8b">'w'</font> <font>)</font> .  <font>write</font> <font>(</font> <font color="#dc143c">repr</font> <font>(</font> karma <font>)</font> <font>)</font> </li><li></li><li>  <font color="#808080"># here we will find out how many pixels the width of the text to occupy</font> </li><li>  karma_width = <font color="#008000">self</font> .  <font>img</font> .  <font>measure_text</font> <font>(</font> <font color="#008000">unicode</font> <font>(</font> karma <font>)</font> <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  diff_width = <font color="#008000">self</font> .  <font>img</font> .  <font>measure_text</font> <font>(</font> karma_diff <font>)</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> </li><li>  <font color="#808080"># and then the matter of technology :)</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> = Image.  <font color="#dc143c">new</font> <font>(</font> <font>(</font> <font color="#ff4500">45</font> + karma_width + diff_width, <font color="#ff4500">35</font> <font>)</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>size</font> = <font>(</font> <font color="#008000">self</font> . <font>img</font> . <font>size</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> , <font color="#ff4500">35</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> .  <font>text</font> <font>(</font> <font>(</font> <font color="#ff4500">35</font> , <font color="#ff4500">25</font> <font>)</font> , <font color="#008000">unicode</font> <font>(</font> karma <font>)</font> <font>)</font> </li><li></li><li>  <font color="#008000">self</font> .  <font>img</font> .  <font>text</font> <font>(</font> <font>(</font> <font color="#ff4500">35</font> + karma_width + <font color="#ff4500">5</font> , <font color="#ff4500">25</font> <font>)</font> , karma_diff, fill = karma_color <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> .  <font>blit</font> <font>(</font> <font color="#008000">self</font> . <font>habr_img</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>add_image</font> <font>(</font> <font color="#008000">self</font> . <font>img</font> , <font>(</font> <font color="#ff4500">0</font> , <font color="#ff4500">0</font> <font>)</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> update_screen <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># this will be displayed during the update</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> = Image.  <font color="#dc143c">new</font> <font>(</font> <font>(</font> <font color="#ff4500">165</font> , <font color="#ff4500">35</font> <font>)</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>size</font> = <font>(</font> <font color="#008000">self</font> . <font>img</font> . <font>size</font> <font>[</font> <font color="#ff4500">0</font> <font>]</font> , <font color="#ff4500">35</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> .  <font>blit</font> <font>(</font> <font color="#008000">self</font> . <font>update_img</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>img</font> .  <font>text</font> <font>(</font> <font>(</font> <font color="#ff4500">35</font> , <font color="#ff4500">25</font> <font>)</font> , u <font color="#483d8b">'Updated'</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>top</font> .  <font>add_image</font> <font>(</font> <font color="#008000">self</font> . <font>img</font> , <font>(</font> <font color="#ff4500">0</font> , <font color="#ff4500">0</font> <font>)</font> <font>)</font> </li><li></li><li>  <font color="#ff7700">def</font> mainloop <font>(</font> <font color="#008000">self</font> <font>)</font> : </li><li>  <font color="#808080"># and let the main server loop</font> </li><li>  interval = <font color="#008000">self</font> .  <font>settings</font> <font>[</font> <font color="#483d8b">'time'</font> <font>]</font> <font color="#66cc66">*</font> <font color="#ff4500">60</font> </li><li>  count = <font color="#ff4500">0</font> </li><li>  <font color="#ff7700">while</font> <font color="#008000">self</font> .  <font>loop</font> : </li><li>  <font color="#808080"># if we are ordered to stop the server</font> </li><li>  <font color="#ff7700">if</font> <font color="#008000">open</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> <font>)</font> .  <font>read</font> <font>(</font> <font>)</font> : </li><li>  <font color="#dc143c">os</font> .  <font>remove</font> <font>(</font> u <font color="#483d8b">'d: <font color="#000099">\\</font> habra_flag'</font> <font>)</font> </li><li>  ui.  <font>global_note</font> <font>(</font> u <font color="#483d8b">'Habrastop!'</font> <font>)</font> </li><li>  <font color="#008000">self</font> .  <font>loop</font> = <font color="#008000">False</font> </li><li>  count + = <font color="#ff4500">1</font> </li><li> <font color="#808080"># if the time is right, we expose karma.</font> </li><li>  <font color="#ff7700">if</font> count <font color="#66cc66">&gt;</font> interval: </li><li>  count = <font color="#ff4500">0</font> </li><li>  <font color="#008000">self</font> .  <font>karma_screen</font> <font>(</font> <font>)</font> </li><li>  e32.  <font>ao_sleep</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> </li><li></li><li></li><li>  habr = Habra <font>(</font> <font>)</font> </li></ol></blockquote><br><br>  It remains to collect the whole thing in sis and watch the karma :) <br><br>  Sources, along with pictures, sounds, an icon can be taken <a href="">HERE</a> .  In ensymble in the build options to register: <br>  --extrasdir = data --lang = RU --icon = path_to_connect <br><br><h4>  And take the result ... </h4><br>  So, I present to your attention the application HabraKarma for symbain 9.x <br>  Install the application, enter your username, configure the update time, the position of the window.  Now you can start the server, which will display your karma on top of all windows.  After that, the program can be closed, the window will remain until you turn it off by going back to the program. <br>  Download from <a href="">here</a> (sis, 56 kb, does not require a signature) <br>  Do not forget that the work requires Python Runtime at least version 1.9.7 ( <a href="">download</a> ). <br>  Python and the program to put on the same disk! </div><p>Source: <a href="https://habr.com/ru/post/77452/">https://habr.com/ru/post/77452/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../77444/index.html">Samsung i5700 - screenshots</a></li>
<li><a href="../77445/index.html">My Scala beginnings or learning Scala after Java</a></li>
<li><a href="../77447/index.html">For Ubuntu 10.04 LTS, packages with fresh versions of the Linux kernel will be released.</a></li>
<li><a href="../77448/index.html">More about publishing components</a></li>
<li><a href="../77450/index.html">Sony, Universal and YouTube have invested $ 300 million</a></li>
<li><a href="../77455/index.html">Invites to Google Wave 30 pieces</a></li>
<li><a href="../77462/index.html">Free Software Center believes that the European Commission underestimated the GPL when analyzing an Oracle deal with Sun</a></li>
<li><a href="../77465/index.html">Palculator - Alternative calculator for Windows</a></li>
<li><a href="../77467/index.html">Tambov Conference, part three</a></li>
<li><a href="../77468/index.html">Wikipedia removed an article about the famine in the US</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>