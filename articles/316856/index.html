<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FIAS addresses in the PostgreSQL environment. Part 4. EPILOGUE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the fourth and last part of the article, which contains examples of creating a fias_AddressObjects table in a database managed by PostgreSQL, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FIAS addresses in the PostgreSQL environment. Part 4. EPILOGUE</h1><div class="post__text post__text-html js-mediator-article">  This is the fourth and last part of the article, which contains examples of creating a fias_AddressObjects table in a database managed by PostgreSQL, as well as loading data on FIAS addressable elements into it.  After these actions, you can independently test the functions discussed in the <a href="https://habrahabr.ru/post/316314/">first</a> , <a href="https://habrahabr.ru/post/316380/">second</a> , and <a href="https://habrahabr.ru/post/316622/">third</a> parts by copying and executing scripts to create them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/94a/cb7/fbc/94acb7fbc32a4cf18fd15e854b62360c.png"></div><br><a name="habracut"></a><br>  The full text of the article consists of 4 parts.  The first half of this part of the article contains comments on the implementation of scripts for creating a table of address-forming elements and filling it with data.  In the second, the source texts of the scripts. <br><br>  Those readers who are interested only in the source code, we suggest you immediately go to <br>  <a href="https://habr.com/ru/post/316856/">Attachment</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Epilogue </h2><br><h3>  Where to start </h3><br>  We need to start by visiting the official website of the Federal Tax Service of the ‚ÄúFederal Information Address System‚Äù (FIAS) section of the <a href="http://fias.nalog.ru/Updates.aspx">Updates</a> page. <br><br>  Download the latest update or full FIAS database on your computer if you are just starting to work with FIAS. <br><br>  Move the file with the archive to the working folder.  Extract the archive files and find the file ADDROBJ.DBF. <br>  <b>Further it is assumed that the archive of files with the FIAS update in the dbf format is downloaded.</b> <br>  The downloaded ADDROBJ.DBF file is converted to csv format.  To do this, open the source file using MS Excel and resave it in csv format, while not forgetting to delete the line with the names of the record fields.  Further, converted to the csv format will be referred to as ‚ÄúADDROBJ24_20161020.csv‚Äù, where 24 is the code of the Krasnoyarsk Territory, and 20161020 is the date of the file download. <br><br>  Create a fias_AddressObjects table.  To do this, you can use the script provided in the <a href="https://habr.com/ru/post/316856/">appendix ‚ÄúCreating a table of FII address-forming elements fias_AddressObjects‚Äù</a> . <br><br><h3>  Load ADDROBJ24_20161020.csv to the database </h3><br><br><img src="https://habrastorage.org/files/fd0/857/c6e/fd0857c6ea554ccaaf26a6ec2e2f1aa8.png"><br><br>  <strong>Fig.</strong>  <strong>7 Direct loading of data into the fias_AddressObjects table.</strong> <br><br>  The data from the ADDROBJ24_20161020.csv file can be directly loaded into the fias_AddressObjects table as shown in Fig.  7 <br><br>  But, unfortunately, the simple way is not for us. <br><br>  First, in addition to the main list of address-forming elements, a list of address-forming elements is also supplied that must be removed from the main list (DADDROBJ.DBF); <br><br>  Secondly, in the main list there are violations of the connectivity, for example, links that do not lead anywhere, i.e.  There is no item or record in the list with the identifier specified in the link.  Therefore, you do not want to recover errors that have already been corrected once. <br><br>  Thirdly, I don‚Äôt want to work every time with a complete list of FIAS addressing elements, but only to upload changes that appear on the official website of the Federal Tax Service two or three times a week. <br><br>  Therefore, in the process of downloading the FIAS update, two temporary tables are used: <br><br><ul><li>  fias_AddressObjects_temp - for updates of the main list of addressing elements; </li><li>  fias_DeletedAddressObjects_temp - for entries to be removed from the main list. </li></ul><br><img src="https://habrastorage.org/files/117/7a5/953/1177a5953c4149b9b1b378c6e0eee0c3.png"><br><br>  <strong>Fig.</strong>  <strong>8. Preloading address-forming elements into temporary tables.</strong> <br><br>  Further, the fias_AddressObjects_temp table data is used to replace (UPDATE) values ‚Äã‚Äãin already existing records and add (INSERT) newly created records to the main table.  The detailed text of these operators can be found in the section ‚ÄúDownloading Updates of Addressing Elements of FIAS to the fias_AddressObjects Table‚Äù. <br><br>  Since the update process may introduce integrity violations, you can download records in which links to the next (NEXTID) or previous (PREVID) history record indicate a non-existing record. <br><br>  This situation is very likely.  Here, for example, data on the download results of the full database as of 10.10.2016. <br><br>  Total violations: <br><br><ul><li>  in NEXTID values </li><li>  in PREVID values </li></ul><br>  Therefore, before you perform updates to the main table, you must disable the restrictions action: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fk_fias_AddressObjects_AddressObjects_PREVID; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fk_fias_AddressObjects_AddressObjects_NEXTID.</code> </pre> <br>  After the updates to the main table have been completed, you must assign NULL values ‚Äã‚Äãto the NEXTID or PREVID fields where their values ‚Äã‚Äãindicate a non-existent record.  For example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NEXTID=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.NEXTID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects nao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> nao.AOID=ao.NEXTID); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> PREVID=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.PREVID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects pao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pao.AOID=ao.PREVID);</code> </pre><br>  Before loading is complete, restore the restrictions and delete the temporary tables. <br><br><h2>  ATTACHMENT </h2><a name="Script5"></a><br><h3>  Creating a table of FIAS addressing elements fias_AddressObjects </h3><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects( AOID <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PREVID <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, NEXTID <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, AOGUID <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PARENTGUID <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, FORMALNAME <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, SHORTNAME <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OFFNAME <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, POSTALCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OKATO <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OKTMO <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, AOLEVEL <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, REGIONCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, AUTOCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, AREACODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CITYCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CTARCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PLACECODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, STREETCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, EXTRCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, SEXTCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">17</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PLAINCODE <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CURRSTATUS <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, IFNSFL <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, TERRIFNSFL <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, IFNSUL <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, TERRIFNSUL <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ACTSTATUS <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CENTSTATUS <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, STARTDATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, ENDDATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, UPDATEDATE <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OPERSTATUS <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, LIVESTATUS <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, NORMDOC <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">36</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> XPKfias_AddressObjects PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (AOID)) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (OIDS=<span class="hljs-literal"><span class="hljs-literal">False</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE1fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_AddressObjects(AOGUID); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE2fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_AddressObjects(PARENTGUID); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XAK1fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_AddressObjects(CODE); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> XIE3fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fias_AddressObjects (REGIONCODE,AUTOCODE,AREACODE,CITYCODE,CTARCODE,PLACECODE,STREETCODE,EXTRCODE,SEXTCODE); <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'ADDROBJ (Object)  ,     .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.AOGUID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.FORMALNAME <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.REGIONCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.AUTOCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.AREACODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.CITYCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.CTARCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.PLACECODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.STREETCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.EXTRCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.SEXTCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.OFFNAME <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.POSTALCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.IFNSFL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.TERRIFNSFL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.IFNSUL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.TERRIFNSUL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.OKATO <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.OKTMO <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.UPDATEDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  () '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.SHORTNAME <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.AOLEVEL <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.PARENTGUID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.AOID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  .  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.PREVID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'      '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.NEXTID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'      '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.CODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'          4.0.'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.PLAINCODE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'     4.0      (  )'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.ACTSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    .     .      . 0 ‚Äì  , 1 - '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.CENTSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.OPERSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    ‚Äì    (.   OperationStatus)'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.LIVESTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   : 0 ‚Äì   , 1 - '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.CURRSTATUS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'   4 (    )'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.STARTDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.ENDDATE <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> fias_AddressObjects.NORMDOC <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT COUNT(*) FROM fias_AddressObjects;</span></span></code> </pre><br></div></div><br><a name="Script6"></a><br><h3>  Uploading updates of FIAS addressing elements to the fias_AddressObjects table </h3><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-comment"><span class="hljs-comment">/***********************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**********************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects_temp; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_DeletedAddressObjects_temp; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_AddressObjects_temp <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AOID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_DeletedAddressObjects_temp <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> AOID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     fias_AddressObjects_temp  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*************************************************************/</span></span> COPY fias_AddressObjects_temp(ACTSTATUS,AOGUID,AOID,AOLEVEL,AREACODE, AUTOCODE,CENTSTATUS,CITYCODE,CODE,CURRSTATUS, ENDDATE,FORMALNAME,IFNSFL,IFNSUL,NEXTID, OFFNAME,OKATO,OKTMO,OPERSTATUS,PARENTGUID, PLACECODE,PLAINCODE,POSTALCODE,PREVID, REGIONCODE,SHORTNAME,STARTDATE,STREETCODE,TERRIFNSFL, TERRIFNSUL,UPDATEDATE,CTARCODE,EXTRCODE,SEXTCODE, LIVESTATUS,NORMDOC) FROM 'W:\Projects\Enisey GIS\DB\SourceData\ADDROBJ24_20161020.csv' <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FORMAT</span></span> csv,DELIMITER <span class="hljs-string"><span class="hljs-string">';'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'WIN1251'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     fias_DeletedAddressObjects_Temp */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ,        */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> COPY fias_DeletedAddressObjects_Temp(ACTSTATUS,AOGUID,AOID,AOLEVEL,AREACODE, AUTOCODE,CENTSTATUS,CITYCODE,CODE,CURRSTATUS, ENDDATE,FORMALNAME,IFNSFL,IFNSUL,NEXTID, OFFNAME,OKATO,OKTMO,OPERSTATUS,PARENTGUID, PLACECODE,PLAINCODE,POSTALCODE,PREVID, REGIONCODE,SHORTNAME,STARTDATE,STREETCODE,TERRIFNSFL, TERRIFNSUL,UPDATEDATE,CTARCODE,EXTRCODE,SEXTCODE, LIVESTATUS,NORMDOC) FROM 'W:\Projects\Enisey GIS\DB\SourceData\DADDROBJ24_20161020.csv' <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FORMAT</span></span> csv,DELIMITER <span class="hljs-string"><span class="hljs-string">';'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ENCODING</span></span> <span class="hljs-string"><span class="hljs-string">'WIN1251'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   CONSTRAINT. */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fk_fias_AddressObjects_AddressObjects_PREVID; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fk_fias_AddressObjects_AddressObjects_NEXTID; <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      fias_DeletedAddressObjects */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ,      fias_DeletedAddressObjects_Temp */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ACTSTATUS=t.ACTSTATUS, AOGUID=t.AOGUID, AOLEVEL=t.AOLEVEL, AREACODE=t.AREACODE, AUTOCODE=t.AUTOCODE, CENTSTATUS=t.CENTSTATUS, CITYCODE=t.CITYCODE, CODE=t.CODE, CURRSTATUS=t.CURRSTATUS, ENDDATE=t.ENDDATE, FORMALNAME=t.FORMALNAME, IFNSFL=t.IFNSFL, IFNSUL=t.IFNSUL, NEXTID=t.NEXTID, OFFNAME=t.OFFNAME, OKATO=t.OKATO, OKTMO=t.OKTMO, OPERSTATUS=t.OPERSTATUS, PARENTGUID=t.PARENTGUID, PLACECODE=t.PLACECODE, PLAINCODE=t.PLAINCODE, POSTALCODE=t.POSTALCODE, PREVID=t.PREVID, REGIONCODE=t.REGIONCODE, SHORTNAME=t.SHORTNAME, STARTDATE=t.STARTDATE, STREETCODE=t.STREETCODE, TERRIFNSFL=t.TERRIFNSFL, TERRIFNSUL=t.TERRIFNSUL, UPDATEDATE=t.UPDATEDATE, CTARCODE=t.CTARCODE, EXTRCODE=t.EXTRCODE, SEXTCODE=t.SEXTCODE, LIVESTATUS=t.LIVESTATUS, NORMDOC=t.NORMDOC <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects dao <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> fias_AddressObjects_temp t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dao.AOID=t.AOID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.AOID=dao.AOID; <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      fias_DeletedAddressObjects , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       fias_DeletedAddressObjects_Temp */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_DeletedAddressObjects_Temp delao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> delao.AOID=ao.AOID); <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       fias_DeletedAddressObjects */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ,     fias_DeletedAddressObjects_Temp */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  CODE LIKE '24%' ,    ,  */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> fias_AddressObjects (ACTSTATUS,AOGUID,AOID,AOLEVEL,AREACODE,AUTOCODE,CENTSTATUS, CITYCODE,CODE,CURRSTATUS,ENDDATE,FORMALNAME,IFNSFL,IFNSUL, NEXTID,OFFNAME,OKATO,OKTMO,OPERSTATUS,PARENTGUID,PLACECODE, PLAINCODE, POSTALCODE,PREVID,REGIONCODE,SHORTNAME,STARTDATE, STREETCODE,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,CTARCODE,EXTRCODE, SEXTCODE,LIVESTATUS,NORMDOC) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ACTSTATUS,AOGUID,AOID,AOLEVEL,AREACODE,AUTOCODE,CENTSTATUS, CITYCODE,CODE,CURRSTATUS,ENDDATE,FORMALNAME,IFNSFL,IFNSUL, NEXTID,OFFNAME,OKATO,OKTMO,OPERSTATUS,PARENTGUID,PLACECODE, PLAINCODE,POSTALCODE,PREVID,REGIONCODE,SHORTNAME,STARTDATE, STREETCODE,TERRIFNSFL,TERRIFNSUL,UPDATEDATE,CTARCODE,EXTRCODE, SEXTCODE,LIVESTATUS,NORMDOC <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects_temp t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> CODE <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'24%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.AOID=t.AOID) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> CODE; <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    fias_AddressObjects. */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*          NULL */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NEXTID=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.NEXTID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects nao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> nao.AOID=ao.NEXTID); <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> fias_AddressObjects ao <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> PREVID=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ao.PREVID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> fias_AddressObjects pao <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pao.AOID=ao.PREVID); <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   CONSTRAINT. */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_fias_AddressObjects_AddressObjects_PREVID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(PREVID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> fias_AddressObjects (AOID); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> fias_AddressObjects <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> fk_fias_AddressObjects_AddressObjects_NEXTID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(NEXTID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> fias_AddressObjects (AOID); <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_AddressObjects_temp; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> fias_DeletedAddressObjects_temp; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACK TRANSACTION; COMMIUT TRANSACTION; SELECT COUNT(*) FROM fias_AddressObjects;</span></span></code> </pre> <br></div></div><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/316856/">https://habr.com/ru/post/316856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316844/index.html">JetBrains tools are half cheaper for companies</a></li>
<li><a href="../316846/index.html">CTFzone write-ups - MISC it all up</a></li>
<li><a href="../316848/index.html">10 unique Internet entrepreneurs of Russia</a></li>
<li><a href="../316850/index.html">Veeam Availability Suite 9.5 - about updates to Veeam ONE, as well as free NFR keys</a></li>
<li><a href="../316854/index.html">"Performance is a feature." Interview with Marco Cecconi, Stack Overflow</a></li>
<li><a href="../316858/index.html">Testing UWP applications using Appium</a></li>
<li><a href="../316862/index.html">Custom Video Recorder for iOS applications</a></li>
<li><a href="../316864/index.html">Dive into the blockchain technology: Decentralized password-free security system</a></li>
<li><a href="../316866/index.html">Discuss? Gartner: Virtualization Market Reaches Saturation</a></li>
<li><a href="../316868/index.html">Telegram-bot: my story. Part one</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>