<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We make our own service to determine the WHOIS of any domain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The WHOIS service is one of the main tools for people who constantly work with domain names. It is needed as any person who wants to choose a beautifu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We make our own service to determine the WHOIS of any domain</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1c6/82c/a27/1c682ca2725b44b79079b69a684926a0.png"><br><br>  The WHOIS service is one of the main tools for people who constantly work with domain names.  It is needed as any person who wants to choose a beautiful domain name, and a hosting provider who, among other services, can provide the ability to register a domain.  Both those and others are looking for automation of their work. <br><br>  So let's see how this works. <br><a name="habracut"></a><br>  Each domain zone, be it RU, COM or HOST, has at least one center (whois server) that has information about the domain located in its zone.  For zone RU, for example, it is whois.ripn.net and whois.tcinet.ru 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All whois servers of all domain zones provide information on a strictly unified protocol that listens for connections and requests on port 43. <br><br>  The very request to the whois server is just sending the domain name of interest to this port, after which we just read the answer. <br><br>  In order to develop a system for automated obtaining WHOIS information on domains, it is first necessary to get a list of whois servers for all existing domain zones.  The correct Google request in the first line gives a link to the project in GitHub, where a full-fledged XML is laid out, containing all the information we need: <br><pre><code class="bash hljs">https://raw.githubusercontent.com/whois-server-list/whois-server-list/master/whois-server-list.xml</code> </pre> <br>  We save this file to ourselves for the subsequent opening in our application. <br><br>  <i>If it seems to someone that constantly updating the XML file and parsing its business is not very convenient, then you can use a simpler method - a third-party online service whois-servers.net.</i>  <i>Simply glue the root zone name with the tail ‚Äú.whois-servers.net‚Äù and get a ready address to send a request to the WHOIS data (for example, for the COM zone you will get the address ‚Äúcom.whois-servers.net‚Äù).</i>  <i>This service has no relation to WHOIS; it simply refers to the correct addresses of the working WHOIS servers using its third-level domains.</i> <br><br>  The example was developed in C # in the usual WinForms: only 2 text fields and 1 button. <br><br>  To obtain a list of WHOIS servers by domain zone from the downloaded XML file, the following function was written: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWhoisServers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> domainZone</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_serverList == <span class="hljs-literal"><span class="hljs-literal">null</span></span>){ _serverList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument(); <span class="hljs-comment"><span class="hljs-comment">// XML       _serverList.Load("whois-server-list.xml"); } List&lt;string&gt; result = new List&lt;string&gt;(); //     XML Action&lt;XmlNodeList&gt; find = null; find = new Action&lt;XmlNodeList&gt;((nodes) =&gt;{ foreach (XmlNode node in nodes) if (node.Name == "domain"){ //  XML     if (node.Attributes["name"] != null &amp;&amp; node.Attributes["name"].Value.ToLower() == domainZone){ foreach (XmlNode n in node.ChildNodes) //   ,           if (n.Name == "whoisServer"){ XmlAttribute host = n.Attributes["host"]; if (host != null &amp;&amp; host.Value.Length &gt; 0 &amp;&amp; !result.Contains(host.Value)) result.Add(host.Value); } } find(node.ChildNodes); } }); find(_serverList["domainList"].ChildNodes); return result; }</span></span></code> </pre><br>  The function for obtaining WHOIS information from an already known server looks like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lookup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> whoisServer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> domainName</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(whoisServer) || <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(domainName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Punycode- ( ) Func&lt;string, string&gt; formatDomainName = delegate(string name){ return name.ToLower() //                , //, "."     XN--H1ALFFA9F.XN--P1AI .Any(v =&gt; !"abcdefghijklmnopqrstuvdxyz0123456789.-".Contains(v)) ? new IdnMapping().GetAscii(name) ://  Punycode name;//   }; StringBuilder result = new StringBuilder(); result.AppendLine("  " + whoisServer + ": ------------------------------------------"); using (TcpClient tcpClient = new TcpClient()){ //    WHOIS tcpClient.Connect(whoisServer.Trim(), 43); byte[] domainQueryBytes = Encoding.ASCII.GetBytes(formatDomainName(domainName) + "\r\n"); using (Stream stream = tcpClient.GetStream()){ //    WHOIS stream.Write(domainQueryBytes, 0, domainQueryBytes.Length); //    UTF8,           using (StreamReader sr = new StreamReader(tcpClient.GetStream(), Encoding.UTF8)){ string row; while ((row = sr.ReadLine()) != null) result.AppendLine(row); } } } result.AppendLine("---------------------------------------------------------------------\r\n"); return result.ToString(); }catch{} return "      " + whoisServer; }</span></span></code> </pre><br>  The function is able to automatically convert domains in Cyrillic (or any other language), thanks to which the query works perfectly with domains in the classical zones in the Latin alphabet, as well as with any national ones.  It is especially nice that in .NET this conversion is implemented by a single line of code using the <i>System.Globalization.IdnMapping</i> class <i>.</i> <br><br>  These 2 functions created give us everything that is required and it remains only to process the pressing of the ‚ÄúGet data‚Äù button on the form. <br><br>  Having a domain name at the entrance to check the WHOIS, we first need to isolate the zone in which it is located.  In view of the fact that the domain can be in the zone of any level (it is not at all necessary that it is always in the second!), I wrote a simple cycle, which for each level, starting from the highest, will check for the existence of WHOIS servers. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_BTN_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span>{ List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; whoisServers = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    string[] domainLevels = domainName_TB.Text.Trim().Split('.'); //    WHOIS-          for (int a = 1; a &lt; domainLevels.Length; a++){ /* *      test.some-name.ru.com, *     WHOIS-  some-name.ru.com, *   ru.com      ,   com */ string zone = string.Join(".", domainLevels, a, domainLevels.Length - a); whoisServers = WhoisService.GetWhoisServers(zone); //  WHOIS-,    if (whoisServers.Count &gt; 0) break; } if (whoisServers == null || whoisServers.Count == 0) result_TB.Text = domainName_TB.Text + "\r\n----------------\r\n  "; else{ result_TB.Text = ""; foreach (string whoisServer in whoisServers) result_TB.Text += WhoisService.Lookup(whoisServer, domainName_TB.Text); } }</span></span></code> </pre><br>  Next, we ask the domain information for each of the servers found and write it into the output window. <br><br><img src="https://habrastorage.org/files/11c/7cb/1df/11c7cb1dff514ae898dee670b8194962.png"><br><br>  In order not to collect in parts from the code in the article, the project in finished form uploaded <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/302494/">https://habr.com/ru/post/302494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302482/index.html">Google I / O 2016: Firebase Platform Development</a></li>
<li><a href="../302484/index.html">"We do not care about your business cards and stylish websites ..." - Actions that do not affect the money on hand</a></li>
<li><a href="../302486/index.html">Pitfalls in the release of the game on Google Play and the App Store</a></li>
<li><a href="../302488/index.html">Multichannel successful retail</a></li>
<li><a href="../302490/index.html">PHD VI: how we hijacked the drone</a></li>
<li><a href="../302496/index.html">Schneider Electric Receives DCS Awards for Innovative Solutions</a></li>
<li><a href="../302498/index.html">"IT nomads": why companies still recruit saboteurs</a></li>
<li><a href="../302506/index.html">Facebook's sixth sense</a></li>
<li><a href="../302508/index.html">Do not deign to discuss about testing mobile applications?</a></li>
<li><a href="../302510/index.html">Participate on June 7-9 in the free dotnetConf 2016 virtual conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>