<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BitrixFramework: take everything into our own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 The next suicidal article from me on the topic of Bitrix, I hope this time the community will be more lenient, because here everything is in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BitrixFramework: take everything into our own hands</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  The next suicidal article from me on the topic of Bitrix, I hope this time the community will be more lenient, because  here everything is in fact, with the code, the schema, no holivar and everything is fair. <br><br>  In this article I will consider an alternative to BitrixFramework, which is designed to make life easier for a developer and somehow influence the development of the CMS Bitrix in the right direction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Action for haters:</b> if write a comment with normal criticism and on the topic + I will personally send to karma ;-).  Here you have Wolfich for starters, everything is interesting inside ... <br><br><img src="https://habrastorage.org/files/2bb/57e/f05/2bb57ef055124e168489a97206cf4a5a.png"><a name="habracut"></a><br><br><h4>  To begin with, dot all the 'i' </h4><br>  All that is written below is my personal opinion and can be quietly thrown in slippers, but I am sure that I am right: <br><br><ol><li>  <b>‚ÄúBitrix has a million lines of shit‚Äù</b> - yes, no doubt.  The whole problem is that Bitrix supports backward compatibility (supposedly everything will work fine if you update version 12.0 to 16.5).  Why do they do it, I do not know (I think no one knows).  If we talk about the source code of standard components (2K lines of code for outputting information block elements - in the order of things), here the guys decided to facilitate the work of end users and provided for everything that could be foreseen (and not a fact), and all this is very rare when needed.  Well, in dogonku, at a recent seminar, the developer Bitrix reported his attitude to the PSR: "Well, this PSR, I read it, some guys gathered and wrote some garbage" (not an exact quote).  So the code will always smell. </li><li>  <b>‚ÄúBitrix has a terrible structure‚Äù</b> - not really.  Bitrix is ‚Äã‚Äãbased on files, and the understanding of MVC is different from the generally accepted one, and for many, ‚Äúnot MVC‚Äù = ‚Äúhorror-horror ‚Äî which structure‚Äù.  So this is a very controversial issue.  And with the Bitrix structure you can live. </li><li>  <b>‚ÄúBitrixFramework will never evolve‚Äù</b> - this is my opinion and this is why: with each release, Bitrix only modifies the ‚ÄúStore‚Äù module, make some edits, but they are all aimed at the store.  On the rest, they frankly do not care.  The development of BF will begin when they abandon backward compatibility and begin to deal not only with the ‚ÄúShop‚Äù module. </li></ol><br><h4>  Meet Juggernaut! </h4><br>  Surely, many are familiar with this character (from Marvel, not from Dota), which is ‚Äúimpossible to stop‚Äù.  A slightly pompous name actually reflects the essence of this project: <b>it doesn‚Äôt matter how much Bitrix is ‚Äã‚Äãdeveloping, what innovations it introduces and what it does, anyway, the library will live and flourish.</b> <br><br>  <b>Bitrix</b> is aimed at users.  <b>Juggernaut</b> targets developers. <br><br><h4>  Why is this necessary? </h4><br>  Because it is necessary!  Everything is actually very logical: <br><ul><li>  Beatrix is ‚Äã‚Äãdeveloping a new core (good), but they don‚Äôt want to document at all (bad); </li><li>  Bitrix is ‚Äã‚Äãdeveloping a new functional (good), but only for the store (bad); </li><li>  Bitrix is ‚Äã‚Äãdeveloping new components (good), but from their code blood from the eyes (bad); </li><li>  Bitrix patented the "new" technology "Composite site" (bad). </li></ul><br><br>  From version 14, Bitrix needed to simply end up supporting the old core and focus on the new one, but no, ‚Äútake care of customers.‚Äù  Rave.  This is the same if Yii2 supported and back combined Yii1. <br><br>  Since Beatrix does not make any progress, the community will do it (instead of whining, writing to the ‚ÄúIdea‚Äù service, and somehow unscrewing using standard components). <br><br>  Bitrix scolded, now you can proceed to the review of Juggernaut.  Then the review of the components of the library and a brief description of their use will begin. <br><br><h4>  Components </h4><br>  Components are the bricks from which to build the site on Bitrix.  Components are conventionally divided into 2 categories: widgets and routers (in Bitrix notation: ‚Äúnormal‚Äù and ‚Äúintegrated‚Äù). <br><br><h4>  Widget </h4><br>  <b>A widget</b> is a component that stupidly does one elementary task (displays a form, a list, information).  The widget receives the input data and in some way converts them.  He should do nothing more.  Widgets do not control routing, but can use it. <br><br>  The default execution order of the component: <br><img src="https://habrastorage.org/files/b74/900/196/b749001961684680b9ea36be43af8c35.png"><br><br>  In order: <br><ul><li>  <b>init</b> - initializes the initial data.  Converts input parameters ($ arParams) to class properties; </li><li>  <b>onBefore</b> - checks the possibility of an action; </li><li>  <b>isCachedTemplate</b> - a flag that determines if there is a cached copy.  If there is, it outputs cache data; if it does not, it generates it (in the code, it looks a little different, the diagram indicates this for simplicity); </li><li>  <b>initResult</b> - forms data for presentation ($ arResult); </li><li>  <b>run</b> - the function of direct execution of the widget.  It defines what needs to be done with the data ($ arResult); </li><li>  <b>onBeforeRender</b> - checks the possibility of outputting a template and performs any transformations (analogue result_modifier.php, although you can use it); </li><li>  <b>render</b> - direct output of the component template; </li><li>  <b>onAfter</b> - performing the action after the widget has been completed (analogous to component_epilog.php). </li></ul><br><br>  Most often, it is enough to override the <b>initResult</b> method and <b>distribute the</b> component template. <br><br>  Below is an example of a component class (class.php), which displays a list of information block elements.  At the input, it receives an array of parameters ($ params), which are used to filter and sort the data. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Widget</span></span>\<span class="hljs-title"><span class="hljs-title">Iblock</span></span>\<span class="hljs-title"><span class="hljs-title">Element</span></span>\<span class="hljs-title"><span class="hljs-title">List_</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockElement</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">WidgetComponent</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *    'init', *    $arParams     , *   : $this-&gt;params = $arParams['params'] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $params = []; <span class="hljs-comment"><span class="hljs-comment">/* *  ,    *   ,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isCachingTemplate = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arResult[<span class="hljs-string"><span class="hljs-string">'elements'</span></span>] = IblockElement::getList(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params); } }</code> </pre> <br></div></div><br><h4>  Router </h4><br>  The task of the router is to collect widgets together.  A router is a controller that, based on a user request (REQUEST_URI), triggers the corresponding action.  An action can be either a page with information (including widgets) or it can contain some kind of logic. <br><br>  The default execution order of the component: <br><img src="https://habrastorage.org/files/b72/d23/38f/b72d2338f8bd4e309294a46d39314c88.png"><br><br>  In order: <br><ul><li>  <b>init</b> - initializes the initial data.  Converts input parameters ($ arParams) to class properties; </li><li>  <b>initUrlManager</b> - fills in UrlManager route data (aliases).  This action is necessary to perform routing on the action and the further generation of URL addresses; </li><li>  <b>parseRequest</b> ‚Äî parses the UrlManager request and determines which action is requested by the user; </li><li>  <b>existBeforeAction</b> - check onBefore personal handler availability.  If there is a 'index' action and there is a 'onBeforeIndex' method, then it will be called exactly, otherwise the common 'onBefore' will be called; </li><li>  <b>onBefore</b> - checks the possibility of an action; </li><li>  <b>run</b> - function of direct execution of components.  It defines what needs to be done with the data ($ arResult); </li><li>  <b>existMethodAction</b> - checking for an action handler.  If the requested action is 'index' and there is a method 'actionIndex', then this method will be called, otherwise the router will try to display a view with the name 'index'; </li><li>  <b>onBeforeRender</b> - checks whether the template can be output and performs any transformations (the name of the action is passed in the parameters, so you can customize the personal check); </li><li>  <b>render</b> - direct output of the component template; </li><li>  <b>onAfter</b> - performing the action after the widget has been completed (analogous to component_epilog.php).  It works similarly with the 'onBefore' method: if the 'onAfterIndex' method exists for the 'index' action, then it will be called, otherwise the general 'onAfter'. </li></ul><br><br>  Below is an example of the component that the directory implements: <br><ul><li>  list of items </li><li>  list of sections </li><li>  detailed element card. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Widget</span></span>\<span class="hljs-title"><span class="hljs-title">Iblock</span></span>\<span class="hljs-title"><span class="hljs-title">Element</span></span>\<span class="hljs-title"><span class="hljs-title">Catalog</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockElement</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockSection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">RouteComponent</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* * ID ,   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $iblockId; <span class="hljs-comment"><span class="hljs-comment">/* *  ,            *  ,        'aliases' */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAliases</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">"sectionList"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"index.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"elementList"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/"</span></span>, <span class="hljs-string"><span class="hljs-string">"elementView"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/#ELEMENT_CODE#/"</span></span> ]; } <span class="hljs-comment"><span class="hljs-comment">/* *    ,   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBefore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($action)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;iblockId) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"  'iblockId' "</span></span>. get_called_class()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::onBefore($action); } <span class="hljs-comment"><span class="hljs-comment">/* *       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sectionCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IblockSection::getRow([ <span class="hljs-string"><span class="hljs-string">"filter"</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"IBLOCK_ID"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;iblockId, <span class="hljs-string"><span class="hljs-string">"CODE"</span></span> =&gt; $sectionCode ], ]); } <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionSectionList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $sectionList = IblockSection::getListByField( <span class="hljs-string"><span class="hljs-string">"=IBLOCK_ID"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;iblockId, [ <span class="hljs-string"><span class="hljs-string">"order"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"SORT"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"ASC"</span></span>] ] ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arResult[<span class="hljs-string"><span class="hljs-string">'sectionList'</span></span>] = $sectionList; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'list'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** *     *  $sectionCode    URL */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionElementList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sectionCode)</span></span></span><span class="hljs-function"> </span></span>{ $section = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSection($sectionCode); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$section) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;error404(); } <span class="hljs-comment"><span class="hljs-comment">// $this-&gt;arResult['section'] = $section; $this-&gt;arResult['elementList'] = $section-&gt;getElements(); $this-&gt;render('section'); } /** *    *      ,       'aliases' */ public function actionElementView($sectionCode, $elementCode) { $section = $this-&gt;getSection($sectionCode); if (!$section) { $this-&gt;error404(); } // $element = IblockElement::getRow([ "filter" =&gt; [ "IBLOCK_ID" =&gt; $this-&gt;iblockId, "IBLOCK_SECTION_ID" =&gt; $section-&gt;ID, "CODE" =&gt; $elementCode, ], ]); if (!$element) { $this-&gt;error404(); } $this-&gt;arResult['element'] = $element; $this-&gt;arResult['section'] = $section; $this-&gt;render('view'); } }</span></span></code> </pre><br></div></div><br><br><h4>  Autoload classes </h4><br>  I will not speak much on this issue, because it‚Äôs already clear that this is a very necessary thing, I‚Äôll just describe how it works. <br><br>  As implemented in Juggernaut: <br><br>  In the ‚Äúlib‚Äù folder you should observe the following structure: the names of the class files are identical to the namespace names, not including the extension and upper namespace.  For example, the file "... / modules / Iblock / lib / Property / Table.php" will correspond to the class "Iblock \ Property \ Table". <br><br>  Calling "includeModule" is no longer necessary, since  if necessary, all classes will be loaded automatically from the necessary directories. <br>  If the module directory is different from the namespace name, or in any other situation, you can manually set the matching namespace and directory: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  "Jugger\D7\Iblock"    "./lib/D7/Iblock.php" ‚Äì      \Jugger\Psr\Psr4\Autoloader::addNamespace('Jugger', __DIR__.'/lib'); //  "Jugger\D7\Iblock"    "./classes/Iblock.php" \Jugger\Psr\Psr4\Autoloader::addNamespace('Jugger\D7', __DIR__.'/classes');</span></span></code> </pre><br><br>  In Bitrix, autoloading is also implemented, but it forms the path a little differently: <br><br>  The class ‚ÄúOlof \ Catalog \ Tools \ File‚Äù is translated as ‚Äú/Olof.Catalog/lib/Tools/File.php‚Äù. <br><br>  If you need the class ‚ÄúOlof \ Catalog‚Äù - then excuse me, point out its presence with your hands (see below).  The directory of the module should be with the delimiter ‚Äú.‚Äù Otherwise walk through the forest.  The directory ‚Äúolof.catalog.iblock‚Äù is incorrect. <br><br>  <i>The gentlemen from Bitrix actually did a normal thing: they took care of specifying the vendor in the module name, but I think this is an unnecessary condition for naming the directory.</i> <br><br>  Autoloading implicitly reacts to classes of the type ‚ÄúElementTable‚Äù by deleting the postfix, translating them into files ‚Äúelement.php‚Äù.  Actually, because of this, you cannot create a class named Table. <br><br>  It is also impossible to load classes from modules that are not currently connected (includeModule). <br><br>  Consider an example of how the Bitrix version works: we have the ‚Äúolof.iblock‚Äù module and the corresponding include.php file: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Olof</span></span>\<span class="hljs-title"><span class="hljs-title">Iblock</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Bitrix</span></span>\<span class="hljs-title"><span class="hljs-title">Main</span></span>\<span class="hljs-title"><span class="hljs-title">Loader</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   Loader::includeModule("Olof.Iblock"); //      Api Loader::registerAutoLoadClasses("Olof.Iblock", [ "\Olof\Classes\Api" =&gt; ". /modules/Olof.Iblock/classes/api.php", ]); //    : // Olof\Iblock\Element -&gt; ./modules/Olof.Iblock/lib/Element.php // Olof\Classes\Api -&gt; ./modules/Olof.Iblock/classes/api.php // Olof\Classes\Help -&gt; ./modules/Olof.Classes/lib/Help.php</span></span></code> </pre><br><br>  Too many implicit conditions and conditions in my opinion.  And no one knows what stupidity Beatrix will come up with tomorrow.  And they should come up with an indication of the directory for the namespace prefix (as in PSR-4) and then it will be cool.  And while there is a Juggernaut ;-) <br><br><h4>  ActiveRecord </h4><br>  For the convenience of working with entities, and in particular with information blocks, the ActiveRecord template is implemented.  At the moment, AR is based (in fact it is a superstructure) on Bitrix DataMappers, in the future it is planned to complete the transfer to an independent ORM / DAO. <br><br>  Below is an example of working with information blocks via AR, and almost all currently available methods are covered. <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">Iblock</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockSection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockElement</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> $iblock = Iblock::getByPrimary(<span class="hljs-number"><span class="hljs-number">1</span></span>); $iblock = Iblock::getRowByField(<span class="hljs-string"><span class="hljs-string">"=ID"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); $iblock = Iblock::getRow([ <span class="hljs-string"><span class="hljs-string">"filter"</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"=ID"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, ], ]); $iblock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Iblock($iblock); <span class="hljs-comment"><span class="hljs-comment">/** *    ,      */</span></span> $iblock-&gt;NAME; $iblock-&gt;IBLOCK_TYPE_ID; <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> $iblock-&gt;getElements(); $iblock-&gt;getSections(); <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> $sectionList = $iblock-&gt;getSections(); $sectionList = $iblock-&gt;getSections([ <span class="hljs-string"><span class="hljs-string">"order"</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"NAME"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"ASC"</span></span>, ], ]); $sectionList = IblockSection::getListByField(<span class="hljs-string"><span class="hljs-string">"=IBLOCK_ID"</span></span>, $iblock-&gt;ID); $sectionList = IblockSection::getList([ <span class="hljs-string"><span class="hljs-string">"filter"</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">"=IBLOCK_ID"</span></span> =&gt; $iblock-&gt;ID, ], ]); <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> $section = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IblockSection($sectionList-&gt;fetch()); $section-&gt;getChilds(); <span class="hljs-comment"><span class="hljs-comment">//   1-   $section-&gt;getChilds(2); //    2-   ( ,    ) $section-&gt;getChilds(0); //    $section-&gt;getIblock(); //   /* *    */ $elementList = $section-&gt;getElements(); while($element = $elementList-&gt;fetch()) { /* *    AR      */ $element = new IblockElement($element); $element-&gt;getProperties(); //   /* *    */ $elementProperty = $element-&gt;getProperty(1); /* *   (  ) */ $value = $elementProperty-&gt;VALUE; $value = $elementProperty-&gt;getValue(); /* *       , *           */ $elementProperty-&gt;getValueRaw(); //    $elementProperty-&gt;getValueEnum(); // IblockPropertyEnum -    (L) $elementProperty-&gt;getValueFile(); // CFile::GetFileArray $elementProperty-&gt;getValueHtml(); // (string) HTML  $elementProperty-&gt;getValueElement(); // IblockElement -   (E) $elementProperty-&gt;getValueSection(); // IblockSection -   (G) $elementProperty-&gt;getValueNumber(); // (float)  (int)     /* *    */ $property = $elementProperty-&gt;getMeta(); $property-&gt;NAME; $property-&gt;HINT; }</span></span></code> </pre><br></div></div><br><br>  The methods: <b>getPrimary</b> , <b>getRow</b> , <b>getRowByField</b> , <b>getList</b> , <b>getListByField</b> are identical for all ActiveRecord. <br><br>  The AR functionality is currently quite poor (for example, there is no cross-table lookup), but since they are a wrapper over standard functions, Bitrix Buns can be used in the getList and getRow methods.  After creating / borrowing a normal DAO, this moment will be finished. <br><br><h4>  Hermitage </h4><br>  The strength of Bitrix, and I think many will agree, is its user interface, aka Hermitage.  It is very convenient and flexible. <br><br>  Below is an example of working with the Hermitage: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockSection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Orm</span></span>\<span class="hljs-title"><span class="hljs-title">Ib</span></span>\<span class="hljs-title"><span class="hljs-title">IblockElement</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Ui</span></span>\<span class="hljs-title"><span class="hljs-title">Hermitage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Ui</span></span>\<span class="hljs-title"><span class="hljs-title">Hermitage</span></span>\<span class="hljs-title"><span class="hljs-title">Icon</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Context</span></span>\<span class="hljs-title"><span class="hljs-title">UrlManager</span></span>\<span class="hljs-title"><span class="hljs-title">Iblock</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $this CBitrixComponentTemplate */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $component CBitrixComponent */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* *   ""  ""     */</span></span> $element = IblockSection::getByPrimary(<span class="hljs-number"><span class="hljs-number">1</span></span>); Hermitage::addButtonEditIblockElement(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $element); Hermitage::addButtonDeleteIblockElement(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $element); $section = IblockSection::getByPrimary(<span class="hljs-number"><span class="hljs-number">1</span></span>); Hermitage::addButtonEditIblockSection(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $section); Hermitage::addButtonDeleteIblockSection(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $section); <span class="hljs-comment"><span class="hljs-comment">/* *      */</span></span> Hermitage::addButton( $component, Iblock::getElementCreateUrl(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">" "</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ICON"</span></span> =&gt; Icon::TOOLBAR_CREATE, ] ); <span class="hljs-comment"><span class="hljs-comment">/* *      */</span></span> Hermitage::addPanelButton(<span class="hljs-string"><span class="hljs-string">"#"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ICON"</span></span> =&gt; Icon::PANEL_TRANSLATE, ]);</code> </pre><br></div></div><br><br>  So praised and wrote so little)) In fact, this is enough for user interaction.  There is a lot to do with regards to the administrative interface, but this is no longer the Hermitage, and this is all in plans. <br><br><h4>  Security </h4><br>  In Bitrix, as far as I know (and in this matter, I will not hide, I didn‚Äôt pick too much), with the security of the site (specifically in the code) it‚Äôs generally sad (only protection from SI).  In the future, this section will contain tools to protect against various attacks and malicious actions (XSS, random data generation, various crypto functions, form validation, work with passwords, ...).  At the moment, only the tools for protection against CSRF are implemented: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Security</span></span>\<span class="hljs-title"><span class="hljs-title">Csrf</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* * ""  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Csrf::validateTokenByPost()) { <span class="hljs-comment"><span class="hljs-comment">// ok } else { // error } echo Csrf::printInput(); /* * ""  */ $nameField = "csrf"; $token = Bitrix\Main\Context::getCurrent()-&gt;getRequest()-&gt;getPost($nameField); if (Csrf::validateToken($token)) { // ok } else { // error } $token = Csrf::createToken(); echo "&lt;input type='hidden' name='{$nameField}' value='{$token}'&gt;";</span></span></code> </pre><br><br>  After each check (successful or unsuccessful) - the token is deleted from the session, thus you can check the token only once. <br><br><h4>  Urlmanager </h4><br>  Routing to Bitrix would not say at the height, so this area is affected in Juggernaut.  This class allows you to dynamically create and use URL routes (used in component routers). <br><br>  Consider an example of parsing and generating a URL: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Context</span></span>\<span class="hljs-title"><span class="hljs-title">UrlManager</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   URL   */</span></span> UrlManager::setBaseUrl(<span class="hljs-string"><span class="hljs-string">"/catalog"</span></span>); UrlManager::addAlias(<span class="hljs-string"><span class="hljs-string">"sectionList"</span></span>, <span class="hljs-string"><span class="hljs-string">"index.php"</span></span>); UrlManager::addAlias(<span class="hljs-string"><span class="hljs-string">"elementList"</span></span>, <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/"</span></span>); UrlManager::addAlias(<span class="hljs-string"><span class="hljs-string">"elementView"</span></span>, <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/#ELEMENT_CODE#/"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *   'alias'    * ,   '/catalog/section1/element1/'    'elementView' */</span></span> $alias = UrlManager::parseRequest(); <span class="hljs-comment"><span class="hljs-comment">/* *     (   UrlManager   ,     ) */</span></span> $folder404 = <span class="hljs-string"><span class="hljs-string">"/catalog"</span></span>; $arUrlTemplates = [ <span class="hljs-string"><span class="hljs-string">"sectionList"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"index.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"elementList"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/"</span></span>, <span class="hljs-string"><span class="hljs-string">"elementView"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"#SECTION_CODE#/#ELEMENT_CODE#/"</span></span>, ]; $arVariables = []; <span class="hljs-comment"><span class="hljs-comment">// UrlManager::$params CComponentEngine::parseComponentPath($folder404, $arUrlTemplates, $arVariables); /* *      */ UrlManager::addParams([ "param1" =&gt; "value1", "param2" =&gt; "value2", ]); /* *   URL. *        . *     "ELEMENT_CODE" -    */ UrlManager::addParam("SECTION_CODE", "section1"); $url = UrlManager::build("elementView", [ "ELEMENT_CODE" =&gt; "element1", ]); // $url: /catalog/section1/element1/</span></span></code> </pre><br></div></div><br><br>  In the future, it is also planned to tie in to <b>urlRewrite.php</b> . <br><br><h4>  Developments </h4><br>  This class is simply a wrapper over D7 functions, with more convenient use. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Jugger</span></span>\<span class="hljs-title"><span class="hljs-title">Helper</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> Event::on(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  }); Event::on(" ", "\ClassName::MethodName", "moduleName"); /* *   */ Event::off(" "); Event::off(" ", 3); //  4-   ( )  /* *   */ Event::trigger(" "); /* *      () */ Event::trigger(" ", $this);</span></span></code> </pre><br><br><h4>  What's next? </h4><br>  Plans for the near future: <br><ul><li>  normal QueryBuilder </li><li>  normal caching </li><li>  normal AssetsManager </li><li>  a set of components for creating and working with the administrative interface </li><li>  normal routing (tied to HttpException) </li></ul><br><br><h4>  Conclusion </h4><br>  A lot of things conceived, a lot of things not done.  The library develops as I need it, so it is very dependent on current orders (which are often the same type) and free time. <br><br>  As I said at the beginning, the project will develop no matter what, only the speed of development depends on the number of its authors and stakeholders.  So the choice is yours: <br><ul><li>  whining, waiting and adjusting to Bitrix (and the development of BitrixFramework is clearly not a priority); </li><li>  take things in hand and help develop juggernaut. </li></ul><br>  Any interested philanthropist can help (otherwise there is no way), for this you need: <br><ul><li>  share an idea </li><li>  refactor what is </li><li>  do something with your pens </li></ul><br>  The project is on GitHub, so anyone can edit, add, comment and ask. <br><br>  Thanks for attention!  Constructive criticism is very welcome :-) <br><br>  PS comments like "yes in FIG Bitrix" a huge request not to write.  I am aware of how people are related to this system, and this project is just aimed at refining it.  Therefore, if you think that ‚Äúit is better and easier to do a project on any framework‚Äù - then I know this and I am very happy for you, therefore, leave your opinion with you.  Thank! <br><br>  Repository: <a href="https://github.com/irpsv/juggernaut.bitrix_release">github.com/irpsv/juggernaut.bitrix_release</a> <br>  Marketplace: coming soon </div><p>Source: <a href="https://habr.com/ru/post/303774/">https://habr.com/ru/post/303774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303760/index.html">7 rules for writing world-class technical documentation</a></li>
<li><a href="../303762/index.html">Ansible: testing playbooks (part 1)</a></li>
<li><a href="../303768/index.html">Database backup via SQL VDI</a></li>
<li><a href="../303770/index.html">A bit about the performance of Cisco network equipment</a></li>
<li><a href="../303772/index.html">Super Mario World Method: Add-ons and Extensions</a></li>
<li><a href="../303776/index.html">Vice-president of new products Mail.ru Group Yuri Gursky - about their own projects: Maps.me, MSQRD and Prisma</a></li>
<li><a href="../303778/index.html">Microservices as architecture: squeeze to the maximum</a></li>
<li><a href="../303780/index.html">What is the secret of speed NodeJS?</a></li>
<li><a href="../303782/index.html">[Go] [JS] And again about processing marc formats</a></li>
<li><a href="../303784/index.html">Do you have any ideas? We have Tabtabus! How was the third IT festival in nature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>