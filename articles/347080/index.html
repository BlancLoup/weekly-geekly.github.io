<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vibrant.kt - rapid prototyping and development of distributed applications (DApps) on JVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nihao! 
 Introduction 


 I haven‚Äôt written anything for a long time, because the Unified State Examination will not surrender itself, but I could not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vibrant.kt - rapid prototyping and development of distributed applications (DApps) on JVM</h1><div class="post__text post__text-html js-mediator-article"><h2 id="nihao">  Nihao! </h2><br><h3 id="vvedenie">  Introduction </h3><br><p>  I haven‚Äôt written anything for a long time, because the Unified State Examination will not surrender itself, but I could not write something cool for the <a href="http://baltkonkurs.ru/">Baltic competition</a> .  I couldn‚Äôt squeeze out good ideas from nowhere, so I decided to plunge into a completely unfamiliar topic at that time (half a month ago), the world of the blockchain, cryptocurrency, smart contracts and other clever English words.  At lessons I stuck to the phone, reading a lot of texts about the blockchain, peer2peer networks and all that, gradually sorting out.  Everything went easier when I started writing simple prototypes in Javascript: once again I am convinced that everything is clearer in the code than in the text.  As a result, when I sort of figured out, I decided on the topic of work, which can be seen in the title of the article. </p><a name="habracut"></a><br><h3 id="chego-eto-voobsche-takoe-i-zachem-nuzhno">  What it is and why it is </h3><br><p>  Vibrant is a library written in Kotlin for rapid prototyping of distributed applications.  The idea is that you can focus on certain aspects of the future system, replacing unrealized code with ready-made solutions.  For example, you have conceived to write a distributed chat. </p><br><p> Immediately there are several points that require implementation: how to provide a connection between peers, what communication protocol to use, and do I need UDP in LAN, if I just try to make a chat, or can do it over TCP, or maybe just HTTP ... In general, there are many primary tasks, without which nothing will work.  And to write a simple chat on a distributed platform, you have to implement a certain amount of functionality.  This problem is solved by Vibrant, consisting of 2 packages, <code>org.vibrant.core</code> - architecture abstraction and <code>org.vibrant.base</code> - various implementations of abstractions from the core package, for example, <code>HTTPPeer</code> , <code>HTTPJsonRPCPeer</code> - classes of peers communicating via http, the first is more abstract, the second uses the JSON RPC 2.0 protocol for communication between nodes. <br>  In general, instead of writing a feast from scratch, take a ready-made JSON RPC feast and use it.  If there is a need to change the protocol or a keen desire to write something of your own - abstraction allows, flag in hand. </p><br><h3 id="i-kak-etim-polzovatsya">  And how to use it? </h3><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Peer</span></span></span></span>(port: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, rpc: BaseJSONRPCProtocol): HTTPJsonRPCPeer(port, rpc){ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> miners = arrayListOf&lt;RemoteNode&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broadcastMiners</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(jsonrpcRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JSONRPCRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;JSONRPCResponse&lt;*&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.broadcast(jsonrpcRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.miners) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addUniqueRemoteNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(remoteNode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RemoteNode</span></span></span></span><span class="hljs-function"><span class="hljs-params">, isMiner: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.addUniqueRemoteNode(remoteNode) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isMiner &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.miners.find { it.address == remoteNode.address &amp;&amp; it.port == remoteNode.port } == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.miners.add(remoteNode) } } }</code> </pre> <br><p>  Here is a simple implementation of <code>HTTPJsonPeer</code> .  According to it, it is impossible to say that it can only if it does not notice the argument of the constructor <code>rpc: BaseJSONRPCProtocol</code> .  If you initialize this class and run, the HTTP server will be launched on the selected port, which accepts <code>POST</code> JSON RPC requests for the <code>/rpc</code> endpoint, transforms them into Kotlin objects and calls the appropriate method in the passed <code>BaseJSONRPCProtocol</code> .  So to speak, plug and play. <br>  Here is an example of methods that can be run via a JSON RPC request: </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@JSONRPCMethod</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JSONRPCRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">, remoteNode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RemoteNode</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: JSONRPCResponse&lt;*&gt;{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JSONRPCResponse( result = node.chain.latestBlock().serialize(), error = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, id = request.id ) } <span class="hljs-meta"><span class="hljs-meta">@JSONRPCMethod</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JSONRPCRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">, remoteNode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RemoteNode</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: JSONRPCResponse&lt;*&gt;{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blockModel = BaseJSONSerializer.deserialize(request.params[<span class="hljs-number"><span class="hljs-number">0</span></span>].toString().toByteArray()) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> BaseBlockModel node.handleLastBlock(blockModel, remoteNode) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JSONRPCResponse( result = node.chain.latestBlock().serialize(), error = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, id = request.id ) }</code> </pre> <br><p>  This is how you can quickly make a feast. <br>  But where is the blockchain ?!  Here he is. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InMemoryBlockChain</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B: BlockModel, out T: BlockChainModel</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BlockChain</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B, T</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blocks = arrayListOf(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createGenesisBlock()) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">latestBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: B = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.blocks.last() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">B</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: B { synchronized(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.blocks, { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.blocks.add(block) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notifyNewBlock() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.latestBlock() }) } }</code> </pre> <br><p>  This is a class from the <code>org.vibrant.base</code> package, by inheriting it you can safely use the blockchain, which exists only in memory.  Such a blockchain is well suited, for example, to test an application. </p><br><p>  It is worth noting that the presence of <code>InMemoryBlockChain</code> does not limit the developer: you can write your <code>InMemoryBlockChain</code> , where h2 database is used instead of arraylist, but this already refers to the item ‚ÄúI don‚Äôt want to steam over the boilerplate, give me a ready boilerplate and the ability to write my code‚Äù. </p><br><h3 id="predzaklyuchenie">  Preliminary conclusion </h3><br><p>  I am actively puffing on this project, there are a lot of things that I would like to add, for example, implement Tangle in the image of <a href="https://iota.org/">Iota</a> , write a quality UDPPeer, using, for example, Netty channels.  Oh yeah, now I'm working on smart contracts, which can also be <code>plug and play</code> .  I think it will be fun. </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  I would be very pleased with the enthusiasm of readers in the form of pull requests. <br>  Links to github: <br>  <a href="https://github.com/vibrantkt/core">Core abstraction package</a> <br>  <a href="https://github.com/vibrantkt/base">Base package with implementations</a> <br>  <a href="https://github.com/vibrantkt/chat-example">Work Chat Application</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/347080/">https://habr.com/ru/post/347080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347064/index.html">Creating a REST API on Falcon</a></li>
<li><a href="../347066/index.html">How can a beginner participate in open source development?</a></li>
<li><a href="../347068/index.html">Beta test section for beta testers Habra and Hiktayms</a></li>
<li><a href="../347072/index.html">Flussonic Agent - firmware for cameras</a></li>
<li><a href="../347078/index.html">Kali Linux on Windows</a></li>
<li><a href="../347082/index.html">Why was everything so slow ?! We select iron for development on Unity</a></li>
<li><a href="../347084/index.html">Do I need to try to love math?</a></li>
<li><a href="../347086/index.html">Calculation snuffled modern rocket engines</a></li>
<li><a href="../347088/index.html">Information security models in the work of Windows VPS</a></li>
<li><a href="../347090/index.html">Scale blockchain while maintaining decentralization with Fairlayer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>