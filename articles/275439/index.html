<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with Arduino from a C # application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to talk about how you can read data and control an Arduino card connected via a USB port, from a .Net application, and f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with Arduino from a C # application</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/f6e/38b/409/f6e38b409f82458dac772d094fc991d3.png"></div><br>  In this article, I would like to talk about how you can read data and control an Arduino card connected via a USB port, from a .Net application, and from a UWP application. <br><br>  You can do this without using third-party libraries.  In fact, using only virtual COM port. <br><a name="habracut"></a><br>  Let's write a sketch for Arduino first.  We will send to the port a line with text containing the value of a variable, which we will have will constantly change in the loop (thus simulating data taken from the sensor).  We will also read data from the port and if we receive the text ‚Äú1‚Äù, then we will turn on the built-in LED.  It is located on the 13th pin and is marked on the board with the Latin letter L. And if we get ‚Äú0‚Äù, then turn it off. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       int led = 13; void setup() { Serial.begin(9600); //     pinMode(led, OUTPUT); //    13-      } void loop() { i = i + 1; //        String stringOne = "Info from Arduino "; stringOne += i; //  Serial.println(stringOne); //     char incomingChar; if (Serial.available() &gt; 0) { //        incomingChar = Serial.read(); //         LED switch (incomingChar) { case '1': digitalWrite(led, HIGH); break; case '0': digitalWrite(led, LOW); break; } } delay(300); }</span></span></code> </pre> <br><h4>  WPF application </h4><br>  Now create a WPF application.  The markup is pretty simple.  2 buttons and a label to display the text received from the port is all that is needed: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lblPortData"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0,20,0,0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnOne"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnOne_Click"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0,10,0,0"</span></span></span><span class="hljs-tag">&gt;</span></span> 1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnZero"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btnZero_Click"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0,10,0,0"</span></span></span><span class="hljs-tag">&gt;</span></span> 0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Add 2 namespaces: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Timers; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO.Ports;</code> </pre><br>  And in the scope of class 2 variables with a delegate: <br><br><pre> <code class="cs hljs">System.Timers.Timer aTimer; SerialPort currentPort; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDelegate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> txt</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  Implement the Window_Loaded event.  In it, we will go through all available ports, listen to them and check whether the port displays a message with the text ‚ÄúInfo from Arduino‚Äù.  If we find the port sending such a message, it means we have found the Arduino port.  In this case, you can set its parameters, open the port and start the timer. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ArduinoPortFound = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] ports = SerialPort.GetPortNames(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ports) { currentPort = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SerialPort(port, <span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArduinoDetected()) { ArduinoPortFound = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ArduinoPortFound = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArduinoPortFound == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; System.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   currentPort.BaudRate = 9600; currentPort.DtrEnable = true; currentPort.ReadTimeout= 1000; try { currentPort.Open(); } catch { } aTimer = new System.Timers.Timer(1000); aTimer.Elapsed += OnTimedEvent; aTimer.AutoReset = true; aTimer.Enabled = true;</span></span></code> </pre><br>  To remove data from the port and compare it with the data I was looking for, I used the ArduinoDetected function: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ArduinoDetected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { currentPort.Open(); System.Threading.Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,  SerialPort    string returnMessage = currentPort.ReadLine(); currentPort.Close(); //   void loop()     Serial.println("Info from Arduino"); if (returnMessage.Contains("Info from Arduino")) { return true; } else { return false; } } catch (Exception e) { return false; } }</span></span></code> </pre><br>  Now it remains to implement the event handling timer.  The OnTimedEvent method can be generated using Intellisense.  Its contents will be as follows: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTimedEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, ElapsedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!currentPort.IsOpen) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-comment"><span class="hljs-comment">//                { //     currentPort.DiscardInBuffer(); //    string strFromPort = currentPort.ReadLine(); lblPortData.Dispatcher.BeginInvoke(new updateDelegate(updateTextBox), strFromPort); } catch { } } private void updateTextBox(string txt) { lblPortData.Content = txt; }</span></span></code> </pre><br>  We read the value from the port and output it as label text.  But since the timer works in a thread other than the UI thread, we need to use Dispatcher.BeginInvoke.  This is where the delegate declared at the beginning of the code came in handy. <br><br>  After finishing work with the port it is very desirable to close it.  But since we work with it constantly, while the application is open, it is logical to close it when closing the application.  Add a Closing event to our window: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Window_Closing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { aTimer.Enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; currentPort.Close(); }</code> </pre><br>  Is done.  Now it remains to send a message to the port with the text ‚Äú1‚Äù or ‚Äú0‚Äù, depending on the button click and you can test the operation of the application.  It's simple: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnOne_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!currentPort.IsOpen) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; currentPort.Write(<span class="hljs-string"><span class="hljs-string">"1"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnZero_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!currentPort.IsOpen) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; currentPort.Write(<span class="hljs-string"><span class="hljs-string">"0"</span></span>); }</code> </pre><br>  The resulting example is available on <a href="https://github.com/programmersommer/Arduino_WPF_App">GitHub</a> . <br><br>  By the way, WinForms application is created even faster and easier.  It is enough to drag the SerialPort element onto the form from the toolbar (if you wish, you can drag the Timer element from the toolbar).  After that, in the right place of the code, you can open the port, read data from it and write to it in approximately the same way as in a WPF application. <br><br><h4>  UWP application </h4><br>  In order to understand how to work with a serial port, I looked at the following example: <a href="https://github.com/ms-iot/samples/tree/develop/SerialSample/">SerialSample</a> <br>  To allow working with a COM port in the application manifest there should be the following declaration: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capabilities</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"internetClient"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"serialcommunication"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"any"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name:serialPort"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Device</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeviceCapability</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Capabilities</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In C # code, we will need 4 namespaces: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Devices.SerialCommunication; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Devices.Enumeration; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.Storage.Streams; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks;</code> </pre><br>  And one variable in the class scope: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> deviceId;</code> </pre><br>  When loading, we consider in it the port id value to which the Arduino board is connected: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Page_Loaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filt = SerialDevice.GetDeviceSelector(<span class="hljs-string"><span class="hljs-string">"COM3"</span></span>); DeviceInformationCollection devices = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DeviceInformation.FindAllAsync(filt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (devices.Any()) { deviceId = devices.First().Id; } }</code> </pre><br>  The following Task counts 64 bytes from the port and displays the text in the field named txtPortData <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Listen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SerialDevice serialPort = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SerialDevice.FromIdAsync(deviceId)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serialPort != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { serialPort.ReadTimeout = TimeSpan.FromMilliseconds(<span class="hljs-number"><span class="hljs-number">1000</span></span>); serialPort.BaudRate = <span class="hljs-number"><span class="hljs-number">9600</span></span>; serialPort.Parity = SerialParity.None; serialPort.StopBits = SerialStopBitCount.One; serialPort.DataBits = <span class="hljs-number"><span class="hljs-number">8</span></span>; serialPort.Handshake = SerialHandshake.None; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (DataReader dataReaderObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataReader(serialPort.InputStream)) { Task&lt;UInt32&gt; loadAsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> ReadBufferLength = <span class="hljs-number"><span class="hljs-number">64</span></span>; dataReaderObject.InputStreamOptions = InputStreamOptions.Partial; loadAsyncTask = dataReaderObject.LoadAsync(ReadBufferLength).AsTask(); UInt32 bytesRead = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> loadAsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytesRead &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { txtPortData.Text = dataReaderObject.ReadString(bytesRead); txtStatus.Text = <span class="hljs-string"><span class="hljs-string">"Read operation completed"</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { txtStatus.Text = ex.Message; } } } }</code> </pre><br>  In UWP applications in C #, there is no SerialPort.DiscardInBuffer method.  Therefore, one of the options is to read the data each time opening the port again, which was demonstrated in this case.  If you try, you can see that the countdown comes from one unit each time.  Approximately the same thing happens in the Arduino IDE when you open the Serial Monitor.  Option, of course, so-so.  To open a port every time is not the case, but if data is rarely to be read, this method will come down.  In addition, the recorded example is thus shorter and clearer. <br><br>  The recommended option is not to announce the port every time, but to announce it once, for example, when loading.  But in this case, it will be necessary to regularly read the data from the port so that it does not fill up with the old one and the data would be relevant.  See how this is done in <a href="https://github.com/programmersommer/Arduino_UWP_App">my example UWP application</a> .  I suppose that the concept of the inability to clear the buffer is that constantly asynchronously taking off data does not really load the system.  As soon as the required number of bytes is read into the buffer, the code written next is executed.  There is a plus, that with such constant monitoring you will not miss anything, but some (including me) lack the usual opportunity to ‚Äúread‚Äù the data once. <br><br>  You can use similar code to write data to the port: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendToPort</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sometext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (SerialDevice serialPort = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SerialDevice.FromIdAsync(deviceId)) { Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>).Wait(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((serialPort != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) &amp;&amp; (sometext.Length != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { serialPort.WriteTimeout = TimeSpan.FromMilliseconds(<span class="hljs-number"><span class="hljs-number">1000</span></span>); serialPort.ReadTimeout = TimeSpan.FromMilliseconds(<span class="hljs-number"><span class="hljs-number">1000</span></span>); serialPort.BaudRate = <span class="hljs-number"><span class="hljs-number">9600</span></span>; serialPort.Parity = SerialParity.None; serialPort.StopBits = SerialStopBitCount.One; serialPort.DataBits = <span class="hljs-number"><span class="hljs-number">8</span></span>; serialPort.Handshake = SerialHandshake.None; Task.Delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>).Wait(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (DataWriter dataWriteObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataWriter(serialPort.OutputStream)) { Task&lt;UInt32&gt; storeAsyncTask; dataWriteObject.WriteString(sometext); storeAsyncTask = dataWriteObject.StoreAsync().AsTask(); UInt32 bytesWritten = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> storeAsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytesWritten &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { txtStatus.Text = bytesWritten + <span class="hljs-string"><span class="hljs-string">" bytes written"</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { txtStatus.Text = ex.Message; } } } }</code> </pre><br>  You may notice that after the initialization of the port and the installation of parameters, pauses were added for 1 second.  Without these pauses, it was impossible to force Arduino to react.  It seems that the serial port really does not tolerate fuss.  Again, I remind you that it is better to open the port once, and not to open / close it constantly.  In this case, no pause is needed. <br>  A simplified version of the UWP application, which is similar to the WPF .Net application discussed above, is available on <a href="https://github.com/programmersommer/Arduino_UWP_App">GitHub</a> <br><br>  As a result, I came to the conclusion that working in UWP with Arduino directly through a <a href="http://www.ftdichip.com/Drivers/VCP.htm">virtual COM port,</a> although unusual, is quite possible without connecting third-party libraries. <br>  I note that Microsoft is working quite closely with Arduino, so there are many different libraries and communication technologies that simplify development.  The most popular, of course, is the <a href="http://habrahabr.ru/company/microsoft/blog/262419/">Windows Remote Arduino</a> library that works with the Firmata protocol. </div><p>Source: <a href="https://habr.com/ru/post/275439/">https://habr.com/ru/post/275439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275425/index.html">DevTips: Web Developer Tips (33-48)</a></li>
<li><a href="../275427/index.html">Pro trackpoint and mouse emulation</a></li>
<li><a href="../275429/index.html">Counterfeiters vs. Bankers: Bleed adversarial networks in Theano</a></li>
<li><a href="../275431/index.html">Hibernate envers. Substitution ID of the user who made the change</a></li>
<li><a href="../275435/index.html">Redux Tutorial from Library Creator</a></li>
<li><a href="../275441/index.html">Experience installing SolidWorks on a Windows 7 virtual machine on a Ubuntu host OS</a></li>
<li><a href="../275443/index.html">LastPass users are vulnerable to the simplest phishing attack in Chrome</a></li>
<li><a href="../275445/index.html">Comparison of programming languages ‚Äã‚Äãand frameworks for them</a></li>
<li><a href="../275447/index.html">Cross-platform Open Source Time Tracker</a></li>
<li><a href="../275449/index.html">Symantec Backup Exec: Backup Oracle installed on Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>