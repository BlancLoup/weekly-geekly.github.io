<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of the Russian-speaking "analog" of Siri in 7 days</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the release of the iPhone 4S with Siri "on board", the owners of the remaining Apple gadgets felt a little deprived. Even in its new iPad, Apple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of the Russian-speaking "analog" of Siri in 7 days</h1><div class="post__text post__text-html js-mediator-article">  After the release of the iPhone 4S with Siri "on board", the owners of the remaining Apple gadgets felt a little deprived.  Even in its new iPad, Apple did not include Siri.  Developers around the world have attempted to port Siri to other devices or write similar analogues.  And only the Russian-speaking App Store kept silence.  Probably all the developers are very busy, I thought, and decided to fix this unfortunate misunderstanding ... <a name="habracut"></a><br><br><h2>  DISCLAIMER: </h2><br>  1. The word "analog" is not in vain put in quotes.  My application is not a bit of an analogue of Siri, but an amateur hack.  I understand perfectly well that to create something really similar to Siri, you need huge resources and a lot of money. <br>  2. Yes, I know that Apple explains that it does not support other iPhones, because of some special noise-canceling chip built into 4S.  But I do not strongly believe in it, most likely their servers do not withstand the load from 4S.  And if you connect all Apple gadgets to Siri, the servers will simply collapse. <br>  3. The application was created as Just for fun and did not pursue any practical purposes.  And besides this, the main work was also worked out. <br><br><h2>  Why in 7 days? </h2><br>  I initially decided not to spend a lot of time on this project for several reasons.  First of all, I read many articles where it was written that Apple does not miss programs like Siri in the App Store.  Moreover, trying to remove from the App Store existing ones, such as Evi.  Therefore, there is a high probability that they will not miss my program either.  As the way it happened, with a client for rutracker.org written by me.  I sent the application 4 times for a review, corrected everything the censors told me, but the app did not get into the App Store (I then spat on this case and laid out the cut-down version at w3bsit3-dns.com, not to lose work).  Secondly, I naturally don‚Äôt have the resources to write a full-fledged program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Day 1st.  Design </h2><br>  At first I thought out the very logic of the application.  Naturally, all text to speech and speech to text conversions should be performed on the server.  And the application itself is just an interface.  In this case, the solution will work even on the weakest devices, as well as possess cross-platform.  For portability on Android and Windows Phone, you only need to write an interface to these platforms. <br><br>  Thus, the application logic is as follows: <br>  A) we record the speech of the interlocutor and transmit to the server for recognition; <br>  B) we get the recognized string from the server, and carry out easy initial processing.  These are answers to the most frequent questions, we cut off the mats and curses, intercept the words to search in Yandex and search for the weather forecast.  Other commands like send SMS or check mail, I decided not to build in yet because of the fear of not going through the revue; <br>  B) send the filtered string to your server for recognition.  And we get the answer line with the answer; <br>  D) we send the answer to the server for conversion to speech, we get a link to the mp3 stream and reproduce the answer; <br><br>  Yes, it turns out slowly, but so far there is no other option but to combine all this on one of its servers.  But this is a completely different order of costs: a dedicated powerful server, most likely not one;  purchase and licensing of speech recognition engine text-to-speech, etc. So let's stop, while on this logic. <br><br><h2>  Second day.  Search engine </h2><br>  I am looking for engines.  This was not a small problem.  Firstly, most of them are paid and not a little from $ 50 per 1000 words, secondly a very small amount recognizes Russian speech, in the third the quality of those that Russian recognizes is just awful. <br><br>  I stopped at the engine ispeech.org.  Firstly, it allows you to do two transformations of ‚Äúspeech to text‚Äù and ‚Äútext to speech‚Äù at once.  Secondly, it has an SDK for the iPhone, and when using this SDK, a free key is issued and recognition is free.  Naturally, for the "balls" had something to sacrifice.  He disgustingly recognizes Russian cities.  According to this, it is not realistic to know the weather forecast in some difficult-to-pronounce city.  In Moscow, no problem. <br><br>  I study its API.  I settled on the JSON format.  I transmit to the server a key, the language to be recognized, service fields such as the format of the audio file and the speech itself, encoded in the base64encode, .wave file.  I get the answer, also in the format JSON, error, if an error.  And a line of text and recognition accuracy, if success. <br>  Similarly, the inverse transform is done.  I send to the server a line for pronunciation, language, and service fields and get back an mp3 stream that I reproduce. <br><br><h2>  Day 3rd.  I'm starting to write an application.  Design </h2><br>  I try to get something similar to Siri, but did not repeat exactly, otherwise the censors will hack. <br>  That's what happened. <br><img src="https://habrastorage.org/storage2/893/237/4b3/8932374b3a7473de16715e8fe0b95969.jpg"><br>  Well, I'm not a designer at all.  Day wasted. <br><br><h2>  Day four.  I am writing application logic </h2><br>  Nothing complicated ordinary http POST requests.  I build in API.  First testing.  Hooray!!!  It works, but not very fast.  When WI FI is normal, although slower than this Siri.  With 3G, it slows down.  With GPRS just torture, and the answer can not wait.  I understood the reason quickly.  The wave file compressed with the ULAW codec is transmitted to the server, the sampling rate is 44 kHz.  The file turns out huge, it is necessary to press as for a voice on 8 KHz.  Something does not work out.  I mark myself that there is a problem, I score on it and move on.  Filter mats and curses. <br><img src="https://habrastorage.org/storage2/80b/87a/3ca/80b87a3ca21f30609bc6990bb704648e.jpg"><br><br><h2>  Day 5th.  Integrating search in Yandex and weather.  Sending to the App Store </h2><br>  I select key fields like ‚Äúsearch‚Äù, ‚Äúsearch‚Äù, ‚Äúfind‚Äù, ‚Äúweather‚Äù, etc.  We have to ask for reliability what exactly we are looking for and in which city the weather forecast is needed.  It seems to work out.  It turns out that cities are understood poorly.  So much work is lost, but decided not to throw out this feature, suddenly the engine will eventually learn to better understand the city.  I'm testing again and again and again.  The result pleased.  I spread the application in the App Store, let him wait for a review while I write my server. <br><img src="https://habrastorage.org/storage2/bc8/65c/467/bc865c467c469f24ad3dbb2ae00f7e6a.jpg"><img src="https://habrastorage.org/storage2/c9b/4d8/004/c9b4d8004d38666d4eea249ecaac4fd4.jpg"><br><br><h2>  Day 6th.  Linguistics and speech analysis.  Server writing </h2><br>  I study the literature on artificial intelligence and speech analysis.  Quietly fucking.  I master the basics.  So far I decide not to bother with artificial intelligence, but simply to disassemble the application into phrases, make a simple analysis, highlight keywords and search them in the database for them. <br>  I throw a brief idea in which direction to go.  It means that I am compiling a knowledge base, by searching, I compare the keywords selected from the sentence with the base and give the record that most closely matches the question. <br>  I find dictionaries for interlocutors in open sources, of course, their quality is not enough and it will be necessary to refine.  But for the start of the fit. <br><br>  I am writing a non-complex PHP program for finding answers on my server.  In order that the server was not accessed by outsiders and did not drop it, provided for the phone to send a token that is hard-wired in the application.  While on the authorization I decided not to bother much. <br>  I also decided not to transfer the phone coordinates to the GPS server, although I like the idea itself.  Knowing the coordinates of the phone, you can use the API of any weather server to issue a weather forecast.  You can also use the coordinates of the phone to find the nearest bars, cafes, shops.  But again, you need a resource with a normal API, to which you sent a request and coordinates and got a clear answer.  I wrote down this idea and put it off until later if I would write a new version of the application. <br><br>  All the questions asked, and the answers to them are recorded in the database, by the way, the phone‚Äôs UDID [IMEI] too.  Yes, yes, ‚ÄúBig Brother‚Äù is watching you (joke).  In fact, it is necessary for the development of the program.  Knowing the questions that are asked, I can quickly fill up the knowledge base and catch the glitches of the program.  UDID is needed for further development.  I plan that the program remembers the previous questions, so I use the UDID to identify the phone.  Knowing the previous questions, you can make the behavior of the application even more intelligent.  Interestingly, Siri takes into account previous questions when building a dialogue? <br>  When searching for answers in the knowledge base, the full-text search MATCH-AGAINST is used.  Normal SQL queries, nothing special. <br><br><h2>  Seventh day.  Today </h2><br>  Tested how knowledge base search works.  I was pleased.  I sat down to write an article on Habr, and my 12-year-old son expressed a desire to teach the knowledge base. <br>  He found information on the Internet, which questions are most often asked by Siri, and I laughed for a long time.  At the moment I am writing this article, and he is putting his understanding of this world "in the head" of the car.  That "VKontakte" is better than "Classmates" and more.  I, of course, then check everything that he entered into the database there. <br><img src="https://habrastorage.org/storage2/d8d/977/dc9/d8d977dc94837b45aca23cdc4561e8b9.jpg"><img src="https://habrastorage.org/storage2/1d9/d46/9aa/1d9d469aa496da97bf4cdb9e3bfa84a5.jpg"><br><br>
<h2>  Total </h2><br>  <b>What happened.</b> <br>  For seven days, it‚Äôs quite realistic to write the simplest virtual interlocutor who will be able to support the conversation and answer some questions.  Of course, up to Siri is like a moon, but like a little entertainment, it is quite suitable.  It is in the category of "Entertainment", if the censors miss the application, it will fall. <br>  You can easily port to Android and Widows Phone. <br><br>  <b>The disadvantages of the program.</b> <br>  1. Long sending of speech to the server due to the wave format. <br>  <i>I plan to reduce the sampling rate to 8 kHz, but I don‚Äôt know how yet.</i> <i><br></i> <br>  2. Not very good speech recognition, especially Russian cities, engine recognition. <br>  <i>Maybe I will use the Google engine, he speaks better.</i>  <i>But for him you need to recode speech in FLAC format, which I don‚Äôt know yet how to do it either.</i>  <i>We must look for the appropriate library.</i>  <i>And, of course, the question remains of the licensed purity of such a path</i> . <br><br>  3. Runs slower than Siri. <br>  <i>This is solved only by purchasing the speech recognition engine and installing it on your dedicated server.</i>  <i>I'm not sure that I will follow this path, it is very expensive.</i> <br><br>  4. Not much of what Siri can. <br>  <i>Well, this problem is solved by the release of updates and the development of a knowledge base.</i>  <i>This is just a matter of time and funds allocated for it.</i> <br><br>  If I missed some moments, I am ready to answer in the comments. <br><br>  <b>UPD:</b> At the request of Habrazhiteley and in order to avoid omissions added video. <br>  <a href="http://www.youtube.com/watch%3Fv%3DUzFGgH741Cw">www.youtube.com/watch?v=UzFGgH741Cw</a> <br><br>  <b>UPD2:</b> Added another video. <br>  <a href="http://www.youtube.com/watch%3Fv%3DLVlllVSyln8">www.youtube.com/watch?v=LVlllVSyln8</a> <br><br>  <b>UPD3: Predreliznaya version here</b> <br>  <a href="http://www.youtube.com/watch%3Fv%3DJlkJva-TGfY">www.youtube.com/watch?v=JlkJva-TGfY</a> </div><p>Source: <a href="https://habr.com/ru/post/140206/">https://habr.com/ru/post/140206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140197/index.html">The thorny way to monetize projects on the Internet</a></li>
<li><a href="../140199/index.html">Google is developing a new punishment system for overly optimized sites.</a></li>
<li><a href="../140202/index.html">Neo Geo X has become a reality. True dear reality</a></li>
<li><a href="../140204/index.html">Registration for Lingvo Cup 2012 is open.</a></li>
<li><a href="../140205/index.html">Sir Jonathan Ive: the man on stage</a></li>
<li><a href="../140207/index.html">Adding rules to IPFW via web interface</a></li>
<li><a href="../140208/index.html">Scalaxi - failure in work</a></li>
<li><a href="../140209/index.html">Microsoft Augmented Reality Conference in Kiev</a></li>
<li><a href="../140211/index.html">Part number 4. Biochemistry on folding. How to evaluate the course of folding of single-stranded RNA?</a></li>
<li><a href="../140212/index.html">Search Quality in Runet - 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>