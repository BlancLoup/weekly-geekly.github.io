<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NoSQL database: we understand the essence</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, the term ‚ÄúNoSQL‚Äù has become very fashionable and popular, all sorts of software solutions under this sign are being actively developed and p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NoSQL database: we understand the essence</h1><div class="post__text post__text-html js-mediator-article">  Recently, the term ‚ÄúNoSQL‚Äù has become very fashionable and popular, all sorts of software solutions under this sign are being actively developed and promoted.  Huge amounts of data, linear scalability, clusters, fault tolerance, and non-relationality have become synonymous with NoSQL.  However, few people have a clear understanding of what NoSQL storage is, how this term appeared and what general characteristics they possess.  Let's try to eliminate this gap. <br><img src="https://habrastorage.org/storage2/1a6/441/f7a/1a6441f7aa9756acdfc97be0492d5387.jpg"><br><br><a name="habracut"></a><br><h4>  Story. </h4><br>  The most interesting thing about the term is that despite the fact that it was first used in the late 90s, it acquired real meaning as it is used now only in mid-2009. Initially, this was the open source database created by Carlo Strozzi, which kept All data is as ASCII files and used shell scripts instead of SQL to access data.  With ‚ÄúNoSQL‚Äù in its current form, it had nothing in common. <br><br>  In June 2009, a meeting was organized by Johan Oscarsson in San Francisco, at which it was planned to discuss new developments in the IT data storage and processing market.  The main impetus for the meeting were new open-source products like BigTable and Dynamo.  For a bright signboard for a meeting it was required to find a succinct and concise term that would fit perfectly into the Twitter hashtag.  One of these terms was suggested by Eric Evans from RackSpace - ‚ÄúNoSQL‚Äù.  The term was planned only for one meeting and did not have a deep semantic load, but it so happened that it spread throughout the global network like viral advertising and became the de facto name of a whole trend in the IT industry.  By the way, Voldemort (clone of Amazon Dynamo), Cassandra, Hbase (analogs of Google BigTable), Hypertable, CouchDB, MongoDB spoke at the conference. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is worth emphasizing once again that the term ‚ÄúNoSQL‚Äù has an absolutely natural origin and does not have a generally accepted definition or scientific institution behind it.  This name rather characterizes the vector of IT development away from relational databases.  It stands for Not Only SQL, although there are proponents for the direct definition of No SQL.  To group and systematize knowledge about the NoSQL world, Pramod Sadaladzh and Martin Fowler tried to do in their recent book <a href="http://www.amazon.com/NoSQL-Distilled-Emerging-Persistence-ebook/dp/B0090J3SYW">‚ÄúNoSQL Distilled‚Äù</a> . <br><br><h4>  NoSQL database features </h4><br>  There are few common characteristics for all NoSQL, as there are now a lot of heterogeneous systems under the NoSQL label (the most complete, perhaps, list can be found at <a href="http://nosql-database.org/">http://nosql-database.org/</a> ).  Many characteristics are peculiar only to certain NoSQL databases, I will definitely mention this when listing. <br><br>  <b>1. Not using SQL</b> <br><br>  This refers to ANSI SQL DML, since many databases try to use query languages ‚Äã‚Äãsimilar to the well-known favorite syntax, but no one has been able to fully implement it and is unlikely to succeed.  Although there are rumors there are startups that are trying to implement SQL, for example, in Hadup ( <a href="http://www.drawntoscalehq.com/">http://www.drawntoscalehq.com/</a> and <a href="http://www.hadapt.com/">http://www.hadapt.com/</a> ) <br><br>  <b>2. Unstructured (schemaless)</b> <br><br>  The meaning is that in NoSQL databases, unlike the relational data structure, it is not regulated (or weakly typed, if analogous to the programming languages ‚Äã‚Äãare used) - an arbitrary field can be added to a single line or document without preliminary declarative changes in the structure of the entire table.  Thus, if there is a need to change the data model, then the only sufficient action is to reflect the change in the application code. <br><br>  For example, when renaming a field in MongoDB: <br><br><pre><code class="java hljs">BasicDBObject order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicDBObject(); order.put(‚Äúdate‚Äù, orderDate); <span class="hljs-comment"><span class="hljs-comment">//     order.put(‚ÄútotalSum‚Äù, total); //     ‚Äúsum‚Äù</span></span></code> </pre> <br>  If we change the application logic, then we expect a new field also when reading.  But due to the lack of a data scheme, the totalSum field is absent from other already existing Order objects.  In this situation, there are two options for further action.  The first is to bypass all documents and update this field in all existing documents.  Due to the volume of data, this process occurs without any locks (comparable to the alter table rename column), so during the update, existing data can be read by other processes.  Therefore, the second option - checking in the application code - is inevitable: <br><br><pre> <code class="java hljs">BasicDBObject order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicDBObject(); Double totalSum = order.getDouble(‚Äúsum‚Äù); <span class="hljs-comment"><span class="hljs-comment">//    if (totalSum == null) totalSum = order.getDouble(‚ÄútotalSum‚Äù); //   </span></span></code> </pre><br><br>  And when re-recording, we will write this field to the database in a new format. <br><br>  A pleasant consequence of the lack of a scheme is the efficiency of working with sparse data.  If there is a date_published field in one document, and no field in the second, then no empty date_published field will be created for the second.  This is, in principle, a logical, but less obvious example - column-family NoSQL databases that use familiar table / column concepts.  However, due to the absence of a schema, columns are not declared declaratively and may change / be added during the user session of working with the database.  This allows in particular the use of dynamic columns for the implementation of lists. <br><br>  An unstructured scheme has its drawbacks - besides the above-mentioned overhead in the application code when changing the data model - the absence of all possible restrictions from the base (not null, unique, check constraint, etc.), plus additional difficulties in understanding and controlling the structure data when working in parallel with a database of different projects (there are no dictionaries on the side of the database).  However, in a rapidly changing modern world, such flexibility is still an advantage.  As an example, Twitter, which five years ago, along with Twitter, kept only a few additional information (time, Twitter handle and a few bytes of meta-information), but now in addition to the message itself, the database still stores a few kilobytes of metadata. <br><br>  <i>(Hereinafter, it‚Äôs mainly about key-value, document and column-family databases, the database graph may not have these properties).</i> <br><br>  <b>3. Presentation of data in the form of aggregates (aggregates).</b> <br><br>  Unlike the relational model, which stores the logical business entity of the application in different physical tables for normalization purposes, NoSQL repository operates with these entities as whole objects: <br><br><img src="https://habrastorage.org/storage2/c1b/6c1/77c/c1b6c177c5a955b626b253af0be9cc18.jpg"><br><br>  This example shows the aggregates for the standard conceptual relational model of e-commerce ‚Äúorder - order items - payments - product‚Äù.  In both cases, an order is combined with positions into one logical object, with each position keeping a link to the product and some of its attributes, for example, a name (such denormalization is necessary not to request the product object when retrieving an order - the main rule of distributed systems is minimum ‚ÄúJoins‚Äù between objects).  In one unit, payments are combined with the order and are an integral part of the object, in the other - they are moved to a separate object.  This demonstrates the main rule for designing a data structure in NoSQL databases - it must comply with the requirements of the application and be as optimized as possible for the most frequent queries.  If payments are regularly extracted along with the order, it makes sense to include them in a common object, if many requests work only with payments, then it is better to take them into a separate entity. <br><br>  Many will argue, noting that working with large, often denormalized, objects is fraught with numerous problems when trying to randomly query data, when queries do not fit into the structure of aggregates.  What if we use orders along with positions and payments on an order (this is how the application works), but the business asks us to calculate how many units of a certain product were sold last month?  In this case, instead of scanning the OrderItem table (in the case of the relational model), we will have to retrieve orders entirely in the NoSQL repository, although we will not need most of this information.  Unfortunately, this is a compromise that has to be made in a distributed system: we cannot perform data normalization as in a conventional single-server system, since this will create the need to merge data from different nodes and can lead to a significant slowdown in the operation of the database. <br>  I tried to group the pros and cons of both approaches in the table: <br><br><img src="https://habrastorage.org/storage2/3b8/10d/1f7/3b810d1f77e69c0399afbbff49f88dd6.jpg"><br><br>  <b>4. Weak ACID properties.</b> <br><br>  For a long time, the consistency (consistency) of the data was a ‚Äúsacred cow‚Äù for architects and developers.  All relational databases provided one or another level of isolation, either by locking with a change and blocking read, or by undo-logs.  With the arrival of huge amounts of information and distributed systems, it became clear that to ensure for them the transactionality of a set of operations on the one hand and to get high availability and fast response time on the other is impossible.  Moreover, even updating one record does not guarantee that any other user will instantly see changes in the system, because the change may occur, for example, in the master node, and the replica will be asynchronously copied to the slave node, from which another user works.  In this case, he will see the result after a certain period of time.  This is called eventual consistency, and this is what all the major Internet companies in the world are now doing, including Facebook and Amazon.  The latter proudly declare that the maximum interval during which the user can see inconsistent data is no more than a second.  An example of such a situation is shown in the figure: <br><br><img src="https://habrastorage.org/storage2/4e2/a90/8f5/4e2a908f5137a075e9ad97a559f98bdb.jpg"><br><br>  The logical question that arises in such a situation is what should be done to systems that classically place high demands on the atomicity-consistency of operations and at the same time need fast distributed clusters ‚Äî financial, online shopping, etc.?  Practice shows that these requirements have long been irrelevant: one developer of the financial banking system said: ‚ÄúIf we really waited for the completion of each transaction in the global ATM network (ATMs), the transactions would take so long that customers would run away in a rage.  What happens if you and your partner withdraw money at the same time and exceed the limit?  ‚ÄúYou both get the money, and we will fix it later.‚Äù Another example is the hotel booking shown in the picture.  Online stores, whose data management policy implies eventual consistency, are required to take measures in case of such situations (automatic conflict resolution, rollback of an operation, updating with other data).  In practice, hotels always try to keep a ‚Äúpool‚Äù of available rooms for an emergency and this can be a solution to a dispute. <br><br>  In fact, weak ACID properties do not mean that they do not exist at all.  In most cases, an application working with a relational database uses a transaction to change logically related objects (order ‚Äî order items), which is necessary, as these are different tables.  With proper design of the data model in the NoSQL database (the aggregate is an order along with a list of items of the order), you can achieve the same isolation level when changing one record as in the relational database. <br><br>  <b>5. Distributed systems, without shared resources (share nothing).</b> <br><br>  Again, this does not apply to database graphs whose structure, by definition, does not spread well across remote nodes. <br><br>  This is probably the main leitmotif of the development of NoSQL databases.  With the avalanche-like growth of information in the world and the need to process it in a reasonable time, the problem of vertical scalability arose - the growth of processor speed stopped at 3.5 GHz, the speed of reading from the disk also grows at a slow pace, plus the price of a powerful server is always greater than the total price of several simple servers.  In this situation, ordinary relational databases, even clustered on a disk array, cannot solve the problem of speed, scalability, and bandwidth.  The only way out is horizontal scaling, when several independent servers are connected by a fast network and each owns / processes only part of the data and / or only part of read-update requests.  In such an architecture, in order to increase the storage capacity (capacity, response time, bandwidth) it is only necessary to add a new server to the cluster - that's all.  Sharding, replication, fault tolerance procedures (the result will be obtained even if one or several servers stopped responding), data redistribution in the case of adding a node is handled by the NoSQL database itself.  Briefly present the main properties of distributed NoSQL databases: <br><br>  <b>Replication</b> - copying data to other nodes when updating.  Allows both to achieve greater scalability, and to increase the availability and security of data.  It is accepted to divide into two types: <br>  <i>master-slave</i> : <br><br><img src="https://habrastorage.org/storage2/fe3/70f/649/fe370f6495f0fccdeb9fe7ac303b2fc9.jpg"><br><br>  and <i>peer-to-peer</i> : <br><br><img src="https://habrastorage.org/storage2/7ce/408/bb3/7ce408bb336eb974a0bc50db54f5a4a5.jpg"><br><br>  The first type assumes a good read scalability (can occur from any node), but an unscaled record (only to the master node).  There are also subtleties with the provision of constant availability (in case of a master crash, either one of the remaining nodes is assigned either manually or automatically to its place).  For the second type of replication, it is assumed that all nodes are equal and can serve both read and write requests. <br><br>  <b>Sharding</b> - separation of data by node: <br><br><img src="https://habrastorage.org/storage2/eb0/9e9/f4f/eb09e9f4f1078009884c16a7bcd74399.jpg"><br><br>  Sharding was often used as a ‚Äúcrutch‚Äù to relational databases in order to increase speed and throughput: a user application partitioned data from several independent databases and, when requesting relevant data, the user accessed a specific database.  In NoSQL databases, sharding, like replication, is performed automatically by the base itself and the user application apart from these complex mechanisms. <br><br>  <b>6. NoSQL bases are mainly open source and created in the 21st century.</b> <br><br>  It is on the second sign that Sadaladzh and Fowler did not classify object databases as NoSQL (although <a href="http://nosql-database.org/">http://nosql-database.org/</a> includes them in the general list), since they were created in the 90s and did not get much popularity . <br><br>  Additionally, I wanted to dwell on the classification of NoSQL databases, but perhaps I‚Äôll do this in the next article if it is interesting for habouriors. <br><br><h4>  Summary. </h4><br>  NoSQL movement is gaining popularity at a tremendous pace.  However, this does not mean that relational databases become a rudiment or something archaic.  Most likely, they will be used and used as before, but more and more NoSQL bases will appear in symbiosis with them.  We are entering the era of polyglot persistence ‚Äî an era when different data warehouses are used for different needs.  Now there is no monopoly of relational databases as an alternative source of data.  Increasingly, architects choose storage based on the nature of the data itself and how we want to manipulate them, how much information is expected.  And so it only becomes more interesting. </div><p>Source: <a href="https://habr.com/ru/post/152477/">https://habr.com/ru/post/152477/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152467/index.html">Facebook killer</a></li>
<li><a href="../152469/index.html">CrossDevices AIR</a></li>
<li><a href="../152471/index.html">Free of charge is not protection: 40% of free apps on iOS and 80% on Android are cracked</a></li>
<li><a href="../152473/index.html">Notes of the novice project manager on the client side</a></li>
<li><a href="../152475/index.html">Navigator with video recorder SeeMax Navi E540 HD DVR</a></li>
<li><a href="../152479/index.html">The story of a startup in the field of information security</a></li>
<li><a href="../152483/index.html">Own Security Realm in GlassFish</a></li>
<li><a href="../152485/index.html">Digsby is now in Open Source, available on GitHub</a></li>
<li><a href="../152491/index.html">FPGA is simple or do it yourself</a></li>
<li><a href="../152493/index.html">In the German parliament laptops were banned, the deputy of the Pirate Party came with a typewriter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>