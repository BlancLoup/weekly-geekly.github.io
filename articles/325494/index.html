<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why in the standard library there are no tools to combat hanging links and how to fix it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the appearance of smart pointers in the standard C ++ library, the problem of controlling the lifetime of the object was solved. You can create ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why in the standard library there are no tools to combat hanging links and how to fix it?</h1><div class="post__text post__text-html js-mediator-article">  After the appearance of smart pointers in the standard C ++ library, the problem of controlling the lifetime of the object was solved.  You can create objects on the stack, then they are automatically deleted when you go out of scope, or you can use unique_ptr to create objects with exclusive ownership or shared_ptr for joint ownership.  But only for shared_ptr in the standard library there is a non-possessing pointer weak_ptr, which prevents the use of an invalid pointer.  For other cases, use the "old and dangerous" raw pointers. <br><br>  How do language developers propose to solve this problem? <br><a name="habracut"></a><br>  The <a href="https://github.com/isocpp/CppCoreGuidelines">CppCoreGuidelines</a> website has some interesting documents ( <a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/docs/Introduction%2520to%2520type%2520and%2520resource%2520safety.pdf">here</a> and <a href="https://github.com/isocpp/CppCoreGuidelines/blob/master/docs/Lifetimes%2520I%2520and%2520II%2520-%2520v0.9.1.pdf">here</a> ). <br>  The main message is this: I cannot implement safe non-possessing pointers without violating the zero overhead principle.  Therefore, we will not implement such tools at runtime, but will try to solve the problem by static code analysis. <br><br>  I disagree with this position and here are my reasons: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Static analysis will not be able to catch all the problems.  The authors of the articles themselves say that sometimes it will be necessary to mark some constructions as safe, leaving the question of the correctness of the code on the developer‚Äôs conscience. </li><li>  In order for static analysis to work, support from compilers is needed.  When it appears - is unknown. </li><li>  Static analysis does not allow you to have weak non-possessing pointers (analogous to weak_ptr, which vanishes when an object is deleted). </li><li>  Implementing such pointers violates the zero overhead principle - this is true.  But, in my opinion, this principle is also violated by shared_ptr, since  has an additional ref_count object or, for example, a string with its small string optimization.  In any case, the standard library provides classes with clearly described characteristics, and the programmer decides whether these classes are suitable for him or not. </li></ol><br>  In my opinion, the standard library should provide classes for all major programming scripts.  The lack of pointers and hanging link access is a large and still unclosed topic in C ++.  I think the standard library should provide the programmer with an optional opportunity to have such pointers. <br><br>  In my <a href="https://github.com/lexxmark/rsl">RSL</a> project, I tried to implement such a pointer.  The basic idea is not new: an object is needed, which, when destroyed, will notify the pointers about the fact of removal. <br><br>  Thus, we have two classes: <br><br><ol><li>  <b><a href="">rsl :: track :: trackable</a></b> is a class that notifies pointers on deletion. </li><li>  <b><a href="">rsl :: track :: pointer</a></b> is a non-possessive pointer. </li></ol><br>  When <i>rsl :: track :: pointer</i> 's point to the same <i>rsl :: track :: trackable</i> object, they are arranged in a doubly linked list.  A pointer to the head of the list is contained in <i>rsl :: track :: trackable</i> .  Thus, the creation of pointers takes constant time.  The size r <i>sl :: track :: trackable</i> is one pointer, and <i>rsl :: track :: pointer</i> - 4 pointers (a pointer to an object, two pointers to organize the list, and another one to implement polymorphic behavior).  Perhaps a more optimal organization of pointers, if anyone knows, please tell. <br><br>  Also, this implementation is not thread-safe, to ensure work in different threads, you will have to add std :: atomic_flag and slow down the modification of pointers. <br><br>  In addition, with the advent of <a href="http://en.cppreference.com/w/cpp/concept/AllocatorAwareContainer">allocator aware containers</a> , it became possible to implement an <a href="">allocator</a> that allows using <i>rsl :: track :: pointer</i> with standard containers.  The basic idea is that now all allocations in containers are made as an instance of the allocator stored in the container or its template copy, and we can store <i>rsl :: track :: trackable</i> in the allocator and transfer it to a copy. <br><br>  The <a href="https://github.com/lexxmark/rsl/tree/master/tests/track">tests</a> give examples of working with the main standard containers, including std :: array, as well as <a href="">unique_ptr</a> . <br><br>  In conclusion, I want to give another script in which <i>rsl :: track :: pointer</i> will be useful.  These are situations similar to <b>delete this</b> .  Usually this happens indirectly when a code, a functor or a signal external to the object is called.  This kind of error is rare, but difficult to catch. <br>  For such cases (and any other problems with access to the hanging link) use tools such as <a href="https://github.com/google/sanitizers">google sanitizers</a> , which allow you to catch such problems. <br><br>  But these tools have their disadvantages: <br><br><ol><li>  Work not everywhere (not on all platforms). </li><li>  Code instrumentation is needed - the code is different from production. </li><li>  There is no analogue of weak_ptr, the pointer that vanishes when an object is deleted. </li><li>  Detects the time and place of access by an invalid pointer.  Although, as a rule, the more interesting is the moment when the removal of an object to which there are pointers occurs.  For the same reason, the instrumentation detects not all cases of incorrect access, but only those that actually worked during testing. </li></ol><br>  I hope the library will be useful to C ++ developers.  Perhaps there are other ways to solve such problems, I will be happy to hear in the comments. <br><br>  <b>PS</b> Once again, for convenience, I provide a link to the <a href="https://github.com/lexxmark/rsl">RSL</a> code. </div><p>Source: <a href="https://habr.com/ru/post/325494/">https://habr.com/ru/post/325494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325484/index.html">The influence of ambient music on the process of writing code</a></li>
<li><a href="../325486/index.html">Is there life after 30: history of CiscoSystems</a></li>
<li><a href="../325488/index.html">Different approaches to balancing traffic</a></li>
<li><a href="../325490/index.html">"Man in the middle" using revoked certificates. Part 1</a></li>
<li><a href="../325492/index.html">Human face design patterns</a></li>
<li><a href="../325498/index.html">Facilitating the reversal of Golang binaries or why even write scripts in IDA</a></li>
<li><a href="../325502/index.html">Spectral analysis of signals from non-linear links of ACS in Python</a></li>
<li><a href="../325504/index.html">We automate everything: the new version of OneBox Next (CRM + ERP) is available for free</a></li>
<li><a href="../325508/index.html">Posting 3CX on Google Compute Engine</a></li>
<li><a href="../325510/index.html">Teach TensorFlow to draw Cyrillic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>