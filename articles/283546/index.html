<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Benefits of Juniper Stacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Virtual chassis technology 

 One of the main advantages of Juniper solutions over its competitors is their stacking capabilities. There are q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Benefits of Juniper Stacking</h1><div class="post__text post__text-html js-mediator-article"> Part 1. Virtual chassis technology <br><br>  One of the main advantages of Juniper solutions over its competitors is their stacking capabilities.  There are quite a few options, starting from the base Virtual Chassis and ending with a variety of data center technologies. <br><br>  <b>Part 1. Virtual Chassis</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/420/fbd/b4a/420fbdb4a64049cf833a469470dc779a.jpg"><br><br><a name="habracut"></a><br><br>  Consider the capabilities and features of the Virtual Chassis base technology, which allows you to combine up to 10 devices (depending on the model) of the EX series and QFX series into one logical device, as well as how to configure and monitor it. <br><br>  To begin with, which models support the technology of Virtual Chassis: <br><br>  ‚Ä¢ EX2200 Ethernet Switch up to 4 devices <br>  ‚Ä¢ EX3300 Ethernet Switch up to 10 devices <br>  ‚Ä¢ EX4200 Ethernet Switch up to 10 devices <br>  ‚Ä¢ EX4300 Ethernet Switch up to 10 devices <br>  ‚Ä¢ EX4550 Ethernet Switch up to 10 devices <br>  ‚Ä¢ EX4600 Ethernet Switch up to 10 devices <br>  ‚Ä¢ QFX5100 Switch up to 10 devices. <br><br>  These are the models that at the time of this writing are produced and available for order, and, accordingly, can be used in the virtual chassis. <br><br>  Virtual Chassis technologies combine the scalability and compact form factor of freestanding switches with high availability, bandwidth and port density of traditional chassis.  Virtual Chassis allows you to provide cost-effective deployment of switches and network availability in places where the cost of installing chassis devices may be too high, or where it is physically impossible to install chassis switches. <br><br>  Due to the fact that several devices are managed as a single unit, Virtual Chassis allows you to use the same redundancy capabilities as the use of several Routing Engine (RE) in chassis switches, including graceful Routing Engine switchover (GRES) technology. <br><br><img src="https://habrastorage.org/files/8c8/e2e/c1e/8c8e2ec1ea324153a6221f050a96a633.jpg"><br><br>  To connect to a virtual chassis, specialized interfaces can be used that are on the EX4500, EX4550, and EX4200 devices, as well as copper and optical ports.  Ports that are used to connect to a virtual chassis are called Virtual Chassis Ports (VCP).  For example, in an EX2200-24T-4G 24 10/100 / 1000Base-T and 4 SFP switch, you can use either SFP or copper ports to connect to a virtual chassis.  This allows you to spread the members of a single virtual chassis over a distance of 80 km. <br><br>  Mixed Virtual Chassis makes it possible to use switches of different series and even different lines within one virtual chassis, as shown in the figure below. <br><br><img src="https://habrastorage.org/files/23c/75c/a12/23c75ca1215342db94d7e57e692d315c.jpg"><br>  <i>Options for stacking switches in Mixed Virtual Chassis</i> <br><br>  In the virtual chassis there is a separation by roles: two switches get the role RE0 and RE1, and the rest are used as line cards. <br><br>  RE0 performs the role of a master whose task is to manage the remaining members of the virtual chassis, and it is he who is responsible for creating the routing tables and distributing them across the line cards.  It also stores configuration files.  RE1 - backup, in case of RE0 failure. <br><br>  Consider the distribution of switch roles in a virtual chassis using the example below. <br><br><img src="https://habrastorage.org/files/07e/4c0/98a/07e4c098ad23426185dc56408b9c42ce.jpg"><br><br>  Criteria for choosing a master: <br><br>  - The switch with the highest priority.  The priority can be from 1 to 255, by default it is 128 on all switches; <br>  - A switch that was a master before rebooting; <br>  - Switch with the highest uptime (the difference should be more than 1 min) ;. <br>  - Switch with the lowest MAC address. <br><br>  Each member of the virtual chassis receives its ID from 0 to 9. You can manually configure this ID from the wizard (whose ID is 0) (after rebooting, the number is saved and can serve as a slot number in the interface definition). <br><br><img src="https://habrastorage.org/files/fcb/170/550/fcb170550697481bba5c5996a6f3742a.jpg"><br><br>  Due to the fact that the ID is assigned to the switch, the following situation may arise: when one switch fails and you change it, the new member receives not the number of the failed switch, but the next free or not connected to the virtual chassis, if all ID is already taken. <br><br>  Therefore, in order to replace a failed switchboard with a new one, you first need to remove its ID from the wizard as follows: <br><br>  {master: 0} <br><br>  user @ Switch-1&gt; request virtual-chassis recycle member-id &lt;member-id&gt; <br><br>  Or you can do this with the command ID: <br><br>  user @ host&gt; request virtual-chassis renumber member-id &lt;current-member-id&gt; new-member-id &lt;new-member-id&gt; <br><br>  <b>Single management interface and single console</b> <br><br>  Within the virtual chassis, all management interfaces are merged into one, with a single IP address: <br><br><img src="https://habrastorage.org/files/213/f21/99c/213f2199ca854c99a1ca0ba1f460197a.jpg"><br><br>  {master: 0} [edit] <br><br>  user @ switch # show interfaces vme <br><br>  unit 0 { <br><br>  family inet { <br><br>  address 10.210.14.148/27; <br><br>  } <br><br>  } <br><br>  {master: 0} [edit] <br><br>  user @ Switch-1 # run show interfaces terse vme <br><br>  Interface Admin Link Proto Local Remote <br><br>  vme up up <br><br>  vme.0 up up inet 10.210.14.148/27 <br><br>  The same thing happens with the console port, no matter what you connect to, you will be taken to RE0. <br><br><img src="https://habrastorage.org/files/fc3/52a/f6f/fc352af6fab8401886b566878263fd55.jpg"><br><br>  <b>Software compatibility</b> <br><br>  All members of the virtual chassis must be with the same version of the software.  When we add a new switch to the virtual chassis, the wizard checks its version of the software; if the software is different, the new switch will receive an ID, but will not become an active member of the virtual chassis.  To do this, you need to update the software on the new switch with the command: <br><br>  request system software add member &lt;member-id&gt; reboot <br><br>  This command downloads the image from the master switch through the VCPs of the new switch, and then reboots it, and the new switch may not be connected directly to the main switch. <br><br>  <b>Automatic software update</b> <br><br>  By configuring the automatic software update, when each new switch is connected to a version other than the wizard, its software will be automatically updated.  set virtual-chassis auto-sw-update package-name &lt;package-name&gt; <br><br>  <b>Nonstop Software Upgrade</b> <br><br>  The Nonstop software upgrade (NSSU) technology allows you to upgrade software on all members of a virtual chassis with minimal loss.  For this technology to work correctly, you need to: <br><br>  - All members of the virtual chassis were connected to the ‚Äúring‚Äù topology; <br>  - Master and backup were adjacent; <br>  - Line cards have been configured in preconfiguration mode; <br>  - On all members of the virtual chassis should be one version of the software; <br>  - NSR and GRES should be included;  Optionally, you can activate the NSB command request system snapshot. <br><br>  <b>NSSU process:</b> <br><br>  - Download the image of the software.  If you use a mixed virtual chassis, then download both images. <br>  - Copy it to RE0, recommended in the / var / tmp folder, <br>  - From the command line RE0, launch NSSU with the command: <br>  request system software nonstop-upgrade <u>/var/tmp/package-name.tgz</u> <br>  or for mixed virtual chassis <br>  request system software nonstop-upgrade set <u>[/var/tmp/package-name.tgz /var/tmp/package-name.tgz]</u> <br><br>  <b>Recommended Master Switch and Backup Switch Location</b> <br><br>  When building a virtual chassis, the following connection schemes are recommended: <br><br><img src="https://habrastorage.org/files/ab8/856/902/ab88569024744d3689f406d163beff7c.jpg"><br><br>  Or <br><br><img src="https://habrastorage.org/files/4bb/77d/703/4bb77d7034ee482ca8baa53da1f41871.jpg"><br><br>  If the elements of the virtual chassis are separated geographically, then you should use the scheme below: <br><br><img src="https://habrastorage.org/files/a06/f28/619/a06f28619ff54ccebdd3983df7664eb3.jpg"><br><br>  <b>Recommended Virtual Chassis Topologies</b> <br><br>  The following figures show virtual chassis topologies that can be deployed based on specific user needs.  The ‚Äúring‚Äù topology is the most commonly used, but the virtual chassis can also be deployed in a ‚ÄúFull mesh‚Äù topology or a multiple ring topology.  The ring topology is recommended when deploying a virtual chassis in mixed mode. <br><br><img src="https://habrastorage.org/files/8a2/6d6/aed/8a26d6aedb4c4e7bbfd8cc4d9a95051d.jpg"><br>  <i>Ring</i> <br><br><img src="https://habrastorage.org/files/e97/d2d/4bc/e97d2d4bccf045259b48843303819ea0.jpg"><br>  <i>Full mesh</i> <br><br><img src="https://habrastorage.org/files/eae/6db/529/eae6db529dd64cb1bc940fc9cd331647.jpg"><br>  <i>Multiple Ring Topology</i> <br><br>  <b>Configuring Virtual Chassis</b> <br><br>  Virtual chassis configuration occurs at the hierarchy level [edit virtual-chassis] <br><br>  {master: 0} [edit virtual-chassis] <br>  user @ switch # set? <br>  Possible completions: <br>  + apply-groups Groups from <br>  + apply-groups-except <br>  &gt; auto-sw-update Auto software update <br>  &gt; fast-failover fast failover mechanism <br>  id Virtual Chassis identifier, of type ISO system id <br>  &gt; MAC-address when member leaves virtual chassis <br>  &gt; member Member of Virtual Chassis configuration <br>  no-split-detection Disable split detection.  Only recommended in a 2 member setup <br>  preprovisioned Only accept preprovisioned members <br>  &gt; traceoptions Global tracing options for Virtual Chassis <br><br>  To minimize traffic interruptions during the RE failover scenario, you need to enable graceful Routing Engine switchover. <br><br>  {master: 0} [edit chassis] <br>  user @ switch # set redundancy graceful-switchover? <br>  Possible completions: <br>  &gt; graceful-switchover Enable graceful switchover on supported hardware <br><br>  There are several options: dynamic and preprovisioning. <br><br>  Dynamic: <br><br>  1. Turn on the master switch and set the ID 0 and priority 255. <br>  2. Connect the backup switch and set the ID 0 and priority 255. <br>  {master: 0} [edit virtual-chassis] <br>  user @ Switch-1 # set member &lt; <u>member-id</u> &gt; mastership-priority &lt; <u>priority</u> &gt; <br>  3. When using only two switches, it is recommended to disable split detection. <br>  [edit virtual-chassis] <br>  user @ switch # set no-split-detection <br>  4. Turn on the power on the other switches. <br>  5. If we use a mixed virtual chassis, then we add the command: <br>  user @ device&gt; request virtual-chassis mode mixed reboot <br>  6. On each individual switch, we indicate the ports that will be in the role of VCPs. <br><br>  Preprovisioning <br><br>  1. Turn on the master switch (pre-collect all the serial numbers of the switches that will be in the cluster). <br>  2. If we will use a mixed virtual chassis: <br>  user @ device&gt; request virtual-chassis mode mixed reboot <br>  3. Optionally configure the IP address on the management interface: <br>  user @ switch # set interfaces vme unit 0 family inet address / ip-address / mask / <br>  4. Install Preprovisioning mode: <br>  [edit virtual-chassis] <br>  user @ switch # set preprovisioned <br>  5. Register the role, ID for each member of the virtual chassis <br>  [edit virtual-chassis] <br>  user @ switch # set member 0 serial number BM0208105168 role routing-engine <br>  user @ switch # set member 1 serial number BM0208124111 role line-card <br>  user @ switch # set member 2 serial number BM0208124231 role routing-engine <br>  user @ switch # set member 3 serial number BM0208124333 role line-card <br>  6. When using only two switches, it is recommended to disable split detection. <br>  [edit virtual-chassis] <br>  user @ switch # set no-split-detection <br>  7. Turn on the remaining members of the virtual chassis. <br>  8. If we use a mixed virtual chassis, then we introduce on each switch <br>  user @ device&gt; request virtual-chassis mode mixed reboot <br>  9. Specify which interfaces we will use as VCPs. <br>  user @ switch&gt; request virtual-chassis vc-port set pic-slot pic-slot-number port port-number local <br>  For example, to use the onboard 40G ports on an EX4600 switch. <br>  user @ switch&gt; request virtual-chassis vc-port set pic-slot 2 port 0 local <br>  Where port 0 is the first 40G integrated port. <br>  user @ switch&gt; request virtual-chassis vc-port set pic-slot pic-slot-number port port-number local <br><br>  <b>Monitoring Virtual chassis</b> <br><br>  To monitor the virtual chassis, use the show virtual-chassis command with various keys: <br><br>  {master: 0} <br>  user @ switch&gt; show virtual-chassis? <br>  Possible completions: <br>  &lt;[Enter]&gt; Execute this command <br>  active topology Virtual chassis active topology <br>  device-topology PFE device topology <br>  fast failover fast failover status <br>  login <br>  protocol Show Virtual Chassis protocol information <br>  status Virtual Chassis information <br>  vc-path Show virtual-chassis packet path <br>  vc-port Virtual Chassis port information <br>  |  Pipe through a command <br><br>  Checking the status of virtual chassis ports: <br><br>  show virtual-chassis vc-port <br><br>  {master: 0} <br>  user @ Switch-1&gt; show virtual-chassis vc-port <br>  fpc0: <br>  - Interface Type Trunk Status Speed ‚Äã‚ÄãNeighbor <br>  or ID (mbps) ID Interface <br>  PIC / Port <br>  vcp-0 Dedicated 2 Up 32000 1 vcp-0 <br>  vcp-1 Dedicated 1 Up 32000 1 vcp-1 <br>  fpc1: <br>  - Interface Type Trunk Status Speed ‚Äã‚ÄãNeighbor <br>  or ID (mbps) ID Interface <br>  PIC / Port <br>  vcp-0 Dedicated 2 Up 32000 0 vcp-0 <br>  vcp-1 Dedicated 1 Up 32000 0 vcp-1 <br><br>  Checking status information: <br><br>  show virtual-chassis status <br><br>  {master: 0} <br>  user @ Switch-1&gt; show configuration virtual-chassis <br>  preprovisioned; <br>  member 0 { <br>  role routing-engine; <br>  serial number BM0208105168; <br>  } <br>  member 1 { <br>  role line card; <br>  serial number BM0208124231; <br>  } <br>  {master: 0} <br>  user @ Switch-1&gt; show virtual-chassis status <br>  Preprovisioned Virtual Chassis <br>  Virtual Chassis ID: 8d5c.a77f.8de8 <br>  Mastership Neighbor List <br>  Member ID Status Serial No Model Priority Role ID Interface <br>  0 (FPC 0) Prsnt BM0208105168 ex4200-24t 129 Master * 1 vcp-0 <br>  1 vcp-1 <br>  1 (FPC 1) Prsnt BM0208124231 ex4200-24t 0 Linecard 0 vcp-0 <br>  0 vcp-1 <br><br>  So we briefly reviewed the Virtual chassis technology, options for setting up and monitoring. </div><p>Source: <a href="https://habr.com/ru/post/283546/">https://habr.com/ru/post/283546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283532/index.html">Game that is not a game</a></li>
<li><a href="../283536/index.html">Security Week 19: AI in security, zero days at Microsoft and Adobe, a different look at crypto-fiber</a></li>
<li><a href="../283538/index.html">We compile an audiobook base for easy filtering.</a></li>
<li><a href="../283540/index.html">Fail2ban 0.10: New features. Test open</a></li>
<li><a href="../283542/index.html">I needed a report ...</a></li>
<li><a href="../283548/index.html">Doomsday: What are the hidden errors of asynchronous data processing with increasing load</a></li>
<li><a href="../283550/index.html">Distribute pictures by rails after disabling Google‚Äôs svn repositories</a></li>
<li><a href="../283552/index.html">Reduce the size of published npm modules</a></li>
<li><a href="../283554/index.html">Adding Unreal Engine support for dxf format</a></li>
<li><a href="../283556/index.html">Angular 2 Beta, training course "Tour of Heroes" part 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>