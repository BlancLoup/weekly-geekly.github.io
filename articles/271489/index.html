<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do we live a year without sprockets and with react</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 We in taaasty.ru have been living for a year and a half on react-e and almost a year without sprockets. This is so cool, I want to share. Fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do we live a year without sprockets and with react</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  We in <a href="http://taaasty.ru/">taaasty.ru</a> have been living for a year and a half on react-e and almost a year without sprockets.  This is so cool, I want to share.  For one thing, I‚Äôll tell you how react works with rails in prerender mode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e06/73e/b91/e0673eb9173bb2c62b3d861be595884d.jpg" alt="image"><br><a name="habracut"></a><br><h4>  ReactJS </h4><br>  Much has been said about this technology.  I just want to confirm, yes, she is beautiful.  When I came to the project, he was in the <i>‚Äúlet's fix these bugs, which came out from the fact that he repaired this one</i> ‚Äù.  During the frontend, the desires of cool chips were so much that it became immediately clear - we could not take into account all the possible nuances of behavior in JS, and still parallel and correct the bugs in the Legacy code without some cardinal solution.  And React solves this problem completely. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, we connected react-rails and made components in the rail environment on coffee.  The following problems quickly emerged: <br><br>  1. JS code is big.  Sprockets brake.  Compilation wait changes were becoming more and more tedious. <br>  2. The <a href="https://github.com/brandymint/vagrant">front-tender</a> had to adjust ruby ‚Äã‚Äãon rails, and in spite of the general environment in <a href="https://github.com/brandymint/vagrant">vagrant</a> , these are unnecessary actions, a waste of time. <br>  3. The front-end has its own set of technologies - gulp, webpack, and so on, its own packages, which you will not plug into the rails. <br>  4. In addition to the front-end html, the layout designer also works, and sometimes the designer.  They generally do not have to rail.  And also the layout periodically needs to be shown to the customer and it is easier to do on static ftp pages than to run rails for this. <br><br>  In general, everything went to ensure that the frontend is a separate project.  So did.  All React and JS moved to a separate repository (they left it open) - <a href="https://github.com/taaasty/web-static">github.com/taaasty/web-static</a> <br><br>  The frontrunner and coder are working with their technology stack, do not depend on the back-bend, they do their quick builds.  They can run the frontend application and poison it on the vendor or the test server of choice. <br><br>  Since the front repository was left open, we connected a free travis for builds, and made a script to post the finished demo build on gh-pages - <a href="http://taaasty.github.io/web-static/">taaasty.github.io/web-static</a> so you can always see the latest working version of the layout and scripts. <br><br>  At this stage, began to better understand the meaning of the saying "divide and conquer." <br><br><h4>  Sprockets </h4><br>  Since all the JS and CSS are built in a separate repository, the need for assembly and sprockets (creepiness) is completely gone in the rails.  Static files are connected to the project as git submodules: <br><br><pre><code class="bash hljs">$ cat .gitmodules [submodule <span class="hljs-string"><span class="hljs-string">"vendor/static"</span></span>] path = vendor/static url = https://github.com/taaasty/web-static.git branch=develop $ ag vendor/static config config/application.rb 40: config.assets.paths &lt;&lt; Rails.root.join(<span class="hljs-string"><span class="hljs-string">'vendor/static/dist/stylesheets'</span></span>) 41: config.assets.paths &lt;&lt; Rails.root.join(<span class="hljs-string"><span class="hljs-string">'vendor/static/dist/scripts'</span></span>)</code> </pre> <br><br>  In the front of the repository there are ready-made assembly files for styles and javascript, and we request them directly from html: <br><br><pre> <code class="ruby hljs">= javascript_include_tag <span class="hljs-string"><span class="hljs-string">'desktop.production.js'</span></span> = stylesheet_link_tag <span class="hljs-string"><span class="hljs-string">'desktop.production.css'</span></span></code> </pre><br><br>  Now, when deploying, there is no precompilation (assets: precompile is not needed), everything is already laid out.  Deploy duration decreased from 4-5 minutes to 15 seconds. <br><br>  And how well it became to the buckers - I inserted the component, gave it the parameters of the desired structure, and you don‚Äôt have any hemorrhoids with html and JS.  All this has already been decided at the front.  In fact, the backend has become such a big API - <a href="http://api.taaasty.com/">api.taaasty.com</a> <br><br><h4>  react-rails </h4><br>  Everyone who finds out that we have the whole front in the reactor, first of all asks, so how is the prerender?  Yes, great, it works with a half-kick, all pages are given with a ready-made layout. <br><br>  In ruby, there are two working engines for javascript execution (and component pre-rendering).  This is therubyracer (uses the libv8 library) and nodejs (actually starts nodejs and gives it the code for execution). <br><br><ul><li>  therubyracer.  Eats memory.  It flows.  The average execution speed of the component is ~ 10-20ms, but sometimes for every 10,000th request), it is podvison up to 100-200 ms. </li><li>  nodes are a safe way to execute JS code, BUT, for each component execution (there may be several of them on the page) ruby ‚Äã‚Äãstarts the nodejs process (that is, loads a binary file), feeds the source file and retrieves the results from STDOUT.  The average execution speed of the component is 50-80ms, of which most of it goes to loading nodejs into memory and starting it. </li></ul><br><br>  We settled on therubyracer.  At the moment, it renders 2-3 thousand components per minute.  More than a year the flight is excellent.  react-rails remained in the project and performs only the functions of a pre-tender. </div><p>Source: <a href="https://habr.com/ru/post/271489/">https://habr.com/ru/post/271489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271479/index.html">Rabdological abacus Claude Perrot</a></li>
<li><a href="../271481/index.html">Domestic server manufacturer = self-assembly?</a></li>
<li><a href="../271483/index.html">C #, ways to store program settings</a></li>
<li><a href="../271485/index.html">A way to quickly measure the performance of a random server</a></li>
<li><a href="../271487/index.html">Under the hood Redis: Strings</a></li>
<li><a href="../271491/index.html">Free Webinars at Startup Week - Connect</a></li>
<li><a href="../271493/index.html">Infrastructure and trading robots: What programming languages ‚Äã‚Äãare used in finance</a></li>
<li><a href="../271495/index.html">The tester is responsible for everything</a></li>
<li><a href="../271499/index.html">Welcome to Moscow Data Science November 27</a></li>
<li><a href="../271501/index.html">HV data storage format as an attempt to solve the problem of visual storage of text fields</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>