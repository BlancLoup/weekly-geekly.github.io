<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Well, again, the weather station"? Not quite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The proposed weather station is based on a home-made PIDP11 computer consisting of a ‚Äúraspberry‚Äù with a PDP-11 emulator and a case with a front panel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Well, again, the weather station"? Not quite</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/aw/wy/yu/awwyyuan47fvnwenytungq8clu8.jpeg"><br><br>  The proposed weather station is based on a home-made <a href="https://hackaday.io/project/8069-pidp-11">PIDP11</a> computer consisting of a ‚Äúraspberry‚Äù with a PDP-11 emulator and a case with a front panel with active LEDs and switches.  But despite this, the Malinka has enough unoccupied GPIOs to connect a pressure and temperature sensor. <br><br>  The emulator runs OS 2.11BSD, in which the weather station software ‚Äúrotates‚Äù.  The data is output to two terminal emulators.  One of them - cool-retro-term - displays text information in large print using ASCII-art.  The second, a Tektronix 4010 graphics terminal emulator with a memory tube, displays pressure and temperature changes. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The BME280 sensor connection method is described <a href="https://www.raspberrypi-spy.co.uk/2016/07/using-bme280-i2c-temperature-pressure-sensor-in-python/">here</a> : <br><br><pre><code class="plaintext hljs"> |  | GPIO    | | Raspberry Pi  | | ------------+--------------+-------------- VCC | 3,3  | P1-01 GND |  | P1-06 SCL | SCL  I2C | P1-05 SDA | SDA  I2C | P1-03</code> </pre> <br>  The OLED display shown in the photo below is connected in parallel to the sensor, but it is assigned another address on the I <sup>2</sup> C bus.  If you prefer, you can not install the display at all.  The author also installed a button for the OS to shut down correctly before turning off the power. <br><br><img src="https://habrastorage.org/webt/zn/uj/p6/znujp611prwu14vttig0mwsiawy.jpeg"><br><br>  To make the device work, you first need to add a new user to the new user launched in the 2.11BSD emulator: <br><br>  Log in as root user.  Enter the vipw command to start the vi editor with the / etc / passwd file <br><br>  Put the line in the file: <br><br><pre> <code class="plaintext hljs">firstname::201:20:fullname:/home/firstname:/bin/tcsh</code> </pre> <br>  where firstname and fullname are short and full usernames. <br><br>  Exit the editor, create a home folder for the user: <br><br><pre> <code class="plaintext hljs">cd /home mkdir firstname chown firstname firstname</code> </pre> <br>  Copy the files .login and .cshrc in this folder ' <br><br><pre> <code class="plaintext hljs"> cd /home/user cp .* /home/firstname cd /home/firstname chown firstname .*</code> </pre> <br>  Enter vi .login and edit the command line prompt, changing the corresponding line to: <br><br><pre> <code class="plaintext hljs">set prompt='%n@%m:%c$ '</code> </pre> <br>  Exit the editor.  Log out with the logout command, change the password to the new user with the passwd command under the root, now you can log in with the login and password of the new user. <br><br>  After that, you need to make the date and time in the system set automatically when loading, <a href="https://github.com/rricharz/pidp11-2.11bsd/blob/master/DateAndTime.pdf">so</a> (for the information below, the author thanks Jason Vanick and Johnny Billquist): <br><br>  First set up the network and make sure ping is working.  Then just before the ntpt line in the /etc/rc.local file put the line: <br><br><pre> <code class="plaintext hljs">ntp -sf pool.ntp.org</code> </pre> <br>  Change the last line in the /etc/ntp.conf file to: <br><br><pre> <code class="plaintext hljs">server pool.ntp.org</code> </pre> <br>  You can select any other NTP server.  To set the time zone, check the list of belts in the / usr / share / zoneinfo file and find the name of your belt there.  Log in as root and enter the commands: <br><br><pre> <code class="plaintext hljs">cd /etc mv localtime localtime.old ln -s /usr/share/zoneinfo/timezone localtime</code> </pre> <br>  The next operation is to install and configure a program that will allow the 2.11BSD command line running in the emulator to forward the Raspbian command line running on a real "raspberry" <a href="https://github.com/rricharz/pidp11-2.11bsd/blob/master/Rsh.pdf">like this</a> : <br><br>  In Raspbian, enter the following command as root: <br><br><pre> <code class="plaintext hljs">sudo apt-get install rsh-server</code> </pre> <br>  Create a .rhosts file in your home folder with the following contents: <br><br><pre> <code class="plaintext hljs">bsd_ip_address bsd_user_name</code> </pre> <br>  where bsd_ip_address is the IP address of the virtual machine with 2.11 BSD, and bsd_user_name is the username of 2.11 BSD, which can execute commands on a real Malinka, for example: <br><br><pre> <code class="plaintext hljs">192.168.1.99 rene</code> </pre> <br>  Set permissions for this file, otherwise it will not work: <br><br><pre> <code class="plaintext hljs">chmod 600 .rhosts</code> </pre> <br>  Go to the emulator, enter 2.11 BSD as the root user and edit / etc / hosts - add the line: <br><br><pre> <code class="plaintext hljs">remote_ip_address remote_full_name remote_nick_name</code> </pre> <br>  where remote_ip_address is the real Malinka IP address, and remote_full_name and remote_nick_name are her domain name and alias, for example: <br><br><pre> <code class="plaintext hljs">192.168.1.103 pizerow.home.lan pizerow</code> </pre> <br>  Log in with the previously specified name (bsd_user_name) and check if everything worked: <br><br><pre> <code class="plaintext hljs">rsh remote_nick_name -l pi -n ‚Äúls‚Äù</code> </pre> <br>  You have just executed the ls command on the real ‚Äúraspberry‚Äù from the emulator.  If, instead, a password entry form appeared in front of you, then something went wrong. <br><br>  Now try something more complicated.  Enter the command: <br><br><pre> <code class="plaintext hljs">rsh remote_nick_name -l pi -n ‚Äúcat /sys/class/thermal/thermal_zone0/temp‚Äù</code> </pre> <br>  In the rtest folder of this repository, there is a small C program that shows how to use popen to obtain information from a particular program and process it so that it can get human-read output in 2.11BSD: <br><br><pre> <code class="plaintext hljs">rene@pdp11:rtest$ rtest **************************************************** * The CPU temperature on the pizerow is 42.2 deg C * **************************************************** rene@pdp11:rtest$</code> </pre> <br>  You have just seen in the emulator the temperature of the real processor on which this emulator is spinning. <br><br>  Download the Python script from the weather / sensor folder of this repository. <br><br>  Make sure the script works correctly in remote pizerow and place it in the / home / pi / bin folder <br><br>  Run cool-retro-term and emulator, login to 2.11BSD as the newly created user and enter the commands: <br><br><pre> <code class="plaintext hljs">mkdir weather cd weather</code> </pre> <br>  In one way or another (for example, using FileZilla), drag files from the weather / BSD repository folder to the weather folder of the OS running in the emulator.  Enter the weather command, and the program will pull the data from the sensor and display it in this form: <br><br><pre> <code class="plaintext hljs"> rene@pdp11:weather$ weather Contacting remote sensor... Data received, analyzing ... ************************************** The sensor reports the following data: Temperature 7.0 C Pressure 969.8 hPa Humidity 66.8 % ************************************** rene@pdp11:weather$</code> </pre> <br>  If everything worked, create a folder dats in the ~ / weather folder, where weather2 will be able to store a log: <br><br><pre> <code class="plaintext hljs">cd cd weather mkdir data weather2</code> </pre> <br>  weather2 will start every day in the ~ / weather / data folder of the file with the name corresponding to the date, and every minute add the data line to it.  And it will continuously output the following to the terminal, updating the screen also once a minute: <br><br><img src="https://habrastorage.org/webt/pp/bt/zk/ppbtzkw1rmufumlfz-ciivd1ffc.jpeg"><br><br>  Well, weather3 works the same way, it only displays time and pressure.  To move the cursor, it uses the curses library. <br><br><img src="https://habrastorage.org/webt/vl/tv/a8/vltva8sjlqvyuq6byh3arhdhhye.jpeg"><br><br>  Try also to display the same temperature and pressure values ‚Äã‚Äãon previous days, and also write a script to get a weather forecast based on this data.  Successes! <br><br>  <a href="https://github.com/rricharz/pidp11-2.11bsd/blob/master/Cool.pdf">Appendix 1</a> - installation and configuration of cool-retro-term <br><br>  <a href="https://github.com/rricharz/pidp11-2.11bsd/blob/master/Tek.pdf">Appendix 2</a> - Installing and Configuring the Tektronix 4010 Graphics Terminal Emulator </div><p>Source: <a href="https://habr.com/ru/post/446370/">https://habr.com/ru/post/446370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446354/index.html">Security Week 14: ShadowHammer and supply chain</a></li>
<li><a href="../446360/index.html">The exhibition ‚ÄúNedra-2019. Study of. Intelligence service. Production"</a></li>
<li><a href="../446362/index.html">3 Key Qualities for a Successful Product Manager: Dmitry Orlov, Senior Product Manager</a></li>
<li><a href="../446364/index.html">Jokes and references from the Simpsons in English, which need to be explained</a></li>
<li><a href="../446366/index.html">ZX Spectrum 128k do it yourself. Part 2</a></li>
<li><a href="../446372/index.html">Love quests, love and find your personal data in public</a></li>
<li><a href="../446378/index.html">The problem of the transition to winter and summer time for a single Skype school</a></li>
<li><a href="../446380/index.html">H2 Evolution - window functions, CTE, JSON / XML in embedded database</a></li>
<li><a href="../446384/index.html">Tips for developing very large projects in Revit</a></li>
<li><a href="../446388/index.html">Oil and gas industry as an example for peripheral cloud systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>