<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hidden features of Windows. How can BitLocker help protect data?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to experts, it is the laptop theft is one of the main problems in the field of information security (IB). 


 Unlike other security threats,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hidden features of Windows. How can BitLocker help protect data?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/77c/7f9/56b/77c7f956b1134abf8956843808deeca1.gif"></div><br><p>  According to experts, it is the laptop theft is one of the main problems in the field of information security (IB). </p><br><p>  Unlike other security threats, the nature of the problems of a ‚Äústolen laptop‚Äù or ‚Äústolen flash drive‚Äù is rather primitive.  And if the cost of the disappeared devices rarely exceeds several thousand American dollars, the value of the information stored on them is often measured in millions. </p><a name="habracut"></a><br><p>  According to Dell and the Ponemon Institute, 637,000 laptops are lost annually in US airports alone.  And imagine how many flash drives disappear, because they are much smaller, and dropping a flash drive accidentally is easier than ever. </p><br><p>  When a laptop belonging to a top manager of a large company disappears, the damage from one such theft can amount to tens of millions of dollars. </p><br><img src="https://habrastorage.org/web/a48/28b/2c8/a4828b2c86434517961346112174de02.jpg"><br><h2>  How to protect yourself and your company? </h2><br><p>  We continue the cycle of articles about the security of the Windows domain.  In the first article of the cycle, we talked about setting up secure domain logon, and in the second about setting up secure data transfer in the mail client: </p><br><ol><li>  <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">How to use a token to make a Windows domain safer?</a>  <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">Part 1</a> . </li><li>  <a href="https://habrahabr.ru/company/aktiv-company/blog/329904/">How to use a token to make a Windows domain safer?</a>  <a href="https://habrahabr.ru/company/aktiv-company/blog/329904/">Part 2</a> . </li></ol><br><p>  In this article we will talk about setting up encryption of information stored on your hard disk.  You will understand how to make so that no one except you could read the information stored on your computer. </p><br><p>  Few people know that Windows has built-in tools that help keep information secure.  Consider one of them. </p><br><p>  Surely, one of you heard the word "BitLocker".  Let's see what it is. </p><br><h2>  What is BitLocker? </h2><br><p>  BitLocker (the exact name of BitLocker Drive Encryption) is a computer-based disk encryption technology developed by Microsoft.  She first appeared in Windows Vista. </p><br><p>  Using BitLocker, you could encrypt hard disk volumes, but later, already in Windows 7, similar BitLocker To Go technology appeared, which is designed to encrypt removable drives and flash drives. </p><br><p>  BitLocker is a standard component of Windows Professional and server versions of Windows, which means that in most cases of corporate use it is already available.  Otherwise, you will need to upgrade your Windows license to Professional. </p><br><h2>  How does BitLocker work? </h2><br><p>  This technology is based on full volume encryption using the Advanced Encryption Standard (AES) algorithm.  Encryption keys must be stored securely and BitLocker has several mechanisms for this. </p><br><p>  The easiest, but at the same time the most insecure method is the password.  The key is obtained from the password each time in the same way, and accordingly, if someone finds out your password, then the encryption key will be known. </p><br><p>  In order not to store the key in the clear, it can be encrypted either in the TPM (Trusted Platform Module), or on a cryptographic token or smart card that supports the RSA 2048 algorithm. </p><br><p>  TPM - a chip designed to implement the basic functions related to security, mainly using encryption keys. </p><br><p>  The TPM module, as a rule, is installed on the computer motherboard, however, it is very difficult to purchase a computer with an integrated TPM module in Russia, since the import of devices without notification of the FSB to our country is prohibited. </p><br><p>  Using a smart card or token to unlock a disk is one of the safest ways to control who performed the process and when.  To unlock, in this case, both the smart card itself and the PIN code are required. </p><br><p>  BitLocker operation scheme: </p><br><ol><li>  When BitLocker is activated using a pseudo-random number generator, a main bit sequence is created.  This is the volume encryption key - FVEK (full volume encryption key).  They encrypt the contents of each sector.  The FVEK key is kept in the strictest secrecy. </li><li>  FVEK is encrypted using the VMK (volume master key).  The FVEK key (encrypted with the VMK key) is stored on disk among the metadata of the volume.  At the same time, it should never fall on the disk in decrypted form. </li><li>  VMK itself is also encrypted.  The way it is encrypted is chosen by the user. </li><li>  The VMK key is encrypted by default using the SRK (storage root key), which is stored on a cryptographic smart card or token.  Similarly, this happens with TPM. <br>  By the way, the encryption key of the system drive in BitLocker can not be protected using a smart card or token.  This is due to the fact that libraries from the vendor are used to access smart cards and tokens, and, of course, they are not available prior to booting the OS. <br>  If there is no TPM, then BitLocker offers to save the key of the system partition on a USB flash drive, and this, of course, is not the best idea.  If your system does not have TPM, then we do not recommend encrypting system disks. <br>  In general, encrypting the system disk is a bad idea.  When properly configured, all important data is stored separately from the system.  It is at least more convenient in terms of their backup.  Plus, encryption of system files reduces system performance as a whole, and the work of an unencrypted system disk with encrypted files occurs without loss of speed. </li><li>  The encryption keys of other non-system and removable disks can be protected using a smart card or token, as well as TPM. <br>  If there is neither a TPM module nor a smart card, then instead of SRK, the key generated on the basis of the password you entered is used to encrypt the VMK key. </li></ol><br><p>  When launched from an encrypted boot disk, the system polls all possible keystores - checks for TPM, checks USB ports, or if necessary, prompts the user (what is called recovery).  Key storage discovery allows Windows to decrypt the VMK key, which decrypts the FVEK key, which already decrypts the data on the disk. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/59e/197/966/59e19796690a454283f4517fd105202c.jpg"></div><br><p>  Each sector of the volume is encrypted separately, and part of the encryption key is determined by the number of this sector.  As a result, two sectors containing the same unencrypted data will look different in encrypted form, which makes it very difficult to determine the encryption keys by recording and decrypting previously known data. </p><br><p>  In addition to FVEK, VMK and SRK, BitLocker uses another type of key, created ‚Äújust in case‚Äù.  These are recovery keys. </p><br><p>  For emergency cases (the user lost the token, forgot his PIN, etc.) BitLocker at the last step offers to create a recovery key.  Refusal to create it in the system is not provided. </p><br><h2>  How to enable encryption of data on the hard disk? </h2><br><p>  Before you begin the process of encrypting volumes on your hard disk, it is important to note that this procedure will take some time.  Its duration will depend on the amount of information on the hard disk. </p><br><p>  If the computer shuts down or goes into hibernation mode during the encryption or decryption process, these processes will resume from the point of shutdown the next time Windows starts. </p><br><p>  Even in the process of encryption, the Windows system can be used, but it is unlikely to be able to please you with its performance.  As a result, after encryption, disk performance decreases by about 10%. </p><br><p>  If BitLocker is available on your system, then when you right-click on the name of the disk you want to encrypt, the <b>Turn on BitLocker</b> item will appear in the menu that opens. </p><br><p>  On server versions of Windows, you must add the <b>BitLocker Drive Encryption</b> role. </p><br><p>  Let's start setting up encryption for a non-system volume and protect the encryption key using a cryptographic token. </p><br><p>  We will use the token produced by the company "Aktiv".  In particular, the token <a href="https://www.rutoken.ru/products/all/rutoken-ecp-pki/">Rutoken e-signature PKI</a> . </p><br><img src="https://habrastorage.org/web/158/78e/cda/15878ecdaa9c421bac1246b20ee1af7e.JPG"><br><br><p>  <b>I. Prepare Rutoken EDS PKI for work.</b> </p><br><p>  In most normally configured Windows systems, after the first connection of Rutoken EDS, the PKI automatically loads and installs a special library for working with tokens produced by Aktiv company - Aktiv Rutoken minidriver. </p><br><p>  The process of installing such a library is as follows. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9ea/3e8/8e6/9ea3e88e6e424ea58d37db8242563438.jpg"></div><br><p>  The availability of the Aktiv Rutoken minidriver library can be checked through the <b>Device Manager</b> . </p><br><img src="https://habrastorage.org/web/cbd/2be/84d/cbd2be84da474a689683dee24bb4b671.jpg"><br><br><p>  If for some reason the download and installation of the library did not happen, then the <a href="https://www.rutoken.ru/support/download/drivers-for-windows/">Rutoken Drivers for Windows package</a> should be installed. </p><br><p>  <b>Ii.</b>  <b>Encrypt data to disk using BitLocker.</b> </p><br><p>  Click on the drive name and select <b>Turn on BitLocker</b> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/583/fe5/5d7/583fe55d77a042ca9dacc99f47248aae.jpg"></div><br><p>  As we said earlier, we will use a token to protect the disk encryption key. <br>  It is important to understand that to use a token or smart card in BitLocker, they must have RSA 2048 keys and a certificate. </p><br><p>  If you use Certificate Authority in a Windows domain, then the certificate template should contain the field of application of the ‚ÄúDisk Encryption‚Äù certificate (for more details on how to configure the Certificate Authority in the <a href="https://habrahabr.ru/company/aktiv-company/blog/327232/">first part of</a> our series of articles on Windows domain security). </p><br><p>  If you do not have a domain or you can not change the certificate issuance policy, you can use the backup by using a self-signed certificate, details on how to write yourself a self-signed certificate described <a href="https://technet.microsoft.com/ru-ru/library/dd875530(v%3Dws.10).aspx">here</a> . <br>  Now set the appropriate checkbox. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/f62/753/854/f6275385483e431f809d2295989070be.jpg"></div><br><p>  In the next step, select the method for saving the recovery key (we recommend choosing <b>Print the recovery key</b> ). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/099/61f/7c5/09961f7c57f34618b1d9d5211e80b169.jpg"></div><br><p>  Paper with a printed recovery key must be stored in a safe place, preferably in a safe. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/816/2ae/a14/8162aea1497e43e08aa71dfcdd8fa2b1.jpg"></div><br><p>  Next, choose which encryption mode will be used for disks that already contain some valuable data (it is recommended to choose the second option). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/c11/6e9/5c7/c116e95c715442bc8f332aa353a38dc5.jpg"></div><br><p>  In the next step, we start the disk encryption process.  After this process is complete, it may be necessary to reboot the system. </p><br><p>  When encryption is enabled, the encrypted disk icon will change. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/b00/5b6/7c5/b005b67c52004b7aa9bae0bab748e48b.jpg"></div><br><p>  And now, when we try to open this disk, the system will ask you to insert the token and enter its PIN code. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/631/44b/683/63144b683a284dea893dad84b667a494.jpg"></div><br><p>  Deploying and configuring BitLocker and TPM can be automated using WMI or Windows PowerShell scripts.  The way in which the scenarios are implemented will depend on the environment.  The commands for BitLocker in Windows PowerShell are described in the <a href="https://technet.microsoft.com/library/jj649829(v%3Dwps.620).aspx">article</a> . </p><br><h2>  How to recover data encrypted by BitLocker if the token is lost? </h2><br><p>  <b>If you want to open encrypted data in Windows</b> </p><br><p>  To do this, you will need a recovery key, which we printed out earlier.  Just enter it in the appropriate field and the encrypted section will open. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/web/70a/cc8/eb1/70acc8eb1cde49d28bdc88ee063928f9.jpg"></div><br><p>  <b>If you want to open encrypted data on GNU / Linux and Mac OS X systems</b> </p><br><p>  This requires the DisLocker utility and the recovery key. </p><br><p> The DisLocker utility works in two modes: </p><br><ul><li>  FILE - the entire BitLocker encrypted partition is decrypted into a file. </li><li>  FUSE - only the block to which the system refers is decrypted. </li></ul><br><p>  For example, we will use the Linux operating system and the FUSE utility mode. </p><br><p>  In the latest versions of common Linux distributions, the dislocker package is already included in the distribution, for example, in Ubuntu, starting with version 16.10. </p><br><p>  If for some reason the dislocker package was not found, then you need to download the <a href="http://www.hsc.fr/ressources/outils/dislocker/">DisLocker</a> utility and compile it: </p><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-xvjf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dislocker</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tar</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.gz</span></span></code> </pre> <br><p>  Open the INSTALL.TXT file and check which packages we need to install. </p><br><p>  In our case, we need to install the libfuse-dev package: </p><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install libfuse-dev</code> </pre><br><p>  Let's start building the package.  Go to the src folder and use the make and make install commands: </p><br><pre> <code class="hljs go">cd src/ <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> install</code> </pre><br><p>  When everything compiled (or you installed the package) proceed to the configuration. </p><br><p>  Go to the mnt folder and create two folders in it: </p><br><ul><li>  Encrypted-partition ‚Äî for an encrypted partition; </li><li>  Decrypted-partition - for decrypted partition. </li></ul><br><pre> <code class="hljs pgsql">cd /mnt mkdir <span class="hljs-keyword"><span class="hljs-keyword">Encrypted</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> mkdir Decrypted-<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span></code> </pre><br><p>  Find the encrypted partition.  Decrypt it using the utility and move it to the Encrypted-partition folder: </p><br><pre> <code class="hljs pgsql">dislocker -r -V /dev/sda5 -p recovery_key /mnt/<span class="hljs-keyword"><span class="hljs-keyword">Encrypted</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span>&lt;/b&gt;( recovery_key    )</code> </pre><br><p>  Display the list of files in the Encrypted-partition folder: </p><br><pre> <code class="hljs pgsql">ls <span class="hljs-keyword"><span class="hljs-keyword">Encrypted</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span>/</code> </pre><br><p>  Enter the command to mount the partition: </p><br><pre> <code class="hljs pgsql">mount -o <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> Driveq/dislocker-file Decrypted-<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span>/</code> </pre><br><p>  To view the decrypted partition, go to the Encrypted-partition folder. </p><br><h2>  We summarize </h2><br><p>  Enabling volume encryption with BitLocker is easy.  All this is done effortlessly and for free (subject to the availability of a professional or server version of Windows, of course). </p><br><p>  To protect the encryption key that encrypts the disk, you can use a cryptographic token or a smart card, which significantly increases the level of security. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/335532/">https://habr.com/ru/post/335532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335522/index.html">Welford method and one-dimensional linear regression</a></li>
<li><a href="../335524/index.html">Optimization Unity3d UI by GPU (for example minimap) or create a minimap without additional cameras and sprites</a></li>
<li><a href="../335526/index.html">Building recommendations for a job site. Lecture in Yandex</a></li>
<li><a href="../335528/index.html">Receive phonebook entries from a mobile phone without a display</a></li>
<li><a href="../335530/index.html">So you decided to deploy OpenStack</a></li>
<li><a href="../335534/index.html">The digest of interesting materials for the mobile developer # 216 (August 6 - August 13)</a></li>
<li><a href="../335536/index.html">5 popular myths about logo design</a></li>
<li><a href="../335538/index.html">Pygest # 15. Releases, articles, interesting projects from the world of Python [August 01, 2017 - August 14, 2017]</a></li>
<li><a href="../335540/index.html">The calculation of the priority of combinations in Texas Hold'em (poker) for PHP</a></li>
<li><a href="../335544/index.html">A little about ‚Äúashipki‚Äù in software and the help of the theory of the finite state machine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>