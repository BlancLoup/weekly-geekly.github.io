<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About how I spent a week in Bareos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task came to me to organize backup from the GUI and to make it just like the big guys. Previously, there was rsnapshot and everything worked wonde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About how I spent a week in Bareos</h1><div class="post__text post__text-html js-mediator-article">  The task came to me to organize backup from the GUI and to make it just like the big guys.  Previously, there was rsnapshot and everything worked wonderfully until the volumes increased to hundreds of gigabytes, websites and databases, hundreds of test sites.  The server fleet has increased and it has become difficult to manage the whole thing.  Of all the existing solutions, we chose open source and settled on bareos as the one most often used, so that if something happens, quickly google it. <br><a name="habracut"></a><br>  There was a server under Centos 7 OS, raid5 12Tb.  I started with the installation and immediately ran into the fact that someone had already tried to install bareos before me.  In order not to suffer and to remake from scratch turned off the demons mariadb, bareos-sd, bareos-fd, bareos-dir. <br><br><pre><code class="bash hljs">sudo systemctl stop mariadb bareos-dir bareos-sd bareos-fd</code> </pre> <br>  And deleted the old configs: <br><br><pre> <code class="bash hljs">sudo systemctl stop mariadb sudo rm -rf /etc/bareos/* sudo rm -rf /etc/bareos/.* <span class="hljs-comment"><span class="hljs-comment">#         mysql -uroot -p -e "DROP DATABASE IF EXISTS 'bareos';"</span></span></code> </pre><br>  If you do not know the root password: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Reset root mysql password</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo systemctl stop mariadb sudo mysqld_safe --skip-grant-tables &amp; mysql -uroot -e <span class="hljs-string"><span class="hljs-string">"UPDATE mysql.user SET Password=PASSWORD('__') WHERE User='root';"</span></span> sudo systemctl restart mariadb</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">In case we have not installed bareos and mariadb yet.</b> <div class="spoiler_text">  Add the bareos repository: <br><br><pre> <code class="bash hljs">sudo wget http://download.bareos.org/bareos/release/latest/CentOS_7/bareos.repo -O /etc/yum.repos.d/bareos.repo &amp;&amp; sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/7/\$releasever/g'</span></span> /etc/yum.repos.d/bareos.repo &amp;&amp; sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/\/1...\//\/latest\//g'</span></span> /etc/yum.repos.d/bareos.repo</code> </pre><br>  Install the bareos and mariadb packages: <br><br><pre> <code class="bash hljs">sudo yum install -y bareos-client bareos-database-tools bareos-filedaemon bareos-database-mysql bareos bareos-bconsole bareos-database-common bareos-storage bareos-director bareos-common mariadb-server sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> mariadb &amp;&amp; sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> bareos-fd &amp;&amp; sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> bareos-sd &amp;&amp; sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> bareos-dir &amp;&amp; sudo systemctl start mariadb sudo mysql_secure_installation</code> </pre><br>  Create a bareos database: <br><br><pre> <code class="bash hljs">/usr/lib/bareos/scripts/create_bareos_database /usr/lib/bareos/scripts/make_bareos_tables -uroot -p /usr/lib/bareos/scripts/grant_bareos_privileges -uroot -p</code> </pre><br>  Now we have a database and user bareos.  These scripts create a user without a password, specify the password for bareos: <br><br><pre> <code class="bash hljs">mysql -uroot -e <span class="hljs-string"><span class="hljs-string">"UPDATE mysql.user SET Password=PASSWORD('__') WHERE User='bareos';"</span></span></code> </pre><br></div></div><br>  Well, primitive ended, now what was actually plugging.  I always knew that linux is built from a huge number of simple pieces.  It seemed to me difficult to understand how to configure bareos, and this is why.  In many manuals on the Internet, the configuration settings for the bareula bacula ancestor are described, and the documentation is written in such a way that in 3 seconds you don‚Äôt understand what to shove.  Many manuals have errors, in one I did not understand at all why the job section is placed in the storage daemon.  Having smoked all the documentation on bareos and bacula, I realized that if I want to understand, I‚Äôll have to draw each section on a piece of paper and what it does with a complete description of all the parameters and connections between the demons. <br><br><div class="spoiler">  <b class="spoiler_title">Communication scheme with off.</b>  <b class="spoiler_title">documentation</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/130/5f1/b2b/1305f1b2b36d0e4bbe9de818c1a30153.png" alt="image"><br></div></div><br>  So, let's go slowly in pieces.  Forget about all the demons and other stubs except mariadb and bareos-dir.  All the basic functionality is described in the bareos-dir.conf config located in the / etc / bareos / directory.  Directory rights must be 770, the owner of the root group is bareos.  The rights to files in the directory must be 640, the owner of the root group is bareos, if you use subdirectories - do not forget that the execution bit for the directory allows you to view the contents of the directory, therefore the rights of the subdirectories must also be 770, the owner of the root group bareos. <br><br><div class="spoiler">  <b class="spoiler_title">/etc/bareos/bareos-dir.conf</b> <div class="spoiler_text">  # Comments begin on grid, required parameters are not commented out <br>  Director {# beginning of the description of the server section <br>  Name = agima-dir # Name of this server <br>  #WorkingDirectory = "$ HOME / bareos / bin / working" # This is the working directory <br>  #Pid Directory = "$ HOME / bareos / bin / working" # Location of the PID file <br>  QueryFile = "/usr/lib/bareos/scripts/query.sql" # set of sql queries for working with metadata <br>  #Maximum Concurrent Jobs = 10 # Maximum number of simultaneously running tasks <br>  Password = "password" # Password to access this server <br>  #Description = "Main Bareos Director" # Server Description <br>  Messages = Daemon # specify the name of the message generation section <br>  #Auditing = yes # record actions performed on the server (input, start a task, restore, etc.).  This separate parameter spun off the Messages parameter. <br>  #FD Connect Timeout = 180 # time how much to expect a client response <br>  #SD Connect Timeout = 1800 # how long to wait for a response from the storage server <br>  #Maximum Connections = 30 # maximum number of simultaneous connections to this server <br>  #Maximum Console Connections = 30 # maximum number of consoles connected simultaneously to this server <br><br>  #Dir Address = 1.2.3.4 9101 # is a domain name or ip address, the port must be specified through a space or in a separate parameter <br><br>  #Dir Addresses = {# To specify several specific domains and / or ip addresses <br>  # ip = {addr = 1.2.3.4;  port = 1205;} <br>  # ipv4 = {addr = 1.2.3.4;  port = http;} <br>  # ipv6 = {addr = 201: 220: 222 :: 2;  port = 1205;  } <br>  # ip = {addr = server.example.com} <br>  #} <br><br>  #Dir Port = 9101 # port number on which the server will listen <br>  } <br>  # From the @ symbol begin to insert (include) other files <br>  # If you want to insert several files from the directory, you can use the construction below. <br>  # @ | "Sh -c 'for f in /etc/bareos/jobs/*.conf;  do echo @ $ {f};  done '" <br>  #@/etc/bareos/jobs/1.conf <br><br>  # Not all the parameters of the Director section are listed in the file, a more complete list can be obtained on the official website of the program bareos.org <br></div></div><br>  We have described the server, now we can start it: <br><br><pre> <code class="bash hljs">systemctl start bareos-dir</code> </pre><br>  The server is there, it works, but it does nothing and it has no place to put our backups.  The bareos-sd daemon is responsible for posting files, its configuration file is called bareos-sd.conf: <br><br><div class="spoiler">  <b class="spoiler_title">/etc/bareos/bareos-sd.conf</b> <div class="spoiler_text">  Storage {# beginning of the storage daemon description section <br>  #Absolute Job Timeout = 20 # full task timeout <br>  #Allow Bandwidth Bursting = no # allow increasing channel width <br>  #Client Connect Wait = 1800 # time how much to expect console response <br>  #Collect Device Statistics = no # collect statistics on devices <br>  #Collect Job Statistics = no # collect task statistics <br>  #Compatible = no # bacula compatibility mode <br>  Description = "First storage server" # Server Description <br>  #FD Connect Timeout = 1800 # time how much to expect a client response <br>  #File Device Concurrent Read = no # enable simultaneous read from devices <br>  #Maximum Bandwidth Per Job = 1 k / s # Maximum channel width for 1 task, speed values ‚Äã‚Äãk / s, kb / s, m / s or mb / s. <br>  #Maximum Concurrent Jobs = 20 # Maximum number of simultaneous tasks <br>  #Maximum Network Bu Ô¨Ä er Size = 65536 # size of network buffer in bytes, if low speed try to change.  Sometimes to increase the speed it is worth reducing the buffer size. <br>  Messages = Standard # specify the name of the message generation section <br>  Name = agima-sd # name of this storage server <br>  #Pid Directory = / var / lib / bareos # Location of the PID file <br>  #SD Address = 1.2.3.4 9103 # domain name or ip address, the port must be specified through the space or in a separate parameter <br><br>  #SD Addresses = {# To specify several specific domains and / or ip addresses <br>  # ip = {addr = 1.2.3.4;  port = 1205;} <br>  # ipv4 = {addr = 1.2.3.4;  port = http;} <br>  # ipv6 = {addr = 201: 220: 222 :: 2;  port = 1205;  } <br>  # ip = {addr = server.example.com} <br>  #} <br><br>  #SD Connect Timeout = 1800 # Maximum connection timeout <br>  #SD Port = 9103 # port number on which the server will listen <br>  #SD Source Address = # specific (separate) address that the server listens to for communication with the client <br>  #Secure Erase Command = string # parameter to specify which command to use for permanent deletion <br>  #Statistics Collect Interval = 30 # interval for collecting statistics <br>  #Working Directory = / var / lib # working directory <br>  } <br><br>  Director {#beginning of the description of the connection section to this storage server <br>  Name = agima-dir # specify the name of the server that can connect to us <br>  Password = "password1" # password with which will connect <br>  Description = "Backup server" # Description of the server <br>  #Key Encryption Key = password # data encryption key <br>  #Maximum Bandwidth Per Job = 1 k / s # Maximum channel width for 1 task, speed values ‚Äã‚Äãk / s, kb / s, m / s or mb / s. <br>  #Monitor = no # Allows full or limited access to the server.  Restricted access only allows you to view the status of the server. <br>  } <br><br>  Device {# beginning of storage location description <br>  Always Open = no;  # Always keep the device open <br>  Archive Device = / opt / backup # Save Path <br>  #Auto De Ô¨Ç ate = out # The parameter works only when the autox ate-sd module is turned on.  Values: in - compression of streams when reading from the device, out compression when writing to the device, both compressing in both cases. <br>  #Auto De Ô¨Ç ate Algorithm = GZIP # GZIP - gzip level 1‚Äì9, LZO, LZFAST, LZ4, LZ4HC <br>  #Auto De Ô¨Ç ate Level = 6 # compression level <br>  #Auto In Ô¨Ç ate = in # The parameter works only when the autox ate-sd module is turned on.  Values: in - compression of streams when reading from the device, out compression when writing to the device, both compressing in both cases. <br>  #Auto Select = yes # Automatic selection of this device <br>  #Automatic Mount = yes;  # automatically mount device <br>  #Block Checksum = yes # Enables CRC32 checksum checking, also allows you to read broken data <br>  #Check Labels = yes # Enables label checking for non-ANSI format entries. <br>  #Close On Poll = no # remount device <br>  #Collect Statistics = yes # Collect statistics <br>  Description = "Primary raid storage" Device Description <br>  #Device Options = string # device options are used for Ceph and GlusterFS external plugins <br>  Device Type = File # Device Type: Tape Cassettes;  File flash drives, network drives;  GFAPI (GlusterFS);  Rados (Ceph Object Store);  Fifo devices follow access read-only or write-only. <br>  Label Media = yes;  # allow the server to set the label on the blocks / accept Bareos set label unlabeled media <br>  Label Type = primary # label to be set <br>  Maximum Concurrent Jobs = 4 # maximum number of simultaneous tasks <br>  Maximum File Size = 500 Gb # maximum file size <br>  #Maximum Job Spool Size = # Maximal Task Queue Size <br>  #Maximum Network Bu Ô¨Ä er Size = 65536 # size of network buffer in bytes, if low speed try to change.  Sometimes to increase the speed it is worth reducing the buffer size. <br>  Maximum Open Volumes = 1 # maximum number of open volumes <br>  Maximum Open Wait = 15 # maximum device wait time <br>  #Maximum Spool Size = # Maximum amount of task queue <br>  Media Type = File # is a text parameter where you can freely specify the type of device you like best <br>  #Mount Command = Strname # mount command of this device <br>  #Mount Point = Strname # mount point <br>  Name = AgimaStorage # name of this storage location <br>  Random Access = yes;  # indicates support for random data access; tapes do not have this capability <br>  Removable Media = no;  # specify if the device is turned off <br>  Requires Mount = no # whether this device should be mounted <br>  #Spool Directory = directory # Directory for creating temporary files, default is working directory <br>  #Unmount Command = Strname # unmount command <br>  #Volume Capacity = # volume size <br>  } <br><br>  Messages { <br>  Name = Standard # name of the current notification <br>  Description = "Standard messages file daemon" # description of the notification <br>  #Mail Command = # command to send email, must be described before the parameters Mail, Mail On Error, Mail On Success <br>  #Mail Command = "/ usr / sbin / bsmtp -h mail.example.com -f \" \ (Bareos \) \% r \ "-s \" Bareos: \% t ‚Äã‚Äã\% e of \% c \% l \ "\% r" <br><br>  ## %% =% percent symbol <br>  ##% c = Client's name \ Client name <br>  ##% d = Director's name \ Server Name <br>  ##% e = Job Exit code (OK, Error, ...) \ Completion Status <br>  ##% h = Client address \ client host <br>  ##% i = Job Id \ Task ID <br>  ##% j = Unique Job name \ Unique task name <br>  ##% l = Job level \ task priority <br>  ##% n = Job name \ Task name <br>  ##% r = Recipients \ Recipients <br>  ##% s = Since time \ # I will be glad if someone explains what this parameter means <br>  ##% t = Job type (eg Backup, ...) \ Task Type <br>  ##% v = Read Volume name (Only on director side) \ Read volume with name <br>  ##% V = Write Volume name (Only on director side) \ Volume with name is written <br><br>  #Operator Command = string # must be described before the Operator parameter.  Same as Mail Command, but sends to operator <br><br>  ## Notification types message-type: <br>  ## info info messages <br>  ## warning Notifications <br>  ## error errors <br>  ## fatal errors due to which tasks stop <br>  ## terminate message when server is shut down <br>  ## notsaved files not saved <br>  ## skipped skipped files that fall into exceptions either during an incremental backup or with other settings or user actions <br>  ## mount mount completed <br>  ## restored list of recovered files <br>  ## all all posts <br>  ## security info and warning messages only when trying to connect <br>  ## alert messages generated by tape alerts <br>  ## volmgmt volume management messages <br>  ## audit action messages <br><br>  #Append = [address =] message-type [, message-type] * # Add a message to the file, if the file does not exist, it will be created <br>  director = backup-dir = all # sending a message to the bareos server <br>  #Catalog = # send message to the catalog database <br>  #Console = # send message to console <br>  #File = # sending a message to a file, if the file exists, it will be overwritten <br>  #Mail = # send message to the specified address <br>  #Mail On Error = # email on error <br>  #Mail On Success = email on success <br>  #Operator = # send email to the specified address to the operator <br>  #Stderr = # send message to standard error output <br>  #Stdout = # send message to standard output <br>  #Syslog = # send syslog message <br>  } <br></div></div><br>  So now we set up the storage server, connect it to our server, add to the end of the file: <br><br><div class="spoiler">  <b class="spoiler_title">/etc/bareos/bareos-dir.conf</b> <div class="spoiler_text">  Storage { <br>  Address = 127.0.0.1 # address to connect to <br>  Allow Compression = yes Whether to allow compression <br>  #Auth Type = MD5 # authorization method None | Clear | MD5 <br>  #Collect Statistics = yes # Whether to collect statistics <br>  Description = "Primary storage" # Description of the current section <br>  Device = FirstStorage # device used, the value is equal to the name parameter of the device section <br>  Enabled = yes # whether the storage server is enabled <br>  #Maximum Bandwidth Per Job = 1 k / s # Maximum channel width for 1 task, speed values ‚Äã‚Äãk / s, kb / s, m / s or mb / s. <br>  #Maximum Concurrent Jobs = 1 # maximum number of simultaneous tasks <br>  #Maximum Concurrent Read Jobs = 0 # maximum number of simultaneous tasks per reading <br>  Media Type = File # is a text parameter where you can freely specify the type of device which one you like best <br>  Name = agima-sd # name of this section <br>  Password = password1 # password to connect to the storage server <br>  #Port = 9103 # port to connect to <br>  } <br><br>  Catalog { <br>  DB Address = localhost # Database Network Address <br>  DB Driver = mysql # Select DBMS postgresql |  mysql |  sqlite <br>  DB Name = bareos # Database Name <br>  DB Password = "123" # User Password for DBMS <br>  DB Port = 3306 # Port on which the database is running <br>  #DB Socket = string # path to the Database socket, if we use a socket <br>  DB User = bareos # Subd user DBMS <br>  Description = "Catalog metadata for bareos" # Description Sections <br>  Disable Batch Insert = no # Enables multiple inserts <br>  #Exit On Fatal = no # close the program on error <br>  #Idle Timeout = 30 # Waiting time for communication with the base <br>  #Inc Connections = 1 # If free connections have ended, you can add how much is specified in this parameter <br>  #Max Connections = 5 # Maximum number of connections <br>  #Min Connections = 1 # Minimum number of connections <br>  Name = agima-meta # Name of the current section <br>  Reconnect = yes # Reconnect to the database if the connection is broken <br>  #Validate Timeout = 120 # Time to check if the database is working or not <br>  } <br><br></div></div><br>  Reboot the server and start storage: <br><br><pre> <code class="bash hljs">sudo systemctl restart bareos-dir sudo systemctl start bareos-sd</code> </pre><br>  If there is no connection between them, configure the firewall. <br><br>  Now we have a server and a place to put backups.  Servers are running, but there is no one to back up.  Set up a client who will make backups.  The client is the bareos-fd daemon, its configuration file is called bareos-fd.conf and it is the simplest: <br><br><div class="spoiler">  <b class="spoiler_title">/etc/bareos/bareos-fd.conf</b> <div class="spoiler_text">  Client { <br>  #Absolute Job Timeout = 20 # full task timeout <br>  #Allow Bandwidth Bursting = yes # allow increasing channel width <br>  #Allowed Job Command = # Types of allowed commands for this client: backup creating backups;  restore restore files;  verify file verification;  estimate check allowed commands;  runscript running scripts <br>  #Allowed Script Dir = # Directories from which the client is allowed to run scripts <br>  #Compatible = no # bacula compatibility mode <br>  Description = "First client on server example.com" # client description <br>  #FD Address = 1.2.3.4 9102 # domain name or ip address, the port must be specified through a space or in a separate parameter <br>  #FD Addresses = {# To specify several specific domains and / or ip addresses <br>  # ip = {addr = 1.2.3.4;  port = 1205;} <br>  # ipv4 = {addr = 1.2.3.4;  port = http;} <br>  # ipv6 = {addr = 201: 220: 222 :: 2;  port = 1205;  } <br>  # ip = {addr = server.example.com} <br>  #} <br>  #FD Port = 9102 # port number on which the client will listen <br>  #FD Source Address = # specific (separate) address that the client listens to in order to communicate with the storage server <br>  #Maximum Bandwidth Per Job = 1 k / s # Maximum channel width for 1 task, speed values ‚Äã‚Äãk / s, kb / s, m / s or mb / s. <br>  #Maximum Concurrent Jobs = 20 # Maximum number of simultaneous tasks <br>  #Maximum Network Bu Ô¨Ä er Size = 65536 # size of network buffer in bytes, if low speed try to change.  Sometimes to increase the speed it is worth reducing the buffer size. <br>  Messages = standard # specify the name of the message generation section <br>  Name = agima-client # Name of this client <br>  #Pid Directory = / var / lib / bareos # PID file storage directory <br>  #Scripts Directory = directory # Directory where scripts are stored <br>  #SD Connect Timeout = 1800 # Timeout for connecting to the storage server <br>  #Secure Erase Command = string # Command to return permanently <br>  #Working Directory = / var / lib / bareos # Working Directory <br>  } <br><br>  Director { <br>  #Address = 1.2.3.4 # Address to which we are connecting <br>  #Allowed Job Command = # Types of allowed commands for the server: backup creating backups;  restore restore files;  verify file verification;  estimate check allowed commands;  runscript running scripts <br>  #Allowed Script Dir = "/ etc / bareos" # Directories from which the server is allowed to run scripts <br>  #Allowed Script Dir = "/ path / that / is / also / allowed" # <br>  Description = "General backup server" # Server Description <br>  #Maximum Bandwidth Per Job = 1 k / s # Maximum channel width for 1 task, speed values ‚Äã‚Äãk / s, kb / s, m / s or mb / s. <br>  #Monitor = no # Allows full or limited access to the server.  Restricted access only allows you to view the status of the server. <br>  Name = backup-dir # Name of the server that can connect <br>  Password = Md5password # password to connect to the client encrypted in md5 <br>  } <br><br>  Messages { <br>  Name = Standard # name of the current notification <br>  Description = "Standard messages file daemon" # description of the notification <br>  #Mail Command = # command to send email, must be described before the parameters Mail, Mail On Error, Mail On Success <br>  #Mail Command = "/ usr / sbin / bsmtp -h mail.example.com -f \" \ (Bareos \) \% r \ "-s \" Bareos: \% t ‚Äã‚Äã\% e of \% c \% l \ "\% r" <br><br>  ## %% =% percent symbol <br>  ##% c = Client's name \ Client name <br>  ##% d = Director's name \ Server Name <br>  ##% e = Job Exit code (OK, Error, ...) \ Completion Status <br>  ##% h = Client address \ client host <br>  ##% i = Job Id \ Task ID <br>  ##% j = Unique Job name \ Unique task name <br>  ##% l = Job level \ task priority <br>  ##% n = Job name \ Task name <br>  ##% r = Recipients \ Recipients <br>  ##% s = Since time \ # I will be glad if someone explains what this parameter means <br>  ##% t = Job type (eg Backup, ...) \ Task Type <br>  ##% v = Read Volume name (Only on director side) \ Read volume with name <br>  ##% V = Write Volume name (Only on director side) \ Volume with name is written <br><br>  #Operator Command = string # must be described before the Operator parameter.  Same as Mail Command, but sends to operator <br><br>  ## Notification types message-type: <br>  ## info info messages <br>  ## warning Notifications <br>  ## error errors <br>  ## fatal errors due to which tasks stop <br>  ## terminate message when server is shut down <br>  ## notsaved files not saved <br>  ## skipped skipped files that fall into exceptions either during an incremental backup or with other settings or user actions <br>  ## mount mount completed <br>  ## restored list of recovered files <br>  ## all all posts <br>  ## security info and warning messages only when trying to connect <br>  ## alert messages generated by tape alerts <br>  ## volmgmt volume management messages <br>  ## audit action messages <br><br>  #Append = [address =] message-type [, message-type] * # Add a message to the file, if the file does not exist, it will be created <br>  director = backup-dir = all # sending a message to the bareos server <br>  #Catalog = # send message to the catalog database <br>  #Console = # send message to console <br>  #File = # sending a message to a file, if the file exists, it will be overwritten <br>  #Mail = # send message to the specified address <br>  #Mail On Error = # email on error <br>  #Mail On Success = email on success <br>  #Operator = # send email to the specified address to the operator <br>  #Stderr = # send message to standard error output <br>  #Stdout = # send message to standard output <br>  #Syslog = # send syslog message <br>  } <br></div></div><br>  Hurray we described the client, now connect it to our server, insert it at the end of the bareos-dir.conf file: <br><br><div class="spoiler">  <b class="spoiler_title">/etc/bareos/bareos-dir.conf</b> <div class="spoiler_text">  Client { <br>  #Allow Client Connect = yes # allow incoming connections from client <br>  #Auth Type = MD5 # Authorization Type None | Clear | MD5 <br> #Auto Prune = no #         <br> #Catalog = resource-name #      <br> #Description = string #    <br> #Enabled = yes #     <br> #FD Address = string #      <br> #FD Password = password #      <br> #FD Port = 9102 #    <br> #File Retention = 5184000 #        <br> #Hard Quota = 0 #     ,     <br> #Job Retention = 15552000 #        <br> #Maximum Bandwidth Per Job = 1 k/s #     1 ,   k/s, kb/s, m/s or mb/s. <br> #Maximum Concurrent Jobs = 1 #      <br> #Name = agima-client #       <br> #Passive = no #  ,    <br> #Quota Include Failed Jobs = yes #       <br> #Soft Quota = 0 #     ,      <br>  } <br><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start the client, restart the server and as usual do not forget to configure the firewall. </font></font><br><br><pre> <code class="bash hljs">sudo systemctl restart bareos-dir sudo systemctl start bareos-fd</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we have everything, but backups are not made anyway. </font><font style="vertical-align: inherit;">Add tasks and schedule for their execution.</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"> Pool { <br> #Action On Purge = Truncate #         <br> Auto Prune = yes #     <br> Catalog = resource-name #       <br> Catalog Files = yes #      <br> Description = string #   <br> #File Retention = time #         <br> #Job Retention = time #         <br> Label Format = ¬´backup-¬ª #     <br> #Label Type = ANSI|IBM|Bareos #   <br> #Maximum Blocksize = positive-integer #      63B <br> Maximum Volume Bytes = Size64 #   (  ) <br> Maximum Volume Files = positive-integer #       <br> Maximum Volume Jobs = positive-integer #       <br> Maximum Volumes = positive-integer #    <br> Name = agima-pool #    <br> Pool Type = Strname #   Backup, *Archive, *Cloned, *Migration, *Copy, *Save <br> Purge Oldest Volume = yes #    <br> Recycle = yes #   ,         <br> Recycle Current Volume = yes #    <br> Recycle Oldest Volume = yes #    <br> Recycle Pool = resource-name #  ,        <br> Scratch Pool = resource-name #  Scratch      ‚Äî            <br> Storage = ResourceList #    <br> Use Catalog = yes #     <br> Volume Retention = 31536000 #         <br> Volume Use Duration = 7 days #       <br>  } <br><br> FileSet { #    <br> Description = string #    <br> #Enable VSS = yes #      Windows <br> Name = agima-site#     <br> # Exclude { #      <br> # Options { <br> # AutoExclude = yes #   Windows.     . <br> # fstype=ext2 #        . ext2, jfs, ntfs, proc, reiserfs, xfs, usbdevfs, sysfs, smbfs, iso9660 <br> # sparse=yes #  raw      32    <br> # onefs=yes #   1   <br> # signature=MD5 # SHA1    . <br> # recurse=yes #     <br> # noatime=yes #       <br> # mtimeonly=yes #        st_mtime.       st_ctime. <br> # keepatime=yes #     <br> # checkÔ¨Ålechanges=yes #    <br> # aclsupport=yes #       <br> # xattrsupport=yes #     <br> # ignore case=yes #    <br> # DriveType=Windows-drive-type #     Windows: removable, Ô¨Åxed, remote, cdrom, ramdisk <br> # hfsplussupport=yes #    apple <br><br> # size= <br> #- ‚Äî Select Ô¨Åle in range size ‚Äî size. #    <br> #&lt;size ‚Äî Select Ô¨Åles smaller than size. #      <br> #&gt;size ‚Äî Select Ô¨Åles bigger than size. #      <br> #size ‚Äî Select Ô¨Åles which are within 1 % of size. #    ¬± 1% <br><br> # verify= <br> #i compare the inodes #    <br> #p compare the permission bits #     <br> #n compare the number of links #     <br> #u compare the user id #    <br> #g compare the group id #    <br> #s compare the size #   <br> #a compare the access time #    <br> #m compare the modiÔ¨Åcation time (st_mtime) #    <br> #c compare the change time (st_ctime) #    <br> #d report Ô¨Åle size decreases #     <br> #5 compare the MD5 signature #     MD5 <br> #1 compare the SHA1 signature #     SHA1 <br> #A Only for Accurate option, it allows to always backup the Ô¨Åle #  Accurate     (    ,      /      ) <br><br> # compression=GZIP5 #   GZIP1-9|LZO|LZFAST|LZ4|LZ4HC <br> # } <br> # File = "|sh -c 'df -l | grep \"^/dev/hd[ab]\" | grep -v \".*/tmp\" | awk \"{print <span>\</span>$6}\"'" <br> # File = / <br> # File = /usr <br> # } <br> Ignore File Set Changes = no #    ,         .    yes        . <br> # Include { #      <br> # Options { <br> # File = / <br> # File = /usr <br> # Exclude Dir Containing = .nobackup #     <br> # } <br>  } <br><br> Schedule { <br> Description = string #   <br> Enabled = yes #   <br> Name = MonthlyCycle #    <br> Run = Level=Full Pool=Monthly 1st sun at 2:05 <br> Run = Level=Differential 2nd-5th sun at 2:05 <br> Run = Level=Incremental Pool=Daily mon-sat at 2:05 <br> #  jan | feb | mar | apr | may | jun | jul | aug | sep | oct | nov | dec | january | february |‚Ä¶ | december | monthly <br> #   sun | mon | tue | wed | thu | fri | sat | sunday | monday | tuesday | wednesday | thursday | friday | saturday |  daily <br> #     1st | 2nd | 3rd | 4th | 5th | Ô¨Årst | second | third | fourth | Ô¨Åfth | last <br> #    ¬´at 00:00¬ª <br> #     w00 | w01 |‚Ä¶ w52 | w53 <br> #         "-" <br>  } <br><br> Job { <br> Accurate = yes #     ,    ,             <br> Add PreÔ¨Åx = string #   <br> Add SuÔ¨Éx = string #   <br> Allow Duplicate Jobs = yes #     <br> Allow Higher Duplicates = yes #   ,       <br> Allow Mixed Priority = no #    ,     <br> Base = ResourceList #      ,      ,  .   . <br> Bootstrap = directory #        ,      <br><br> #%% ‚Äî % <br> #%c ‚Äî   <br> #%d ‚Äî   <br> #%e ‚Äî   (OK, Error, Fatal Error, Canceled, Differences, Unknown term code) <br> #%i ‚Äî   <br> #%j ‚Äî    <br> #%l ‚Äî    <br> #%n ‚Äî   <br> #%s ‚Äî  (?) <br> #%t ‚Äî   <br> #%v ‚Äî   <br><br> Cancel Lower Level Duplicates = yes #   ,     <br> Cancel Queued Duplicates = yes #             ,    <br> Cancel Running Duplicates = yes #           ,    <br> Catalog = agima-meta #       <br> Client = agima-client #      <br> Client Run After Job = RunscriptShort #        <br> Client Run Before Job = RunscriptShort #        <br> Description = string #   <br> DiÔ¨Äerential Backup Pool = agima-pool #      <br> DiÔ¨Äerential Max Runtime = time #      <br> Enabled = yes #    <br> File Set = agima-site #     <br> Full Backup Pool = agima-pool #      <br> Full Max Runtime = time #      <br> Incremental Backup Pool = agima-pool #      <br> #Incremental Max Runtime = time #      <br> #Job Defs = resource-name #    . <br> #Job To Verify = resource-name #     <br> Level = BackupLevel #     :    VirtualFull | Full | Incremental | DiÔ¨Äerential,   InitCatalog        | Catalog      | VolumeToCatalog                  | DiskToCatalog       ,   Restore. <br> Max Concurrent Copies = 100 #       <br> Max DiÔ¨Ä Interval = time #         ,           <br> Max Full Interval = time #         ,           <br> Max Run Time = time #    <br> Max Start Delay = time #       <br> Max Virtual Full Interval = time #          ,            <br> Max Wait Time = time #       <br> Maximum Bandwidth = k/s #   ,   k/s, kb/s, m/s or mb/s. <br> Maximum Concurrent Jobs = 1 #     <br> Maxrun Sched Time = time # (Max Start Delay + Max Run Time) <br> Messages = standard required #   <br> Name = agima-site required #    <br> #Next Pool = resource-name #       <br> Pool = agima-pool #   <br> Prefer Mounted Volumes = yes #       <br> PreÔ¨Åx Links = no #   ¬´  ¬ª       <br> Priority = 10 #       . 1-255 <br> Prune Files = no #     <br> Prune Jobs = no #     <br> Prune Volumes = no #     <br> Purge Migration Job = no #      <br> Regex Where = string #   <br> Replace = Always # always ‚Äî , ifnewer ‚Äî  , never ‚Äî , ifolder ‚Äî          <br> Rerun Failed Levels = yes #      <br> Reschedule Interval = 1800 #     <br> Reschedule On Error = yes #     <br> Reschedule Times = 5 #     <br> Run = ¬´Nightly-backup level=%l since=\¬ª%s\" storage=DDS-4" #  , ,    <br> Run Script { <br> Command = ¬´echo test¬ª #   <br> Runs When = After #   Never  | Before  | After  | Always  | AfterVSS    <br> Runs On Failure = yes #    <br> Runs On Client = no #    <br> Runs On Success = yes #    <br>  } <br> Schedule = MonthlyCycle #   <br> Storage = ResourceList #    <br> Strip PreÔ¨Åx = string #      <br> Type = JobType # Backup  , Restore  , Verify  , Migrate  , Admin      , Copy       <br> #Virtual Full Backup Pool = resource-name #       <br> Where = directory #      <br> Write Bootstrap = directory #     <br> Write Verify List = directory #     <br>  } <br><br> Messages { <br> Name = Standard #    <br> Description = ¬´Standard messages file daemon¬ª #   <br> #Mail Command = #   email,      Mail, Mail On Error, Mail On Success <br> #Mail Command = "/usr/sbin/bsmtp -h mail.example.com -f \"\(Bareos\) \%r\" -s \¬´Bareos: \%t \%e of \%c \%l\¬ª \%r" <br><br> ##%% = %   <br> ##%c = Client's name \   <br> ##%d = Director's name \   <br> ##%e = Job Exit code (OK, Error, ...) \   <br> ##%h = Client address \   <br> ##%i = Job Id \   <br> ##%j = Unique Job name \    <br> ##%l = Job level \   <br> ##%n = Job name \   <br> ##%r = Recipients \  <br> ##%s = Since time \ #            <br> ##%t = Job type (eg Backup, ...) \   <br> ##%v = Read Volume name (Only on director side) \     <br> ##%V = Write Volume name (Only on director side) \     <br><br> #Operator Command = string #      Operator.  Mail Command,    <br><br> ##  message-type: <br> ##info   <br> ##warning  <br> ##error  <br> ##fatal  -    <br> ##terminate     <br> ##notsaved    <br> ##skipped  ,               <br> ##mount   <br> ##restored    <br> ##all   <br> ##security  info  warning     <br> ##alert   tape alerts <br> ##volmgmt    <br> ##audit     <br><br> #Append = [ address = ] message-type [, message-type ]* #    ,        <br> director = backup-dir = all #     bareos <br> #Catalog = #       <br> #Console = #     <br> #File = #    ,       <br> #Mail = #      <br> #Mail On Error = # email   <br> #Mail On Success = # email   <br> #Operator = #  email     <br> #Stderr = #       <br> #Stdout = #      <br> #Syslog = #    Syslog  <br>  } <br><br>       ,           .    . </div></div></div><p>Source: <a href="https://habr.com/ru/post/272869/">https://habr.com/ru/post/272869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272857/index.html">The world's worst captcha for a multimillion-dollar site.</a></li>
<li><a href="../272861/index.html">Java 9 First Steps and the Jigsaw Project - Part Two</a></li>
<li><a href="../272863/index.html">What happened to hook_menu in Drupal 8?</a></li>
<li><a href="../272865/index.html">We are replacing the Bing search engine with the necessary one in Skype</a></li>
<li><a href="../272867/index.html">Organization of a hybrid port on the Alcatel-Lucent 7210 SAS-M</a></li>
<li><a href="../272871/index.html">Haskell for VK, Javascript and ReactJS, Or Alien vs. The Simpsons</a></li>
<li><a href="../272873/index.html">PhoneGap vs. Cordova</a></li>
<li><a href="../272875/index.html">Animated screen orientation changes in a Windows Phone application</a></li>
<li><a href="../272879/index.html">Live Web Standards Days and Community DevCamp on the weekend</a></li>
<li><a href="../272881/index.html">Tanchiki, sand and augmented reality. Using Intel RealSense</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>