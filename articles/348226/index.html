<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a game for Android on Python based on Kivy. From A to Z: pitfalls and non-obvious solutions. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I decided to try to write something in Python under Android. Such a strange choice for many is due to the fact that I love Python and I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a game for Android on Python based on Kivy. From A to Z: pitfalls and non-obvious solutions. Part 1</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I decided to try to write something in Python under Android.  Such a strange choice for many is due to the fact that I love Python and I love Android, and I also like to do something unusual (well, <i>not the most usual</i> ).  <a href="https://kivy.org/">Kivy</a> was chosen as the framework - in fact, the only alternative, but I really liked it.  However, there is not too much information on it (no, the documentation is excellent, but sometimes it is not enough), especially in Russian, and although some things can be implemented, they either haven't done them before, or have not considered it necessary to share information .  Well, I thought :) And this post is the result. <br><br>  Under the cut, I will talk about all the stages of development, how a simple idea developed and how to do this, we had to look for new opportunities, new pitfalls and bugs, unclear solutions and outdated documentation :) The goal is to describe the main points in one text. the person who decided to write something a little more difficult than playing Pong from the official tutorial did not have to search through the official support forum and StackOverflow and spend hours on what is being done in a couple of minutes if you know how. <br><a name="habracut"></a><br><h3>  0. If for the first time you hear about Kivy ... </h3><br>  ... it all depends on whether you like Python and Android, and whether you are interested in understanding this.  If not, it is easier to score :) And if yes, then you need to start with the <a href="https://kivy.org/docs/api-kivy.html">official documentation</a> , <a href="https://kivy.org/docs/gettingstarted/intro.html">guides</a> , and the already mentioned official <a href="https://kivy.org/docs/tutorials/pong.html">tutorial on the game Pong</a> - this will give a basic understanding of the framework and its capabilities.  I will not dwell on such trivial things (especially since the tutorial is great for understanding the basic principles) and I will go further.  We assume that it was an introduction :) <br><br><h3>  1. A little about my game </h3><br>  First you needed an idea.  I wanted something simple enough to appreciate the capabilities of the framework, but also quite interesting and original, so as not to program for the sake of programming (this is great, but when it‚Äôs not the only goal, it‚Äôs even better).  I design interfaces well, but I don‚Äôt know how to draw, so the game had to be simple graphically, or even text-based.  And it just so happened that I had an abandoned website with quotes from which I once started my way in web development (I even wrote about it on Habr√© many years ago).  Therefore, the idea arose like this: a quiz game "Guess the quote".  In the Russian-language Google Play there was nothing of the kind, and in English there was a pair of low-quality crafts with hundreds of downloads. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Almost immediately it became clear that just to guess the quote after quote was boring.  So the first "chips" appeared, which, as a result, determined the final game.  First of all, these were thematic packages (that is, packages of quotes combined by one theme or author) and points (which are charged for guessing quotes and passing packages, and are spent on tips and unlocking new topics), as well as statistics, achievements and favorites. <br><br><div class="spoiler">  <b class="spoiler_title">Some pictures</b> <div class="spoiler_text">  So it all began (clickable): <br> <a href=""><img src="https://habrastorage.org/webt/wn/ue/l1/wnuel1afhkiggtdsuabgr0ex0q4.png" align="left"></a> <a href=""><img src="https://habrastorage.org/webt/2l/k2/gt/2lk2gtnvh0y7gjm2ve-7sbp9hii.png" align="left"></a> <a href=""><img src="https://habrastorage.org/webt/gz/ub/g_/gzubg_wqcqqhbwfjg87ygkrmrrc.png"></a> <br><br>  Well, okay, okay, I will not show such horror anymore :) By the way, this is how it looks now (also clickable, screenshots are taken from Google Play): <br> <a href=""><img src="https://habrastorage.org/webt/7d/bh/yi/7dbhyi2gpvyh5e13zr9g_jks2_g.png" align="left"></a> <a href=""><img src="https://habrastorage.org/webt/wf/pw/j2/wfpwj2u3x6sayzhsnxzbbv9wxs8.png" align="left"></a> <a href=""><img src="https://habrastorage.org/webt/g_/g0/fk/g_g0fk1mzv10viotsw5mbsazlze.png"></a> </div></div><br>  The first problems started from the first screen ... <br><br><h3>  2. Kivy brake or am I doing something wrong? </h3><br>  A friend of mine likes to answer such ‚Äúyes‚Äù questions :) In fact, some things in Kivy are really slow, for example, creating widgets.  But this does not mean that this matter cannot be optimized.  I'll tell you about it. <br><br>  Since quotes and topics are stored in the database, then, of course, the buttons with packages are generated dynamically.  And it was here that I discovered that this is happening very slowly: about half a second per list of 20 buttons.  Perhaps this is not very much when downloading the application, but when switching to the main screen from other internal screens of the application is inadmissibly a lot.  It is worth noting that by that time the button was, in fact, a set of several elements that visually constitute one button: <br><br><img src="https://habrastorage.org/webt/r3/fo/oy/r3fooydobsk4f-s-pu0iqjz7ytk.png"><br><br>  My first impulse was to cache them in one way or another, and, indeed, experience showed that if you create all widgets in advance and save them as a property of the StartScreen object, then everything (except the first generation) works fairly quickly.  However, the data in the buttons must be periodically updated (at least the same number of quotations that have been guessed).  Yes, and I already planned to download new packages.  Of course, it‚Äôs not a problem to realize this, but I decided not to reinvent the wheel and think. <br><br>  At first, it was worth making sure that the problem was in the creation of widgets, so in a few minutes I sketched a simple application on two screens, each of which generated a set of lines from the label and the checkbox of 50 pieces.  :) <br><br><div class="spoiler">  <b class="spoiler_title">Test application source code</b> <div class="spoiler_text">  main.py: <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.screenmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ScreenManager, Screen <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.boxlayout <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BoxLayout <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ObjectProperty, StringProperty <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Screen)</span></span></span><span class="hljs-class">:</span></span> items_box = ObjectProperty(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> start = time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>): self.items_box.add_widget(ListItem(<span class="hljs-string"><span class="hljs-string">'Item '</span></span>+str(i))) self.items_box.bind(minimum_height=self.items_box.setter(<span class="hljs-string"><span class="hljs-string">'height'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> time()-start <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_leave</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.items_box.clear_widgets() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListItem</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BoxLayout)</span></span></span><span class="hljs-class">:</span></span> title = StringProperty(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, title, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super(ListItem, self).__init__(**kwargs) self.title = title <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> sm = ScreenManager() screens = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.__create_screens() ListApp.sm.add_widget(ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span>]) Clock.schedule_interval(self._switch, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ListApp.sm <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_switch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> ListApp.sm.switch_to(ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ListApp.sm.current != <span class="hljs-string"><span class="hljs-string">'list1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'list2'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__create_screens</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span>] = ListScreen(name=<span class="hljs-string"><span class="hljs-string">'list1'</span></span>) ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list2'</span></span>] = ListScreen(name=<span class="hljs-string"><span class="hljs-string">'list2'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: ListApp().run()</code> </pre> <br>  list.kv: <br><br><pre> <code class="hljs css">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">ListScreen</span></span>&gt;: <span class="hljs-selector-tag"><span class="hljs-selector-tag">items_box</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">items_box</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BoxLayout</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">orientation</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">vertical</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">AnchorLayout</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_y</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">padding</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">self</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.width</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">self</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.height</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.05</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Label</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">font_size</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">root</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.height</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.05</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">Some</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">list</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">ScrollView</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_y</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">self</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.size</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BoxLayout</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">items_box</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">orientation</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">vertical</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">padding</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">self</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.width</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>, 0 <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_y</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">None</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">ListItem</span></span>&gt;: <span class="hljs-selector-tag"><span class="hljs-selector-tag">orientation</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">horizontal</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_y</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">None</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">height</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.height</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Label</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">font_size</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.sm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.height</span></span>*0<span class="hljs-selector-class"><span class="hljs-selector-class">.025</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">text</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">root</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.title</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_x</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">text_size</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">self</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.size</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">valign</span></span>: "<span class="hljs-selector-tag"><span class="hljs-selector-tag">middle</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">CheckBox</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">size_hint_x</span></span>: 0<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> </div></div><br>  I launched it on my old Moto G (gen3) and got: <br><br><pre> <code class="hljs css">11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-28</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:09.525</span></span> 1848 2044 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.5793800354</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-28</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10.853</span></span> 1848 2044 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.453143119812</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-28</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12.544</span></span> 1848 2044 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.633069992065</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-28</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:13.697</span></span> 1848 2044 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.369570970535</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-28</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:44</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:14.988</span></span> 1848 2044 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.594089031219</span></span></code> </pre> <br>  And further in the same vein.  Search on this issue did not give anything, so I turned to the developers.  And he received the answer: ‚ÄúCreating widgets is relatively slow, especially depending on what they contain.  It‚Äôs better to use RecycleView to create large lists. ‚Äù  Here I want to explain why I generally describe this moment, because the description of RecycleView <a href="https://kivy.org/docs/api-kivy.uix.recycleview.html">is in the documentation</a> .  Yes, indeed, there is, but few people are able to study and remember all the documentation before starting development, and finding the right tool is not easy, especially if it is not described anywhere in the context of solving a specific problem.  Now he is described :) <br><br><div class="spoiler">  <b class="spoiler_title">Test application source code with RecycleView</b> <div class="spoiler_text">  main.py: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.screenmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ScreenManager, Screen <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ObjectProperty <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListScreen</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Screen)</span></span></span><span class="hljs-class">:</span></span> recycle_view = ObjectProperty(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) items_box = ObjectProperty(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_enter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> start = time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>): self.recycle_view.data.append({<span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-string"><span class="hljs-string">'item'</span></span>+str(i)}) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> time()-start <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_leave</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.recycle_view.data = [] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> sm = ScreenManager() screens = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.__create_screens() ListApp.sm.add_widget(ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span>]) Clock.schedule_interval(self._switch, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ListApp.sm <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_switch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> ListApp.sm.switch_to(ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ListApp.sm.current != <span class="hljs-string"><span class="hljs-string">'list1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'list2'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__create_screens</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list1'</span></span>] = ListScreen(name=<span class="hljs-string"><span class="hljs-string">'list1'</span></span>) ListApp.screens[<span class="hljs-string"><span class="hljs-string">'list2'</span></span>] = ListScreen(name=<span class="hljs-string"><span class="hljs-string">'list2'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: ListApp().run()</code> </pre> <br>  list.kv: <br><pre> <code class="hljs rust">&lt;ListScreen&gt;: recycle_view: recycle_view items_box: items_box BoxLayout: orientation: <span class="hljs-string"><span class="hljs-string">"vertical"</span></span> AnchorLayout: size_hint_y: <span class="hljs-number"><span class="hljs-number">0.1</span></span> padding: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.width*<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.height*<span class="hljs-number"><span class="hljs-number">0.05</span></span> Label: font_size: root.height*<span class="hljs-number"><span class="hljs-number">0.05</span></span> text: <span class="hljs-string"><span class="hljs-string">"Some list"</span></span> RecycleView: id: recycle_view size_hint: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.9</span></span> viewclass: <span class="hljs-string"><span class="hljs-string">"ListItem"</span></span> RecycleBoxLayout: id: items_box orientation: <span class="hljs-string"><span class="hljs-string">"vertical"</span></span> padding: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.width*<span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> default_size_hint: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">None</span></span> size_hint: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">None</span></span> height: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.minimum_height &lt;ListItem@BoxLayout&gt;: orientation: <span class="hljs-string"><span class="hljs-string">"horizontal"</span></span> size_hint: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">None</span></span> height: app.sm.height*<span class="hljs-number"><span class="hljs-number">0.1</span></span> title: '' Label: font_size: app.sm.height*<span class="hljs-number"><span class="hljs-number">0.025</span></span> text: root.title size_hint_x: <span class="hljs-number"><span class="hljs-number">0.9</span></span> text_size: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.size valign: <span class="hljs-string"><span class="hljs-string">"middle"</span></span> CheckBox size_hint_x: <span class="hljs-number"><span class="hljs-number">0.1</span></span></code> </pre> </div></div><br><pre> <code class="hljs css">11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-29</span></span> 13<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:58.196</span></span> 13121 13203 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00388479232788</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-29</span></span> 13<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:59.192</span></span> 13121 13203 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00648307800293</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-29</span></span> 13<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00.189</span></span> 13121 13203 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00288391113281</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-29</span></span> 13<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:01.189</span></span> 13121 13203 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00324606895447</span></span> 11<span class="hljs-selector-tag"><span class="hljs-selector-tag">-29</span></span> 13<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:03.188</span></span> 13121 13203 <span class="hljs-selector-tag"><span class="hljs-selector-tag">I</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> : 0<span class="hljs-selector-class"><span class="hljs-selector-class">.00265002250671</span></span></code> </pre> <br>  More than 100 times faster.  Impressive, isn't it? <br><br>  In conclusion, it should be mentioned that RecycleView is not a panacea.  It is not suitable if the size of the element depends on the content (for example, Label, the size of which varies depending on the amount of text). <br><br><h3>  3. Services.  Autorun and restart </h3><br>  The next problem I encountered did not give in to the solution for so long that I had cowardly thought to consider this framework unusable and score :) The problem was with the services (in Android this is the name of the processes running in the background).  Creating a service is not so difficult - a little confusing outdated documentation, but nothing more.  However, in most cases, is there a lot of confusion from the service, which, firstly, does not start automatically when the phone is loaded, and secondly, it does not restart if the application is ‚Äúthrown away‚Äù with a swipe from the task manager?  In my opinion, no. <br><br>  At that time, there was only one article on this topic in the <a href="https://github.com/kivy/kivy/wiki/">official wiki</a> , but even though it was called ‚ÄúStarting Kivy service on bootup,‚Äù it really only told how to start the <i>application</i> when loading the phone, but not its service (yes, this is also useful, but much less often, as for me).  In the end, I rewrote that article, and here I will tell you the details. <br><br>  Suppose we have a primitive service, which just does something that periodically displays a string in the log (this we eliminate in advance the bugs that may occur due to the nature of the service itself). <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"myapp service"</span></span> sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br>  From the application, we run it with the main class method using <a href="https://github.com/kivy/pyjnius">PyJnius</a> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> jnius <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> autoclass <span class="hljs-comment"><span class="hljs-comment"># ... # class GuessTheQuoteApp(App): # ... # def __start_service(self): service = autoclass('com.madhattersoft.guessthequote.ServiceGuessthequoteservice') mActivity = autoclass('org.kivy.android.PythonActivity').mActivity service.start(mActivity, "")</span></span></code> </pre> <br>  If the APK is <a href="http://python-for-android.readthedocs.io/en/latest/services/">built correctly</a> , the service will start when the application starts, but this is not enough. <br><br>  To begin with, we will try to make it restart when the application is stopped (for example, when removing it from the task manager).  Of course, it would be possible to use <a href="https://developer.android.com/reference/android/app/Service.html">startForeground</a> , but this is not quite the background task execution :) It will require at least a notification - this is not always suitable.  In this case, the <a href="https://developer.android.com/reference/android/app/Service.html">START_STICKY</a> flag is perfect, but we write in Python, which makes the task not so trivial - at least, with the help of PyJnius, it is no longer solved. <br><br>  Honestly, it is generally solved quite crookedly, since I am not yet ready to become one of the developers of <a href="https://github.com/kivy/python-for-android">Python4Android</a> , thanks to which all this happiness works in general.  And changes need to be made to the Python4Android code.  Specifically, we need the .buildozer / android / platform / build / dists / guessthequote / src / org / kivy / android / PythonService.java file in which, in the startType () function, we change the START_NOT_STICKY flag to START_STICKY: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> START_STICKY; }</code> </pre> <br>  Hooray, the service will restart.  Everything?  Of course not :) Because he immediately collapses with an error: <br><br><pre> <code class="hljs pgsql">E AndroidRuntime: Caused <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: java.lang.NullPointerException: Attempt <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> invoke virtual <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'android.os.Bundle android.content.Intent.getExtras()'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> reference</code> </pre> <br>  The problem is in the onStartCommand function (Intent intent, int flags, int startId), because after restarting the intent we are null.  Well, we will rewrite it: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStartCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pythonThread != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Log.v(<span class="hljs-string"><span class="hljs-string">"python service"</span></span>, <span class="hljs-string"><span class="hljs-string">"service exists, do not start again"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> START_NOT_STICKY; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { startIntent = intent; Bundle extras = intent.getExtras(); androidPrivate = extras.getString(<span class="hljs-string"><span class="hljs-string">"androidPrivate"</span></span>); androidArgument = extras.getString(<span class="hljs-string"><span class="hljs-string">"androidArgument"</span></span>); serviceEntrypoint = extras.getString(<span class="hljs-string"><span class="hljs-string">"serviceEntrypoint"</span></span>); pythonName = extras.getString(<span class="hljs-string"><span class="hljs-string">"pythonName"</span></span>); pythonHome = extras.getString(<span class="hljs-string"><span class="hljs-string">"pythonHome"</span></span>); pythonPath = extras.getString(<span class="hljs-string"><span class="hljs-string">"pythonPath"</span></span>); pythonServiceArgument = extras.getString(<span class="hljs-string"><span class="hljs-string">"pythonServiceArgument"</span></span>); pythonThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); pythonThread.start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canDisplayNotification()) { doStartForeground(extras); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { pythonThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); pythonThread.start(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> startType(); }</code> </pre> <br>  Alas: <br><br><pre> <code class="hljs vhdl">F DEBUG : Abort message: <span class="hljs-symbol"><span class="hljs-symbol">'art</span></span>/runtime/java_vm_ext.cc:<span class="hljs-number"><span class="hljs-number">410</span></span>] JNI DETECTED <span class="hljs-literal"><span class="hljs-literal">ERROR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> APPLICATION: GetStringUTFChars received <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> jstring'</code> </pre> <br>  The problem is that the nativeStart () function does not get the required Extras.  Unfortunately, two of them I had to hardcore.  As a result, it looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ String package_root = getFilesDir().getAbsolutePath(); String app_root = package_root + <span class="hljs-string"><span class="hljs-string">"/app"</span></span>; File app_root_file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(app_root); PythonUtil.loadLibraries(app_root_file); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mService = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (androidPrivate == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { androidPrivate = package_root; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (androidArgument == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { androidArgument = app_root; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serviceEntrypoint == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { serviceEntrypoint = <span class="hljs-string"><span class="hljs-string">"./service/main.py"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// hardcoded } if (pythonName == null) { pythonName = "guessthequoteservice"; // hardcoded } if (pythonHome == null) { pythonHome = app_root; } if (pythonPath == null) { pythonPath = package_root; } if (pythonServiceArgument == null) { pythonServiceArgument = app_root+":"+app_root+"/lib"; } nativeStart( androidPrivate, androidArgument, serviceEntrypoint, pythonName, pythonHome, pythonPath, pythonServiceArgument); stopSelf(); }</span></span></code> </pre> <br>  That's it. <br><br>  Let us turn to autostart service when you start the phone.  After the previous problem it will be easier.  <i>(Actually, everything was the opposite - I couldn‚Äôt understand for a very long time what exactly to add, because there was no information about it anywhere at all, and the developers themselves didn‚Äôt know how to solve this problem either. And only having figured out parallel with the restart issue, I understood what needs to be done.)</i> <br><br>  First you need permission RECEIVE_BOOT_COMPLETED - it's easy.  And then - BroadcastReceiver, you will have to add it to AndroidManifest manually, but this is also not a problem.  The problem is that to write in it :) <br><br>  The solution for launching an application (not a service) is as follows: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.madhattersoft.guessthequote; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.kivy.android.PythonActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBroadcastReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Intent ix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, PythonActivity.class); ix.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startActivity(ix); } }</code> </pre> <br>  At first I tried to just rewrite it for the service: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.madhattersoft.guessthequote; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.madhattersoft.guessthequote.ServiceGuessthequoteservice; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBroadcastReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Intent ix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, ServiceGuessthequoteservice.class); ix.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startService(ix); } }</code> </pre> <br>  Aha, overclocked :) <br><br><pre> <code class="hljs pgsql">E AndroidRuntime: java.lang.RuntimeException: Unable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> service com.madhattersoft.guessthequote.ServiceGuessthequoteservice@<span class="hljs-number"><span class="hljs-number">8</span></span>c96929 <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Intent { cmp=com.madhattersoft.guessthequote/.ServiceGuessthequoteservice }: java.lang.NullPointerException: Attempt <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> invoke virtual <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'java.lang.String android.os.Bundle.getString(java.lang.String)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> reference</code> </pre> <br>  I think you already understand that the problem is in those Extras.  I then had to find out about it from nowhere.  But I will not pull, the working code looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.madhattersoft.guessthequote; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.madhattersoft.guessthequote.ServiceGuessthequoteservice; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBroadcastReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ String package_root = context.getFilesDir().getAbsolutePath(); String app_root = package_root + <span class="hljs-string"><span class="hljs-string">"/app"</span></span>; Intent ix = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, ServiceGuessthequoteservice.class); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"androidPrivate"</span></span>, package_root); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"androidArgument"</span></span>, app_root); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"serviceEntrypoint"</span></span>, <span class="hljs-string"><span class="hljs-string">"./service/main.py"</span></span>); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"pythonName"</span></span>, <span class="hljs-string"><span class="hljs-string">"guessthequoteservice"</span></span>); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"pythonHome"</span></span>, app_root); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"pythonPath"</span></span>, package_root); ix.putExtra(<span class="hljs-string"><span class="hljs-string">"pythonServiceArgument"</span></span>, app_root+<span class="hljs-string"><span class="hljs-string">":"</span></span>+app_root+<span class="hljs-string"><span class="hljs-string">"/lib"</span></span>); ix.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startService(ix); } }</code> </pre> <br>  Fuh :) <br><br><h3>  Localization and multilingualism </h3><br>  In general, you can use <a href="https://docs.python.org/2/library/gettext.html">gettext</a> for localization, or even easier to do - create the lang folder, in it, for each language (for example, en.py and ru.py) in a file, define all words and phrases there in the form of variables / constants, and then connect the desired module.  Like that: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> autoclass(<span class="hljs-string"><span class="hljs-string">'java.util.Locale'</span></span>).getDefault().getLanguage() <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'uk'</span></span>, <span class="hljs-string"><span class="hljs-string">'be'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lang.ru <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> lang <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lang.en <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> lang GuessTheQuote.lang = lang</code> </pre> <br>  The static variable is used to make language constants convenient to use in the kv-file: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lang</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.some_phrase</span></span></code> </pre> <br>  This, in general, is rather trivial, and the main thing I wanted to tell you about in terms of localization is how to set constants in res / values ‚Äã‚Äã/ strings.xml and individual localizations.  Why do you need it?  At a minimum, to set the name of the application in different languages, as well as to register constants such as app_id for Google Play services and facebook_app_id for Facebook services. <br><br>  By default, P4A generates strings.xml as follows: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app_name"</span></span></span><span class="hljs-tag">&gt;</span></span>Guess The Quote<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"private_version"</span></span></span><span class="hljs-tag">&gt;</span></span>1517538478.81<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"presplash_color"</span></span></span><span class="hljs-tag">&gt;</span></span>#2EBCB2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urlScheme"</span></span></span><span class="hljs-tag">&gt;</span></span>kivy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In this case, the application name and background color of the boot screen can be set in buildozer.spec.  At first glance, this is enough, but this is only if the application is monolingual, and additional string constants are not needed, and this is somehow minimalist :) Of course, no one forbids manually setting everything you need, but with the next build it will be overwritten.  You can also manually create folders with localizations, for example, values-ru, but they will not be updated for new builds.  Therefore, it is better to once again correct P4A, namely, the .buildozer / android / platform / build / dists / guessthequote / build.py file as follows: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,    P4A    370 render( 'strings.tmpl.xml', 'res/values/strings.xml', args=args, url_scheme=url_scheme, ) #    :) local_args = {'be': argparse.Namespace(**vars(args)), 'ru': argparse.Namespace(**vars(args)), 'uk': argparse.Namespace(**vars(args))} for key in local_args: local_args[key].name = u' !' #  , ,         P4A  buildozer,       for i in os.listdir('res'): if i[:6] == 'values': render( 'strings.tmpl.xml', 'res/'+i+'/strings.xml', args=(args if i == 'values' else local_args[i[7:10]]), url_scheme=url_scheme, ) #    ,    P4A    388 with open(join(dirname(__file__), 'res', 'values', 'strings.xml')) as fileh: lines = fileh.read() with open(join(dirname(__file__), 'res', 'values', 'strings.xml'), 'w') as fileh: fileh.write(re.sub(r'"private_version"&gt;[0-9\.]*&lt;', '"private_version"&gt;{}&lt;'.format( str(time.time())), lines)) #       for i in os.listdir('res'): if i[:6] == 'values': with open(join(dirname(__file__), 'res', i, 'strings.xml')) as fileh: lines = fileh.read() with open(join(dirname(__file__), 'res', i, 'strings.xml'), 'w') as fileh: fileh.write(re.sub(r'"private_version"&gt;[0-9\.]*&lt;', '"private_version"&gt;{}&lt;'.format( str(time.time())), lines))</span></span></code> </pre> <br>  Well, all the string constants you need should be written in the .buildozer / android / platform / build / dists / guessthequote / templates / strings.tmpl.xml file <br><br><h3>  To be continued </h3><br>  If the article seems interesting to the community, in the second part I will describe the most interesting things: in-app purchases, integration of Google Play Games services and Facebook SDK, and preparation of a release version with subsequent publication on Google Play, and also prepare a project on Github with modules for implementing the described tasks.  If you are interested in any other details - write in the comments, I will try to highlight as much as possible. </div><p>Source: <a href="https://habr.com/ru/post/348226/">https://habr.com/ru/post/348226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348214/index.html">Transcription of geographical names in Open Street Map. Latvia, Lithuania, Poland, Estonia</a></li>
<li><a href="../348218/index.html">New lite text markup language based on pair quotes (pq)</a></li>
<li><a href="../348220/index.html">Reason on which database to choose</a></li>
<li><a href="../348222/index.html">The second part of the comparison of python and tcl</a></li>
<li><a href="../348224/index.html">Simple intent classifier</a></li>
<li><a href="../348228/index.html">News from the world of OpenStreetMap ‚Ññ393 (01/23/2018-29.01.2018)</a></li>
<li><a href="../348230/index.html">GCCGO versus "standard" implementation</a></li>
<li><a href="../348232/index.html">3CX v15.5 SP3 Beta: updated conferences, improved hosting and new pricing policy</a></li>
<li><a href="../348234/index.html">Telegram bots. Downloading files larger than 50mb</a></li>
<li><a href="../348236/index.html">Programmer career</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>