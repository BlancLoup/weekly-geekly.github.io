<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We raise Linux on MIPSfpga and Altera FPGA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The documentation provided by Imagination Technologies on MIPSfpga describes very well the Linux deployment in great detail. But the system used on th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We raise Linux on MIPSfpga and Altera FPGA</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/464/a67/49b/464a6749ba4d43cf87a621b81aac9cfa.png" alt="KDPV"></p><br><p>  The documentation provided by Imagination Technologies on MIPSfpga describes very well the Linux deployment in great detail.  But the system used on the chip is built using Xilinx-specific peripheral modules.  Therefore, its repetition on the debug board with Altera FPGA in its original form is impossible.  The solution is a system on a MIPSfpga-plus chip with its platform-independent peripherals.  How to run Linux on it, read in this article. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduction </h2><br><p>  Immediately, we note that the configuration obtained as a result of the actions described below is far from ideal.  At the moment there is no boot from external media, and only UART and GPIO can be mentioned among supported devices.  Therefore, the front of further work on the development of the MIPSfpga-plus system is very broad. <br>  Further it is assumed that the reader: </p><br><ul><li>  familiar with the subject area in the Harris-Harris volume [ <a href="https://habrahabr.ru/post/259505/">L1</a> ]; </li><li>  has access to the source codes MIPSfpga [ <a href="https://habrahabr.ru/post/275215/">L2</a> ] and mipsfpga-plus [ <a href="https://github.com/MIPSfpga/mipsfpga-plus">L3</a> ]; </li><li>  set up and tested the operation of MIPSfpga-plus with SDRAM [ <a href="https://habrahabr.ru/post/321530/">L5</a> ] and UART [ <a href="https://habrahabr.ru/post/325168/">L6</a> ], as well as in remote debugging mode [ <a href="https://habrahabr.ru/post/322442/">L4</a> ]; </li><li>  has some skills in using Linux development tools, experience with git; </li></ul><br><p>  In the described case, the following configuration is used: </p><br><ul><li>  Terasic DE10-Lite debug board with Altera MAX10 FPGA and SDRAM 64MB on board; </li><li>  Pinboard II board as a debugger and UART-converter.  You can use any board with an FTDI USB chip that supports MPSSE, an example of such a configuration is described in [ <a href="https://habrahabr.ru/post/322442/">L4</a> ]; </li><li>  Windows 7 (x64) computer and Quartus Prime 16.1 for FPGA synthesis and programming; </li><li>  Ubuntu 17.04 (x64) virtual machine for building the kernel and RAM image of the file system; </li><li>  Internet access; </li></ul><br><p>  If you are planning to seriously and deeply immerse yourself in the magic of the Linux kernel, it is strongly recommended that you familiarize yourself with the materials [ <a href="http://free-electrons.com/docs/">L7</a> ], in particular, with the presentations [ <a href="http://free-electrons.com/doc/training/embedded-linux/">L8</a> ] and [ <a href="http://free-electrons.com/doc/training/linux-kernel/">L9</a> ]. <br>  If all the listed requirements are met, let's start! </p><br><h2 id="sintez-konfiguracii-i-programmirovanie-plis">  Synthesis of configuration and programming of FPGA </h2><br><ul><li><p>  In the MIPSfpga-plus settings (mfp_ahb_lite_matrix_config.vh file), peripheral modules for working with SDRAM and UART, as well as debugging via MPSSE should be enabled if the debugging mechanism described in [ <a href="https://habrahabr.ru/post/322442/">L4</a> ] is used: </p><br><pre><code class="hljs markdown"><span class="hljs-code"><span class="hljs-code">`define MFP_USE_SDRAM_MEMORY `</span></span>define MFP<span class="hljs-emphasis"><span class="hljs-emphasis">_USE_</span></span>DUPLEX<span class="hljs-emphasis"><span class="hljs-emphasis">_UART `define MFP_</span></span>USE<span class="hljs-emphasis"><span class="hljs-emphasis">_MPSSE_</span></span>DEBUGGER</code> </pre> <br></li><li>  using Quartus to assemble MIPSfpga-plus and programming the FPGA; </li></ul><br><h2 id="sborka-yadra-i-ram-diska">  Kernel and RAM build </h2><br><p>  It is assumed that further actions are performed on the machine running Linux. </p><br><ul><li><p>  update the list of available packages for the system: </p><br><pre> <code class="bash hljs">sudo apt-get update</code> </pre> <br></li><li><p>  Install the utilities and libraries needed for configuration and build: </p><br><pre> <code class="bash hljs">sudo apt-get install -y build-essential git libncurses5-dev bc unzip</code> </pre> <br></li><li><p>  create a directory in which all further work will go and go to it: </p><br><pre> <code class="bash hljs">mkdir ~/mipsfpga <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/mipsfpga</code> </pre> <br></li><li><p>  Download toolchain from Imagination Technologies: </p><br><pre> <code class="bash hljs">wget http://codescape-mips-sdk.imgtec.com/components/toolchain/2016.05-06/Codescape.GNU.Tools.Package.2016.05-06.for.MIPS.MTI.Linux.CentOS-5.x86_64.tar.gz</code> </pre> <br></li><li><p>  create a directory and deploy the downloaded package there: </p><br><pre> <code class="bash hljs">mkdir ~/mipsfpga/toolchain tar -xvf Codescape.GNU.Tools.Package.2016.05-06.for.MIPS.MTI.Linux.CentOS-5.x86_64.tar.gz -C ~/mipsfpga/toolchain</code> </pre> <br></li><li><p>  it is desirable (but not necessary) to set the path to the deployed executable files in the $ PATH variable, this will simplify working with them.  For example, in ~ / .profile </p><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pathadd</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -d <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [[ <span class="hljs-string"><span class="hljs-string">":</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:"</span></span> != *<span class="hljs-string"><span class="hljs-string">":</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">:"</span></span>* ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${PATH:+":$PATH"}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> } pathadd <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/bin"</span></span> pathadd <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.local/bin"</span></span> pathadd <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/mipsfpga/toolchain/mips-mti-linux-gnu/2016.05-06/bin"</span></span></code> </pre> <br></li><li><p>  we get the Linux kernel: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git kernel</code> </pre> <br></li><li><p>  we get the buildroot with which the RAM image of the file system will be generated: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://git.buildroot.net/buildroot</code> </pre> <br></li><li><p>  Create a directory for buildroot and Linux patches required for deployment to MIPSfpga-plus: </p><br><pre> <code class="bash hljs">mkdir patches</code> </pre> <br></li><li><p>  Download patches [ <a href="https://github.com/zhelnio/memos/tree/master/public/04_mips_linux">L10</a> ], save them in the newly created directory; </p><br></li><li><p>  go to the buildroot directory and roll back to version 2017.05.1 (commit f3d8beeb3694): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> buildroot git checkout 2017.05.1</code> </pre> <br></li><li><p>  apply the patch to buildroot: </p><br><pre> <code class="bash hljs">git apply ../patches/MIPSfpga_buildroot.patch</code> </pre> <br></li><li><p>  perform buildroot configuration: </p><br><pre> <code class="bash hljs">make xilfpga_static_defconfig</code> </pre> <br></li><li><p>  if necessary, make changes to the configuration: </p><br><pre> <code class="bash hljs">make menuconfig</code> </pre> <br></li><li><p>  We start the assembly of the RAM image of the file system and go to drink delicious coffee (tea, beer or who loves anything), because  The process is very long: </p><br><pre> <code class="bash hljs">make</code> </pre> <br></li><li><p>  go to the directory with the Linux kernel and check that the RAM image of the file system is on the expected path (in the future we will need to specify it in the kernel configuration): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../kernel/ ls -l ../buildroot/output/images/rootfs.cpio</code> </pre> <br></li><li><p>  roll back to version v4.12.1 (commit cb6621858813), because  the patch is formed from it: </p><br><pre> <code class="bash hljs">git checkout v4.12.1</code> </pre> <br></li><li><p>  apply patch: </p><br><pre> <code class="bash hljs">git apply ../patches/MIPSfpga_linux.patch</code> </pre> <br></li><li><p>  We use the basic configuration of the MIPSfpga kernel: </p><br><pre> <code class="bash hljs">make ARCH=mips xilfpga_de10lite_defconfig</code> </pre> <br></li><li><p>  Run the configuration editor: </p><br><pre> <code class="bash hljs">make ARCH=mips menuconfig</code> </pre> <br></li><li>  enable RAM disk support and set the path to it (previously we checked the existence of this file): </li></ul><br><p><img src="https://habrastorage.org/web/d07/2cb/f74/d072cbf74f854accb156ed2cadbb95dc.png" alt="RAM disk settings"></p><br><ul><li>  save the changes, exit the graphical configurator and start the kernel build: <br><pre> <code class="bash hljs">make ARCH=mips CROSS_COMPILE=~/mipsfpga/toolchain/mips-mti-linux-gnu/2016.05-06/bin/mips-mti-linux-gnu-</code> </pre> </li></ul><br><h2 id="zagruzka-yadra-v-pamyat-i-zapusk">  Loading the kernel into memory and running </h2><br><ul><li>  on the machine to which the hardware debugger is connected, we start OpenOCD, for example, as described in [ <a href="https://habrahabr.ru/post/322442/">L4</a> ]; </li><li>  we start the terminal on the same machine (for example, PuTTY) and connect to the COM port (speed 115200); </li><li><p>  on the Linux machine where we did the build, run gdb from the MIPS toolchain.  It is assumed that we are in the directory with the compiled kernel: </p><br><pre> <code class="bash hljs">mips-mti-linux-gnu-gdb ./vmlinux</code> </pre> <br><p>  Further actions are performed in the gdb console. </p><br></li><li><p>  Connect to OpenOCD, which runs on a machine with a hardware debugger: </p><br><pre> <code class="hljs css">(<span class="hljs-selector-tag"><span class="hljs-selector-tag">gdb</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">target</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">remote</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span>..<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3333</span></span></code> </pre> <br></li><li><p>  perform a MIPSfpga system reset: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) mo reset halt</code> </pre> <br></li><li><p>  We inform the debugger that our system is Little Endian: </p><br><pre> <code class="hljs sql">(gdb) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endian</span></span> <span class="hljs-keyword"><span class="hljs-keyword">little</span></span></code> </pre> <br></li><li><p>  load the kernel image into memory: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) load</code> </pre> <br></li><li><p>  Run the kernel for execution: </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) continue</code> </pre> <br></li><li>  if everything is done correctly, then after a while in the previously launched terminal we should see a download log, similar to the one below.  Due to the peculiarity of the current kernel configuration, it will not appear immediately, but after a short delay. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Boot log</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">Linux version <span class="hljs-number"><span class="hljs-number">4.12</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>+ (stas@ubuntu) (gcc version <span class="hljs-number"><span class="hljs-number">4.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> (Codescape GNU Tools <span class="hljs-number"><span class="hljs-number">2016.05</span></span>-<span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MIPS MTI Linux) ) #<span class="hljs-number"><span class="hljs-number">1</span></span> Sat Jul <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> MSK <span class="hljs-number"><span class="hljs-number">2017</span></span> CPU0 revision <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>: <span class="hljs-number"><span class="hljs-number">00019e60</span></span> (MIPS M14KEc) MIPS: machine <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> terasic,de10lite Determined physical RAM <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>: memory: <span class="hljs-number"><span class="hljs-number">04000000</span></span> @ <span class="hljs-number"><span class="hljs-number">00000000</span></span> (usable) Initrd <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> empty - disabling initrd Primary instruction cache <span class="hljs-number"><span class="hljs-number">4</span></span>kB, VIPT, <span class="hljs-number"><span class="hljs-number">2</span></span>-way, linesize <span class="hljs-number"><span class="hljs-number">16</span></span> bytes. Primary data cache <span class="hljs-number"><span class="hljs-number">4</span></span>kB, <span class="hljs-number"><span class="hljs-number">2</span></span>-way, VIPT, no aliases, linesize <span class="hljs-number"><span class="hljs-number">16</span></span> bytes Zone ranges: Normal [mem <span class="hljs-number"><span class="hljs-number">0</span></span>x0000000000000000-<span class="hljs-number"><span class="hljs-number">0</span></span>x0000000003ffffff] Movable zone start <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> each node Early memory node ranges node <span class="hljs-number"><span class="hljs-number">0</span></span>: [mem <span class="hljs-number"><span class="hljs-number">0</span></span>x0000000000000000-<span class="hljs-number"><span class="hljs-number">0</span></span>x0000000003ffffff] Initmem setup node <span class="hljs-number"><span class="hljs-number">0</span></span> [mem <span class="hljs-number"><span class="hljs-number">0</span></span>x0000000000000000-<span class="hljs-number"><span class="hljs-number">0</span></span>x0000000003ffffff] Built <span class="hljs-number"><span class="hljs-number">1</span></span> zonelists <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Zone order, mobility grouping <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>. Total pages: <span class="hljs-number"><span class="hljs-number">16256</span></span> Kernel command <span class="hljs-literal"><span class="hljs-literal">line</span></span>: console=ttyS0,<span class="hljs-number"><span class="hljs-number">115200</span></span> PID hash table entries: <span class="hljs-number"><span class="hljs-number">256</span></span> (order: -<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1024</span></span> bytes) Dentry cache hash table entries: <span class="hljs-number"><span class="hljs-number">8192</span></span> (order: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">32768</span></span> bytes) Inode-cache hash table entries: <span class="hljs-number"><span class="hljs-number">4096</span></span> (order: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">16384</span></span> bytes) Memory: <span class="hljs-number"><span class="hljs-number">60512</span></span>K/<span class="hljs-number"><span class="hljs-number">65536</span></span>K available (<span class="hljs-number"><span class="hljs-number">1830</span></span>K kernel code, <span class="hljs-number"><span class="hljs-number">99</span></span>K rwdata, <span class="hljs-number"><span class="hljs-number">320</span></span>K rodata, <span class="hljs-number"><span class="hljs-number">944</span></span>K init, <span class="hljs-number"><span class="hljs-number">185</span></span>K bss, <span class="hljs-number"><span class="hljs-number">5024</span></span>K reserved, <span class="hljs-number"><span class="hljs-number">0</span></span>K cma-reserved) NR_IRQS:<span class="hljs-number"><span class="hljs-number">8</span></span> clocksource: MIPS: mask: <span class="hljs-number"><span class="hljs-number">0</span></span>xffffffff max_cycles: <span class="hljs-number"><span class="hljs-number">0</span></span>xffffffff, max_idle_ns: <span class="hljs-number"><span class="hljs-number">38225208935</span></span> ns sched_clock: <span class="hljs-number"><span class="hljs-number">32</span></span> bits at <span class="hljs-number"><span class="hljs-number">50</span></span>MHz, resolution <span class="hljs-number"><span class="hljs-number">20</span></span>ns, wraps every <span class="hljs-number"><span class="hljs-number">42949672950</span></span>ns Console: colour dummy device <span class="hljs-number"><span class="hljs-number">80</span></span>x25 Calibrating delay <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>... <span class="hljs-number"><span class="hljs-number">10.81</span></span> BogoMIPS (lpj=<span class="hljs-number"><span class="hljs-number">21632</span></span>) pid_max: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-number"><span class="hljs-number">32768</span></span> minimum: <span class="hljs-number"><span class="hljs-number">301</span></span> Mount-cache hash table entries: <span class="hljs-number"><span class="hljs-number">1024</span></span> (order: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4096</span></span> bytes) Mountpoint-cache hash table entries: <span class="hljs-number"><span class="hljs-number">1024</span></span> (order: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4096</span></span> bytes) devtmpfs: initialized clocksource: jiffies: mask: <span class="hljs-number"><span class="hljs-number">0</span></span>xffffffff max_cycles: <span class="hljs-number"><span class="hljs-number">0</span></span>xffffffff, max_idle_ns: <span class="hljs-number"><span class="hljs-number">7645041785100000</span></span> ns futex hash table entries: <span class="hljs-number"><span class="hljs-number">256</span></span> (order: -<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3072</span></span> bytes) clocksource: Switched <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> clocksource MIPS random: fast init done workingset: timestamp_bits=<span class="hljs-number"><span class="hljs-number">30</span></span> max_order=<span class="hljs-number"><span class="hljs-number">14</span></span> bucket_order=<span class="hljs-number"><span class="hljs-number">0</span></span> Serial: <span class="hljs-number"><span class="hljs-number">8250</span></span>/<span class="hljs-number"><span class="hljs-number">16550</span></span> driver, <span class="hljs-number"><span class="hljs-number">4</span></span> ports, IRQ sharing disabled console [ttyS0] disabled b0400000.serial: ttyS0 at MMIO <span class="hljs-number"><span class="hljs-number">0</span></span>xb0401000 (irq = <span class="hljs-number"><span class="hljs-number">0</span></span>, base_baud = <span class="hljs-number"><span class="hljs-number">3125000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a <span class="hljs-number"><span class="hljs-number">16550</span></span>A console [ttyS0] enabled Freeing unused kernel memory: <span class="hljs-number"><span class="hljs-number">944</span></span>K This <span class="hljs-keyword"><span class="hljs-keyword">architecture</span></span> does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> have kernel memory protection. mount: mounting devpts <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /dev/pts failed: No such device mount: mounting tmpfs <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /dev/shm failed: Invalid argument mount: mounting tmpfs <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /tmp failed: Invalid argument mount: mounting tmpfs <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> /run failed: Invalid argument Starting logging: OK Initializing random number generator... done. Starting network: ip: socket: <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> implemented ip: socket: <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> implemented FAIL Welcome <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> MIPSfpga mipsfpga login:</code> </pre> </div></div><br><h2 id="rabota-s-gpio">  Work with GPIO </h2><br><p>  Let's use the Linux capabilities in order to control the peripherals that are available to us (at the time of writing this article is a GPIO, though not fully): </p><br><ul><li><p>  Check that the GPIO driver is loaded and the device is available: </p><br><pre> <code class="bash hljs">ls /sys/class/gpio/ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> gpiochip480 unexport</code> </pre> <br></li><li><p>  in order to determine the available range of outputs (LEDs on the board are connected in the current configuration), install debugfs and use it to get the necessary information: </p><br><pre> <code class="bash hljs">mount -t debugfs none /sys/kernel/debug cat /sys/kernel/debug/gpio gpiochip0: GPIOs 480-511, parent: platform/bf800000.gpio, bf800000.gpio:</code> </pre> <br></li><li><p>  activate LED0 (in the current case, this is gpio480): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 480 &gt; /sys/class/gpio/<span class="hljs-built_in"><span class="hljs-built_in">export</span></span></code> </pre> <br></li><li><p>  put it into output mode: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> out &gt; /sys/class/gpio/gpio480/direction</code> </pre> <br></li><li><p>  translate it to a high level: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 1 &gt; /sys/class/gpio/gpio480/value</code> </pre> <br></li><li>  if done correctly, the LED 0 LED should be lit. </li></ul><br><h2 id="chto-dalshe">  What's next </h2><br><p>  The described configuration is, in fact, only the beginning of porting Linux to the MIPSfpga-plus system.  To the number of works that must be performed so that the system can be used normally for practical tasks, include: </p><br><ul><li>  support for existing peripherals: interrupt controller, more complete support for GPIO, Altera ADC; </li><li>  support for MIPSfpga-plus peripherals, including the currently missing PWM, SPI (limited presence), I2C, DDR and Ethernet interfaces; </li><li>  support for external media (mmc / sdram) and the ability to boot from them; <br>  For this reason, if in the current configuration you encounter any errors (bugs), then do not be surprised - there is still a lot of work. </li></ul><br><h2 id="blagodarnosti">  Thanks </h2><br><p>  The author is grateful to the team of translators from David Harris and Sarah Harris, Digital Circuit Design and Computer Architecture [ <a href="https://habrahabr.ru/post/259505/">L1</a> ], by Imagination Technologies for their academic license for a modern processor core and educational materials, as well as personally for Yuri Panchulu <a href="https://habrahabr.ru/users/yuripanchul/" class="user_link">YuriPanchul</a> for his work on promoting MIPSfpga. </p><br><h2 id="ssylki">  Links </h2><br><p>  [L1] - <a href="https://habrahabr.ru/post/259505/">Digital circuit design and computer architecture</a> <br>  [L2] - <a href="https://habrahabr.ru/post/275215/">How to start working with MIPSfpga</a> ; <br>  [L3] - <a href="https://github.com/MIPSfpga/mipsfpga-plus">MIPSfpga-plus project on github</a> ; <br>  [L4] - <a href="https://habrahabr.ru/post/322442/">MIPSfpga and in-circuit debugging</a> ; <br>  [L5] - <a href="https://habrahabr.ru/post/321530/">MIPSfpga and SDRAM.</a>  <a href="https://habrahabr.ru/post/321530/">Part 1</a> ; <br>  [L6] - <a href="https://habrahabr.ru/post/325168/">MIPSfpga and UART</a> ; <br>  [L7] - <a href="http://free-electrons.com/docs/">Free Electrons.</a>  <a href="http://free-electrons.com/docs/">Free training materials and conference presentations</a> ; <br>  [L8] - <a href="http://free-electrons.com/doc/training/embedded-linux/">Free Electrons.</a>  <a href="http://free-electrons.com/doc/training/embedded-linux/">Embedded Linux system development course</a> ; <br>  [L9] - <a href="http://free-electrons.com/doc/training/linux-kernel/">Free Electrons.</a>  <a href="http://free-electrons.com/doc/training/linux-kernel/">Linux kernel and driver development course</a> ; <br>  [L10] - <a href="https://github.com/zhelnio/memos/tree/master/public/04_mips_linux">Patches for buildroot and Linux, required for deployment on MIPSfpga-plus</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/333920/">https://habr.com/ru/post/333920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333906/index.html">Flat Cubik (Rubik's cube on the plane)</a></li>
<li><a href="../333908/index.html">Which languages ‚Äã‚Äãare most in demand in finance: the views of Wall Street recruiters</a></li>
<li><a href="../333910/index.html">Actions upon arrival at work - receiving cases, updating, documenting, auditing</a></li>
<li><a href="../333912/index.html">Neural conversational models: how to teach a neural network social conversation. Lecture in Yandex</a></li>
<li><a href="../333916/index.html">‚ÄúNecessity arises from both sides‚Äù: the DevOops program committee on the conference and on DevOps</a></li>
<li><a href="../333922/index.html">Release cycle for Infrastructure as Code</a></li>
<li><a href="../333926/index.html">Orchid CMS - another CMS on Laravel</a></li>
<li><a href="../333928/index.html">Integration of Apache CloudStack with third-party systems. Subscribing to events using Apache Kafka</a></li>
<li><a href="../333930/index.html">How the vulnerability of the payment system revealed credit card information</a></li>
<li><a href="../333932/index.html">learnopengl. Lesson 2.2 - Lighting Basics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>