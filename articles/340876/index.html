<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Check whether the service pack is present on the system before installation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Installing service packs for Windows can occur either automatically by Windows Update or manually through the Windows Update Stand-alone Installer (WU...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Check whether the service pack is present on the system before installation</h1><div class="post__text post__text-html js-mediator-article">  Installing service packs for Windows can occur either automatically by <b>Windows Update</b> or manually through the <b>Windows Update Stand-alone Installer</b> (WUSA) - Standalone update installer from msu files.  In addition to WUSA, you can also upgrade the OS using <b>Deployment Image Servicing and Management</b> (DISM) - <b>Deployment Image Servicing and Management</b> System.  Using DISM, you can install updates on not only from msu-files, but also from cab-files.  To get the update package cab file, you need to download the required msu file from the Microsoft website and unpack it with the <b>/ extract</b> key.  It is noticed that the installation of service packs in the form of cab files using DISM is faster than from msu files using WUSA.  I choose DISM to work with Windows updates, so further description is provided for it. <br><a name="habracut"></a><br>  Many system administrators collect their ‚Äúcollections‚Äù of service packs by running their installation in a specific sequence from a batch file.  But sometimes, servicing unfamiliar computers, it is not known exactly which updates are installed and which ones are not.  If you start the installation of all updates from a long list, then if there are some updates in the OS image, the DISM system will still install them ‚Äúon top‚Äù.  In order to avoid wasting time in my script, a ‚Äúfunction‚Äù is used that checks the installed service pack for its presence in the OS.  In the script code, for example, installation of updates <b>KB3177467</b> (Servicing stack update) and <b>KB3125574</b> (Convenience rollup update) is <b>performed</b> .  The OS also automatically determines the bitness of the OS, but this does not concern the topic of the question. <br><br>  <b>Script:</b> <br><br><pre><code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> arch=x64 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%PROCESSOR_ARCHITECTURE%</span></span>" == "x86" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">defined</span></span> PROCESSOR_ARCHITEW6432 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> arch=x86 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> The most important updates after SP1 (Convenience rollup) <span class="hljs-variable"><span class="hljs-variable">%arch%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ------------------------------------------------------------------------------- <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Get packages list. Please wait... dism /English /Online /Get-Packages &gt; "<span class="hljs-variable"><span class="hljs-variable">%TEMP%</span></span>\packages.txt" <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Servicing stack update: KB3177467 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :<span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> .\<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>\Windows6.<span class="hljs-number"><span class="hljs-number">1</span></span>-KB3177467-<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>.cab ||^ dism /Online /Add-Package /PackagePath:.\<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>\Windows6.<span class="hljs-number"><span class="hljs-number">1</span></span>-KB3177467-<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>.cab /Quiet /NoRestart <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Convenience rollup update: KB3125574 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> :<span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> .\<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>\Windows6.<span class="hljs-number"><span class="hljs-number">1</span></span>-KB3125574-v4-<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>.cab ||^ dism /Online /Add-Package /PackagePath:.\<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>\Windows6.<span class="hljs-number"><span class="hljs-number">1</span></span>-KB3125574-v4-<span class="hljs-variable"><span class="hljs-variable">%arch%</span></span>.cab /Quiet /NoRestart <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ------------------------------------------------------------------------------- <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> :<span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> dism /English /Online /Get-PackageInfo /PackagePath:%<span class="hljs-number"><span class="hljs-number">1</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> "Package Identity" |^ <span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> /g:/ <span class="hljs-variable"><span class="hljs-variable">%TEMP%</span></span>\packages.txt &gt; <span class="hljs-built_in"><span class="hljs-built_in">nul</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  <b>Files and folders:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I don‚Äôt attach update package files here, as those listed in the script are taken for sample.  At the location of the script, <i>x64</i> and <i>x86</i> folders should be created in which you need to place the necessary update packages.  The script file itself can be saved in <b>ANSI</b> encoding if you do not use the Cyrillic alphabet to display informational messages.  And if you want to see the Russian text, then you need to save the cmd-file in the <b>OEM</b> encoding <b>866</b> . <br><br>  <b>Description of work:</b> <br><br>  Before starting the installation, DISM will request ( <i>/ Get-Packages</i> ]) the OS for the list of already installed service packs and save it in a text file in the <i>% TEMP% \ packages.txt</i> temporary folder.  Later on, before starting the installation of each update package, the ‚Äúfunction‚Äù is accessed <i>: exist</i> with the transfer as an argument - the path to the package being installed for verification.  ‚ÄúFunction‚Äù <i>: exist</i> retrieves ( <i>/ Get-PackageInfo</i> ) service information from the package being checked, in which the <i>‚ÄúPackage Identity‚Äù</i> string is searched.  This string ‚Äúby pipeline‚Äù is passed to the next search command, which searches for the given string in the saved <i>% TEMP% \ packages.txt</i> file.  According to the search results, two options are possible: <br><br><ul><li>  If the update is not detected installed in the system, then the ‚Äúfunction‚Äù <i>: exist</i> goes with the code <i>% ERRORLEVEL%</i> <b>1</b> , and in this case the installation ( <i>/ Add-Package</i> ) of the package takes place by the DISM system.  After installing the update (if it is successful) - <i>% ERRORLEVEL%</i> is reset and can be used for the next launch of the ‚Äúfunction‚Äù <i>: exist</i> ; </li><li>  If the update is detected installed in the system, then the ‚Äúfunction‚Äù <i>: exist</i> goes with the code <i>% ERRORLEVEL%</i> <b>0</b> , and in this case the installation of the update package does not occur, and the script proceeds to processing the next item in the list.  There is no need to reset <i>% ERRORLEVEL%</i> . </li></ul><br>  <b>Possible problems:</b> <br><br>  Checking for updates in the OS is performed only in the <i>‚ÄúPackage Identity‚Äù</i> field, the status is not checked!  In the normal state, the packages have the status of <b>Installed</b> (Installed), but erroneous states of the service packs present in the system are possible: <b>Superseded</b> ( <b>Not</b> replaced), <b>Not Present</b> (Not <b>present</b> ), <b>Staged</b> (Intermediate).  The status of the present packages can be viewed by opening the <i>% TEMP% \ packages.txt</i> file created during the script operation.  If there are no ‚Äúerroneous‚Äù states, then there should be no problems: something should be established, and what is already installed will be missed. <br><br>  <b>Using this script to update the OS with missing packages saves a lot of time!</b> </div><p>Source: <a href="https://habr.com/ru/post/340876/">https://habr.com/ru/post/340876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340866/index.html">Google Forms: we fix event of sending the form in Google Analytics</a></li>
<li><a href="../340868/index.html">Design for iPhone X. Guidelines for iOS 11</a></li>
<li><a href="../340870/index.html">Tale of sysctl (penguin folk story)</a></li>
<li><a href="../340872/index.html">Cloud Digest: about technologies, SSL certificates and IaaS provider operation</a></li>
<li><a href="../340874/index.html">‚ÄúActive Search‚Äù: how we chose the search engine for the DLP system</a></li>
<li><a href="../340878/index.html">Exantech Code Jam: Hacktoberfest 2017</a></li>
<li><a href="../340880/index.html">Bad Rabbit: a new wave of attacks using a ciphering virus</a></li>
<li><a href="../340882/index.html">Telemetry and software</a></li>
<li><a href="../340884/index.html">There is no time to explain! or how to make friends terraform with minikube and kubernetes</a></li>
<li><a href="../340886/index.html">OpenApoc - X-Com Apocalypse Dedicated to Fans</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>