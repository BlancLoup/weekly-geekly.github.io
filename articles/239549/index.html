<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Demonstration of vulnerabilities in Liqpay</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since Privatbank did not respond to messages describing the vulnerabilities of its Liqpay payment system, I, having waited several months, will back u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Demonstration of vulnerabilities in Liqpay</h1><div class="post__text post__text-html js-mediator-article">  Since Privatbank did not respond to messages describing the vulnerabilities of its Liqpay payment system, I, having waited several months, will back up the theses of my <a href="http://habrahabr.ru/post/227021/">previous article with</a> real examples.  In addition, I believe that the kick will be useful - I will advise the PB below to somewhat extinguish bugs.  These vulnerabilities may already be exploited, and their nature is such that end users suffer.  Forcing the PB to act, we will rescue them (users). <br><br>  As I noted, errors are most often made in the logic of generating a signature for key data.  The problem is that these errors are conceptual, not in implementation. <br><a name="habracut"></a><br><h3>  Vulnerability number 1 </h3><br>  The bottom line: when paying for a merchandise store, an attacker can change these forms sent by his browser to api Liqpay, and pay for a different item than was chosen in the store. <br><br>  The problem in the formation of the signature: the signed data is "glued together" without a separator, in particular the order_id parameter and type.  Suppose order_id = '1234', and type = 'buy'.  The attacker changes order_id = '123' and type = '4buy', sends it to the liqpay server.  In this case, the signature validation will be successful.  the string for its formation has not changed.  You can easily repeat these actions in Chrome or Firefox browser by editing the form on the page - remove the last character from the order and set the first one in the type parameter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Just in case, I will chew a little bit what happened, because not all of my comrades understood the result of the vulnerability: <br><br>  When buying, the store creates a unique order number (order_id), forms the form, signs it and sends the customer with this data to Liqpay.  When Liqpay successfully collects money from the buyer, he informs the store that such an order_id has been paid.  The problem is that Liqpay will report a payment for a completely different order, which has a different amount to pay.  It is enough for an attacker to create unpaid orders until one order_id has a fragment of another order_id.  Since order_id is often not randomly formed, this is possible to some extent or another. <br><br>  A quick solution for Privatbank: just validate the type parameter, which is not happening now.  As I noted, this is a special case that does not solve the problem conceptually. <br><br><h3>  Vulnerability number 2 </h3><br>  The bottom line: a payment form signed by the store can be manually sent to the url callback, and it will be accepted by the store because the signature is formed according to all the rules.  It is only necessary to make small manipulations: <br><br>  rename result_url to transaction_id <br>  rename server_url field to sender_phone <br>  add status field with empty value <br><br>  This package will be accepted by the store! <br><br>  Here is how the signature in the Liqpay package is considered: <br><br><pre><code class="python hljs">private_key . amount . currency . public_key . order_id . type . description . result_url . server_url</code> </pre> <br><br>  And here is how the signature in the OT Liqpay package is considered: <br><br><pre> <code class="python hljs">private_key . amount . currency . public_key . order_id . type . description . status . transaction_id . sender_phone</code> </pre><br><br>  It is seen that the packets differ only in the last three parameters.  We simply changed the field names and fooled the store, making it think that this package from Liqpay, since the signature will match. <br><br>  In order for the store to think that this is a successful payment, you need a little more action and one condition: <br><br><blockquote>  in the description of the goods must be a fragment of "success". </blockquote><br><br>  Surely, in stores that use Liqpay, there is a product with this fragment.  Well, for example, think up the name of the book ‚ÄúMy successful story‚Äù.  In the form created for payment, we change: <br><br><ul><li>  from the description field at the end of the value, cut off a piece of text so that the ‚Äúsuccess‚Äù fragment and the following text do not get into it: description = 'My' </li><li>  field status = 'success' </li><li>  transaction_id = concatenation of text after ‚Äúsuccess‚Äù and result_url: transaction_id = 'ful storyhttps: // blablabla' </li><li>  The server_url field is renamed to sender_phone </li></ul><br><br>  As a result: the signature does not change!  The store accepts the package.  Field status = ‚Äúsuccess‚Äù - payment is successful.  In the transaction_id field - the left text is accepted, because the store does not have to know how id transactions are formed in Liqpay (99% ignore it), sender_phone is the left text (it‚Äôs unlikely that the package will be logged in if something is wrong, the phone is logged in). <br><br>  Bottom line: you can ‚Äúbuy in‚Äù any product for free as long as you wish if only the word ‚Äúsuccess‚Äù was in the description.  Url kolbeka is available in the form in an explicit form, so there will be no problem finding out where to send the package. <br><br>  If you do not understand the meaning of manipulations, then briefly: let's say there are parameters A = AAA, B = BBB, C = BBB.  Software store protocol Liqpay concatenates all the parameters in a certain order in one line AAABBBVVV and gets the signature XXX.  We can change the names and values ‚Äã‚Äãof the parameters, let's say: G = AA, B = ABBV, C = BB.  As a result, the concatenated string is the same (AAABBBVV), and the parameters and their values ‚Äã‚Äãare completely different. <br><br>  A quick solution for Privatbank: block the processing of purchases with the ‚Äúsuccess‚Äù fragment in the description.  Again, this does not solve the problem conceptually. <br><br>  I ask you not to kick the PB much, because there are even more bugs in other payment systems, but so far I don‚Äôt care for them. </div><p>Source: <a href="https://habr.com/ru/post/239549/">https://habr.com/ru/post/239549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239537/index.html">How to collect a million on Kickstarter?</a></li>
<li><a href="../239539/index.html">3D printing in the service of prosthetists</a></li>
<li><a href="../239541/index.html">Talk radio on the knee</a></li>
<li><a href="../239543/index.html">The use of neural networks in robotics: prospects and advantages</a></li>
<li><a href="../239545/index.html">Making an HTML5 quest: creating a character and basic animation</a></li>
<li><a href="../239553/index.html">SAP security. Do you regularly install updates?</a></li>
<li><a href="../239555/index.html">Intel¬Æ Parallel Studio XE 2015 - Talk About New Names and "Chips"</a></li>
<li><a href="../239557/index.html">Beetle modeling</a></li>
<li><a href="../239559/index.html">IBM invites to the conference "Infrastructure 2014"</a></li>
<li><a href="../239563/index.html">As 3 people without investment "magic button" for the stores did</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>