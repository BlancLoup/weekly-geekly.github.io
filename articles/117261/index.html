<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LED Continuous Integration Server Status Monitor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The active implementation of Jenkins based servers (fork Hudson) in the company Continuous Integraion gave rise to a lot of talk about the ‚Äúred lamp‚Äù ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LED Continuous Integration Server Status Monitor</h1><div class="post__text post__text-html js-mediator-article">  The active implementation of Jenkins based servers (fork Hudson) in the company Continuous Integraion gave rise to a lot of talk about the ‚Äúred lamp‚Äù - the usual such lamp that would stand in front of the development manager and signal if the build was unsuccessful.  Interest took up, and at the weekend passed from words to deeds.  As a result, such a device turned out: <br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/40/5f/405ff9e8a71f7932b96c4dd7177da4f5.png"></a> <br><br>  What it can do: <br><ul><li>  USB connected to a computer; </li><li>  track the status of six Jenkins projects; </li><li>  display information about the current state using 4 display options (two colors for two modes of operation). </li></ul><br><br>  It was built on the basis of the popular platform Arduino (more precisely, its equally popular clone - Seeeduino). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basic concept of the device is simple: <br><ol><li>  A program is started on the working machine that listens to the status of the specified Jenkins projects; </li><li>  When the status changes, the program sends a certain signal via the UART (via the Serial Port, also known as the COM port) to the Arduino; </li><li>  Arduino receives a signal and turns on the corresponding LED in the desired mode. </li></ol><br><a name="habracut"></a><br><h4>  Software part on Arduino </h4><br>  Arduino on board has built-in support for SerialPort, so there are no problems with connecting to a PC.  By team <br><blockquote><ol><li> <code><font color="black"><font color="blue">Serial</font> . <font color="blue">begin</font> (9600);</font></code> </li> </ol></blockquote><br>  listening to the port at the specified frequency is initialized (it is important here that the program running on the computer works with the same frequency in the same mode), and then the command <br><blockquote><ol><li>  incomingByte = <font color="blue">Serial</font> .  <font color="blue">read</font> (); </li></ol></blockquote><br>  in an infinite loop, the signal from the port is read.  Depending on what has come, one of five modes is selected for one of six LEDs: <br><ol><li>  The last build was successful (green diode); </li><li>  Assembly in progress (flashing green diode); </li><li>  The last build was unsuccessful (red diode); </li><li>  The last build was manually interrupted (red diode); </li><li>  It is impossible to get a response from the server, or the status is undefined (diode off). </li></ol><br>  You can make another mode - blinking in turn green-red, if for someone this set of statuses seems insufficient. <br><br>  To save the conclusions of the Arduino, two-pin red-green LEDs were selected.  When current flows in one direction, such a diode glows green, in the opposite direction - red: <br><img src="https://habrastorage.org/storage/habraeffect/ee/6f/ee6ffc78a89f28ac763ae002ddfecf49.png"><br><br>  We connect it to two Arduino pins (do not forget about the current-limiting resistor) and, exposing low and high potential on these legs, we set the desired operation mode of the LED: <br><ul><li>  Green: high on one pin, low on the other; </li><li>  Red: the same, but in the opposite direction; </li><li>  LED off, if both outputs give a low signal. </li></ul><br>  Flashing mode is obtained by alternating the on and off of the LED by timer. <br><br>  Conclusions 0 and 1 are used for communication via UART, they cannot be used.  I limited myself to six indicators, hanging them, respectively, on conclusions 2-13. <br><img src="https://habrastorage.org/storage/habraeffect/2f/5e/2f5e971ecd5ef7a88c828a0ab5b1c725.png"><br><br>  If desired, you can use the remaining 6 conclusions of the Arduino, as well as expand the number of indicators, using, for example, shift registers.  True, the firmware code will have to be further conjured. <br><br>  A complete sketch for Arduino can be viewed <b><a href="http://depositfiles.com/files/05bsd6vh4">in the archive with the source code</a></b> . <br><br><h4>  Iron part </h4><br>  The iron part of the interface is implemented as an Arduino expansion card - see the photo.  The pins are inserted into the connectors, it turns out tough durable design without wires and loops.  Convenient and reliable. <br>  The board is made by the LUT method, about which many times already wrote on Habr√©.  A good description in pictures is on the site <a title="Manufacturing of PCB inside and out. Video lesson." href="http://easyelectronics.ru/izgotovlenie-pechatnoj-platy-ot-i-do-video-urok.html">easyelectronics.ru</a> . <br>  LEDs and current-limiting resistors are used in chip format, but, of course, any will do. <br><br> <a href=""><img src="https://habrastorage.org/storage/habraeffect/7a/c6/7ac64caaf624db10e371fb0c5ee4aece.png"></a> <br><br>  As a ‚Äúchip‚Äù, he erased the name of the projects right on the board.  The photograph had to ‚Äúcover up‚Äù, because  These are the names of specific customers of our company.  You could just write Server01, Server02, etc.  But I wanted to make Beautiful :) <br><br><h4>  Programmed part on PC </h4><br>  The server status monitoring program is written in Perl.  In principle, any language that can send signals to SerialPort will do.  Which language to use is a matter of taste for everyone. <br>  I note that for Perl I had to install the DeviceSerial (for Mac OS X), Win32-API (for Windows) and Win32-Serial (for Windows) packages. <br><br>  The main steps of the program: <br><ol><li>  Connect to SerialPort; <br>  In Perl, this is done through <br><blockquote><ol><li>  <font color="blue">my</font> <font color="Purple">$ port</font> = Win32 :: SerialPort-&gt; <font color="blue">new</font> ( <font color="DarkOrange">"COM8"</font> );  <font color="green"># COM8 - the name of the port in which the device was defined</font> </li><li>  <font color="green"># For Mac OS X it will be like this: my $ port = Device :: SerialPort-&gt; new ("/ dev / tty.usbserial-A100eEO6");</font> </li><li>  <font color="Purple">$ port</font> -&gt; databits (8); </li><li>  <font color="Purple">$ port</font> -&gt; baudrate (9600); </li><li>  <font color="Purple">$ port</font> -&gt; parity ( <font color="DarkOrange">"none"</font> ); </li><li>  <font color="Purple">$ port</font> -&gt; stopbits (1); </li></ol></blockquote></li><li>  In an infinite loop, view the status of the specified service and send the corresponding code via UART. <br>  Departure is carried out by the team <br><blockquote><ol><li>  <font color="Purple">$ port</font> -&gt; write ( <font color="DarkOrange">‚ÄúAny string‚Äù</font> ); </li></ol></blockquote></li></ol><br><br>  The most difficult part in Perl for me was setting up a connection to a Jenkins server.  We use authorization, and without entering the Perl username / password, the script did not get the desired result.  The issue was resolved as follows: <br><blockquote><ol><li>  <font color="blue">my</font> <font color="Purple">$ realm</font> = <font color="DarkOrange">'Enter you domain credentials'</font> ;  <font color="green"># Realm server</font> </li><li>  <font color="blue">my</font> <font color="Purple">$ user</font> = <font color="DarkOrange">'pavel'</font> ;  <font color="green"># Username</font> </li><li>  <font color="blue">my</font> <font color="Purple">$ pass</font> = <font color="DarkOrange">'sfD90_df13'</font> ;  <font color="green">User password.</font>  <font color="green">Of course, not real :)</font> </li><li>  <font color="blue">my</font> <font color="Purple">$ browser</font> ; </li><li>  <font color="Purple">$ browser</font> = LWP :: UserAgent-&gt; new; </li><li>  <font color="Purple">$ browser</font> -&gt; credentials ( <font color="DarkOrange">'localhost: 443'</font> , <font color="Purple">$ realm</font> , <font color="Purple">$ user</font> =&gt; <font color="Purple">$ pass</font> ); </li></ol></blockquote><br><br>  The status of the current server status is taken from the Jenkins API.  If the project works at <br> <code>https://localhost/job/Project</code> <br>  then by <br> <code>https://localhost/job/Project/api/json</code> <br>  In plain text mode, various project information is displayed.  We are interested, in particular, in a fragment that begins with a <code>‚Äúcolor‚Äù:</code> '. <br>  Jenkins in this place displays the current status.  Examples <br><ul><li>  <code>‚Äúcolor‚Äù:‚Äùblue‚Äù</code> - the last build is successful (interesting fact: instead of ‚Äútraditional‚Äù green, blue is chosen for the convenience of people with color blindness) </li><li>  <code>‚Äúcolor‚Äù:‚Äùred‚Äù</code> - the last build is unsuccessful </li><li>  <code>‚Äúcolor‚Äù:‚Äùaborted_anime‚Äù</code> - is being assembled;  the last build was manually interrupted. </li></ul><br><br>  Through <br><blockquote><ol><li>  <font color="Purple">$ response</font> = <font color="Purple">$ browser</font> -&gt; get ( <font color="Purple">$ url</font> );  <font color="green"># where $ url is a direct link to API for json</font> </li><li>  <font color="green"># For example, https: // localhost / job / Project / api / json</font> </li></ol></blockquote><br>  get the content of the page.  Next - the matter of technology.  We find the necessary fragment and compare it with the known variants of the ‚Äúcolor solutions‚Äù.  If you do not find a known option or the page is not available - extinguish the corresponding LED. <br><br>  The full Perl code is also available <b><a href="http://depositfiles.com/files/05bsd6vh4">in the source code archive</a></b> . <br><br>  Device in operation: <a href="http://www.youtube.com/watch%3Ffeature%3Dplayer_embedded%26v%3DIsgqKsnJ8Uo">www.youtube.com/watch?feature=player_embedded&amp;v=IsgqKsnJ8Uo</a> <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/IsgqKsnJ8Uo%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhhpRyb1OMeh0VhQcbUZpj57E88LiA" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/117261/">https://habr.com/ru/post/117261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117256/index.html">New components for Proliant</a></li>
<li><a href="../117257/index.html">ICQ protocol opened for alternative clients</a></li>
<li><a href="../117258/index.html">[Translation] Now Twitter search is 3 times faster</a></li>
<li><a href="../117259/index.html">505 million rubles for the redesign of the site about spending to overcome the crisis</a></li>
<li><a href="../117260/index.html">Testing Cloud Provider Drives</a></li>
<li><a href="../117262/index.html">The story of how to get from the Mac to the RMM server module, but not without Windows</a></li>
<li><a href="../117264/index.html">Creating a multilingual installer for Windows using WiX</a></li>
<li><a href="../117266/index.html">Space Competition "Let's Go!" Or "To iPad 2?"</a></li>
<li><a href="../117268/index.html">Work with mail on MS Exchange server via EWS. Part 1</a></li>
<li><a href="../117271/index.html">Go sling! - shooting a slingshot at ducks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>