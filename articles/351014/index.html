<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Batch image processing in Windows with ImageMagick. Part I</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ImageMagick is a free and cross-platform graphics editor. 
 It consists of several console utilities. His opportunities do not count as the stars in t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Batch image processing in Windows with ImageMagick. Part I</h1><div class="post__text post__text-html js-mediator-article">  <b>ImageMagick</b> is a free and cross-platform graphics editor. <br>  It consists of several console utilities.  His opportunities do not count as the stars in the sky. <br>  There are many <a href="http://www.imagemagick.org/Usage/">examples of</a> how to use it online.  But most of them are for Linux or PHP.  For Windows, their cat cried.  It is time to fill the gap. <br><a name="habracut"></a><br><h2>  First was the installation </h2><br>  There are many versions of ImageMagick.  If the machine is no longer young and the memory is no more than 1024 MB, you will have Q8.  Otherwise, download <a href="http://www.imagemagick.org/script/download.php">Q16</a> . <br><br>  During installation, check the checkboxes: <br><br><img src="https://habrastorage.org/webt/qt/co/p3/qtcop3emgcjkdhxmbolqukv-aaw.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Thus, we get the whole set of utilities and add them to the system path variable.</i> <br><br><h2>  Batch compression and resize PNG and JPG using ImageMagick </h2><br><blockquote>  <u>Resize and compression perform two ImageMagick utilities:</u> <br>  <b>mogrify.exe</b> - changes the original image. <br>  <b>convert.exe</b> - based on the source, creates a new, modified image. </blockquote><br><h3>  Jpg.  Basic ImageMagick options for compressing and resizing </h3><br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">quality</a> 80 - compression level ( <i>80 is approximately equal to 60 in Adobe Photoshop</i> ) <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">filter</a> Lanczos - <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D0%259B%25D0%25B0%25D0%25BD%25D1%2586%25D0%25BE%25D1%2588%25D0%25B0">Lanczos</a> filter. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">gaussian-blur</a> 0.05 - blur according to <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D0%2593%25D0%25B0%25D1%2583%25D1%2581%25D1%2581%25D0%25B0">Gauss</a> . <br>  Parameters: Radius √ó Sigma in pixels.  Sigma is the standard deviation from the <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D1%2581%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">normal Gaussian distribution</a> .  Slight blurring reduces the size, but reduces the quality when scaling an image. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">sampling-factor</a> 4: 2: 0 - <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B2%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D1%2581%25D1%2583%25D0%25B1%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">color subsampling</a> . <br>  A value of 4: 2: 0 reduces the resolution of the chroma channel to half.  Only applies if the -quality parameter is less than 90. The <i>-sampling-factor</i> parameter determines the sample coefficients to be used by the JPEG encoder for chrominance sampling.  If this option is omitted, the JPEG library will use its own default values.  It is recommended to use it together with the <i>-define jpeg</i> parameter <i>: dct-method = float</i> , which gives a slight improvement in quality, without increasing the file size, since it uses a more accurate discrete cosine transform with a floating comma. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">unsharp</a> 0x3 + 1 + 0 - gives a <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BC%25D0%25B0%25D1%2581%25D0%25BA%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">feeling of greater clarity of the image</a> . <br>  Values: Radius √ó Sigma + Gain + Threshold. <br>  <u>The radius</u> is the radius of the Gaussian blur in pixels, not counting the central pixel ( <i>0 by default</i> ).  For acceptable results, the radius must be greater than sigma.  If it is not set or set to zero, ImageMagick will calculate the maximum possible radius that will give acceptable results for the Gaussian distribution. <br>  <u>Sigma</u> is the standard deviation of the gaussian blur in pixels ( <i>1.0 by default</i> ).  It is an important argument and determines the actual amount of blur that will take place. <br>  <u>Gain</u> - the amount of difference between the original and the blurred image, which is added back to the original ( <i>default 1.0</i> ). <br>  <u>Threshold</u> - the amount of the quantitative difference between images ( <i>default 0.05</i> ). <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">colorspace</a> RGB - RGB color space. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">interlace</a> Plane - used if <a href="https://ru.wikipedia.org/wiki/JPEG">progressive JPEG is</a> needed. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">strip</a> ‚Äî deletes all metadata ( <i>exif, color profile, etc.</i> ). <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">resize</a> - resizes the image in pixels. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">thumbnail</a> - option similar to -resize.  In addition to resizing, it also removes image metadata.  They say that it works faster and better than -resize. <br><blockquote>  It is important to understand that there is no "best" settings.  Applying the same settings to all images will not give the best results.  Some images will appear blurry, or vice versa, too sharp.  Therefore, you need to select the "average" parameters that suit you. </blockquote>  <b>Examples of using the -thumbnail parameter:</b> <br><br>  Resize width 100px, with the same aspect ratio ( <i>height will change proportionally</i> ): <br><br><pre><code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> img.jpg -thumbnail <span class="hljs-number"><span class="hljs-number">100</span></span>x img1.jpg</code> </pre> <br>  Resize the height of 150px, with the same aspect ratio (the <i>width will change proportionally</i> ). <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> img.jpg -thumbnail x150 img1.jpg</code> </pre> <br>  Resize without saving the aspect ratio: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> img.jpg -thumbnail <span class="hljs-number"><span class="hljs-number">100</span></span>x150! img1.jpg</code> </pre> <br>  Resize% ( <i>Percentage</i> ): <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> img.jpg -thumbnail <span class="hljs-number"><span class="hljs-number">20</span></span>% img1.jpg</code> </pre> <br><blockquote>  For convenient batch processing of images, we will use <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BA%25D0%25B5%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2584%25D0%25B0%25D0%25B9%25D0%25BB">batch files</a> .  These are batch files with the extension .BAT or .CMD.  In the examples with jpg, we will set the compression with the quality of 80 and resize the width of 800px. <br>  The batch file will change the image, only in the directory from which it is launched.  He will create the Compressed folder and write modified images to it, adding to the name "_Compressed.jpg". <br></blockquote><br><h3>  JPG - batch file for compression and resize with losses </h3><br><div class="spoiler">  <b class="spoiler_title">The best, in my opinion, option for jpg:</b> <div class="spoiler_text"><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> Off <span class="hljs-built_in"><span class="hljs-built_in">Setlocal</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "Source=%~dp0" <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d "%~dp0" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> ".\*.jpg" ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAILED! Files *.jpg <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Compress all JPG <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Directory: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%Source%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> Compressed <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> Compressed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.jpg) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> ^ -quality <span class="hljs-number"><span class="hljs-number">80</span></span> ^ -filter Lanczos ^ -sampling-factor <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span> ^ -define jpeg:dct-method=float ^ -thumbnail <span class="hljs-number"><span class="hljs-number">800</span></span>x ^ "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" ".\Compressed\<span class="hljs-variable"><span class="hljs-variable">%%~</span></span>ni_Compressed.jpg" ) )&amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Process done! <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br></div></div><br><blockquote>  What makes this batch file?  In the directory from which it is launched, find all files with the extension * .jpg.  It also creates the ‚ÄúCompressed‚Äù folder and copies all the processed images into it, adding ‚Äú_Compressed.jpg‚Äù to their name. </blockquote><br>  I will give for example, a batch file with the utility <b>mogrify.exe</b> (will <i>process and <u>overwrite</u> all the images <b>.jpg</b> , in the directory from which it will be launched</i> ): <br><br><div class="spoiler">  <b class="spoiler_title">An example of a batch file with the utility mogrify.exe:</b> <div class="spoiler_text"><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> Off <span class="hljs-built_in"><span class="hljs-built_in">Setlocal</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "Source=%~dp0" <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d "%~dp0" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> ".\*.jpg" ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAILED! Files *.jpg <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>: mogrify: compress all JPG <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Directory: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>: <span class="hljs-variable"><span class="hljs-variable">%Source%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.jpg) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ( mogrify ^ -quality <span class="hljs-number"><span class="hljs-number">80</span></span> ^ -filter Lanczos ^ -sampling-factor <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span> ^ -define jpeg:dct-method=float ^ -gaussian-blur <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">05</span></span> ^ -thumbnail <span class="hljs-number"><span class="hljs-number">800</span></span>x ^ "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" ) )&amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Process done! <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br></div></div><br><br><h3>  Png.  Basic ImageMagick options for compressing and resizing </h3><br>  PNG is compressed without loss and retains transparency ( <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D1%258C%25D1%2584%25D0%25B0-%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB">alpha channel</a> ). <br>  Although, it is also possible to compress losses.  Also, as with jpg, you can use the options: <i>-gaussian-blur, -strip, -resize, -thumbnail, -unsharp.</i> <br>  As well as many options with options for png: <br>  -define <a href="https://www.imagemagick.org/script/command-line-options.php%3F">png: compression-filter</a> = 2 <br>  -define <a href="https://www.imagemagick.org/script/command-line-options.php%3F">png: compression-level</a> = 9 <br>  -define <a href="https://www.imagemagick.org/script/command-line-options.php%3F">png: compression-strategy</a> = 1 <br>  - <a href="https://www.imagemagick.org/Usage/quantize/">colors</a> 255 - Why not 256?  Because 1 is reserved for the alpha channel. <br>  - <a href="https://www.imagemagick.org/Usage/basics/">depth</a> 8 - number of bits. <br>  - <a href="https://www.imagemagick.org/script/command-line-options.php">quality</a> 90 - for png, this parameter has a different working principle and different values ‚Äã‚Äãthan for jpg. <br><br>  <i>For details on these options, see the ImageMagick website.</i>  <i>There are a lot of them, for every taste and color.</i>  <i>I gave the average parameters that suit me.</i>  <i>Now let's see how they can be used in batch files.</i> <br><br><h3>  PNG - batch file for compression and resize </h3><br><div class="spoiler">  <b class="spoiler_title">Option 1. Compression and resize 400px width without loss:</b> <div class="spoiler_text"><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">Setlocal</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "Source=%~dp0" <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d "%~dp0" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> ".\*.png" ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAILED! Files *.png <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Lossy compress all PNG <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Directory: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%Source%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> Compressed <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> Compressed <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (.\*.png) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> ^ -thumbnail <span class="hljs-number"><span class="hljs-number">400</span></span>x ^ -define png:compression-level=<span class="hljs-number"><span class="hljs-number">9</span></span> ^ -define png:compression-filter=<span class="hljs-number"><span class="hljs-number">2</span></span> ^ -define png:compression-strategy=<span class="hljs-number"><span class="hljs-number">1</span></span> ^ "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" ".\Compressed\<span class="hljs-variable"><span class="hljs-variable">%%~</span></span>ni_Compressed.png" ) )&amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Process done! <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Option 2. Compression and resize 400px width with losses:</b> <div class="spoiler_text"><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> Off <span class="hljs-built_in"><span class="hljs-built_in">Setlocal</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Source="%~dp0" <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d "%~dp0" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> ".\*.png" ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAILED! Files *.png <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Lossy compress all PNG <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Directory: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%Source%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> Compressed <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> Compressed <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (.\*.png) <span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">convert</span></span> ^ -thumbnail <span class="hljs-number"><span class="hljs-number">400</span></span>x ^ -colors <span class="hljs-number"><span class="hljs-number">255</span></span> ^ -depth <span class="hljs-number"><span class="hljs-number">8</span></span> ^ -quality <span class="hljs-number"><span class="hljs-number">90</span></span> ^ "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" ".\Compressed\<span class="hljs-variable"><span class="hljs-variable">%%~</span></span>ni_Compressed.png" ) )&amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cls</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Process done! <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br></div></div><blockquote>  By changing the options and values ‚Äã‚Äãof the parameters in these batch files, you can choose the right option for you, for batch compression and resize. <br></blockquote><br><h3>  What to do if you changed the batch file and it stopped working? </h3><br><ol><li>  Remove all spaces at the end of lines. <br>  In Notepad ++ you can do it like this: select all, Edit - Operations with Spaces - Remove trailing spaces and save.  Or: Ctrl + A - Ctrl + Shift + B - Ctrl + S. </li><li>  Check if the UTF-8 encoding is worth without a BOM.  If you use Cyrillic in the batch file, OEM 866 encoding. </li><li>  Be sure to use the appropriate parameters for this format. </li></ol><br>  <a href="https://yadi.sk/d/xU3m-V2C3Thi88">Download all batch file &gt;&gt;</a> <br><br><h3>  And for dessert </h3><br>  I tested all popular PNG compressors.  For myself, I concluded: <a href="https://pngquant.org/">pngquant</a> gives the best lossy PNG compression.  If you use it to compress screenshots.  With other images - not tested.  It works very quickly.  With the parameter <i>"--strip"</i> - removes all metadata. <br>  <b>pngquant</b> is a PNG compressor that significantly reduces file sizes by converting images to a more efficient 8-bit PNG format with an alpha channel (often 60-80% less than 24/32-bit PNG files).  Compressed images are fully compliant with standards and are supported by all web browsers and operating systems. <br>  <a href="https://github.com/kornelski/pngquant">Pngquant command line options.</a> <br><br>  And of course there is <s>a Kalashnikov</s> batch file for batch processing: <br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> Off <span class="hljs-built_in"><span class="hljs-built_in">Setlocal</span></span> <span class="hljs-built_in"><span class="hljs-built_in">color</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>a <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "Source=%~dp0" <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d "%~dp0" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> ".\*.png" ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> FAILED! Files *.png <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Lossy compress all PNG <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a Directory: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%Source%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> Compressed <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> Compressed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-variable"><span class="hljs-variable">%%i</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.png) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ( "pngquant.exe" --strip "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" -o ".\Compressed\<span class="hljs-variable"><span class="hljs-variable">%%~</span></span>ni_Compressed.png" &amp;&amp; (<span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" - OK&amp; <span class="hljs-built_in"><span class="hljs-built_in">Rem</span></span>.) || <span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> === "<span class="hljs-variable"><span class="hljs-variable">%%i</span></span>" - FAILED! ) ) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Process done! <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>. <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> <span class="hljs-built_in"><span class="hljs-built_in">endlocal</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br>  For everything to work, you need to put <b>pngquant.exe</b> next to the batch file.  Or copy it to any folder and in the batch file, instead of <i>‚Äúpngquant.exe‚Äù</i> , specify the path <i>‚ÄúYourPath \ pngquant.exe‚Äù</i> <br>  Note: pngquant for some reason does not handle files with Cyrillic names. <br><br>  But, we digress.  In the second part, continue and talk about batch adding watermarks using ImageMagick. </div><p>Source: <a href="https://habr.com/ru/post/351014/">https://habr.com/ru/post/351014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351002/index.html">Fantastic-Elasticsearch. How we "tamed" smart search through documents</a></li>
<li><a href="../351004/index.html">Organization of information systems production processes. Part 3. Implementation of the project solution</a></li>
<li><a href="../351006/index.html">How to notice DDOS in time: a monitoring service usage scenario for early detection</a></li>
<li><a href="../351008/index.html">Custom aggregate and window functions in PostgreSQL and Oracle</a></li>
<li><a href="../351012/index.html">Development of high-loaded WebSocket-service</a></li>
<li><a href="../351016/index.html">Discover Nirvana - Yandex‚Äôs Universal Computing Platform</a></li>
<li><a href="../351018/index.html">JMeter 4.0. What's new?</a></li>
<li><a href="../351020/index.html">Why embedded developers should use static code analysis</a></li>
<li><a href="../351022/index.html">The program for network monitoring Network MACMonitor</a></li>
<li><a href="../351024/index.html">FastTrack Training. "Network Basics". "Equipment for data centers." Eddie Martin December 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>