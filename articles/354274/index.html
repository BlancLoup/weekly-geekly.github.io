<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using libpam when setting up SOCKS Dante server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. Faced with the need to configure SOCKS5, I found that on the Internet and in particular on Habr√©, when setting up authorization for d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using libpam when setting up SOCKS Dante server</h1><div class="post__text post__text-html js-mediator-article">  Good day to all.  Faced with the need to configure SOCKS5, I found that on the Internet and in particular on Habr√©, when setting up authorization for <a href="https://www.inet.no/dante/">dante-server</a> , the ‚Äúusername‚Äù method is used. <br><br>  This method is not safe at all.  This was written more than once ( <a href="https://t.me/bykvaadm/655">for example</a> ) and many comparisons were made with 3proxy, which uses a separate password file for authorization.  Anyone interested in the implementation of this feature in Dante please under the cat. <br><a name="habracut"></a><br>  I will not describe the installation and basic settings, there are a lot of these articles and in general there is nothing difficult in them.  I will only touch on the topic of a separate password file.  All commands will be listed for Ubuntu, but doing the same on other distributions is also not difficult. <br><br>  It is necessary to make a reservation that the data sheet for this functionality should be compiled with PAM support, in the installation articles this is indicated by the fact that the following line should be in the source configuration status: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">PAM: Enabled</code> </pre> <br><br>  If you install a package from the repository, then PAM is already in its dependencies. <br><br>  So, first we need additional components: <br><br><pre> <code class="bash hljs">aptitude install libpam-pwdfile</code> </pre> <br>  The <a href="https://packages.ubuntu.com/xenial/libpam-pwdfile">libpam-pwdfile package</a> provides the ability to authenticate against a separate / etc / passwd file format. <br><br>  After installation, edit the file /etc/pam.d/sockd <br><br><pre> <code class="bash hljs">nano /etc/pam.d/sockd</code> </pre> <br><br>  Enter the following into the file: <br><br><pre> <code class="bash hljs">auth required pam_pwdfile.so pwdfile <span class="hljs-variable"><span class="hljs-variable">${DIR_FOR_PASSWD_FILE}</span></span>/sockd.passwd account required pam_permit.so</code> </pre><br><br>  Here we set the file with passwords for our service.  Replace $ {DIR_FOR_PASSWD_FILE} with the directory where you will have the password file (for example / opt / dante). <br><br>  The password file itself has the format of the / etc / passwd file, which means a separate line for each user in the form of parameters separated by a colon.  The first parameter is the username, the second is the encrypted password. <br><br><pre> <code class="bash hljs">SomeUser:<span class="hljs-variable"><span class="hljs-variable">$1</span></span><span class="hljs-variable"><span class="hljs-variable">$1bhzkYnM</span></span><span class="hljs-variable"><span class="hljs-variable">$cfYSzS9Vx17AypWYAnnhn0</span></span></code> </pre> <br><br>  Encrypted passwords can be obtained using the mkpasswd utility from the <a href="https://packages.ubuntu.com/xenial/whois">whois</a> package as follows: <br><br><pre> <code class="bash hljs">mkpasswd --method=md5 SomeStrongPassword</code> </pre> <br><br>  After we have all prepared, it remains only to enable the appropriate authorization method in Dante.  To do this, edit your /etc/sockd.conf file and change the next line. <br><br><pre> <code class="bash hljs">socksmethod: username</code> </pre> <br><br>  on this <br><br><pre> <code class="bash hljs">socksmethod: pam.username</code> </pre> <br><br>  We reboot Dante and get authorization for a separate password file. <br><br>  PS <br><br>  The PAM service name used by Dante by default is sockd.  Also, if you want to use the configuration file libpam_pwdfile from another configured service, or use several configurations, you can use the pamservicename directive in the Dante configuration file.  Usage example: <br><br><pre> <code class="bash hljs">client pass { from: 0.0.0.0/0 to: 0.0.0.0/0 <span class="hljs-comment"><span class="hljs-comment">#the servicename should differ from the servicename in socks-rules pamservicename: pam_host }</span></span></code> </pre><br>  For a more complete understanding of the use of this directive, I recommend to refer to the Dante documentation, the link to which is given below. <br><br>  Used materials: <br><br>  <a href="https://www.inet.no/dante/doc/1.4.x/config/auth_pam.html">Dante documentation.</a>  <a href="https://www.inet.no/dante/doc/1.4.x/config/auth_pam.html">PAM Autentication.</a> <br><br>  <a href="https://github.com/tiwe-de/libpam-pwdfile">Description of the libpam-pwdfile module on GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/354274/">https://habr.com/ru/post/354274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354262/index.html">"The secret passenger": collecting feedback from consumers "on the fly"</a></li>
<li><a href="../354264/index.html">What's New in PostgreSQL 11: JSONB Transforms</a></li>
<li><a href="../354266/index.html">Internship in e-Legion</a></li>
<li><a href="../354268/index.html">Morrowind Project</a></li>
<li><a href="../354270/index.html">Insolence and enthusiasm for rapid growth from Aviasales</a></li>
<li><a href="../354276/index.html">"End of the World" will not be</a></li>
<li><a href="../354278/index.html">Right-sided assignment and other unusual programming techniques in C #</a></li>
<li><a href="../354280/index.html">Javascript es6: write less - do more</a></li>
<li><a href="../354282/index.html">Configure BGP to bypass locks, or ‚ÄúHow I stopped being afraid and fell in love with the RKN‚Äù</a></li>
<li><a href="../354284/index.html">Basics of programming on the SAS Base. Lesson 3. Reading text files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>