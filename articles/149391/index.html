<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Business analysis in the social network Odnoklassniki</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is about statistics systems in Odnoklassniki. It will talk about why we need statistics, and what systems we have to work with it. In the fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Business analysis in the social network Odnoklassniki</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/f5d/021/60d/f5d02160d39649c8b404906da0ce6a51.png"><br><br>  This post is about statistics systems in Odnoklassniki.  It will talk about why we need statistics, and what systems we have to work with it.  In the following posts we will describe in detail: <br><br>  ‚Ä¢ systems architecture; <br>  ‚Ä¢ main components of systems and algorithms; <br>  ‚Ä¢ non-trivial problems and solutions <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Why do we need statistics? </h4><br>  We need statistics in order to know everything about the work of our site.  This knowledge allows us to: <br><br>  ‚Ä¢ to develop services not at random, but to purposefully improve the performance of the site and user activity; <br>  ‚Ä¢ evaluate the success of any development, be it a new service or the simplest refactoring of code; <br>  ‚Ä¢ track the work of the site as a whole; <br>  ‚Ä¢ to control the work of each of the site components and their interrelation; <br>  ‚Ä¢ investigate anomalies in the work of individual components of the site; <br>  ‚Ä¢ investigate abnormal changes in user activity; <br>  ‚Ä¢ analyze the target audience of our services. <br><br><h4>  What kind of data we collect </h4><br>  To really know everything about the work of our site, you need to collect a lot of information.  Every day we process more than two trillion (2,000,000,000,000) records.  Interested parties can access the processed statistics with a delay of 2-3 minutes, that is, almost in real time. <br><br>  We log: <br><br>  ‚Ä¢ any user activity (any click); <br>  ‚Ä¢ any call to any non-trivial component of the site (for example, java-class and method); <br>  ‚Ä¢ any interrelationships of the site components (for example, a cache server accessing the web server). <br><br>  Also, we upload data on user content (for example, uploaded photos and ratings) and activity (for example, logins or visits) to the statistics system in order to analyze user behavior in detail. <br><br><h4>  Tools for working with statistics </h4><br><h5>  System of graphs and deshbordov </h5><br>  Statistics we look at mainly in the form of graphs.  These charts most often come in two forms: <br><br>  1) a graph where one point is aggregated data for five minutes.  These are schedules for operational monitoring. <br><br><img src="https://habrastorage.org/storage2/6c2/7c1/e2f/6c27c1e2f7b2bb70912add1753444bbc.png"><br><br>  2) a graph where one point is aggregated data for at least one day.  You can also specify other periods - week, month, quarter and year.  These are charts for tracking long-term trends. <br><br><img src="https://habrastorage.org/storage2/8a0/0b8/ab3/8a00b8ab3cc2fc4492f63fc073e9f24e.png"><br><br>  With a single click, any graph is transferred online, in which you can change the parameters and filters of the graph and immediately get the result. <br><br><img src="https://habrastorage.org/storage2/50d/600/abc/50d600abc61f9370335d70c419ad872a.png"><br><br>  Main features of the graphs: <br><br>  1) select any date and any period (the whole history is available); <br>  2) select any parameter - for example, the number of calls, the average execution time; <br>  3) group by any classifier, for example, by servers or by java-classes; <br>  4) put any filters - by value, by list of values; <br>  5) process mathematical algorithms - for example, smooth the schedule; <br>  6) switch from 5-minute schedule to daily and back; <br>  7) save the customized schedule to a deshborb as new or overwrite the old one. <br><br>  Of these graphs, we make thematic deshbordy.  To do this, we wrote a web application in ASP.NET. <br><br><img src="https://habrastorage.org/storage2/e83/c96/87a/e83c9687ad05e74d85d41f1b446d8e1b.png"><br><br>  An important aspect of this system is that they work with charts and are made by managers, developers and administrators, and not by the business analysis department.  Business analysts are engaged only in providing tools and ensuring system performance. <br><br><h5>  Traditional reporting system </h5><br>  We also have traditional reporting: these are static reports that show the requested data in the form of tables or graphs.  The business analysis department creates them on request.  These reports are integrated into the system of graphs and dashboards. <br><br>  We will not consider the reports - by themselves they are not interesting.  Consider the methods of processing large amounts of data (for example, only logins in 2011, we had almost 30 billion). <br><br><h5>  Multidimensional (OLAP) analysis system </h5><br>  Often it is more convenient to analyze long-term trends in the pivot-table style, where any parameter can be divided into components in the form of a table. <br><br>  Therefore, we create OLAP-cubes for different topics, for example, a cube of payments, a cube of logins and others.  To work with cubes, we wrote a web application. <br><br><img src="https://habrastorage.org/storage2/524/fab/2e7/524fab2e7a3d2c9b9305eee97559bd44.png"><br><br><h5>  System for automatic detection of anomalies </h5><br>  Viewing the dashboards with charts is not the most effective way to monitor.  We have created a system that ‚Äúlooks through‚Äù the graphics, and, if it notices abnormal deviations from the ‚Äúnorm,‚Äù notifies it by letter or by SMS. <br><br><img src="https://habrastorage.org/storage2/b77/f87/edb/b77f87edb68463e35040306813d13106.png"><br><br><h5>  System of automatic detection of "bottlenecks" in the infrastructure </h5><br>  We have a fairly large fleet of equipment - more than 4,000 servers, for which we use various specialized systems - Cacti, Zabbix and others.  When the use of a resource reaches a critical level, administrators are automatically notified of this. <br><br>  In order for server load to reach a critical level as rarely as possible, it is necessary to regularly analyze the operational performance of these servers and make appropriate decisions, for example, on adding additional capacity.  To qualitatively perform such an analysis manually is very difficult.  Therefore, we have written a module that unloads data from Cacti systems into the data warehouse and sorts out operational figures for the previous couple of weeks to ‚Äúhow soon will we reach a critical level, if everything continues in the same vein‚Äù. <br><br><img src="https://habrastorage.org/storage2/3da/284/204/3da284204f8b2d6fe377ca3055b4e922.png"><br><br><h4>  Used technologies </h4><br><h5>  Data store </h5><br>  In 2008, when they decided to build a business analysis system, MS SQL bases were widely used at Odnoklassniki.  Therefore, the logical choice for us was to use this platform for business analysis. <br><br>  Today, as a data warehouse, we use only MS SQL 2008 R2 Enterprise Edition.  We are planning an upgrade to MS SQL 2012. Of course, we will inform you about the results. <br><br><h5>  Data processing </h5><br>  We tried to use MS SQL Integrity Services, but this technology turned out to be too disadvantageous in terms of labor costs.  The same code can be written in T-SQL several times faster.  Therefore, 99.9% of the data processing code is written in T-SQL, and the rest is in .NET. <br><br><h5>  OLAP </h5><br>  For multidimensional analysis, we use MS SQL 2008 R2 Analysis Services.  We are also planning an upgrade to MS SQL 2012. We wrote a web application for the front-end. <br><br><h5>  Graph and report generator </h5><br>  For generation of graphs and most reports we use MS SQL Reporting Services.  Initially, this was a very good solution, because there it was possible to quickly build the necessary minimum functionality.  But now the system requirements have grown - we need a richer, faster and more dynamic user interface.  Therefore, we plan to migrate to another solution (have not yet chosen which one). <br><br><h5>  Web applications </h5><br>  All web applications are written in ASP.NET.  We use DevExpress UI components that allow you to easily and quickly create good shapes in the same style. <br><br>  In the next post, we will describe in detail how we log the information and deliver the data to DWH. <br><br>  Team Odnoklassniki </div><p>Source: <a href="https://habr.com/ru/post/149391/">https://habr.com/ru/post/149391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149385/index.html">Home Office Ideas</a></li>
<li><a href="../149386/index.html">Tectonic plates found on Mars</a></li>
<li><a href="../149388/index.html">ImageCMS 3.3.6.72 release and major company news</a></li>
<li><a href="../149389/index.html">Phishing site advertising in Yandex.Direct and fake Skype</a></li>
<li><a href="../149390/index.html">SQLite is a great embedded database (part 2)</a></li>
<li><a href="../149392/index.html">A bit of fire on pure CSS (Firefox)</a></li>
<li><a href="../149396/index.html">Zxcvbn program: realistic password strength assessment</a></li>
<li><a href="../149397/index.html">Browser API for registering on the site and making instant payments</a></li>
<li><a href="../149399/index.html">How income is distributed between applications</a></li>
<li><a href="../149400/index.html">Two Open Source organizations have argued over a logo that could violate a trademark.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>