<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CleverStyle CMS module architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, there were several articles on CMS written by their developers, so I decided to write. 
 I already wrote about CleverStyle CMS twice (the la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CleverStyle CMS module architecture</h1><div class="post__text post__text-html js-mediator-article">  Recently, there were several articles on CMS written by their developers, so I decided to write. <br>  I already wrote about CleverStyle CMS twice (the last time a year ago), and twice received a huge spectrum of criticism and a large bundle of comments from a different plan - thanks for everything, I spent time taking into account errors and correcting them. <br><br>  The article is again for developers, in it I will try to convey in simple language the advantages of using this particular engine for developing the site, we will discuss one of the most important and functional components - the module. <br><a name="habracut"></a><br><h4>  A bit of history </h4><br>  When I read that the engine was written by one person for a year in his spare time - there is surprise and respect for the work done.  Developing a three-year system with a tail of the year, you understand what a huge layer of work it is, but even more, most likely, ahead.  In the majority, I came across the development of sites with unique functionality, and the engine was primarily written as a kernel to help the developer, despite the CMS in the title, which affects almost everything in it. <br><br><h4>  Module philosophy </h4><br>  A module is such a component that is responsible for rendering the page content or processing requests to the API.  The module contains everything in itself and does not distribute its files to the corners of the system (therefore, the paths in the article will always be indicated relative to the root of the module folder), and if you need to put something back - after deletion, the module removes everything in order to leave nothing .  This allows you to maintain system performance at the proper level over time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The module can be extremely simple (a folder with a single <i>index.html</i> or <i>index.php</i> file), or as complex as needed: with support for several databases, file storage, dependencies, external API, multilingualism, and lots of various resources.  With all this, you use only what you need, and no more than that (minimum template code). <br><br><h4>  Page hierarchy </h4><br>  There can be three main ‚Äúparts‚Äù of the module (in any combination): administration, API, pages for the end user.  All three parts can consist of a single <i>index.php</i> file (or optionally <i>index.html</i> in the case of a page for a user), or a hierarchy of pages, which is described in <i>admin / index.json</i> , <i>api / index.json,</i> and <i>index.json</i> .  First and second level pages are supported, the rest are implemented by the developer, if necessary.  It looks like this (example from the system module, administration): <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"components"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"modules"</span></span>, <span class="hljs-string"><span class="hljs-string">"plugins"</span></span>, <span class="hljs-string"><span class="hljs-string">"blocks"</span></span>, <span class="hljs-string"><span class="hljs-string">"databases"</span></span>, <span class="hljs-string"><span class="hljs-string">"storages"</span></span> ], <span class="hljs-string"><span class="hljs-string">"general"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"site_info"</span></span>, <span class="hljs-string"><span class="hljs-string">"system"</span></span>, <span class="hljs-string"><span class="hljs-string">"optimization"</span></span>, <span class="hljs-string"><span class="hljs-string">"appearance"</span></span>, <span class="hljs-string"><span class="hljs-string">"languages"</span></span>, <span class="hljs-string"><span class="hljs-string">"about_server"</span></span> ], <span class="hljs-string"><span class="hljs-string">"users"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"general"</span></span>, <span class="hljs-string"><span class="hljs-string">"users"</span></span>, <span class="hljs-string"><span class="hljs-string">"groups"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>, <span class="hljs-string"><span class="hljs-string">"security"</span></span>, <span class="hljs-string"><span class="hljs-string">"mail"</span></span> ] }</code> </pre> <br>  Accordingly, the pages will look like this: <br><br><ul><li>  <i>admin / System</i> (the first element at each level of nesting from <i>index.json</i> will be selected, similar to <i>admin / System / components / modules</i> ) </li><li>  <i>admin / System / general / about_server</i> </li><li>  <i>admin</i> (system module will be selected) </li></ul><br>  For processing paths, files of the same name are used, and they are executed in the following logical order: <br><br><ul><li>  <i>admin / index.php</i> (always running if available) </li><li>  <i>admin / components.php</i> (if available) </li><li>  <i>admin / components / modules.php</i> </li></ul><br>  It is convenient to use REST for the API, and in this connection, processing requests to the API is logical and conveniently different: <br><br><ul><li>  <i>api / index.php</i> </li><li>  <i>api / index. {method} .php</i> </li><li>  <i>api / posts.php</i> </li><li>  <i>api / posts. {method} .php</i> </li></ul><br>  This way, requests can be sent using different HTTP methods to different files.  If there is no suitable file with the method, but there is a file with another method, the logical <i>405 Method Not Allowed</i> will arrive in response, and in the <i>Allow</i> header there will be a list of available methods. <br><br>  It is also worth noting that when processing requests, the numerical parts of the path are ignored when parsing the page structure (this is logical, since the numbers are usually the id of some elements or the page number). <br><br>  For manual manipulations, you can get the page path without the <i>admin</i> or <i>api</i> prefix in such a simple way: <br><br><pre> <code class="php hljs">$Config = \cs\Config::instance(); $route = $Config-&gt;route; <span class="hljs-comment"><span class="hljs-comment">// ['components', 'modules']   ,  ['posts', 10]    API</span></span></code> </pre><br>  If desired, you can leave only <i>index.php</i> and deal with the route itself. <br><br><h4>  Resources (scripts, styles, images, fonts, web components) </h4><br>  The system distinguishes three main types of supported resources: scripts, styles, web components.  All others are often tied to those mentioned.  Located in the appropriate folders: <br><br><ul><li>  <i>includes / css</i> </li><li>  <i>includes / js</i> </li><li>  <i>includes / html</i> (in the case of Apache2, you also need to put it here or a level above <i>.htaccess</i> , which will allow access to <i>* .html</i> files) </li></ul><br>  All files inside folders with the appropriate extension will be automatically picked up by the system in alphabetical order, files can be embedded in subfolders - this is not a problem.  If you wish to exclude the processing of a folder by the kernel, it is enough to put in the desired place an empty file with the name <i>! Include</i> (reads <i>not to connect</i> ). <br><br>  Everything is simple, and most importantly effective.  The fact is that when connecting resources, the kernel is able to resolve dependencies of components, that is, everything necessary for this component will be automatically picked up.  Moreover, when setting options in the admin panel, the scripts, styles and web components will be minified, combined (if desired, you can additionally enable the so-called <a href="https://www.polymer-project.org/articles/concatenating-web-components.html">vulcanization</a> for web components), and packed using gzip, while all operations are done atomically, there is each independent set of resources lying in a separate file, and when connecting minified compressed versions, dependency accounting is still preserved, and the files get unique prefixes so that when updating certain resource files, their compressed versions are renamed  Enovyvalis and not hung in the browser cache causing problems.  It is also worth noting that all relative references to images, fonts, nested style imports are embedded in the resulting css file minimizing the number of HTTP requests (until HTTP2 is ubiquitous or what they decide in the end), this is also true for the styles that are used in web components. <br><br>  To include resources on certain pages, the <i>includes / map.json</i> file is used, which indicates on which pages which resources are needed.  If the resource is not specified there, it will be connected on all pages of the site (just like that, not only in the current module).  Here is one example: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"admin/Blogs"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"admin.css"</span></span> ], <span class="hljs-string"><span class="hljs-string">"Blogs"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"general.css"</span></span>, <span class="hljs-string"><span class="hljs-string">"general.js"</span></span> ] }</code> </pre><br>  <i>includes / css</i> and similar prefixes do not need to be specified, it is clear from the file extension where it lies. <br><br><h5>  Web components </h5><br>  In fact, they are worth mentioning a little separately.  The system kernel comes bundled with the <a href="https://www.polymer-project.org/docs/start/platform.html">Polymer Platform</a> (polyfill web components) and <a href="https://www.polymer-project.org/">Polymer</a> itself.  Making them work with jQuery and some other libraries was not trivial at all, but the developers promptly accepted patches with fixes, so the Polymer and jQuery that are included are the git versions after the patch with the fix, since there was no release yet.  Also, the engine of the jQuery.ready <i>()</i> patch engine to execute it after initializing all the web components. <br><br>  To be brief, I don‚Äôt know at the moment where there is such a combination of patches that allows you to use web components in production right now (sounds a bit loud, but if you tried to use web components in real projects with jQuery, you understand what I‚Äôm talking about). ). <br><br><h5>  If you are not going to use CleverStyle CMS </h5><br>  Although the code is rather monolithic, it‚Äôs quite easy to take certain functionality and use it independently in your project (the MIT license allows it), as an example, <a href="https://github.com/nazar-pc/CleverStyle-CMS/blob/master/core/classes/Page/Includes_processing.php">combining and minifying styles and web components</a> (with support for vulcanization). <br><br><h4>  Dependencies </h4><br>  Modules can depend on each other, and on plug-ins (another type of components, does not have its own page for display). <br><br>  Each module can have not only a name, but also provide a specific functionality, and dependencies often point to the functionality, which allows you to select one of several modules that provide the desired functionality (and the engine will not allow you to install a second module that provides the same functionality).  Also in the case of a specific module (for example, System, which is associated with the engine core), you can limit the desired version. <br><br>  In conclusion, you can specify optional dependencies (which extend the functionality, but are not mandatory), as well as starting with which version of the module it can be upgraded to the current one (sometimes there are compatibility issues, and the update needs to be done gradually, or just update from outdated versions terminated to get rid of obsolete update scripts). <br><br>  An example meta-file <i>meta.json</i> describing the details of the module and its dependencies: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"package"</span></span> : <span class="hljs-string"><span class="hljs-string">"Blogs"</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span> : <span class="hljs-string"><span class="hljs-string">"modules"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : <span class="hljs-string"><span class="hljs-string">"0.097.0+build-107"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Adds blogging functionality. Comments module is required for comments functionality, Plupload or similar module is required for files uploading functionality."</span></span>, <span class="hljs-string"><span class="hljs-string">"author"</span></span> : <span class="hljs-string"><span class="hljs-string">"Nazar Mokrynskyi"</span></span>, <span class="hljs-string"><span class="hljs-string">"website"</span></span> : <span class="hljs-string"><span class="hljs-string">"cleverstyle.org/cms"</span></span>, <span class="hljs-string"><span class="hljs-string">"license"</span></span> : <span class="hljs-string"><span class="hljs-string">"MIT License"</span></span>, <span class="hljs-string"><span class="hljs-string">"db_support"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"MySQLi"</span></span> ], <span class="hljs-string"><span class="hljs-string">"provide"</span></span> : <span class="hljs-string"><span class="hljs-string">"blogs"</span></span>, <span class="hljs-string"><span class="hljs-string">"require"</span></span> : <span class="hljs-string"><span class="hljs-string">"System=&gt;0.574"</span></span>, <span class="hljs-string"><span class="hljs-string">"optional"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"Comments"</span></span>, <span class="hljs-string"><span class="hljs-string">"Plupload"</span></span>, <span class="hljs-string"><span class="hljs-string">"TinyMCE"</span></span>, <span class="hljs-string"><span class="hljs-string">"file_upload"</span></span>, <span class="hljs-string"><span class="hljs-string">"editor"</span></span>, <span class="hljs-string"><span class="hljs-string">"simple_editor"</span></span>, <span class="hljs-string"><span class="hljs-string">"inline_editor"</span></span> ], <span class="hljs-string"><span class="hljs-string">"multilingual"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"interface"</span></span>, <span class="hljs-string"><span class="hljs-string">"content"</span></span> ], <span class="hljs-string"><span class="hljs-string">"languages"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"English"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"—ó"</span></span> ] }</code> </pre><br><h4>  What about the code? </h4><br>  All classes, traits, and similar things are in the <i>cs</i> or nested namespace. <br><br>  The autoloader of classes is designed so that the class <i>cs \ modules \ Blog \ Post</i> will be searched in the <i>Post.php</i> file of the <i>Blog</i> module - simply and logically. <br><br>  In order to subscribe to events in the system (for example, clearing the data of the module when it is deleted), <a href="https://github.com/nazar-pc/CleverStyle-CMS/wiki/Triggers">triggers</a> are used, and their announcement most often lies in the <i>trigger.php</i> file, which is called on each page regardless of the displayed module, and is used specifically for these purposes . <br><br>  I do not write code examples, it will take a lot of space, and the article is more about the architecture and operation principle than about specific examples. <br><br><h4>  Summary </h4><br>  It is briefly about what the module is, how it is arranged, and why it is so.  I hope it is clear from what was written that the system does a lot of obvious and useful things itself, but at the same time it allows the developer to change the behavior (as examples, the ability to manually handle page addresses and connection of resources was mentioned).  This is not exhaustive information, some things are missed for simple, as they cover narrower usage scenarios, but if there is interest, I will continue to describe more specific details. <br><br><h4>  Plans </h4><br>  Recently, the engine has been significantly refactored, and the first release in three years, version 1.0, is near. <br>  In this regard, I would like to get more feedback. <br>  At the moment, I am most worried about the lack of tests (several existing ones are not considered).  In recent changes, steps have been taken towards improving code testability, but something still doesn‚Äôt add up with tests, I will be very happy to receive help in this area (I don‚Äôt have to offer DI). <br><br>  That's all, I hope I managed to arouse interest to look at all this live.  The code is covered with phpDoc comments almost everywhere, which is very well taken up by the IDE, as well as an example you can watch the finished modules in the engine repository. <br>  <a href="https://github.com/nazar-pc/CleverStyle-CMS">The project page on GitHub</a> , there is also a wiki with documentation (mainly on Backend). <br><br><h4>  Demo </h4><br>  In the comments they asked for a demo, here it is (Nginx + HHVM): <br>  <a href="http://demo.cscms.org/">http://demo.cscms.org</a> <br>  admin: 1111 </div><p>Source: <a href="https://habr.com/ru/post/240789/">https://habr.com/ru/post/240789/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240779/index.html">Create your own dojo widgets</a></li>
<li><a href="../240781/index.html">KodiCMS architecture</a></li>
<li><a href="../240783/index.html">Finger Trees (Part 1. Introduction)</a></li>
<li><a href="../240785/index.html">Simple Rest Api framework based on Phalcon</a></li>
<li><a href="../240787/index.html">Web application - well, almost without a back-end: Flask, Redis, API via JSONP, JSFiddle.net</a></li>
<li><a href="../240791/index.html">Russian translation Apple iPhone Developer Program License Agreement + Schedule 2 v19</a></li>
<li><a href="../240793/index.html">Multiboot, UEFI, NTFS or almost a recipe for happiness</a></li>
<li><a href="../240795/index.html">Evaluation of the competitiveness of search queries for variations in search results</a></li>
<li><a href="../240799/index.html">The story of one bug in the machine for video poker</a></li>
<li><a href="../240803/index.html">Free Cryptic Disk 4 with TrueCrypt support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>