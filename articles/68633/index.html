<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dependency injection for Scala: Cake Pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I just started learning Scala. For those who still do not know what kind of language, a short excerpt from the official site : 

 Scala is a concise, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dependency injection for Scala: Cake Pattern</h1><div class="post__text post__text-html js-mediator-article"> I just started learning Scala.  For those who still do not know what kind of language, a short excerpt <a href="http://www.scala-lang.org/">from the official site</a> : <br><br>  <i>Scala is a concise, elegant and statically typed programming language that combines the capabilities of an object-oriented and functional language.</i>  <i>Scala is fully compatible with Java.</i> <br><br>  Today I would like to show you how, using the rich expressive abilities of this language, to solve a problem that is relevant for any more or less large project, namely work with component dependencies or dependency injection.  The last few years I have used spring ioc to solve this problem, however this framework has several flaws, the most obvious of which is building an application from components at runtime and having xml descriptors (yes, of course, you can use autowiring and annotations, but also these opportunities have their own serious problems). <br><a name="habracut"></a><br>  Maybe I, of course, suffer from a lack of attention, but a typical problem for me is that when I write a component, I often forget to write it in the xml-descriptor, or I forget to write some of its dependencies.  This problem can only be detected at runtime ‚Äî by running either automated tests or the application itself.  And in general, the presence of descriptors in the xml application has caused me some irritation since the days of working with JSF.  The fewer the descriptors, the better. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To my delight in Scala there is a rather laconic way of organizing DI free from such flaws.  The Cake pattern itself was described in the article <a href="http://lamp.epfl.ch/~odersky/papers/ScalableComponent.pdf">‚ÄúScalable Components Abstraction,‚Äù</a> written by Martin Odersky and Matthias Zenger, which I highly recommend reading.  The name of the template was suggested by Jon Pretty in the <a href="http://www.nabble.com/Inheriting-static-members-td10106162.html">discussion on Nabble</a> : "The rationale is, besides my love for cakes, the fact that the cake is made of several layers (separated by jam) and can be cut into slices."  The name stuck. <br><br>  Consider a simple example of the implementation of this template.  Let's start with the announcement of two components of the application: <br> <code>trait NameProviderComponent { <br> val nameProvider:NameProvider <br> <br> trait NameProvider { <br> def getName:String <br> } <br> <br> } <br> <br> trait SayHelloComponent { <br> val sayHelloService:SayHelloService <br> <br> trait SayHelloService { <br> def sayHello:Unit <br> } <br> <br> } <br></code> <br>  What is required to package our component interfaces into NameProviderComponent and SayHelloComponent containers, and why nameProvider constants were required: NameProvider and sayHelloService: SayHelloService will become clear a little later, in the meantime, we will write the implementation of these components.  Let's start with the name provider: <br> <code>trait NameProviderComponentImpl extends NameProviderComponent { <br> <br> class NameProviderImpl extends NameProvider { <br> def getName:String = "World" <br> } <br> <br> } <br></code> <br>  Everything is quite simple, however, until it clarifies the process of inserting dependencies.  Consider the only module of our application that will have dependencies: <br> <code>trait SayHelloComponentImpl extends SayHelloComponent { <br> this: SayHelloComponentImpl with NameProviderComponent =&gt; <br> <br> class SayHelloServiceImpl extends SayHelloService { <br> def sayHello:Unit = println("Hello, "+nameProvider.getName+"!") <br> } <br> <br> } <br></code> <br>  We will understand how this works.  The first thing to notice is the construction: ‚Äúthis: SayHelloComponentImpl with NameProviderComponent =&gt;‚Äù, which literally tells the compiler exactly which type should have an object that implements the given trait.  After such a declaration, it becomes possible to use the indefinite nameProvider constant in the body of the sayHello function, since the trait NameProviderComponent declares such a constant.  This is the same jam that connects the layers. <br><br>  Let's turn to the cake as a whole: <br> <code>object ComponentRegistry <br> extends SayHelloComponentImpl <br> with NameProviderComponentImpl { <br> val nameProvider = new NameProviderImpl <br> val sayHelloService = new SayHelloServiceImpl <br> } <br></code> <br>  ;  the ComponentRegistry object implements both the trait implementations of our modules and defines the last, so far undefined, class members ‚Äî the constants nameProvider and sayHelloService.  The sayHelloService will use this object to get the nameProvider NameProviderImpl.  ComponentRegistry is the direct equivalent of SpringContext. <br><br>  How to use it: <br> <code>object MyApplication { <br> def main(args : Array[String]) : Unit = { <br> ComponentRegistry.sayHelloService.sayHello <br> } <br> } <br></code> <br>  the execution of this application gives the expected result: ‚ÄúHello, World!‚Äù <br><br>  Now a little about the advantages: <br><ul><li>  The context / registry is ‚Äúassembled‚Äù at the time of compilation.  Forgotten dependencies will break the build.  It is impossible to compile with dependencies of inappropriate types.  For example: <br> <code>object BrokenComponentRegistry <br> extends SayHelloComponentImpl { <br> val sayHelloService = new SayHelloServiceImpl <br> } <br></code> <br>  will break the compilation with a completely sane message ‚Äúillegal inheritance;  self-type BrokenComponentRegistry.type does not conform to SayHelloComponentImpl's selftype SayHelloComponentImpl with NameProviderComponent ¬ª <br></li><li>  Let it not be very critical, but the application start time is reduced, because it does not require parsing of xml descriptors and active work with the reflections API. </li></ul><br><br>  It is clear that dependency injection is just a small piece needed in a typical project.  In addition, the AOP would not hurt at all, say, to ensure verification of rights to execute code or declarative transaction management, and many other things, but I will write about this some time next time. <br><br></div><p>Source: <a href="https://habr.com/ru/post/68633/">https://habr.com/ru/post/68633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68622/index.html">Football, hockey etc. on google calendar</a></li>
<li><a href="../68624/index.html">How Opera Turbo Saved the Internet ...</a></li>
<li><a href="../68626/index.html">Imagine Cup 2010 - YOU Can Change The World!</a></li>
<li><a href="../6863/index.html">New Gmail features</a></li>
<li><a href="../68630/index.html">Windows 7 - Start Sales</a></li>
<li><a href="../68636/index.html">CNews opened an information resource and its own assembly IE8</a></li>
<li><a href="../68637/index.html">When you hire a single-time freelancer, what kind of interview do you have?</a></li>
<li><a href="../68642/index.html">Sony Vaio X Netbook</a></li>
<li><a href="../68644/index.html">Troubleshooting DNS in Windows 7</a></li>
<li><a href="../68645/index.html">Third projection</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>