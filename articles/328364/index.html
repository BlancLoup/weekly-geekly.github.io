<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Crystal High Performance Services, Newbie Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 DISCLAIMER 

 author's opinion may not coincide with your opinion, welcome to the comments. 


 In prehistoric times, high-performance ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Crystal High Performance Services, Newbie Introduction</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vvedenie">  Introduction </h2><br><div class="spoiler">  <b class="spoiler_title">DISCLAIMER</b> <div class="spoiler_text"><p>  author's opinion may not coincide with your opinion, welcome to the comments. </p></div></div><br><p>  In prehistoric times, high-performance Web applications could be written mainly in C or C ++.  Maintaining such applications was not just expensive, but very expensive. </p><br><p>  The need for a programming environment in which it is convenient to write, read and modify high-performance applications, appeared long ago. </p><br><p>  First of all, the terms "performance" and "reliability" refer to Erlang.  It is great in its niche, but the syntax makes you want something better.  Actually, this is why <a href="http://elixir-lang.org/">Elixir</a> appeared, but this is not about this ecosystem. </p><br><p>  If, on the other hand, we lower the reliability bar a little, then we have a wide choice, including <a href="https://nodejs.org/">Node</a> , <a href="https://golang.org/">Go</a> , <a href="https://nim-lang.org/">Nim</a> and <a href="https://crystal-lang.org/">Crystal</a> .  You can look at typical <a href="http-benchmark">performance benchmarks</a> , including <a href="https://github.com/kostya/benchmarks">more</a> <a href="https://www.techempower.com/benchmarks/">extensive ones</a> . </p><br><p>  All of these programming environments offer garbage collection, which reduces the complexity of code maintenance. </p><br><p>  With this, Node offers everyone an understandable programming language (and variations on the topic), but dynamic typing reduces productivity by several times relative to other applicants. </p><br><p>  If we need more requests per second, the choice for today is <strong>Go</strong> .  This programming environment has excellent performance characteristics, support from large companies and a considerable number of active projects. </p><br><p>  So why Crystal? <a name="habracut"></a></p><br><h2 id="llvm">  Llvm </h2><br><p>  Crystal provides a frontend for LLVM infrastructure, allowing you to compile code for all supported platforms (x64, ARM, Web Assembly etc.). </p><br><h2 id="staticheskaya-tipizaciya-bez-ukazaniya-tipov">  Static typing without specifying types </h2><br><p>  Crystal can in most cases deduce the types of data used. </p><br><p>  For example, we send somewhere to the <em>speak</em> method in one case a string, in the other case an integer. </p><br><p>  In such a case, Crystal at compile time knows that the method <em>speak</em> takes a parameter of the derived type <em>String |</em>  <em>Int32</em> . </p><br><p>  We can write this code: </p><br><pre><code class="hljs vhdl">speak(<span class="hljs-number"><span class="hljs-number">15</span></span>) speak(<span class="hljs-string"><span class="hljs-string">"Whatever"</span></span>) def speak( thing ) thing.say_every #  ,   thing  (Int32  <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>),      say_every #      Object,    ,   <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  Int32 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> thing.is_a?(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) #  Crystal  ,    thing  <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>,     . <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> thing.sub(/\Athe\s+/, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> thing.responds_to?(:to_s) #  Crystal  ,   thing   to_s,     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> thing.to_s <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  It is important to note that all values ‚Äã‚Äãare objects, including numbers and strings.  The price of objectivity is zero, because operations on objects are defined at the stage of static analysis in the compiler. </p><br><h2 id="proverka-na-pustoe-znachenie">  Check for empty value </h2><br><p>  In general, a special check in the code for an empty value is not required.  For example, in this example, an attempt to pass a null value will result in a compilation error, because my_string is of type (String or Nil), and Nil has no <em>upcase</em> method: </p><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rand</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> my_string = <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> puts my_string.upcase</code> </pre> <br><h2 id="model-parallelizma">  Concurrency model </h2><br><p>  Crystal supports green streams, channels, and the <em>SO_REUSEPORT</em> option - similar to Go.  Currently, we <a href="https://github.com/crystal-lang/crystal/wiki/Roadmap">are working</a> on high-quality support for multithreading at the operating system level, which will lead to efficient applications on several processor cores. </p><br><h2 id="biblioteki">  Libraries </h2><br><p>  Crystal actually has its own dependency manager - <a href="https://github.com/crystal-lang/shards">Shards</a> . </p><br><p>  The functionality is similar to ruby ‚Äã‚Äãbundler, perl carton etc.  At the same time dependences are described in the <em>shards.yml</em> project. </p><br><p>  BDD, a common interface for working with RDBMS and other amenities are included in the <a href="https://crystal-lang.org/api/0.22.0/">standard library</a> . </p><br><p>  I will not mention the various libraries for data analysis and so on, for this there is an <a href="http://awesome-crystal.com/">Awesome Crystal</a> list. </p><br><p>  From what is not included in the standard distribution, but useful for web applications: </p><br><h3 id="kemalhttpkemalcrcom">  <a href="http://kemalcr.com/">Kemal</a> </h3><br><pre> <code class="hljs pgsql">require "kemal" # Matches <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> "http://host:port/" <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> "/" <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> "Hello World!" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> # Creates a WebSocket <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>. # Matches "ws://host:port/socket" ws "/socket" <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |socket| socket.send "Hello from Kemal!" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Kemal.run</code> </pre> <br><h3 id="crystal-pg">  crystal-pg </h3><br><pre> <code class="hljs pgsql">PG_DB.query_one("select ARRAY[1, null, 3]", &amp;.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(Int32?)) # =&gt; [<span class="hljs-number"><span class="hljs-number">1</span></span>, nil, <span class="hljs-number"><span class="hljs-number">3</span></span>] PG_DB.query_one("select '{hello, world}'::text[]", &amp;.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(String)) # =&gt; ["hello", "world"]</code> </pre> <br><h3 id="remarkdown">  Remarkdown </h3><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"remarkdown"</span></span> Remarkdown.to_html(<span class="hljs-string"><span class="hljs-string">"Hello **world**"</span></span>)</code> </pre> <br><h2 id="zamechaniya">  Remarks </h2><br><ul><li><p>  I must say that I studied Crystal this weekend, having managed to release one project (due to the syntax similarity with Ruby).  And this article is a newbie point of view in the world of Crystal. </p><br></li><li><p>  Language is still in the process of implementation, so big projects are not worth doing on it yet.  Version <strong>1.0</strong> is planned at the end of the year, <em>but this is not accurate</em> . </p><br></li><li>  An example of a simple library: <a href="">https://github.com/akzhan/luhn.cr</a> . </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/328364/">https://habr.com/ru/post/328364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328354/index.html">Comparison of PVS-Studio C # and static analyzer built into Visual Studio based on the code of the CruiseControl.NET project</a></li>
<li><a href="../328356/index.html">As we did the third internship in iOS and Android development at Redmadrobot</a></li>
<li><a href="../328358/index.html">Fatty programs - we study the factor of memory part B</a></li>
<li><a href="../328360/index.html">Min-Long Chou: What I designed for Uncharted 4. Part 2</a></li>
<li><a href="../328362/index.html">Accelerate std :: shared_mutex 10 times</a></li>
<li><a href="../328366/index.html">Build 2017: text translation. Day 2</a></li>
<li><a href="../328368/index.html">Distributed data structures (part 2, how it's done)</a></li>
<li><a href="../328370/index.html">Should I buy ECC memory?</a></li>
<li><a href="../328372/index.html">Metrics in machine learning tasks</a></li>
<li><a href="../328374/index.html">Thread safe std :: map with lock-free map performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>