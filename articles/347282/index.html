<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to write a diploma using three open projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is no secret that in our project they use students to teach. More precisely, on the basis of the project, students master the practical aspects of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to write a diploma using three open projects</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ga/2d/8m/ga2d8ma5qni3cswhowvmzsqrrjc.png" align="right" width="400">  It is no secret that in our project they <s>use</s> students to teach.  More precisely, on the basis of the project, students master the practical aspects of system programming: they write diplomas, term papers, do research, and so on.  Here is one diploma, successfully defended last summer, and will be discussed in this article. <br><br>  The author is Aleksandra Butrova <a href="https://habrahabr.ru/users/aleksandrabutrova/" class="user_link">AleksandraButrova</a> , the topic ‚ÄúDevelopment of the graphics subsystem for embedded operating systems‚Äù.  When writing a diploma, three open projects were used: <a href="https://github.com/embox/embox">Embox</a> , <a href="https://github.com/vurtun/nuklear">Nuklear</a> and <a href="https://github.com/nothings/stb">stb</a> .  The latter was used only for downloading pictures, but Nuklear was, in fact, the cause of the celebration.  We can say that the work has been reduced to the integration of Nuklear and Embox.  The first provided an easy graphic library, and Embox was responsible for embedded systems. <br><a name="habracut"></a><br>  Prior to this work, graphic applications for Embox could be developed only on the Qt framework, which is certainly remarkable because it: <br><br><ul><li>  Cross Platform </li><li>  It contains a lot of useful things </li><li>  Open and well tuned </li></ul><br>  But at the same time, Qt is not always suitable for embedded systems, because: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Very big </li><li>  Resource requirements </li><li>  Written in C ++, not C </li></ul><br>  In addition, there are nuances with the license.  In short, we in the project had been thinking about porting something lightweight for a long time and were looking intently towards the already <a href="https://habrahabr.ru/post/319106/">mentioned</a> <a href="https://habrahabr.ru/users/dexperix/" class="user_link">Nuklear</a> project by Dmitry <a href="https://habrahabr.ru/users/dexperix/" class="user_link">Hrabrovy</a> of DeXPeriX.  We liked the use of pure C and a small amount of code (in fact, one header file).  Plus a great license: <br>  <b>This software is a non-licensed software license.</b> <br><br>  In general, Nuklear is perfect for integration with other projects. <br><br>  Of course, since this is a diploma, the task was not just to use the library that the scientist liked.  6 libraries were reviewed and two approaches to the construction of graphic primitives were identified: <a href="https://en.wikipedia.org/wiki/Retained_mode">retained</a> and <a href="https://en.wikipedia.org/wiki/Immediate_Mode_GUI">immediate</a> .  In addition to the libraries themselves, general models for the construction of graphic subsystems were also considered, starting, of course, with the legendary <a href="https://ru.wikipedia.org/wiki/X_Window_System">X11</a> .  But since the main focus of the work was on limited resources, the original <a href="https://ru.wikipedia.org/wiki/DirectFB">directFB</a> analogue present in Embox was recognized as the best. <br><br>  Returning to Nuklear, which, <s>by a strange coincidence, was nevertheless</s> chosen as a graphic library, it should be noted that it has several rendering options (sets of functions for drawing primitives) for different platforms, examples of use for X11, sdl and OpenGL are given.  In order to run it on another platform, you need to implement your own rendering.  For Embox, of course, there was no rendering.  The first practical task was to modify the existing example from the Nuklear repository so that it would somehow get together and run on Embox.  For this, the simplest example was chosen - canvas, which, in fact, demonstrates the output of graphic primitives. <br><br>  I will cite the main function code for comparison. <div class="spoiler">  <b class="spoiler_title">from the original example</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Platform */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GLFWwindow *win; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width = <span class="hljs-number"><span class="hljs-number">0</span></span>, height = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* GUI */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_font_atlas</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">atlas</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_context</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* GLFW */</span></span> glfwSetErrorCallback(error_callback); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!glfwInit()) { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span>, <span class="hljs-string"><span class="hljs-string">"[GFLW] failed to init!\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, <span class="hljs-number"><span class="hljs-number">3</span></span>); glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, <span class="hljs-number"><span class="hljs-number">3</span></span>); glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE); win = glfwCreateWindow(WINDOW_WIDTH, WINDOW_HEIGHT, <span class="hljs-string"><span class="hljs-string">"Demo"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); glfwMakeContextCurrent(win); glfwSetWindowUserPointer(win, &amp;ctx); glfwSetCharCallback(win, text_input); glfwSetScrollCallback(win, scroll_input); glfwGetWindowSize(win, &amp;width, &amp;height); <span class="hljs-comment"><span class="hljs-comment">/* OpenGL */</span></span> glViewport(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, WINDOW_WIDTH, WINDOW_HEIGHT); glewExperimental = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (glewInit() != GLEW_OK) { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, <span class="hljs-string"><span class="hljs-string">"Failed to setup GLEW\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* GUI */</span></span> {device_init(&amp;device); {<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *image; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w, h; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_font</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">font</span></span></span><span class="hljs-class">;</span></span> nk_font_atlas_init_default(&amp;atlas); nk_font_atlas_begin(&amp;atlas); font = nk_font_atlas_add_default(&amp;atlas, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); image = nk_font_atlas_bake(&amp;atlas, &amp;w, &amp;h, NK_FONT_ATLAS_RGBA32); device_upload_atlas(&amp;device, image, w, h); nk_font_atlas_end(&amp;atlas, nk_handle_id((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)device.font_tex), &amp;device.null); nk_init_default(&amp;ctx, &amp;font-&gt;handle); glEnable(GL_TEXTURE_2D); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!glfwWindowShouldClose(win)) { <span class="hljs-comment"><span class="hljs-comment">/* input */</span></span> pump_input(&amp;ctx, win); <span class="hljs-comment"><span class="hljs-comment">/* draw */</span></span> {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_canvas</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">canvas</span></span></span><span class="hljs-class">;</span></span> canvas_begin(&amp;ctx, &amp;canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, nk_rgb(<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>)); { nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">210</span></span>,<span class="hljs-number"><span class="hljs-number">210</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>, <span class="hljs-number"><span class="hljs-number">154</span></span>)); nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">188</span></span>, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>)); nk_draw_text(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-string"><span class="hljs-string">"Text to draw"</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, &amp;font-&gt;handle, nk_rgb(<span class="hljs-number"><span class="hljs-number">188</span></span>,<span class="hljs-number"><span class="hljs-number">174</span></span>,<span class="hljs-number"><span class="hljs-number">118</span></span>), nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>)); nk_fill_circle(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>), nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_triangle(canvas.painter, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_arc(canvas.painter, <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">180</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3.141592654f</span></span> * <span class="hljs-number"><span class="hljs-number">3.0f</span></span> / <span class="hljs-number"><span class="hljs-number">4.0f</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)); {<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> points[<span class="hljs-number"><span class="hljs-number">12</span></span>]; points[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">200</span></span>; points[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">250</span></span>; points[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">250</span></span>; points[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">350</span></span>; points[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">225</span></span>; points[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">350</span></span>; points[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">200</span></span>; points[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">300</span></span>; points[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">175</span></span>; points[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">350</span></span>; points[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">150</span></span>; points[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">350</span></span>; nk_fill_polygon(canvas.painter, points, <span class="hljs-number"><span class="hljs-number">6</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>));} nk_stroke_line(canvas.painter, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">2.0f</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">189</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">75</span></span>)); nk_stroke_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">370</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>)); nk_stroke_curve(canvas.painter, <span class="hljs-number"><span class="hljs-number">380</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">405</span></span>, <span class="hljs-number"><span class="hljs-number">270</span></span>, <span class="hljs-number"><span class="hljs-number">455</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">220</span></span>)); nk_stroke_circle(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">370</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>)); nk_stroke_triangle(canvas.painter, <span class="hljs-number"><span class="hljs-number">370</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">470</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">420</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">143</span></span>)); } canvas_end(&amp;ctx, &amp;canvas);} <span class="hljs-comment"><span class="hljs-comment">/* Draw */</span></span> glfwGetWindowSize(win, &amp;width, &amp;height); glViewport(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height); glClear(GL_COLOR_BUFFER_BIT); glClearColor(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); device_draw(&amp;device, &amp;ctx, width, height, NK_ANTI_ALIASING_ON); glfwSwapBuffers(win); }}} nk_font_atlas_clear(&amp;atlas); nk_free(&amp;ctx); device_shutdown(&amp;device); glfwTerminate(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">and modified example</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> screensize = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *fbp = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fb_info</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fb_info</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_color</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rgb_white</span></span></span><span class="hljs-class"> = {</span></span> .a = <span class="hljs-number"><span class="hljs-number">0xff</span></span>, .r = <span class="hljs-number"><span class="hljs-number">0xff</span></span>, .g = <span class="hljs-number"><span class="hljs-number">0xff</span></span>, .b = <span class="hljs-number"><span class="hljs-number">0xff</span></span>}; fb_info = fb_lookup(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%dx%d, %dbpp\n"</span></span>, fb_info-&gt;var.xres, fb_info-&gt;var.yres, fb_info-&gt;var.bits_per_pixel); <span class="hljs-comment"><span class="hljs-comment">/* Figure out the size of the screen in bytes */</span></span> screensize = fb_info-&gt;var.xres * fb_info-&gt;var.yres * fb_info-&gt;var.bits_per_pixel / <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Map the device to memory */</span></span> fbp = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *) mmap_device_memory((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) fb_info-&gt;screen_base, screensize, PROT_READ | PROT_WRITE, MAP_SHARED, (<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>) ((<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>) fb_info-&gt;screen_base)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) fbp == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { perror(<span class="hljs-string"><span class="hljs-string">"Error: failed to map framebuffer device to memory"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"The framebuffer device was mapped to memory successfully.\n"</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fb_fillrect</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">;</span></span> rect.dx = <span class="hljs-number"><span class="hljs-number">0</span></span>; rect.dy = <span class="hljs-number"><span class="hljs-number">0</span></span>; rect.width = fb_info-&gt;var.xres; rect.height = fb_info-&gt;var.yres; rect.rop = ROP_COPY; rect.color = rgba_to_device_color(fb_info, &amp;rgb_white); fb_fillrect(fb_info, &amp;rect); <span class="hljs-comment"><span class="hljs-comment">/* GUI */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_context</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_canvas</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">canvas</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> width = <span class="hljs-number"><span class="hljs-number">0</span></span>, height = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_user_font</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">font</span></span></span><span class="hljs-class">;</span></span> font.userdata.ptr = (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) font_vga_8x8.data; font.height = font_vga_8x8.height; font.width = your_text_width_calculation; nk_init_default(&amp;ctx, &amp;font); width = fb_info-&gt;var.xres; height = fb_info-&gt;var.yres; <span class="hljs-comment"><span class="hljs-comment">/* Draw */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* what to draw */</span></span> canvas_begin(&amp;ctx, &amp;canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, nk_rgb(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)); { canvas.painter-&gt;use_clipping = NK_CLIPPING_OFF; nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>, <span class="hljs-number"><span class="hljs-number">140</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">247</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>, <span class="hljs-number"><span class="hljs-number">154</span></span>)); nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">135</span></span>, <span class="hljs-number"><span class="hljs-number">135</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">188</span></span>, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>)); nk_draw_text(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-string"><span class="hljs-string">"Text to draw"</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, &amp;font, nk_rgb(<span class="hljs-number"><span class="hljs-number">188</span></span>, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>), nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>)); nk_fill_circle(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>), nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_triangle(canvas.painter, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">195</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_fill_arc(canvas.painter, <span class="hljs-number"><span class="hljs-number">195</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3.141592654f</span></span> * <span class="hljs-number"><span class="hljs-number">3.0f</span></span> / <span class="hljs-number"><span class="hljs-number">4.0f</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); nk_stroke_line(canvas.painter, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">2.0f</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">189</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>)); nk_stroke_rect(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">235</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>)); nk_stroke_curve(canvas.painter, <span class="hljs-number"><span class="hljs-number">235</span></span>, <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">252</span></span>, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">288</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">305</span></span>, <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>)); nk_stroke_triangle(canvas.painter, <span class="hljs-number"><span class="hljs-number">235</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">305</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">270</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">143</span></span>)); nk_stroke_circle(canvas.painter, nk_rect(<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>, nk_rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>)); { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_image</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">im</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w, h, format; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_rect</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">r</span></span></span><span class="hljs-class">;</span></span> im.handle.ptr = stbi_load(<span class="hljs-string"><span class="hljs-string">"SPBGU_logo.png"</span></span>, &amp;w, &amp;h, &amp;format, <span class="hljs-number"><span class="hljs-number">0</span></span>); r = nk_rect(<span class="hljs-number"><span class="hljs-number">320</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, w, h); im.w = w; im.h = h; im.region[<span class="hljs-number"><span class="hljs-number">0</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>; im.region[<span class="hljs-number"><span class="hljs-number">1</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>; im.region[<span class="hljs-number"><span class="hljs-number">2</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) rw; im.region[<span class="hljs-number"><span class="hljs-number">3</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) rh; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"load %p, %d, %d, %d\n"</span></span>, im.handle.ptr, w, h, format); nk_draw_image(canvas.painter, r, &amp;im, nk_rgb(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); stbi_image_free(im.handle.ptr); } } canvas_end(&amp;ctx, &amp;canvas); <span class="hljs-comment"><span class="hljs-comment">/* Draw each element */</span></span> draw(fb_info, &amp;ctx, width, height); } nk_free(&amp;ctx); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\nEnd of program.\nIf you see it then something goes wrong.\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br>  The code for working with the library almost did not change.  Changes concerned loading of the fonts, various functionality of openGL and other specific platform parts. <br>  The most important platform-dependent part is, of course, drawing: the device_draw and draw functions, respectively.  Actually, this is the challenge of the very rendering.  Since Nuklear is related to imediate by the type of drawing, there is a loop in which the scene is constantly drawn by calling this function.  The drawing code itself is as follows: <br><br><div class="spoiler">  <b class="spoiler_title">for openGL</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">device_draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct device *dev, struct nk_context *ctx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">enum</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nk_anti_aliasing AA)</span></span></span><span class="hljs-function"> </span></span>{ GLfloat ortho[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>}, {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>,<span class="hljs-number"><span class="hljs-number">-2.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>}, {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>,<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>}, {<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>,<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>}, }; ortho[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] /= (GLfloat)width; ortho[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] /= (GLfloat)height; <span class="hljs-comment"><span class="hljs-comment">/* setup global state */</span></span> glEnable(GL_BLEND); glBlendEquation(GL_FUNC_ADD); glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA); glDisable(GL_CULL_FACE); glDisable(GL_DEPTH_TEST); glEnable(GL_SCISSOR_TEST); glActiveTexture(GL_TEXTURE0); <span class="hljs-comment"><span class="hljs-comment">/* setup program */</span></span> glUseProgram(dev-&gt;prog); glUniform1i(dev-&gt;uniform_tex, <span class="hljs-number"><span class="hljs-number">0</span></span>); glUniformMatrix4fv(dev-&gt;uniform_proj, <span class="hljs-number"><span class="hljs-number">1</span></span>, GL_FALSE, &amp;ortho[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]); { <span class="hljs-comment"><span class="hljs-comment">/* convert from command queue into draw list and draw to screen */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_draw_command</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *vertices, *elements; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nk_draw_index *offset = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* allocate vertex and element buffer */</span></span> glBindVertexArray(dev-&gt;vao); glBindBuffer(GL_ARRAY_BUFFER, dev-&gt;vbo); glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, dev-&gt;ebo); glBufferData(GL_ARRAY_BUFFER, MAX_VERTEX_MEMORY, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, GL_STREAM_DRAW); glBufferData(GL_ELEMENT_ARRAY_BUFFER, MAX_ELEMENT_MEMORY, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, GL_STREAM_DRAW); <span class="hljs-comment"><span class="hljs-comment">/* load draw vertices &amp; elements directly into vertex + element buffer */</span></span> vertices = glMapBuffer(GL_ARRAY_BUFFER, GL_WRITE_ONLY); elements = glMapBuffer(GL_ELEMENT_ARRAY_BUFFER, GL_WRITE_ONLY); { <span class="hljs-comment"><span class="hljs-comment">/* fill convert configuration */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_convert_config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_draw_vertex_layout_element</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vertex_layout</span></span></span><span class="hljs-class">[] = {</span></span> {NK_VERTEX_POSITION, NK_FORMAT_FLOAT, NK_OFFSETOF(struct nk_glfw_vertex, position)}, {NK_VERTEX_TEXCOORD, NK_FORMAT_FLOAT, NK_OFFSETOF(struct nk_glfw_vertex, uv)}, {NK_VERTEX_COLOR, NK_FORMAT_R8G8B8A8, NK_OFFSETOF(struct nk_glfw_vertex, col)}, {NK_VERTEX_LAYOUT_END} }; NK_MEMSET(&amp;config, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(config)); config.vertex_layout = vertex_layout; config.vertex_size = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct nk_glfw_vertex); config.vertex_alignment = NK_ALIGNOF(struct nk_glfw_vertex); config.null = dev-&gt;null; config.circle_segment_count = <span class="hljs-number"><span class="hljs-number">22</span></span>; config.curve_segment_count = <span class="hljs-number"><span class="hljs-number">22</span></span>; config.arc_segment_count = <span class="hljs-number"><span class="hljs-number">22</span></span>; config.global_alpha = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; config.shape_AA = AA; config.line_AA = AA; <span class="hljs-comment"><span class="hljs-comment">/* setup buffers to load vertices and elements */</span></span> {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_buffer</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vbuf</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ebuf</span></span></span><span class="hljs-class">;</span></span> nk_buffer_init_fixed(&amp;vbuf, vertices, MAX_VERTEX_MEMORY); nk_buffer_init_fixed(&amp;ebuf, elements, MAX_ELEMENT_MEMORY); nk_convert(ctx, &amp;dev-&gt;cmds, &amp;vbuf, &amp;ebuf, &amp;config);} } glUnmapBuffer(GL_ARRAY_BUFFER); glUnmapBuffer(GL_ELEMENT_ARRAY_BUFFER); <span class="hljs-comment"><span class="hljs-comment">/* iterate over and execute each draw command */</span></span> nk_draw_foreach(cmd, ctx, &amp;dev-&gt;cmds) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cmd-&gt;elem_count) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; glBindTexture(GL_TEXTURE_2D, (GLuint)cmd-&gt;texture.id); glScissor( (GLint)(cmd-&gt;clip_rect.x), (GLint)((height - (GLint)(cmd-&gt;clip_rect.y + cmd-&gt;clip_rect.h))), (GLint)(cmd-&gt;clip_rect.w), (GLint)(cmd-&gt;clip_rect.h)); glDrawElements(GL_TRIANGLES, (GLsizei)cmd-&gt;elem_count, GL_UNSIGNED_SHORT, offset); offset += cmd-&gt;elem_count; } nk_clear(ctx); } <span class="hljs-comment"><span class="hljs-comment">/* default OpenGL state */</span></span> glUseProgram(<span class="hljs-number"><span class="hljs-number">0</span></span>); glBindBuffer(GL_ARRAY_BUFFER, <span class="hljs-number"><span class="hljs-number">0</span></span>); glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, <span class="hljs-number"><span class="hljs-number">0</span></span>); glBindVertexArray(<span class="hljs-number"><span class="hljs-number">0</span></span>); glDisable(GL_BLEND); glDisable(GL_SCISSOR_TEST); }</code> </pre><br></div></div><br>  As you can see, there is another cycle here. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* iterate over and execute each draw command */</span></span> nk_draw_foreach(cmd, ctx, &amp;dev-&gt;cmds)</code> </pre> <br>  As you might guess, this cycle goes through all the commands to draw the scene, and draws them with the platform tools. <br><br><div class="spoiler">  <b class="spoiler_title">Therefore, a similar draw function code for Embox also contains this loop.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct fb_info *fb, struct nk_context *ctx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height)</span></span></span><span class="hljs-function"> </span></span>{ assert(fb); assert(ctx); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* iterate over and execute each draw command */</span></span> nk_foreach(cmd, ctx) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (cmd-&gt;type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_NOP: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_LINE: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_line</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_line</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_stroke_line( fb, c-&gt;begin.x, c-&gt;begin.y, c-&gt;end.x, c-&gt;end.y, &amp;c-&gt;color, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_CURVE: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_curve</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_curve</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y[<span class="hljs-number"><span class="hljs-number">4</span></span>]; x[<span class="hljs-number"><span class="hljs-number">0</span></span>] = c-&gt;begin.x; x[<span class="hljs-number"><span class="hljs-number">1</span></span>] = c-&gt;ctrl[<span class="hljs-number"><span class="hljs-number">0</span></span>].x; x[<span class="hljs-number"><span class="hljs-number">2</span></span>] = c-&gt;ctrl[<span class="hljs-number"><span class="hljs-number">1</span></span>].x; x[<span class="hljs-number"><span class="hljs-number">3</span></span>] = c-&gt;end.x; y[<span class="hljs-number"><span class="hljs-number">0</span></span>] = c-&gt;begin.y; y[<span class="hljs-number"><span class="hljs-number">1</span></span>] = c-&gt;ctrl[<span class="hljs-number"><span class="hljs-number">0</span></span>].y; y[<span class="hljs-number"><span class="hljs-number">2</span></span>] = c-&gt;ctrl[<span class="hljs-number"><span class="hljs-number">1</span></span>].y; y[<span class="hljs-number"><span class="hljs-number">3</span></span>] = c-&gt;end.y; embox_stroke_curve( fb, x, y, &amp;c-&gt;color, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_RECT: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_rect</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_rect</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_stroke_rect( fb, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h, &amp;c-&gt;color, (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;rounding, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_RECT_FILLED: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_rect_filled</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_rect_filled</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_fill_rect( fb, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h, &amp;c-&gt;color); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_CIRCLE: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_circle</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_circle</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_stroke_circle( fb, (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;x + (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;w / <span class="hljs-number"><span class="hljs-number">2</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;y + (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;h / <span class="hljs-number"><span class="hljs-number">2</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) c-&gt;w / <span class="hljs-number"><span class="hljs-number">2</span></span>, &amp;c-&gt;color, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_CIRCLE_FILLED: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_circle_filled</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_circle_filled</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_fill_circle( fb, c-&gt;x + c-&gt;w / <span class="hljs-number"><span class="hljs-number">2</span></span>, c-&gt;y + c-&gt;h / <span class="hljs-number"><span class="hljs-number">2</span></span>, c-&gt;w / <span class="hljs-number"><span class="hljs-number">2</span></span>, &amp;c-&gt;color); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_ARC: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_arc</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_arc</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_stroke_arc( fb, c-&gt;cx, c-&gt;cy, c-&gt;r, c-&gt;a[<span class="hljs-number"><span class="hljs-number">0</span></span>], c-&gt;a[<span class="hljs-number"><span class="hljs-number">1</span></span>], &amp;c-&gt;color, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_ARC_FILLED: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_arc_filled</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_arc_filled</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_fill_arc( fb, c-&gt;cx, c-&gt;cy, c-&gt;r, c-&gt;a[<span class="hljs-number"><span class="hljs-number">0</span></span>], c-&gt;a[<span class="hljs-number"><span class="hljs-number">1</span></span>], &amp;c-&gt;color); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_TRIANGLE: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_triangle</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_triangle</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_stroke_triangle( fb, c-&gt;ax, c-&gt;ay, c-&gt;bx, c-&gt;by, c-&gt;cx, c-&gt;cy, &amp;c-&gt;color, c-&gt;line_thickness); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_TRIANGLE_FILLED: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_triangle_filled</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_triangle_filled</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_fill_triangle( fb, c-&gt;ax, c-&gt;ay, c-&gt;bx, c-&gt;by, c-&gt;cx, c-&gt;cy, &amp;c-&gt;color); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_TEXT: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_text</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_text</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> embox_add_text( fb, ctx, c-&gt;x, c-&gt;y, &amp;c-&gt;foreground, &amp;c-&gt;background, c-&gt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, c-&gt;length); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NK_COMMAND_IMAGE: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_image</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nk_command_image</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cmd</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> color = rgba_to_device_color( fb, &amp;c-&gt;col); embox_add_image( fb, c-&gt;img, c-&gt;x, c-&gt;y, c-&gt;w, c-&gt;h, color); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* unrealized primitives */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* case NK_COMMAND_SCISSOR: { const struct nk_command_scissor *s = (const struct nk_command_scissor*)cmd; nk_draw_list_add_clip(&amp;ctx-&gt;draw_list, nk_rect(s-&gt;x, s-&gt;y, s-&gt;w, s-&gt;h)); } break; case NK_COMMAND_POLYGON: { int i; const struct nk_command_polygon*p = (const struct nk_command_polygon*)cmd; for (i = 0; i &lt; p-&gt;point_count; ++i) { struct nk_vec2 pnt = nk_vec2((float)p-&gt;points[i].x, (float)p-&gt;points[i].y); nk_draw_list_path_line_to(&amp;ctx-&gt;draw_list, pnt); } nk_draw_list_path_stroke(&amp;ctx-&gt;draw_list, p-&gt;color, NK_STROKE_CLOSED, p-&gt;line_thickness); } break; case NK_COMMAND_POLYGON_FILLED: { int i; const struct nk_command_polygon_filled *p = (const struct nk_command_polygon_filled*)cmd; for (i = 0; i &lt; p-&gt;point_count; ++i) { struct nk_vec2 pnt = nk_vec2((float)p-&gt;points[i].x, (float)p-&gt;points[i].y); nk_draw_list_path_line_to(&amp;ctx-&gt;draw_list, pnt); } nk_draw_list_path_fill(&amp;ctx-&gt;draw_list, p-&gt;color); } break; case NK_COMMAND_POLYLINE: { int i; const struct nk_command_polyline *p = (const struct nk_command_polyline*)cmd; for (i = 0; i &lt; p-&gt;point_count; ++i) { struct nk_vec2 pnt = nk_vec2((float)p-&gt;points[i].x, (float)p-&gt;points[i].y); nk_draw_list_path_line_to(&amp;ctx-&gt;draw_list, pnt); } nk_draw_list_path_stroke(&amp;ctx-&gt;draw_list, p-&gt;color, NK_STROKE_OPEN, p-&gt;line_thickness); } break; case NK_COMMAND_RECT_MULTI_COLOR: { const struct nk_command_rect_multi_color *r = (const struct nk_command_rect_multi_color*)cmd; nk_draw_list_fill_rect_multi_color(&amp;ctx-&gt;draw_list, nk_rect(r-&gt;x, r-&gt;y, r-&gt;w, r-&gt;h), r-&gt;left, r-&gt;top, r-&gt;right, r-&gt;bottom); } break; */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } nk_clear(ctx); }</code> </pre><br></div></div><br>  The body of the loop looks much different, because you need to implement your own primitives, which are already implemented in OpenGL. <br><br>  After the implementation of these primitives, the scene began to draw correctly. <br><br><img src="https://habrastorage.org/webt/xl/96/zv/xl96zvidtgl3qtjehrkjijonzuu.png"><br>  The coat of arms of St. Petersburg State University, of course, is added for a diploma and is not present in the original example from nuklear :) <br><br>  Of course, not everything was so simple.  The first problem that prevented compiling the header file in its original form was that nuklear is oriented to the c89 standard, where there is no inline keyword, but there are no warnings (warnings) on static functions that are not used.  We use c99 by default, or rather the gnu-extension, and we had to make <a href="https://github.com/vurtun/nuklear/pull/344">PR</a> into the original nuklear to support c99. <br><br>  Another problem, not directly related to the diploma, was that <a href="https://ru.wikipedia.org/wiki/RGB">the pixel format</a> is different, and the image format in memory may not coincide with the hardware format.  Before that, we used a simple conversion from a regular RGB with 8 bits per channel to one or another hardware format in the driver of a specific graphic device, we had to add a layer for full conversion for different formats. <br><br>  A total of 3 platforms were tested: <br><br><ul><li>  QEMU / x86 (boch graphics) </li><li>  QEMU / ARM (graphics pl110) </li><li>  STM32F7Discovery (integrated graphics) </li></ul><br>  With the last platform, the maximum amount of trouble arose: the problem with alignment of the structures, and the lack of memory to load the image, and the portrait orientation of the screen (i.e., the image width is less than the height).  But as a result, Sasha coped with all these tasks and wanted to launch a ‚Äúreal‚Äù example.  They also became a standard example from nuklear skinning. <br><br>  Appearance when running on QEMU / ARM <br><br><img src="https://habrastorage.org/webt/xg/kg/rv/xgkgrvbpbd806q0fiqmxs2smjqi.png"><br><br>  Well, photos with the STM32F7Discovery card <br><br><img src="https://habrastorage.org/webt/t-/wg/yz/t-wgyz5dtewtdksnsiovhwh3uhg.jpeg"><br>  canvas <br><br><img src="https://habrastorage.org/webt/qt/ce/_y/qtce_yw_vbddspcdnstzk3wraze.jpeg"><br>  skinning <br><br>  I do not want to retell the diploma, the full text can be downloaded <a href="http://se.math.spbu.ru/SE/diploma/2017/bmo/444-Butrova-report.pdf">here</a> .  In conclusion, I would like to note that the author, while writing her diploma, participated in several living projects, gained practical experience in real work with distributed modern projects.  And it is not so important that she knows the authors of one of these projects personally, it‚Äôs still easier to enter the project.  After all, as I said, this project is not the only one that was used in the writing of the diploma.  And in my opinion, theses on the basis of open existing projects should be as much as possible.  After all, this is the most effective way to become a full-fledged specialist. </div><p>Source: <a href="https://habr.com/ru/post/347282/">https://habr.com/ru/post/347282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347272/index.html">I hate constants in ruby</a></li>
<li><a href="../347274/index.html">Own DBMS for 3 weeks. You just need a little time every day ...</a></li>
<li><a href="../347276/index.html">Smart search: how artificial intelligence hh.ru selects jobs to resume</a></li>
<li><a href="../347278/index.html">Learning online programming - is everything as simple as it seems?</a></li>
<li><a href="../347280/index.html">[DotNetBook] Stack stream. Its editing and stream cloning</a></li>
<li><a href="../347284/index.html">About errors and exceptions</a></li>
<li><a href="../347286/index.html">Making games in Python 3 and Pygame: Part 5</a></li>
<li><a href="../347288/index.html">Universal data converter on the .Net Framework</a></li>
<li><a href="../347294/index.html">Type system in mathematics</a></li>
<li><a href="../347296/index.html">Backup with Software-defined Storage and Erasure Coding - is the game worth the candle?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>