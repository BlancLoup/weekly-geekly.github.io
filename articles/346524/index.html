<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Meltdown and Specter for the cloud: our risk assessment and how we patched</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The new year began in a very original way. Instead of family gatherings, the maintenance service carefully monitored the situation with the vulnerabil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Meltdown and Specter for the cloud: our risk assessment and how we patched</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ed/_s/d1/ed_sd1vrcgo-omgmug8mhuytlak.png"><br><br>  The new year began in a very original way.  Instead of family gatherings, the maintenance service carefully monitored the situation with the vulnerabilities of the Meltdown and Specter processors.  In theory, they meant a threat to customer data and keys.  In short, the implementation of vulnerabilities looks like this: <br><br>  - Do you have Aksu for sale? <br>  - No. <br>  - And KPVT? <br>  - No. <br>  - And the grenades? <br>  - Ehh, that's what is not, that is not. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That is, you can build a query system that indirectly makes it clear what is stored in the RAM of a physical host by measuring the response time of the processor.  In the first half of January, manufacturers of OS and hypervisors rolled out patches that do not allow to use this feature, but at the same time cut some of the performance of the systems. <br><br>  We were very worried about the DBMS, because it was on them that the peak of syscalls was expected, and the consumption of cloud resources could grow by more than 10%. <br><br>  Looking ahead a little bit - with MS SQL patches in some tests it works for some reason faster. <br><a name="habracut"></a><br><h2>  Performance tests </h2><br>  Since we don‚Äôt roll anything to the <a href="http://ts-cloud.ru/%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3DMeltdown_Spectre">Technoserv Cloud</a> , we prepared for these patches fully armed - we made two test environments for which we installed ESXi and WinServer 2012 - the old ones and, as soon as the updated ones were released, they were updated accordingly. <br><br>  The test results turned out strange.  See, here is the testing methodology: <br><br><div class="spoiler">  <b class="spoiler_title">START CONFIGS AND CONDITIONS:</b> <div class="spoiler_text">  <b>Updated system</b> <br>  Server: <br>  Dell PowerEdge R630 <br>  2 x Intel Xeon E5-2690 v4 2.6 GHz <br>  320 GB RAM <br>  UEFI v2.7.0 <br><br>  Hypervisor: VMware ESXi 6.0 Build 7504637 <br><br>  Virtual machine: <br>  VM version 11 <br>  8 vCPU (1 socket) <br>  24 GB RAM <br>  Disk 0 (System) Thick provision Eager Zeroed - PVSCSI Controller 0 on Dell SC9000 SSD + HDD Profile <br>  Disk 1 (DB Files) Thick provision Eager Zeroed - PVSCSI Controller 1 on Dell SC9000 SSD Profile <br>  Disk 2 (Transaction Log Files) Thick provision Eager - PVSCSI Controller 2 on Dell SC9000 SSD Profile <br>  NIC: VMXNet3 <br>  OS: Microsoft Windows Server 2012 R2 201-01-01 Monthly Rollup (KB4056895) <br>  DB: Microsoft SQL Server 2016 Enterprise Editions with SP1 <br><br>  Tests: <br>  7-Zip v16.04 64-Bit (4 CPU Threads / 192 MB Dictionary) <br>  HammerDB v2.23 (32 Warehouses, 8 vUsers, Rampup time 2 min, Test Duration 10 min) <br><br>  <b>Non-updated system</b> <br>  Server: <br>  Dell PowerEdge R630 <br>  2 x Intel Xeon E5-2690 v4 2.6 GHz <br>  320 GB RAM <br>  UEFI v2.6.0 <br><br>  Hypervisor: VMware ESXi 6.0 Build 5572656 <br><br>  Virtual machine: <br>  VM version 11 <br>  8 vCPU (1 socket) <br>  24 GB RAM <br>  Disk 0 (System) Thick provision Eager Zeroed - PVSCSI Controller 0 on Dell SC9000 SSD + HDD Profile <br>  Disk 1 (DB Files) Thick provision Eager Zeroed - PVSCSI Controller 1 on Dell SC9000 SSD Profile <br>  Disk 2 (Transaction Log Files) Thick provision Eager - PVSCSI Controller 2 on Dell SC9000 SSD Profile <br>  NIC: VMXNet3 <br>  OS: Microsoft Windows Server 2012 R2 2017-12 Monthly Rollup (KB4054519) <br>  DB: Microsoft SQL Server 2016 Enterprise Editions with SP1 <br><br>  Tests: <br>  7-Zip v16.04 64-Bit (4 CPU Threads / 192 MB Dictionary) <br>  HammerDB v2.23 (32 Warehouses, 8 vUsers, Rampup time 2 min, Test Duration 10 min) <br></div></div><br>  Here are the results: <br><br>  patched <br><img src="https://habrastorage.org/webt/ba/8s/kp/ba8skprfknpzeib2jlfstc4yboe.png"><br><br>  unpatched <br><img src="https://habrastorage.org/webt/pt/am/wk/ptamwkizmyd62flm90j8jfnd7jq.png"><br><br>  patched <br><img src="https://habrastorage.org/webt/mj/q3/c-/mjq3c-rsjmfkn1movug2s7ubphi.png"><br><br>  unpatched <br><img src="https://habrastorage.org/webt/sr/ow/1f/srow1fjph7lxjznmy5xcmfcohi0.png"><br><br>  patched <br><img src="https://habrastorage.org/webt/m5/kj/w7/m5kjw7spq_jy6z-qbyccbyr4t0i.png"><br><br>  unpatched <br><img src="https://habrastorage.org/webt/wc/wq/2v/wcwq2vupf1x-fi7dmok-cnkjd2i.png"><br><br>  In a heavier test, the updated system shows slightly lower performance: <br><br>  HammerDB v2.23 (Warehouses: 128; vUsers: 24; Total Transactions per User: 1000000; Rampup time: 2 min; Test Duration: 10 min; User Delay: 500ms; Repeat Delay: 500 ms) <br><br>  unpatched <br><img src="https://habrastorage.org/webt/rn/_q/rg/rn_qrgctmkbynysctzdf1lbxt4a.png"><br><br>  unpatched <br><img src="https://habrastorage.org/webt/px/ir/n8/pxirn8xvas2hknso7rrnbysfhps.png"><br><br>  patched <br><img src="https://habrastorage.org/webt/ed/_s/d1/ed_sd1vrcgo-omgmug8mhuytlak.png"><br><br>  patched <br><img src="https://habrastorage.org/webt/3q/eo/r5/3qeor5fkpzhep5hqtkoaxpuehh4.png"><br><br>  SQL - in some tests, the results of the patched system are higher (faster) than in the unpatched system.  It is very strange.  I cannot explain this phenomenon - perhaps the fact is that with a cumulative update something else has come that optimizes the work.  Yes, we gave a synthetic load, but still quite similar to the one that is in production, so it is hardly the case in the research method itself. <br><br>  For more complex tests, the performance drawdown is noticeable, but it did not exceed 10%. <br><br><h2>  Threat assessment </h2><br>  On the patched hypervisor, it doesn‚Äôt matter what guest operating system (patched or not) the cloud client is using.  That is, after the updates (and they have already been done, it took a total of 4 days for the entire infrastructure - so that without downtime, carefully migrating the VM back and forth) - the cloud is protected from Specter and Metldown. <br><br>  We didn‚Äôt find any signs of exploits that were in effect until the protection was established. <br><br>  A detailed vulnerability assessment suggests that there is almost no reason to use it in large clouds - it is just very hard to make a targeted attack.  Yes, an attacker could deploy his process, polling the memory of the kernel or someone else's process, but at the same time only on the same physical host where his virtual machine is located and someone else's.  That is, it is necessary: <br><br><ol><li>  To know that the goal is in this cloud. </li><li>  Drag malicious process that is not detected by stream protection. </li><li>  Deploy it on the same physical host as the target. </li></ol><br>  The latter is extremely unlikely if you do not buy at least half of the resources of the public cloud.  VMWare DRS, though fulfills, but moves a small part of the VM. <br><br>  Infrastructure services operate in a separate resource cluster, i.e.  we have a physical separation of hosts, where client virtual machines are spinning, and where infrastructure virtual machines are. <br><br>  Those who are in private clouds were not worried about anything at all.  They have a shared storage system with other systems (and nothing can read from a disk vulnerability) and their own set of hosts. <br><br><img src="https://habrastorage.org/webt/bf/lt/hn/bflthn7ycbe_v0tezend5v4-288.png"><br><br>  When you need to scale - add clean hosts. <br><br>  Bottom line - we are now closed from the main threat and we recommend customers patch their OS.  If only because keeping the OS up to date is a good form.  Vulnerability after detailed consideration seems blatant, but not as dangerous and troubling as it seemed in the first days. <br><br><blockquote>  <i>This is the material of the head of the cloud operation service of <a href="http://ts-cloud.ru/%3Futm_source%3Dhabr%26utm_medium%3Dpost%26utm_campaign%3DMeltdown_Spectre">Technoserv Cloud</a> Dmitry Maximov</i> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/346524/">https://habr.com/ru/post/346524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346508/index.html">Perhaps the most unusual puzzle on Google Play</a></li>
<li><a href="../346512/index.html">Terabit death. Potential cyber attacks on virtual servers. US Department of Defense under threat</a></li>
<li><a href="../346514/index.html">Nigerian stories of the Russian developer</a></li>
<li><a href="../346518/index.html">How much slower will your system after patches for Specter-Meltdown?</a></li>
<li><a href="../346520/index.html">Python, PHP, Golang, and DevOps knowledge tests: AvitoQuiz quiz analysis on Highload</a></li>
<li><a href="../346526/index.html">One is not a warrior in the field: advantages from working in a company on a remote</a></li>
<li><a href="../346530/index.html">Linux and newspaper layout (not for professionals)</a></li>
<li><a href="../346532/index.html">Basics of lossy audio coding. Testing Opus 1.3 Beta</a></li>
<li><a href="../346534/index.html">10 years have passed, and no one has figured out how to use the blockchain</a></li>
<li><a href="../346536/index.html">Mobile devices from the inside. The image structure of partitions containing the file system. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>