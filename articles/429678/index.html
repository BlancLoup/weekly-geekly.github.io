<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we translated 10 million lines of C ++ code to the C ++ 14 standard (and later to C ++ 17)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago (in the fall of 2016), when developing the next version of the 1C: Enterprise technology platform within the development team, the quest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we translated 10 million lines of C ++ code to the C ++ 14 standard (and later to C ++ 17)</h1><div class="post__text post__text-html js-mediator-article">  Some time ago (in the fall of 2016), when developing the next version of the 1C: Enterprise technology platform within the development team, the question arose of supporting the new <a href="https://ru.wikipedia.org/wiki/C%252B%252B14">C ++ 14</a> standard in our code.  The transition to the new standard, as we expected, would allow us to write many things more elegantly, easier and more reliably, simplified support and maintenance of the code.  And the translation seems to be nothing extraordinary, if not for the scale of the code base and the specific features of our code. <br><br>  For those who do not know, 1C: Enterprise is an environment for the rapid development of cross-platform business applications and runtime for their execution in different operating systems and DBMSs.  In general terms, the product includes: <br><br><ul><li>  <a href="http://v8.1c.ru/overview/Term_000000885.htm">Cluster of application servers</a> running on Windows and Linux </li><li>  <a href="http://v8.1c.ru/overview/Term_000000124.htm">The client</a> working with the server via http (s) or using its own binary protocol works on Windows, Linux, macOS </li><li>  <a href="https://habr.com/company/1c/blog/315414/">Web client</a> running in Chrome, Internet Explorer, Microsoft Edge, Firefox, Safari (written in JavaScript) browsers </li><li>  Development Environment ( <a href="http://v8.1c.ru/overview/Term_000000008.htm">Configurator</a> ), runs on Windows, Linux, macOS </li><li>  Application Server <a href="http://v8.1c.ru/overview/Term_000000813.htm">Administration Tools</a> , run on Windows, Linux, macOS </li><li>  <a href="https://wonderland.v8.1c.ru/blog/mobilnyy-klient/">Mobile client</a> connecting to the server via http (s), works on mobile devices running Android, iOS, Windows </li><li>  <a href="https://habr.com/company/1c/blog/283198/">Mobile platform</a> - a framework for creating offline mobile applications with the ability to synchronize, working on Android, iOS, Windows </li><li>  Development environment <a href="http://v8.1c.ru/overview/IDE/">1C: Enterprise Development Tools</a> , written in Java </li><li>  <a href="https://habr.com/company/1c/blog/422903/">Interaction System</a> Server </li></ul><br>  We try to maximally write one code for different operating systems ‚Äî the server's code base is 99% common, and the client approximately 95%.  The 1C: Enterprise technology platform is primarily written in C ++ and the following are approximate characteristics of the code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  10 million lines of C ++ code </li><li>  14 thousand files </li><li>  60 thousand classes </li><li>  half a million methods. </li></ul><br>  And all this economy should be transferred to C ++ 14.  Today we will tell you about how we did it and what we encountered in the process. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c44/6e2/0da/c446e20da16d596833a49dafd914f189.jpg" alt="image"><br><a name="habracut"></a><br><h3>  Disclaimer </h3><br>  Everything written below about slow / fast work, (not) high memory consumption by implementations of standard classes in various libraries means one thing: this is true FOR US.  Quite possibly, standard implementations are best suited for your tasks.  We started from our tasks: we took typical data for our customers, drove typical scenarios on them, looked at the speed, the amount of memory consumed, etc., and analyzed whether we and our customers are satisfied with such results or not.  And acted depending on. <br><br><h3>  What we had </h3><br>  Initially, we wrote the code for the 1C: Enterprise 8 platform in Microsoft Visual Studio.  The project began in the early 2000s and we had a version only for Windows.  Naturally, since then the code has been actively developed, many mechanisms have been completely rewritten.  But the code was written according to the 1998 standard, and, for example, our right-angle brackets were separated by spaces in order for the compilation to succeed, like this: <br><pre><code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; &gt; IntV;</code></pre><br>
 2006 ,     8.1,    Linux       <a href="http://www.stlport.org/">STLPort</a>.         .       std::wstring,    wchar_t.    Windows 2 ,   Linux   4 .           ,     .  gcc  ,   wchar_t     2 ,          , ..   glibc,        4- wchar_t.        ,  -       ,    .    ,   last but not least,   .       , ..                 . <br>
<br>
      ,     2000- <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581%25D0%25BA%25D1%2583,_%25D0%2590%25D0%25BD%25D0%25B4%25D1%2580%25D0%25B5%25D0%25B9"> </a>. ,     Facebook,      Facebook   ,     (.  <a href="https://github.com/facebook/folly">folly</a>).<br>
<br>
       :<br>
<br>
<ol>
<li>          (    ).</li>
<li>     <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BF%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B8_%25D0%25B7%25D0%25B0%25D0%25BF%25D0%25B8%25D1%2581%25D0%25B8">Copy On Write</a>.      ,  /   .</li>
</ol><br>
   ,      STLPort  stream (   ),        20%.      <a href="https://ru.wikipedia.org/wiki/Boost">Boost</a>. Boost   stream,  ,    API (,  ),     ,     stream. ,   ,       Boost. <br>
<br>
<h3> </h3><br>
    C++14    :<br>
<br>
<ol>
<li>   STLPort   C++14.   , ..  STLPort    2010 ,         .</li>
<li>    STL,   C++14.  ,      Windows  Linux.</li>
<li>          .</li>
</ol> <br>
     -    .<br>
<br>
      ;     <a href="https://libcxx.llvm.org/">libc++</a>,         Windows.   libc++  Windows,      ‚Äî ,   ,    ,    ,   libc++     <a href="https://ru.wikipedia.org/wiki/POSIX">POSIX API</a>.<br>
<br>
    .<br>
<br>
<h3></h3><br>
,     STLPort     (Visual Studio 2015  Windows, gcc 7  Linux, clang 8  macOS). <br>
<br>
 ,             ,         ,   ,      , ,   .   10 000   ( 14 000). wchar_t   char16_t;      wchar_t, .. char16_t     2        Windows  Linux.<br>
<br>
    . ,  STLPort         ,        .        ,        . <br>
<br>
,   ,     .   . <br>
<br>
      (  20-30%)     ( 10-15%)      .  ,  ,      .       ,  . <br>
<br>
        :  ( ) std::map  std::set     .                  .     ,    ,       ‚Äì             (   STLPort).                  Boost,       ,          .<br>
<br>
        ,       ,     ,  ,     Windows-.      ,    2017 ( 8.3.11 1:)   . <br>
<br>
<h3></h3><br>
   ++14     6 .        (  ) ,       ,     ‚Äî UI,  ,      ..<br>
<br>
          . ,  1: 8.3.14 ( ,      )     <a href="https://ru.wikipedia.org/wiki/C%252B%252B17">++17</a>. <br>
<br>
      .         STL    std,       std       ,   stdx ‚Äì ,       ,  boost ‚Äì   boost.     ,       . <br>
<br>
     ¬´¬ª    (<a href="https://en.cppreference.com/w/cpp/language/move_constructor">move constructors</a>)   .            ,  STL      (,       capacity   ). <br>
<br>
<h3> </h3><br>
, ,  (  )   ‚Äî      <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C">obj-</a>,            60 ‚Äì 70 .        ,         .       ,      ,  ,   .               .        ,          .  ,   ,     .         <a href="https://en.wikipedia.org/wiki/Single_Compilation_Unit">unity build</a> (,  ,  Google    Chrome).</div><p>Source: <a href="https://habr.com/ru/post/429678/">https://habr.com/ru/post/429678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429656/index.html">Artificial intelligence is also wrong. As in the US, we cheated Amazon Go - the store of the future without cashiers and sellers</a></li>
<li><a href="../429658/index.html">Satellite Internet Starlink from SpaceX - "license to print money"</a></li>
<li><a href="../429668/index.html">Google PageSpeed ‚Äã‚ÄãInsights has been radically updated, what will change?</a></li>
<li><a href="../429670/index.html">Java script! = Javascript. Five javas in one class. Scripting to remember forever</a></li>
<li><a href="../429676/index.html">Backup to tape</a></li>
<li><a href="../429680/index.html">MIT course "Computer Systems Security". Lecture 17: User Authentication, Part 1</a></li>
<li><a href="../429682/index.html">MIT course "Computer Systems Security". Lecture 17: User Authentication, Part 2</a></li>
<li><a href="../429684/index.html">Firebase Summit 2018: A Brief Summary</a></li>
<li><a href="../429686/index.html">MIT course "Computer Systems Security". Lecture 17: User Authentication, Part 3</a></li>
<li><a href="../429688/index.html">How to create a hero in which they will believe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>