<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logging in Adaptivist ScriptRunner</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to talk about logging in Adaptivist ScriptRunner. Logs are the main tool for developers and operators to analyze abnorma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logging in Adaptivist ScriptRunner</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to talk about logging in Adaptivist ScriptRunner.  Logs are the main tool for developers and operators to analyze abnormal situations in an industrial environment.  Therefore, when developing an application, we should think about what we will need when analyzing the incidents that occur. <br><br><img src="https://habrastorage.org/webt/e6/zw/qz/e6zwqz67lylapshic6ah0e3khpe.jpeg" alt="image"><br><a name="habracut"></a><br>  All examples were prepared in Jira Software 7.8.0 and Adaptivist ScriptRunner 5.3.9. <br><br>  Let's assume that you have come to a project that has already been going on for some time, or you have already written several dozen scripts, and now an incident with an error comes to you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Incident Example 1 </h4><br><pre><code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>,<span class="hljs-number"><span class="hljs-number">891</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-17</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">703</span></span>x1504x1 <span class="hljs-number"><span class="hljs-number">16</span></span>n2j3n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] Script <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> failed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> issue: BP<span class="hljs-number"><span class="hljs-number">-2</span></span>, actionId: <span class="hljs-number"><span class="hljs-number">951</span></span>, file: &lt;<span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> script&gt; java.lang.NullPointerException: Cannot invoke <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> getKey() <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> at Script1.run(Script1.groovy:<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br>  From logs it is clear that this is an inline script.  The script is in some business process in transition from ID 951. Next, we need to ask the operating personnel for information on switching from ID 951, and even after we receive this information, we still will not know, this script is in provided validator or post function.  In addition, we understand that the NPE was received because an object was null, but we do not know what object it is and why it was null.  We must first find this inline script, and with this we have problems. <br><br><h4>  Incident Example 2 </h4><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>,<span class="hljs-number"><span class="hljs-number">325</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-22</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1027</span></span>x4968x1 gj4xqt <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] Script <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> failed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> issue: BP<span class="hljs-number"><span class="hljs-number">-2</span></span>, actionId: <span class="hljs-number"><span class="hljs-number">961</span></span>, file: ru/matveev/alexey/main/postfunctions/pfNPE.groovy java.lang.IndexOutOfBoundsException: <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, Size: <span class="hljs-number"><span class="hljs-number">0</span></span> at java_util_List$get$<span class="pgsql"><span class="hljs-number"><span class="pgsql"><span class="hljs-number">6.</span></span></span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">call</span></span></span><span class="pgsql">(</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">Unknown</span></span></span><span class="pgsql"> Source) at ru.matveev.UtilHelper.getIndexOutOfBoundsException(UtilHelper.groovy:</span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">13</span></span></span><span class="pgsql">) at ru.matveev.UtilHelper$getIndexOutOfBoundsException.</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">call</span></span></span><span class="pgsql">(</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">Unknown</span></span></span><span class="pgsql"> Source) at ru.matveev.alexey.main.postfunctions.pfNPE.run(pfNPE.groovy:</span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">10</span></span></span><span class="pgsql">)</span></span></code> </pre> <br>  Here things are better.  We see that there is an error in the getIndexOutOfBoundsException method, which was caused by the pfNPE.groovy script.  We know the location of this script.  But we do not know where the file UtilHelper.groovy.  We can run a file system search and, most likely, find the UtilHelper file, but we also do not understand why we received an IndexOutOfBoundsException, what values ‚Äã‚Äãthe array from which we selected the element had.  That is, we lack the context in which the script was executed. <br><br><h4>  Incident Example 3 </h4><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">165</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-22</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">986</span></span>x4387x1 gj4xqt <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/CommentAssignIssue.jspa [coscjira.utils.ConditionUtils] Condition failed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> issue: BP<span class="hljs-number"><span class="hljs-number">-2</span></span>, built-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> script:com.onresolve.scriptrunner.canned.jira.workflow.postfunctions.CreateSubTask java.lang.NullPointerException: Cannot invoke <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> getClauseNames() <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> at Script19.run(Script19.groovy:<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>,<span class="hljs-number"><span class="hljs-number">166</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-22</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">986</span></span>x4387x1 gj4xqt <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/CommentAssignIssue.jspa [coscjira.utils.ConditionUtils] Script follows: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.component.ComponentAccessor def cs = ComponentAccessor.getCustomFieldManager().getCustomFieldObjectByName("field name") cs.getClauseNames()</code> </pre> <br>  Here we see that the error occurred in the built-in function ScriptRunner, which creates a subtask.  But we do not know this function has been added to the post function, listener or somewhere else.  In addition, we again have no script execution context. <br><br><h4>  Sample Incident 4 </h4><br><pre> <code class="hljs 1c"><span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-type"><span class="hljs-type"></span></span>  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  .     <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .</code> </pre> <br>  Suppose we know that our custom script is sending mail to us, but how to understand what went wrong in this custom script? <br><br>  So, let's try to systematize the information issued in the logs in order to: <br><br><ul><li>  quickly find the required script </li><li>  determine the context in which the script was executed </li><li>  understand what goes wrong when executing the script </li><li>  look for the logs we need among a large number of other logs </li></ul><br><h4>  1. It is necessary to structure all our scripts in the file system. </h4><br>  I prefer to store scripts by object type.  For example, the post functions will be stored in the directory ru / matveev / alexey / main / postfunctions, the listeners will be stored in ru / matveev / alexey / main / listeners, and so on.  This will help to structure the location of the scripts and more quickly navigate the variety of scripts (there are exceptions for which this structuring is inconvenient, I will try to tell about it in another article). <br><br><h4>  2. It is necessary to define the script package in the first line. </h4><br>  The script package determines its location in the file system.  For example, for post functions, the package will be defined as follows: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.matveev</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.alexey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.postfunctions</span></span></code> </pre> <br>  This will help us determine the location of the scripts.  For example, in Incident 2 we had the following entry in the logs: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.matveev</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.UtilHelper</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getIndexOutOfBoundsException</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">UtilHelper</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.groovy</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:13)</span></span></code> </pre> <br>  From here we understand that UtilHelper is in ru / matveev. <br><br><h4>  3. It is necessary immediately after the import to determine the script script. </h4><br>  How to define a logger for a script in ScriptRunner can be found <a href="https://www.adaptavist.com/doco/display/SFJ/Set%2Blogging%2Bto%2Bhelp%2Bdebug%2Byour%2Bscripts">here</a> .  But I prefer to use SLF4J, since the syntax of log output seems to me more convenient than in log4j.  For example, you can log like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>("var1: {}, var2: {}", var1, var2)</code> </pre> <br>  Here, during the script execution, instead of curly brackets, the values ‚Äã‚Äãof the variables var1 and var2 are substituted. <br><br>  The logger for scripts that are in the file system can be defined like this: <br><br><pre> <code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">LoggerFactory</span></span>.getLogger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClass())</code> </pre> <br>  In this case, the logger will be equal to the script package plus the file name.  For example, for the pfNPE.groovy file, which has the ru.matveev.alexey.main.postfunctions package defined, the logger would look like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.matveev</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.alexey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.postfunctions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pfNPE</span></span></code> </pre> <br>  For inline scripts, you must explicitly specify the logger.  To do this, you must first fill in the Note field when setting up an inline script.  This will allow us to accurately determine the executable script: <br><br><img src="https://habrastorage.org/webt/fr/u3/ek/fru3ekxtuhsp_xah0domtxakkvm.png"><br><br>  Next, we determine where the script would be if it were located in the file system.  In the screenshot above, we add a listener, so this file would be placed in ru / matveev / alexey / main / listeners.  Thus, our logger is obtained like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ru</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.matveev</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.alexey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.listeners</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.NPElistener</span></span></code> </pre> <br>  I also add .inline to the logger in order to understand that this is an inline script and the final look of the logger is this: <br><br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoggerFactory</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ru.matveev.alexey.main.listeners.NPElistener.inline"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> <br>  Logger allows us to: <br><br><ul><li>  Set the script logging level (you can read about logging levels <a href="https://www.tutorialspoint.com/log4j/log4j_logging_levels.htm">here</a> ) </li><li>  Filter logs only for our script.  Without this, log analysis is impossible, since Jira generates a large number of logs. </li></ul><br><h4>  4. Log entry and exit script </h4><br>  For inline scripts, immediately after determining the logger, I log in the script entry and exit.  For example, for a listener whose Note field is defined as an NPEListener, the input and output logging lines will look like this: <br><br><pre> <code class="hljs matlab"><span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.info(<span class="hljs-string"><span class="hljs-string">"NPElistener in"</span></span>) ... <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.info(<span class="hljs-string"><span class="hljs-string">"NPElistener out"</span></span>)</code> </pre> <br>  For inline scripts that run in a business process, you can also specify the name of the business process, initial status, transition, and the value of the Note field.  For example, like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.info</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyWorkflow</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:IN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Progress</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:In</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Progress</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:OutOfIndexBoundsPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">in</span></span>") ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">log</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.info</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyWorkflow</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:IN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Progress</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:In</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Progress</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:OutOfIndexBoundsPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">out</span></span>")</code> </pre> <br>  In this case, the script is called in MyWorkflow, the initial status is In Progress, the transition is In Progress, the value is Note OutOfIndexBoundsPF.  The encoding format of the call site can be any. <br><br>  It is clear that the name of the business process or status may change, and then the information will become irrelevant.  In this case, it will be possible to find a place to call the script on the transition ID <br><br>  For scripts in the file system, input and output logging looks like this: <br><br><pre> <code class="hljs kotlin">log.info(<span class="hljs-string"><span class="hljs-string">"{} in"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClass()) ... log.info(<span class="hljs-string"><span class="hljs-string">"{} out"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClass())</code> </pre> <br>  Logging the input and output helps to understand whether the script is finished or not.  You can log the inputs and outputs of functions in a script or called modules.  But it is necessary to determine it yourself, as far as necessary, and also to determine the level of logging. <br><br>  I log in and out of the script with the INFO level in order to enable the log only of the inputs and outputs from the script when I do not need the context of the script execution.  Levels work in such a way that they log all values ‚Äã‚Äãthat are equal to the specified level or higher.  For example, the INFO level will log INFO, WARN, ERROR, FATAL levels, but will not log DEBUG and TRACE. <br><br><h4>  5. It is necessary to log the values ‚Äã‚Äãof variables in the script </h4><br>  In order for us to understand the context of script execution, we must at least log the values ‚Äã‚Äãof variables.  The variables are logged like this: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>("index: {}", <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>)</code> </pre> <br>  I am logging context with DEBUG or TRACE. <br><br>  Now let's try to rewrite the scripts that caused the incidents, using the approach outlined above, and see how this helps us analyze these incidents. <br><br><h4>  Incident 1 </h4><br>  The script that generated the error for Incident 1 looks like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">com</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.atlassian</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jira</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.issue</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Issue</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Issue</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">issue</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">issue</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.getKey</span></span>()</code> </pre> <br>  After adding logging, the script will look like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.Issue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.log4j.Logger def <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> = Logger.getLogger("ru.matveev.alexey.main.postfunctions.NPEPF.inline") <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("MyWorkflow:IN Progress:In Progress:NPEPF in") Issue issue issue.getKey() <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("MyWorkflow:IN Progress:In Progress:NPEPF out")</code> </pre> <br>  In order to see the logs in the atlassian-jira.log file, go to System -&gt; Logging and Profiling and set the INFO level for the logger ru.matveev.alexey.main.postfunctions.NPEPF.inline.  After that, we will see in the logs such records: <br><br><pre> <code class="hljs markdown">2018-03-18 18:10:48,462 http-nio-8080-exec-36 INFO admin 1090x711x1 e9394m 127.0.0.1 /secure/WorkflowUIDispatcher.jspa [rmampostfunctions.NPEPF.inline] MyWorkflow:IN Progress:In Progress:NPEPF in 2018-03-18 18:10:48,467 http-nio-8080-exec-36 ERROR admin 1090x711x1 e9394m 127.0.0.1 /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] <span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span> 2018-03-18 18:10:48,468 http-nio-8080-exec-36 ERROR admin 1090x711x1 e9394m 127.0.0.1 /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] Script function failed on issue: BP-2, actionId: 951, file: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">inline</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> java.lang.NullPointerException: Cannot invoke method getKey() on null object at Script16.run(Script16.groovy:7)</code> </pre> <br>  From the logs we see that we entered the NPEPF inline script and did not exit it, which means the error occurred in it.  In the text of the script, we see that the variable issue is not initialized. <br><br><h4>  Incident 2 </h4><br>  The scripts that caused the error look like this: <br><br>  <b>pfNPE.groovy</b> <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.matveev.UtilHelper List&lt;String&gt; stringList = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayList&lt;&gt;() stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("0") stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("1") stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("2") UtilHelper.getRandomElement(stringList)</code> </pre> <br>  <b>Utilhelper.groovy</b> <br><pre> <code class="hljs pgsql">package ru.matveev <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.Issue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Random <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UtilHelper { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static String getRandomElement(List&lt;String&gt; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { Random rand = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Random() <span class="hljs-type"><span class="hljs-type">int</span></span> max = <span class="hljs-number"><span class="hljs-number">5</span></span> def <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = rand.nextInt(max); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) } }</code> </pre> <br>  After adding logging, the scripts will be like this: <br><br>  <b>pfNPE.groovy</b> <br><pre> <code class="hljs pgsql">package ru.matveev.alexey.main.postfunctions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.matveev.alexey.main.helpers.UtilHelper <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; def <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> = LoggerFactory.getLogger(this.getClass()) <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("pfNPE in") List&lt;String&gt; stringList = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayList&lt;&gt;() stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("0") stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("1") stringList.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("2") UtilHelper.getRandomElement(stringList) <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("pfNPE out")</code> </pre> <br>  <b>Utilhelper.groovy</b> <br><pre> <code class="hljs pgsql">package ru.matveev.alexey.main.helpers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.Issue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UtilHelper { private static final <span class="hljs-keyword"><span class="hljs-keyword">LOG</span></span> = LoggerFactory.getLogger("ru.matveev.alexey.main.helpers.UtilHelper") <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static String getRandomElement(List&lt;String&gt; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">LOG</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>("getRandomElement in. value: {}", <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) Random rand = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Random() <span class="hljs-type"><span class="hljs-type">int</span></span> max = <span class="hljs-number"><span class="hljs-number">5</span></span> def <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = rand.nextInt(max); <span class="hljs-keyword"><span class="hljs-keyword">LOG</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>("index: {}", <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) } }</code> </pre> <br>  In order for us to see the logs in the atlassian-jira.log file, you need to install the loggers ru.matveev.alexey.main.helpers.UtilHelper and ru.matveev.alexey.main.postfunctions.pfNPE DEBUG level in System -&gt; Logging and Profiling.  After that we will see the following logs: <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>,<span class="hljs-number"><span class="hljs-number">664</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1134</span></span>x121x1 pr8c2n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [rmamain.postfunctions.pfNPE] pfNPE <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>,<span class="hljs-number"><span class="hljs-number">687</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEBUG</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1134</span></span>x121x1 pr8c2n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [rmamain.helpers.UtilHelper] getRandomElement <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>,<span class="hljs-number"><span class="hljs-number">687</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEBUG</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1134</span></span>x121x1 pr8c2n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [rmamain.helpers.UtilHelper] <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>,<span class="hljs-number"><span class="hljs-number">693</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-2</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1134</span></span>x121x1 pr8c2n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] ************************************************************************************* <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>,<span class="hljs-number"><span class="hljs-number">694</span></span> http-nio<span class="hljs-number"><span class="hljs-number">-8080</span></span>-exec<span class="hljs-number"><span class="hljs-number">-2</span></span> ERROR <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-number"><span class="hljs-number">1134</span></span>x121x1 pr8c2n <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /secure/WorkflowUIDispatcher.jspa [cosjira.workflow.ScriptWorkflowFunction] Script <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> failed <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> issue: BP<span class="hljs-number"><span class="hljs-number">-2</span></span>, actionId: <span class="hljs-number"><span class="hljs-number">961</span></span>, file: ru/matveev/alexey/main/postfunctions/pfNPE.groovy java.lang.IndexOutOfBoundsException: <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, Size: <span class="hljs-number"><span class="hljs-number">3</span></span> at java_util_List$get$<span class="pgsql"><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1.</span></span></span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">call</span></span></span><span class="pgsql">(</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">Unknown</span></span></span><span class="pgsql"> Source) at ru.matveev.alexey.main.helpers.UtilHelper.getRandomElement(UtilHelper.groovy:</span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">25</span></span></span><span class="pgsql">) at ru.matveev.alexey.main.helpers.UtilHelper$getRandomElement.</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">call</span></span></span><span class="pgsql">(</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">Unknown</span></span></span><span class="pgsql"> Source) at ru.matveev.alexey.main.postfunctions.pfNPE.run(pfNPE.groovy:</span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">12</span></span></span><span class="pgsql">)</span></span></code> </pre> <br>  From the logs we understand.  what scripts were called and where they are.  We see the values ‚Äã‚Äãof all variables.  You can open scripts and try to understand what went wrong.  All the information we have. <br><br><h4>  Incident 3 </h4><br>  Here you need to add logging for inline scripts and then we will also be able to understand where the script is called from and in what context. <br><br><h4>  Incident 4 </h4><br>  There may be several options.  For example, we can know exactly the script that is executed when assigning an artist.  Then we enable the DEBUG level for the script logger and look at the logs.  If we do not know the script, then we can set the DEBUG level for all scripts (ru.matveev.alexey.main) or for a separate type of scripts (ru.matveev.alexey.main.listeners - only for listeners).  Next, we can set the filtering of the log output by the loggers in the program that we use to view the logs, and receive information only about the logs we need.  After that, we assign an artist and see what happens in the logs.  If we have logged in scripts, we will get all the necessary information. <br><br>  This is all that I would like to tell in this article.  I would just like to add that you may want to log each line of the script.  No need to do this, because then the script will be difficult to understand.  It must be remembered that the readability of the program code is as important as logging. </div><p>Source: <a href="https://habr.com/ru/post/351412/">https://habr.com/ru/post/351412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351402/index.html">Installing the Linux + server (Nginx + Apache) + PostgreSQL + PHP on VirtualBox (Ubuntu Server 16.04.3 LTS)</a></li>
<li><a href="../351404/index.html">Richard Hamming: Chapter 6. Artificial Intelligence - 1</a></li>
<li><a href="../351406/index.html">Arrays, pointers and other quantum phenomena around us</a></li>
<li><a href="../351408/index.html">FastTrack Training. "Network Basics". "Collaboration Software from Cisco." Eddie Martin December 2012</a></li>
<li><a href="../351410/index.html">A small library for the use of AI in Telegram chat bots</a></li>
<li><a href="../351414/index.html">Corporate IaaS digest: 25 materials on virtualization, infrastructure and information security</a></li>
<li><a href="../351416/index.html">TECO Editor: EMACS, I am your father</a></li>
<li><a href="../351418/index.html">FastTrack Training. "Network Basics". "Value of Collaboration Products from Cisco." Eddie Martin December 2012</a></li>
<li><a href="../351420/index.html">The digest of interesting materials for the mobile developer # 245 (March 12 - March 18)</a></li>
<li><a href="../351424/index.html">SNAP Issues: Incomplete Object Paradigm and Premature Typing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>