<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Silverlight game loop</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will describe the use of the game loop in Silverlight. A function that contains all the logic for working with animation and proces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Silverlight game loop</h1><div class="post__text post__text-html js-mediator-article">  In this article, I will describe the use of the game loop in Silverlight.  A function that contains all the logic for working with animation and processing user actions that affect the animation.  For example, the management machine. <br><br> <a href="http://zabil.xtreemhost.com/samples/demo-simple-game-loop"><img src="https://habrastorage.org/getpro/habr/post_images/360/9d1/57c/3609d157c76fc61c47a5a224002d35d4.png" alt="Click on the picture to see an example."></a> <br><br>  Silverlight has excellent animation support.  Pull the properties in Blend, put the keys.  And everything works, controls react to user actions.  Programmatically, through <i>Storyboard</i> , the animation of a property change from state A to state B, without incident in the middle, is also done easily.  But when it comes to complex animation (physics, collision calculation, dynamic change of the animation curve), the implementation of animation through the <i>Storyboard</i> makes the code much more difficult or impossible. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The classic approach to this issue is to create a timer and recalculate the animation logic with each update. <br><br>  In Silverlight, these can be timers: <ul><li>  <i>System.Windows.Threading.DispatcherTime</i> r - working in the UI thread </li><li>  <i>System.Threading.Timer</i> - running in a separate thread. </li></ul><br>  But more appropriate for the implementation of software animation in Silverlight will use the global rendering event <i>Rendering</i> , the static class <i>System.Windows.Media.CompositionTarget</i> . <br><br>  Sample code for a simple game loop: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   private int _lastTime; private void MainPage_Loaded(object sender, RoutedEventArgs e){ //  ,     CompositionTarget.Rendering += _gameLoopUpdate; _lastTime = Environment.TickCount; } private void _gameLoopUpdate(object sender, EventArgs e){ int currentTime = Environment.TickCount; int frameTime = currentTime - _lastTime; _lastTime = currentTime; //    }</span></span></code> </pre> <br><br>  The <i>frameTime</i> variable contains the elapsed time since the last redraw.  It should be borne in mind that this time can vary greatly.  In order to avoid sharp jerks between frames, it is necessary to make mutable properties dependent on this time.  It is important to understand that fps (frame rate per second) equal to 60 does not mean that every frame appears after 16 milliseconds. <br>  In principle, this is all, then it remains only to write your animation logic.  Because  Silverlight itself is responsible for the redrawing of objects, you only need to fill the properties with values ‚Äã‚Äãand not take care of the rest <br><br><h4>  Living example </h4><br>  For example, create a "game", the machine in the box.  The arrows on the keyboard are driving.  Left, right, gas, reverse / brake, everything is like everywhere else. <br>  Create a new Silverlight project.  Open "MainPage.xaml".  In the main Grid, named "LayoutRoot" put: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FF084E0F"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IsHitTestVisible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TextWrapping</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Wrap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FF00228D"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RenderTransformOrigin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5,0.5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"129"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock.RenderTransform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CompositeTransform</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Rotation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-35"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock.RenderTransform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ContentPanel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tbInfo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TextBlock"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"White"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"car"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"70"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"car.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"35"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Canvas</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Picture ‚Äúcar.png‚Äù you can use your own or this: <br><img src="https://habrastorage.org/getpro/habr/post_images/f2e/36b/728/f2e36b728991472e4da5c9c65f452933.png" alt="car.png"><br><br>  The main thing is that the nose of the car would look right. <br><br><blockquote><h5>  Dimensional problems with animation. </h5><br>  There are several problems that can arise when working with animation due to the size of animated objects: <br><ul><li>  When the width or height dimensions are set in <i>Auto</i> , the change of the rotation center is not taken into account, respectively, there may be problems with the rotation animation.  Set dimensions in absolute units. </li><li>  At start, <i>ActualWidth</i> and <i>ActualHeight</i> are equal to zero, because  Not a single object has been drawn yet.  Consider this in calculations. </li></ul></blockquote><br><br>  The game world is created.  Add logic. <br><br><h4>  Keystroke processing </h4><br>  Keys are not so simple.  Initially, Silverlight does not support the definition of simultaneously pressed keys, not counting the modifiers: Ctrl, Shift, Alt.  The KeyDown event handles only the last key pressed.  Those.  have to press one key at a time.  For example, squeezed the gas, and while gassing, do not turn left.  As a solution, hang the gas / brake on Ctrl, Shift and steer with both hands.  Awkwardly it turns out ... <br><br>  But all is not so bad, but even good.  On the Internet ( <a href="http://forums.silverlight.net/p/115799/261029.aspx">Detecting multiple keypresses in Silverlight</a> ) there was a class that solves this problem and even allows you to handle keystrokes inside the game cycle, which is much more convenient than inside the KeyDown handler. <br><br>  Add a class to the project: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//  .    , //   ,  . //         public sealed class KeyHandler { private bool[] isPressed = new bool[256]; private UserControl targetCanvas = null; public void ClearKeyPresses(){ for (int i = 0; i &lt; 256; i++){ isPressed[i] = false; } } public void ClearKey(Key k){ isPressed[(int) k] = false; } public void Attach(UserControl target){ ClearKeyPresses(); targetCanvas = target; target.KeyDown += new KeyEventHandler(target_KeyDown); target.KeyUp += new KeyEventHandler(target_KeyUp); target.LostFocus += new RoutedEventHandler(target_LostFocus); } public void Detach(UserControl target){ target.KeyDown -= new KeyEventHandler(target_KeyDown); target.KeyUp -= new KeyEventHandler(target_KeyUp); target.LostFocus -= new RoutedEventHandler(target_LostFocus); ClearKeyPresses(); } private void target_KeyDown(object sender, KeyEventArgs e){ isPressed[(int) e.Key] = true; } private void target_KeyUp(object sender, KeyEventArgs e){ isPressed[(int) e.Key] = false; } private void target_LostFocus(object sender, EventArgs e){ ClearKeyPresses(); } public bool IsKeyPressed(Key k){ int v = (int) k; if (v &lt; 0 || v &gt; 82) return false; return isPressed[v]; } public bool IsKeyPressed(Key[] keys){ foreach (Key k in keys){ if (this.IsKeyPressed(k)) return true; } return false; } }</span></span></code> </pre><br><br><h4>  Animation </h4><br>  Add the following global variables to MainPage.xaml.cs: <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   private KeyHandler _keyHandler = new KeyHandler(); //       private RotateTransform _rotateHelper = new RotateTransform(); //       private TranslateTransform _translateTransform = new TranslateTransform(); private RotateTransform _rotateTransform = new RotateTransform();</span></span></code> </pre><br><br>  Car animation will be done through the <i>RenderTransform</i> property.  It is responsible for moving, rotating, etc. <br><img src="https://habrastorage.org/getpro/habr/post_images/a69/562/49a/a6956249ae48928b810151aa5e0bc661.png"><br><blockquote>  Because  Transformations animate an object relative to its starting position.  Make sure that the <b>car</b> object (our machine) is not set to <i>Canvas.Top</i> and <i>Canvas.Left</i> . <br></blockquote><br>  Fill in the designer of the main window: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ InitializeComponent(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Loaded += MainPage_Loaded; <span class="hljs-comment"><span class="hljs-comment">//     var tg = new TransformGroup(); tg.Children.Add(_rotateTransform); tg.Children.Add(_translateTransform); car.RenderTransform = tg; //    _translateTransform.X = 50; _translateTransform.Y = 50; car.MouseLeftButtonDown += car_MouseLeftButtonDown; //    _keyHandler.Attach(this); }</span></span></code> </pre><br>  The function of processing the mouse click is needed for the most part just to show that the machine catches mouse events: <br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//       void car_MouseLeftButtonDown(object sender, MouseButtonEventArgs e){ _speedPerSecond += 300; }</span></span></code> </pre><br>  When the window is displayed, set the focus to the Silverlight plugin, otherwise it will not catch keystrokes.  In some browsers, this does not help, then you need to set the focus manually, i.e.  just click on our toy.  Also, prepare the game cycle. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage_Loaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ,        System.Windows.Browser.HtmlPage.Plugin.Focus(); //  ,     CompositionTarget.Rendering += _gameLoopUpdate; _lastTime = Environment.TickCount; }</span></span></code> </pre><br>  Add global variables to be used for animation: <br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//    private Point _direction = new Point(1, 0); //  private double _speedPerSecond ; // /   , &gt;1 ,&lt;1  private double _accelerationRatioPerSec = 0.60; //   private int _lastTime;</span></span></code> </pre><br>  By animating the moving machine.  Rotate the direction vector (unit vector) around the origin, multiply the components of the vector by the speed and get the place where the machine should be.  At the same time, the resulting angle will be the angle of rotation of the machine. <br><img src="http://storage5.static.itmages.ru/i/11/0724/h_1311512283_7a1e4800c9.png"><br><br>  To calculate the intersection of the car with the border of its container: we calculate the rectangle bounding the car, taking into account the angle of turn of the car. <br><img src="http://storage4.static.itmages.ru/i/11/0724/h_1311512282_6f308b25b8.png"><br><br>  It's time to go to the heart of the game, the functions of the game cycle: <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _gameLoopUpdate(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, EventArgs e){ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentTime = Environment.TickCount; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameTime = currentTime - _lastTime; _lastTime = currentTime; <span class="hljs-comment"><span class="hljs-comment">//       //          double delta = (double)frameTime / 1000; //       double xCurrentPos = _translateTransform.X; double yCurrentPos = _translateTransform.Y; double currentAngle = _rotateTransform.Angle; //   double addToSpeedPerSec = 300; if (_keyHandler.IsKeyPressed(Key.Up)){ _speedPerSecond += addToSpeedPerSec*delta; } if (_keyHandler.IsKeyPressed(Key.Down)){ _speedPerSecond -= addToSpeedPerSec * delta; } //       double targetAngle = currentAngle; double coefAngle = .5; if (_keyHandler.IsKeyPressed(Key.Right)){ targetAngle += _speedPerSecond * coefAngle*delta; } if (_keyHandler.IsKeyPressed(Key.Left)){ targetAngle -= _speedPerSecond * coefAngle * delta; } //    _rotateHelper.CenterX = car.ActualWidth / 2; _rotateHelper.CenterY = car.ActualHeight / 2; _rotateHelper.Angle = targetAngle; //    _rotateHelper.CenterX = 0; _rotateHelper.CenterY = 0; _direction = _rotateHelper.Transform(new Point(1, 0)); //   _speedPerSecond += (_speedPerSecond*_accelerationRatioPerSec - _speedPerSecond)*delta; // ,       double stepPerFrame = _speedPerSecond * delta; //   double xTargetPos = xCurrentPos + _direction.X * stepPerFrame; double yTargetPos = yCurrentPos + _direction.Y * stepPerFrame; //           Rect borderRect = _rotateHelper.TransformBounds(new Rect(0, 0, car.ActualWidth, car.ActualHeight)); borderRect.X = borderRect.X + xTargetPos; borderRect.Y = borderRect.Y + yTargetPos; //     if (isInContentPanel(borderRect)){ ////     _translateTransform.X = xTargetPos; _translateTransform.Y = yTargetPos; _rotateTransform.Angle = targetAngle; } else{ // ,     _speedPerSecond = 0; } //  tbInfo.Text = string.Format("Speed:{0:F1}", _speedPerSecond); } //    ,    private bool isInContentPanel(Rect shapeBorder){ if (0 &lt;= shapeBorder.Left &amp;&amp; shapeBorder.Right &lt;= ContentPanel.ActualWidth) if (0 &lt;= shapeBorder.Top &amp;&amp; shapeBorder.Bottom &lt;= ContentPanel.ActualHeight) return true; return false; }</span></span></code> </pre><br>  The cycle function consists of the following steps: <br><ul><li>  We get the current position of the machine </li><li>  We set changes, in compliance with pushed keys </li><li>  Constantly resetting the speed to 0, this makes the acceleration animation not so linear </li><li>  Check if the car got out of the box </li><li>  We apply the received changes. </li></ul><br>  For all changes, we take into account the time elapsed from the previous frame ( <i>delta</i> ).  For ease of perception, speed is measured in units per second.  The angle of rotation increases with the speed of the car. <br>  It is worth noting the processing of keystrokes.  Because  they are processed in the game loop, the changes they make do not need to be synchronized separately.  And such a problem would arise if the code changing the speed and angle of rotation were called from the KeyDown handler. <br><br><h4>  Results </h4><br>  The car drives, accelerates by a less complicated algorithm.  Of course, you can make more natural-looking animations of acceleration and reversals, the effect of skidding, miscalculation of collisions with old women crossing the road ... but it is sufficiently realized to see: complex animation, it is better to do in the game cycle. <br><br>  The game cycle also has architectural advantages, everything that is currently taking place is collected in one place, as well as the factors that influence it.  In comparison with the animation through the <i>Storyboard</i> , it is easier to debug, there is no asynchrony (In the <i>Storyboard, the</i> whole confusion with the catch of the end of the animation, for the start of the next stage of the animation). <br><br>  In addition, it is not necessary to implement everything in the forehead.  The example above is easy to rewrite in <a href="http://www.silverlightshow.net/items/Behaviors-and-Triggers-in-Silverlight-3.aspx">Behavior</a> .  We attach this behavior to Blend, to the button, and now it drives around the whole screen (why it is necessary is not clear, but it is possible).  In the resources below, the link to the wrapper is above the physical library, which basically does the same thing: in Blend we mark objects and they become sensitive to the laws of physics. <br><br>  The source code for ‚Äúcars in a box‚Äù can be downloaded <a href="http://www.onlinedisk.ru/file/702404/">here</a> or <a href="http://zabil.xtreemhost.com/samples/demo-simple-game-loop">from the sample page</a> . <br><br>  Resources: <br><ol><li>  <a href="http://physicshelper.codeplex.com/">Physics Helper for Blend, Silverlight, WP7 and Farseer</a> - Silverlight wrapper over the Farseer Physics Engine physical library (http://farseerphysics.codeplex.com/).  It was in her code that I found how complex animation is processed in Silverlight. </li><li>  <a href="http://www.silverlightshow.net/items/Custom-Animations-in-Silverlight.aspx">Custom Animations in Silverlight</a> - using the game loop on the example of a pendulum.  Article in English. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/125037/">https://habr.com/ru/post/125037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125030/index.html">Mango has moved to the status of RTM and it presents the first smartphone</a></li>
<li><a href="../125031/index.html">Evernote Developer Contest Finalists Revealed!</a></li>
<li><a href="../125033/index.html">Magento FAQ or answers to all your questions</a></li>
<li><a href="../125035/index.html">Does Habrahabr help you in your work?</a></li>
<li><a href="../125036/index.html">Sysadmin Day is coming!</a></li>
<li><a href="../125041/index.html">Web design. Each device has its own presentation</a></li>
<li><a href="../125045/index.html">Emmanuel Vivier: "If you just start a Vkontakte account, it will not help you become more human, open and socially responsible."</a></li>
<li><a href="../125047/index.html">A simple game on html and control on the touchscreen</a></li>
<li><a href="../125049/index.html">Moscow Innovation Evening</a></li>
<li><a href="../125050/index.html">Usability Habrahabr: work on the bugs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>