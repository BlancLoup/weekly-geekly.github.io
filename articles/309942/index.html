<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Presenter Template in Laravel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you use Laravel in your project for a long time, your models are likely to become quite large. Over time, they become harder to maintain, because T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Presenter Template in Laravel</h1><div class="post__text post__text-html js-mediator-article"><p>  If you use Laravel in your project for a long time, your models are likely to become quite large.  Over time, they become harder to maintain, because  They are overgrown with new features.  When you write code for each case where your models are used, it is tempting to ‚Äúfatten‚Äù our models until they get fat. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/22f/2d7/9fa/22f2d79faf3fc6434316c3360345149b.jpg" alt="image"></p><br><p>  In such situations, we can use the Decorator pattern, which will allow us to separate the code specific to each case into a separate class.  For example, we can use decorators to separate presentation views for a PDF document, CSV, or API response. <a name="habracut"></a></p><br><h1 id="chto-takoe-dekorator-i-chto-takoe-prezenter">  What is a Decorator and what is a Presenter? </h1><br><p>  A decorator is an object that wraps another object in order to extend its functionality.  It also passes the method calls to the object that was wrapped if they are not in the decorator.  Decorators can be useful when you need to change the behavior of a class without resorting to inheritance.  You can use them to add additional functionality to your objects, such as logging, access control, and the like. </p><br><p>  A presenter is a type of Decorator used to bring an object to the desired form (for example, for a Blade-template or an API response). </p><br><h1 id="privedenie-kollekcii-polzovateley-k-otvetu-api">  Bringing a collection of users to an API response </h1><br><p>  Suppose we have a collection of users, which we must return in the API response.  In Laravel, we can easily implement this by simply returning the collection itself, which will then be converted to JSON.  Let's get the models of our users in the controller: </p><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> User::all(); } }</code> </pre> <br><p>  The <code>all</code> method returns all users from the database.  The User model contains all table fields.  Passwords and other important information are also there.  In addition, Laravel automatically converts the result of the <code>all</code> method to JSON when output. </p><br><p>  However, this is not the best solution to the problem.  For example, you do not need to send user password hashes in response. </p><br><p>  Also, we may not like what the dates <code>created_at</code> and <code>updated_at</code> look like.  Or if our <code>is_active</code> field is of type <code>tinyint</code> , we may want to convert it to a string or to a boolean value. </p><br><p>  Note: Yes, yes, I know that Eloquent allows you to hide the model's fields when converting it to JSON using the model's $ hidden property.  Just play along to me. </p><br><h1 id="vospolzuemsya-patternom-presenter">  Let's use the Presenter pattern. </h1><br><p>  Now that we have a collection of User models, we need to figure out how to pass them on to the presentation by wrapping them in a decorator.  We need a class that will serve as the Presenter.  Our class UserPresenter in this case will look like this: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserPresenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Model $model)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = $model; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method, $args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call_user_func_array([<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model, $method], $args); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;{$name}; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> trim(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;first_name . <span class="hljs-string"><span class="hljs-string">' '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;last_name); } }</code> </pre> <br><p>  Note that our presenter gets the properties <code>first_name</code> , <code>last_name</code> , and <code>created_at</code> the model, because the presenter does not have these properties. </p><br><p>  I love stupid analogies and this is one of them: the decorator is something like a Batman costume on Bruce Wayne.  And Batman has a bunch of different costumes for different situations.  Like Batman's costumes, we can use different decorators for different situations where we need a User model.  Let's rename our decorator to something more suitable, for example, ApiPresenter, and then place it in the Presenters folder.  We will also separate the code that can be reused into a separate class Presenter: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Presenter</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Model $model)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = $model; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method, $args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call_user_func_array([<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model, $method], $args); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;{$name}; } }</code> </pre> <br><p>  Let's add a new method to the <code>ApiPresenter</code> : </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>\<span class="hljs-title"><span class="hljs-title">Presenters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Presenter</span></span>\<span class="hljs-title"><span class="hljs-title">Presenter</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiPresenter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> trim(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;first_name . <span class="hljs-string"><span class="hljs-string">' '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;last_name); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createdAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;created_at-&gt;format(<span class="hljs-string"><span class="hljs-string">'n/j/Y'</span></span>); } }</code> </pre> <br><p>  You might think that you can use Laravel mutators to convert dates to the format we need and avoid all this messing with presenters.  This is possible if we only need one mapping option. </p><br><p>  You can also say: "I could leave the <code>created_at</code> field as it is and use several mutators for different situations. For example, <code>friendlyCreatedAt()</code> , <code>pdfCreatedAt()</code> and <code>createdAtAsYear()</code> ".  The main argument against this approach is that your model will gradually become huge and will bring us a lot of anxiety.  We can shift this responsibility to a separate class, which will bring our model to the desired form. </p><br><p>  Let's add some more methods to our presenter: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>\<span class="hljs-title"><span class="hljs-title">Presenters</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiPresenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> trim(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;full_name . <span class="hljs-string"><span class="hljs-string">' '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;last_name); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createdAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;created_at-&gt;format(<span class="hljs-string"><span class="hljs-string">'n/j/Y'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (bool) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;is_active; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">role</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;is_admin) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Admin'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'User'</span></span>; } }</code> </pre> <br><p>  Here we <code>is_active</code> field of our model to a logical type instead of <code>tinyint</code> .  We also provide a string representation of the user role API. </p><br><p>  Let's return to our controller.  Now we can use the presenter to build the answer: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>\<span class="hljs-title"><span class="hljs-title">Presenters</span></span>\<span class="hljs-title"><span class="hljs-title">ApiPresenter</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApiPresenter(User::findOrFail($id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $user-&gt;fullName(), <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; $user-&gt;role(), <span class="hljs-string"><span class="hljs-string">'created_at'</span></span> =&gt; $user-&gt;createdAt(), <span class="hljs-string"><span class="hljs-string">'is_active'</span></span> =&gt; $user-&gt;isActive(), ]); } }</code> </pre> <br><p>  It is wonderful!  Now the API returns only the necessary information and the code began to look cleaner.  But even better, if we want to use a value that is not in <code>ApiPresenter</code> , but in the User model, we can simply return it dynamically from the model, as we are used to: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json([ <span class="hljs-string"><span class="hljs-string">'first_name'</span></span> =&gt; $user-&gt;first_name, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span> =&gt; $user-&gt;last_name, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $user-&gt;fullName(), <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; $user-&gt;role(), <span class="hljs-string"><span class="hljs-string">'created_at'</span></span> =&gt; $user-&gt;createdAt(), <span class="hljs-string"><span class="hljs-string">'is_active'</span></span> =&gt; $user-&gt;isActive(), ]);</code> </pre> <br><h1 id="dekorirovanie-kollekcii-polzovateley">  Decorating a collection of users </h1><br><p>  Decorator is a pretty powerful pattern that allows you to keep your code clean and tidy.  But what about the first situation when we had a collection of models?  We can loop through it and create a new array: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>\<span class="hljs-title"><span class="hljs-title">Presenters</span></span>\<span class="hljs-title"><span class="hljs-title">ApiPresenter</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $users = User::all(); $apiUsers = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $user) { $apiUser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApiPresenter($user); $apiUsers[] = [ <span class="hljs-string"><span class="hljs-string">'first_name'</span></span> =&gt; $apiUser-&gt;model-&gt;first_name, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span> =&gt; $apiUser-&gt;model-&gt;last_name, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $apiUser-&gt;fullName(), <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; $apiUser-&gt;role(), <span class="hljs-string"><span class="hljs-string">'created_at'</span></span> =&gt; $apiUser-&gt;createdAt(), <span class="hljs-string"><span class="hljs-string">'is_active'</span></span> =&gt; $apiUser-&gt;isActive(), ]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json($apiUsers); } }</code> </pre> <br><p>  Everything is beautiful, but it doesn't look very beautiful.  Instead, I want to use macros that the <code>Collection</code> class allows to create: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> Collection::macro(<span class="hljs-string"><span class="hljs-string">'present'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($class)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($class)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $class($model); }); });</code> </pre> <br><p>  This code can be placed in the service provider of your application.  Now we call our macro by specifying the desired presenter: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Users</span></span>\<span class="hljs-title"><span class="hljs-title">Presenters</span></span>\<span class="hljs-title"><span class="hljs-title">ApiPresenter</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $users = User::all() -&gt;present(ApiPresenter::class) -&gt;map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'first_name'</span></span> =&gt; $user-&gt;first_name, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span> =&gt; $user-&gt;last_name, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $user-&gt;fullName(), <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; $user-&gt;role(), <span class="hljs-string"><span class="hljs-string">'created_at'</span></span> =&gt; $user-&gt;createdAt(), <span class="hljs-string"><span class="hljs-string">'is_active'</span></span> =&gt; $user-&gt;isActive(), ]; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response()-&gt;json($users); } }</code> </pre> <br><p>  Each model turns into a presenter.  If you want, you can transfer the collection to another decorator to combine several objects into a single JSON. </p><br><p>  Thus, decorators and presenters are powerful tools that we have.  They are easy to write and easy to test.  Use them when it makes sense.  They can help you with refactoring. </p><br><p>  But that is not all.  It would be cool if you could call the present method for a particular model.  And if we had a helper that would allow us to wrap the model in a presenter. </p><br><p>  Well, let me introduce you to the <a href="https://github.com/davidhemphill/presenter">Hemp / Presenter</a> package.  He does all the things we talked about, plus everything he realizes the wishes I was talking about.  And all this is tested.  Try and tell me what you think of him.  Enjoy! </p><br><p>  <em>Original: <a href="http://davidhemphill.com/blog/2016/09/06/presenters-in-laravel">http://davidhemphill.com/blog/2016/09/06/presenters-in-laravel</a></em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/309942/">https://habr.com/ru/post/309942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309930/index.html">Arguments for function tree</a></li>
<li><a href="../309934/index.html">How to get a lot of server for little money: options for the earth and the cloud</a></li>
<li><a href="../309936/index.html">Overview of Node.js packages for parsing command line options</a></li>
<li><a href="../309938/index.html">We get rid of binary dependencies with composite assembly in Gradle 3.1</a></li>
<li><a href="../309940/index.html">Azure Active Directory now in the new ARM portal</a></li>
<li><a href="../309944/index.html">Useful properties of jitter</a></li>
<li><a href="../309948/index.html">IOS 10 security settings you should pay attention to</a></li>
<li><a href="../309954/index.html">Samsung Solid State Drives: Gaining Momentum</a></li>
<li><a href="../309956/index.html">5 classic personality types in business and how to work with each of them</a></li>
<li><a href="../309958/index.html">React.js: build an isomorphic / universal application from scratch. Part 1: build the stack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>