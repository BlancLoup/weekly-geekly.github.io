<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript to pdf</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The hour is not far when PDF documents can be fully displayed using Javascript . In this case, the reverse possibility, namely the use of Javascript i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript to pdf</h1><div class="post__text post__text-html js-mediator-article">  The hour is not far when PDF documents can be <a href="http://habrahabr.ru/blogs/firefox/131476/">fully displayed using Javascript</a> .  In this case, the reverse possibility, namely the use of Javascript in PDF documents, has existed for a very long time.  This will be discussed in this article. <br><a name="habracut"></a><br>  Any software contains some actively used functionality and a significant proportion of rarely used functionality.  You can figure out whether all the features of the operating system (or Microsoft Word, or your IDE), we use in our daily work or even use it at least once in a lifetime.  As a rule, not all. <br><br>  PDF format is no exception.  We are all accustomed to text and images in PDF documents, but this is only a small part of what can be used.  In particular, the PDF format includes various possibilities for creating documents with dynamic content depending on the reader and his actions.  One such feature is the use of javascript. <br><br>  Javascript to PDF is most often used for the following tasks: <ul><li>  To change the content of the document depending on certain events.  For example, hide part of the document when sending to print.  Or, when opening a document, automatically fill in part of the form fields. </li><li>  To limit the reader's actions.  For example, to validate input values ‚Äã‚Äãwhen filling out forms. </li></ul>  To allow PDF viewers to interpret Javascript code, a special <a href="http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/js_api_reference.pdf">Javascript API is</a> defined.  The API was originally developed only for the Adobe Acrobat family of products, but alternative viewers, as a rule, also support some basic subset of this API. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider a number of practical examples of using Javascript in PDF documents. <br><br><h3>  Hello world </h3><br>  Let's start the discussion of the topic with the traditional Hello World example.  This and the following examples use the C # language and the <a href="http://bitmiracle.com/pdf-library/">Docotic.Pdf</a> library for working with PDF documents.  A link to the source code with the code of all the examples is given at the end of the article. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> BitMiracle.Docotic.Pdf; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">JavascriptInPdf</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Demo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { PdfDocument pdf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PdfDocument(); pdf.OnOpenDocument = pdf.CreateJavaScriptAction(<span class="hljs-string"><span class="hljs-string">"app.alert(\", !\", 3);"</span></span>); pdf.Save(<span class="hljs-string"><span class="hljs-string">"Hello world.pdf"</span></span>); } } }</code> </pre> <br>  If you open a document created by this code in Adobe Reader, you will see something like the following: <br><br><img src="https://habrastorage.org/storage1/05e11037/bea90e13/63338c3a/efac93fc.png"><br><br>  What happens in the example?  The bottom line is <br><br><pre> <code class="cs hljs">pdf.OnOpenDocument = pdf.CreateJavaScriptAction(<span class="hljs-string"><span class="hljs-string">"app.alert(\", !\", 3);"</span></span>);</code> </pre> <br>  The PDF format includes support for actions ‚Äî these are actions that occur on a particular event.  For example, when in the table of contents in some PDF document we click on the link with the page number, a certain action is triggered to go to the corresponding page: <br><br><img src="https://habrastorage.org/storage1/d4aa4dbb/fe941b64/fc6328bd/ce7400f8.png"><br><br>  For Javascript, there is also an appropriate action.  We create it using the <i>PdfDocument.CreateJavaScriptAction</i> method, which is <i>passed</i> JS code as a parameter.  We attach the created action to the <i>OnOpenDocument</i> event that occurs when the viewer opens the document. <br><br>  Directly Javascript code looks like this: <br><br><pre> <code class="hljs objectivec">app.alert(<span class="hljs-string"><span class="hljs-string">", !"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre> <br>  The static <i>app</i> class is part of the Javascript API and provides a set of methods for interacting with the viewer application.  In particular, it contains several overloads of the <i>alert</i> method to display a modal dialog with a message.  In this example, an overload is used with the second optional parameter, the index of the dialog icon, the value 3 corresponds to the Status Icon. <br><br><h3>  From simple to complex </h3><br>  Consider a more realistic example. <br><br>  Many PDF documents describe some forms to fill out - this could be an agreement to open a bank deposit, a visa application form or a foreign country.  passports, vacation application, etc.  Quite convenient, since such a form can be filled directly in the viewer and saved or printed.  Authors of PDF documents containing forms can make it easier for the user to complete them using Javascript. <br><br>  Real documents often contain fields for entering the due date.  For example, it might look like this: <br><br><img src="https://habrastorage.org/storage1/8bfdf2e2/b47f4ec7/03770bbb/bf624824.png"><br><br>  In principle, creating a document, you can stop there.  However, you can go a little further and slightly simplify the task that fills - for example, setting the default date to the current one - in 99% of cases this is exactly what is needed. <br><br><h3>  Set the default date </h3><br>  C # code for creating fields for the date, as in the screenshot, in this case is not so interesting.  Consider only the part relating to Javascript.  It is necessary to set the current date in the fields when opening the document; this is done like this: <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dayField = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getField(<span class="hljs-string"><span class="hljs-string">"day"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dayField.value.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { dayField.value = util.printd(<span class="hljs-string"><span class="hljs-string">"dd"</span></span>, date); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMonth</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monthField = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getField(<span class="hljs-string"><span class="hljs-string">"month"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (monthField.value.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { monthField.value = util.printd(<span class="hljs-string"><span class="hljs-string">"date(ru){MMMM}"</span></span>, date, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yearField = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getField(<span class="hljs-string"><span class="hljs-string">"year"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (yearField.value.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { yearField.value = util.printd(<span class="hljs-string"><span class="hljs-string">"yyyy"</span></span>, date); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentDate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); setDay(now); setMonth(now); setYear(now); } setCurrentDate();</code> </pre> <br>  Compared to the previous example, the JS code has increased in volume, so using it directly in the C # line was inconvenient because of the need to escape quotes and insert line breaks.  Therefore, we put this code into resources, then the script will be used like this: <br><br><pre> <code class="cs hljs">pdf.OnOpenDocument = pdf.CreateJavaScriptAction(Resources.SetCurrentDate);</code> </pre> <br>  As a result, when opening a document, we will see something like the following picture: <br><br><img src="https://habrastorage.org/storage1/d5e066f8/ea1c7cb1/18c026df/c5a3d190.png"><br><br>  Pay attention to the code for setting the month - we use the specific overload of the method <i>util.printd</i> to output the localized month. <br><br><pre> <code class="hljs pgsql">monthField.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = util.printd("date(ru){MMMM}", <span class="hljs-type"><span class="hljs-type">date</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  This gives excellent results in Adobe Reader, but, unfortunately, it is not guaranteed that other viewers will correctly support such specific designs.  When designing a document that needs to be considered.  It may be worth replacing this code with a more verbose one (independent getting the name of the month in the right case), but supported by a large number of viewers. <br><br>  In this example, it is also important that the values ‚Äã‚Äãare set only to empty fields.  Without these checks, a situation may arise when the user saves the completed form, and when opening such a saved form, the date will be changed to the current one. <br><br><h3>  Validation of Input Values </h3><br>  If you still need to change the date when filling out the form, it makes sense to allow entering only numbers in the fields for the day and year.  Use for this the following Javascript code: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateNumeric</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">event</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validCharacters = <span class="hljs-string"><span class="hljs-string">"0123456789"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.change.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (validCharacters.indexOf(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.change.charAt(i)) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { app.beep(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">event</span></span>.rc = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } validateNumeric(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>);</code> </pre> <br>  In the C # code, we use the <i>OnKeyPress</i> event of the controls for checking the entered character: <br><br><pre> <code class="cs hljs">PdfJavaScriptAction validateNumericAction = m_document.CreateJavaScriptAction(Resources.ValidateNumeric); dayTextBox.OnKeyPress = validateNumericAction; yearTextBox.OnKeyPress = validateNumericAction;</code> </pre> <br>  After that, in the fields for the day and year it will be impossible to enter any character other than a digit.  Paste string from the clipboard that contains an invalid character will also fail. <br><br><h3>  Sync field values </h3><br>  It often happens that the same information in the document must be specified several times.  And in the case of PDF documents using Javascript, you can save the user from repeating the same actions. <br><br>  Suppose there is a document of the following form: <br><br><img src="http://habrastorage.org/storage1/5bf15417/1f4c9e75/baccc318/9a76dcb2.png"><br><br>  We modify it so that when one of the fields changes with the full name, the other is updated. <br><br>  We use a simple Javascript function: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">synchronizeFields</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sourceFieldName, destinationFieldName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getField(sourceFieldName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> destination = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getField(destinationFieldName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; destination != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { destination.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = source.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br>  And also the following C # code: <br><br><pre> <code class="cs hljs">PdfDocument pdf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PdfDocument(‚ÄúNames.pdf‚Äù); pdf.SharedScripts.Add( pdf.CreateJavaScriptAction(Resources.SynchronizeFields) ); pdf.GetControl(<span class="hljs-string"><span class="hljs-string">"name0"</span></span>).OnLostFocus = pdf.CreateJavaScriptAction(<span class="hljs-string"><span class="hljs-string">"synchronizeFields(\"name0\", \"name1\");"</span></span>); pdf.GetControl(<span class="hljs-string"><span class="hljs-string">"name1"</span></span>).OnLostFocus = pdf.CreateJavaScriptAction(<span class="hljs-string"><span class="hljs-string">"synchronizeFields(\"name1\", \"name0\");"</span></span>); pdf.Save(<span class="hljs-string"><span class="hljs-string">"NamesModified.pdf"</span></span>);</code> </pre> <br>  Now if any of the textboxes lose focus, the value of the other will be updated.  Pay attention to the technique that was not met before - general Javascript code is placed in the <i>PdfDocument.SharedScripts</i> collection, and then we are able to call a function defined in the general code from specific actions. <br><br><h3>  Summarize </h3><br>  Javascript can be used not only in web development, but also in areas such as the design of PDF documents.  A little extra effort and PDF documents created will delight the reader no less than a program with a convenient and thoughtful interface - a sophisticated user. <br><br>  And yet such opportunities are secondary compared to the contents of the document, so the practical value of Javascript in PDF is not so high.  In addition, a number of problems are associated with this: <ul><li>  It is more difficult to write Javascript code than in the case of conventional web development.  You need to create and open a document to check the correctness of the written code. </li><li>  Javascript is fully supported only by Adobe viewers.  In alternative viewers, support is significantly limited or absent altogether. </li><li>  Javascript can be disabled in the PDF viewer. </li><li>  Theoretically, the execution of Javascript scripts in the document is unsafe, and various vulnerabilities are periodically detected. </li></ul>  Armed with the described information, do not be surprised if the PDF document that opens one day offers to play chess, and at this time will quietly remove Foxit Reader from the system;) <br><br>  Download the code of examples from the article <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/132611/">https://habr.com/ru/post/132611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132601/index.html">It is urgent to make a news portal with an integrated social network and a large load. On what?</a></li>
<li><a href="../132602/index.html">SmartNut is a convenient SaaS system of the class Service Desk</a></li>
<li><a href="../132603/index.html">Released Android 4.0 sources</a></li>
<li><a href="../132606/index.html">Setting tasks when developing an online store, or how not to order an unnecessary project</a></li>
<li><a href="../132609/index.html">Background script execution in PHP without crontab</a></li>
<li><a href="../132614/index.html">Shared directory on a Linux machine, v2</a></li>
<li><a href="../132615/index.html">Copyright and 3D printing</a></li>
<li><a href="../132617/index.html">Naive young man in the face of the IT paradox</a></li>
<li><a href="../132619/index.html">Arduino in the coffee machine</a></li>
<li><a href="../132620/index.html">Electronic bear pillow helps to stop snoring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>