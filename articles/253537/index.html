<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application Virtualization with Microsoft App-V for the Undecided</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Server virtualization has long been firmly established in our lives. Its advantages are undeniable and widely used in various business areas. However,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application Virtualization with Microsoft App-V for the Undecided</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/7ec/528/25e/7ec52825eb4348d5b38022b08dbf61f4.jpg" alt="image"><br><br>  Server virtualization has long been firmly established in our lives.  Its advantages are undeniable and widely used in various business areas.  However, application virtualization is still a ‚Äúnovelty‚Äù in the Russian corporate market.  Many are just eyeing this technology, which has already established itself well in the world.  Why do many of the largest foreign manufacturers and financial organizations transfer the work of entire offices to virtualized applications?  The answer is simple - because it is profitable. <br><br>  A little later, we will list several key advantages that virtualization technology provides and which significantly reduce the cost of ownership of the application, and first consider the following scenario: the company moves from one version of a critical application to another. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such a transition is often a difficult and painful process.  New file formats, new scheme of interaction with the rest of the software.  It may be that some of the equipment supports only the old version and cannot be replaced quickly.  Inlays are inevitable when a new application is introduced into the work environment, sometimes you even have to roll back to the old version to avoid business downtime.  Specialists in our company, providing <a href="http://icl-services.com/services/upravlenie-prilozheniyami/">support for</a> customer <a href="http://icl-services.com/services/upravlenie-prilozheniyami/">applications</a> , these problems are familiar not by hearsay.  With the help of virtualization, even for such a large and complex package like Microsoft Office, it is possible to significantly simplify the process ‚Äî run different versions simultaneously under one user, easily change configuration if necessary, add or remove components ‚Äî all without long downtime. <br><br><img src="https://habrastorage.org/files/9af/ad3/137/9afad31379a84cc5836c107b96c7c774.jpg" alt="image"><br><br>  Let's take a closer look at how technology works, and, at the same time, we list the main benefits of application virtualization. <br><br>  <b>- Applications are not installed on the computer through the installer.</b> <br>  In the process of "virtualization" the program is installed on a clean OS image and during the installation all changes in the registry and file system are recorded in a special package.  This package, which is, in fact, a deployed application, is delivered to the user's computer and runs in its isolated environment without leaving any traces in the operating system itself.  This environment is called a sandbox (sandbox) or a virtual bubble (virtual bubble).  At the same time, the application launched in such a bubble ‚Äúsees‚Äù ordinary programs and can interact with them, while the ‚Äúinvisible‚Äù one for them remains. <br><br>  <b>- Isolation of applications from each other.</b> <br>  Since each virtual application runs in its own, separate from other environment, it allows you to completely eliminate conflicts associated with overwriting registry branches or replacing files with several independent programs.  Significantly reduces, and, more precisely, the costs of joint testing of several, sometimes very large applications become unnecessary.  If necessary, virtual applications can be combined into groups and then they can interact with each other.  But even in this case, the compatibility check needs to be carried out only once and in the future to be sure of the stable functioning of the programs. <br><br>  <b>- Ability to simultaneously run different versions of the same application on the same computer.</b> <br>  Since virtual applications are isolated from each other, nothing prevents virtualizing different versions of the same program and running them on the same computer under the same account.  Both will work.  Such a scenario is quite common, as we mentioned earlier, when switching from the old software version to the new one or in classrooms and test laboratories. <br><br>  <b>- Ability to simultaneously launch one application by several users,</b> even in the case when, during a typical installation, this leads to an error of resource sharing. <br><br>  <b>- There is no need to provide users with the rights of local administrators or elevated access to the registry for non-standard applications.</b> <br>  In an isolated virtual bubble, the application has full access to all files and registry keys (in earlier versions of App-V there were restrictions, but they were fixed in recent editions).  Therefore, there is no need to run a virtual application with elevated privileges, even if it was previously required.  This increases the safety of the working environment. <br><br>  <b>- Instant availability of new applications to the right groups of users, managed through Active Directory.</b> <br>  In the deployed App-V infrastructure, it is enough to associate a group of users to a virtual application, so that after a specified time interval its shortcuts appear to users in the Start menu.  And control is exercised through the Web-interface from any browser.  In the same way, the application can be forbidden to be launched if necessary.  And all this does not require a computer restart and idle waiting for installation. <br><br>  - <b>Significant reduction in time to restore the working environment</b> in case of failure. <br><br>  <b>- Simplify the management of working systems images.</b> <br>  When applications are virtualized, it is no longer necessary to have OS images for different groups of users, each with its own individual set of software.  Sometimes it is enough to restrict one ‚Äúvanilla‚Äù way, and assign applications using Active Directory groups. <br><br>  Here it is necessary to mention one more scenario, which is extremely relevant at the present time - <a href="http://icl-services.com/services/migratsiya/">migration</a> from one operating system to another.  Many postpone this difficult process to the last and fears are understandable.  Compatibility issues, tremendous burden on the IT department, serious risks in the event of business downtime.  Our company has already completed the migration process in the infrastructure of 8 major European customers, and we can safely say that application virtualization drastically reduces the project time frame.  Once you have set up applications to work in both 64-bit and 32-bit environments, making sure they are compatible and working across different platforms, you can quickly set up the final user environment of any complexity when changing the OS. <br><br>  Now we will list what is needed in order to deploy the structure of support for virtual applications using the example of Microsoft Application Virtualization (App-V) 5.0. <br><br>  Licensing: If you already have Remote Desktop Services (RDS) client licenses, then you can already use App-V.  Also, App-V licenses are included in the Microsoft Desktop Optimization Pack (MDOP).  This is a set of desktop technologies available as a subscription to Software Assurance members. <br><br>  Having decided on the licenses, let's see how it works. <br><br><ol><li>  Applications need to be specially packaged.  The App-V Sequencer program is used for this, and the packaging process is called sequencing. </li><li>  Prepared applications should be placed on a network folder and provide users with read access. </li><li>  Install the App-V Client application on user devices (or terminal server).  It is necessary for downloading virtual packages from a network drive and launching them. </li></ol><br><br><img src="https://habrastorage.org/files/530/2e7/a27/5302e7a275814c0ba3a48880bc136112.jpg" alt="image"><br><br>  Let us consider each item in more detail. <br><br>  Preparing a virtual package will require a typical clean system image used in your infrastructure.  Install the App-V Sequencer application on it.  Ideally, install the Sequencer on a computer running as a virtual machine and create a ‚Äúsnapshot‚Äù immediately after installation.  This makes it easy to return the computer where the Sequencer runs to a ‚Äúclean‚Äù state before virtualizing the next application. <br><br>  The running Sequencer runs in helper mode, prompting you first to specify the package name, select the directory where the installation will be performed, then tracks and saves the changes in the registry and file system that are made during the installation of the application. <br><br><img src="https://habrastorage.org/files/cb7/8c6/9a1/cb78c69a1bb543d2a0454e9101b52919.jpg" alt="image"><br><br>  App-V 5.0 does not require the creation of a separate disk for virtual applications, the installation is done in the default directory.  However, the primary virtual application directory (PVAD) in this window can be selected in different ways.  This can be either the installation directory of the program, or one of its subdirectories, or even some non-existent folder.  Depending on this choice, the organization of the files inside the virtual package changes.  In this article, we will not dwell on this point in detail, but from our experience, I would like to note that sometimes the right choice of PVAD at the first stage can eliminate many problems of functionality in the future, especially for older applications. <br><br>  If a reboot is required during installation, you can do it, the changes will be recorded and the process will continue correctly from the interrupted moment.  Parallel (SxS) library assemblies (for example, Microsoft Visual C ++) will be processed correctly, they are no longer necessary to install them into the system image. <br><br><img src="https://habrastorage.org/files/d88/b49/218/d88b49218ad44934a29d455c3a2fe870.jpg" alt="image"><br><br>  The finished package is a set of files: <br><br><img src="https://habrastorage.org/files/dd7/b7a/5a6/dd7b7a5a605b490a94627fe73f3ffb02.jpg" alt="image"><br><br>  <b>report.xml file</b> - a report file in which all warnings and errors that occurred during the sequencing process are saved.  It can be used to diagnose and solve problems. <br><br>  <b>The .msi file</b> is a Windows Installer file created by the sequencer to install a virtual package through group policies or using deployment systems. <br><br>  <b>The .appv file</b> is the file of the virtual application itself.  In App-V 5.0, this file is created in the open zip format and can be opened with any archiver if necessary.  Restrictions on file size, unlike previous versions, no.  Unfortunately, it is impossible to make changes directly without using the sequencer. <br><br>  <b>Deployment configuration file, User configuration file</b> - configuration files in XML format, define the deployment parameters on target computers.  You can make changes to them without running the sequencer in any text editor.  This greatly simplifies the fine-tuning of the application.  Here, in particular, the parameters of shortcuts, file associations, environment variables are set, registry keys change. <br><br>  For some programs, it is not possible to provide an exact match of the functionality of a virtual package of a locally installed version using only a sequencer.  In this case, you will have to add a script that performs the missing operations.  User script files are added to the package, and their call is configured in the XML configuration files.  For example: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PublishPackage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Path</span></span></span><span class="hljs-tag">&gt;</span></span>powershell.exe <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Path</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Arguments</span></span></span><span class="hljs-tag">&gt;</span></span>.\Scripts\InstallDriver.ps1 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Wait</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">RollbackOnError</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Timeout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"120"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PublishPackage</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  As you can see from the syntax, the script can be written in any language in which you prefer to work.  Our engineers mainly use Powershell, VBS and batch to write scripts. <br><br>  Once the package is prepared, copy it to a network folder, give users read access. <br>  Next, you need to install App-V Client on user computers and ... everything! <br>  In the simplest case, nothing more is required.  Virtual packages can be distributed in several ways: <br><br><ul><li>  through the installer .msi, created at the stage of sequencing.  For example, using group policies; </li><li>  using your distribution system (Microsoft SCCM, Altiris); </li><li>  using Powershell 3.0.  In general, the Microsoft App-V 5.0 product is very closely integrated with Powershell and it is very convenient.  Any tasks related to the distribution and maintenance of packages can be automated using scripts. </li></ul><br><br><img src="https://habrastorage.org/files/22a/9b7/252/22a9b72526e64a62ac056ecb3f8d7bf9.jpg" alt="image"><br><br>  So, in the simplest case, to use Microsoft App-V, you only need the Sequencer on the IT engineer machine to prepare the packages and the App-V Client on the user's machine to run them.  However, all the benefits will be available only with the full deployment of the infrastructure of App-V. <br><br>  To do this, you must install the following components: <br><br><ul><li>  Management Server.  Provides basic management functions for the App-V 5.0 infrastructure; </li><li>  Publishing Server.  Provides hosting and streaming features for virtual applications; </li><li>  SQL database management. </li></ul><br>  Additionally, you can also install a report server and SQL database for it. <br><br>  All roles are installed by a single file (APPV_SERVER_SETUP.EXE): <br><br><img src="https://habrastorage.org/files/909/732/109/90973210969f4dd2bf16e60454e3b065.jpg" alt="image"><br><br>  Microsoft provides separate SQL scripts for creating databases in case your organization is responsible for a separate team of administrators.  The installation phase also indicates the AD group, which will be granted permissions to control the App-V 5.0 environment. <br><br>  After installation, you must configure custom App-V clients.  Specify the address of the publication server and the parameters for updating information about package changes.  You can do this using Powershell. <br><br>  Further, access to the console and management is carried out using a browser: <br><br><img src="https://habrastorage.org/files/692/1b4/fdd/6921b4fddd484858b0f1339698d908fe.jpg" alt="image"><br><br>  Add a package specifying the network path: <br><br><img src="https://habrastorage.org/files/1c9/3fe/956/1c93fe9564cd41ee84c6a9e86215b127.jpg" alt="image"><br><br>  Assign an AD user group and publish the package: <br><br><img src="https://habrastorage.org/files/53d/8c7/d3a/53d8c7d3aceb4f329e9e452e92ca444d.jpg" alt="image"><br><br>  After that, after some time, the user will have application shortcuts and corresponding file associations.  Software is ready to use. <br><br>  By default, when the App-V application is published to a user, the package files are copied to the% PROGRAMDATA% folder.  However, the client can be switched to the Shared Content Store mode.  In Powershell, the command will look like this: <br><br><pre> <code class="xml hljs">Set-AppvClientConfiguration -SharedContentStoreMode 1</code> </pre><br><br>  In this case, only NTFS links to the network location of files will be created on the user's disk, which will significantly save disk space.  Of course, this solution requires preliminary testing and is rarely used in its pure form, but in our implemented projects there are examples of the application of this technology in customer environments. <br><br>  If several programs must interact with each other, they can be grouped into the ‚ÄúConnection Groups‚Äù section.  In this case, their virtual environments are merged, files and the registry are made available to all members of the group.  It will take some experience to properly form such groups, identify program dependencies and set their priority.  Sometimes we recommend not to virtualize individual components, but install them directly into the system image.  These can be ODBC drivers or database connection settings. <br><br>  It may give the impression that virtualization is the saving solution for all occasions.  Alas, like any technology, it has its limitations.  In particular, using Microsoft App-V, drivers or services that start at system startup cannot be virtualized (see the <a href="http://download.microsoft.com/download/F/7/8/F784A197-73BE-48FF-83DA-4102C05A6D44/App-V%25205.0%2520Sequencing%2520Guide.docx">Virtualization Guide in Microsoft Application Virtualization 5.0</a> ).  Like any technology, App-V is evolving and many limitations have already been overcome.  For example, virtualization of the context menu of the application in Explorer and various ActiveX extensions is no longer a problem.  By the way, this development in the case of App-V is also sometimes a challenge.  Services and patches in addition to solving problems introduce a significant change in functionality and are, in fact, a new version of technology.  However, with more than a thousand virtualized applications, we <a href="http://icl-services.com/services/upravlenie-prilozheniyami/">help</a> our customers in the shortest possible time to implement new functions in their working environment without disrupting business processes. <br><br>  So, we looked at the benefits of application virtualization.  Briefly, using the example of Microsoft App-V, we got acquainted with the main stages of creating and publishing virtual packages.  Of course, this is not the only virtualization tool.  Not to mention Citrix XenApp, VMware ThinApp, Novell Zenworks.  The choice depends on the needs of your business.  But based on the experience of supporting our customers who have implemented the transition to a virtual environment, we can formulate a transition strategy like this: if an application can be virtualized, it needs to be virtualized.  Pros are undeniable. <br><br>  <b>Useful links:</b> <br>  <a href="https://technet.microsoft.com/ru-ru/library/jj713487.aspx">Microsoft Application Virtualization 5 Administrator's Guide</a> <br>  <a href="http://blogs.technet.com/b/appv/">Official Microsoft App-V Developer Blog</a> <br>  <a href="http://www.microsoftvirtualacademy.com/training-courses/mdop-application-virtualization-deep-dive">Microsoft Virtualization Free Course</a> <br><br>  By <a href="http://habrahabr.ru/users/vv_m/" class="user_link">vv_m</a> </div><p>Source: <a href="https://habr.com/ru/post/253537/">https://habr.com/ru/post/253537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253521/index.html">How to easily decrypt TLS traffic from the browser in Wireshark</a></li>
<li><a href="../253523/index.html">Gaming Industry News Digest: February-March</a></li>
<li><a href="../253527/index.html">Transfer of the project to Unity 5. Shaders and light</a></li>
<li><a href="../253533/index.html">Infographics "Traveling money: back and forth in a few seconds"</a></li>
<li><a href="../253535/index.html">How to improve the monetization of games using the CDN</a></li>
<li><a href="../253539/index.html">Store design: multi-brand, personalization, microformats, integration with 1C and marketplaces</a></li>
<li><a href="../253545/index.html">How to catch what is not. Part one. Terms and Definitions</a></li>
<li><a href="../253547/index.html">Akka.NET Bootcamp</a></li>
<li><a href="../253549/index.html">Memo: Five-minute UX guide from Squarespace and MailChimp</a></li>
<li><a href="../253551/index.html">Bolid integration in 1C or how we tamed the access control system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>