<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram - bot | Full menu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sooner or later, in the life of the developer of telegram bots, a clear realization comes that everything is perishable, you need to create more or le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram - bot | Full menu</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6c/b90/8bf/c6cb908bf54852219fe0026aa89e8409.jpg" alt="image"></div><br>  Sooner or later, in the life of the developer of telegram bots, a clear realization comes that <s>everything is perishable,</s> you need to create more or less full menus for bots. <br><br>  Because: <br><br>  A) it is convenient <br>  B) Convenient for customization * 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  Nobody, of course, canceled the "/ team", but still </blockquote><a name="habracut"></a><br><h3>  The essence of the task </h3><br>  At first glance, the task is simple, but no matter how.  The whole <i>problem is</i> in the <a href="https://core.telegram.org/bots/api">API</a> itself <a href="https://core.telegram.org/bots/api">, namely in the Update object</a> . <br><blockquote>  A little more detail: Using the getUpdate method - you get the Update object, it‚Äôs logical!  So, this object contains a lot of useful things, including information about the message, but only about the latter.  That's the catch. </blockquote>  Proceeding from the above, the most pleasant conclusion follows: processing requests for a webhuk, without storing additional data, does not shine for us <br><br>  Well, wash and get down to work. <br><br><h3>  <s>Writing</s> Learning Code </h3><br>  In his practice, especially for this task, a small class was developed. <br><br>  NEW!  Now on <a href="https://github.com/s0d3s/tg-long-req">githab</a> ) <br><br>  If you can not wait, you can immediately go to the repository, there is a digression. <br><br><h4>  Continue </h4><a name="RequestForInquiry"></a><br>  The class creates a <abbr title="I apologize for the abbreviation. This means that the class creates a file that later reports the existence of the request.">query request</abbr> <br><blockquote>  A little about the structure: Go through the menu by creating a <a href="https://habr.com/ru/post/459604/">request for a request</a> .  You create it in the right place, and the next time the <abbr title="Not to be confused with a loser!">user</abbr> accesses, bam, and he is in the "menu". </blockquote>  I agree, the concept, after that, did not become clear ... I will try to clarify.  To understand, you need to go to a certain level of abstraction, that is, imagine that the whole structure of the bot consists of different menus between which the user switches (you can draw an analogy with the android activation).  When a bot is activated, the user is in the ‚Äúinitial menu‚Äù, from which he can go, say, to the ‚ÄúSettings‚Äù, ‚ÄúInformation‚Äù menu, and so on. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ac/c6b/9e8/8acc6b9e878f93bba2862a004a007507.gif" alt="image"><br><br>  And so, the structure of the bot changes a little, if briefly: <br><br>  First we check if the request exists: <br><br>  YES) Run the "handler" requests <br>  NO) We remain in the "initial menu", we verify the user's answer with the available commands. <br><br>  * This is a very simplified version, because of this it knocks down the table.  With examples it will become easier. <br><br><h4>  Continue ..? </h4><br>  Let's start with the installation.  To install, use the <a href="https://getcomposer.org/">compser-</a> th (create ‚Äúcomposer.json‚Äù, then copy the lines below into it, read more in off-docks) <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"require"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"s0d3s/tg-long-req"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=1"</span></span> } }</code> </pre> <br>  and connect <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>(<span class="hljs-string"><span class="hljs-string">'path/to/autoload.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">TgLongReq</span></span>\<span class="hljs-title"><span class="hljs-title">TgLongReq</span></span>;</code> </pre> <br>  <b>OR we</b> connect manually (download to the folder with the project) <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span>(<span class="hljs-string"><span class="hljs-string">'TgLongReq.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">TgLongReq</span></span>\<span class="hljs-title"><span class="hljs-title">TgLongReq</span></span>;</code> </pre> <br>  <b>CREATE OBJECT</b> <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SOMTH</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($tg_res, $long_req_obj, $tab_key)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EveryForEveryone"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $BOT_FUNC_ASSO_TAB = arrray(<span class="hljs-string"><span class="hljs-string">"ECHO_SOMETHING"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"SOMTH"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -      ,  -  -\  $tgreq = new TgLongReq ( $usr_id, //(STR) -id  $BOT_FUNC_ASSO_TAB, //(ARRAY) $BOT_req_dir , //[OPT](STR) $tapi, //[OPT](ANY*) $result //[OPT](ANY**) ); // *  ,    $this-&gt;tg_api // **  ,     </span></span></code> </pre><br>  <b>CREATE A REQUEST, CHECK HIS AVAILABILITY AND START A TREATMENT</b> <br><br><pre> <code class="php hljs">$tgreq -&gt; ReqCreate(<span class="hljs-string"><span class="hljs-string">'SOMTH'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//  if($tgreq -&gt; ReqCheck()){ // ,   ,       $tgreq -&gt; ReqHand();// ,   }</span></span></code> </pre><br>  <b>HANDLING AND GETTING TIME DATA</b> <br><br>  save: <br><br><pre> <code class="php hljs">$tgreq -&gt; SaveToTemp(<span class="hljs-string"><span class="hljs-string">'HiHabr'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//  ,    json-</span></span></code> </pre><br>  restore: <br><br><pre> <code class="php hljs">$tgreq -&gt; GetFromTemp(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);<span class="hljs-comment"><span class="hljs-comment">//  -    ,    // ,    SaveToTemp()</span></span></code> </pre><br>  <b>RESULT FUNCTION</b> <br><br>  It should be noted that each [except for the GetFromTemp (), GetError (), ReqCheck () and constructor] functions, returns an array: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*$function_result = array( 'func_res' =&gt;   'error' =&gt;true,    'err_discript' =&gt; ,     ); */</span></span></code> </pre><br>  <b>ERRORS</b> <br><br>  Each function [with the exception of GetFromTemp (), GetError (), ReqCheck () and the constructor], set an error in case of failure, which can be checked with: <br><br><pre> <code class="php hljs">$error_arr = $tgreq -&gt; GetError(); <span class="hljs-comment"><span class="hljs-comment">/*$error_arr = array( 'error' =&gt;true,    'err_discript' =&gt; ,     ); */</span></span></code> </pre><br><h3>  All gathered in the way! </h3><br>  We assume that you are minimally familiar with writing telegram bots, if not -% <a href="https://habr.com/ru/post/347482/">article</a> %, read up to the item " <u>Writing a bot code</u> " - the first link in google by sabzh, you can search for yourself, the main thing is to find out how to create a bot in tg itself, and configure him to your server.  If it is interesting, I will write an article on how to set up a webhost for working with a local server (~ NEW! Solution to bypass the ‚Äúproblem‚Äù with https). <br><br>  Let's bring this example to life.  We divide the space into two files ‚Äúbotmain.php‚Äù (main menu and processing) and ‚Äúvarfunc.php‚Äù (request processing functions).  For ease of example, we will use <a href="https://github.com/irazasyed/telegram-bot-sdk">telegram-bot-sdk</a> (a well-made and well-designed project, convenient for small projects, thanks to the creator;). <br><br>  In general, <i>listing</i> : <br><br><div class="spoiler">  <b class="spoiler_title">composer.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"require"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"irazasyed/telegram-bot-sdk"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"s0d3s/tg-long-req"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"php"</span></span>:<span class="hljs-string"><span class="hljs-string">"&gt;=7.1"</span></span> } }</code> </pre><br></div></div><br>  Next in the project folder, open the console and ... <br><br><pre> <code class="bash hljs">&gt;composer install ...</code> </pre><br>  <b>UPD</b> : In the framework of Habr, the source code becomes unreadable, without global editing.  Because of this, if you are interested in examples, I suggest you go to the githab. <br><br>  <a href="https://github.com/s0d3s/tg-long-req/tree/master/exmp/def_menu">Original</a> |  <a href="https://github.com/s0d3s/tg-long-req/tree/master/exmp/def_sample">Simplified version</a> . <br><br><h4>  Conclusion </h4><br>  In the end I can only say that this is not the only possible solution to this problem, but from the point of view of optimality for ME it is a favorite. </div><p>Source: <a href="https://habr.com/ru/post/459604/">https://habr.com/ru/post/459604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459596/index.html">iOS digest number 9 (June 28 - July 11)</a></li>
<li><a href="../459598/index.html">SELinux Frequently Asked Questions (FAQ)</a></li>
<li><a href="../4596/index.html">Social network as a way to improve yourself</a></li>
<li><a href="../45960/index.html">"I do not minus" or the value of diversity</a></li>
<li><a href="../459602/index.html">Embed Lua interpreter in the project for the microcontroller (stm32)</a></li>
<li><a href="../459606/index.html">Distributed social networks</a></li>
<li><a href="../459610/index.html">These dangerous routers: the most large-scale hacks of recent network equipment and ways to protect</a></li>
<li><a href="../459612/index.html">How Qualcomm has ripped off the mobile industry for almost 20 years in a row.</a></li>
<li><a href="../459614/index.html">Utko-robot muddies the water in the rice fields</a></li>
<li><a href="../459616/index.html">MIPT Opens the First Advanced Master Program in Russia in Computer Science and Software Engineering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>