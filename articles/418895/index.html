<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learning Artificial Intelligence to play the game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear reader! 

 In this article, we will develop a neural network that will be able to play a game specially created for it at a good level....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learning Artificial Intelligence to play the game</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear reader! <br><br>  In this article, we will develop a neural network that will be able to play a game specially created for it at a good level. <br><br><img src="https://github.com/Ivan753/Learning/blob/master/ii_r.gif?raw=true">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Note: this article does not explain the term " <u>neural network</u> " and everything connected with it, nor does it provide basic information about <u>network training using the tracing method</u> .</i>  <i>We recommend briefly reading these concepts before reading the article.</i> <br><a name="habracut"></a><br><h2>  Start: game rules description </h2><br>  <b>The goal</b> is to catch as many circles with a green rim as possible, avoiding circles with red. <br><cut></cut><br>  <b>Conditions:</b> <br><cut></cut><br><ul><li>  Red circles flies onto the field twice as many as green ones; </li><li>  The green circles remain within the field, the red ones fly out and are eliminated; </li><li>  Green and red circles can collide and repel with their own kind; </li><li>  Player - yellow ball on the screen, can move within the field. </li></ul><br>  After contact, the ball disappears, and the player receives the appropriate points. <br><cut></cut><br><h2>  Next: design AI </h2><br><h3>  The receptors </h3><br>  In order for the AI ‚Äã‚Äãto be able to decide where to move the player, you need to first obtain environmental data.  To do this, create special <i>scanners</i> , which are straight lines.  The first scanner is located at an angle of 180 degrees with respect to the lower boundary of the field. <br><cut></cut><br>  There will be 68 of them: the first 32 react to bombs (red circles), the next 32 react to apples (green circles), and the last 4 receive data on the finding of field borders relative to the player.  Let us call these 68 scanners the <i>input neurons of the</i> future neural network (receptor layer). <br><cut></cut><br>  The length of the first 64 scanners is 1000px, the remaining 4 correspond to dividing the field in half according to the corresponding symmetry face <br><img src="https://habrastorage.org/webt/xo/ae/fg/xoaefgbh6yrowfbpqpvrrf2sev0.png" alt="image">  Sector (1/4) of AI scope <br><img src="https://habrastorage.org/webt/ga/fw/cl/gafwcl5ji8pot9v-roos8anxsk0.png" alt="image"><br><cut></cut><br>  In the picture: input neurons receiving values ‚Äã‚Äãfrom scanners. <br>  Values ‚Äã‚Äãon scanners are normalized, i.e.  is brought to the range [0, 1], and the closer the object crossing the scanner is to the player, the greater the value transmitted to the scanner. <br><cut></cut><br><div class="spoiler">  <b class="spoiler_title">Algorithm for data acquisition by scanners and its implementation on JS</b> <div class="spoiler_text">  So, the scanner is straight.  We have the coordinates of one of its points (player's coordinates) and the angle relative to the OX axis; we can get the second point using the trigonometric functions sin and cos. <br><cut></cut><br>  From here we obtain the directing vector of the line, and therefore we can construct the canonical form of the equation of this line. <br><cut></cut><br>  To get the value on the scanner, you need to see if some ball intersects this line, which means you need to present the equation of the line in a parametric form and substitute all this into the equations of a circle, successively for each circle for the field. <br><cut></cut><br>  If we bring this substitution to a general form, we get a parametric equation for a, b and c, where these variables are the coefficients of the quadratic equation, starting with a square, respectively. <br><cut></cut><br>  We offer the reader to familiarize yourself with this algorithm in more detail by using the simplest definitions of linear algebra <br>  Below is the scanner code. <br><cut></cut><br><pre><code class="javascript hljs">Ball.scaners: { <span class="hljs-comment"><span class="hljs-comment">// length: 1000, i: [], //   get_data: function(){ //Ball.scaners.get_data /     var angl = 0; var x0 = Ball.x, var y0 = Ball.y; var l = Ball.scaners.length; for(let k = 0; k &lt; 32; k++){ x1 = l*Math.cos(angl), y1 = l*Math.sin(angl); Ball.scaners.i[k] = 0; for(i = 0; i &lt; bombs.length; i++){ if(((k &gt;= 0) &amp;&amp; (k &lt;= 8) &amp;&amp; (bombs[i].x &lt; x0) &amp;&amp; (bombs[i].y &lt; y0)) || ((k &gt;= 8) &amp;&amp; (k &lt;= 16) &amp;&amp; (bombs[i].x &gt; x0) &amp;&amp; (bombs[i].y &lt; y0)) || ((k &gt;= 16) &amp;&amp; (k &lt;= 24) &amp;&amp; (bombs[i].x &gt; x0) &amp;&amp; (bombs[i].y &gt; y0)) || ((k &gt;= 24) &amp;&amp; (k &lt;= 32) &amp;&amp; (bombs[i].x &lt; x0) &amp;&amp; (bombs[i].y &gt; y0))){ //    var x2 = bombs[i].x, y2 = bombs[i].y; var p = true; //    var pt = true; //     var t1, t2; var a = x1*x1 + y1*y1, b = 2*(x1*(x0 - x2) + y1*(y0 - y2)), c = (x0 - x2)*(x0 - x2) + (y0 - y2)*(y0 - y2) - bombs[i].r*bombs[i].r; //------------------------------    if((a == 0) &amp;&amp; (b != 0)){ t = -c/b; pt = false; } if((a == 0) &amp;&amp; (b == 0)){ p = false; } if((a != 0) &amp;&amp; (b != 0) &amp;&amp; (c == 0)){ t1 = 0; t2 = b/a; } if((a != 0) &amp;&amp; (b == 0) &amp;&amp; (c == 0)){ t1 = 0; pt = false; } if((a != 0) &amp;&amp; (b == 0) &amp;&amp; (c != 0)){ t1 = Math.sqrt(c/a); t2 = -Math.sqrt(c/a); } if((a != 0) &amp;&amp; (b != 0) &amp;&amp; (c != 0)){ var d = b*b - 4*a*c; if(d &gt; 0){ t1 = (-b + Math.sqrt(d))/(2*a); t2 = (-b - Math.sqrt(d))/(2*a); } if(d == 0){ t1 = -b/(2*a); } if(d &lt; 0){ p = false; } } //----------------------------------- if(p == true){ if(pt == true){ let x = t1*x1 + x0; let y = t1*y1 + y0; let l1 = Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2); x = t2*x1 + x0; y = t2*y1 + y0; let l2 = Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2); if(l1 &lt;= l2){ Ball.scaners.i[k] += 1 - l1/(l*l); }else{ Ball.scaners.i[k] += 1 - l2/(l*l); } }else{ let x = t1*x1 + x0; let y = t1*y1 + y0; Ball.scaners.i[k] += 1 - (Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2))/(l*l); } }else{ Ball.scaners.i[k] += 0; } }else{ continue; } } angl += Math.PI/16; } //!---------------  for(k = 32; k &lt; 64; k++){ x1 = l*Math.cos(angl), y1 = l*Math.sin(angl); Ball.scaners.i[k] = 0; for(i = 0; i &lt; apples.length; i++){ if(((k &gt;= 32) &amp;&amp; (k &lt;= 40) &amp;&amp; (apples[i].x &lt; x0) &amp;&amp; (apples[i].y &lt; y0)) || ((k &gt;= 40) &amp;&amp; (k &lt;= 48) &amp;&amp; (apples[i].x &gt; x0) &amp;&amp; (apples[i].y &lt; y0)) || ((k &gt;= 48) &amp;&amp; (k &lt;= 56) &amp;&amp; (apples[i].x &gt; x0) &amp;&amp; (apples[i].y &gt; y0)) || ((k &gt;= 56) &amp;&amp; (k &lt;= 64) &amp;&amp; (apples[i].x &lt; x0) &amp;&amp; (apples[i].y &gt; y0))){ var x2 = apples[i].x, var y2 = apples[i].y; var p = true; //    var pt = true; //     var t1, t2; var a = x1*x1 + y1*y1, b = 2*(x1*(x0 - x2) + y1*(y0 - y2)), c = (x0 - x2)*(x0 - x2) + (y0 - y2)*(y0 - y2) - apples[i].r*apples[i].r; //------------------------------    if((a == 0) &amp;&amp; (b != 0)){ t = -c/b; pt = false; } if((a == 0) &amp;&amp; (b == 0)){ p = false; } if((a != 0) &amp;&amp; (b != 0) &amp;&amp; (c == 0)){ t1 = 0; t2 = b/a; } if((a != 0) &amp;&amp; (b == 0) &amp;&amp; (c == 0)){ t1 = 0; pt = false; } if((a != 0) &amp;&amp; (b == 0) &amp;&amp; (c != 0)){ t1 = Math.sqrt(c/a); t2 = -Math.sqrt(c/a); } if((a != 0) &amp;&amp; (b != 0) &amp;&amp; (c != 0)){ var d = b*b - 4*a*c; if(d &gt; 0){ t1 = (-b + Math.sqrt(d))/(2*a); t2 = (-b - Math.sqrt(d))/(2*a); } if(d == 0){ t1 = -b/(2*a); } if(d &lt; 0){ p = false; } } //----------------------------------- if(p == true){ if(pt == true){ let x = t1*x1 + x0; let y = t1*y1 + y0; let l1 = Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2); x = t2*x1 + x0; y = t2*y1 + y0; let l2 = Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2); if(l1 &lt;= l2){ Ball.scaners.i[k] += 1 - l1/(l*l); }else{ Ball.scaners.i[k] += 1 - l2/(l*l); } }else{ let x = t1*x1 + x0; let y = t1*y1 + y0; Ball.scaners.i[k] += 1 - (Math.pow((x - Ball.x), 2)+Math.pow((y - Ball.y), 2))/(l*l); } }else{ Ball.scaners.i[k] += 0; } }else{ continue; } } angl += Math.PI/16; } Ball.scaners.i[64] = (1000 - Ball.x) / 1000; //  Ball.scaners.i[65] = Ball.x / 1000; //  Ball.scaners.i[66] = (500 - Ball.y) / 500; //  Ball.scaners.i[67] = Ball.y / 500; //  } }</span></span></code> </pre> </div></div><br><h3>  Neural Network Design </h3><br>  So, for learning the NN, it was customary to use the trace algorithm (reference paths). <br>  <i>Note: in order to simplify the learning process matrix construction is omitted</i> <br><br>  Let's start: <br><br><ol><li>  At the output of the network, we represent 8 neurons responsible for directions: the first is left, the second is left + up, the third is up, the fourth is up + right, the fifth is right, and so on; </li><li>  Let a positive value on a neuron means that you should move in the direction that is assigned to it, and the negative one is the opposite; </li><li>  It is important for us to somehow combine the values ‚Äã‚Äãfrom scanners that are at one angle relative to the lower edge of the field.  Since if the output is negative, the AI ‚Äã‚Äãwill repel from this direction, we introduce an additional layer (hidden between the input and the output), which will add the values ‚Äã‚Äãof neurons reflecting the corresponding scanners in pairs, and we will take the values ‚Äã‚Äãfrom the red neurons with a "-"; </li><li>  Obviously, the movement to the left is mainly influenced by the information to the left of the player (not only, but this will be taken into account later (*)) - it means that we connect the 8 hidden neurons on the left with the neuron responsible for the movement to the left.  We establish connections in the following way: a neuron corresponding to a scanner located parallel to the field boundary is assigned a weight of 1, then a neighboring two neurons are assigned a weight of 0.95, adjacent via a single weight of 0.9, and finally an extreme weight of 0.8 in this sector; </li><li>  Neurons of borders are also taken into account: we make connections to those outputs from those border neurons whose boundaries can influence movement. </li><li>  It does the same with the remaining seven neurons of the output layer. </li></ol><br>  By completing the above algorithm, we get the neural network shown in the figure below. <br><cut></cut><br><img src="https://habrastorage.org/webt/qq/ga/cy/qqgacy_wbvf6ya8dq-qgegokudm.png" alt="image"><br><cut></cut><br>  * But that is not all.  It is important to correctly interpret the result, namely (Y is an array of output neurons): <br><pre> <code class="javascript hljs"> Ball.vx = -(Y[<span class="hljs-number"><span class="hljs-number">0</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">4</span></span>]) + (-(Y[<span class="hljs-number"><span class="hljs-number">1</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">5</span></span>]) + (Y[<span class="hljs-number"><span class="hljs-number">3</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">6</span></span>]))*<span class="hljs-number"><span class="hljs-number">0.5</span></span>; Ball.vy = -(Y[<span class="hljs-number"><span class="hljs-number">2</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">6</span></span>]) + (-(Y[<span class="hljs-number"><span class="hljs-number">3</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">7</span></span>]) + (Y[<span class="hljs-number"><span class="hljs-number">5</span></span>] - Y[<span class="hljs-number"><span class="hljs-number">1</span></span>]))*<span class="hljs-number"><span class="hljs-number">0.5</span></span>;</code> </pre><br><cut></cut><br>  Thus, we created and automatically trained the neural network that underlies the player's AI on the gif at the top of the article. <br><cut></cut><br>  News code is available (implementation of the game and AI) at the link: <a href="https://github.com/Ivan753/Learning">Link to githab Ivan753 / Learning</a> <br><cut></cut><br>  That's all.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/418895/">https://habr.com/ru/post/418895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418883/index.html">GitLab to NAS</a></li>
<li><a href="../418885/index.html">Crispr can accelerate natural processes and change the way food is grown.</a></li>
<li><a href="../418887/index.html">How fast is the universe expanding?</a></li>
<li><a href="../418889/index.html">Manual Application Testing Guide: Benefits, Milestones, and Methodologies</a></li>
<li><a href="../418891/index.html">Checked with the help of PVS-Studio Android source codes, or no one is perfect</a></li>
<li><a href="../418897/index.html">CRDT: Conflict-free Replicated Data Types</a></li>
<li><a href="../418899/index.html">First impressions and actions after upgrading MySQL from version 5.7 to 8.0.11</a></li>
<li><a href="../418901/index.html">The Russians won the most gold medals of the European Olympiad in Informatics eJOI 2018</a></li>
<li><a href="../418903/index.html">Scientists: there is not enough CO‚ÇÇ on Mars to warm the atmosphere. The explosion of the poles will not help</a></li>
<li><a href="../418905/index.html">InlineKeyboard in Telegram Bots</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>