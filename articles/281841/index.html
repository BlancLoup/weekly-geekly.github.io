<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tarantool vs. Microsoft Azure Comparison</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tarantool - NoSQL DBMS, which is developed and widely used in Mail.Ru Group. On the amount of use can be concluded on the publications: 



- Under he...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tarantool vs. Microsoft Azure Comparison</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e02/0ec/fb0/e020ecfb06cb4fdf84dec6df5dca9c2f.jpg" alt="image"><br><br>  Tarantool - NoSQL DBMS, which is developed and widely used in Mail.Ru Group.  On the amount of use can be concluded on the publications: <br><br><ul><li>  <a href="https://habrahabr.ru/company/mailru/blog/279999/">Under heavy load: our uses for Tarantool</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/271513/">Asyncio Tarantool Queue, stand in line</a> </li></ul><br>  Recently, Mail.Ru Group released a virtual machine with Tarantool preinstalled for Microsoft Azure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://azure.microsoft.com/en-us/marketplace/partners/my-com/tarantool/">Tarantool on Microsoft Azure Marketplace</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/279845/">Open Tarantool database from Mail.Ru is certified and placed in the Azure Marketplace</a> </li></ul><br>  We decided to check how well <a href="http://tarantool.org/">Tarantool</a> works in Microsoft Azure in comparison with other similar offers - Azure <a href="http://redis.io/">Redis</a> Cache, Bitnami <a href="https://memcached.org/">Memcached</a> , <a href="http://www.aerospike.com/russian/">Aerospike</a> and <a href="https://voltdb.com/">VoltDB</a> .  The word ‚Äúgood‚Äù is understood as ‚Äúfast‚Äù, that is, we will compare the number of requests processed per second (Throughput, RPS). <br><a name="habracut"></a><br><h1>  Azure Redis Cache </h1><br>  We will need a Basic C4 (13 GB) <a href="https://azure.microsoft.com/ru-ru/services/cache/">Azure Redis Cache</a> instance in which we enable a non-SSL port (we don‚Äôt need SSL for fair comparisons).  It is necessary to use the basic level in order to exclude replication.  Azure Redis Cache is provided as a service, and we do not have access to the virtual machine.  We do not know how it is configured, we can not influence it.  The estimated cost of our size Redis Cache is 9765 rubles per month. <br><br><h1>  Tarantool vm </h1><br>  We need one Tarantool VM Standard D11 virtual machine with 14 GB with HDDs.  This configuration will cost us 9067 rubles per month.  We will test Tarantool in two modes: with <a href="https://en.wikipedia.org/wiki/Write-ahead_logging">write-ahead logging</a> enabled (for data persistence) and off, because we do not know for sure whether the corresponding setting is enabled for Redis. <br><br>  <i>To change the recording mode in /etc/tarantool/instances.enabled/example.lua, change the setting of wal_mode (none for working without WAL, write - with WAL, fsync - a very specific mode of operation, which we will not test).</i> <br><br>  Tarantool, in contrast, for example, to Redis, has TREE-indices, but we need to compare the equal with the equal, therefore the HASH-index was used. <br><br><h1>  Memcached </h1><br>  We took for the test the image of the virtual machine Standard D11 with <a href="https://azure.microsoft.com/en-us/marketplace/partners/bitnami/memcached/">Memcached pre-installed from Bitnami</a> . <br><br>  <i>In the Azure Marketplace there is another Memcached - a <a href="https://azure.microsoft.com/ru-ru/marketplace/partners/garantiadata/memcached/">cloud service from Redis Labs</a> , but it is available only in the US, and failed to test it.</i> <br><br>  After deploying the virtual machine, we disabled authentication in the memcached.conf configuration file (option ‚ÄìS). <br><br>  Memcached cannot keep data persistent. <br><br><h1>  Aerospike </h1><br>  For Aerospike, we took the <a href="https://azure.microsoft.com/ru-ru/marketplace/partners/aerospike/aerospike-database-vm/">official image</a> from the Azure Marketplace (Standard D11). <br><br><h1>  VoltDB </h1><br>  But VoltDB in the Azure Marketplace is not.  I had to take a <a href="https://azure.microsoft.com/ru-ru/marketplace/partners/canonical/ubuntuserver1404lts/">clean virtual machine</a> (Ubuntu 14.04 LTS) and install it manually <a href="https://github.com/VoltDB/voltdb">from source</a> .  But I was pleasantly surprised by the Web out-of-the-box admin, which included live graphics, including the number of requests per second. <br><br><h1>  Synchronous asynchronous test </h1><br>  We will try to perform a ‚Äúsynchronous-asynchronous‚Äù test, that is, the interface will be synchronous, but inside we will work with the connection in an asynchronous manner.  This type of test allows you to simulate work through a single connection for multiple synchronous clients.  To eliminate doubts about the identity of the test for Redis Cache, Tarantool VM and Memcached, we will move all the common logic into the abstract class <b>NoSQLConnection</b> , from which we will then inherit <b>TarantoolConnection</b> , <b>RedisConnection</b> and <b>MemcachedConnection</b> (see the <a href="https://gist.github.com/rvncerr/3b4abf65e07794ca3345">source</a> ). <br><br>  There are two queues in the class (normal std :: list) - <b>OutputQueue</b> (to be sent to the socket) and <b>InputQueue</b> (received from the socket), as well as the <b>SendThreadFunc</b> and <b>ReceiveThreadFunc methods</b> , which run on separate threads and, if there are corresponding non-empty queues, send / receive information by a packet using the <b>Send</b> and <b>Receive</b> methods (pure virtual, implemented in successors). <br><br>  The synchronous interface is represented by the <b>DoSyncQuery</b> method, which puts the query in the <b>OutputQueue</b> and waits for the response in the <b>InputQueue</b> .  The test virtual should be powerful enough (we used Standard D3) and be geographically close to the database (we used the location of the ‚ÄúWestern region of the USA‚Äù). <br><br>  <i>Due to the special structure of the client libraries Aerospike and VoltDB (built-in event-loop), the test for them was written separately.</i> <br><br>  In the range of <b>up to 10 client flows in increments of 1,</b> ems are close to a fully synchronous mode of operation (and one flow, in fact, is).  The graph shows a more or less linear growth.  Redis and Memcached give approximately equal performance, Tarantool is faster, Aerospike is the fastest, but VoltDB, on the contrary, is the slowest. <br><br><img src="https://habrastorage.org/files/67a/dc9/cee/67adc9cee1024f6c9af07d081b57e7ad.png"><br><br><img src="https://habrastorage.org/files/2d9/59c/c6a/2d959cc6a52244719bd38fbdd3379d29.png"><br><br>  The next graph is <b>up to 100 streams in increments of 10</b> , for Tarantool, Redis and Memcached linear growth continues, Aerospike and VoltDB are ‚Äúslowed down‚Äù, and at different values. <br><br><img src="https://habrastorage.org/files/cb6/f4c/75f/cb6f4c75f6d945bbb97d9c37b554efe6.png"><br><br><img src="https://habrastorage.org/files/a4a/48b/a60/a4a48ba6035e4de8af315ef2abe10eb7.png"><br><br>  Next, <b>go up to 1000 in increments of 100 threads</b> .  Growth is slowing everywhere, and for Memcached it stops altogether. <br><br><img src="https://habrastorage.org/files/3b2/e81/ab5/3b2e81ab5b524f80bf6ae2adb23508f2.png"><br><br><img src="https://habrastorage.org/files/ac6/116/170/ac6116170bc44e7bb4a7caccfa19934b.png"><br><br>  Finally, we <b>go up to 8000 streams in increments of 1000</b> .  Growth stops.  After 4000 clients, Memcached stops working - closes the connection, so it cannot be tested.  VoltDB dies even earlier - on 3,000 clients. <br><br><img src="https://habrastorage.org/files/1d9/d73/08d/1d9d7308d82343ee996dc82795b6158e.png"><br><br><img src="https://habrastorage.org/files/cc3/3ea/8a6/cc33ea8a68e645a390a7913643d5cab5.png"><br><br>  As a result, we see the leadership of Tarantool on large loads (on small Aerospike, nevertheless, quickly). <br><br><h1>  And what about the synchronous test? </h1><br>  And here everything is simple.  We start a synchronous asynchronous test in one thread, and it obviously becomes just synchronous.  But if there are many customers, then many connections will be required ... Well, then we will run several tests in parallel and sum up the results. <br><br>  <i>Aerospike and VoltDB in this mode were not tested.</i> <br><br><img src="https://habrastorage.org/files/169/3c3/954/1693c39541ed4dd7ae96555390ea2b56.png"><br><br><img src="https://habrastorage.org/files/089/873/cb4/089873cb47af4605a40bce1afac607c3.png"><br><br>  We see that the synchronous test has a certain ‚Äúceiling‚Äù, which is lower than that of a synchronous-asynchronous connection.  This ceiling is caused by network overhead. <br><br><h1>  Price comparison </h1><br>  Tarantool, Memcached, Aerospike and VoltDb are free, you only need to pay for the virtual machine on which they are running.  We used Standard D11 (14 GB of RAM), which costs ~ 9067 rubles per month.  Azure Redis Cache is a bit more expensive - ~ 9765 rubles per month for the base C4 instance (13 GB of RAM).  We visualize. <br><br><img src="https://habrastorage.org/files/e31/431/3d1/e314313d158c4a6bb36b57dc69f59ec0.png"><br><br>  Agree that nothing is clear?  Prices are almost equal ... However, as we saw earlier, these databases have different performance.  Let's try to express the cost not in a month, but in a billion queries.  First, let's see how much a billion write requests cost at 1000 clients. <br><br><img src="https://habrastorage.org/files/07f/0b7/455/07f0b74553d6414d9188fbf65fcef080.png"><br><br>  VoltDB is an obvious outsider here.  Remove it. <br><br><img src="https://habrastorage.org/files/2e7/aa3/631/2e7aa3631e434a7cbc0ff575c42c870a.png"><br><br>  Now remove Aerospike and Memcached to look at the leaders close by. <br><br><img src="https://habrastorage.org/files/8c3/0a6/745/8c30a6745c304e209bb7dd0b5dd0253a.png"><br><br>  And now, how will the cost change, if we count reading requests on 100 clients. <br><br><img src="https://habrastorage.org/files/e52/df9/d57/e52df9d57b3b477daf9932cf57dab2e6.png"><br><br>  We leave only the leaders. <br><br><img src="https://habrastorage.org/files/847/5f8/d64/8475f8d6455646e6b148e586264167a3.png"><br><br><h1>  findings </h1><br>  In the process of testing, the test process in a synchronous-asynchronous test caused a load on the Tarantool process to up to 70% of the CPU, and in the synchronous mode, to 100%.  On all graphs, Tarantool VM, regardless of the WAL mode, showed itself better than its competitors.  Note that the presence or absence of WAL does not affect the reading speed from Tarantool (the orange and gray curves on the reading charts are the same), since the disk is not used when reading from Tarantool.  In addition, Tarantool VM turned out to be the cheapest solution both per unit of time (per month) and for each request. </div><p>Source: <a href="https://habr.com/ru/post/281841/">https://habr.com/ru/post/281841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281827/index.html">Laravel Timestamp Validator</a></li>
<li><a href="../281829/index.html">IL2CPP: Tips on debugging generated code</a></li>
<li><a href="../281835/index.html">RUVDS will provide the VDS server to the participants of the annual exchange competition "Algorithmus"</a></li>
<li><a href="../281837/index.html">Local positioning technology. Part I</a></li>
<li><a href="../281839/index.html">The experience of automating difficult correspondence (Part 1. Incoming)</a></li>
<li><a href="../281845/index.html">Stack Overflow Habit</a></li>
<li><a href="../281847/index.html">How I suffered, raising LTSP with a third-party TFTP server</a></li>
<li><a href="../281849/index.html">Open Server-status in the Electronic Government of Kazakhstan or how to get a database of citizens</a></li>
<li><a href="../281851/index.html">Make a UI plug-in in IntelliJ Idea "like a maven'a"</a></li>
<li><a href="../281855/index.html">Microsoft uncovered historical aspects of Windows development.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>