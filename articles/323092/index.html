<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recreating subdatasheet in table on AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I would like to share with you the development of sub-tables for our web project. The goal was to recreate a web module that mimics tables and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recreating subdatasheet in table on AngularJS</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  I would like to share with you the development of sub-tables for our web project.  The goal was to recreate a web module that mimics tables and sub-tables (subdatasheet) created on the basis of Access.  Our client is accustomed to working on Access'e, but the times are changing, and now our task is to smoothly switch to the web platform, with minimal difference. </p><br><h1 id="pochemu-angularjs">  Why AngularJS? </h1><br><p>  Having not a lot of experience with various javascript libraries, I came to the conclusion that AngularJS initially forces your project to be small, clean, isolated and easily extensible.  Also, using <strong>directive</strong> with its isolated osprey (scope) allows multiple use, even within itself.  That will be demonstrated under the cut. </p><br><h1 id="kak-nash-itogovyy-directive-budet-primenyatsya">  How our final directive will apply </h1><br><p>  Since there will be many such sub-tables in our project, we need to make our utility convenient in use.  It should be something like this: </p><br><pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ctrl1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subgrid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">config</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subgrid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Check out the demo <a href="https://embed.plnkr.co/h5xHw8L2XVFQRds0FFC1/">here</a> .  Who cares please under the cat. </p><br><a name="habracut"></a><br><pre> <code class="hljs lua">.controller(<span class="hljs-string"><span class="hljs-string">'ctrl1'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ///... $scope.config1 = { t1:{ subgrid:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, width:<span class="hljs-number"><span class="hljs-number">300</span></span>, height:<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>:[ { title:<span class="hljs-string"><span class="hljs-string">"Filed 1"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field1"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 2"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field2"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 3"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field3"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 4"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field4"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 5"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field5"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 6"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field6"</span></span> } ], t:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">load</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id, idx)</span></span></span></span>{ $p.ajax($mock.data1,<span class="hljs-number"><span class="hljs-number">200</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span>{ $scope.config1.t2.init(d); },<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span>{ $scope.config1.t2.timeout(d); }); } }, t2: { subgrid:<span class="hljs-literal"><span class="hljs-literal">true</span></span>, width:<span class="hljs-number"><span class="hljs-number">200</span></span>, height:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>:[ { title:<span class="hljs-string"><span class="hljs-string">"Filed 1"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field1"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 2"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field2"</span></span> } ], t:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">load</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id, idx)</span></span></span></span>{ $p.ajax($mock.data1,<span class="hljs-number"><span class="hljs-number">200</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span>{ $scope.config1.t3.init(d); },<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span>{ $scope.config1.t3.timeout(d); }); } }, t3: { subgrid:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, width:<span class="hljs-number"><span class="hljs-number">200</span></span>, height:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>:[ { title:<span class="hljs-string"><span class="hljs-string">"Filed 1"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field1"</span></span> }, { title:<span class="hljs-string"><span class="hljs-string">"Filed 2"</span></span>, map:<span class="hljs-string"><span class="hljs-string">"field2"</span></span> } ], t:<span class="hljs-string"><span class="hljs-string">""</span></span> } }; /// <span class="hljs-comment"><span class="hljs-comment">--- });</span></span></code> </pre> <br><p>  It's simple!  We set the directives, attach the configuration object to it, and the table with the nest of the sub-tables is ready. </p><br><h1 id="teper-o-samom-kode">  Now about the code itself </h1><br><p>  Consider our directives: </p><br><pre> <code class="hljs lua">.directive(<span class="hljs-string"><span class="hljs-string">'subgrid'</span></span>, [<span class="hljs-string"><span class="hljs-string">'$timeout'</span></span>,<span class="hljs-string"><span class="hljs-string">'$compile'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($timeout,$compile)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { restrict: <span class="hljs-string"><span class="hljs-string">'E'</span></span>, scope: { <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>: <span class="hljs-string"><span class="hljs-string">'='</span></span>, count: <span class="hljs-string"><span class="hljs-string">'='</span></span> }, templateUrl: <span class="hljs-string"><span class="hljs-string">'subgrid.html'</span></span>, link: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(scope, elem, attr, ngModelCtrl)</span></span></span></span> { scope.endrender=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $timeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ scope.render = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; },<span class="hljs-number"><span class="hljs-number">1</span></span>); } scope.expanded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; scope.expandedid = null; scope.cnt = scope.count?scope.count:<span class="hljs-number"><span class="hljs-number">1</span></span>; scope.cnf = scope.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>[<span class="hljs-string"><span class="hljs-string">"t"</span></span>+scope.cnt]; scope.guid = guid(); scope.$watch(<span class="hljs-string"><span class="hljs-string">'cnf.t'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { scope.render = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); scope.cnf.timeout = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error)</span></span></span></span>{ scope.cnf.subgrid = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; scope.cnf.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = [{title:<span class="hljs-string"><span class="hljs-string">"Message"</span></span>,map:<span class="hljs-string"><span class="hljs-string">"field1"</span></span>}]; scope.cnf.t = {RowCount:<span class="hljs-number"><span class="hljs-number">1</span></span>, field1:[<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>],index:[<span class="hljs-number"><span class="hljs-number">1</span></span>]}; } scope.cnf.init = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d)</span></span></span></span>{ scope.cnf.t = <span class="hljs-string"><span class="hljs-string">""</span></span>; $timeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ scope.cnf.t = d; },<span class="hljs-number"><span class="hljs-number">1</span></span>); } scope.expander = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id, idx)</span></span></span></span>{ //<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> same row <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scope.cnf.subgrid) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(id!==scope.expandedid){ angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.expandedid)).children().eq(<span class="hljs-number"><span class="hljs-number">0</span></span>).children().text(<span class="hljs-string"><span class="hljs-string">"+"</span></span>); angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(); scope.expandedid = id; var count = scope.cnt + <span class="hljs-number"><span class="hljs-number">1</span></span>; var tr = angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)); tr.children().eq(<span class="hljs-number"><span class="hljs-number">0</span></span>).children().text(<span class="hljs-string"><span class="hljs-string">"-"</span></span>); var exid = scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>; tr.after($compile(<span class="hljs-string"><span class="hljs-string">"&lt;tr id='"</span></span>+exid+<span class="hljs-string"><span class="hljs-string">"'&gt;&lt;td colspan ='{{cnf.config.length+1}}' style='padding:10px;'&gt;&lt;subgrid count='"</span></span>+count +<span class="hljs-string"><span class="hljs-string">"' config='config'&gt;&lt;/subgrid&gt;&lt;/td&gt;&lt;/tr&gt;"</span></span>)(scope)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof scope.cnf.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span>) { scope.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>[<span class="hljs-string"><span class="hljs-string">"t"</span></span>+count].t = <span class="hljs-string"><span class="hljs-string">""</span></span>; scope.cnf.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span>(id, idx); } scope.expanded = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scope.expanded){ angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)).children().eq(<span class="hljs-number"><span class="hljs-number">0</span></span>).children().text(<span class="hljs-string"><span class="hljs-string">"+"</span></span>); angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(); scope.expanded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; scope.expandedid = null; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ scope.expanded = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; scope.expandedid = id; var count = scope.cnt + <span class="hljs-number"><span class="hljs-number">1</span></span>; var tr = angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)); tr.children().eq(<span class="hljs-number"><span class="hljs-number">0</span></span>).children().text(<span class="hljs-string"><span class="hljs-string">"-"</span></span>); var exid = scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>; tr.after($compile(<span class="hljs-string"><span class="hljs-string">"&lt;tr id='"</span></span>+exid+<span class="hljs-string"><span class="hljs-string">"'&gt;&lt;td colspan ='{{cnf.config.length+1}}' style='padding:10px;'&gt;&lt;subgrid count='"</span></span>+count +<span class="hljs-string"><span class="hljs-string">"' config='config'&gt;&lt;/subgrid&gt;&lt;/td&gt;&lt;/tr&gt;"</span></span>)(scope)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof scope.cnf.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span>) { scope.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>[<span class="hljs-string"><span class="hljs-string">"t"</span></span>+count].t = <span class="hljs-string"><span class="hljs-string">""</span></span>; scope.cnf.<span class="hljs-built_in"><span class="hljs-built_in">load</span></span>(id, idx); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">guid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>((<span class="hljs-number"><span class="hljs-number">1</span></span> + Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) * <span class="hljs-number"><span class="hljs-number">0x10000</span></span>) .toString(<span class="hljs-number"><span class="hljs-number">16</span></span>) .substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"id"</span></span>+s4() + s4(); } } }; }]);</code> </pre> <br><p>  Walk in order in Kratz: </p><br><pre> <code class="hljs css">{ <span class="hljs-attribute"><span class="hljs-attribute">restrict</span></span>: <span class="hljs-string"><span class="hljs-string">'E'</span></span>, scope: { config: <span class="hljs-string"><span class="hljs-string">'='</span></span>, count: <span class="hljs-string"><span class="hljs-string">'='</span></span> }</code> </pre> <br><p>  And so, we limit the type of our directive as an element of <strong>E.</strong>  There is no need to make it different, so that there is less confusion. </p><br><pre> <code class="hljs axapta">config:<span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>: <span class="hljs-string"><span class="hljs-string">'='</span></span></code> </pre> <br><p>  need to inject objects from the controller (controller) into certain directives. </p><br><pre> <code class="hljs php">scope.endrender=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $timeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ scope.render = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; },<span class="hljs-number"><span class="hljs-number">1</span></span>); } scope.$watch(<span class="hljs-string"><span class="hljs-string">'cnf.t'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ scope.render = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br><p>  <strong>endrender is</strong> used to hide the process of building the table itself, since the lateness of requests from distant servers gives ugly spectacular consequences that are easier to replace with a beautiful spiner.  <strong>scope.render is</strong> activated after the last row of the table has been constructed.  <strong>scope. $ watch</strong> listens for every table change and deactivates <strong>scope.render</strong> before it ends. </p><br><pre> <code class="hljs perl">scope.expander = function(id, idx){ <span class="hljs-regexp"><span class="hljs-regexp">//if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> same row <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scope.cnf.subgrid) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(id!==scope.expandedid){ angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.expandedid)).children().e<span class="hljs-string"><span class="hljs-string">q(0)</span></span>.children().text(<span class="hljs-string"><span class="hljs-string">"+"</span></span>); angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>)).remove(); scope.expandedid = id; var count = scope.cnt + <span class="hljs-number"><span class="hljs-number">1</span></span>; var <span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> = angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)); tr.children().e<span class="hljs-string"><span class="hljs-string">q(0)</span></span>.children().text(<span class="hljs-string"><span class="hljs-string">"-"</span></span>); var exid = scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>; tr.after($compile(<span class="hljs-string"><span class="hljs-string">"&lt;tr id='"</span></span>+exid+<span class="hljs-string"><span class="hljs-string">"'&gt;&lt;td colspan ='{{cnf.config.length+1}}' style='padding:10px;'&gt;&lt;subgrid count='"</span></span>+count +<span class="hljs-string"><span class="hljs-string">"' config='config'&gt;&lt;/subgrid&gt;&lt;/td&gt;&lt;/tr&gt;"</span></span>)(scope)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof scope.cnf.load === <span class="hljs-string"><span class="hljs-string">"function"</span></span>) { scope.config[<span class="hljs-string"><span class="hljs-string">"t"</span></span>+count].t = <span class="hljs-string"><span class="hljs-string">""</span></span>; scope.cnf.load(id, idx); } scope.expanded = true; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(scope.expanded){ angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)).children().e<span class="hljs-string"><span class="hljs-string">q(0)</span></span>.children().text(<span class="hljs-string"><span class="hljs-string">"+"</span></span>); angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>)).remove(); scope.expanded = false; scope.expandedid = null; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ scope.expanded = true; scope.expandedid = id; var count = scope.cnt + <span class="hljs-number"><span class="hljs-number">1</span></span>; var <span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> = angular.element(elem[<span class="hljs-number"><span class="hljs-number">0</span></span>].querySelector(<span class="hljs-string"><span class="hljs-string">"#"</span></span>+id)); tr.children().e<span class="hljs-string"><span class="hljs-string">q(0)</span></span>.children().text(<span class="hljs-string"><span class="hljs-string">"-"</span></span>); var exid = scope.guid+<span class="hljs-string"><span class="hljs-string">'sub'</span></span>; tr.after($compile(<span class="hljs-string"><span class="hljs-string">"&lt;tr id='"</span></span>+exid+<span class="hljs-string"><span class="hljs-string">"'&gt;&lt;td colspan ='{{cnf.config.length+1}}' style='padding:10px;'&gt;&lt;subgrid count='"</span></span>+count +<span class="hljs-string"><span class="hljs-string">"' config='config'&gt;&lt;/subgrid&gt;&lt;/td&gt;&lt;/tr&gt;"</span></span>)(scope)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof scope.cnf.load === <span class="hljs-string"><span class="hljs-string">"function"</span></span>) { scope.config[<span class="hljs-string"><span class="hljs-string">"t"</span></span>+count].t = <span class="hljs-string"><span class="hljs-string">""</span></span>; scope.cnf.load(id, idx); } } } } function guid() { function s4() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.floor((<span class="hljs-number"><span class="hljs-number">1</span></span> + Math.random()) * <span class="hljs-number"><span class="hljs-number">0x10000</span></span>) .toString(<span class="hljs-number"><span class="hljs-number">16</span></span>) .substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"id"</span></span>+s4() + s4(); }</code> </pre> <br><p>  <strong>expander</strong> is the main handler when scrolling through a table to a subtable.  The main feature for generating a new sub-table is to dynamically introduce our own element inside of us.  But it is worth noting that for internal use, we add the <strong>count</strong> attribute.  This is in order to distinguish which table from our <strong>config1</strong> configuration, directives should use which table <strong>t1, t2, etc.</strong>  . </p><br><p>  <strong>guid</strong> simply simply assigns a unique ID to each row in each table.  So that we could confidently change / delete the row we need in the table we need. </p><br><h1 id="shablon">  Template </h1><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"t-datasheet"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"{'spinner':render}"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"{'width':cnf.width+'px','height':cnf.height+'px'}"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-hide</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"render"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">#</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"c in cnf.config"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-cloak</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{c.title}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{guid+i}}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"i in cnf.t.index"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-init</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"($last &amp;&amp; endrender())"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"expander(guid+i,i)"</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-show</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"cnf.subgrid"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">+</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"c in cnf.config"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-cloak</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{cnf.t[c.map][i-1]}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  The template turned out to be simple and dynamic, where the table has the ability to dynamically expand the columns as <strong>config1 is</strong> configured. </p><br><p>  Everything else that is not described here is the utilities used to test this code (for example: instead of real http requests, I used promises, and set each of them a different timeout). </p><br><p>  This project is a prototype of my further development.  And I am sharing with the aim of finding out about your opinions and tips on how to improve it. </p><br><p>  ‚Üí <a href="https://embed.plnkr.co/h5xHw8L2XVFQRds0FFC1/">Demo</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/323092/">https://habr.com/ru/post/323092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323078/index.html">Python in the service of the designer. Taming the Kompas 3D API</a></li>
<li><a href="../323080/index.html">The fate of the package. Cisco IOS XE</a></li>
<li><a href="../323084/index.html">What you need to know to use omnichannel communications?</a></li>
<li><a href="../323086/index.html">Creating images on CSS makes a maker-up better, or What to do during long winter evenings</a></li>
<li><a href="../323090/index.html">Uninvented stories about EastBanc Technologies in photos</a></li>
<li><a href="../323094/index.html">Booking.com search architecture</a></li>
<li><a href="../323096/index.html">.Net Core, AppDomain, WCF, RPC marshalling TCP / Ip your bike</a></li>
<li><a href="../323100/index.html">IceCash 2.0 Web Workstation Cashier and AIS for exchanging data with cash registers for Linux to Python</a></li>
<li><a href="../323102/index.html">Another way to localize applications</a></li>
<li><a href="../323106/index.html">Accelerate Node.js with Rust</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>