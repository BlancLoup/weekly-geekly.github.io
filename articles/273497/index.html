<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Taming UEFI SecureBoot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="These promises must be fulfilled, especially if they are made first in the final part of the security opus on UEFI , and then repeated from the ZeroNi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Taming UEFI SecureBoot</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/dc9/f31/519/dc9f315198d244b8aaef22deb80f2671.jpg">  These promises must be fulfilled, especially if they are made first in the <a href="http://habrahabr.ru/post/268423/">final part of the security opus on UEFI</a> , and then repeated <a href="https://twitter.com/ZeroNights/status/669864406512222208">from the ZeroNights 2015 scene</a> , so today we will talk about how to make UEFI SecureBoot work not for the good of Microsoft, as is most often configured default, but for the good of us with you. <br>  If you are interested in how to generate your own keys for SecureBoot, how to install them instead of the standard ones (or with them), how to sign your favorite EFI-downloader, how to prevent the downloading of unsigned or other people's keys from the code, what the interface looks like to configure SecureBoot from AMI , Insyde and Phoenix, and why this, by and large, does not matter at all - welcome under the cat, but beware of a large number of images and long console commands. <br><a name="habracut"></a><br><h4>  <b>Introduction</b> </h4><br>  I already told you about how SecureBoot works and works at the beginning of the <a href="http://habrahabr.ru/post/267953/">fifth part of the above-mentioned opus</a> . I don‚Äôt see any reason to repeat.  If you don‚Äôt know what the whole UEFI SecureBoot is all about, who are <abbr title="Platform key">PK</abbr> , <abbr title="Key exchange key">KEK</abbr> , <abbr title="Valid signed images database">db</abbr> and <abbr title="Invalid signed images database">dbx</abbr> , and why, from the point of view of SecureBoot, the default owner of your system is the UEFI manufacturer, and the only authorized user is Microsoft, go ahead we will wait here for you. <br><br>  With the educational program finished, now to the point.  In spite of the fact that about the last three years about ten excellent articles (links to some of which are given in the Literature section) were written about creating your keys and setting up SecureBoot, it's still there.  The main problem with information about configuring SecureBoot even in the English segment of the network (not to mention runet) - most of the articles, texts and posts breaks to ‚Äúwe now have keys in the EFI Signature List format, add them in a way dependent on your vendor‚Äôs firmware and done. "  At the same time, the vendors themselves do not rush to describe the SecureBoot settings menu either in the documentation on their OEM platforms or in manuals on the end systems, as a result, the user is lost in unfamiliar areas and either disables SecureBoot, which prevents his favorite OpenBSD from loading (or whatever it), or leaves it on the default settings (and then, Windows loads the same).  It is this last step that I will try to describe in more detail, but not to the detriment of the other necessary steps. <br><br><h4>  <b>Test configuration</b> </h4><br>  Especially for this article, I took out a couple of not the latest laptops with firmware on the Phoenix <abbr title="Secure core tiano">SCT</abbr> and Insyde H2O platforms, as well as a brand new congatec board (developing the firmware for which I am currently working) on ‚Äã‚Äãthe AMI AptioV platform.  Meet our test benches: <br><img src="https://habrastorage.org/files/244/b0b/8de/244b0b8debdb4eecbed478335a7b5b27.png"><br>  <b>1</b> .  <b>AMI</b> , they are also " <i>triangular</i> ": <b><a href="http://www.congatec.com/en/products/com-express-type6/conga-tr3.html">congatec conga-TR3</a> @ <a href="http://www.congatec.com/en/products/accessories/conga-teval.html">conga-TEVAL</a></b> , AMD RX-216GD (Merlin Falcon), AMI AptioV (UEFI 2.4) <br><img src="https://habrastorage.org/files/9c6/cfd/ea6/9c6cfdea65db4889bac12f9cc1165df2.png"><br>  <b>2</b>  <b>Insyde</b> , they are also " <i>square</i> ": <b><a href="http://www.ultrabookreview.com/6591-acer-aspire-r14-review/">Acer Aspire R14 R3-471T</a> (Quanta ZQX)</b> , Intel Core i3-4030U (Ivy Bridge), Insyde H2O (UEFI 2.3.1C) <br><img src="https://habrastorage.org/files/258/bf7/119/258bf7119ebe4f82b72532d613431823.png"><br>  <b>3</b>  <b>Phoenix</b> , they are also " <i>semicircular</i> ": <b><a href="http://www.notebookcheck.net/Review-Dell-Vostro-3360-Notebook.76737.0.html">Dell Vostro 3360</a> (Quanta V07)</b> , Intel Core i7-3537U (Ivy Bridge), Phoenix SCT (UEFI 2.3.1C) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>About interfaces for configuring SecureBoot</b> </h4><br>  On all of the above systems, the manufacturer claims support for UEFI SecureBoot technology, but the interface for setting it up is very different between systems.  Fortunately, this is not a very big problem, because for configuring SecureBoot on UEFI 2.3.1C (and newer) compatible firmware, <u>there is no interface in Setup except for the ability to delete the current PK</u> (ie, transfer SecureBoot into so-called Setup Mode) <u>is not required</u> , and after that, you can use any EFI application that can call the gRS-&gt; SetVariable UEFI service with user-supplied data, including the <i>KeyTool.efi</i> utility from the <a href="http://git.kernel.org/cgit/linux/kernel/git/jejb/efitools.git/tree/"><b>efitools</b></a> package, which is designed specifically for key management and it remains only to learn it to enjoy. <br>  However, if a convenient interface for configuration is present (for AMI, in my opinion, it is even more convenient for <i>KeyTool</i> a), you can use it, so you still have to talk about these interfaces. <br><div class="spoiler">  <b class="spoiler_title">A few words about UEFI screenshots</b> <div class="spoiler_text">  Thanks to the versatility of <abbr title="Graphic Output Protocol">GOP</abbr> , ConIn / ConOut and DevicePath, it was possible to sit down and write for half an hour a simple DXE driver that would take wonderful screenshots in BMP format from everything that happens in the graphics console after its (driver) load by pressing a hot key, after which I would save them on the first USB flash drive with FAT32 FS ... But first you need to write it, then debug it, then integrate it into the firmware so that it doesn‚Äôt collapse (and you will have to insert a microchip with firmware on the laptops if what  something goes wrong), plus you can take screenshots from AptioV controlled by me just using the terminal and console serial redirection, and the rest of the settings there are literally two or three screens that can be photographed from the monitor, so I ask you, dear readers, to forgive your humble servant for these crooked photographs and for the fact that he is a lazy ass. </div></div><br><h4>  <b>Cooking bridgehead</b> </h4><br>  Let's start with a lyrical digression about the availability of the necessary software for different operating systems.  Despite the fact that Microsoft is one of the developers of the technology, there is still no normal means available for working with it from Windows (keys can be generated by the <a href="https://msdn.microsoft.com/library/windows/desktop/aa386968.aspx"><i>MakeCert</i></a> utility from the Windows SDK, and for everything else, it‚Äôs <a href="https://technet.microsoft.com/en-us/library/dn747883.aspx">suggested to use</a> third-party <a href="https://technet.microsoft.com/en-us/library/dn747883.aspx"><abbr title="Hardware Security Module">HSM</abbr></a> for a lot of money) .  I thought at first to take and write the necessary utility on Qt, but therefore I decided that it was not necessary to generate keys and signatures every day, and existing solutions would be enough for a couple of times.  You can try to convince me in the comments, if you want. <br>  In general, for all of the following, you will need Linux (which can be run from LiveUSB, if you do not have it installed).  For it, there are two sets of utilities for working with SecureBoot: <i>efitools / sbsigntool</i> and <i>EFIKeyGen / pesign</i> .  I have a positive experience with the first set, so it will be about him. <br>  As a result, besides Linux, we need a few things: <br>  1. The <i><b>openssl</b></i> package and the utility of the same name from it to generate key pairs and convert certificates from DER to PEM. <br>  2. Package <i><b>efitools</b></i> , or rather <i>cert-to-efi-sig-list</i> , <i>sign-efi-sig-list utilities</i> for converting certificates into ESL format and signing files in this format, and <i>KeyTool.efi</i> for managing the keys of the system found in SetupMode . <br>  3. The <i><b>sbsigntool</b></i> package, or rather the <i>sbsign</i> utility for signing UEFI executable files (ie, bootloaders, DXE drivers, OptionROMs and applications for UEFI Shell) with your key. <br>  Download Linux, install the above packages, open a terminal in your home directory and go to the next step. <br><br><h4>  <b>We generate our own keys for SecureBoot</b> </h4><br>  As usual, there are several ways to do something, and the more powerful the tool used, the more such methods.  OpenSSL as a tool is so advanced that it seems that he can do everything at all, and if you read man to him, then absolutely everything else.  Therefore, in this article I will confine myself to the direct generation of key files, and leave the dances around creating my own <abbr title="Certificate Authority">CA</abbr> for <a href="http://prosauce.org/blog/2015/9/13/minnowboard-max-quickstart-uefi-secure-boot">independent study</a> . <br><br><h5>  <b>We generate key pairs</b> </h5>  The keys will need to generate three pieces: PK, KEK and <abbr title="Image Signing Key">ISK</abbr> . <br>  Let's start with PK, to generate which you need to do the following <br><pre><code class="bash hljs">openssl req -new -x509 -newkey rsa:2048 -sha256 -days 365 -subj <span class="hljs-string"><span class="hljs-string">"/CN=Platform Key"</span></span> -keyout PK.key -out PK.pem</code> </pre>  then enter and confirm the password, which will then be asked when you try to sign something with the resulting private key. <br>  With the command above, we ask OpenSSL to generate us a key pair of RSA2048 / SHA256 with a validity of one year, called Platform Key, with the output of the private key in the PK.key file, and the open one in the PK.pem file.  If you add <i>-nodes</i> , then to sign this key pair you will not need a password, but here we will not do this - with a password at least slightly, but safer. <br>  In the same way, we generate key pairs for KEK and ISK, while I advise you to enter different passwords: <br><pre> <code class="bash hljs">openssl req -new -x509 -newkey rsa:2048 -sha256 -days 365 -subj <span class="hljs-string"><span class="hljs-string">"/CN=Key Exchange Key"</span></span> -keyout KEK.key -out KEK.pem</code> </pre> <pre> <code class="bash hljs">openssl req -new -x509 -newkey rsa:2048 -sha256 -days 365 -subj <span class="hljs-string"><span class="hljs-string">"/CN=Image Signing Key"</span></span> -keyout ISK.key -out ISK.pem</code> </pre> <br><h5>  <b>Convert public keys to ESL format</b> </h5>  Now you need to convert the public keys from the PEM format into the UEFI SecureBoot clear ESL format.  This binary format is described in <a href="http://www.uefi.org/specifications">the UEFI specification</a> (section 30.4.1 in the current version 2.5) and is interesting in that the files in it can be connected to each other by concatenation, and this fact is still useful to us. <br><pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> PK.pem PK.esl</code> </pre> <pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> KEK.pem KEK.esl</code> </pre> <pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> ISK.pem ISK.esl</code> </pre>  The -g switch adds a GUID to the generated ESL file, in our case a random one, obtained by running the <i>uuidgen</i> utility and using its output.  If you do not have this utility, invent GUIDs yourself or leave the default value. <br><br><h5>  <b>Signing ESL files</b> </h5>  For SecureBoot to work correctly, PK must be signed by itself, KEK is signed by PK, and db and dbx storages must be signed by KEK.  At the same time, PK cannot be several, but the situation with several KEKs can be found in the wild, but I still strongly recommend that you remove the pre-installed Microsoft key from KEK for a simple reason - db and dbx can be signed with any key from the KEK store, t .  if the MS key is not deleted from there, then MS will be able to control the contents of the db and dbx, i.e.  add any new keys or hashes to the list of trusted downloads and delete existing ones from it.  In my opinion, this is a bit too much, and if we take control of the keys in our hands, then we need to do it to the end. <div class="spoiler">  <b class="spoiler_title">If you think differently</b> <div class="spoiler_text">  Well, then you have a <a href="https://technet.microsoft.com/en-us/library/dn747883.aspx">direct path here</a> , there at the very end of section 1.3.4.3 there is a <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D321185">link</a> to the Microsoft Corporation KEK CA 2011 certificate in the DER format, from which you first need to get the PEM team <br><pre> <code class="bash hljs">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MicCorKEKCA2011_2011-06-24.crt -inform DER -out MsKEK.pem -outform PEM</code> </pre>  then convert the resulting PEM to ESL with the command <br><pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> MsKEK.pem MsKEK.esl</code> </pre>  then add the resulting file to our KEK.esl file with the command <br><pre> <code class="bash hljs">cat KEK.esl MsKEK.esl &gt; NewKEK.esl</code> </pre> <pre> <code class="bash hljs">mv -f NewKEK.esl KEK.esl</code> </pre>  Now Microsoft is the same authorized user of your platform, as you are, with which I congratulate you. </div></div>  On the other hand, if you don‚Äôt want to lose the ability to load Windows and Microsoft-signed executable components (for example, GOP drivers for external video cards and PXE drivers for external network cards), then our key ISK.esl will need to be added <a href="http://go.microsoft.com/fwlink/%3FLinkID%3D321192">Microsoft Windows Production CA 2011</a> , with which MS signs its own loaders and the <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D321194">Microsoft UEFI driver signing signing</a> key, which third-party components sign (by the way, they signed the Shim loader, which now starts various Linux distributions that support SecureBoot out of the box). <br>  The sequence is the same as under the spoiler above.  Convert from DER to PEM, then from PEM to ESL, then add to db.esl, which you will eventually need to sign with any key from KEK: <br><pre> <code class="bash hljs">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MicWinProPCA2011_2011-10-19.crt -inform DER -out MsWin.pem -outform PEM</code> </pre> <pre> <code class="bash hljs">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MicCorUEFCA2011_2011-06-27.crt -inform DER -out UEFI.pem -outform PEM</code> </pre> <pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> MsWin.pem MsWin.esl</code> </pre> <pre> <code class="bash hljs">cert-to-efi-sig-list -g <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uuidgen)</span></span></span><span class="hljs-string">"</span></span> UEFI.pem UEFI.esl</code> </pre> <pre> <code class="bash hljs">cat ISK.esl MsWin.esl UEFI.esl &gt; db.esl</code> </pre> <br>  Now sign the PK with yourself: <br><pre> <code class="bash hljs">sign-efi-sig-list -k PK.key -c PK.pem PK PK.esl PK.auth</code> </pre>  We sign KEK.esl with the PK key: <br><pre> <code class="bash hljs">sign-efi-sig-list -k PK.key -c PK.pem KEK KEK.esl KEK.auth</code> </pre>  Sign the db.esl with the KEK key: <br><pre> <code class="bash hljs">sign-efi-sig-list -k KEK.key -c KEK.pem db db.esl db.auth</code> </pre> <br>  If you are not tired yet, you can add something else to the db or create a dbx repository, you now know the necessary commands, everything further is up to you. <br><br><h5>  <b>Sign the loader</b> </h5>  It remains to sign an executable file with the ISK key to verify the operation of SecureBoot after adding your keys.  For tests, I advise you to sign the <a href="http://ruexe.blogspot.com/">utility RU.efi</a> , it is graphic and bright, and even from afar you can see whether it started up or not.  In fact, this utility is extremely powerful and you can do a lot of good and not so much business, so after the tests it would be best to remove it, and only sign loaders in the future. <br>  In any case, executable files are signed with this command: <br><pre> <code class="bash hljs">sbsign --key ISK.key --cert ISK.pem --output bootx64.efi RU.efi</code> </pre>  Here, at the same time, I renamed the executable file to <i>bootx64.efi</i> , which should be placed in the / EFI / BOOT directory of the USB test drive with FAT32 FS.  For 32-bit UEFI (save you randomly from working with them) use <i>bootia32.efi</i> and <i>RU32.efi</i> . <br><br>  As a result of this, all you got are three .auth files that will need to be written ‚Äúas is‚Äù in the NVRAM variables <i>db</i> , <i>KEK</i> and <i>PK</i> , and in exactly this order.  Copy all three files to the root of another USB-based FAT32 file system with <i>/usr/share/efitools/efi/KeyTool.efi as</i> ( <i>/EFI/BOOT/bootx64.efi)</i> (copy it also to the root, just in case ) and your "SecureBoot handler set" is ready. <br><br><h4>  <b>The Taming of the Shrew</b> </h4><br>  It all starts the same way: we insert our USB flash drive with keys and <i>KeyTool</i> in a free USB port, turn on the machine, go to BIOS Setup.  Here, before you configure SecureBoot, you need to disable <abbr title="Compatibility Support Module">CSM</abbr> , and with it, legacy downloads, with which our technology is not compatible.  Also, be sure to set the password to the BIOS Setup entrance longer, otherwise you can bypass SecureBoot simply by disabling it, for which on some systems with IPMI and / or AMT even a physical presence is not required. <br><br><h5>  <b>AMI AptioV</b> </h5>  Most of the firmware based on the AMI code, the management of the SecureBoot technology is on the Security tab, I have this control looks like this: <br><img src="https://habrastorage.org/files/a7f/648/267/a7f6482675fc4c5da37337beca5f47d0.png"><br>  Go to the Key Management menu (it used to be on the same tab, now it is highlighted) and we see the following there: <br><img src="https://habrastorage.org/files/b5c/0f7/4cb/b5c0f74cb4d74ba294c8b980c3c726ff.png"><br>  We select the variable we need, and then we first propose to choose between installing a new key and adding it to the existing ones, select the first one: <br><img src="https://habrastorage.org/files/f07/099/9c4/f070999c4b004270b0d5226b2a8aadfa.png"><br>  Now it is proposed to either set the default value, or load your own from the file, choose the latter: <br><img src="https://habrastorage.org/files/e29/d7e/683/e29d7e68322c48ffbe0960bc6b89b1d6.png"><br>  Next, you need a device and a file on it, and then select the format of this file, in our case it is the Authenticated Variable: <br><img src="https://habrastorage.org/files/d39/845/cc1/d39845cc192f4695bf52b975187c61bf.png"><br>  Then you need to confirm the update of the file, and if everything went well before, we will get a concise message as a result: <br><img src="https://habrastorage.org/files/2e3/611/95f/2e361195f6d64124bffa80921df71c20.png"><br>  Repeat the same for KEK and PK, and we get the following state at the output: <br><img src="https://habrastorage.org/files/1cb/b00/3f8/1cbb003f826d44928f83ee5365881da6.png"><br>  That's right, we have a single PK, just one key in KEK and three keys in db, return to the previous menu with the Esc button and turn on SecureBoot: <br><img src="https://habrastorage.org/files/273/d34/502/273d345026784de290d92ec2b6684d33.png"><br>  Done, save the settings and exit with a reboot, after which we try to boot from our flash drive and see the following picture: <br><img src="https://habrastorage.org/files/46b/05e/120/46b05e120d48494eb511d81a1a37c9d0.png"><br>  Ok, unsigned boot loaders go to the forest, it remains to check the signed.  We insert another flash drive, reboot and see something like this: <br><img src="https://habrastorage.org/files/8c7/b8e/74b/8c7b8e74b73f4f0897ce64686566f5f3.png"><br>  Now we can say that SecureBoot works as it should. <br>  If your AMI UEFI does not have such an interface for adding keys, then another way is suitable for you, which is further on. <br><br><h5>  <b>Insyde H2O</b> </h5>  Here everything is somewhat worse than in the previous case.  There are no three interfaces to add your own keys, and there are only three options for configuring SecureBoot: either delete all variables at once by translating SecureBoot into Setup Mode, or select an executable file that hash will be added to db, and you can run it even if if it is not signed at all, or return to the standard keys, which are the Acer PK on this machine, the key from Acer and MS in KEK, and a whole bunch from Acer and MS in db. <br>  However, there is no interface - well, to hell with it, we have <i>KeyTool</i> for this, the main thing is that you can go to Setup Mode.  Interestingly, BIOS Setup does not enable SecureBoot if the Supervisor Password is not set, so install it first, then erase the keys: <br><img src="https://habrastorage.org/files/9c5/959/1db/9c59591db861481f8df8b84c437632c1.jpg"><br>  After that, on the next Boot tab, select the UEFI boot mode and enable SecureBoot: <br><img src="https://habrastorage.org/files/75a/f9a/407/75af9a4078ff4665b83f8aaef2f5b7d9.jpg"><br>  Since  my photos in the middle of the night are unbearably disgusting, then <i>KeyTool's</i> screenshots and I will do it on the previous system, and you will have to believe that everything looks exactly the same on this (mom swear!). <br>  <i>Boot</i> from our carrier into <i>KeyTool</i> , and see something like the following: <br><img src="https://habrastorage.org/files/3d3/979/c9e/3d3979c9efa341b0b2083231503e4200.png"><br>  Select Edit Keys, get into the storage selection menu: <br><img src="https://habrastorage.org/files/e8d/e0f/240/e8de0f240698400c83946a67a906aa0a.png"><br>  There, first choose <i>db</i> , then Replace Keys, then our USB device, and then the file: <br><img src="https://habrastorage.org/files/e06/e5f/576/e06e5f5768484b6ba922d6dcad09cda7.png"><br>  Press Enter and without any success messages, we are again shown the storage selection menu.  Repeat the same for KEK first, and then for PK, after which we exit to the main menu by double pressing Esc.  Turn off the machine, turn it on again, try to load the <i>KeyTool</i> again and see such a picture (which I dragged from the firmware dump, her photo on the glossy screen is even worse than the previous ones): <br><img src="https://habrastorage.org/files/dd7/548/fd5/dd7548fd58784aa5960322d9c934869a.png"><br>  Well, one part of SecureBoot works, the other is checked by launching the signed <i>RU.efi</i> and it also works.  I have Windows 8 installed on this system in UEFI mode, and so it works, Microsoft did not let down with the certificate. <br><br><h5>  <b>Phoenix SCT</b> </h5>  There are even fewer opportunities, and there are only two items on the Security tab in the entire Secure Boot Configuration menu: returning to the standard keys and deleting all the keys with the system transition in the SetupMode, we need the second one: <br><img src="https://habrastorage.org/files/2aa/a04/e59/2aaa04e591004f18b704854f266fef4b.jpg"><br>  Then, on the Boot tab, you need to select the UEFI boot type, enable SecureBoot, and create a boot entry for <i>KeyTool</i> 'a, otherwise it will not work on this platform: <br><img src="https://habrastorage.org/files/2ea/b83/234/2eab832348634cef9270a9199c18d0f9.jpg"><br>  Click Yes, exit with saving changes, reboot, press F12 when loading to get into the boot menu, from there choose <i>KeyTool</i> , the operation with which is described above.  After adding the keys and restarting, the attempt to re-launch <i>KeyTool</i> ‚Äôs ends like this: <br><img src="https://habrastorage.org/files/262/a39/904/262a399042f349f59b739907598b45ac.jpg"><br>  At the same time, the Linux installed on the same machine continues to load properly, like the signed <i>RU.efi</i> , so SecureBoot can be considered valid. <br><br><h4>  <b>Conclusion</b> </h4><br>  As a result, thanks to open source utilities, we managed to get SecureBoot on systems with UEFI of three different vendors, generate our own keys and sign the executable files we need.  Now the loading of the platform entirely is in our hands, but only if the BIOS password is strong and is not stored in <a href="https://twitter.com/NikolajSchlej/status/664121100826226688">clear text</a> , as in some, and there are no known (or unknown) holes in the SecureBoot implementation.  By itself, SecureBoot is not a panacea for bootkits, but with it the situation with secure boot is still much better than without it. <br>  I hope that the material will help you, and thank you for reading this footcloth. <br><br><h4>  <b>Literature</b> </h4><br>  <a href="http://www.rodsbooks.com/efi-bootloaders/controlling-sb.html">Managing EFI Bootloaders for Linux: Controlling SecureBoot</a> . <br>  <a href="https://en.altlinux.org/UEFI_SecureBoot_mini-HOWTO">AltLinux UEFI SecureBoot mini-HOWTO</a> . <br>  <a href="http://kroah.com/log/blog/2013/09/02/booting-a-self-signed-linux-kernel/">Booting a self-signed Linux kernel</a> . <br>  <a href="https://wiki.gentoo.org/wiki/Sakaki%27s_EFI_Install_Guide/Configuring_Secure_Boot">Sakaki's EFI Install Guide: Configuring SecureBoot</a> . <br>  <a href="https://wiki.ubuntu.com/SecurityTeam/SecureBoot">Ubuntu Security Team: SecureBoot</a> . <br>  <a href="http://blog.hansenpartnership.com/owning-your-windows-8-uefi-platform/">Owning your Windows 8 UEFI Platform</a> . <br>  <a href="http://prosauce.org/blog/2015/9/13/minnowboard-max-quickstart-uefi-secure-boot">MinnowBoard Max: Quickstart UEFI Secure Boot</a> . <br>  <a href="https://technet.microsoft.com/en-us/library/dn747883.aspx">Windows 8.1 Secure Boot Key Creation and Management Guidance</a> . </div><p>Source: <a href="https://habr.com/ru/post/273497/">https://habr.com/ru/post/273497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273485/index.html">PHP application for apps.com - features and rakes</a></li>
<li><a href="../273487/index.html">Objective-C questions for middle / senior level</a></li>
<li><a href="../273489/index.html">Juniper Firewall Backdoors</a></li>
<li><a href="../273491/index.html">Facebook threatens security specialist hacking Instagram</a></li>
<li><a href="../273493/index.html">Preparing ASP.NET 5, issue number 7: more about working with Gulp</a></li>
<li><a href="../273505/index.html">Open lecture: the problem of the feasibility of Boolean formulas</a></li>
<li><a href="../273509/index.html">Immersion in ASP.NET 5 Runtime</a></li>
<li><a href="../273511/index.html">Paul Graham: The Word "Hacker"</a></li>
<li><a href="../273513/index.html">Why and how do we back up github</a></li>
<li><a href="../273517/index.html">Look in looking-glass</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>