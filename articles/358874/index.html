<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Magic link or story about how we simplified the life of the user</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the article I will share my personal experience in developing and implementing ‚Äúmagic links‚Äù. Let me tell you why they are needed in our project, h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Magic link or story about how we simplified the life of the user</h1><div class="post__text post__text-html js-mediator-article">  In the article I will share my personal experience in developing and implementing ‚Äúmagic links‚Äù.  Let me tell you why they are needed in our project, how they function and at the end even burst into tears over the fact that the lack of such functionality in large systems I use makes me angry to tear my hair out. <br><br>  The code will be only in one place, since  The main purpose of the article is to tell about the idea itself, and not to show how beautiful the code is. <br><br><img src="https://habrastorage.org/webt/yd/us/ny/ydusnyd-go2h3khblhrpe4lnedy.png"><br><a name="habracut"></a><br><h3>  Intro blah bla bla </h3><br>  Sometimes, reading and studying someone else's experience is much easier than spending hours trying to wrestle yourself and your fellow practitioners in implementing a new ‚Äúunique‚Äù functionality.  Unique in our time rarely meet.  Often, any functionality has already been used by someone, and you, the button, it remains only to integrate it into your work area. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the project I'm working on, any user can go in to ask a lawyer a question.  This is his main task, which I will consider in the article. <br><br><h3>  What is my password? </h3><br>  Coming to our platform, the user needs only one thing - help.  He does not want to register and then log in only to ask a question.  He needs an answer here and now. <br><br>  Initially, we could not ask a question without being logged in.  Users have no complaints about this.  In the registration form, enter the box and password was not a problem.  Initially, lawyers reacted slowly, because  There were not many questions, so the client even managed to forget that he had such a question.  Having received the answer in the system and a notification to his email, it was time for the client to find out what the lawyer wrote there.  And here comes the collapse: most users have not mastered the authorization, because  trite password forgotten.  And it‚Äôs not that we didn‚Äôt have a password recovery form, but it didn‚Äôt help much.  We began to lose customers ... <br><br><h3>  I just want to ask a question </h3><br>  Decided that we can open the possibility of creating a question for the guests.  The client in the form of creating an entity additionally enters the mailbox and that's it.  No registration step.  The client wanted to ask a question - he asked it. <br><br>  The lawyer, taking the question asked by the guest into the work, <s>gives an open and extensive answer taking into account all the cases</s> ... ahem ... writes a couple of lines of clever words and that's it - the answer is given. <br><br><h3>  nashproekt.kom alahomora! </h3><br>  The system sends the client a notification that his question has been answered.  But in the letter a certain link appears - the magic link, when you click on it, the user is authorized and with a satisfied person he appears on the page of his question.  Everything. <br><br>  Here and the fairy tale is over, and who listened well. <br><br>  Now I will talk about the technical side of this ‚Äúprogress‚Äù. <br><br><h3>  I washed down the hash </h3><br>  The project consists of 2 parts: front and back.  A service was developed on the back-end, which is responsible for the operation of the magic link system. <br><br>  Initially, the system generates a random set of 6 characters (letters + numbers) - hash, which saves to the base.  The hash is, of course, checked for uniqueness. <br><br>  Each hash has its time of life, which depends on the role of the user for whom it is generated (since later such references began to come to lawyers who have a memory for passwords still full of holes) and the type of operation that resulted in it being generated ( answer to the question, question creation, comment, etc.).  We have about 14,000 users in our database, i.e.  little and 6-character hash, as practice shows, as long as it behaves itself quite adequately.  Hashes that have expired are deleted.  We decided that 6 characters is an ideal option for memorizing or self-entering in the address bar, which, by the way, looks very nice - / hash / haSH12. <br><br>  Each hash is associated with the user for which it is generated.  It is also bound to the entity (ID + type), the operation on which caused the generation of hash. <br><br>  Going over the magic link, the front sends to the back-hash and waits in the reply for instructions on what to do next.  If the hash is valid, the user is authorized and then redirected to a detailed view of the entity.  If the hash is not valid - the front asks the user to log in. <br><br>  With the development of the platform, the requirement has arrived that, in the case of a commenting operation, the user, moving along the hash, should scroll to a new comment.  Thus, the hash received an additional setting, which we called the ‚Äúlocation‚Äù and in which we store the route of the front with additional parameters (in this case, the comment ID) to which the user redirects after authorization. <br><br>  The next development of the platform required the ability to perform a number of operations before the user is authorized.  For example, verify a profile or start some kind of deadline timer to answer a question.  This gave the hash a setting called alias.  The system for processing hashes, finding the desired hash in the database, looks for the presence of an alias ‚Äî the usual string that stores a text constant.  If there is an alias, the system calls the method, in which the necessary operations are performed before the user is authorized <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeAlias</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hash-&gt;alias){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//camelCase alias $aliasMethod = Str::camel($this-&gt;hash-&gt;alias); if(!method_exists($this, $aliasMethod)){ return $this; } return $this-&gt;{$aliasMethod}(); }</span></span></code> </pre> <br>  This hash management system has proven itself so well that we have extended it to access files.  The situation is simple: the client loads the file in question, the back-up keeps it somewhere in the dark depths of the server, but users (that client, that lawyer) see the beautiful link / storage / hash12 / some_CODE.  The system for managing file hashes when loading a file immediately generates a pair of hash code and additionally binds a path to the file to them and stores all this in the database. <br><br>  We plan to integrate the code for the magic link as well, in order to use it for two-factor authorization in the future.  The user, going through the magic link, will receive a code on the phone and enter it in the form proposed by the front. <br><br>  This system allowed us to configure convenient and flexible user access to the system.  Analyzing the situation, we understand that errors with incorrect password entry and the number of letters with a password reminder almost disappeared.  We can change the lifetime of each hash separately or generate it for some individual user upon his request. <br><br><h3>  Plak, poster </h3><br>  And in the end I cry.  I burst into tears from the fact that sites / platforms that sometimes use such a system are not used or a string of 40 characters is used as a hash, since  Sometimes there is a need not to follow the link from the letter, but enter it manually in the address bar.  Although, I don‚Äôt deny that with the growth of our project sometime we will come to the length of such a hash ... <br><br>  Thanks for attention. <br><br>  PS I remind you that this is a personal experience and I leave my pebble in a large garden of information. </div><p>Source: <a href="https://habr.com/ru/post/358874/">https://habr.com/ru/post/358874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358862/index.html">Patenting, desktop for programmers, networks in Kubernetes and scooter as a gift</a></li>
<li><a href="../358864/index.html">Intelligence agencies have problems with interception of messages in all instant messengers except ICQ</a></li>
<li><a href="../358866/index.html">And again: do not use public WiFi</a></li>
<li><a href="../358870/index.html">Saga of options</a></li>
<li><a href="../358872/index.html">Compact serializer for cache using System.Reflection.Emit</a></li>
<li><a href="../358878/index.html">PHDays 8 Summary: Games Over</a></li>
<li><a href="../358880/index.html">The Java Language Specification. Chapter 17. Threads and Locks (Translation. Part 1)</a></li>
<li><a href="../358882/index.html">Less management, more success: the ‚Äúinverted‚Äù structure of Supercell</a></li>
<li><a href="../358886/index.html">Spring mitap (and one summer) from Alfa-Bank</a></li>
<li><a href="../358888/index.html">How we at Tinkoff used Windows Hello to authenticate the user</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>