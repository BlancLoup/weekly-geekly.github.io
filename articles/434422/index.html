<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internet unprofitable things</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Call the kids! Now Uncle Andrei will tell a Christmas horror story about NTP (Network Time Protocol). 

 Almost two years ago, on Monday, January 16, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internet unprofitable things</h1><div class="post__text post__text-html js-mediator-article">  Call the kids!  Now Uncle Andrei will tell a Christmas horror story about NTP (Network Time Protocol). <br><br>  Almost two years ago, on Monday, January 16, 2017, an interesting ticket from an unauthorized person entered our <a href="https://bitfolk.com/">BitFolk</a> bug report <a href="https://bitfolk.com/">system</a> .  The sender introduced himself as NetThings UK Ltd. Lead Software Engineer. <br><br><blockquote> Subject: NTP request for IP <code>85.119.80.232</code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hello, <br><br>  This may seem strange, but I need to configure the NTP server by IP address <code>85.119.80.232</code> . </blockquote><br>  What is so special about address <code>85.119.80.232</code> ?  This is the IP address of one of the NTP servers to serve our customers.  A few weeks before this ticket, the server was also part of the <a href="https://www.ntppool.org/">NTP Pool</a> project. <br><br>  Here the important word was.  At the end of December 2016, I brought BitFolk NTP servers out of the public pool and blocked them for outsiders. <br><a name="habracut"></a><br>  I did this because because of the <a href="https://en.wikipedia.org/wiki/NTP_server_misuse_and_abuse">Snapchat NTP bug</a> , they received unusually high traffic.  In fact, it did not cause any huge problems, just such a volume of traffic pushed out useful information from the base of saving the <a href="http://www.jump.net.uk/">Jump</a> network network of a fixed size, and I didn‚Äôt want to deal with it during the holidays, so I simply turned off public access to the service. <br><br><h1>  NTP? </h1><br>  This article <a href="https://news.ycombinator.com/item%3Fid%3D18751771">appeared on Hacker News</a> , and in a few comments there were asked to briefly explain what NTP is, so I added this non-technical section.  If you know the technology, you can skip it. <br><br>  Network Time Protocol is a tool by which a computer can use several other computers, often from all over the Internet, on completely different networks managed by different administrators to accurately determine the current time.  When using several different computers, some of them give an inaccurate result, some can be broken or behave hostilely, but the protocol is able to recognize the "wrong" clock and take into account only the result from a more accurate majority. <br><br>  It is assumed that NTP is used in a hierarchical order: hardware is directly connected to several servers to determine the exact time: atomic clocks, GPS, etc. They are called Stratum 1 servers. Second-level servers set their time on Stratum 1 servers, serve much more customers and so on. <br><br>  In past times, it was difficult to find available NTP servers.  In your own company you could have one or two such servers, but in fact you had to check with at least 3-7 servers, and better from different organizations.  In a university environment, it was easier: you could talk with colleagues and share access to NTP.  But as the Internet grew, the number of requests grew, including from commercial companies and individuals. <br><br>  The NTP Pool project came to the rescue.  Through a simple web-based interface, anyone added their own NTP servers to the pool: they were collectively served in a common DNS zone with some basic means for load balancing.  A private individual was allowed to specify three names from the pool, and he would receive three different (constantly changing) NTP servers for free. <br><br>  It was assumed that commercial companies would apply to a separate ‚Äúvendor zone‚Äù.  They donate a small fee to the project ‚Äî and get the DNS zone allocated for their product, so it‚Äôs easier for the administrators of the pool to send traffic. <br><br>  Unfortunately, many companies did not bother to study these subtleties and simply used the common pool area.  NetThings UK Ltd.  went even further in a very wrong direction - and took the IP address from the pool, simply using it directly and assuming that it will always be available.  In fact, this free service was donated to the general pool by BitFolk, and due to temporary inconveniences, the service was turned off. <br><br>  Going back to our story ... <br><br><h1>  They want ... what? </h1><br>  The lead software engineer continued: <br><br><blockquote>  Recently, the NTP service was turned off, and I‚Äôm interested to know if there is any possibility to start it again at the specified IP address.  Either through the current owner of the IP address, or through the migration of the current machine to another address, so that we can rent <code>85.119.80.232</code> . </blockquote><br>  Hmm ... <br><br><blockquote>  I understand that this is a strange request, but I can assure you that it is sincere. </blockquote><br><h1>  It will not work </h1><br>  Obviously, <code>85.119.80.232</code> used by all our clients as a resolver and NTP server.  Ask them all to change the configuration in order to lease the address to NetThings UK Ltd.  - this is not an option.  So I just removed the firewall, so <code>85.119.80.232</code> began to work again for NetThings UK Ltd. until we figure out what can be done. <br><br>  Then I asked a few relevant questions to determine the scope of services that would have to be provided: <br><br><ul><li>  How many clients do you use this server? </li><li>  Do you know their IP addresses? </li><li>  When do they need an NTP server and for how long? </li><li>  Can I get them to use the pool correctly (through the vendor zone)? </li></ul><br><h1>  Deeper into the forest </h1><br>  Answers to some questions were very disappointing. <br><br><blockquote>  The server is partially used by our production system where the RTC was originally installed.  Unfortunately, a fairly large amount of equipment (~ 500 units with weekly NTP calls) works on roaming GPRS SIM.  I do not know whether in this case it is possible to rely on the initial IP address of the APN to configure the firewall (I will check).  We also can not remotely update the firmware on these devices, because they have a quota for traffic of 5 MB per month.  We can update them locally, but this will take months, not weeks. </blockquote><br>  Apparently, NetThings UK Ltd produced thermostats with remote control, lighting controllers for large retail spaces, etc. It seems that they recorded one of the BitFolk IP addresses in the firmware, and these devices could not be identified or remotely updated. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc4/1a1/b94/cc41a1b941c4a20a472d92152f69483c.gif"></div><br><br>  And yes, in any case, without an external time source, the watches of these devices will begin to noticeably shift within two weeks. <br><br>  By the way, they solved their problem with a hard-coded IP address, <i>raising the BitFolk IP address locally in their factory to set the initial date / time.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d3/46d/3d1/8d346d3d153529a7b78f75a0b8b57123.gif"></div><br><br>  I admit, at that time there was a slight temptation to identify these devices, to give them completely wrong data - and see if some stores start to turn on and off the lights at a strange time of day. <br><br><h1>  Weekly?? </h1><br><blockquote>  NTP calls from us starts weekly crowns without load balancing on the client side.  This leads to a flow of requests at the same time every Sunday at about 7:45 pm. </blockquote><br>  Yes, they made each of their unidentified devices knock on a hard-coded IP address for a two-minute interval every Sunday evening. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ca/d3a/75d/5cad3a75d04bace3a2d696dd4dcb89eb.gif"></div><br><br>  The lead software engineer was very worried that they caused the excess flow I mentioned earlier, but I assured that this is definitely a Snapchat bug.  In fact, their 500 devices never differed from the background noise.  It turned out that half a thousand SNTP requests are a fairly light load.  They did this for more than two years before the problem arose. <br><br>  Of course, I noted their luck that we quickly noticed the problem, otherwise it could have ended as in <a href="https://en.wikipedia.org/wiki/NTP_server_misuse_and_abuse">the Netgear case versus the University of Wisconsin</a> [when Netgear devices flood the University NTP server with requests - approx.  trans.]. <br><br><blockquote>  I feel very, very bad because of this.  I am very, very sorry if we caused your problems. </blockquote><br>  Forgiven.  I must note that throughout this time it was a pleasure to work with the lead engineer. <br><br><h1>  We made a deal </h1><br>  In fact, BitFolk provides clients with an NTP service out of courtesy, this is not a paid service.  In the end, who will pay for it if there is a public pool?  For a commercial company, properly maintain a pool by subscribing to a vendor zone. <br><br>  But NetThings UK Ltd.  found themselves in a difficult situation, and a ban on access to the NTP server would cause them serious financial damage.  Potentially, I could have asked for a lot of money at that moment, but I felt (no doubt, to the detriment of my pocket) that this is simply wrong. <br><br>  For a start, I offered to pay me for two hours of consultations in order to cover the work already done on making changes to the firewall. <br><br>  In addition, I offered to pay one hour of consultations per month for 12 months to cover the costs of continuing to work with the NTP server.  Of course, I do not spend an hour a month fiddling with NTP, but such non-standard deviation from my usual work required a certain reward. <br><br>  I really wanted to point out that this is not forever: <br><br><blockquote>  Finally, this is a penalty.  It seems that you are now in a difficult situation, and there is a temptation to charge you the maximum amount (in any case, much more than ¬£ 840 + VAT), but it seems to me unfair.  However, the provision of NTP services to third parties is not our business, so we expect the contract to end within 12 months.  If you ultimately have to extend this service, it will mean that we did not charge you enough and we will increase the price. <br><br>  Does this seem reasonable? </blockquote><br>  NetThings UK Ltd.  gladly agreed to such a proposal. <br><br><blockquote>  Thanks again for the info and help.  You saved me from a lot of stupid and useless work.  We have enough time to fix it. </blockquote><br><h1>  Bumps on the road </h1><br>  In the future, I communicated with the lead software engineer only once.  The rest of the correspondence was conducted with financial personnel, mainly because NetThings UK Ltd.  did not like to pay bills on time. <br><br>  For the year NetThings UK Ltd.  paid late three of the four bills.  In each case, I tried to charge them the statutory late charge fee. <br><br><h1>  Disappointing results of the year </h1><br>  When 2017 came to an end, I asked the lead software engineer how the situation with our IP address was in the firmware of their devices, how successfully did they solve the problem? <br><br><blockquote>  In short, most of our products managed to get rid of the use of a fixed IP address.  It remains to update another project, after which the production of new units with such firmware will be completely discontinued.  But we still have about 1,000 units in production that are not easy to update: they will continue to send weekly NTP requests to a fixed IP address.  Therefore, answering your question: yes, we still need a service in January 2018. </blockquote><br>  It was a little sad, because a year ago there were "about 500" devices.  Despite the best efforts throughout the year, the number seems to have doubled. <br><br>  This alone is enough to increase the fee, which I was still going to do because of the regular late payments on their part.  For two months, I had previously notified them that the price would double. <br><br><h1>  Want to argue? </h1><br>  Approximately 15 weeks after the price doubling report, NetThings UK Ltd. Chief Financial Officer  asked why this happened while simultaneously reporting the transfer of one of the overdue payments: <br><br><blockquote>  Date: Wed, 21 Feb 2018 14:59:42 +0000 <br><br>  Already paid, but could you explain why the price doubled? </blockquote><br>  I was very happy again to explain in detail why she doubled.  The financial director in response tried to negotiate a fixed price for the year, to which I agreed, subject to payment in advance for the year. <br><br>  My rationale was that the price increase was mainly due to late payments on their part: they take too much time, so if I save the quarterly payment, I need the opportunity to charge more if necessary.  If they want guarantees, in my opinion, they must pay for it by making one annual payment. <br><br>  No reply followed, so payments continued on a quarterly basis. <br><br><h1>  That's the end of the tale </h1><br>  On November 20, 2018, we received a letter from <a href="https://deloitte.com/">Deloitte</a> : <br><br><blockquote>  <b>Netthings Limited - In Administration (‚ÄúThe Company‚Äù)</b> <b><br><br></b>  <b>Company Number: SC313913</b> <br><br>  [...] <br><br>  <b>Termination</b> <br><br>  The company ceased operations from November 15, 2018. <br><br>  <b>Investigation</b> <br><br>  As part of our responsibilities as a Property Manager, we investigate which assets belong to the company and what funds can be recovered for creditors, as well as how the company‚Äôs operations were conducted. </blockquote><br>  And then December 21: <br><br><blockquote>  In accordance with paragraph 51 (1) (b) of the Insolvency and Bankruptcy Act of 1986, the Asset Manager is not obliged to convene a meeting of creditors unless the company has enough funds to distribute to unsecured creditors or if the meeting is required by form SADM_127 unsecured creditors with 10% or more of the cost of debt.  <b>There are no funds for distribution among unsecured creditors, so the meeting will not be convened.</b> </blockquote><br>  Fortunately, their only unpaid bill was for service since November, so everything was paid. <br><br><hr><br>  This is the story of NetThings UK Ltd, a daring explorer of the Internet of Things, who thought that the NTP public pool is just an integral part of the Internet and everyone can use it for free, just choose one IP address at random and sew it into thousands of its devices that are distributed throughout country without the ability to remotely update. <br><br>  This faith, combined with the innovative reluctance to pay for anything on time, unfortunately, was not enough to preserve solvency. </div><p>Source: <a href="https://habr.com/ru/post/434422/">https://habr.com/ru/post/434422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434410/index.html">Disposable chargers. Why do we need it?</a></li>
<li><a href="../434412/index.html">Removal of the rocket before launch on the East</a></li>
<li><a href="../434414/index.html">Iceberg</a></li>
<li><a href="../434416/index.html">Read on vacation. The best posts on our blog for 2018</a></li>
<li><a href="../434418/index.html">Faster, louder, brighter: the physics of the mating "dancing" of hummingbirds</a></li>
<li><a href="../434424/index.html">JAVA SOUND API basics</a></li>
<li><a href="../434426/index.html">Checklist: How to submit reports on the simplified taxation system for 2018</a></li>
<li><a href="../434428/index.html">We collect, repair and carry vintage digital watches</a></li>
<li><a href="../434430/index.html">IBM showed 8-bit analog phase memory chip</a></li>
<li><a href="../434432/index.html">Wii, Wai, Wai, Frond - ‚Äúdifficulties of translation‚Äù, or what lies behind the new platform SAS Viya (Frond)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>