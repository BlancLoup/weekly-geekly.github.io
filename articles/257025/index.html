<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search a page with jQuery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many site visitors are unaware of the search for a page by pressing Ctrl + F and looking for the necessary fragment with their eyes, just scrolling th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search a page with jQuery</h1><div class="post__text post__text-html js-mediator-article">  Many site visitors are unaware of the search for a page by pressing Ctrl + F and looking for the necessary fragment with their eyes, just scrolling through the text.  This method becomes problematic if there are more than three or four screens on a text page.  For these visitors, I decided to implement a search on the page using jQuery. <br>  An example of such a search is on the website of the <a href="http://constitution.kremlin.ru/">Constitution of the Russian Federation</a> , but there it works somehow strange. <br><a name="habracut"></a><br><h4>  A warning </h4>  I am not a professional programmer, please do not kick the curve code and the possible invention of the bicycle. <br><br><h4>  HTML form </h4>  First of all, let's place on the page the HTML code of the search form.  The form includes two elements - a field for entering text and a DIV for displaying search results. <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"spterm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"spterm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" ?"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"spresult"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  CSS </h4>  We set two styles: the first is for selecting a fragment, the second is for referring to the first fragment. <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.highlight</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#C6D9DB</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.splink</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#0A5794</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; }</code> </pre> <br><h4>  Search setting </h4><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> minlen = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    var paddingtop = 30; //     var scrollspeed = 200; //   var keyint = 1000; //    </span></span></code> </pre> <br><h4>  Highlighting fragments </h4>  Basic functionality - highlighting of fragments in the text.  This is done using regular expressions. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dosearch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ term = jQuery(<span class="hljs-string"><span class="hljs-string">'#spterm'</span></span>).val(); jQuery(<span class="hljs-string"><span class="hljs-string">'span.highlight'</span></span>).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   jQuery(this).after(jQuery(this).html()).remove(); }); var t = ''; jQuery('div.entry-content').each(function(){ //      jQuery(this).html(jQuery(this).html().replace(new RegExp(term, 'ig'), '&lt;span class="highlight"&gt;$&amp;&lt;/span&gt;')); //    n = jQuery('span.highlight').length; //    console.log('n = '+n); if (n==0) jQuery('#spresult').html('  '); else jQuery('#spresult').html(': '+n); }); } jQuery('#spterm').keyup(function(){ if (jQuery('#spterm').val()!=term) // ,    if (jQuery('#spterm').val().length&gt;=minlen) { //    dosearch(); //    ,    } else jQuery('#spresult').html(' '); //   ,    DIV   });</span></span></code> </pre> <br><h4>  Transition between fragments </h4>  It is not enough to select fragments, it is much more convenient to organize a quick transition between them.  Under the form we place the link to go to the first found fragment.  In order not to occupy space with arrows, click on each fragment leads to the next.  Clicking on the last fragment returns the user to the search form. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n==<span class="hljs-number"><span class="hljs-number">0</span></span>) jQuery(<span class="hljs-string"><span class="hljs-string">'#spresult'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'  '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> jQuery(<span class="hljs-string"><span class="hljs-string">'#spresult'</span></span>).html(<span class="hljs-string"><span class="hljs-string">': '</span></span>+n); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">//    ,      { var i = 0; jQuery('span.highlight').each(function(i){ jQuery(this).attr('n', i++); //  ,         }); jQuery('span.highlight').not(':last').attr({title: ',     '}).click(function(){ //  ,  ,   jQuery('body,html').animate({scrollTop: jQuery('span.highlight:gt('+jQuery(this).attr('n')+'):first').offset().top-paddingtop}, scrollspeed); //     }); jQuery('span.highlight:last').attr({title: ',     '}).click(function(){ jQuery('body,html').animate({scrollTop: jQuery('#spterm').offset().top-paddingtop}, scrollspeed); //     }); }</span></span></code> </pre> <br><h4>  Search start delay </h4>  Search in the large text and highlighting take a few seconds, for which the page hangs.  When typing a long word, the search is performed after each entered letter. <br><pre> <code class="javascript hljs"> jQuery(<span class="hljs-string"><span class="hljs-string">'#spterm'</span></span>).keyup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); time_keyup = d1.getTime(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jQuery(<span class="hljs-string"><span class="hljs-string">'#spterm'</span></span>).val()!=term) <span class="hljs-comment"><span class="hljs-comment">// ,    if (jQuery('#spterm').val().length&gt;=minlen) { //    setTimeout(function(){ //    var d2 = new Date(); time_search = d2.getTime(); if (time_search-time_keyup&gt;=keyint) //     dosearch(); //    ,    }, keyint); } else jQuery('#spresult').html(' '); //   ,    DIV   });</span></span></code> </pre> <br><h4>  Bonus </h4>  Add the ability to create links to any text on the page without using &lt;a name="..."&gt;.  Just create a link to the page and add # text. <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.hash!=<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  { var t = window.location.hash.substr(1, 50); //   jQuery('#spterm').val(t).keyup(); //      jQuery('#spgo').click(); //     }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">All code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">jQuery(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> minlen = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    var paddingtop = 30; //     var scrollspeed = 200; //   var keyint = 1000; //     var term = ''; var n = 0; var time_keyup = 0; var time_search = 0; jQuery('body').delegate('#spgo', 'click', function(){ jQuery('body,html').animate({scrollTop: jQuery('span.highlight:first').offset().top-paddingtop}, scrollspeed); //     }); function dosearch() { term = jQuery('#spterm').val(); jQuery('span.highlight').each(function(){ //   jQuery(this).after(jQuery(this).html()).remove(); }); var t = ''; jQuery('div#content').each(function(){ //      jQuery(this).html(jQuery(this).html().replace(new RegExp(term, 'ig'), '&lt;span class="highlight"&gt;$&amp;&lt;/span&gt;')); //    n = jQuery('span.highlight').length; //    console.log('n = '+n); if (n==0) jQuery('#spresult').html('  '); else jQuery('#spresult').html(': '+n+'. &lt;span class="splink" id="spgo"&gt;&lt;/span&gt;'); if (n&gt;1) //    ,      { var i = 0; jQuery('span.highlight').each(function(i){ jQuery(this).attr('n', i++); //  ,         }); jQuery('span.highlight').not(':last').attr({title: ',     '}).click(function(){ //  ,  ,   jQuery('body,html').animate({scrollTop: jQuery('span.highlight:gt('+jQuery(this).attr('n')+'):first').offset().top-paddingtop}, scrollspeed); //     }); jQuery('span.highlight:last').attr({title: ',     '}).click(function(){ jQuery('body,html').animate({scrollTop: jQuery('#spterm').offset().top-paddingtop}, scrollspeed); //     }); } }); } jQuery('#spterm').keyup(function(){ var d1 = new Date(); time_keyup = d1.getTime(); if (jQuery('#spterm').val()!=term) // ,    if (jQuery('#spterm').val().length&gt;=minlen) { //    setTimeout(function(){ //    var d2 = new Date(); time_search = d2.getTime(); if (time_search-time_keyup&gt;=keyint) //     dosearch(); //    ,    }, keyint); } else jQuery('#spresult').html(' '); //   ,    DIV   }); if (window.location.hash!="") //  { var t = window.location.hash.substr(1, 50); //   jQuery('#spterm').val(t).keyup(); //      jQuery('#spgo').click(); //     } });</span></span></code> </pre> </div></div><br><br><h4>  disadvantages </h4>  On large pages (approximately 60 kb of text), the script hangs for a couple of minutes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Demo: <a href="http://jsfiddle.net/6c3ph7uj/2/">http://jsfiddle.net/6c3ph7uj/2/</a> <br><br>  Thank you for your attention, I will be grateful for comments and ideas on how to improve the script. </div><p>Source: <a href="https://habr.com/ru/post/257025/">https://habr.com/ru/post/257025/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257015/index.html">Introduction to the Ethernet Fast Path software on the P1020RDB debug board</a></li>
<li><a href="../257017/index.html">HL7 CDA R2 Development Tools Testing</a></li>
<li><a href="../257019/index.html">Ten of the best engines to create your own games</a></li>
<li><a href="../257021/index.html">Transliteration in Perl6</a></li>
<li><a href="../257023/index.html">Frequently asked questions about the WatchKit framework</a></li>
<li><a href="../257027/index.html">Vulnerability in proftpd CVE-2015-3306</a></li>
<li><a href="../257029/index.html">Build 2015: Visual Studio for OS X and Linux, Windows 10, cloud services and other new items from Microsoft</a></li>
<li><a href="../257037/index.html">The Assistant Robot Ashmanov on the Russian-language Turing test. Technology Infa</a></li>
<li><a href="../257039/index.html">What the designer needs to know about SVG: Pros and Cons</a></li>
<li><a href="../257041/index.html">Implementation of the NEC IR protocol on ATmega</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>