<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MR template for writing services on Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The point is this: node.js does not provide a ready-made solution for creating a project. My first project on node.js consisted of one coffeescript fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MR template for writing services on Node.js</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/af8/4f7/570/af84f757031841bb72d46ef70b66c26e.png" alt="image"><br>  The point is this: node.js does not provide a ready-made solution for creating a project.  My first project on node.js consisted of one coffeescript file and run.js to run from IDE.  When the routes were five, everything was fine, but when the project was overgrown with models and routes, it turned into hell.  They solve this problem in different ways, someone use a hub, someone global, someone puts everything in one file. <br><a name="habracut"></a><br>  <i>Attention: the decision does not claim to be the only correct one and generally correct.</i>  <i>Just decided to share.</i>  <i>Srach on the topic node.js vs erlang please do not dilute, they are in different categories.</i> <i><br></i> <br>  For the impatient there is a project on <a href="https://github.com/andoriyu/mr-skel">githaba</a> <br><br>  I omit MR - Model Route, View because res.json is not a view, but a larger service is not needed. <br><br>  Project structure: <br><pre> <code class="hljs css"><code class="bash">‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.coffee</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.coffee</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">models</span></span> ‚îÇ  ‚îî‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">example</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.coffee</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">package</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> ‚îÇ  ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">images</span></span> ‚îÇ  ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">javascripts</span></span> ‚îÇ  ‚îî‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">stylesheets</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">routes</span></span> ‚îÇ  ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">index</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.coffee</span></span> ‚îÇ  ‚îî‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">root</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.coffee</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">run-cluster</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span> ‚îî‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">run</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span></code></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  app.coffee </h5><br>  This is the entry point to the application. <br><pre> <code class="hljs pgsql"><code class="coffeescript">exports.start = () -&gt; <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> = require(<span class="hljs-string"><span class="hljs-string">'logule'</span></span>) #   <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> "Spawning new worker" require <span class="hljs-string"><span class="hljs-string">'coffee-script'</span></span> #   ,    .coffee   require ### Basic dependencies ### express = require <span class="hljs-string"><span class="hljs-string">'express'</span></span> app = module.exports = express.createServer() app.__ = require <span class="hljs-string"><span class="hljs-string">'underscore'</span></span> #    app.mongoose = require <span class="hljs-string"><span class="hljs-string">'mongoose'</span></span> # ODM  MongoDb, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> yes, it<span class="hljs-string"><span class="hljs-string">'s web scale app.log = log #  config = require('</span></span>./config.coffe<span class="hljs-string"><span class="hljs-string">e')(app,express) #   models = {} #     models.example= require('</span></span>./models/exampl<span class="hljs-string"><span class="hljs-string">e')(app.mongoose).model #   require('</span></span>./routes/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.coffe<span class="hljs-string"><span class="hljs-string">e')(app, models) # ,      port = process.env.PORT || 5000 #  Heroku     app.listen port log.info "Express server listening on port #{port}"</span></span></code></code> </pre><br><h5>  config.coffee </h5><br><pre> <code class="hljs rust"><code class="coffeescript">module.exports = (app, express) -&gt; config = this app.configure -&gt; app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> express.bodyParser() app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> express.methodOverride() app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> app.router app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> express.<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>(__dirname + '/public') app.configure <span class="hljs-symbol"><span class="hljs-symbol">'development</span></span>', () -&gt; app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> express.errorHandler({dumpExveption: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, showStack: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) # <span class="hljs-string"><span class="hljs-string">""</span></span>   app.mongoose.connect process.env.MONGOLAB_URI || <span class="hljs-string"><span class="hljs-string">"mongodb://localhost/skel"</span></span> #  heroku app.configure <span class="hljs-symbol"><span class="hljs-symbol">'production</span></span>', () -&gt; app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span> express.errorHandler() app.mongoose.connect <span class="hljs-string"><span class="hljs-string">"mongodb://localhost/production"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config</code></code> </pre><br><h5>  models / example.coffee </h5><br><pre> <code class="hljs pgsql"><code class="coffeescript">module.exports = (mongoose) -&gt; Schema = mongoose.<span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span> ObjectId = <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.ObjectId #<span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> = mogoose.model(<span class="hljs-string"><span class="hljs-string">'Comment'</span></span>) #  ,        mongoose. PostSchema = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span> { author : { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>:ObjectId, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } <span class="hljs-type"><span class="hljs-type">date</span></span> : <span class="hljs-type"><span class="hljs-type">Date</span></span>, content : String #, comments : [<span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span>] #      } this.model = mongoose.model(<span class="hljs-string"><span class="hljs-string">'Post'</span></span>, PostSchema) #  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this</code></code> </pre><br><h5>  package.json </h5><br>  The engines section is for Heroku, everything else is clear. <br><pre> <code class="hljs json"><code class="coffeescript">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"mr-skel"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"private"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> , <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.6.x"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"npm"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.xx"</span></span> } , <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"express"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.5.x"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"mongoose"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.6.x"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"mongoose-types"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"underscore"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"coffee-script"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"logule"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.xx"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"devDependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"forever"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"mocha"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> , <span class="hljs-attr"><span class="hljs-attr">"should"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> } }</code></code> </pre><br><br><br><br><h5>  routes / index.coffee </h5><br>  This file stores all routes that are in the application. <br><pre> <code class="hljs coffeescript"><code class="coffeescript">routes = {} routes.root = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./root.coffee'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(app, models)</span></span></span><span class="hljs-function"> -&gt;</span></span> app.get <span class="hljs-string"><span class="hljs-string">'/'</span></span>, routes.root.getIndex(models) <span class="hljs-comment"><span class="hljs-comment">#    ,       models      root.cofee</span></span></code></code> </pre><br><h5>  routes / root.coffee </h5><br><pre> <code class="hljs coffeescript"><code class="coffeescript">exports.getIndex = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(models)</span></span></span><span class="hljs-function"> -&gt;</span></span> (req, res) -&gt; Post = models.example Post.find {}, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, posts)</span></span></span><span class="hljs-function"> -&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err? <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.send <span class="hljs-number"><span class="hljs-number">500</span></span> res.json { status: <span class="hljs-string"><span class="hljs-string">'Ba dum tssh'</span></span>, meta: posts }</code></code> </pre><br><h5>  run-cluster.js </h5><br>  Run an application using the Cluster API.  It does not work on Heroku, but on my vps I launch the application this way. <br><pre> <code class="hljs pgsql"><code class="javascript"><span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span> = require(<span class="hljs-string"><span class="hljs-string">'cluster'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> = require(<span class="hljs-string"><span class="hljs-string">'logule'</span></span>); require(<span class="hljs-string"><span class="hljs-string">'coffee-script'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>.isMaster) { <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Master have just started"); # i = -  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>.fork(); } <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'death'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(worker) { <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.error("Worker " + worker.pid + " died!"); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>.fork(); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { app = require(<span class="hljs-string"><span class="hljs-string">'./app.coffee'</span></span>); app.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>() }</code></code> </pre><br><h5>  run.js </h5><br><pre> <code class="hljs perl"><code class="javascript"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'coffee-script'</span></span>); app = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./app.coffee'</span></span>); app.start();</code></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/143538/">https://habr.com/ru/post/143538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143527/index.html">Wolfenstein 3D now in HTML5</a></li>
<li><a href="../143529/index.html">Porn company sues Tumblr for copyright infringement</a></li>
<li><a href="../143532/index.html">The long awaited BioShock Infinite is delayed again</a></li>
<li><a href="../143533/index.html">Granny's Dancing on the Table - a new film under Creative Commons</a></li>
<li><a href="../143537/index.html">Physics of innovation</a></li>
<li><a href="../143539/index.html">Handling complex events with chains</a></li>
<li><a href="../143540/index.html">How to scatter windows on desktops after loading</a></li>
<li><a href="../143542/index.html">Runetology (146): Head of Molotok.ru, Igor Tarasenko</a></li>
<li><a href="../143543/index.html">Designing a rotator algorithm by rating</a></li>
<li><a href="../143544/index.html">Word of Dokach</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>