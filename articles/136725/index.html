<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tower Defense + Box2D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you were writing a Tower Defense game, would it have occurred to you to use a physics engine for this, for example Box2D ? How would you implement ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tower Defense + Box2D</h1><div class="post__text post__text-html js-mediator-article">  If you were writing a <a href="http://ru.wikipedia.org/wiki/Tower_Defense">Tower Defense</a> game, would it have occurred to you to use a physics engine for this, for example <a href="http://box2d.org/">Box2D</a> ?  How would you implement the movement of units, the behavior of the towers?  What else would you have learned from the physics engine in such a game? <br><img src="https://habrastorage.org/storage2/6cf/39b/198/6cf39b198e1556f106e11a46b5ee3116.png"><br>  I started thinking about these and other questions a few months ago, as a result of which an interesting game was born. <br><a name="habracut"></a><br>  I am a big fan of tower defense games.  It all started a long time ago with Green TD, maps for Warcraft 3, then I tried many games on <a href="http://flashtowerdefense.com/">flashtowerdefense.com</a> , and after the android smartphone appeared, I often spent time playing games from the market. <br><br><h4>  Idea </h4><br>  Once I thought that it would be nice to write such a game myself.  I wanted to come up with something unusual, and then, as one friend of mine says, ‚Äúthe robots have already been pissed.‚Äù  It's hard to disagree with him, mostly on the market in this category almost everywhere are robots, zombies and mythical creatures.  I wanted something brighter and more peaceful.  I also had an obsession with using a physics engine in the game, firstly to make it easier to handle collisions, and secondly to add something non-standard and interesting. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/1e1/65b/85b/1e165b85b093c207c29f5d54c2babf61.png"></div><br>  As a result, the following plot was invented: instead of monsters and zombies walking along the map, I had fruit falling from the tree, instead of tower-robots, animal towers.  The trajectory of the fall of the fruit was set by branches growing on a tree and gravity.  Fruits on the way down bounced off the branches several times, their speed and direction changed, for the time they fell, the animal towers had to smash them. <br><br>  I made five kinds of towers: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/83a/876/14e/83a87614e54e71fd6de909d1b3b6f6f9.png" align="left">  Squirrel.  Throws nuts on the fruit, the usual tower, good attack speed and damage.  Despite the fact that the tower does not have any special abilities, it is very difficult to pass any level without it, it is useful both at the very beginning of the game and at the end. <br><br><img src="https://habrastorage.org/storage2/fa3/d3d/0ec/fa3d3d0ecc2f065a63193a408b19c2b8.png" align="left">  White fox.  It lets the fruit freeze a whirlwind into the fruit, thereby slowing down their falling speed.  Without this tower it is almost impossible to pass any level on difficulty other than easy.  Still, I could not completely do without magic, in my game I very much wanted a freezing tower. <br><br><img src="https://habrastorage.org/storage2/0fa/64c/60e/0fa64c60e3eccbd70ea4a187bad59601.png" align="left">  Red fox.  He shoots a bow with an arrow that flies through all the fruit in its path.  This tower must be set wisely, so that in one shot it hits the maximum amount of fruit.  On some levels there are key places under this tower, and the player‚Äôs task is to look at them. <br><br><img src="https://habrastorage.org/storage2/9f1/28f/d0e/9f128fd0e8791249f5ce9f8ed80b4198.png" align="left">  Hedgehog.  Shoots needles in all directions.  It has a small attack radius and damage, but due to the large number of needles it helps a lot in places where large clusters of fruits form, or where they rotate in a circle. <br><br><img src="https://habrastorage.org/storage2/0de/5b7/171/0de5b717146f93cea456289e2337e5ec.png" align="left">  Bear.  Throws stones that, when hit, repel and change the trajectory of fruit.  On some levels you can put it down in such a way that it will throw the surviving fruit upwards, allowing the rest of the towers to finish them off.  It can break a lot of wood, if you put it at the beginning of the level. <br><br><h4>  Box2d </h4><br>  I must admit, the Box2D engine made my life much easier.  Thanks to him, I had a beautiful fall of fruit in the game, detection by their towers and other collision checks.  Without Box2D there would be no bear.  I have a few ideas for new towers using a physics engine, such as a fox with arrows that are tied with a rope to a branch, if such an arrow hits a fruit, it will hang on a rope until it is broken by other towers.  You can come up with a lot of interesting things. <br><br>  Next, I will describe in which objects I used Box2D, and what properties needed to be set: <br><table><tbody><tr><th>  Title </th><th>  Box2D Properties </th><th>  Picture </th></tr><tr><td>  Fruit </td><td>  b2CircleShape <br>  b2_dynamicBody <br>  groupIndex = -1 </td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/be7/173/c27/be7173c275fb2269707f921336669875.png"></div></td></tr><tr><td>  Branch </td><td>  b2_staticBody <br>  b2PolygonShape </td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/838/779/093/8387790938aacf81ce8fcbcb44584242.png"></div></td></tr><tr><td>  Tower </td><td>  b2_staticBody <br>  b2CircleShape <br>  isSensor = true </td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/31b/4a5/10c/31b4a510c02284885aa0b4d9ca794a6b.png"></div></td></tr><tr><td>  Arrow </td><td>  b2_dynamicBody <br>  b2PolygonShape <br>  isSensor = true </td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/47e/6d4/768/47e6d4768ac2283448868c864e5667f9.png"></div></td></tr><tr><td>  A rock </td><td>  b2_dynamicBody <br>  b2CircleShape <br></td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/c81/263/b75/c81263b7533728d0611f45fd1b10ad8d.png"></div></td></tr><tr><td>  Walls, floor, <br>  ceiling </td><td>  b2_staticBody <br>  b2PolygonShape <br></td><td><div style="text-align:center;"><img src="https://habrastorage.org/storage2/b51/de9/075/b51de90758ad389320287cfeb3f9d56c.png"></div></td></tr></tbody></table><br>  <b>b2_staticBody</b> means that the object is motionless, gravity and other forces do not act on it.  This applies to towers, branches and borders. <br><br>  <b>b2_dynamicBody</b> specifies a moving object that can move and bounce off other objects.  All fruits and bullets are b2_dynamicBody. <br><br>  <b>isSensor = true</b> says that the object doesn‚Äôt exist, as it collides with it, other objects do not bounce, but pass through it.  When such an event occurs, the library makes it known that it is necessary for the situation when the fruit falls within the radius of the tower, or the arrow passes through the apple.  All fruits have the same negative <b>groupIndex</b> value, due to this they never collide with each other, but successfully bounce off branches and borders. <br><br>  <b>The b2CircleShape</b> object has a round shape, <b>b2PolygonShape</b> is a polygon shape, in my case all such objects are rectangles. <br><br>  I must admit that the Box2D implementation in Tower Defense was not an easy game, I ran into a lot of problems, for example, does any of you have any idea how to use the freezing tower with Box2D?  (in fact, the answer to this question requires solving a 9th grade physics problem and deserves a separate post).  A considerable amount of time was required to select the appropriate physical parameters for all objects.  But in the end everything turned out, and I can say with confidence: "Tower Defense + Box2D = Yeah!" <br><br><h4>  Result </h4><br>  I called my game <b>Forest Tower Defense</b> and laid it out <a href="https://market.android.com/details%3Fid%3Dcom.foresttd.free">on the android market</a> .  Anyone can download it for free.  You can also see screenshots and video for the game.  The graphics turned out to be cartoonish, so the children can also like the game. <br> <a href="https://market.android.com/details%3Fid%3Dcom.foresttd.free"><img src="https://habrastorage.org/storage2/ebd/065/1ab/ebd0651ab0b45bbeb8ed57608a2718df.png"></a> <br>  I advise all fans of Tower Defense games to try, because this is the only game of this genre with similar mechanics. <br><br>  I am very interested to hear your opinion, tips for improvement and ideas for new features. <br><br>  <b>UPD:</b> Development of the game was carried out according to the principle described <a href="http://habrahabr.ru/blogs/gdev/133897/">in this article</a> , so there is a <a href="">version for Windows</a> using Qt. </div><p>Source: <a href="https://habr.com/ru/post/136725/">https://habr.com/ru/post/136725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136718/index.html">Meridian Mobile is already available for download.</a></li>
<li><a href="../136720/index.html">Plugin for input mask numbers in input</a></li>
<li><a href="../136721/index.html">Red Hat: 2011 Results</a></li>
<li><a href="../136722/index.html">iPhonekino - video review of applications and games for the iPhone</a></li>
<li><a href="../136724/index.html">Casio CSF-5750. Color electronic notebook</a></li>
<li><a href="../136727/index.html">Startup Request: Kill Hollywood</a></li>
<li><a href="../136728/index.html">Next generation Wi-Fi - 802.11ac in brief</a></li>
<li><a href="../136735/index.html">Competent setting of the mail sending server for PHP scripts, setting up the mail () function</a></li>
<li><a href="../136736/index.html">The principle of domino or XSS on large sites runet</a></li>
<li><a href="../136737/index.html">Promotion experience in the Russian AppStore</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>