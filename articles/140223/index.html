<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running TechDays.ru in Clouds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On February 15, a remarkable event happened - our site TechDays.ru moved to the Windows Azure platform. 


 At the same time, the portal also acquired...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running TechDays.ru in Clouds</h1><div class="post__text post__text-html js-mediator-article">  On February 15, a remarkable event happened - our site <a href="http://techdays.ru/">TechDays.ru</a> moved to the Windows Azure platform. <br><img src="https://habrastorage.org/storage2/8a2/540/ada/8a2540ada6a9d11487f43567656ce56a.png"><br><br>  At the same time, the portal also acquired new functionalities that should be liked by both portal visitors and report authors: <br><ol><li>  The portal interface has been completely redesigned.  The new version is made in the Metro style.  The portal has become more modern, faster, more dynamic and more convenient to use.  It should be noted that work on improving the interface continues. </li><li>  Added video encoding service.  Now TechDays has become a full-fledged video hosting.  Previously, the video had to be encoded by the authors of the reports in several formats, now it happens automatically. </li><li>  Thanks to the encoding service, all videos are now available in h264 format and played using the HTML5 player.  Now reports from TechDays can be viewed on mobile devices, for example, on Windows Phone 7, on iPhone and iPad. </li></ol><br>  I was able to talk with <a href="http://www.techdays.ru/speaker/spugachev">Sergei Pugachev</a> , who was engaged in porting the portal to Windows Azure.  Sergey is a Silverlight MVP, as well as the founder of the Silverlighter.ru community.  Further I bring to your attention our interview. <br><a name="habracut"></a><br><br>  <b>Sergey, please tell us a little about the TechDays.ru portal?</b> <b><br></b> <br>  <a href="http://techdays.ru/">TechDays.ru</a> is a portal where you can find records of reports from technology conferences held by Microsoft in Russia, for example, DevCon, TechEd Russia, Platform, etc., as well as training videos on technologies and products from both Microsoft and Microsoft. and other vendors.  All reports can be viewed and downloaded absolutely free of charge and without registration. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most of the reports on TechDays were created by independent developers and system administrators, which is especially important since such reports are based on the practical experience of their authors.  More than 60,000 people visit TechDays.ru per month, and more than 185,000 users are registered.  Over the year, users view and download reports, more than 5,000,000 (five million) times, either directly from the site or through links to other sites. <br><br>  <b>When was the decision to transfer the site to Windows Azure?</b>  <b>How did you plan the migration process?</b> <br>  We migrated to the cloud gradually.  In early 2011, it was decided to transfer all the videos to Azure, which we implemented in a fairly short period of time, in just a week.  The reason for the transfer was the fact that Azure provides a very convenient data storage (Blob storage).  This storage has such advantages as infinite volume (at affordable prices per gigabyte of data), high availability, as well as excellent scalability.  Before transferring video to Azure, we constantly rested on either channel restrictions, disk system limitations, or server restrictions.  Now the channel is not a problem.  Thousands of users can download videos in parallel, without slowing down the speed of return. <br><br>  After that, in the fall of 2011, we decided to create a new version of the site engine using ASP.NET MVC / Razor technology (the old version used ASP.NET Web Forms), as well as rework the structure and interface of the site.  It was logical that the new version will work fully in Window Azure.  February 15, 2012 we launched this version. <br><br>  Porting the portal to Azure solved a number of problems.  First of all, we were able to adapt to increasing loads.  We really like the fact that in Azure there is no need to do manual configuration and administration of hardware and operating systems, configuration of NLB (Network Load Balancer) clusters and other things that took a lot of time before.  We simply indicate the number of virtual machines that we need at the moment.  And it works. <br><br>  We also use the functionality of test environments.  In Azure, there is a separation between Staging and Production.  We can roll out a new version on Staging, test it, and immediately transfer to Production.  In this case, everything at any time can be returned back. <br><br>  <b>Please tell us more about the architecture of the portal and about the used services and services of Windows Azure?</b> <b><br></b> <br>  We use most of the services provided by Azure.  We have a web-frontend (Web role) and backend (Worker role).  Backend is needed for video encoding and other utilitarian tasks.  Communication between parts of the application occurs asynchronously using queues.  In addition, the roles communicate with each other directly using WCF services.  It is necessary to control the process of encoding specific files. <br><br>  At the moment, the web-frontend, like the backend, consists of 2 medium virtual machines.  When transcoding video, we used up to 32 medium virtual machines on the backend in parallel, which made it possible to transcode all videos in just a couple of days.  The change in the number of used virtual machines is currently implemented manually, but we are working on automating this process so that resources are allocated depending on the number of video files waiting to be encoded. <br><br>  Another service we work with is Window Azure Cache.  This is a distributed and very fast cache, which is surprisingly easy to use in ASP.NET sites.  Including thanks to him, we were able to increase the productivity of the portal.  Another factor in increasing the speed of work was the use of a CDN.  Through the use of CDN, we can quickly give files to users anywhere in the world.  In many cases, the increase in speed when using CDN reaches more than two times. <br><br>  SQL Azure is used as data storage.  The name of the experience with SQL Server to understand SQL Azure was not difficult, in many ways, so SQL Azure is used so widely.  In addition, the database schema did not even have to be modified to work with SQL Azure.  Although all development was done on SQL Server 2008 R2. <br><br>  We are gradually increasing the share of another service provided by Azure for data storage, namely the Tables Storage service.  Tables are not relational storage, but it is convenient to work with them and they can store huge amounts of data.  In addition, storing data in tables is much cheaper than in SQL Azure.  While the tables we have used to store logs and service information. <br><br>  <b>Sergey, it turns out that in terms of cost, the transition was economically beneficial.</b>  <b>And what can you say about the DDos-attacks on techdays.ru, because in Windows Azure the payment goes on the fact of use and the actual load?</b> <br>  Yes, the transition to Azure has proven cost-effective.  You should not expect that using Azure will be cheaper than the simplest virtual hosting, but in our case, the cost of Azure turned out to be no more than the cost of building your own infrastructure.  However, many components of our own infrastructure were not fault tolerant. <br><br>  About DDoS, you can say the following.  On the one hand, the Windows Azure platform itself provides NLB and DDoS protection at the network level, but you still have to pay for the amount of resources that DDoS can withstand.  On TechDays, attacks are regularly carried out, and once, when we did not work in Azure, a DDoS attack brought the portal down for about a day.  The problem was in the network infrastructure.  The network infrastructure in Azure does not have such problems and can withstand a similar load.  But in any case, the number of virtual machines must be such as to withstand DDoS. <br><br>  In Azure, in general, there is always a choice, either to write faster code that can withstand heavy loads, or to pay for more resources.  We try to write optimized code in order to use as few resources as possible, and in case of high load we simply increase the number of virtual machines in a couple of minutes. <br><br>  And, of course, the fewer errors in the code and omissions, the more resistant your system is to threats.  It will take a lot of resources (which can not be found) to put a well-designed and ‚Äúcoded‚Äù site using DDos. <br><br>  <b>What are the main difficulties in the migration process?</b> <br>  The main difficulty was the difficulty of debugging code directly in Azure.  There were situations when the code worked on the emulator, but did not work in Azure.  With the release of the new versions of the SDK, these difficulties seriously leveled out.  I have been working with Azure since 2010, and the progress in the development of the SDK is amazing.  If earlier I lacked many things, now what I needed was already implemented.  And this is good news.  Naturally, not all my wishes were realized.  But the speed of development of the SDK pleasantly surprised me. <br><br>  Another difficulty was pouring data into SQL Azure.  Regular funds for the migration of large volumes of data yet.  Therefore, we used the <a href="http://sqlazuremw.codeplex.com/">SQL Azure Migration Wizard</a> , c <a href="http://codeplex.com/">http://codeplex.com</a> .  This product coped with its tasks. <br><br>  I would also like to note that for more than a year of my work with Azure, I had to contact technical support once and then on organizational and administrative matters. <br><br>  <b>The transition to Windows Azure can be called successful?</b> <b><br></b> <br>  Yes, the transition can be called successful.  We have seriously increased the speed of the portal and now we are not afraid of the influx of visitors.  Also rose uptime.  Now we can not think about the channel, hard drives, physical servers and infrastructure in general, so we have more time to create useful features for users. <br><br>  Sergey, thank you very much for your efforts on techdays.ru processing and interviews! </div><p>Source: <a href="https://habr.com/ru/post/140223/">https://habr.com/ru/post/140223/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140217/index.html">PHPUnit: Mock Objects</a></li>
<li><a href="../140219/index.html">Preparing rails environments for installing Redmine using RVM</a></li>
<li><a href="../140220/index.html">New Apple Office Floor Plans</a></li>
<li><a href="../140221/index.html">Corporate applications speed</a></li>
<li><a href="../140222/index.html">Smart pointers for beginners</a></li>
<li><a href="../140224/index.html">Antares mobile LTE network launched in test mode in Moscow (more than 80 megabits per second)</a></li>
<li><a href="../140225/index.html">Extending the functionality of the input type = ‚Äùtext‚Äù element to autocompet</a></li>
<li><a href="../140226/index.html">Droider Show # 32. Confucius against!</a></li>
<li><a href="../140227/index.html">habrAllHub - a toggle between All Blogs and My Favorite Blogs</a></li>
<li><a href="../140228/index.html">Video tutorial on creating an online store for MODX Revolution + Shopkeeper. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>