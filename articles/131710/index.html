<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About some techniques of attack Man in the middle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A bit of Wikipedia: the man-in-the-middle attack (Man in the middle, MitM attack) is a cryptographic term for a situation in which an attacker is able...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About some techniques of attack Man in the middle</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://secure.wikimedia.org/wikipedia/ru/wiki/%25D0%25A7%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B5%25D0%25BA_%25D0%25BF%25D0%25BE%25D1%2581%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B5">A bit of Wikipedia:</a> <i>the man-in-the-middle attack (Man in the middle, MitM attack) is a cryptographic term for a situation in which an attacker is able <b>to read</b> and alter messages that are exchanged by correspondents at will. guess his presence in the channel.</i> <br>  In this article, we will consider accepting a passive attack on an http connection, without modifying the passing information.  So, somehow you were able to wedge physically or remotely into the data transmission channel, set up a bridge, or simply got root-control of the gateway.  The rootkit was installed, the source databases were leaked, the web shell was filled, the time bomb was put in cron, and what now? <br><a name="habracut"></a><br>  Let's make a reservation that this article does not discuss methods of hacking a secure connection, for example, SSL.  We also do not tell how we raped this very root-access, leave room for intrigue.  Access without root rights does not make sense, as the utilities described below require high privileges. <br><br><h6>  So where do we start now? </h6>  And immediately comes to the aid of the <a href="http://www.circlemud.org/jelson/software/tcpflow/">utility tcpflow</a> .  With it, we will be able to record web session authorization hashes, cookies and passing data as well as to grab most files, such as pictures, archives, multimedia. <br>  Through issuing the <i>ifconfig</i> command, we find out which interfaces are in the system, through <i>route we</i> find out how traffic flows with us.  In the case of a gateway, we will have at least two interfaces, one of which, as a rule, looks to the internal network, the other ‚Äúoutwards‚Äù.  The only thing we need to know and always remember is that the incoming connection from the local network will be outgoing in the "external" interface. <br>  So, grab some http connections, for example, from the ‚Äúinternal‚Äù interface: <br>  <i>#tcpflow port 80 -i eth1</i> <br><br>  Numerous session files are being created in the current directory.  Remember that thanks to the <a href="https://secure.wikimedia.org/wikipedia/en/wiki/HTTP_persistent_connection">keepalive technology</a> , several requests can be made in one connection, which means that they can be written several in one file.  The files contain the headers of both the http-headers and the transmitted ones.  It looks like this: <br>  <i>HTTP / 1.1 200 OK</i> <i><br></i>  <i>Date: Tue, 01 Nov 2011 12:25:18 GMT</i> <i><br></i>  <i>Server: Apache</i> <i><br></i>  <i>Last-Modified: Wed, Sep 14 2011 03:48:00 GMT</i> <i><br></i>  <i>ETag: "1111111-22222-333333333"</i> <i><br></i>  <i>Accept-Ranges: bytes</i> <i><br></i>  <i>Content-Length: 4451</i> <i><br></i>  <i>Keep-Alive: timeout = 15, max = 100</i> <i><br></i>  <i>Connection: Keep-Alive</i> <i><br></i>  <i>Content-Type: image / png</i> <i><br></i>  <i>.PNG ... IHDR ....... d ....., T + 3 .... gAMA .... 7 ....... tEXtSoftware.Adobe ImageReadyq.e &lt;... .PLTE ........ 2..j ..... * .. N .. \ ...........&gt; ............ .. &amp; .. V ........ $ ........ R..l ..: .................... .mm .................. r ....., ........ B ...... uu. {{.... ................. a .. \ .................! ........ z .... } ........ l..7..H..u..M ..... d ..... A .. = ............. ....... &amp; ff .......... ~~ ...... | ........... U ..-........ ..................... | ........ c..E ...</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Filtration </h6>  Let's try to filter the data by line containing the authorization data. <br>  <i>#egrep -ir "Authorization | Cookie" ./</i> <br>  The extradition will look something like this. <br><img src="https://habrastorage.org/storage1/430f19d8/71660b0d/3413daa2/4d0a0c97.jpg"><br>  Sorry for the quality, the screen of the working server. <br>  Everything is simple with cookies; it‚Äôs enough to drive them into your browser through <a href="https://addons.mozilla.org/ru/firefox/search/%3Fq%3Dcookie%2Beditor">some cookie editor</a> to steal a session.  It should be remembered that sometimes cookies are tied to the client‚Äôs IP address and even to its <a href="https://secure.wikimedia.org/wikipedia/en/wiki/User_agent">User Agent</a> , so simply removing the cookie will not do anything.  It's easy to decode <a href="httpd.apache.org/docs/1.3/howto/auth.html">HTTP AUTH</a> in just a few types: <br><ol><li>  Basic, a couple login: the password is transmitted encoded base64.  In this case, take a line from Authorization and decode it in the base64 decoder, we get a line of the form username: password </li><li>  <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Digest_access_authentication">Digest, passed the hash from the MD5 function (username: realm: password)</a> .  It's more complicated here.  You can try using <a href="https://encrypted.google.com/search%3Fq%3Drainbow%2Btables">rainbow-tables to</a> find all matches of the strings of the form ‚ÄúA: B: C‚Äù, where A is the login, B is the realm, and C is the password.  There should be not so many such coincidences, so that it would be impossible to sort them out later. </li><li>  Other: Public key, Kerberos, TLS / SSL - not considered. </li></ol>  We are also interested in all cases of sending <a href="https://secure.wikimedia.org/wikipedia/en/wiki/HTTP%252BHTML_form-based_authentication">the HTTP POST method</a> , it often contains authorization data on the pages. <br>  <i>#egrep -rnH "POST" ./</i> <br>  <i>POST /auth.php HTTP / 1.1</i> <i><br></i>  <i>Host: blabla.ru</i> <i><br></i>  <i>User-Agent: Mozilla / 5.0 (Windows NT 5.1; rv: 7.0.1) Gecko / 20100101 Firefox / 7.0.1</i> <i><br></i>  <i>Accept: text / html, application / xhtml + xml, application / xml; q = 0.9, * / *; q = 0.8</i> <i><br></i>  <i>Accept-Language: ru-ru, ru; q = 0.8, en-us; q = 0.5, en; q = 0.3</i> <i><br></i>  <i>Accept-Encoding: gzip, deflate</i> <i><br></i>  <i>Accept-Charset: windows-1251, utf-8; q = 0.7, *; q = 0.7</i> <i><br></i>  <i>DNT: 1</i> <i><br></i>  <i>Connection: keep-alive</i> <i><br></i>  <i>Referer: https://bla.ru/auth.php</i> <i><br></i>  <i>Cookie: __utma = 25445499.32598290.132041700.132014354.132015499.3;</i>  <i>__utmc = 25445439;</i>  <i>__utmz = 25445499.132014100.1.1.utmcsr = (direct) | utmccn = (direct) | utmcmd = (none);</i> <i><br></i>  <i>Content-Type: application / x-www-form-urlencoded</i> <i><br></i>  <i>Content-Length: 72</i> <i><br></i>  <i><b>text = blabla &amp; login = username &amp; password = ololo &amp; wefo = onPOST /bla.php HTTP / 1.1</b></i> <br><br><h6>  File Capture </h6><br>  Also tcpflow in conjunction with the <a href="https://encrypted.google.com/search%3Fq%3Dforemost%2Blinux">foremost utility is</a> useful to intercept files, or rather extract them from an array of raw captured data.  To do this, it is enough to set the foremost on the tcpflow files that have been ripped off: <br>  <i># foremost ./*</i> <i><br></i>  <i># ls -la ./output/</i> <i><br></i>  <i>total 48</i> <i><br></i>  <i>drwxr-xr-- 5 root root 4096 Nov 1 18:01.</i> <i><br></i>  <i>drwxr-xr-x 3 root root 32768 Nov 1 18: 01 ...</i> <i><br></i>  <i>-rw-r - r-- 1 root root 0 Nov 1 18:01 audit.txt</i> <i><br></i>  <i>drwxr-xr-- 2 root root 4096 Nov 1 18:01 flv</i> <i><br></i>  <i>drwxr-xr-- 2 root root 4096 Nov 1 18:01 html</i> <i><br></i>  <i>drwxr-xr-- 2 root root 4096 Nov 1 18:01 php</i> <br><br>  It also suddenly turned out that using this utility, <a href="https://encrypted.google.com/search%3Fq%3Dforemost%2B%25D0%25B2%25D0%25BE%25D1%2581%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">you can recover files</a> from broken media, since it is good at detecting files by signatures.  For example, in <i>foremost.conf</i> you can even set custom file type signatures. <br><br><h6>  Other examples of work </h6><br>  Interception of FTP connections on the snup gateway: <br>  <i>#tcpflow 'gateway snup and (port ftp or ftp-data)'</i> <br>  Interception of unencrypted mail traffic: <br>  <i>#tcpflow tcp port 110</i> <i><br></i>  <i>#tcpflow tcp port 25</i> <i><br></i> <br>  The <i>tcpxtract</i> <a href="http://tcpxtract.sourceforge.net/">utility</a> performs the <i>same</i> function as <a href="http://tcpxtract.sourceforge.net/">tcpflow</a> .  There is also <a href="http/">a sidestream utility httpflow</a> , but it is used mainly for debugging http connections. <br><br><h6>  findings </h6><br>  Thus, we have shown that having physical or remote root access to the channel, without education and complex knowledge, with the help of simple utilities you can intercept any user data.  The article is more an overview, since I did not want to write another soulless "download-compile".  For inquisitive people, this is no good, they already understand what they want, and the beginner is simply obliged to study all the material mentioned in the article and use the search. <br><br><h6>  What I failed </h6><br><ol><li>  Put a bunch of utilities through the <a href="https://secure.wikimedia.org/wikipedia/ru/wiki/%25D0%259F%25D0%25B5%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B0%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%2528UNIX%2529">pipe</a> tcpflow |  foremost.  Apparently, they are not so friendly with each other. </li><li>  To extract using html files compressed with <i>Accept-Encoding: <a href="https://encrypted.google.com/search%3Fq%3Dapache%2Bgzip">gzip, deflate</a></i> using foremost, it is obvious that foremost does not support decoding of this kind.  I did not find utilities for this during a quick search.  However, this can be done manually, for each file it is necessary to trim the http headers and feed them via sdtin to gzip / tar / deflate. </li></ol><br><br><h6>  Useful literature: </h6><br>  #man foremost <br>  #man tcpflow <br>  #man tcpxtract <br>  <a href="http://www.voidspace.org.uk/python/articles/authentication.shtml">www.voidspace.org.uk/python/articles/authentication.shtml</a> <br>  <a href="https://secure.wikimedia.org/wikipedia/ru/wiki/%25D0%25A7%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B5%25D0%25BA_%25D0%25BF%25D0%25BE%25D1%2581%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B5">secure.wikimedia.org/wikipedia/en/wiki/%D0%A7%D0%B5%D0%BB%D0%BE%D0%B2%D0%B5%D0%BA_%D0BB % 81% D0% B5% D1% 80% D0% B5% D0% B4% D0% B8% D0% BD% D0% B5</a> <br>  <a href="https://secure.wikimedia.org/wikipedia/ru/wiki/%25D0%25A1%25D0%25BD%25D0%25B8%25D1%2584%25D1%2584%25D0%25B5%25D1%2580">secure.wikimedia.org/wikipedia/en/wiki/%D0%A1%D0%BD%D0%B8%D1%84%D1%84%D0%B5%D1%80</a> <br>  <a href="http://www.circlemud.org/jelson/software/tcpflow/">www.circlemud.org/jelson/software/tcpflow</a> <br>  <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Digest_access_authentication">secure.wikimedia.org/wikipedia/en/wiki/Digest_access_authentication</a> <br>  <a href="https://encrypted.google.com/search%3Fq%3Dforemost%2Blinux">encrypted.google.com/search?q=foremost+linux</a> <br>  <a href="http://www.debian-administration.org/articles/558">www.debian-administration.org/articles/558</a> <br>  <a href="http://stackoverflow.com/questions/2866864/extract-payload-from-tcpflow-output">stackoverflow.com/questions/2866864/extract-payload-from-tcpflow-output</a> <br>  <a href="http://tcpxtract.sourceforge.net/">tcpxtract.sourceforge.net</a> <br>  A set of tools for analysis and hacking <a href="http://www2.opensourceforensics.org/tools/unix">www2.opensourceforensics.org/tools/unix</a> <br>  <a href="http://serversniff.blogspot.com/2009/08/extracting-files-from-tcpdump.html">serversniff.blogspot.com/2009/08/extracting-files-from-tcpdump.html</a> </div><p>Source: <a href="https://habr.com/ru/post/131710/">https://habr.com/ru/post/131710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131704/index.html">Introduction to Structure Synth</a></li>
<li><a href="../131705/index.html">Director of Chronopay admitted in a DDoS attack</a></li>
<li><a href="../131707/index.html">Change the life</a></li>
<li><a href="../131708/index.html">The new IM + 5.6 - the thirteenth supported communication protocol has become ... Mail.ru Agent</a></li>
<li><a href="../131709/index.html">Developer Meeting in Moscow</a></li>
<li><a href="../131712/index.html">Back mask</a></li>
<li><a href="../131713/index.html">Stack variables - fast and sometimes dead</a></li>
<li><a href="../131714/index.html">Javascript inheritance for dummies</a></li>
<li><a href="../131715/index.html">MonoDevelop 2.8.2 released</a></li>
<li><a href="../131716/index.html">Waiting for user reaction to Dialog in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>