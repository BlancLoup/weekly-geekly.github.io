<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building scalable applications in TypeScript. Part 1 - Asynchronous Module Loading</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea of ‚Äã‚Äãthis article was born after a hard day at 30 degrees in the office and serious thoughts and holivars on the topic: ‚ÄúHow should a modern ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building scalable applications in TypeScript. Part 1 - Asynchronous Module Loading</h1><div class="post__text post__text-html js-mediator-article">  The idea of ‚Äã‚Äãthis article was born after a hard day at 30 degrees in the office and serious thoughts and holivars on the topic: ‚ÄúHow should a modern web application be built?‚Äù <br><br>  And then the thought occurred to me to state my process of working on the Habr√© task.  And I myself will understand to the smallest detail, and will contribute to the knowledge of the community. <br><br>  What will be discussed in this article?  I will write a (not) large TypeScript application that will implement a modular architecture, asynchronous module loading, an abstract event model, and update the state of modules upon the occurrence of certain events.  This article will act as a diary and journal of my actions and reflections.  My personal goal is to create some working prototype, the experience of which I later could use as part of a real project.  The code will be written as accurately as possible and close to the requirements of the actual development.  Explanations will be given as if it will then be read by the juniors working under my leadership, who have never written such systems before. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The article will be broken into pieces, which I will lay out to the public as ready.  The first part is devoted to the general formulation of the problem, the modules and their asynchronous loading. <br><br>  So, giving myself and the community these promises, turning on AC / DC and collecting my thoughts, I will proceed. <a name="habracut"></a><br><br>  Part 2: <a href="http://habrahabr.ru/post/185160/">Building Scalable Applications in TypeScript.</a>  <a href="http://habrahabr.ru/post/185160/">Part 2 - Events or why you should reinvent your own bike</a> <br><br>  Part 2.5: <a href="http://habrahabr.ru/post/185290/">Building Scalable Applications on TypeScript - Part 2.5.</a>  <a href="http://habrahabr.ru/post/185290/">Bug fixes and delegates</a> <br><br><h5>  Used software and other notes </h5><br>  In this article, I will use Visual Studio Express 2012 for Web with all the latest updates as a working tool.  The reason is the only IDE with adequate TypeScript support for today. <br><br>  About the most TypeScript.  A three-month experience with TS 0.8.3 shows that TS is a really working tool for creating really large web applications with tens of thousands of lines of code.  Static code analysis actually reduces the number of errors by an order of magnitude.  We also have almost full-fledged classic OOP with us, real language-level modularity, which allows to integrate transparently with Require.js and Node.js, IntelliSense in Visual Studio, and indeed, the ideology clearly gives away C #, which is extremely close to me.  Transparent transformation TS to JS allows you to easily debug the code even without the help of sourcemaps, although they are present.  For writing this article I will use the latest version - 0.9 with generics and other goodies. <br><br>  Require.js will be used to implement asynchronous loading.  Node.js will be used to simulate the server side. <br><br>  As a ‚Äústandard library‚Äù, jQuery 1.10 (we need IE8 compatibility) and Underscore.js will be connected to the project.  Backbone.js will be the basis for the interface for us.  Header d.ts files are used from the standard delivery of TS (jQuery) and from the project DefinitelyTyped - <a href="https://github.com/borisyankov/DefinitelyTyped">github.com/borisyankov/DefinitelyTyped</a> (Require.js, Underscore, Backbone, Node.js). <br><br>  To play AC / DC, WinAmp is used. <br><br><h5>  A bit of TypeScript </h5><br>  The program on TS consists of a set of * .ts and * .d.ts files.  They can be represented as some analogues of * .cpp and * .h files from C ++.  Those.  the first ones contain the real code, the second ones describe the interfaces that the implementation file of the same name provides.  For development purely on TS header d.ts files are not needed.  Also, d.ts is not compiled into anything and is not used in runtime.  But d.ts files are indispensable for describing existing JS code.  Since  TS is completely converted to JS, it can fully use any JS code, but the compiler needs to be aware of the types, variables and functions that are used in JS.  The .ts files just serve the purpose of this description.  I will not stop in more detail, everything is in the TS specification. <br><br>  In general, when compiling example.ts, the following files can be created: <br><ul><li>  example.d.ts - header file for use in other projects </li><li>  example.js - JS for use in runtime </li><li>  example.map.js - sourcemap for debugging </li></ul><br><br><h5>  Project structure </h5><br>  Create a TypeScript project in Visual Studio: <br><br><img src="https://habrastorage.org/storage2/091/f8e/b3d/091f8eb3d1abb56b4606ab8fc32242e6.png" alt="image"><br><br>  I will publish all source codes on CodePlex: <a href="https://tsasyncmodulesexampleapp.codeplex.com/">tsasyncmodulesexampleapp.codeplex.com</a> . <br><br>  Add the default code, create the 2nd project - Server, connect all the necessary source files of libraries and get the following structure: <br><br><img src="https://habrastorage.org/storage2/c84/a2f/b5c/c84a2fb5cf078b88ed767bd878c42fa9.png" alt="image"><br><br>  Practice shows that d.ts files for shared libraries are best brought to the same level as projects, since  then it will be terribly useful when writing tests, but more on that another time, and also if several projects use the same libraries. <br><br>  Here you should talk a little bit about how to build a TypeScript project in and without Visual Studio.  In the first case, the studio does everything for the developer, passing the files to the compiler one by one if they are not referenced.  Those.  all ts files will always be compiled.  If we build the project from the command line, it is necessary that the build starts with a file that has links to all other files.  Usually I create in the project root the file Build.d.ts, containing ////&gt;, i.e.  links to all project files that need to be compiled and passed to the compiler via the console, since  This way allows you to control the settings of the TS compiler much more flexibly than the current plugin in the studio, which we will definitely need in the future. <br><br>  Node.exe and the full TS distribution kit have been added in order not to be tied to the studio and other installed software when getting acquainted with the project.  Cmd files for easy launch and integration with the studio I will write later. <br><br><h5>  Description of the training task </h5><br>  As an educational example, I will write a simple client for a personal messaging system on a site consisting of several independent interface components, some intermediate layer for uploading data to the server and a fake server to simulate hectic activity.  Communication with the server will occur through restful services, the quality writing of which is not the main task.  Enough for them to work.  The system will have 2 screens - a short list of the last 3 messages and a full client screen.  There will also be some menu that allows you to switch between them.  Authorization, etc.  In this article I will not consider. <br><br>  Screens are completely autonomous modules that do not know about each other, but know about the data access layer.  All screens and data access objects are wrapped in separate modules, loaded asynchronously and communicate with each other by publishing and subscribing to events through some event manager, i.e.  according to the publisher / subscriber pattern. <br>  Configuring modular loading <br><br>  Everything is very simple.  We add the following code to the App.ts file of the Client project, which we received by default: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Main(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { alert(<span class="hljs-string"><span class="hljs-string">'Main'</span></span>); } }</code> </pre> <br><br>  Create a file RequireJSConfig.ts in the project root: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;reference path="../Lib/require.d.ts" /&gt; /// &lt;reference path="App.ts" /&gt; require(["App"], function(App: any) { App.App.Main(); });</span></span></code> </pre><br><br>  Default.htm: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>TSAsyncModulesExampleApp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/jquery-1.10.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/underscore-min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/backbone.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/require.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-main</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RequireJSConfig"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Run the application: <br><br><img src="https://habrastorage.org/storage2/e01/bd2/119/e01bd2119f321fbb98fc25cc963938aa.png" alt="image"><br><br>  Congratulations, we got an application with asynchronously loaded modules. <br><br>  Let us dwell on what we have done in more detail. <br><br>  Firstly, it is worthwhile to dwell on how files are compiled in TS.  If the file contains an export directive, it means that it will definitely be compiled into a CommonJS or AMD module, depending on the compiler settings.  By default, compilation in VS comes in AMD format, which is more than satisfactory in terms of the use of Require.js.  TS completely eliminates the need to write the "creepy" manual code of the AMD module wrapper and takes care of the correct installation of dependencies.  This is the behavior we see for App.ts: <br><br><pre> <code class="javascript hljs">define([<span class="hljs-string"><span class="hljs-string">"require"</span></span>, <span class="hljs-string"><span class="hljs-string">"exports"</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">require, exports</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> App = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } App.Main = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'Main'</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> App; })(); exports.App = App; }); <span class="hljs-comment"><span class="hljs-comment">//@ sourceMappingURL=App.js.map</span></span></code> </pre><br><br>  RequireJSConfig.ts does not contain export directives and compiles into the usual "flat" JS: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;reference path="../Lib/require.d.ts" /&gt; /// &lt;reference path="App.ts" /&gt; require(["App"], function (App) { App.App.Main(); }); //@ sourceMappingURL=RequireJSConfig.js.map</span></span></code> </pre><br><br>  Comments remain in the code solely for debugging purposes, since  I have a Debug build mode for the application.  In Release configuration, everything will be cleared of comments. <br><br>  But back to our bar ... modules.  What happened: <br><br><ol><li>  Booted default.htm </li><li>  Css and statically given js files were loaded, which have no sense, in my subjective opinion, to load asynchronously, since  they are needed by almost all modules that we will create. </li><li>  Among js in clause 2 require.js was loaded </li><li>  Require.js read the data-main = "RequireJSConfig" attribute value and loaded the corresponding JS file, which is treated as the starting one. </li><li>  In RequireJSConfig, we use the require method in the global context for the first and last time.  Further, all module calls must come from other modules. </li><li>  In the require function, we say that after loading the App module (the first parameter), you need to call a callback, where to transfer the loaded module as a variable of the same name.  Here we make a deal with a conscience and do not type it in TS, because  At this point, there is a conflict between the ideology of partitioning into modules in TS and the specific implementations of Require.js, as the manager of asynchronous script loading.  More details below. </li><li>  Require.js loads the App module.  You can read about module naming conventions in detail in the documentation for Require.js.  In short, we specify the path from the root, which we can specify different from the root of the site, which we use by default, omitting the file extension.  Next, RequireJS loads each dependent file as a script tag using head.appendChild ().  The loading of the required module occurs last, i.e.  after dependencies, which means that we can always be sure that all dependencies are always loaded.  Require.js and TS work on this issue in a fully coordinated manner.  The syntax and compilation process of TS is specifically adapted for this scenario. </li><li>  The callback passed to the require method calls the static Main method, the App class, of the App module. </li><li>  Called alert ('Main'); </li></ol><br><br>  The callback parameter of the require method is not typed due to the fact that this type is not known in this context to the TS compiler.  To type it, you need to use a TS construct of the following form: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'App'</span></span>);</code> </pre> <br><br>  This design can only be used in the context of a module for loading other modules and leads to the formation of corresponding dependencies in the AMD / CommonJS module wrapper, which we don‚Äôt have here, because  we have the usual flat code, without wrappers, i.e.  we get a contradiction.  In other words, TS is fully consistent with Require.js in the area of ‚Äã‚Äãgenerating code for modules, but does not support the script loading the first module.  Therefore, in this situation, the only thing left for us to do is to roll back to using the good old approach in the style of vanilla JS. <br><br><h5>  Loading additional modules </h5><br>  So, we loaded the first module, called the Main method, the application started working.  According to our training TZ, we should be able to load an arbitrary number of modules.  But before you start downloading, you need to understand what a module in TS is: <br><br><ul><li>  First, it is an autonomous part of the application, a piece of code that implements the module pattern, exporting functions and variables to the outside.  In this case, the entire implementation is hidden from the outside world.  In fact, this is pure encapsulation. </li><li>  Secondly, the module after loading is assigned to a variable.  Those.  we can work with it as with an object.  In essence, a module is an object in terms of JS. </li><li>  Thirdly, the module is a file. </li><li>  Fourth, a module is a namespace for TS.  There may be non-exported modules declared inside other modules that implement namespaces in their pure form.  Those.  modules can have an unlimited number of nesting levels, but only a top-level module can be converted to an AMD / CommonJS module and converted to an offline file. </li></ul><br><br>  In fact, the module is all at once.  The use of modules is also ambiguous.  The only thing that can be said for sure is that the modules break the application into autonomous, reusable components, which fully meets our goals. <br><br>  Let's create a new Framework / Events.ts file, which we will use as a starting point in the future to implement our abstract event model: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IEventPublisher { On(); Off(); Trigger(); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventPublisherBase</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IEventPublisher</span></span></span><span class="hljs-class"> </span></span>{ On() { } Off() { } Trigger() { } <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { alert(<span class="hljs-string"><span class="hljs-string">'EventPublisher'</span></span>); } }</code> </pre> <br><br>  While all methods are just stubs.  The principle of work is important for us. <br><br>  Change App.ts: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Events = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'Framework/Events'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Main(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Events.EventPublisherBase(); } }</code> </pre> <br><br>  We have a loading directive for the module: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Events = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'Framework/Events'</span></span>);</code> </pre> <br><br>  The path is indicated from the root.  As it was written above, the module is assigned to a variable.  Next, we create a new instance of the EventPublisherBase class, from the Events namespace, in which we have declared an alert in the constructor: <br><br>  At the same time, the Events variable is strongly typed.  The compiler strictly keeps track of the types of loadable modules.  It should be noted that the compiler does not need a reference directive to control types in modules, but it is necessary for it to compile correctly.  Those.  the compiler will not be able to track dependencies without it.  Now VS does the work for the compiler, substituting file names for it explicitly.  This can be solved by creating the above-mentioned Build.d.ts file by running a compilation against it: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;reference path="Framework/Events.ts" /&gt; /// &lt;reference path="App.ts" /&gt; /// &lt;reference path="RequireJSConfig.ts" /&gt;</span></span></code> </pre><br><br>  An example cmd file (Build-Client.cmd) that can be used for compilation is attached at the root of the solution. <br><br>  Actually, in terms of asynchronous loading, that's all.  Everything is very simple and just works. <br><br>  I hope my grafomansky opus will be interesting to the community.  In the next part of the article I plan to consider the issues of building an abstract event model and the reasons for its use in asynchronous web applications. <br><br>  Thank you all for reading to the end! </div><p>Source: <a href="https://habr.com/ru/post/184942/">https://habr.com/ru/post/184942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184928/index.html">The network posted 34-gigapixel panorama of Prague</a></li>
<li><a href="../184930/index.html">Post-mortem: Baldur's Gate: Enhanced Edition</a></li>
<li><a href="../184934/index.html">Review Parrot Asteroid Tablet - the most "car" Android</a></li>
<li><a href="../184938/index.html">The administration of VKontakte with the attackers blocking popular communities</a></li>
<li><a href="../184940/index.html">Translating the D-Link DIR-320 into a 3G router</a></li>
<li><a href="../184946/index.html">Why I refused to use the Vkontakte API</a></li>
<li><a href="../184950/index.html">Turning on the server using a mobile phone from the outside world</a></li>
<li><a href="../184952/index.html">Build CLDC HotSpot Implementation for ARM</a></li>
<li><a href="../184954/index.html">Windows 8.1 (aka Blue) Preview available for download</a></li>
<li><a href="../184956/index.html">Parsing a CSV file with bash and awk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>