<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introducing Firebase: writing a simple social application on Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the unexpected decision of Facebook to close Parse, a lot of developers wondered what to use instead. Today it is almost impossible to imagine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introducing Firebase: writing a simple social application on Swift</h1><div class="post__text post__text-html js-mediator-article">  Due to the unexpected decision of Facebook to close Parse, a lot of developers wondered what to use instead.  Today it is almost impossible to imagine a completely autonomous application that would be useful to everyone.  In this regard, iOS developers in their work use the tools and resources provided by Apple to access data.  Backend-as-a-service, or abbreviated as BaaS is a terrific tool for developers. <br><br>  Among the best and most popular BaaSs are Firebase from Google.  Essentially, Firebase is certainly awesome in performance, implementation and operation.  Firebase serves as a database that changes in real time and stores data in JSON.  Any changes in the database are immediately synchronized between all clients, or devices that use the same database.  In other words, an update in Firebase happens instantly. <br><br>  Together with the repository, Firebase also provides user authentication, and therefore all data is transmitted over a secure SSL connection.  We can choose any combination of email and password for authentication, be it Facebook, Twitter, GitHub, Google, or something else. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to the iOS SDK, Firebase has an Android SDK and JavaScript.  All platforms can use the same database. <br>  It‚Äôs hard to imagine that Firebase with all these features is a budget solution. <br><br>  At the time of this writing, the Firebase free package can handle up to 100 simultaneous connections.  This is quite enough for the work of a popular application.  For $ 49 per month there are no restrictions on network activity. <br><a name="habracut"></a><br><h3>  FirebaseJokes application </h3><br>  Today we will create an application with which the user can post various jokes using Firebase.  In the application, you can create your account using email and password.  It will also be possible to post jokes, the displayed list of jokes will be instantly updated.  When another user posts a new joke, the list with jokes will also be updated.  Even in the application, we will add a voting function and the funniest jokes will receive the points they deserve. <br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/firebase_screenshots.png" alt="image"><br><br>  Here is a list of functions that we implement in the FirebaseJokes application: <br><ul><li>  Account creation </li><li>  Login with email and password </li><li>  Sign Out </li><li>  Registration pass for registered users </li><li>  Adding new jokes </li><li>  Loading jokes in UITableView indicating the author and the number of votes </li><li>  Ability to vote for a joke </li></ul><br>  Let's see the <a href="">starting project</a> . <br><br>  First, open the Main.Storyboard to get a visual representation of the application. <br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/storyboard.png" alt="image"><br><br>  During the development of the application, we will in practice test the functionality of Firebase and the fact that it is very simple to use.  We will have a good time creating FirebaseJokes. <br><br><h3>  Time to get to know Firebase </h3><br>  Go to the <a href="https://www.firebase.com/">Firebase</a> page and register an account in Firebase, or go to an existing one.  We can also register using a GOOGLE account.  After registration, we can get 5 minute training, but it is intended for applications written in JavaScript. <br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/firebase.jpg" alt="image"><br><br>  To see what's in Firebase, click the Manage App in the My First App.  This new medium is known as Firebase Forge.  This is a cool debugger, and therefore it is worth going through it.  The Forge tutorial will help you in creating keys, values, and even child nodes using the plus symbol.  It makes sense to look at JSON, right?  To exit Forge's short tutorial, click on the toolbar in the upper left corner of the screen. <br><br><h3>  Creating a new application </h3><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/create_new_app.png" alt="image"><br><br>  Time to create FirebaseJokes.  On the left of the My First App, click on the transparent rectangle to create a new application.  In the APP NAME field, enter ‚ÄúJokes‚Äù, in the APP URL, enter ‚Äújokes-your-name‚Äù, where ‚Äúyour-name‚Äù is your own name.  The field must be unique, because  This is the url for your application.  Click CREATE NEW APP and after the Manage App. <br><br>  And here is our own Forge screen.  When adding data here they are automatically updated in our application.  We can also add data for the application in the Forge tab.  To understand how our application works, in terms of data, we will enter some data manually. <br><br><ol><li>  Click ‚Äú+‚Äù in the jokes-your-name row. </li><li>  Enter ‚Äújokes‚Äù in the name field. </li><li>  Press "+" in a row with a new joke. </li><li>  Enter a random value in the name field. </li><li>  Click the "+" in a row with a random value. </li><li>  Enter ‚ÄújokeText‚Äù in the name field. </li><li>  Enter ‚Äúwhat did one computer say to the other?  11001001010101 ‚Äùin the value field. </li></ol><br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/forge_data.png" alt="image"><br><br>  Here is an example of what the jokes object looks like.  We will add new jokes to the ‚Äújokes‚Äù object.  We also need the ‚Äúusers‚Äù object.  Observing how the data created by the application is changing in Forge is interesting and at the same time it is a great practice. <br><br>  I want to note that all data in the Firebase database is stored as JSON.  Unlike Parse, there are no tables and records.  When we add data to the Firebase database, it becomes the key of the JSON structure.  For example, the data you just created looks like this: <br><br><pre><code class="objectivec hljs">{ <span class="hljs-string"><span class="hljs-string">"jokes"</span></span> : { <span class="hljs-string"><span class="hljs-string">"e32e223r44"</span></span> : { <span class="hljs-string"><span class="hljs-string">"jokeText"</span></span> : <span class="hljs-string"><span class="hljs-string">"What did one computer say to the other? 11001001010101"</span></span> } } }</code> </pre> <br>  Now that you have a basic knowledge of the data in the Firebas database, it's time to move on. <br>  But before we proceed to user authentication, we will delete the created data, just as we will do it programmatically from the application. <br><br>  For FirebaseJokes, we use Email authentication and password.  To enable this feature, click Login &amp; Auth on the left pane in Forge.  In Email &amp; Password, tick Enable Email &amp; Password Authentication.  Immediately under the pressed cell is information about password recovery.  Also, pay attention to other authentication options. <br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/user_auth.png" alt="image"><br><br><h3>  Add Firebase SDK </h3><br>  To get the base url for the application, return to the Forge main screen.  The current url is the url for the application, so copy and paste it into BASE_URL in Constants.swift Xcode. <br><br><pre> <code class="objectivec hljs">import Foundation let BASE_URL = <span class="hljs-string"><span class="hljs-string">"https://jokes-matt-maher.firebaseio.com"</span></span></code> </pre><br>  It's time to add the Firebase SDK to the application.  Before this you need to install CocoaPods.  If you have not installed it yet, you can find instructions for installing CocoaPods. <br><br>  When CocoaPods is installed, open a terminal.  Run the following commands to establish Cocoapods in the Xcode project: <br><br><pre> <code class="objectivec hljs">cd &lt;your-xcode-project-directory&gt; pod init</code> </pre><br>  Then enter the following command to open the Podfile in Xcode: <br><pre> <code class="objectivec hljs">open -a Xcode Podfile</code> </pre><br>  Edit it: <br><br><pre> <code class="objectivec hljs">platform :ios, <span class="hljs-string"><span class="hljs-string">'8.0'</span></span> use_frameworks! pod <span class="hljs-string"><span class="hljs-string">'Firebase', '</span></span>&gt;= <span class="hljs-number"><span class="hljs-number">2.5</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  Then run the following command to download the Firebase SDK: <br><br><pre> <code class="objectivec hljs">pod install</code> </pre><br>  Open the created file FirebaseJokes.xcworkspace. <br><br>  To import Firebase SDK, create a new Objective-c File, FileType - Empty File.  Call it Temp.  When creating a file, the FirebaseJokes-Bridging-Header.h file is automatically created.  Write the following line in it: <br><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Firebase/Firebase.h&gt;</span></span></span></span></code> </pre><br>  We delete Temp.m, we will not need it. <br><br><h3>  Using Firebase SDK </h3><br>  To simplify your life a bit, first we‚Äôll do a little tweaking in DataService.swift.  First of all, we need several links: <br><br><pre> <code class="objectivec hljs">import Foundation import Firebase <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DataService { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> let dataService = DataService() private var _BASE_REF = Firebase(url: <span class="hljs-string"><span class="hljs-string">"\(BASE_URL)"</span></span>) private var _USER_REF = Firebase(url: <span class="hljs-string"><span class="hljs-string">"\(BASE_URL)/users"</span></span>) private var _JOKE_REF = Firebase(url: <span class="hljs-string"><span class="hljs-string">"\(BASE_URL)/jokes"</span></span>) var BASE_REF: Firebase { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _BASE_REF } var USER_REF: Firebase { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _USER_REF } var CURRENT_USER_REF: Firebase { let userID = <span class="hljs-built_in"><span class="hljs-built_in">NSUserDefaults</span></span>.standardUserDefaults().valueForKey(<span class="hljs-string"><span class="hljs-string">"uid"</span></span>) as! String let currentUser = Firebase(url: <span class="hljs-string"><span class="hljs-string">"\(BASE_REF)"</span></span>).childByAppendingPath(<span class="hljs-string"><span class="hljs-string">"users"</span></span>).childByAppendingPath(userID) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentUser! } var JOKE_REF: Firebase { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _JOKE_REF } }</code> </pre><br>  To use Firebase, you need to import the Firebase firewall.  The DataService class serves to interact with Firebase.  To read or write data, you must create a link to the Firebase database with a Firebase URL.  Base URL is the URL of the application database.  Later we will save all users and all jokes in the form of child nodes.  To have access to the child nodes, you can simply set the child name (that is, users) to the main URL. <br><br><h3>  Create a new user account </h3><br>  We'll start with CreateAccountViewController.swift.  We need to import our framework. <br><br><pre> <code class="objectivec hljs">import <span class="hljs-built_in"><span class="hljs-built_in">UIKit</span></span> import Firebase <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CreateAccountViewController: <span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span> {</code> </pre><br>  In the createAccount () method, we take the text that the user entered and try to use it to create a new user.  This applies to the Firebase createUser () method.  Update the existing method as follows: <br><br><pre> <code class="objectivec hljs">@IBAction func createAccount(sender: AnyObject) { let username = usernameField.text let email = emailField.text let password = passwordField.text <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> username != <span class="hljs-string"><span class="hljs-string">""</span></span> &amp;&amp; email != <span class="hljs-string"><span class="hljs-string">""</span></span> &amp;&amp; password != <span class="hljs-string"><span class="hljs-string">""</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Set Email and Password for the New User. DataService.dataService.BASE_REF.createUser(email, password: password, withValueCompletionBlock: { error, result in if error != nil { // There was a problem. self.signupErrorAlert("Oops!", message: "Having some trouble creating your account. Try again.") } else { // Create and Login the New User with authUser DataService.dataService.BASE_REF.authUser(email, password: password, withCompletionBlock: { err, authData in let user = ["provider": authData.provider!, "email": email!, "username": username!] // Seal the deal in DataService.swift. DataService.dataService.createNewAccount(authData.uid, user: user) }) // Store the uid for future access - handy! NSUserDefaults.standardUserDefaults().setValue(result ["uid"], forKey: "uid") // Enter the app. self.performSegueWithIdentifier("NewUserLoggedIn", sender: nil) } }) } else { signupErrorAlert("Oops!", message: "Don't forget to enter your email, password, and a username.") } }</span></span></code> </pre><br>  If the entered information about the new user is correct, the user will be registered and will be able to log into the application.  For any missing information a notification will pop up.  To do this, insert the following method into the class: <br><br><pre> <code class="objectivec hljs">func signupErrorAlert(title: String, message: String) { <span class="hljs-comment"><span class="hljs-comment">// Called upon signup error to let the user know signup didn't work. let alert = UIAlertController(title: title, message: message, preferredStyle: UIAlertControllerStyle.Alert) let action = UIAlertAction(title: "Ok", style: .Default, handler: nil) alert.addAction(action) presentViewController(alert, animated: true, completion: nil) }</span></span></code> </pre><br>  In fact, saving occurs in the createNewAccount () method in DataService.swift. <br><br><pre> <code class="objectivec hljs">func createNewAccount(uid: String, user: Dictionary&lt;String, String&gt;) { <span class="hljs-comment"><span class="hljs-comment">// A User is born. USER_REF.childByAppendingPath(uid).setValue(user) }</span></span></code> </pre><br>  To save data to the Firebase database, you can simply call the setValue method.  In the code above, the user object is saved to the database under the users key above this child node uid (approx. / Users / 1283834 /). <br><br>  In addition to saving the user in the Firebase database, we will save the uid for the user in NSUserDefaults.  This will track the current user. <br><br><h3>  User Authorization </h3><br>  Before moving on, import Firebase into LoginViewController.swift.  This way we can track if someone has already logged in or is trying to register a user. <br>  In the viewDidAppear () method, we check whether our saved ‚Äúuid‚Äù is nil and whether the user has an account.  If the user has been logged in, he skips the login screen.  Otherwise, he will be forced to log in. <br><br><pre> <code class="objectivec hljs">override func viewDidAppear(animated: Bool) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidAppear(animated) <span class="hljs-comment"><span class="hljs-comment">// If we have the uid stored, the user is already logger in - no need to sign in again! if NSUserDefaults.standardUserDefaults().valueForKey("uid") != nil &amp;&amp; DataService.dataService.CURRENT_USER_REF.authData != nil { self.performSegueWithIdentifier("CurrentlyLoggedIn", sender: nil) } }</span></span></code> </pre><br>  The tryLogin () method, which is called when trying to authorize.  Update this method as shown below and insert the loginErrorAlert helper method: <br><br><pre> <code class="objectivec hljs">@IBAction func tryLogin(sender: AnyObject) { let email = emailField.text let password = passwordField.text <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> email != <span class="hljs-string"><span class="hljs-string">""</span></span> &amp;&amp; password != <span class="hljs-string"><span class="hljs-string">""</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Login with the Firebase's authUser method DataService.dataService.BASE_REF.authUser(email, password: password, withCompletionBlock: { error, authData in if error != nil { print(error) self.loginErrorAlert("Oops!", message: "Check your username and password.") } else { // Be sure the correct uid is stored. NSUserDefaults.standardUserDefaults().setValue(authData.uid, forKey: "uid") // Enter the app! self.performSegueWithIdentifier("CurrentlyLoggedIn", sender: nil) } }) } else { // There was a problem loginErrorAlert("Oops!", message: "Don't forget to enter your email and password.") } } func loginErrorAlert(title: String, message: String) { // Called upon login error to let the user know login didn't work. let alert = UIAlertController(title: title, message: message, preferredStyle: UIAlertControllerStyle.Alert) let action = UIAlertAction(title: "Ok", style: .Default, handler: nil) alert.addAction(action) presentViewController(alert, animated: true, completion: nil) }</span></span></code> </pre><br>  Firebase has built-in support for user authentication with an email address and password.  Our tryLogin () method uses the authUser () method, which allows you to see if the email and password of the user account match.  If so, we save the ‚Äúuid‚Äù and get inside the application.  If not, we notify the user that he would repeat the authorization attempt. <br><br>  Now the application is ready for user registration and authorization, it‚Äôs time to break into the application implementation itself. <br><br><h3>  Joke object </h3><br>  Go to Joke.swift and import Firebase.  In our database, the joke is represented by the ID number.  This number is generated automatically and contains all the properties of the joke.  Here they are: <br><ul><li>  jokeText </li><li>  jokeVotes </li><li>  username (joke author) </li></ul><br>  We initialize a new object in the init () method, where the prank id is the key, the prank data is transferred in the dictionary format. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Joke { private var _jokeRef: Firebase! private var _jokeKey: String! private var _jokeText: String! private var _jokeVotes: Int! private var _username: String! var jokeKey: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _jokeKey } var jokeText: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _jokeText } var jokeVotes: Int { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _jokeVotes } var username: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _username } <span class="hljs-comment"><span class="hljs-comment">// Initialize the new Joke init(key: String, dictionary: Dictionary&lt;String, AnyObject&gt;) { self._jokeKey = key // Within the Joke, or Key, the following properties are children if let votes = dictionary["votes"] as? Int { self._jokeVotes = votes } if let joke = dictionary["jokeText"] as? String { self._jokeText = joke } if let user = dictionary["author"] as? String { self._username = user } else { self._username = "" } // The above properties are assigned to their key. self._jokeRef = DataService.dataService.JOKE_REF.childByAppendingPath(self._jokeKey) } }</span></span></code> </pre><br><br><h3>  Adding new jokes </h3><br>  AddJokeViewController.swift import Firebase.  The user adds a joke, and we send it to our storage, from where it instantly goes to all devices. <br><br>  In the viewDidLoad () method, we get the current user username, so we can specify the author of the new joke. <br><br><pre> <code class="objectivec hljs">override func viewDidLoad() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-comment"><span class="hljs-comment">// Get username of the current user, and set it to currentUsername, so we can add it to the Joke. DataService.dataService.CURRENT_USER_REF.observeEventType(FEventType.Value, withBlock: { snapshot in let currentUser = snapshot.value.objectForKey("username") as! String print("Username: \(currentUser)") self.currentUsername = currentUser }, withCancelBlock: { error in print(error.description) }) }</span></span></code> </pre><br>  When you call the saveJoke () method, a newJoke dictionary is created, which takes text from jokeField, and sets the value to 0 for votes, the current number of votes, and for the current username - author.  These values ‚Äã‚Äãassign them to the appropriate ids and are passed to the createNewJoke () method in the DataService for storage. <br>  Register the parameter to be changed in the AddJokeViewController class: <br><br><pre> <code class="objectivec hljs">var currentUsername = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre><br>  Update the saveJoke method: <br><br><pre> <code class="objectivec hljs">@IBAction func saveJoke(sender: AnyObject) { let jokeText = jokeField.text <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> jokeText != <span class="hljs-string"><span class="hljs-string">""</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Build the new Joke. // AnyObject is needed because of the votes of type Int. let newJoke: Dictionary&lt;String, AnyObject&gt; = [ "jokeText": jokeText!, "votes": 0, "author": currentUsername ] // Send it over to DataService to seal the deal. DataService.dataService.createNewJoke(newJoke) if let navController = self.navigationController { navController.popViewControllerAnimated(true) } } }</span></span></code> </pre><br>  We use Dictionary to temporarily store jokes.  In fact, saving occurs in the createNewJoke method in the DataService.  In DataService.swift, add the createNewJoke method: <br><br><pre> <code class="objectivec hljs">func createNewJoke(joke: Dictionary&lt;String, AnyObject&gt;) { <span class="hljs-comment"><span class="hljs-comment">// Save the Joke // JOKE_REF is the parent of the new Joke: "jokes". // childByAutoId() saves the joke and gives it its own ID. let firebaseNewJoke = JOKE_REF.childByAutoId() // setValue() saves to Firebase. firebaseNewJoke.setValue(joke) }</span></span></code> </pre><br>  Again, you can save an object using the setValue () method.  When the childByAutoId method is called, Firebase generates a unique ID for each joke based on a marker that ensures that the joke receives a unique ID. <br><br><h3>  Logout current user </h3><br>  Usually this is fixed in the Settings or Profile section, but we will give the user the opportunity to go to AddJokeViewController.swift. <br><br>  The logout () method uses the firebase unauth () method to deauthorize.  It is also necessary to remove the user ‚Äúuid‚Äù from our repository and send it back to LoginViewController. <br><br>  Update the logout method: <br><br><pre> <code class="objectivec hljs">@IBAction func logout(sender: AnyObject) { <span class="hljs-comment"><span class="hljs-comment">// unauth() is the logout method for the current user. DataService.dataService.CURRENT_USER_REF.unauth() // Remove the user's uid from storage. NSUserDefaults.standardUserDefaults().setValue(nil, forKey: "uid") // Head back to Login! let loginViewController = self.storyboard!.instantiateViewControllerWithIdentifier("Login") UIApplication.sharedApplication().keyWindow?.rootViewController = loginViewController }</span></span></code> </pre><br>  If you do not delete the user ‚Äúuid‚Äù, you will have problems entering the new user‚Äôs application. <br><br><h3>  Display all the jokes on screen </h3><br>  Ultimately, the data is obtained with Firebase.  We list all the jokes in the UITableView located in JokesFeedTableViewController.swift.  Not surprisingly, here we will import Firebase. <br><br>  Let's start with the viewDidLoad () method.  Set our observeEventType () method.  Firebase data comes by adding an asynchronous listener to the database link.  This method is not called in viewDidLoad () when switching to JokesFeedTableViewController.swift, it is called for any changes to jokes from the database. <br><br><pre> <code class="objectivec hljs">var jokes = [Joke]() override func viewDidLoad() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-comment"><span class="hljs-comment">// observeEventType is called whenever anything changes in the Firebase - new Jokes or Votes. // It's also called here in viewDidLoad(). // It's always listening. DataService.dataService.JOKE_REF.observeEventType(.Value, withBlock: { snapshot in // The snapshot is a current look at our jokes data. print(snapshot.value) self.jokes = [] if let snapshots = snapshot.children.allObjects as? [FDataSnapshot] { for snap in snapshots { // Make our jokes array for the tableView. if let postDictionary = snap.value as? Dictionary&lt;String, AnyObject&gt; { let key = snap.key let joke = Joke(key: key, dictionary: postDictionary) // Items are returned chronologically, but it's more fun with the newest jokes first. self.jokes.insert(joke, atIndex: 0) } } } // Be sure that the tableView updates when there is new data. self.tableView.reloadData() }) }</span></span></code> </pre><br>  The method provides a snapshot.  Using a snapshot, we can create a series of jokes to fill our tableView.  For Firebase jokes, we will create a list where the new jokes will be displayed at the top.  Because Firebase will distribute the jokes in chronological order, we can only create a row in the opposite direction. <br><br>  It would be nice to have a constantly updated array of jokes, we remember the need to update the data in the tableView so that we can see it. <br><br>  The rest of the work is distributed between the tableView: cellForRowAtIndexPath: and our custom cell, JokeCellTableViewCell.swift.  In the tableView: cellForRowAtIndexPath: method, we send a joke to the configureCell () method in JokeCellTableViewCell.swift. <br><br><pre> <code class="objectivec hljs">override func numberOfSectionsInTableView(tableView: <span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span>) -&gt; Int { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> } override func tableView(tableView: <span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span>, numberOfRowsInSection section: Int) -&gt; Int { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jokes.count } override func tableView(tableView: <span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span>, cellForRowAtIndexPath indexPath: <span class="hljs-built_in"><span class="hljs-built_in">NSIndexPath</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> { let joke = jokes[indexPath.row] <span class="hljs-comment"><span class="hljs-comment">// We are using a custom cell. if let cell = tableView.dequeueReusableCellWithIdentifier("JokeCellTableViewCell") as? JokeCellTableViewCell { // Send the single joke to configureCell() in JokeCellTableViewCell. cell.configureCell(joke) return cell } else { return JokeCellTableViewCell() } } configureCell(), in JokeCellTableViewCell.swift, is where we set the labels and listen for a vote tap. func configureCell(joke: Joke) { self.joke = joke // Set the labels and textView. self.jokeText.text = joke.jokeText self.totalVotesLabel.text = "Total Votes: \(joke.jokeVotes)" self.usernameLabel.text = joke.username // Set "votes" as a child of the current user in Firebase and save the joke's key in votes as a boolean. voteRef = DataService.dataService.CURRENT_USER_REF.childByAppendingPath("votes").childByAppendingPath(joke.jokeKey) // observeSingleEventOfType() listens for the thumb to be tapped, by any user, on any device. voteRef.observeSingleEventOfType(.Value, withBlock: { snapshot in // Set the thumb image. if let thumbsUpDown = snapshot.value as? NSNull { // Current user hasn't voted for the joke... yet. print(thumbsUpDown) self.thumbVoteImage.image = UIImage(named: "thumb-down") } else { // Current user voted for the joke! self.thumbVoteImage.image = UIImage(named: "thumb-up") } }) } func configureCell(joke: Joke) { self.joke = joke // Set the labels and textView. self.jokeText.text = joke.jokeText self.totalVotesLabel.text = "Total Votes: \(joke.jokeVotes)" self.usernameLabel.text = joke.username // Set "votes" as a child of the current user in Firebase and save the joke's key in votes as a boolean. voteRef = DataService.dataService.CURRENT_USER_REF.childByAppendingPath("votes").childByAppendingPath(joke.jokeKey) // observeSingleEventOfType() listens for the thumb to be tapped, by any user, on any device. voteRef.observeSingleEventOfType(.Value, withBlock: { snapshot in // Set the thumb image. if let thumbsUpDown = snapshot.value as? NSNull { // Current user hasn't voted for the joke... yet. print(thumbsUpDown) self.thumbVoteImage.image = UIImage(named: "thumb-down") } else { // Current user voted for the joke! self.thumbVoteImage.image = UIImage(named: "thumb-up") } }) }</span></span></code> </pre><br>  Add the configureCell () method to JokeCellTableViewCell.swift. <br><br><pre> <code class="objectivec hljs">var joke: Joke! var voteRef: Firebase! override func awakeFromNib() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.awakeFromNib() <span class="hljs-comment"><span class="hljs-comment">// UITapGestureRecognizer is set programatically. let tap = UITapGestureRecognizer(target: self, action: "voteTapped:") tap.numberOfTapsRequired = 1 thumbVoteImage.addGestureRecognizer(tap) thumbVoteImage.userInteractionEnabled = true }</span></span></code> </pre><br>  In the voteTapped () method, the listener waits for a signal.  In this method, the current user‚Äôs ‚Äúvoices‚Äù are saved with a key containing the joke id and a true value.  All this is sent via the generated voteRef to the configureCell () method. <br><br><pre> <code class="objectivec hljs">func voteTapped(sender: <span class="hljs-built_in"><span class="hljs-built_in">UITapGestureRecognizer</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// observeSingleEventOfType listens for a tap by the current user. voteRef.observeSingleEventOfType(.Value, withBlock: { snapshot in if let thumbsUpDown = snapshot.value as? NSNull { print(thumbsUpDown) self.thumbVoteImage.image = UIImage(named: "thumb-down") // addSubtractVote(), in Joke.swift, handles the vote. self.joke.addSubtractVote(true) // setValue saves the vote as true for the current user. // voteRef is a reference to the user's "votes" path. self.voteRef.setValue(true) } else { self.thumbVoteImage.image = UIImage(named: "thumb-up") self.joke.addSubtractVote(false) self.voteRef.removeValue() } }) }</span></span></code> </pre><br>  The voteTapped () method also relays the signal as a Boolean value to the addSubtractVote () method in Joke.swift.  A value of true means the user has voted for the joke;  while false means the user has not voted for it yet. <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// Add or Subtract a Vote from the Joke. func addSubtractVote(addVote: Bool) { if addVote { _jokeVotes = _jokeVotes + 1 } else { _jokeVotes = _jokeVotes - 1 } // Save the new vote total. _jokeRef.childByAppendingPath("votes").setValue(_jokeVotes) }</span></span></code> </pre><br>  The addSubtractVote () method in Joke.swift uses a boolean value to add or subtract a vote from joke.  Then, the Firebase setValue () method updates the voices against the database. <br><br><h3>  Application Testing </h3><br>  Now let's test the application.  Create a new user and add a few jokes.  You will have the opportunity to vote for jokes.  And if you look in the toolbar, you will see the created users and the created jokes. <br><br><img src="http://www.appcoda.com/wp-content/uploads/2016/02/joke-firebase-data.png" alt="image"><br><br><h3>  Summarize </h3><br>  We did it!  This is a pretty funny little application that users will like due to its speed of response.  We also gained experience with Firebase. <br><br>  You can download the finished project <a href="">finished FirebaseJokes project on GitHub.</a> <br><br>  For iOS developers, there is a whole world of new features with Firebase.  Working with FirebaseJokes will be a good practice, but this is just the beginning. <br><br>  See other user authentication options, add new features to FirebaseJokes, learn the chat functionality, in short, the possibilities are full. <br><br>  A couple of tips on storing images: Firebase provides a relatively modest amount of memory to store them, so it‚Äôs better to store images in a different place. <br><br>  Good luck working with Firebase in your future projects! </div><p>Source: <a href="https://habr.com/ru/post/277941/">https://habr.com/ru/post/277941/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277927/index.html">Anatomy of ransomware for Android, part 2</a></li>
<li><a href="../277933/index.html">Typography and modern CSS</a></li>
<li><a href="../277935/index.html">Using the OpenSSL Library in C ++ Projects</a></li>
<li><a href="../277937/index.html">Own module settings</a></li>
<li><a href="../277939/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 30. Maksik</a></li>
<li><a href="../277943/index.html">The competition of student works in theoretical computer science and discrete mathematics. Alan Turing</a></li>
<li><a href="../277945/index.html">HPE Intelligent Resilient Framework Virtualization Technology</a></li>
<li><a href="../277947/index.html">CPLD retrocomputing. Part 1 - Board for the student</a></li>
<li><a href="../277951/index.html">Distance learning at ShAD Yandex: 570 wonderful hours of my life</a></li>
<li><a href="../277953/index.html">What happens in C ++. Interviews with speakers and live broadcasts of the meeting in Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>