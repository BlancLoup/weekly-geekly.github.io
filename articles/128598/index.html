<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chess @ home: create the largest chess AI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many are familiar with the project Seti @ home : the most powerful initiative to find traces of extraterrestrial civilizations in the ocean of data ob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chess @ home: create the largest chess AI</h1><div class="post__text post__text-html js-mediator-article">  Many are familiar with the project <a href="http://setiathome.berkeley.edu/">Seti @ home</a> : the most powerful initiative to find traces of extraterrestrial civilizations in the ocean of data obtained from the sky, using the capacities of millions of computers around the globe ("matrix"). <br><br>  Although no aliens have yet been discovered, Seti @ home quite successfully demonstrates the potential of large-scale distributed computing.  Projects like <a href="http://en.wikipedia.org/wiki/Berkeley_Open_Infrastructure_for_Network_Computing">BOINC have</a> extended similar initiatives to other areas: biology, medicine, and physics. <br><a name="habracut"></a><br>  Last weekend, a team from <a href="http://joshfire.com/">Joshfire</a> ( <a href="http://twitter.com/tbassetto">Thomas</a> , <a href="http://twitter.com/nathanappere">Nathan</a> , <a href="http://twitter.com/mcouzinet">Michael,</a> and <a href="http://twitter.com/sylvinus">I</a> ) participated in the 48-hour <a href="http://nodeknockout.com/">Node Knockout</a> competition.  The rules were simple: encode the most entertaining thing over the weekend, which uses server-side JavaScript. <br><br>  JavaScript is an old, but fascinating technology that is now being reborn due to <a href="http://ru.wikipedia.org/wiki/V8_(%25D0%25B4%25D0%25B2%25D0%25B8%25D0%25B6%25D0%25BE%25D0%25BA_JavaScript)">increased performance</a> , <a href="http://nodejs.org/">server engines</a> and a heap of <a href="http://en.wikipedia.org/wiki/Web_Workers">new</a> <a href="http://ru.wikipedia.org/wiki/WebSocket">features</a> offered by <a href="http://ru.wikipedia.org/wiki/HTML5">HTML5</a> .  In addition, it is the <b>most common</b> language.  Any computer connected to the web can easily execute JavaScript code, just type in the browser address or run the script from the command line. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We decided to use its prevalence and high performance of Node in order to build a large-scale distributed computing project that people could join <b>simply by going to a web page</b> .  The search for aliens was quickly crossed out, because  we didn't have a radar system at hand.  Because we began to solve the problem easier: <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B">Chess</a> . <br><br>  None of us is a good chess player, but in the Guinness Book of Records we found a mention of <a href="http://www.guinnessworldrecords.com/records-3000/largest-networked-chess-computer/">the largest chess AI</a> , consisting of 2,070 knots, and decided that we could beat him.  This is how the project <a href="http://chessathome.org/">Chess @ home</a> was born. <br><br>  After 48 hours, there were a few more bugs in the prototype, but it was in a completely playable state and looked like this: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/283/75a/fc0/28375afc077cfe70161f1f5014302d3e.jpg" alt="image"><br><br><h1>  Problems of distributed chess AI </h1><br>  Starting the study, we identified the following problem areas: <br><br>  <b>Delay</b>  We had a desire to follow the standard tournament rules (~ 90 minutes per game), which led to the requirement to calculate the course on average per minute.  Moreover, players on the web would definitely prefer a shorter response, and we set ourselves the goal of making it as short as possible. <br><br>  The small time window for calculations does not allow playing well on most existing distributed computing infrastructures, which are mostly <a href="http://ru.wikipedia.org/wiki/Hadoop">optimized for high power</a> .  We needed to build a new, almost real-time infrastructure.  <a href="http://ru.wikipedia.org/wiki/WebSocket">Websocket</a> s were asking for as part of the solution. <br><br>  <b>Parallelism</b>  Optimizing response time means that you need to send small amounts of processing to each calculator.  So we had to figure out how to break the code calculation into thousands of small pieces. <br><br>  Without going into details, the <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BA%25D1%2581%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BA%25D1%2580%25D0%25B8%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B9">minimax</a> algorithm used in most chess AI is based on <a href="http://en.wikipedia.org/wiki/Tree_walk">tree traversal</a> , and is essentially consistent with the use of <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D1%258C%25D1%2584%25D0%25B0-%25D0%25B1%25D0%25B5%25D1%2582%25D0%25B0_%25D0%25BE%25D1%2582%25D1%2581%25D0%25B5%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">alpha-beta clipping</a> .  We considered various algorithms that would be suitable for parallelization, keeping in mind the following: <br><ul><li>  calculators should not be particularly dependent on common variables  web sockets do not work according to the client-client scheme (and the data run through the server prevents scaling); <br></li><li>  The calculation of each move should be broken down into thousands of small tasks. <br></li></ul><br><br>  We found two potential candidates: <a href="http://webdocs.cs.ualberta.ca/~games/aphid/">APHID</a> (simple, used in <a href="http://chessbrain.net/">ChessBrain.net</a> , is the current champion of Guinness records) and variations of YBWC (more difficult, but more effective).  Having a 48-hour limit on coding, we decided to start with APHID. <br><br>  <b>JavaScript performance</b> .  The coolest chess AI can pass up to 15 million tree nodes per second (NPS = nodes per second) using the most advanced hardware.  We took <a href="https://github.com/glinscott/Garbochess-JS">GarboChess</a> , an open source chess AI with JavaScript, whose performance is 100k NPS under Chrome on a modern Macbook Pro.  The coefficient of 150 didn‚Äôt upset us much, especially since in 48 hours we wouldn‚Äôt have time to profile and optimize the code that could win any of us using only one computer. <br><br>  For reference, they say that <a href="http://en.wikipedia.org/wiki/Deep_Blue_versus_Garry_Kasparov">Deep Blue</a> worked at a speed of 200m NPS to defeat Kasparov, which in general was theoretically achievable at our 2070-node goal. <br><br>  <b>Fault tolerance</b> / <b>security</b> .  Running JavaScript on third-party computers means that its results cannot be trusted for two reasons: <b>accessibility</b> (users can leave the page at any time) and <b>accuracy</b> (attackers may slip wrong results, and the AI ‚Äã‚Äãwill make a foolish move). <br><br>  We decided not to deal with the reliability in the first variant, but the availability remained critical so that our algorithm was completed on time, without missing obvious moves in the decision tree.  We set up a FIFO queue for computing tasks in MangoDB and set a timeout of 5 seconds so that another computer can pick up the task and process it, if no response has come from the first one. <br><br><h1>  The implementation of the prototype in 48 hours </h1><br>  Here is the outline of our prototype: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/c83/dea/b5d/c83deab5da40fce106f03f5a9eb9f376.jpg" alt="image"><br><br>  Let us examine the main components: <br><ul><li>  <a href="https://github.com/substack/dnode">dnode</a>  The Node.js library for two-way asynchronous remote method calls.  Provides transport in the style of sockets and web sockets (using <a href="http://socket.io/">socket.io</a> ) so that system processes can communicate with each other and with processes running in browsers using the same interface.  We used it for almost all network interactions. <br></li><li>  <a href="http://en.wikipedia.org/wiki/Web_Workers">Web Workers</a> (web calculators).  Single-thread (JavaScript) environment, limiting the execution of a single script so that the user interface does not hang.  Web Workers allow us to run scripts with a long execution time to solve computationally demanding tasks, but without blocking the interface or other user interaction scripts.  From the server side, we used <a href="https://github.com/pgriess/node-webworker">node-webworker</a> (a Web Worker implementation for Node), so we had a single interface for communicating with AI. <br></li><li>  <a href="http://www.mongodb.org/">MongoDB</a> .  <a href="http:">MongoHQ</a> sponsored Node Knockout, and we decided to use pre-made MongoDB instances to store game states and a potentially large cache of positions. <br></li><li>  <a href="http://nodejs.org/">Node</a> .  The central link of the architecture, Node has both fast development (the same code on the server and the client), and high performance (its non-blocking I / O paradigm has confirmed its competitive ability and speed). <br></li><li>  Local AI on the server.  This place obviously does not scale, but nevertheless we have to make several AI calls on the server, mainly because the APHID needs to first build a small tree in order to distribute the work to the clients.  Perhaps in the future we will remove it. <br></li></ul><br><br>  In this implementation there is something to improve, but do not forget - everything was done in 48 hours.  But launching AI on Web Workers, both browser and server, will remain the main idea. <br><br><h1>  Whats ahead </h1><br>  <b>Ethics for widgets</b> .  Usually, in order to use someone else's computing power, the consent of their owner is necessary: ‚Äã‚Äãpeople install the SETI @ home or BOINC software, thus allowing them to their processor.  JavaScript allows you to use other people's processors without explicit permission, you just go to the page with the widget, which is not very good. <br><br>  We decided to get the consent of users, but installing the widget on foreign sites with high traffic remains the main unresolved task for our 2070-node goal, and we will do our best to respond to objections or discontent that may arise. <br><br>  For example, since we plan to use ‚Äúpublic‚Äù resources, we must keep the results as <b>open as possible</b> .  The code will remain open on GitHub.  We also plan to open API for chess AI. <br><br>  <b>Improvements to AI</b> .  After we understand the <a href="https://github.com/joshfire/chessathome/issues">few remaining interface bugs</a> , we will continue to optimize AI in the following areas: <br><ul><li>  <b>Improved concurrency</b> : we plan to switch from APHID to YBWC in order to more flexibly distribute tasks between calculators.  This is especially important because of the poor performance of JavaScript, you need to compensate for its large scale. </li><li>  <b>Unit tests</b> : We have already carried out unit testing for a couple of hundreds of positions, but many more are available online, and we are going to integrate them in the manner of <a href="https://sites.google.com/site/strategictestsuite/">STS</a> . </li><li>  Improvements to the algorithm: GarboChess has already implemented alpha-beta clipping, <a href="http://chessprogramming.wikispaces.com/Null%2BWindow">zero window detection</a> , <a href="http://chessprogramming.wikispaces.com/Quiescence%2BSearch">finding quiet positions</a> and several other functions, but improving the evaluation function and some modifications of the AI ‚Äã‚Äãwill allow it to play better. </li></ul><br><br>  <b>Plan for hour X.</b>  When the AI ‚Äã‚Äãbecomes strong enough, we will call the real French grandmaster and the representative of Guinness to hold the most exciting chess game! <br><br>  We need to coordinate a lot of people so that they connect to the matrix at the same time.  Installing the widget on several highly-visited sites should help.  We also want people to have the opportunity to observe the game on Chess @ home, and also participate in the calculations. <br><br>  If you have an idea how to connect the maximum number of people, please tell us!  We are also looking for talented JavaScript developers to handle everything described above. <br><br>  If you want to help us, look at the <a href="https://github.com/joshfire/chessathome/issues">current task list</a> or try finding new ones on <a href="http://chessathome.org/">Chess @ home</a> .  Good luck with the Matrix! <br><br>  <b>PS</b> We won the Node Knockout in <a href="http://nodeknockout.com/%3Fsort%3Dcompleteness">the Completion category</a> . <br><br><hr><br><br>  For those who do not know how to use Habrom: <br><ul><li>  translated: <a href="http://geektimes.ru/users/unconnected/" class="user_link">unconnected</a> </li><li>  Lyrics by: <a href="http://twitter.com/sylvinus">Sylvain Zimmer</a> </li><li>  original: <a href="http://sylvainzimmer.com/2011/09/06/chessathome-building-largest-chess-ai/">Chess @ home: Building the largest Chess AI ever</a> <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/128598/">https://habr.com/ru/post/128598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128589/index.html">What is the blog "IT abroad"?</a></li>
<li><a href="../128591/index.html">4th meeting of the St. Petersburg group DEFCON-Russia</a></li>
<li><a href="../128592/index.html">Online video players - how to improve their interface</a></li>
<li><a href="../128595/index.html">So check on the literacy of teachers</a></li>
<li><a href="../128597/index.html">Are you interested in the experience of habrayuzer about immigration and about life abroad?</a></li>
<li><a href="../128599/index.html">How-to VPN (pptpd + mysql + radius) on CentOS6</a></li>
<li><a href="../128601/index.html">Useful tools, tutorials and resources</a></li>
<li><a href="../128606/index.html">No one likes flash</a></li>
<li><a href="../128607/index.html">People against PVS-Studio: First Double</a></li>
<li><a href="../128609/index.html">Cloud GIT Hosting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>