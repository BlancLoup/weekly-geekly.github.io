<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alert "Lida": security testing automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear readers. My name is Victor Burov, I am a developer in the ISPsystem. In the last post I talked about the tool for creating autote...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alert "Lida": security testing automation</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear readers.  My name is Victor Burov, I am a developer in the ISPsystem.  In the last post I talked about the <a href="https://habr.com/company/ispsystem/blog/421007/">tool for creating autotests</a> , today I will share the experience of automating security testing. <br><br><img src="https://habrastorage.org/webt/9t/xm/uy/9txmuy_rzmrhxjp0mbe4hfobvq8.jpeg"><br><br>  At first, an individual employee was looking for vulnerabilities in our products.  Manual testing took a lot of time and did not guarantee that all vulnerabilities would be found.  Having found out the basic laws of testing, we came to the conclusion that it can be automated.  Then we decided to write a utility that will facilitate the life of the tester, save his time and allow you to check the products after each change.  Since the tester was called Lida, we called the new application in her honor.  In general, in our company, it has become a tradition to call testing tools by the names of testers. <br><a name="habracut"></a><br>  After analyzing the vulnerability search utilities, I came to the conclusion that they all need to specify the function to call and the parameters used.  We again decided to take advantage of the unified interface and formulated the requirements for Lida. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Requirements at the start: </h4><br><ol><li>  Automatic building lists of functions. </li><li>  Autocomplete settings. </li><li>  Making requests to the API. </li><li>  Analysis of data output after performing functions. </li><li>  Search for data vulnerabilities. </li><li>  Formation of reports. </li><li>  Flexible settings. </li></ol><br>  Implement all this was not easy. <br><br><h2>  Implementation </h2><br><h3>  Bypassing forms and lists </h3><br>  To find vulnerabilities in a function, it must be executed by passing the necessary parameters.  Our interface is based on lists and forms, so it is possible to automate data collection by processing xml documents describing the structure of interface elements. <br><br>  I decided to start a crawl from the main menu, recursively going into all nested lists.  Lida opens the first level list.  As a rule, it has several buttons that call some functions. <br><br>  If the button opens a form, then the result of the call will be an xml-document with nodes containing information about the fields: name, validator, range of acceptable values.  Based on this information, field values ‚Äã‚Äãare generated.  For example, an int will generate a number.  If there is no validator, a random string is generated.  After filling in all the form fields, a request is sent. <br><br>  If the function is a list, it will be opened and functions associated with the buttons will be called for its elements. <br><br>  When checking lists there is a problem - all lists must have a set of entries that will ensure that all the buttons in the list are clickable. <br><br><h3>  SQL injection search </h3><br>  SQL injection is probably one of the most common problems for applications, including ours.  Many function calls spawn various queries to the DBMS.  An error occurs when parameters that come from outside are inserted into the request body "as is".  The consequences of such errors can be sad: from unauthorized data acquisition to the removal of tables. <br><br>  To start searching for SQL injections, I organized the output of all SQL queries to a file.  After executing the function, the application searches for the values ‚Äã‚Äãof the passed parameters in the resulting SQL queries. <br><br>  <i>You could use the log of the SQL server itself.</i>  <i>But in our case there is only one method for executing queries and adding logging to it was easy.</i>  <i>Because of this, we know exactly what call originated a particular request.</i> <br><br>  When the value of the passed parameter is found, the utility passes in this parameter a value containing a single quote.  If the quote is found in the same sequence, it means that the parameter is not escaped - we have found a place for SQL injections. <br><br><h3>  System call analysis </h3><br>  A similar problem occurs when we make any system calls.  I decided to look for them with strace and selected the optimal launch parameters for it.  Example of running ISPmanager: <br><br><pre><code class="xml hljs">strace -f -s 1024 -e trace=file,process bin/core ispmgr</code> </pre> <br>  As with SQL injections, Lida performs the function and analyzes the output of strace to get into the functions <i>open, unlink, rmdir, chmod chown, chflags, mknod, mkfifo, fcntl, symlink, link, execve, mkdir</i> . <br><br>  If the parameter is found, the utility passes in it a value containing, for example, the path with the transition to the directory above.  If it hits as-is, then a potential vulnerability is found. <br><br>  The analysis of the execve function was very useful.  It allows you to determine in which function the launch arguments of executable files are not screened.  This error is very expensive, because through it you can get root access to the server by simply changing the password. <br><br><blockquote>  When users find a vulnerability in our products, the company pays a cash reward, the amount of which depends on the category of vulnerability.  This approach may be cheaper than finding the error on its own (the tester may not find an error, and receive a salary). </blockquote><br>  <i>Another interesting test: checking the order of calling the stat functions and others.</i>  <i>Often, access is first checked through stat, and then any unsafe actions, which leaves room for substitution.</i>  <i>But we did not automate this.</i> <br><br><h3>  Check access to other objects </h3><br>  We check access to foreign objects from under the user for entities of another user and administrator.  In this mode, we check the ability to read, modify and view lists of elements of another user. <br><br>  "Lida" bypasses all functions available on behalf of the owner or administrator and remembers their elements.  Then it calls the same functions with elements from under another user.  In an ideal situation, the answer should be an error like Access or Missed.  If this error is not received, therefore, with high probability you can read the data of another user. <br><br>  In some cases, the absence of an error does not mean that you can get direct access to the objects of another user.  At the beginning of such functions, we add a check on access rights to the element.  This is how not only security is checked, but also the correctness of server responses. <br><br><h3>  API Validation </h3><br>  Validating our APIs is an added bonus of function checking for vulnerabilities.  Analyzing reports on Lida's work, we learned how to return the correct types of errors, made our API more convenient and logical.  As a result, as with the tape recorder, we received not only a security check, but once again checked our API for "consistency." <br><br><h2>  Difficulties </h2><br><h4>  False alarms </h4><br>  The utility can work with all our products, therefore, it tests many different functions.  Basically, false positives appeared in the mode of checking access to other objects.  This is due to the peculiarities of the buttons and functions. <br><br>  False alarms were Lida‚Äôs biggest problem.  It seemed that it was completely debugged, but when checking on different panels all new false positives appeared.  As a result, there were several stages of their correction. <br><br><h4>  Entity creation </h4><br>  The main part of actions in the panel is performed on any entity (domain name, database, etc.).  To achieve maximum automation, Lida had to create these entities automatically.  But in practice it turned out to be hard to implement.  Sometimes validation is performed in code, so it is not always possible to substitute the value of the parameter automatically.  The second reason is dependent entities.  For example, to create a mailbox you need to create a mail domain. <br><br>  Therefore, we decided not to fight for full automation.  Before starting, the tester creates the entities manually and takes a snapshot of the machine, since after the entity has been checked, they will be changed.  This allows you not to skip checking the group of functions in case of an unsuccessful creation of an entity. <br><br><h4>  Call destructive functions </h4><br>  Virtually every list has functions to remove or deactivate an entity.  If you perform them in the order, then the entity will be deleted before performing other functions.  I define such functions and perform after others.  Additionally added a key that prohibits the execution of such functions. <br><br>  Some functions reboot the server.  They have to track and add to the list of ignored. <br><br>  Due to the peculiarities of the operation logic, some functions restart the panel.  During security testing, this leads to the fact that the panel is launched without a trace of SQL queries or strace - further testing becomes meaningless.  It is necessary to monitor and re-launch the panel in trace mode. <br><br><h4>  Check dependent parameters </h4><br>  On forms there are text entry fields, checkboxes, drop-down lists, the values ‚Äã‚Äãof which determine the availability of the values ‚Äã‚Äãof other fields.  For each value of the dependent field there may be a separate section of code, therefore, parts when they can remain untested. <br><br>  To solve this problem, I added algorithms for analyzing dependent fields and checking all combinations of dependent controls. <br><br><h4>  Check functions not available in the interface </h4><br>  Service functions are not available for migration, but may contain vulnerabilities.  To identify and verify them, we have a special function that returns a list of all registered functions.  We compare this list with the list of proven functions.  There are no metadata for service functions, therefore it is impossible to check the parameters processed within them. In order to at least check such functions somehow, I pass on our standard parameters <i>elid, plid</i> and others. <br><br><h2>  Conclusion </h2><br>  We included Lida in every Jenkins nightly build.  According to the results of her work, a verification report is generated, information about the suspicious function is displayed in it with all parameters. <br><br>  The task closed by the developer is now checked not only by the tester, but also by Lida.  The tester processes the report received: copies the parameters of the suspicious function to the browser and analyzes the behavior and log of the panel.  If the vulnerability is confirmed, log the error to the developer. </div><p>Source: <a href="https://habr.com/ru/post/426969/">https://habr.com/ru/post/426969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426959/index.html">Installing kubernetes via kubespray (local-storage, installing Elasticsearch + Fluentd + Kibana, prometheus)</a></li>
<li><a href="../426961/index.html">How Microsoft rewrote the C # compiler in C # and made it open</a></li>
<li><a href="../426963/index.html">Do applications on Flutter dream about platform-oriented widgets?</a></li>
<li><a href="../426965/index.html">What will happen with error handling in C ++ 2a</a></li>
<li><a href="../426967/index.html">Online ABAP code generator</a></li>
<li><a href="../426971/index.html">Fatalism in error handling</a></li>
<li><a href="../426973/index.html">Corporate Sandwiches</a></li>
<li><a href="../426975/index.html">Joker 2018: the impossible is possible</a></li>
<li><a href="../426977/index.html">LibreOffice: a bad dream accountant</a></li>
<li><a href="../426979/index.html">How to learn English for free: 3 banal tools and detailed instructions for each</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>