<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In the footsteps of Meteor, or cycling reactivity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day, habraiser! Today we will try to disassemble a little the reactivity that underlies one of the most hipster frameworks - Meteor. 

 F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In the footsteps of Meteor, or cycling reactivity</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/266081/"><img src="https://habrastorage.org/files/44b/b7a/4f3/44bb7a4f333442fdb047363ae34fb87d" align="right" width="400"></a> <br>  Good time of day, habraiser!  Today we will try to disassemble a little the reactivity that underlies one of the most hipster frameworks - Meteor. <br><br>  First, here‚Äôs a bit of a dry theory from Wikipedia: <br>  Reactive programming is a programming paradigm focused on data flows and propagation of changes.  This means that it must be possible to easily express static and dynamic data streams, and that the model being executed should automatically propagate changes through the data stream. <br><br>  For example, in imperative programming, the assignment a = b + c will mean that the variable a will be assigned the result of the operation b + c, using the current (at the time of calculation) variable values.  Later, the values ‚Äã‚Äãof b and c can be changed without any influence on the value of the variable a. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At once I will make a reservation that this post is aimed more at <s>sadistic</s> novices than at experienced JS gurus. <br><br>  <i><font color="#ddd">* we cycle - we write our bicycle, peeping at the ready implementation.</font></i> <br><a name="habracut"></a><br>  For simplicity, we will write code for the client part, however, with minor changes, it can also be used on the server. <br><br>  To begin, we will need some kind of global object in which we can store all our dependencies. <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Deps = { <span class="hljs-attr"><span class="hljs-attr">funcs</span></span>: [], <span class="hljs-comment"><span class="hljs-comment">//  ,     vars: [] //      };</span></span></code> </pre> <br>  Each time we create a new reactive environment, the data we need will be inserted into both arrays.  In particular, in the funcs array, we will have a function, inside which the reactive variables are located, the fate of which must be monitored.  The array of vars under the same index will get an array of reactive variables, the fate of which is followed by our reactive environment. <br><br>  The next step is to implement the reactive environment itself, also known as Tracker.  It is a function that takes another function as an argument and immediately calls it.  However, magic happens behind the scenes: as soon as the tracker calls our function, a special flag is activated in it, indicating that information is being collected about all the reactive variables in our function. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Tracker = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn</span></span></span><span class="hljs-function">) </span></span>{ Tracker.active = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   var count = Deps.funcs.push(fn); //      Deps.vars[count - 1] = []; //        fn(); Tracker.active = false; };</span></span></code> </pre><br>  At the moment, all this is useless because we do not have the main entity - the reactive variable.  By it we mean an object that has accessors to its only property.  Accessors are a getter and a setter, functions that replace the acquisition and setting of the desired property, diluting this action with its logic. <br>  Our reactive variable must take an argument during initialization ‚Äî a standard value.  When calling a getter (usually, this is the .get method without parameters), we need to check if it is called inside the reactive environment, and then write our variable to the list of monitored variables.  When calling the setter (usually this is the .set method with the val parameter ‚Äî the new value of the variable), we must write this value into the property of the object and update all the dependencies. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ReactiveVar = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = val; <span class="hljs-comment"><span class="hljs-comment">//    - }; ReactiveVar.prototype.get = function() { if(Tracker.active) { //     Deps.vars[Deps.vars.length - 1].push(this); //          } return this.value; //    }; ReactiveVar.prototype.set = function(val) { this.value = val; //    for(var i = 0; i &lt; Deps.vars.length; i++) { if(Deps.vars[i].indexOf(this) &gt; -1) { //   Deps.funcs[i](); //     } } return this.value; //    };</span></span></code> </pre><br>  Let's put it all together and get an almost complete library: <br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Deps = { <span class="hljs-attr"><span class="hljs-attr">funcs</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: [] }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Tracker = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn</span></span></span><span class="hljs-function">) </span></span>{ Deps.funcs.push(fn); Deps.vars.push([]); Deps.tracker = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; fn(); Deps.tracker = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ReactiveVar = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">init</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = init; }; ReactiveVar.prototype.get = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Deps.tracker) { Deps.vars[Deps.vars.length - <span class="hljs-number"><span class="hljs-number">1</span></span>].push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value; }; ReactiveVar.prototype.set = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = val; Deps.vars.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arr.indexOf(self) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { Deps.funcs[i](); } i += <span class="hljs-number"><span class="hljs-number">1</span></span>; }); }; <span class="hljs-comment"><span class="hljs-comment">//  window.  NodeJS  window.Tracker = Tracker; window.ReactiveVar = ReactiveVar; })();</span></span></code> </pre><br></div></div><br>  Now let's try to use reactivity for our purposes!  To do this, we implement the simplest stopwatch.  We need 1 reactive variable and an interval ticking every second: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> time = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReactiveVar(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   Tracker(function() { var curTime = time.get(); //     document.querySelector('#time').innerHTML = curTime; //  DOM       }); setInterval(function() { time.set(time.get() + 1); //       ,        time, ,      }, 1000);</span></span></code> </pre><br>  That's all.  As we could see, reactivity in JS is not something of a fantasy, but a very simple programming paradigm. </div><p>Source: <a href="https://habr.com/ru/post/266081/">https://habr.com/ru/post/266081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266069/index.html">Why CIOs must ‚Äúwork in the field‚Äù</a></li>
<li><a href="../266073/index.html">Emacs: we train the cursor (continuation)</a></li>
<li><a href="../266075/index.html">A simple rotary encoder driver for Qt4 Embedded under Linux</a></li>
<li><a href="../266077/index.html">Analysis of one of the VaultCrypt encryption modifications</a></li>
<li><a href="../266079/index.html">‚ÄúFortran - Alive and Alive‚Äù or ‚ÄúWhat‚Äôs new ifort‚Äôs grandfather‚Äù</a></li>
<li><a href="../266083/index.html">Restriction of memory available to the program</a></li>
<li><a href="../266085/index.html">We build real-time web applications with RethinkDB</a></li>
<li><a href="../266087/index.html">Broadband Method (Class Library)</a></li>
<li><a href="../266089/index.html">Linux container developers meeting</a></li>
<li><a href="../266091/index.html">We integrate Paypal payment into web-application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>