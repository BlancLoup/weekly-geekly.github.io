<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to the Storage Performance Development Kit (SPDK)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Clients implementing current-generation solid-state drives, such as the Intel DC NVMe P3700 series , have to cope with a complex problem: since bandwi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to the Storage Performance Development Kit (SPDK)</h1><div class="post__text post__text-html js-mediator-article">  Clients implementing current-generation solid-state drives, such as the <a href="http://www.intel.com/content/www/us/en/solid-state-drives/ssd-dc-p3700-spec.html">Intel DC NVMe P3700 series</a> , have to cope with a complex problem: since bandwidth is much higher than that of disk drives, and latency is much lower, most of the total transaction time now accounts for the storage software .  In other words, the performance and efficiency of the entire storage system is increasingly dependent on the performance and efficiency of the software suite used.  At the same time, data carriers are constantly being improved; in the coming years, their capacity will exceed the capabilities of software architectures used in data storage systems. <br><br><img src="https://habrastorage.org/files/4f3/47b/1e6/4f347b1e6ffa4353843c445a1a0c8c00.jpg"><br><br>  To assist OEMs and software vendors in integrating such hardware, Intel has created a set of drivers and developed a complete storage architecture called the Storage Performance Development Kit (SPDK).  The goal of the SPDK is to highlight the high efficiency and performance achieved by the combination of Intel technologies in the area of ‚Äã‚Äãnetworking, computing and data storage.  With the help of the SPDK, it was possible to demonstrate that it is possible to achieve excellent performance in millions of I / O operations per second using several processor cores and several NVMe drives without any additional equipment for unloading.  Intel provides the complete source code of the reference architecture for Linux under the broader and more liberal <a href="https://github.com/spdk/spdk/blob/master/LICENSE">BSD license</a> , it is distributed to the community through <a href="http://github.com/spdk">GitHub</a> .  <a href="http://spdk.io/">Spdk.io</a> has a blog, a mailing list and additional documentation. <br><a name="habracut"></a><br><h2>  <font color="#0071c5">Software Architecture Overview</font> </h2><br>  How does SPDK work?  Extremely high performance is achieved through the use of two main techniques: running at the user level using <a href="http://dpdk.org/doc/guides/prog_guide/poll_mode_drv.html">the polled mode drivers</a> (PMD).  Let's take a closer look at these two program principles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, running our device driver code at the user level means, by definition, that the driver code does not run in the kernel.  Failure to interrupt and switch the kernel context allows you to save significant computational resources and spend more cycles on the <i>actual storage of</i> data.  Regardless of the complexity of the storage algorithms (deduplication, encryption, compression, or regular block storage), the fewer wasted cycles, the better the performance, and the lower the latency.  However, I'm not saying that the kernel adds unnecessary costs;  it would be more accurate to say that the kernel adds the overhead needed for general purpose computing scenarios that may not be applicable to dedicated storage.  The underlying principle of the SPDK is to ensure the lowest delays and the highest efficiency by eliminating any sources of additional software costs. <br><br>  Second, protected-mode drivers change the underlying I / O model.  In the traditional I / O model, an application sends a read or write request, then goes to sleep and waits for an interrupt after an I / O operation completes.  Protected mode drivers work differently: the application sends a read or write request, and then switches to another job, periodically checking whether the I / O request is not executed.  At the same time, delays and costs associated with the use of interrupts are eliminated, the efficiency of application I / O increases.  In the era of using rotating drives (for example, tape drives and hard drives), interrupt costs were a small fraction of the total I / O time, but their use increased the overall efficiency of the system.  Now, in light of the proliferation of low-latency SSDs, interrupts already take up a significant portion of the total I / O time.  And the lower the delays, the greater the reduction in performance due to interrupts.  Systems are already capable of processing millions of I / O operations per second, so eliminating these costs for millions of transactions will lead to a drastic reduction in resource consumption.  Packets and blocks are distributed instantaneously, latency is minimized, thereby reducing delays, increasing throughput, and stabilizing delays (less fluctuations). <br><br>  The SPDK consists of many components that are interconnected and use common elements of the user level and work in the polled mode.  Each of these components was created to overcome a specific performance bottleneck discovered during the creation of the full SPDK architecture.  In this case, all developed components can be integrated into other architectures other than SPDK, which gives customers the opportunity to use the technologies used in the SPDK to accelerate the work of their own software. <br><br><img src="https://habrastorage.org/files/315/065/6dd/3150656dd55e43cba7452245f3037a76.png"><br><br>  Here are all these components in order from the bottom up. <br><br><h3>  <font color="#0071c5">Hardware drivers</font> </h3><br>  NVMe driver: the main component of the SPDK.  This optimized driver provides high scalability, efficiency and productivity. <br><br>  Intel OuickData Technology: Also known as Intel IOAT Acceleration Technology.  This is a copy of the offload subsystem built into the platform based on Intel Xeon processors.  By providing access to user space, the threshold for moving DMA data is reduced, making it easier to use small I / O operations or NTB bridges. <br><br><h3>  <font color="#0071c5">Internal block devices</font> </h3><br>  NVMe over Fabrics Initiator (NVMe-oF): From a programmer‚Äôs point of view, the local SPM driver, NVMe, and the initiator NVMe-oF share a common set of API commands.  This means that it is very easy to enable, for example, local or remote replication. <br><br>  Ceph RADOS block device (RBD): allows you to use Ceph as an internal device for SPDK.  This allows you to use Ceph, for example, as another level of storage. <br><br>  Blobstore block device: a block device highlighted by SPDK Blobstore.  This is a virtual device with which virtual machines or databases can interact.  These devices take advantage of the SPDK infrastructure, that is, the absence of locks and the high scalability of performance. <br><br>  Asynchronous Linux * I / O (AIO): allows SPDK to communicate with kernel devices, such as hard drives. <br><br><h3>  <font color="#0071c5">Storage Services</font> </h3><br>  BDAL Level (Block Device Abstraction Level): This generic block device abstraction layer is the connective medium connecting storage protocols with various device drivers and block devices.  It also provides flexible APIs for implementing additional functionality provided to customers (RAID, compression, deduplication, etc.) at the block level. <br><br>  Blobstore: implements ordered semantics, similar to file semantics (not POSIX *), for SPDK.  This component can support high performance databases, containers, virtual machines, or other workloads that are independent of most of the POSIX file system features, such as user access control. <br><br><h3>  <font color="#0071c5">Storage protocols</font> </h3><br>  ISCSI Target: Implementing the installed block traffic specification over Ethernet, about twice as efficient as Linux kernel I / O.  The current version uses the TCP / IP kernel stack by default. <br><br>  NVMe-oF goal: implementation of the new <a href="http://www.nvmexpress.org/specifications/">NVMe-oF specification</a> .  The purpose of NVMe-oF depends on the RDMA equipment, but it can serve traffic with a throughput of up to 40 Gbit / s per each CPU core. <br><br>  Target yhost-scsi: KVM / QEMU component using NVMe SPDK driver.  This allows virtual machines to access data carriers with reduced latency and reduces the overall CPU usage when executing workloads with intensive I / O operations. <br><br>  SPDK does not support all data storage architectures.  Here are some questions that can be used to determine if the SPDK components are suitable for your architecture. <br><br>  <b>Is the storage system built on Linux or FreeBSD *?</b> <br>  SPDK is tested and supported mainly on the Linux platform.  Hardware drivers are supported on FreeBSD and Linux. <br><br>  <b>Is the storage hardware platform built on the Intel architecture?</b> <br>  The SPDK package takes full advantage of the Intel platform, is tested and optimized for microprocessors and Intel systems. <br><br>  <b>Is storage performance in user mode?</b> <br>  SPDK has been able to achieve increased performance and efficiency by reallocating user-mode performance.  If you implement SPDK functions in applications, such as NVMe-oF targets, initiator or Blobstore, you can run the entire data processing pipeline in user space and thereby significantly improve work efficiency. <br><br>  <b>Does the system architecture allow non-blocking PMD drivers to be in-line</b> <b><br></b>  <b>model?</b> <br>  Since PMD drivers are constantly running in their own threads (instead of going to sleep and releasing the processor when idle), they have strict requirements for the flow model. <br><br>  <b>Does the system support the Data Plane Development Kit (DPDK) for working with loads consisting of network packets?</b> <br>  The SPDK uses the same primitives and programming models as DPDK, so customers using DPDK currently can use the SPDK integration.  If users use SPDK, adding DPDK functions for network processing can provide significant benefits. <br><br>  <b>The development team has the necessary knowledge to independently study and troubleshoot?</b> <br>  Intel is not obligated to support this software.  Both Intel and the open source software development community working with the SPDK will take commercially reasonable actions to investigate possible errors of un-released software, but Intel will under no circumstances commit to customers for any service or support this software solution. <br><br>  To learn more about the SPDK, please fill out the <a href="https://software.intel.com/en-us/form/596441">contact request form</a> or visit the <a href="http://spdk.io/">SPDK.io</a> website to access the mailing list, documentation, and blogs. <br><br>  The capabilities and benefits of Intel technology vary by system configuration.  Some hardware, software, or service activation may be required.  Performance may vary depending on system configuration.  For more information, contact the manufacturer or seller of your equipment or visit <a href="http://www.intel.com/">intel.com</a> . <br><br>  The software and workloads used in the performance tests could be optimized to achieve the highest performance only on Intel microprocessors.  Performance tests, such as SYSmark * and MobileMark *, are conducted using specific computer systems, components, software, operations, and functions.  Any change to any of these factors may lead to a change in results.  When selecting products to be purchased, refer to other information and performance tests, including performance tests of a particular product in combination with other products. <br><br><h2>  <font color="#0071c5">Configuration for performance tests</font> </h2><br><ul><li>  Two Intel Xeon E5-2699 v3 processors: 18 cores, 2.3 GHz (hyperthreading is disabled) <ul><li>  Note.  When testing performance used a single processor socket. </li></ul></li><li>  32 GB DDR4 RAM, 2133 million transfer operations per second <ul><li>  4 memory channels per CPU <ul><li>  One two-rank DIMM 4 GB per channel </li></ul></li></ul></li><li>  Ubuntu * (Linux) Server 14.10 </li><li>  Kernel 3.16.0-30 generic </li><li>  Ethernet Controller Intel XL710, 40GbE </li><li>  Eight P3700 NVMe Storage Drives </li><li>  NVMe configuration <ul><li>  Eight third generation PCIe * of four NVMe <ul><li>  Four 4 NVMe - the first x16 connector (divided into four x4 in BIOS) </li><li>  Four more NVMe - the second x16 connector (divided into four x4 in BIOS) </li></ul></li><li>  Intel DC Solid-state Drive P3700 Series, 800 GB </li><li>  Firmware Version: 8DV10102 </li></ul></li><li>  FIO test configuration <ul><li>  Direct access: yes </li><li>  Queue depth </li><li>  Random I / O 4KB: 32 operations in the queue </li><li>  64K serial I / O: 8 operations in a queue </li><li>  Preparation time: 30 seconds </li><li>  Runtime: 180 seconds </li><li>  Norandommap: 1 </li><li>  I / O system: Libaio </li><li>  Number of tasks: 1 </li></ul></li><li>  BIOS configuration <ul><li>  Speed ‚Äã‚ÄãStep Technology: Disabled </li><li>  Turbo Boost Technology: Disabled </li><li>  Power Policy and CPU Performance: Highest Performance </li></ul></li></ul><br>  For more information, see. </div><p>Source: <a href="https://habr.com/ru/post/326094/">https://habr.com/ru/post/326094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326082/index.html">Huawei HyperMetro - tested and implemented</a></li>
<li><a href="../326084/index.html">Audit of current vulnerabilities without registration and SMS</a></li>
<li><a href="../326086/index.html">Cisco CSR 1000v: Features Overview. Part 1</a></li>
<li><a href="../326088/index.html">Message based integration. Advantages and differences from other approaches</a></li>
<li><a href="../326090/index.html">Creating npm package of React components based on create-react-app</a></li>
<li><a href="../326096/index.html">PostgreSQL indexes - 1</a></li>
<li><a href="../326098/index.html">A step-by-step guide to the CSS Grid auto-placement algorithm</a></li>
<li><a href="../326102/index.html">Online cash vs blockchain: you did not know this, but thought about it?</a></li>
<li><a href="../326104/index.html">Not soon the fence is built, especially a beautiful data center. How we build the data center "Avantage". Part 1</a></li>
<li><a href="../326106/index.html">PostgreSQL indexes - 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>