<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rich Text Editor development: problems and solutions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Text editors, as a type of software, appeared a little later than dinosaurs, and most likely it was generally the first software that you encountered ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rich Text Editor development: problems and solutions</h1><div class="post__text post__text-html js-mediator-article">  Text editors, as a type of software, appeared a little later than dinosaurs, and most likely it was generally the first software that you encountered in your life, perhaps someone even caught up with MS-DOS Editor. <br><br>  However, with the transition of a large part of the software into browsers, the corresponding visual editors <strong>Rich Text Editors are</strong> relevant, and there are a lot of problem areas in their development.  If for some reason you decide to make your own editor, then think again - there is an opinion that this is not necessary. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c71/036/6be/c710366be05c09da455187caa7fca7a9.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So that you could make a more balanced decision, <strong>Yegor Yakovishen</strong> summed up all his experience gained in the process of creating <strong>Setka Editor</strong> , and told about the problems that he would have to face and what can be done to solve them. <br><br>  <strong><em>Disclaimer: The</em></strong> <em>article is written on the basis of a report by Egor at the Frontend Conf 2017 conference in June 2017.</em>  <em>The situation with browser support for certain APIs could have changed since then.</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ea/2c4/2d9/6ea2c42d90ea098a638a4d928b59c304.png"><br><a name="habracut"></a><br><br><h2>  About experience </h2><br>  Setka, a company in which I work, develops tools for streamlining processes in content marketing teams, online media editorial offices, and content brands that launch their publications.  One of our products is the cool visual editor Setka Editor, which allows you to create user-engaging content really quickly and without losing quality.  Here are a number of editor features: <br><br><ul><li>  multicolumn ‚Äúmagazine‚Äù layout; </li><li>  flexible customization of styles for each edition or brand; </li><li>  adaptive layout for all devices; </li><li>  standardization and automation of article creation processes (snippets, templates); </li><li>  custom CSS and JS-embeds; </li><li>  live preview - the ability to watch a clean version of the layout on the fly. </li></ul><br>  The editor can be used in WordPress (we have released a special plugin for this), as well as integrated into any other CMS. <br><br>  Setka was born within the walls of Look At Media publishing house, which brings together popular publications The Village, Furfur, Wonderzine and others.  You can read more about the background and development history of Setka Editor in an <a href="https://setka.io/rublog/how-we-built-setka-editor/%3Futm_source%3Dhabrahabr%26amp%3Butm_medium%3Dsetka_blog%26amp%3Butm_campaign%3Dhow-we-built-se">article from the Setka corporate blog</a> .  Below is an example of the layout of the post, which is made in our editor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a57/5da/59e/a575da59e83e94be4fe4ced2fcf21370.png"><br><br>  It can be both daily news, and longrida, and special projects. <br><br><div class="spoiler">  <b class="spoiler_title">There are many more examples under the spoiler.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b00/881/1a2/b008811a2ff43fc8274ad186c5f0cce3.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f66/f28/8b1/f66f288b1749e6bf78cfcf401a18b6a0.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a9/243/176/8a9243176ca987702a0fa54d13c248cb.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/740/1b1/01e/7401b101e356c666b58143747f011522.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/642/477/709/642477709893f2200e1222babb2ee9df.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b00/b40/3a1/b00b403a12ffc20b4168bb58d0a05716.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/f32/790/ea5f32790bc84ef36811272449c226af.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/de9/690/18d/de969018db5848a9425d9ec9646e84f2.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/685/f49/e17/685f49e172e8ffabd178d2f855582158.png"><br></div></div><br>  Posts created in Setka Editor only on our publications monthly generate <strong>more than 20 million views per month</strong> - just so that you understand the scale of the tasks that we have to face. <br><br>  So let's go! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xVcK1YBGXG8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Prehistory </h2><br>  Text editors, as a type of software, appeared a long time ago.  Probably, for many, it was generally the first software they encountered in their lives.  Someone may have found the <strong>MS-DOS Editor:</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77e/7cd/2f9/77e7cd2f978e7ce211cfac39796d93f2.png"><br><br>  Obviously, everyone saw <strong>Notepad</strong> in its different versions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14a/599/7d4/14a5997d4eb8b3eb44ec0cce5d829f7a.png"><br><br>  <strong>Microsoft Word has</strong> also gone through many versions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff5/87c/7b2/ff587c7b26b0d2e177237b74d7f501a7.png"><br><br>  In addition, there are specialized programs, for example, <strong>Adobe InDesign</strong> , for really complex magazine layouts: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/13e/bec/bc0/13ebecbc07db0cce46ae4894ac9058ce.png"><br><br>  But this is all classic software that works in the operating system as desktop software. <br><br>  Meanwhile, in the browser, the situation is different.  First, we have the usual textarea.  This is a field where you can write text, it works absolutely everywhere - great cross-browser compatibility!  But there is a problem: no stylization, and even more complicated layout in this textarea will never be done, because this is just a plain text input field.  It is only slightly more complex than text input. <br><br>  There are many products that call themselves Rich Text Editor.  You have probably come across them many times on different sites.  Here are some classic representatives. <br><br>  <strong>Tinmyce</strong> <br><img src="https://habrastorage.org/getpro/habr/post_images/326/d3b/b2c/326d3bb2ca151c019fbdd4bb9e0d0d2f.png"><br><br>  <strong>CKEditor</strong> <br><img src="https://habrastorage.org/getpro/habr/post_images/799/6f6/92c/7996f692c934e33a9e638488ae7125cc.png"><br><br>  <strong>Froala editor</strong> <br><img src="https://habrastorage.org/getpro/habr/post_images/5e9/70c/ec6/5e970cec604f7f261716470342235bd9.png"><br><br>  And dozens of other projects of different levels of development, most of which have so-called ‚Äúgeneric problems‚Äù. <br><br><h3>  Typical problems Rich Text Editors </h3><br>  <strong>WYSIWYG</strong> <br><br>  In almost all editors, the key principle of <strong>WYSIWYG</strong> (What You See) is not observed.  This means that the layout you see in the editor will not necessarily coincide with what visitors see on your site.  In the editor you work with a small window of a fixed size, and on the pages of the site everything turns out to be completely different, since  there is a specific site template with its own styles, another width of the content area, additional blocks, etc.  And if the user enters the site from a mobile device, completely different rules are already applied there. <br><br>  <strong>Very few or too many functions.</strong> <br><br>  Functions in such editors, as a rule, are either very few (bold, italic, text alignment), or too many - 5 lines of buttons that cannot be understood. <br><br>  <strong>It is difficult to "make friends" with an existing site design.</strong> <br><br>  The design has already been approved by the art director, the site is up and running.  And now you need to somehow make your editor friends with this design so that you can make a beautiful layout in it, but within the framework of the company's corporate identity.  This can be quite a challenge. <br><br>  <strong>Cross-browser compatibility</strong> <br><br>  Many editors have problems with cross-browser compatibility, both with their interface and with the layout they generate.  This is especially true of old IE and Safari, but at times Firefox sometimes surprises. <br><br>  <strong>General purpose tools</strong> <br><br>  In most cases, Rich Text Editor is simply a tool for translating visual blocks into HTML and CSS code created for people who for various reasons do not want or cannot write code manually.  If you need a more advanced tool for solving your problems, then often WYSIWYG editors from helpers turn into obstacles. <br><br>  There are also a lot of other problems, for example: <br><br><ul><li>  HTML code in such editors, as a rule, undergoes a very strong cleaning or, on the contrary, it does not pass at all.  That is, either you are severely limited in capabilities, or create a potential XSS vulnerability. </li><li>  This often creates problems with SEO. </li><li>  As a rule, such editors allow you to create posts only for the desktop, and you do not know in advance how your content will be converted to mobile.  Although, for example, on our sites, mobile traffic is already more than 50%. </li><li>  Support for very old browsers (and a lot of legacy code because of this) or, on the contrary, only the newest </li></ul><br>  And so on.  <strong>There are really a lot of problems and questions.</strong> <br><br><h2>  You decided to make your editor </h2><br>  So, the moment X came, and for some reason you decided to make your own editor. <br><br>  <strong>Nice try, but don't do it!</strong> <br><br>  The Internet is just full of posts, where it says that you should not do this.  Most likely, a lot of restrictions will prevent you from making a really good product. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c71/036/6be/c710366be05c09da455187caa7fca7a9.png"><br><br>  In particular, this is a screenshot from <strong>StackOverflow</strong> , in which one of the developers of CKEditor (one of the old and famous editors) writes that they have been doing it for 10 years, they still have thousands of issues and, unfortunately, they cannot get a good result - not because they are bad developers, but because they are bad browsers. <br><br>  Nevertheless, you still rejected all doubts and want to make your editor.  What are the key questions you face?  It will be necessary to understand: <br><br><ol><li>  how to edit content on a web page; </li><li>  how to store this content; </li><li>  how to deal with styles (CSS); </li><li>  how to extend the functionality of the editor. </li></ol><br>  We will talk about this today.  Let's start in order. <br><br><h2>  How to edit content? </h2><br>  Historically, browsers for this provide the following features. <br><br>  <strong>Designmode</strong> <br><br>  The document object has such a property, it exists for a very long time - probably, in the late 90s it was implemented in the first versions of Internet Explorer. <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.designMode = <span class="hljs-string"><span class="hljs-string">"on"</span></span></code> </pre> <br>  When this property is switched to the <strong>on</strong> mode, then absolutely the whole page, the entire contents of the body becomes editable.  You can place the cursor anywhere and edit the text. <br><br>  If you google, you can see the enthusiastic comments 10-15 years ago on forums like Antimat, how cool you can edit any page, for example, Microsoft, Google and so on. <br><br>  This way is imperfect.  Its main problem is that, more often than not, it‚Äôs not necessary to edit the whole page, but only a specific block.  Probably the only case when the designMode is applicable is when the editable area is in an iframe, and you really want to make this block entirely editable.  But these situations are not very many. <br><br>  <strong>Contenteditable</strong> <br><br>  This is the main browser API for creating editable blocks.  When this attribute is switched to <strong>true,</strong> everything inside the block becomes editable.  In this way, most visual editors are now done, and ours is no exception. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span>    ‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The problem is that each browser implements user actions in this block differently.  The simplest example: there is a block with the text ‚ÄúHello, world‚Äù, turn on contenteditable = ‚Äùtrue‚Äù, it becomes editable.  Next, put the cursor after the comma after the word "Hello" and press the Enter button. <br><br>  After that, a new &lt;div&gt; inside the block will appear in Chrome and Safari, there is an unbreakable space and the remaining word "world". <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> Hello, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>nbsp;world<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And in Firefox - line break &lt;br&gt;. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äútrue‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span> Hello, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> world <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Thus, you have no control over the situation, because each browser acts differently. <br><br>  <strong>Document.execCommand</strong> <br><br>  This is a special method that allows browser commands to be applied to a selected part of the text.  There are a fixed number of such commands, for example, bold, fontSize, formatText, and so on. <br><br>  <strong>Js</strong> <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.execCommand(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.execCommand(<span class="hljs-string"><span class="hljs-string">'fontSize'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre><br>  <strong>HTML</strong> <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Hello<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>, world <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">font</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äú7‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span>Hello<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">font</span></span></span><span class="hljs-tag">&gt;</span></span>, world</code> </pre><br>  This API also exists a long time ago and it is extremely unstable.  Suppose, in the same example, you selected the word ‚ÄúHello‚Äù and executed the execCommand ('bold') command.  The text turned into a &lt;b&gt; tag.  What potential problems could there be?  First, maybe I want not &lt;b&gt;, but &lt;strong&gt; (I was advised by SEOs).  Or, maybe, I want to add another class to this &lt;b&gt; tag and I will have to do an additional action. <br><br>  Okay, &lt;b&gt; is still not so scary, and if I want, say, to make the font a big headline?  I run the browser fontSize command, pass the value 7. And what?  Inserted tag &lt;font&gt;, which we have not seen on sites since the beginning of the 2000s, with the 7th size.  Yes, visually, this is similar to what was required, but in terms of code, semantics, SEO, and subsequent support, this is a nightmare. <br><br><blockquote>  <strong>Summary:</strong> <br><br><ul><li>  Different browsers generate different HTML. </li><li>  execCommand does not work everywhere and not always (and also in different ways). </li><li>  You do not control what happens. </li></ul><br></blockquote><br>  As a result, if you use only standard API, then the editor is incomplete.  You cannot use semantic tags and apply correct styles, you do not know how to parse it later and how it will affect SEO. <br><br>  There is a textbook article ‚Äú <a href="https://medium.engineering/why-contenteditable-is-terrible-122d8a40e480">Why ContentEditable is Terrible</a> ‚Äù, in which developers describe why contenteditable is bad, and what to do about it. <br><br><h3>  Alternative ways </h3><br>  To avoid these problems, you can make your editor using <strong>canvas.</strong> Such examples exist, but, in fact, you have to completely reinvent the entire rendering of the text, cursor, selection, etc. <br><br>  We will now see that in fact a lot of this has to be done.  But in the case of Canvas, you work with the text area in fact as with a picture.  It is too complicated and most likely you will get so many problems that all this work will become ungrateful. <br><br>  The second method, which is most often used in practice in almost all modern editors (and in particular, in our country), is a bunch of <strong>contenteditable areas and</strong> document state <strong>storage</strong> based on the actions that take place in this area. <br><br>  Let's say you have a contenteditable area.  In its classic use, you put the cursor, write text, and the content changes, and, as we said, it changes unpredictably.  In this case, when you write something to input, the state first changes as necessary, and then the input is redefined based on the state change.  In essence, this is an approach called React Controlled Input in React.  This, in turn, can cause performance problems with fast typing.  Then you need to use a hybrid version: input text characters immediately display in the DOM, and more complex actions to process first yourself. <br><br>  Suppose you put the cursor in a text field and press Enter.  The editor understands that it is necessary to insert a line break, or if at this moment you have not selected the text, but the object, then you need to perform some other action.  Thus, you can control absolutely everything: what happens in your editor: perform the necessary actions, cancel unnecessary, etc. <br><br>  <strong>General scheme:</strong> <br><br><ul><li>  contenteditable is used as an interface for tracking events; </li><li>  all events are intercepted and the document state changes (except for events that occur very often and negatively affect performance, for example, the movement of the caret cursor - they can be monitored separately and use debounce or throttle); </li><li>  after changing the state, React is connected and updates the DOM representation of the document; </li><li>  controlled input. </li></ul><br>  The state can store: <br><br><ul><li>  <strong>Content</strong> (text, images, embeds, separators).  The structure can be nested - for example, our layout is built largely on the use of multi-column grids of any depth of nesting. </li><li>  <strong>The position of the cursor</strong> .  It is useful to remember where the cursor is positioned so that later it can be returned to its place, saved, serialized, etc. </li><li>  <strong>Select text</strong> .  We'll talk about this in more detail below. </li><li>  <strong>Editor's UI</strong> ‚Äî for example, which panel is currently open, what is active, what is not active, what mode you are in, etc. </li></ul><br>  Thus, all this can be stored in the state, and work with the editor as an application that changes this state.  For example, here is the editor of <strong>Draft.js</strong> from Facebook, made at React: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/672/a97/94d/672a9794dd4187ac6cbb6a7facc95368.png"><br><br>  The screenshot shows how they store the state of their editor.  The text consists of two lines, and on the right they are presented as a JS object.  They have text attributes, each has its own unique key key, they can be styled or not, etc. <br><br>  But the farthest in this issue went <strong>Google Docs with its kix engine.</strong>  They had a completely non-standard task: not just developing an editor, but also implementing simultaneous multi-user work.  This means synchronization of changes, multiple cursors, and all other complex things that generally lie outside the editor‚Äôs design issues. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f0/524/835/2f052483598bafc5e584df021f3d6660.png"><br><br>  To do this, they track all the events that occur on the page, in a special Iframe, which is generally far, far away from the screen.  The screenshot shows that this iframe has a top coordinate of ‚Äì10000px, and a height of only 1px.  It is used only to intercept events that occur on the page.  As you can see, this iframe doesn't even have content, only an empty container with <strong>contenteditable = "true"</strong> .  That is, it is exclusively a service tool. <br><br>  To solve all the tasks, the developers of Google Docs, had, in fact, to reinvent the entire system of text rendering in the editor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/909/98e/fd2/90998efd20cba9ea86f1c868d3bdf8ad.png"><br><br>  The screenshot above shows the selection of the text, and you can see that this is not a standard selection of the operating system, but also a special div called kix-selection-overlay.  It has background-color, opacity, size and coordinates.  That is, this is a special DOM wrapper around the content, which is a selection. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1df/f9e/5b1/1dff9e5b1d049a30cdea49ce9082ef86.png"><br><br>  Moreover, they even have a cursor - it‚Äôs a 1-2px wide div, line-tall, with certain CSS properties applied to it, which allow it to flash for half a second.  Thus, there can be 5 cursors on a page at a time, if it is edited by 5 people. <br><br><h2>  How to store content? </h2><br>  Here we turn to the question of how to store the state of the content in the state.  Traditionally, the content that is displayed on web pages is stored as HTML. <br><br>  This has its advantages: <br><br><ul><li>  Such content is <strong>easy to show</strong> in the browser, because browsers are well able to render HTML.  If you pass in for example JSON, then it will be displayed as a JSON-tree.  You will have to first convert it to HTML and style it as needed. </li><li>  HTML is <strong>easy to change</strong> without editor.  If for some reason the editor does not work, you can always correct the code as you see fit, </li><li>  Most likely, now the content is stored in the database of your site in this way (in the form of HTML). </li><li>  Finally, and also importantly, other code, such as search bots or third-party <strong>plug</strong> - <strong>ins, is accustomed to working with HTML</strong> , and not with the structure that you can think of. </li></ul><br>  But there are also disadvantages: <br><br><ul><li>  First, as we have already discussed, <strong>different browsers produce different HTML</strong> from contenteditable regions. </li><li>  Such code is <strong>more difficult to export</strong> to other formats such as Facebook Instant Articles or JSON.  This is true if you want your content to be displayed not only on the site, but also fly into a mobile application, be available for download in PDF, etc.  Every time we have to parse the HTML, clean out the excess and turn it into the format that is required. </li><li>  This <strong>content is closely related to the design</strong> using HTML attributes such as style, class, etc. </li></ul><br><h3>  Own format </h3><br>  Anyway, most likely you will need your own convenient format for storing the contents of the document. <br><br>  <strong>Decomposition on entities</strong> <br><br>  First, you need to decompose into entities what you are working with in the editor.  Most likely, you will have classic elements of any text: <br><br><ul><li>  title; </li><li>  paragraph; </li><li>  picture; </li><li>  table; </li><li>  list; </li><li>  comment. </li></ul><br>  In the code editor there will be your entities, in the graphic editor - others.  You need to understand what content you are working with. <br><br>  <strong>Data structure</strong> <br><br>  Further, these entities should be presented in the form of a structure with types and attributes, with which you can then work.  Here is an abstract example of the structure of a text element: <br><br><pre> <code class="hljs css">1: { <span class="hljs-attribute"><span class="hljs-attribute">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, type: <span class="hljs-string"><span class="hljs-string">"Paragraph"</span></span>, content: <span class="hljs-string"><span class="hljs-string">"this is a text"</span></span>, style: [ { range: [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>], format: [<span class="hljs-string"><span class="hljs-string">"bold"</span></span>] } ] }</code> </pre><br>  In this example, you can see that there is a Paragraph element, it has a certain content, and its first 4 letters are formatted in bold format.  Such a structure can be rendered in any kind of representation, for example: <br><br><ul><li>  Plain text without any design; </li><li>  HTML; </li><li>  PDF for printing and saving; </li><li>  JSON, XML; </li><li>  RSS; </li><li>  Facebook Instant Articles, Google AMP, Apple News. </li></ul><br>  Importantly, such a structure can be displayed in the editor in one way (for example, with additional editing elements, buttons, etc.), and from the outside - in a completely different way.  Thus, you again become a full-fledged master of what is happening with your content. <br><br>  You can ask the expected question: ‚ÄúListen, my content is stored in HTML for many years, I have my own CMS.  Do you propose to forget everything, invent your own format and then rewrite all the code to work with it?  Obviously, I do not want to do this, because the benefits from a business point of view are incomprehensible " <br><br>  We had the same problem when we implemented the editor on our sites, where there was a large proportion of legacy code and thousands of post posts. <br><br><blockquote>  <strong>Workaround:</strong> <br><br><ul><li>  Store data in the database in the form in which they are already.  Most likely it is HTML. </li><li>  When you load them into the editor, parse them and work with your format.  And when saving data to the database, serialize it back to HTML and save it in this form. </li><li>  This is useful in cases when you need to work in an established ecosystem (for example, CMS with plugins like WordPress). </li></ul><br></blockquote><br>  We are doing exactly that now.  Our editor works on a variety of platforms, and we do not have the right to impose our data storage format.  We need to work with what is. <br><br><h2>  How to work with user input? </h2><br><h3>  Types of user input in the browser: </h3><br><ul><li>  Good old keyboard.  It happens also virtual, and also allows to use hot keys. </li><li>  Context menu. </li><li>  Copy &amp; Paste. </li><li>  Drag &amp; drop. </li><li>  Voice input, which is becoming increasingly popular. </li><li>  Handwriting that is relevant in Asian countries: you draw something that turns into a text character, and then enters the text field. </li><li>  Autocorrection and autocompletion. </li></ul><br>  Your editor is not required to support absolutely all of these input methods.  Most likely, few people will enter long texts in a voice so far, but, nevertheless, possible options should be taken into account. <br><br><h3>  Browser APIs </h3><br>  The browser for this offers a whole "zoo" of various APIs, because contenteditable-areas, unfortunately, do not have a single change event to which you can subscribe and know exactly when changes occur.  There are several key APIs with which you can work somehow.  Although I will emphasize, in almost every post about the creation of visual editors - and my story is no exception - it is emphasized that the situation with the browser-based API is bad. <br><br>  <strong>Selection API</strong> allows you to work with the selection of text on the page. <br><br>  Contains 2 useful events: <strong>selectstart</strong> and <strong>selectionchange</strong> .  Selectstart is triggered when we start to select a region of text on a page, and the selectionchange is triggered every time the selection changes.  Moreover, what is useful, it works not only when the selection changes with the cursor, but also when we press the Shift + arrows or Ctrl-A to select all the content on the page. <br><br>  <strong>Window.getSelection ()</strong> - using this method, you can get an object with information about the current selection of text on the page.  This object contains useful properties, such as anchorNode and focusNode.  AnchorNode is the node on which the selection began, and focusNode is the node on which the selection ended.  Each of these nodes can have its own offset, i.e.  number of selected characters in this node. <br><br>  As an example, consider the screenshot of the FrontendConf website page.  I highlighted the text, starting with the word ‚Äúdesign‚Äù and ending with the phrase ‚Äúmobile sites,‚Äù considered the current selection and looked at what exactly was highlighted.  You can see that anchorNode and focusNode are both text nodes, anchorOffset = 11 (the word ‚Äúdesign‚Äù starts at the 11th position), and focusOffset = 15.  In this way we can understand which text on the page is currently highlighted. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/92d/6bd/d7b/92d6bdd7bfb8af84a0b7b10e6b357fa3.png"><br><br>  Selection API is fairly well maintained and fairly stable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99f/c10/b83/99fc10b83562be8fd46cd382853ce18a.png"><br><br>  The next API is clipboard, <strong>Clipboard API</strong> .  There are much more problems with him, there are some stars and comments everywhere. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db2/322/ab0/db2322ab0ab3814711061175a405240f.png"><br><br>  The Clipboard API offers several events that you can subscribe to: copying content (copy), cutting (paste), pasting (paste), and what happens right before this: beforecopy, beforecut, beforepaste. <br><br>  Some of them can be self-invoked using execCommand, but for security reasons, many actions with the clipboard are blocked. <br><br>  For example, if the user himself initiated copying, pressed &lt;Ctrl-C&gt; or &lt;Edit-Copy&gt;, a copy event occurs, and at this point the developer <strong>can</strong> intervene and perform certain actions: <br><br><ul><li>  change the contents of the clipboard; </li><li>  disable insertion; </li><li>  change the insertion algorithm; </li></ul><br>  But it is impossible to initiate an operation with the clipboard if the user does not want this. <br><br>  The reasons for this are clear: suppose a person on the clipboard has a password or credit card number.  If a browser application could independently read this data and send it somewhere, then there would be no security.  Therefore, if the user himself does not initiate an event, we cannot in any way call it ourselves. <br><br>  Clipboard API support is good, but there are certain limitations.  Suppose you want in your editor to copy not just text, but some complex object.  But the <strong>copy</strong> event will not occur if the page does not have selected text.  To do this, you can use the algorithm of the company Trello, which they <a href="https://stackoverflow.com/questions/17527870/how-does-trello-access-the-users-clipboard">openly write on Stack Overflow</a> .  For a user, this works like this: you move the cursor over some card in the board, press Ctrl-C, then move the cursor to another place, press Ctrl-V, and this card is inserted into the right place. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a90/90e/46f/a9090e46f57efce615fb0487a715c4dc.png"><br><br>  Implemented as follows: <br><br><ul><li>  <strong>Intercepted by pressing the Ctrl key.</strong>  The developers of Trello captured a pattern of behavior: when a person presses Ctrl, that is, there is a high probability that after this he will press &lt;C&gt; to copy. </li><li>  <strong>An invisible textarea is created with the code of the element to be copied.</strong>  When you press Ctrl off-screen, an invisible textarea is created, where the code of the element that the person wants to copy is placed, and a cursor and focus are placed there. </li><li>  <strong>The user presses &lt;C&gt;</strong> and his code is copied, which is in this textarea (because there is a cursor). </li><li>  <strong>The insert event is intercepted.</strong> </li></ul><br>  When the user then moves the cursor to another location and clicks "Paste", the insert event is intercepted, and with the help of JS the card is inserted into the list that the cursor is hovering over. <br><br>  At home we copied complex objects in a similar way. <br><br>  <strong>Composition Events</strong> <br><br>  There is a separate type of API events that we do not encounter very often, because they are largely associated with accents and hieroglyphs, which are inserted by several composite actions.  Also, these events are associated with alternative input methods, such as voice. <br><br>  In a few words about how they work: if you want to insert an √† - character with a accented character, at macOS you press &lt;Alt + '&gt;, then &lt;a&gt;, and they are glued together into a single √† character. <br><br>  This causes several events at once: <br><br><ul><li>  compositionstart - the beginning of the process of composition of one character from several; </li><li>  compositionupdate - add each component of this symbol; </li><li>  compositionend - the formation of the final symbol. </li></ul><br>  Voice input also works the same way: you slander the text, the browser decodes it, turns it into a string, and compositionupdate happens.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you finish speaking, compositionend occurs and the final line appears. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Undo / Redo</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Another familiar function of text editors is undo and redo, i.e. the ability to undo their actions. But the system mechanism is no longer suitable for us, because, I remind you, we store data in our own format in the state, and the system mechanism will affect only those changes that occurred in the DOM, i.e. state will not roll back.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, you have to intercept the pressing of the &lt;Command + Z&gt; / &lt;Ctrl + Z&gt; buttons and implement your Undo / Redo mechanism, which, as a rule, is based on storing state snapshots. </font><font style="vertical-align: inherit;">The algorithm is simple: some kind of action happened, we saved the snapshot, and then we can return to it. </font><font style="vertical-align: inherit;">Some changes it makes sense to group in one record of history. </font><font style="vertical-align: inherit;">There is a convenient </font></font><a href="https://github.com/omnidan/redux-undo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redux-undo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module for working with history </font><font style="vertical-align: inherit;">.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to be with CSS? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, you have a document format and you learned how to edit it. </font><font style="vertical-align: inherit;">But besides the structure, he also has styles, and here, too, not everything is not so simple:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An editor is a component that by itself (outside the application) is of little use. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The editor has its own styles (UI) - panels, buttons, sizes, etc. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The editor lives inside the application, for example, CMS. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The application has its own styles. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inside the editor lives the post itself, which you are editing. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The post also has its own styles (fonts, colors, etc.). They can be completely different. </font><font style="vertical-align: inherit;">You can create posts with different corporate styles in the same editor.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We need to isolate all this from each other, and we remember: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CSS rules live in the global scope; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The order of application of the rules is determined by specificity; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> With all this, we need to ensure the principle of WYSIWYG - that in the editor, then on the site. </font></font></li></ul><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example WordPress CSS</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the screenshot below we see the interface for creating a post in WordPress. </font><font style="vertical-align: inherit;">The whole page is an application, it has its own styles of UI-elements (text fields, buttons, headers, etc.). </font><font style="vertical-align: inherit;">The green area is a plugin of our editor with its own UI-styles. </font><font style="vertical-align: inherit;">Inside the editor is a post (blue block). </font><font style="vertical-align: inherit;">Since the editor is located right in the DOM tree of the page, and not inside the iframe, we need to make sure that the styles of all these components do not affect each other. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/281/35f/6fd/28135f6fd8ee58b849bbf7e7080b264f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A real example of CSS from WordPress code: for all H2 headers that lie inside a block with id = "poststuff", certain typography and indent rules are specified. </font><font style="vertical-align: inherit;">And we remember that selectors that have an id specified have a very large weight, which can only be interrupted by the same selector or even stronger.</font></font><br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#poststuff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span> <span class="hljs-number"><span class="hljs-number">12px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">1.4</span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> So, we need to isolate: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CMS editor; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> post from the editor and CMS; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CMS from the editor and post; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Website template (header, basement, sidebar, additional widgets) from the post styles created in the editor. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we deliver our product with the ability to configure post styles separately from the site styles, the site template style and post style should not conflict with each other. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The 3 main ways to isolate CSS are:</font></font></strong> <br><br><ol><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS reset + BEM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - all pre-set and apply a specific naming system for your classes. </font><font style="vertical-align: inherit;">In this case, this is the most common BEM, but you can replace any other methodology.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Putting everything in an </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iframe</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is more ‚Äúreinforced concrete‚Äù protection, but with its own drawbacks.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is hidden in the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadow DOM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Custom Elements</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but the obvious disadvantage of this method is poor browser support.</font></font></li></ol><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CSS reset + BEM </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose we want to interrupt those styles of WordPress CSS styles that were considered above with our styles. </font><font style="vertical-align: inherit;">The only way to do this with selectors is to set the selector with the same weight and override the rule. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress CSS</font></font></strong> <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#poststuff</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; }</code> </pre><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS editor</font></font></strong> <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#my-editor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">28px</span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or you can get on the slippery track of </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inline-styles and! Important</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but then in the future we will begin constant conflicts with specificity (both someone else‚Äôs and our own). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unfortunately, all this does not give a 100% guarantee - for every cunning selector there will be an even more cunning selector who will interrupt him.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iframe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the one hand, everything in the iframe is convenient, because then everything will be precisely isolated, because there is a barrier between the page and the editor. On the other hand, this barrier will be permanent, but we need to periodically exchange messages between the external page and the content of the iframe, and simply can‚Äôt do it. There are other problems typical for frames - for example, its size needs to be automatically adapted to the height of the block with content inside it. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shadow DOM + Custom Elements</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perhaps the most advanced approach that everyone is looking forward to is using Shadow DOM and Custom Elements. Then it will be possible to turn the editor into a web component, inside it will have a shadow root and all content will be completely isolated.</font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-editor</span></span></span><span class="hljs-tag">&gt;</span></span> #shadow-root <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-editor</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That would be great, but so far, from this bright future, we are limited by the fact that Shadow DOM is normally supported only in a few browsers. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8aa/479/e84/8aa479e840cea275f68507f1faeb1900.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With Custom Elements, the same story.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/2b4/ef7/ec82b4ef7ef745d33a2fc2bdf880ea78.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adaptive layout </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I recall that we now have half the traffic - mobile devices, and this value continues to grow. </font><font style="vertical-align: inherit;">At the same time, our editors and publishing designers work on desktop computers and laptops, but they want to see how their layout, especially complex, will look on mobile devices. </font><font style="vertical-align: inherit;">Also, sometimes there is a need to change the settings of certain elements of the post, so that they are better displayed on smartphones, especially for multicolumn grids. </font><font style="vertical-align: inherit;">At the same time, we don‚Äôt want to adapt everything every time manually - I want it to work right away without the participation of developers.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We implemented a special preview mode (preview) in our website, where you can see how the post looks on the desktop, and then switch to mobile mode and see how it will look on mobile devices (and both modes are displayed on wide screens) . To do this, we on the fly generate 2 iframes with a certain width - one for the desktop, the second for mobile. They include the same CSS file that is used later on the site. This ensures the principle of WYSIWYG. But because the width of the iframe is limited, it becomes possible to apply mobile rules for media queries. Thus, you can see the real result, which will then be on the smartphone. Each time you click the button to switch to the Preview mode, we generate the necessary HTML and put it inside the iframe, it happens quite quickly.The iframe has no SRC attribute, its content is programmatically changed every time programmatically.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to extend the functionality? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Congratulations, you wrote an editor, and it works. </font><font style="vertical-align: inherit;">You have a kernel, but this is not enough: you constantly need to finish new features. </font><font style="vertical-align: inherit;">Therefore, the editor, like any extensible product, must have a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public API and plug-in connection system</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">And, of course, this should all be </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documented</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The API should be able to: </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> get and change content in the editor; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> register event callbacks in the editor; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> integrate the editor with the external environment (CMS, application). </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plugin system </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you built the editor on the principle of the immutable state, then, in essence, every plug-in, as used in Redux terminology, is a set of actions and reducers. </font><font style="vertical-align: inherit;">Examples of plugins:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spellchecking; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autotype autograph; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> integration with external services (Google Drive, etc.). </font></font></li></ul><br><blockquote>     ,   <strong> </strong>   .      ,     : <br><br><ul><li> oembed   HTML; </li><li>  context menu; </li><li>  ; </li><li>   HTML  CSS-; </li><li> - (); </li><li> ; </li><li> -; </li><li>       API. </li></ul><br></blockquote><br><h2>  rich text editing </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Components</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are coming </font><font style="vertical-align: inherit;">to help solve the problem of isolating components and their styles on the page, which would be very useful. </font><font style="vertical-align: inherit;">If we talk about the text editing API, now the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W3C Input Events</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> specification is in development </font><font style="vertical-align: inherit;">, which introduces </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">input</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before </font></font></strong><font style="vertical-align: inherit;"><strong><font style="vertical-align: inherit;">input</font></strong><font style="vertical-align: inherit;"> events for editable areas </font><font style="vertical-align: inherit;">and provides detailed information about what action took place, for example:</font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insert</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - insert text;</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertReplacementText</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - replacing specific text with auto-correction;</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deleteByCut</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - delete;</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formatBold</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - formatting.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional properties: </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InputEvent.data (insert *, format *)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> makes it clear which formatting is used.</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InputEvent.dataTransfer (text / plain, text / html)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> allows you to get content that changes in text / plain mode or text / html mode.</font></font></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InputEvent.getTargetRanges ()</font></font></strong> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, this is a much richer API that will allow you to make more advanced web editors. </font><font style="vertical-align: inherit;">Moreover, in the comments to this specification it is written that this is still not an ideal solution, and developers are invited to participate in the process of writing and approving the document.</font></font><br><br><h2>  findings </h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to edit data? </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use contenteditable to track events. </font><font style="vertical-align: inherit;">Now this is the best tool for creating editors: track user events, change state and update your editor.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Store the state of the editor and content in state. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not store the state in the DOM. </font><font style="vertical-align: inherit;">This applies, probably, to any application, not just the editor.</font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to store data? </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Identify the entities you work with. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Think over the state structure. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Write the code that will translate this structure into the formats you need. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to be with CSS? </font></font></h4><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The editor will live in an environment that you do not control. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Think about CSS isolation in advance. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Put the editor in the iframe or clean everything you can. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Expansion of functionality </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Think ahead: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modular architecture. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The ability to write and connect plugins. </font></font></li></ul><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples of good modern editors:</font></font></strong> <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quill (Salesforce, Telegra.ph); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Draft.js (Facebook); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trix (Basecamp); </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ProseMirror, CodeMirror; </font></font></li><li>  Google Docs </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iCloud Pages. </font></font></li></ul><br><h3>  Contacts: </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬ª </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Email: </font></font></strong> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yakovishen@setka.io</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram: </font></font></strong> <a href="https://t.me/yaplusplus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/yaplusplus</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Facebook: </font></font></strong> <a href="https://www.facebook.com/yaplusplus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facebook.com/yaplusplus</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter: </font></font></strong> <a href="https://twitter.com/yaplusplus"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">twitter.com/yaplusplus</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setka website: </font></font></strong> <a href="https://setka.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://setka.io</font></font></a> <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the web and the frontend in particular, on the one hand, everything is developing very fast, the frameworks there are impossible to keep track of. </font><font style="vertical-align: inherit;">On the other - there are basic questions, such as in this article. </font><font style="vertical-align: inherit;">We will talk about this and about this at the May festival of </font></font><a href="http://ritfest.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RIT ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conferences </font><font style="vertical-align: inherit;">and invite active specialists </font></font><a href="http://speakers.ritfest.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to submit applications</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and make presentations.</font></font></blockquote></div><p>Source: <a href="https://habr.com/ru/post/350252/">https://habr.com/ru/post/350252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350238/index.html">If you don't have a dog ...</a></li>
<li><a href="../350240/index.html">Nine questions about working with memory in V8</a></li>
<li><a href="../350246/index.html">Mikrotik vs Old PC, the problem of choice in a small business</a></li>
<li><a href="../350248/index.html">Heatmap painter</a></li>
<li><a href="../350250/index.html">Rolling Scopes Conference 2018: Woodstock for a front-end developer</a></li>
<li><a href="../350254/index.html">Dragon Bones: 2D character creation and skeletal, mesh animation</a></li>
<li><a href="../350256/index.html">Dovecot and Apache Solr integration</a></li>
<li><a href="../350258/index.html">What is missing in Trello for Agile development and where to look for alternatives?</a></li>
<li><a href="../350260/index.html">End of software engineering and last methodologist</a></li>
<li><a href="../350262/index.html">Native or not? 4 myths about cross-platform development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>