<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flood-it game automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 After posting the question of whether it will be interesting to read about automating the process of the game in Flood-it. There were sev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flood-it game automation</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  After posting the <a href="http://habrahabr.ru/qa/11806/">question</a> of whether it will be interesting to read about automating the process of the game in Flood-it.  There were several positive reviews, in connection with which I publish this article. <br><br><h4>  Introduction </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Flood-it is a 14x14 playing field with multi-colored cells, the player‚Äôs task is to fill the field with one color in the least number of moves.  Each turn represents a choice of colors from a palette, there are six colors in the palette.  There are 25 moves per game. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/180/fb0/bc8/180fb0bc882a5a228e7e9314530c9da3.png" alt="Playing field Flood-it"><br>  <i>Figure 1: The playing field.</i> <br><br>  It is necessary to implement an algorithm to select the optimal color for the fill.  Details can be read implementation under a cat. <br><a name="habracut"></a><br><br><h4>  Description of the first version of the algorithm </h4><br><br>  During the study, two algorithms were worked out.  The first algorithm was simpler and consisted of the following steps: <br><ul><li>  obtaining the current state of the playing field; </li><li>  attempt to fill each of the possible colors and count the number of filled cells; </li><li>  for the fill color is selected giving the largest fill area </li></ul><br><br>  With this algorithm, 100 games were played, of which he won at 28. The maximum number of points scored was 640 (two wins in a row). <br><br>  The problem with this algorithm was that it did not track the situation when one cell closes several adjacent cells of a different color, and in two moves you can paint a lot more. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c62/c61/465/c62c614657f2a8ca3efbc260c7bd4255.png" alt="The problem of the first algorithm"><br>  <i>Figure 2: the problem of the first algorithm.</i> <br><br>  In the figure you can see that if you first fill in with green, then you can access a large pink area.  If you paint in purple, then you can only get a red area of ‚Äã‚Äãtwo cells.  Similarly, you can reason for other colors. <br><br>  After testing the described algorithm, this problem was solved by analyzing a few steps ahead. <br><br><h4>  Description of the second version of the algorithm </h4><br><br>  A total of six colors in the game, you can paint over one of the five colors except the current color of the first cell.  Thus, for a simple search 4 steps ahead, you need to go through 5 ^ 4 = 625 options.  In fact, the algorithm gets 1296 (six to the fourth degree) combinations.  Each combination of colors is represented by one number, the order of filling is determined by the remainder of division by six. <br><ul><li>  1 is pink; </li><li>  2 - purple; </li><li>  3 - yellow; </li><li>  4 - red; </li><li>  5 - blue; </li><li>  6 - green. </li></ul><br><br>  After completing the fill with all four colors, the number of cells filled with the color of the first cell is counted.  Among these numbers the maximum is chosen: <br><br> <code>int[] fill_rate = new int[1296]; //        <br> int max_color; <br> int max_count; <br> <br> for (int i = 0; i &lt; 1296; i++) { <br> FloodLevel t = new FloodLevel(colors); <br> <br> t.fill(i / 1 % 6 + 1); //  1-  <br> t.fill(i / 6 % 6 + 1); //  <br> t.fill(i / 36 % 6 + 1); //  .. <br> t.fill(i / 216 % 6 + 1); <br> fill_rate[i] = t.count(); //    <br> } <br> <br> max_color = 0; <br> max_count = 0; <br> <br> for (int i = 0; i &lt; 1296; i++) <br> if (fill_rate[i] &gt; max_count) { <br> max_color = i; <br> max_count = fill_rate[i]; <br> } <br> <br> //    - max_color % 6 + 1 <br></code> <br><br>  The FloodLevel class is designed to simplify copying and filling and contains the following methods: <br><br> <code>public final class FloodLevel { <br> public FloodLevel(); <br> public FloodLevel(FloodLevel prototype); //   <br> <br> public void setColors(int[] new_colors); <br> public void setColor(int i, int j, int color); <br> public int getColor(int i, int j); <br> <br> public void fill(int color); //   <br> public int count(); //    <br> public boolean gameCompleted(); //     <br> } <br></code> <br><br>  The text of the methods can be viewed in the source code of the project, since the code is trivial and is a recursive algorithm for <a href="http://habrahabr.ru/blogs/image_processing/116374/">filling</a> images. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aac/923/d16/aac923d16cad5db7228611550b962077.png" alt="Achievement of the title SuperPixie"><br>  <i>Figure 3: Achievement of the title SuperPixie.</i> <br><br>  Testing the algorithm on 100 games showed such characteristics - 96 wins, the most scored 19680 points.  In the process of testing, the title SuperPixie was obtained.  I have stopped on this algorithm, since refactoring and optimization can be done indefinitely. <br><br><h4>  Obtaining level image </h4><br><br>  The level is a field consisting of multi-colored cells.  Each cell is shaded in monotonous color, which makes it very easy to get cell colors at the level of: <br><br> <code>FloodLevel colors = new FloodLevel(); <br> <br> for (int move = 0; move &lt; 25; move++) { <br> for (int j = 0; j &lt; 14; j++) <br> for (int i = 0; i &lt; 14; i++) { <br> int color = robot.getPixelColor(FIELD_X_OFFSET + 24 * i, FIELD_Y_OFFSET + 24 * j).getRGB() &amp; 0x00ffffff; <br> <br> switch (color) { <br> case 0x00ed70a1: //  <br> colors.setColor(i, j, 1); <br> break; <br> <br> case 0x00605ca8: //  <br> colors.setColor(i, j, 2); <br> break; <br> <br> case 0x00f3f61d: //  <br> colors.setColor(i, j, 3); <br> break; <br> <br> case 0x00dc4a20: //  <br> colors.setColor(i, j, 4); <br> break; <br> <br> case 0x0046b1e2: //  <br> colors.setColor(i, j, 5); <br> break; <br> <br> case 0x007e9d1e: //  <br> colors.setColor(i, j, 6); <br> break; <br> <br> default: //          <br> return; <br> } <br> } <br></code> <br><br>  Obtaining pixel values ‚Äã‚Äãfrom the screen is performed using the class Robot, then each received pixel is checked for compliance with a particular color in the game.  Since the cells of the playing field are monotonous, it can be argued that any color that does not belong to the listed colors means that there is no playing field in front of us. <br><br><h4>  Game control </h4><br><br>  A simple algorithm is also used to select a color, which moves the mouse to the position corresponding to one of the colors and clicks on the color. <br><br> <code>switch (max_color % 6 + 1) { <br> case 1: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 0, BUTTON_Y_OFFSET + 45 * 0); <br> break; <br> <br> case 2: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 1, BUTTON_Y_OFFSET + 45 * 0); <br> break; <br> <br> case 3: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 2, BUTTON_Y_OFFSET + 45 * 0); <br> break; <br> <br> case 4: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 0, BUTTON_Y_OFFSET + 45 * 1); <br> break; <br> <br> case 5: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 1, BUTTON_Y_OFFSET + 45 * 1); <br> break; <br> <br> case 6: <br> robot.mouseMove(BUTTON_X_OFFSET + 45 * 2, BUTTON_Y_OFFSET + 45 * 1); <br> break; <br> } <br> <br> robot.mousePress(InputEvent.BUTTON1_MASK); <br> robot.mouseRelease(InputEvent.BUTTON1_MASK); <br></code> <br><br>  After completing the action, you must wait for some time so that the game has time to react and update the playing field.  For this, a small delay is used. <br><br><h4>  Conclusion </h4><br><br><img src="http://img23.binimage.org/37/cf/45/challenge.png" alt="Maximum points earned by the program"><br>  <i>Figure 4: The maximum points earned by the program.</i> <br><br>  The program was written in one day - from Saturday evening to Sunday morning.  In this connection, I apologize for the anti-patterns, in particular Magic numbers.  Also, the program does not find the level automatically, offsets relative to the screen angle are hard-coded in the code (I use the Seamonkey browser under Gnome).  If the topic is interesting, I can finish the automatic search for the playing field. <br><br>  Source code can be downloaded: <br><br><ul><li>  from this <a href="http://narod.ru/disk/26225367001/flood_it_src.tar.gz.html">link</a> from the people; </li><li>  follow this <a href="https://github.com/SnakeSolid/floodit_worker">link</a> from github. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/129117/">https://habr.com/ru/post/129117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129106/index.html">Zoomify: Looking for the whole picture</a></li>
<li><a href="../129107/index.html">Django and Selenium Integration</a></li>
<li><a href="../129109/index.html">Dynamic applications with Ocsigen or Yob returns</a></li>
<li><a href="../129111/index.html">Daily Sales - aggregator of discount offers from Chinese online stores</a></li>
<li><a href="../129114/index.html">Cheap and fast usability testing</a></li>
<li><a href="../129118/index.html">Software spectrum analyzer on a conventional WiFi-card</a></li>
<li><a href="../129121/index.html">Report on meeting Apple Developers Community # 8</a></li>
<li><a href="../129122/index.html">Cacheops</a></li>
<li><a href="../129123/index.html">From London to Hong Kong in 176 milliseconds</a></li>
<li><a href="../129124/index.html">Mozilla offers to change the schedule of exit browsers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>