<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a repository server based on SCM-Manager under Debian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Faced with the fact that the repositories are scattered across different servers with different settings without the possibility of centralized manage...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a repository server based on SCM-Manager under Debian</h1><div class="post__text post__text-html js-mediator-article">  Faced with the fact that the repositories are scattered across different servers with different settings without the possibility of centralized management and monitoring.  The idea was to make one storage with the following requirements: <br><br><ul><li>  user authentication through Active Directory </li><li>  email push notifications </li><li>  management and creation of repositories, as well as access control through a web interface </li><li>  the possibility of placing mercurial, git, svn </li><li>  ease of deployment </li><li>  SSL support </li></ul><br>  Studying Google and test installations of various software led me to the SCM-manager, which allowed me to practically implement all the requirements set out of the box. <br><br>  The service was implemented on Debian 8.3 x64. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cat installation process and settings: <br><a name="habracut"></a><br><h4>  1. Installing Mercurial and SCM-Manager </h4><br>  Install Mercurial and add.  packages: <br><br><pre><code class="bash hljs">sudo apt-get install mercurial ca-certificates default-jre</code> </pre> <br>  Go to the directory where we will install the SCM-Manager: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ...</code> </pre><br>  Download the latest version from the <a href="https://www.scm-manager.org/download/">official site</a> : <br><br><pre> <code class="bash hljs">sudo wget https://maven.scm-manager.org/nexus/content/repositories/releases/sonia/scm//scm-server/1.46/scm-server-1.46-app.tar.gz</code> </pre><br>  Unarchive it: <br><br><pre> <code class="bash hljs">sudo tar -xvf scm-server-1.46-app.tar.gz</code> </pre><br>  Delete the downloaded archive: <br><br><pre> <code class="bash hljs">sudo rm scm-server-1.46-app.tar.gz</code> </pre><br>  Run SCM-Manager: <br><br><pre> <code class="bash hljs">sudo /opt/scm-server/bin/scm-server start</code> </pre><br>  At this stage, the service is fully functional and ready to work in its basic configuration.  The web interface is available at: <a href="http://localhost/">localhost</a> : 8080.  Default administrator login and password: scmadmin.  But continue the setting. <br><br><h4>  2. We do autoload SCM-Manager </h4><br>  Create the /etc/init.d/scmserver file: <br><br><pre> <code class="bash hljs">sudo mcedit /etc/init.d/scmserver</code> </pre><br>  Enter the following into the created file: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ### BEGIN INIT INFO # Provides: sscmserver # Required-Start: # Required-Stop: # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: Seapine Surround SCM Server # Description: SCM Server init file ### END INIT INFO SCM_SERVER="&lt;b&gt;&lt;i&gt;*path_to_install_directory*&lt;/i&gt;&lt;/b&gt;/scm-server/bin/scm-server" start() { "$SCM_SERVER" start } stop() { "$SCM_SERVER" stop } case "$1" in start) start ;; stop) stop ;; restart) stop start ;; *) echo $"Usage: $0 {start|stop|restart}" exit 2 esac</span></span></code> </pre><br>  Let's correct the rights so that the file is executable: <br><br><pre> <code class="bash hljs">sudo chmod 755 /etc/init.d/scmserver</code> </pre><br>  Add to autoload: <br><br><pre> <code class="bash hljs">sudo update-rc.d scmserver defaults</code> </pre><br><h4>  3. Transfer service to another port </h4><br>  By default, the web interface is available via http on port 8080. To change, you need to do the following steps. <br><br>  Edit serrver-config.xml: <br><br><pre> <code class="bash hljs">sudo mcedit /***path_to_install_directory***/scm-server/conf/server-config.xml</code> </pre><br>  We are looking for a section: <br><br><pre> <code class="bash hljs">&lt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> name=<span class="hljs-string"><span class="hljs-string">"port"</span></span>&gt; &lt;systemproperty name=<span class="hljs-string"><span class="hljs-string">"jetty.port"</span></span> default=<span class="hljs-string"><span class="hljs-string">"&lt;b&gt;8080&lt;/b&gt;"</span></span>&gt; &lt;/systemproperty&gt;&lt;/<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>&gt;</code> </pre><br>  We change to the one we need, save the file and overload the service: <br><br><pre> <code class="bash hljs">sudo /etc/init.d/scmserver restart</code> </pre><br><h4>  4. Add SSL </h4><br>  Go to the directory with the config: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /***path_to_install_directory***/scm-server/conf/</code> </pre><br>  We generate a certificate for 1 year: <br><br><pre> <code class="bash hljs">sudo keytool -genkey -<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> scm -validity 365 -keyalg RSA -keystore keystore.jks</code> </pre><br>  We edit the config: <br><br><pre> <code class="bash hljs">sudo mcedit /***path_to_install_directory***/scm-server/conf/server-config.xml</code> </pre><br>  Uncomment the SSL connector lines and specify the password (instead of * password *) for the key store, which we entered when creating it, the port on which it will listen for SSL ("Port"), and also specify the location of the key store: <br><br><pre> <code class="bash hljs">&lt;Call name=<span class="hljs-string"><span class="hljs-string">"addConnector"</span></span>&gt; &lt;Arg&gt; &lt;New class=<span class="hljs-string"><span class="hljs-string">"org.eclipse.jetty.server.ssl.SslSelectChannelConnector"</span></span>&gt; &lt;Arg&gt; &lt;!-- Exclude SSLv3 to avoid POODLE vulnerability. See https://groups.google.com/d/msg/scmmanager/sX_Ydy-wAPA/-Dvs5i7RHtQJ --&gt; &lt;New class=<span class="hljs-string"><span class="hljs-string">"org.eclipse.jetty.http.ssl.SslContextFactory"</span></span>&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"excludeProtocols"</span></span>&gt; &lt;Array <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"java.lang.String"</span></span>&gt; &lt;Item&gt;SSLv2Hello&lt;/Item&gt; &lt;Item&gt;SSLv3&lt;/Item&gt; &lt;/Array&gt; &lt;/Set&gt; &lt;/New&gt; &lt;/Arg&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"Port"</span></span>&gt;&lt;b&gt;443&lt;/b&gt;&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"maxIdleTime"</span></span>&gt;30000&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"keystore"</span></span>&gt;&lt;SystemProperty name=<span class="hljs-string"><span class="hljs-string">"basedir"</span></span> default=<span class="hljs-string"><span class="hljs-string">"."</span></span> /&gt;/conf/keystore.jks&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"password"</span></span>&gt;***password***&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"keyPassword"</span></span>&gt;&lt;b&gt;***password***&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"truststore"</span></span>&gt;&lt;SystemProperty name=<span class="hljs-string"><span class="hljs-string">"basedir"</span></span> default=<span class="hljs-string"><span class="hljs-string">"."</span></span> /&gt;/conf/keystore.jks&lt;/Set&gt; &lt;Set name=<span class="hljs-string"><span class="hljs-string">"trustPassword"</span></span>&gt;***password***&lt;/Set&gt; &lt;/New&gt; &lt;/Arg&gt; &lt;/Call&gt;</code> </pre><br>  Look fingerprints if needed: <br><br><pre> <code class="bash hljs">keytool -list -keystore keystore.jks</code> </pre><br>  In the process of setting up SSL, I encountered a problem that when pushing via ssl, the server obstinately swore at SSL and didn‚Äôt want to push, it turned out that in Python 2.7.9 and later versions included a default ban on self-signed certificates.  To disable this option, edit the file: <br><br><pre> <code class="bash hljs">sudo mcedit /usr/lib/python2.7/ssl.py</code> </pre><br>  Change <i>_create_default_https_context = create_default_context</i> to <i>_create_default_https_context = _create_unverified_context</i> . <br><br>  Overloading the service to apply changes: <br><br><pre> <code class="bash hljs">sudo /etc/init.d/scmserver restart</code> </pre><br>  This completes the configuration via the console and the configuration will continue through the web interface. <br><br><h4>  5. Configuring SCM-Manager via web-interface </h4><br>  Go to the web-interface <a href="http://localhost/">localhost</a> : 8080.  Remove anonymous access and change the password to the built-in administrator.  In the web interface, go to ‚ÄúSecurity‚Äù - ‚ÄúUsers‚Äù -&gt; delete the user ‚Äúanonymous‚Äù -&gt; change the password of the user ‚Äúscmadmin‚Äù. <br><br>  Installing plugins for authorization via AD, sending mail, sending notifications about pushing.  In the web-interface, go to ‚ÄúConfig‚Äù - ‚ÄúPlugins‚Äù: <br><br>  To authorize via AD, install: ‚Äúscm-auth-ldap-plugin‚Äù <br>  To send mail, install: ‚Äúscm-mail-plugin‚Äù <br>  For push notifications, install: ‚Äúscm-notify-plugin‚Äù <br><br>  Installing the plugin to view the activity in the repositories via the web interface: <br><br>  In the web-interface, go to "Config" - "Plugins" <br>  Install the plugin: ‚Äúscm-activity-plugin‚Äù <br><br>  To complete the installation of plugins, restart the service: <br><br><pre> <code class="bash hljs">sudo /etc/init.d/scmserver restart</code> </pre><br>  Configuration of the LDAP Authentication plugin.  In the web-based interface, go to ‚ÄúConfig‚Äù - ‚ÄúGeneral‚Äù - Section ‚ÄúLDAP Authentication‚Äù. <br><br>  <b>Profile:</b> "ActiveDirectory" <br>  <b>Base DN:</b> let the OU with users for authorization <br>  <b>Connection DN:</b> user to authorize SCM-Manager in AD <br>  <b>Connection Password:</b> (User password for authorization of SCM-Manager in AD) <br>  <b>Host URL:</b> ip and port of the domain controller <br>  <b>Enable nester ad groups:</b> no <br>  <b>Use StartTLS:</b> no (Enable / disable encryption when connecting to AD) <br>  <b>Enable:</b> yes (Enable / Disable Plugin) <br><br>  After making the settings, press the ‚ÄúSave‚Äù button to save them.  After making the settings, you can test the settings with the ‚ÄúTest Connection‚Äù button.  Now any domain user from the specified OU can login.  But at the same time, it has no rights anywhere by default and it will not be able to see any repository.  It is necessary for the administrator to give user access by adding him to the acces-list repository or to the group of which access is given to the necessary repositories. <br><br>  Configuring the plug-in for sending mail: in the web-interface, go to "Config" - "General" - Section "Mail configuration". <br><br>  Set the following parameters: <br><br>  <b>Host:</b> SMTP server address <br>  <b>Port:</b> SMTP server port <br>  <b>Username:</b> username for authorization on the SMTP server <br>  <b>Password:</b> user password for authorization on the SMTP server <br>  <b>From:</b> who the letter will emanate from <br>  <b>Transport Strategy:</b> SMTP_PLAIN (Passing an open type password) <br>  <b>Subject Prefix:</b> (which will be inserted at the beginning of the subject line) <br><br>  You can test the settings you have made with the "Test Configuration" button. <br><br>  Change the location of repositories on the server: in the web-interface, go to ‚ÄúConfig‚Äù - ‚ÄúRepository Types‚Äù. <br><br>  In the sections for SVN, Mercurial, Git write your way in the lines of the ‚ÄúRepository directory‚Äù. <br><br>  Creating repositories: in the web-interface, go to ‚ÄúMain‚Äù - ‚ÄúRepositories‚Äù, click ‚ÄúAdd‚Äù.  In the field ‚ÄúName‚Äù indicate the name of the repository, in the field ‚ÄúType‚Äù select the type of the repository. <br><br>  Configuring email push notifications for repositories: go to ‚ÄúMain‚Äù - ‚ÄúRepositories‚Äù in the web-based interface, select the repository where you need to set up email push notifications, bookmarks will appear from below, go to the ‚ÄúNotification‚Äù tab and complete: <br><br>  <b>Notify Repository Contact:</b> no <br>  <b>Use Author as From Address</b> : no <br>  <b>Email per Push:</b> no <br>  <b>Maximum Diff Lines:</b> 1000 (maximum number of lines in the letter in which changes made to the repository files will be shown) <br><br>  Add a mailing address to which notifications will come by clicking on the ‚ÄúAdd‚Äù button.  Save the changes by clicking the ‚ÄúOk‚Äù button. <br><br>  This completes the server configuration setting according to the specified conditions, and the service is ready for use.  SCM-Server allows you to import repositories with one limitation - it does not know how to import repositories from places where authorization is needed. </div><p>Source: <a href="https://habr.com/ru/post/279505/">https://habr.com/ru/post/279505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279495/index.html">Prototypes as a product presentiment</a></li>
<li><a href="../279497/index.html">Pwn2Own 2016: first results</a></li>
<li><a href="../279499/index.html">My bike or how I saved my nerve cells</a></li>
<li><a href="../279501/index.html">Multi-exclusion or Want to share one interesting architectural trick</a></li>
<li><a href="../279503/index.html">Critical vulnerabilities of the BIND DNS server allow you to remotely disable it and conduct DoS attacks</a></li>
<li><a href="../279507/index.html">Entertaining analysis of one expression with square brackets</a></li>
<li><a href="../279509/index.html">Programmatic process lookup by name in QNX 6.5.0</a></li>
<li><a href="../279511/index.html">How to write an email to IT professionals: 5 tips</a></li>
<li><a href="../279513/index.html">Quick start a new application on React using nwb</a></li>
<li><a href="../279515/index.html">Use highcharts.js to create server side charts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>