<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>7 ways to display video from an RTSP IP camera on a webpage and 2 in a mobile application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will show 7 technologically different ways of displaying a video stream from an IP camera with RTSP support on a web page of a brow...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>7 ways to display video from an RTSP IP camera on a webpage and 2 in a mobile application</h1><div class="post__text post__text-html js-mediator-article">  In this article we will show 7 technologically different ways of displaying a video stream from an IP camera with RTSP support on a web page of a browser. <br><br>  Browsers, as a rule, do not support RTSP, so the stream will be converted to a browser via an intermediate server. <a name="habracut"></a><br><br><h2>  Method 1 - RTMP </h2><br>  Browsers do not support RTMP protocol, but it is supported by the good old Flash Player, which works well, although not in all browsers, and can display a video stream. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/web/a16/284/989/a162849891ca43bfab441ce363634e00.jpg"></div><br>  The player code in this case will be built on Action Script 3 and look something like this: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nc:NetConnection = nc.connect(<span class="hljs-string"><span class="hljs-string">"rtmp://192.168.88.59/live"</span></span>,obj); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> subscribeStream:NetStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetStream(nc); subscribeStream.play(<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>);</code> </pre> <br>  In this example: <br><br>  rtmp: //192.168.88.59/live is the address of the intermediate server that will take the RTSP video stream from the camera and convert it to RTMP <br><br>  rtsp: //192.168.88.5/live.sdp is the RTSP address of the camera itself. <br><br>  A slightly redundant version of the player code on Flex and AS3 is available <a href="">here</a> . <br><br>  It looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9d7/efa/04e/9d7efa04e75d46c0a29e6221f800d4f7.jpg"></div><br><h2>  Method 2 - RTMP wrapped with HTML5 </h2><br>  Those wishing to code on Action Script 3 are less.  Especially for this invented a way to HTML5 wrapper, which allows you to manage RTMP-player from JavaScript.  In this case, the flash drive is loaded on the HTML-page only to display the picture and give the sound to the speakers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/405/5fe/d25/4055fed25d2949eba0bc6d4c985b7ab1.jpg"></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>:<span class="hljs-string"><span class="hljs-string">"wss://192.168.88.59:8443"</span></span>}); session.createStream({<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">display</span></span>:myVideo}).play();</code> </pre><br>  The full player code is <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/player">here</a> .  And it looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/b74/c7e/e76/b74c7ee7620b4ae095ae8f8cf9b3a684.png"></div><br><h2>  Method 3 - RTMFP </h2><br>  The RTMFP protocol also works inside the flash player.  The difference with RTMP is that RTMFP works on top of the UDP protocol and is thus more suitable for receiving low latency broadcasts. <br><br>  The player code on AS3 in this case is completely identical to that used in RTMP, one letter F has been added to the server connection protocol line. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nc:NetConnection = nc.connect(<span class="hljs-string"><span class="hljs-string">"rtmfp://192.168.88.59/live"</span></span>,obj); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> subscribeStream:NetStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetStream(nc); subscribeStream.play(<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>);</code> </pre><br>  For the order, we will give a screenshot with RTMFP <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/c7e/747/c0e/c7e747c0e6df489e88639016fffe0f9d.png"></div><br><h2>  Method 4 - RTMFP with HTML5 wrapper </h2><br>  This method is identical to step 2, with the difference that we, when initializing in JavaScript, install the RTMFP protocol for use in the underlying flash drive (swf object). <br><br><pre> <code class="javascript hljs">Var session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>:<span class="hljs-string"><span class="hljs-string">"wss://192.168.88.59:8443"</span></span>, <span class="hljs-attr"><span class="hljs-attr">flashProto</span></span>:<span class="hljs-string"><span class="hljs-string">"rtmfp"</span></span>}); session.createStream({<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">display</span></span>:myVideo}).play();</code> </pre><br>  Player picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/a16/006/0b5/a160060b556b49f2bf99a89820ec0486.png"></div><br><h2>  Method 5 - WebRTC </h2><br>  In this case, Flash is not used at all and the video stream is played by the means of the browser itself, without using third-party plug-ins.  This also works in Android Chrome and Android Firefox ‚Äî mobile browsers where Flash is not installed.  WebRTC gives the lowest latency - less than 0.5 seconds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/cc1/82f/71f/cc182f71fa684da3a4ca52e1f8b37155.jpg"></div><br>  Player code is the same: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>:<span class="hljs-string"><span class="hljs-string">"wss://192.168.88.59:8443"</span></span>}); session.createStream({<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">display</span></span>:myVideo}).play();</code> </pre><br>  WebRTC support is automatically detected, and if supported, the stream plays via WebRTC. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/ba2/04f/998/ba204f998f744e8aa04bc9ba67c3a1af.png"></div><br><h2>  Method 6 - Websockets </h2><br>  WebRTC and Flash do not cover all browsers and platforms.  For example, these technologies are not supported in the iOS Safari browser. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e91/ca0/6b6/e91ca06b641b48949b772c2772684bba.jpg"></div><br>  On iOS Safari, you can deliver a video stream over a Websocket transport (a TCP connection between a browser and a server).  You can wrap the video stream converted from RTSP into this tunnel.  After the binary data comes, you can decode it with JavaScript and draw it on the Canvas HTML5 element. <br><br>  This is exactly what Websocket does - the player when working in the iOS Safari browser, and its code from the outside also looks like: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>:<span class="hljs-string"><span class="hljs-string">"wss://192.168.88.59:8443"</span></span>}); session.createStream({<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>, <span class="hljs-attr"><span class="hljs-attr">display</span></span>:myVideo}).play();</code> </pre><br>  This is somewhat similar to the approach with a flash drive, when under HTML5 there is a swf element.  In this case, under the HTML5 page, it is not a swf object, but a JavaScript application that pulls data on the web socket, decodes and draws on the Canvas in several streams. <br><br>  This is the RTSP stream on Canvas in the iOS Safari browser. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/2ef/dfb/110/2efdfb1104e04f5bb55ed5b1419c7f43.png"></div><br><h2>  Method 7 - HLS </h2><br>  When converting RTSP to HLS, the video stream is divided into segments, which are safely downloaded from the server and displayed in the HLS player. <br><br><img src="https://habrastorage.org/web/33a/f95/38b/33af9538ba104c98895ea0e38a6df7c2.jpg"><br>  We use video.js as an HLS player.  Player code can be downloaded <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/hls-player">here</a> . <br><br>  How does the player look like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/66c/894/5a2/66c8945a225e4e5383c950727e328f3b.png"></div><br><h2>  Method 8 - Android Application, WebRTC </h2><br>  The application retrieves the stream from the server via WebRTC.  The server task in this case is to convert the RTSP to WebRTC and feed it to the mobile application. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/bc2/d70/462/bc2d704625234c1cb43bfd2f56792601.jpg"></div><br>  The Java code for the Android player is <a href="">here</a> and looks like this: <br><br><pre> <code class="java hljs">SessionOptions sessionOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SessionOptions(<span class="hljs-string"><span class="hljs-string">"wss://192.168.88.59:8443"</span></span>); Session session = Flashphoner.createSession(sessionOptions); StreamOptions streamOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamOptions(<span class="hljs-string"><span class="hljs-string">"rtsp://192.168.88.5/live.sdp"</span></span>); Stream playStream = session.createStream(streamOptions); playStream.play();</code> </pre><br>  You can install the test mobile player application from <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.flashphoner.wcsexample.player">Google Play</a> , and download the source code <a href="https://github.com/flashphoner/wcs-android-sdk-samples/tree/master/player">here</a> . <br><br>  This is how the RTSP stream over WebRTC looks on an Asus tablet for Android: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/24c/97c/ca5/24c97cca5be54ba581f130c8bd1c753d.jpg"></div><br><h2>  Method 9 - iOS application, WebRTC </h2><br>  The application also, as in the case of Android, takes the stream from the server via WebRTC. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/48b/775/e1c/48b775e1c0d6400595fc2214f2da9cf2.jpg"></div><br>  <a href="">Objective-C player code</a> looks like this: <br><br><pre> <code class="hljs pgsql">FPWCSApi2SessionOptions *<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = [[FPWCSApi2SessionOptions alloc] init]; <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.urlServer = @"wss://192.168.88.59:8443"; FPWCSApi2Session *<span class="hljs-keyword"><span class="hljs-keyword">session</span></span> = [FPWCSApi2 createSession:<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> error:&amp;error]; FPWCSApi2StreamOptions *<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = [[FPWCSApi2StreamOptions alloc] init]; <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.name = @"rtsp://192.168.88.5/live.sdp"; FPWCSApi2Stream *stream = [<span class="hljs-keyword"><span class="hljs-keyword">session</span></span> createStream:<span class="hljs-keyword"><span class="hljs-keyword">options</span></span> error:nil]; stream play:&amp;error;</code> </pre><br>  Download the source code of the player for iOS <a href="https://github.com/flashphoner/wcs-ios-sdk-samples/tree/master/WCSExample/Player">here</a> . <br><br>  And from the App Store, you can <a href="">install a test application</a> that uses the pieces of code shown above.  His work with the RTSP stream looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/cd0/e40/1a8/cd0e401a8af34f9dad45105982dbab22.png"></div><br><br><h2>  results </h2><br>  Let's summarize and combine the results obtained in the table: <br><table><tbody><tr><td></td><td align="center">  Display method </td><td align="center">  Application </td><td align="center">  Delay </td></tr><tr><td>  one </td><td>  RTMP </td><td>  Where legacy is important - flash client, Flex or Adobe Air </td><td>  medium </td></tr><tr><td>  2 </td><td>  RTMP + HTML5 </td><td>  In IE, Edge, Mac Safari browsers, if Flash Player is installed there </td><td>  medium </td></tr><tr><td>  3 </td><td>  RTMFP </td><td>  Where legacy is important - flash client, Flex or Adobe Air and low latency is important. </td><td>  low </td></tr><tr><td>  four </td><td>  RTMFP + HTML5 </td><td>  In IE, Edge, Mac Safari browsers, if the Flash Player is installed there and low latency is important. </td><td>  low </td></tr><tr><td>  five </td><td>  Webrtc </td><td>  In Chrome, Firefox, Opera browsers on desktops and Android mobile browsers, where real-time latency is important. </td><td>  real-time </td></tr><tr><td>  6 </td><td>  Websocket </td><td>  In browsers where there is no Flash and WebRTC, but need a medium or low latency. </td><td>  medium </td></tr><tr><td>  7 </td><td>  Hls </td><td>  In all browsers.  Where the delay is not important. </td><td>  high </td></tr><tr><td>  eight </td><td>  Android app, WebRTC </td><td>  In native Android applications where real-time delay is required. </td><td>  real-time </td></tr><tr><td>  9 </td><td>  iOS app, WebRTC </td><td>  In native mobile applications for iOS, where real-time delay is required. </td><td>  real-time </td></tr></tbody></table><br>  For testing, we used the Web Call Server 5 server, which converts the RTSP stream for distribution in the 9 directions listed. <br><br><h2>  Links </h2><br>  <a href="https://flashphoner.com/">Web Call Server 5</a> - server for distributing RTSP stream <br>  <a href="https://wcs5-eu.flashphoner.com/demo2/flash-streaming">Flash Streaming</a> is an example of a swf application that plays RTMP and RTMFP streams.  Ways 1 and 3. <br>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/flash_client/streaming">Source</a> - the source code of the swf application on Flex / AS3. <br><br>  <a href="https://wcs5-eu.flashphoner.com/demo2/player">Player</a> is an example of a web application that plays an RTSP stream over RTMP, RTMFP, WebRTC, Websocket.  Ways 2,4,5,6. <br>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/player">Source</a> - the source code of the web player. <br><br>  <a href="https://wcs5-eu.flashphoner.com/demo2/hls-player">HLS player</a> is an example of a web player that plays HLS.  Method 7. <br>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/hls-player">Source</a> - the source code of the HLS player. <br><br>  <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.flashphoner.wcsexample.player">The Android WebRTC player</a> is an example of a mobile application that plays a stream on WebRTC.  Method 8. <br>  <a href="https://github.com/flashphoner/wcs-android-sdk-samples/tree/master/player">Source</a> - the source code of the mobile application. <br><br>  <a href="">The WebRTC iOS player</a> is an example of a mobile application that plays the WebRTC stream.  Method 9. <br>  <a href="https://github.com/flashphoner/wcs-ios-sdk-samples/tree/master/WCSExample/Player">Source</a> - the source code of the mobile application. </div><p>Source: <a href="https://habr.com/ru/post/329108/">https://habr.com/ru/post/329108/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329096/index.html">Who needs these SMS?</a></li>
<li><a href="../329098/index.html">Security Week 20: Fake WannaCry, HP has keylogger on firewood, Chrome downloads extra</a></li>
<li><a href="../329100/index.html">EVPN Multihoming</a></li>
<li><a href="../329102/index.html">.NET Core: version numbers and global.json</a></li>
<li><a href="../329106/index.html">Fluent Design (not) shifting paradigms</a></li>
<li><a href="../329110/index.html">Terminology. Fight against complexity</a></li>
<li><a href="../329118/index.html">3CX technical support responds: how to get the credentials of the 3CX user portal and how to change the FQDN of the PBX server</a></li>
<li><a href="../329120/index.html">[Java Archeology] Context-dependent inlayning of traces in Java</a></li>
<li><a href="../329122/index.html">How to build a voice bot: speech recognition, speech synthesis and NLP in a few lines of code</a></li>
<li><a href="../329124/index.html">New life utility</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>