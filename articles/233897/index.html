<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docsvision database structure. From developer to developer!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Docsvision is not just a program, it is a platform that allows you to create your own solutions for electronic document management. The article of our...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docsvision database structure. From developer to developer!</h1><div class="post__text post__text-html js-mediator-article">  Docsvision is not just a program, it is a platform that allows you to create your own solutions for electronic document management.  The article of our colleague, Docsvision developer Dima Leikin, is intended specifically for developers of such solutions, to which we include partners of our company and employees of IT departments of our customer companies. <br><br>  The material is divided into 5 logical parts - basic information about how the system is Docsvision.  In addition, for developers who want to get us a job, this knowledge will be an additional plus. <br><br><img src="https://habrastorage.org/files/295/1bb/9d1/2951bb9d1d764cbaad9599ddac4407c5.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  In general, Docsvision is a client-server system, and the development of its solution comes down to the development of a set of cards (that is, a library). <br><br>  <b>The card</b> is a basic concept in the Docsvision system.  From the client‚Äôs point of view, the card is the UI that it sees when working with a document or task.  From the point of view of the client programmer, a card is an object model that allows you to save information to a server.  From the point of view of the server programmer, a card is a set of tables and stored procedures for accessing them.  From the point of view of the card developer, a card is, above all, metadata.  These metadata generate tables and stored procedures of the card, they contain attributes responsible for security, the way the card data is loaded onto the client, and many others. <br><br>  <b>Directory</b> is another important concept.  Directory is a card that exists in a single copy.  For example, a staff directory, a directory of saved searches, a directory of roles, etc. <br>  With the system itself comes several already written library cards.  These are the Platform, ManagedPlatform, Takeoffice, Workflow, Backoffice libraries. <br>  The first series of articles devoted to the basis of the system - the database Docsvision.  Of course, this is not a complete description.  Basically, the information is devoted to the principles of the system, so many details had to be sacrificed for the sake of simplicity. <br><br><h4>  <b>Part 1. Sectional tables</b> </h4><br>  When developing your library of cards using the CardManager utility, xml files are created with descriptions of the metadata for the cards.  Then, using this metadata, tables and stored procedures are generated in the database, which allow working with these cards.  Metadata is essentially a description of the type of card. <br><br><h5>  <b>Briefly about metadata</b> </h5><br>  In terms of metadata, a card is a set of sections.  Section can be imagined as a table in the database, so it will be clearer.  A section is a collection of fields.  A field can be imagined as a column of this table.  Section can be collectible, wooden or type struct.  A section can have child sections; I write about this in more detail below. <br><br>  Each card has a unique identifier - a card type identifier.  Similarly, sections and fields have unique identifiers.  Section identifiers are very important because at the moment the names of the partitioned tables are generated as follows: [dbo]. [Dvtable_ {id}], where id is the identifier of the section. <br><br>  Beginners are often confused with types and instances.  For example, in the table [dbo]. [Dvsys_instances], where information about the card instances is stored, in the field InstanceID (card instance identifier) ‚Äã‚Äãthey start looking for the card type identifier for the document card.  And they are very surprised when they do not find him there.  (It should be noted here that in recent versions of Docsvision for directories, the identifier of the card is equal to the identifier of the type). <br><br><h5>  <b>Section in terms of storing information in the database</b> </h5><br>  From the point of view of information storage, a section is a DB table.  The section field in the database corresponds to the column of the table.  In addition to the columns for the fields, in each "sectional" table there are so-called system columns (RowID, InstanceID, ParentRowID, ParentTreeRowID, etc.) <br><br>  <b>InstanceID and RowID columns</b> <br>  <i>RowID</i> - unique identifier (Guid) of the section table table (primary key). <br>  <i>InstanceID</i> - identifier (Guid) of the instance of the card to which this line belongs.  Corresponds to the ID of the card from the table [dbo]. [Dvsys_instances]. <br><br>  You can imagine a sectional table as follows: <br><table><tbody><tr><td>  InstanceID </td><td>  Rowid </td><td>  ... </td></tr><tr><td>  CardId1 </td><td>  RowId1 </td><td>  ... </td></tr><tr><td>  CardId1 </td><td>  Rowowd2 </td><td>  ... </td></tr><tr><td>  CardId2 </td><td>  Rowowd3 </td><td>  ... </td></tr><tr><td>  CardId2 </td><td>  Rowowd4 </td><td>  ... </td></tr></tbody></table><br>  The same table stores information about the section lines for all copies of cards of this type. <br><br>  <b>Representation of sections of different types in the database</b> <br>  Section can be collectible, wooden and type struct.  The name of the sections originated, apparently, from the data structures for which these types of sections are intended to be stored. <br><br>  <b>Collection sections</b> <br>  The collection section is designed to store a collection of objects.  From the point of view of the database, this means that among the rows of a sectional table there may be rows with the same InstanceID. <br><br>  <b>Sections like struct</b> <br>  A struct section is intended to hold a data structure.  In essence, this is the same collection section, but only a collection can have a maximum of one object.  From the point of view of the database, this means that in a sectional table there cannot be two rows with the same InstanceID.  The columns of the sectional table correspond to the structure fields. <br><br>  <b>Wooden sections</b> <br>  The wooden section is designed for storing trees.  Trees are stored as follows: there is a system column ParentTreeRowID, in which for each line is recorded the identifier of the parent line in the tree, or Guid.Empty, if there is no parent line.  In the wooden section you can store several trees for one copy of the card, there is no restriction here. <br>  When deleting a line in the tree, all its child lines will be deleted, this is provided by the stored procedures for deleting lines. <br><br>  <b>Child sections</b> <br>  Wood sections allow you to store a collection of children of the same type for an object.  But what if we want to store a collection of child objects of another type?  For this are child sections.  The ‚Äúclassic‚Äù example of the parent and child sections is the sections of divisions and employees in the employee reference book.  Each unit is associated with a collection of employees.  In the database, it looks like this: in the section table for employees in the system column ParentRowID (not to be confused with ParentTreeRowID) the identifier of the parent unit is indicated. <br><table><tbody><tr><td>  Rowid </td><td></td></tr><tr><td>  CompanyID1 </td><td></td></tr><tr><td>  CompanyID2 </td><td></td></tr></tbody></table><br><table><tbody><tr><td>  Rowid </td><td>  ParentRowID </td></tr><tr><td>  EmployeeID1 </td><td>  CompanyID1 </td></tr><tr><td>  EmployeeID2 </td><td>  CompanyID1 </td></tr></tbody></table><br>  For a sectional table of a child section, a foreign key is generated on the parent table (with the ParentRowID child on the RowID of the parent table) with cascade deletion.  That is, for example, when deleting a unit, all its employees will be deleted. <br><br><h5>  <b>Practical work</b> </h5><br>  How can this knowledge be used in practice?  Suppose we have a Docsvision database, and we want to see which employees are registered in the employee reference book.  First we need to know the ID of the employees section of the employee directory.  The easiest way, of course, is to look in CardManager or in xml, but if they are not at hand, it does not matter: <br><br>  Find the identifier of the directory of employees: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[dvsys_carddefs] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Alias</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%Staff%'</span></span></code> </pre> <br>  We get a list of its sections: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[dvsys_sectiondefs] <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> CardTypeID = <span class="hljs-string"><span class="hljs-string">'6710B92A-E148-4363-8A6F-1AA0EB18936C'</span></span></code> </pre><br>  We see in the SectionTypeID field for the section with the Employees alias, the employee section identifier 'DBC8AE9D-C1D2-4D5E-978B-339D22B32482'.  We make a request from the sectional table of employees: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[dvtable_{DBC8AE9D-C1D2<span class="hljs-number"><span class="hljs-number">-4</span></span>D5E<span class="hljs-number"><span class="hljs-number">-978</span></span>B<span class="hljs-number"><span class="hljs-number">-339</span></span>D22B32482}]</code> </pre><br>  The list of employees is in front of us.  Now let's say we want to see what kind of employees there are in the unit called Test.  Similarly, we find out the identifier of the division section and write: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> Emp.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dvtable_{DBC8AE9D-C1D2<span class="hljs-number"><span class="hljs-number">-4</span></span>D5E<span class="hljs-number"><span class="hljs-number">-978</span></span>B<span class="hljs-number"><span class="hljs-number">-339</span></span>D22B32482}] Emp <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> [dvtable_{<span class="hljs-number"><span class="hljs-number">7473</span></span>F07F<span class="hljs-number"><span class="hljs-number">-11</span></span>ED<span class="hljs-number"><span class="hljs-number">-4762</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>F1E<span class="hljs-number"><span class="hljs-number">-7</span></span>FF10808DDD1}] Company <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Emp.ParentRowID = Company.RowID <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> Company.Name = <span class="hljs-string"><span class="hljs-string">'Test'</span></span></code> </pre><br>  Here we used the fact that the staff section is a subsidiary of the division section.  Now we will try to derive the Test subdivision and all its subsidiaries (in the tree): <br><pre> <code class="sql hljs">;<span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> Companies (<span class="hljs-keyword"><span class="hljs-keyword">RowID</span></span>, ParentTreeRowID, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Company.RowID, Company.ParentTreeRowID, Company.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dvtable_{<span class="hljs-number"><span class="hljs-number">7473</span></span>F07F<span class="hljs-number"><span class="hljs-number">-11</span></span>ED<span class="hljs-number"><span class="hljs-number">-4762</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>F1E<span class="hljs-number"><span class="hljs-number">-7</span></span>FF10808DDD1}] Company <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Company.Name = <span class="hljs-string"><span class="hljs-string">'Test'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Company.RowID, Company.ParentTreeRowID, Company.Name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dvtable_{<span class="hljs-number"><span class="hljs-number">7473</span></span>F07F<span class="hljs-number"><span class="hljs-number">-11</span></span>ED<span class="hljs-number"><span class="hljs-number">-4762</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>F1E<span class="hljs-number"><span class="hljs-number">-7</span></span>FF10808DDD1}] Company <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Companies <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Company.ParentTreeRowID = Companies.RowID ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RowID</span></span>, ParentTreeRowID, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Companies</code> </pre><br>  Here we used the fact that the divisions section is a wooden section. <br><br><h4>  <b>Part 2. A little more about the metadata</b> </h4><br>  Xml with card metadata is an xml file with the Platform Library VersionedFile card metadata: <br><br><img src="https://habrastorage.org/files/8a3/a6a/b12/8a3a6ab124204d88acbc681fb65b42b1.png" alt="image"><br><br>  <b>Metadata</b> is essentially a type definition for card instances.  Very often, the card is called both metadata and copies of cards in the database, which is somewhat confusing.  When we talk about metadata, a card will always mean a card type, a card identifier - a card type identifier, etc. <br>  The metadata specifies the name and ID of the card, its attributes, and the section tree.  For each section, the name and identifier of the section, its attributes and fields are specified.  For each field, the name and identifier of the field are given, as well as its type. <br>  Among the attributes of the card is, first of all, note the attribute responsible for whether the card is a reference.  Among the attributes of a section, the most important attribute is the type of section (collection, wood, or type of struct). <br>  Child sections are defined in the xml file as follows.  The element has a child element where elements for the child sections are specified.  The child section, in turn, may also have child sections.  Thus, the tree of sections turns out. <br><br><h5>  <b>CardManager utility</b> </h5><br>  To work with metadata in Docsvision, the CardManager developer utility is used.  The utility allows you to automate the creation and editing of card metadata. <br><br><img src="https://habrastorage.org/files/bfa/075/9a9/bfa0759a9cd6488eaae228bc66b75cea.png" alt="image"><br>  <i>The screenshot is the CardManager utility with the Backoffice library open.</i> <br><br><img src="https://habrastorage.org/files/2ba/f2b/599/2baf2b59927347f985e8bd002c9f720a.png"><br>  <i>On the screenshot - Backoffice library staff metadata.</i>  <i>Open the wooden section AlternativeHierarchy, designed to store user groups.</i>  <i>It shows the child sections of Group and GrpViewFields, as well as the Name, Comments, AccountName and other fields.</i> <br><br><h4>  <b>Part 3. Links</b> </h4><br><img src="https://habrastorage.org/files/9f8/80a/86f/9f880a86f8744ab581b762468159d436.png"><br><br>  Fields can be of different types, including links to lines (refid) and links to copies of cards (refcardid). <br><table><tbody><tr><td>  Rowid </td><td>  MyReference </td></tr><tr><td>  Rowid </td><td>  Id1 </td></tr></tbody></table><br><table><tbody><tr><td>  Rowid </td><td>  ... </td></tr><tr><td>  Id1 </td><td>  ... </td></tr></tbody></table><br>  In the case of a link to a row in the table cell, the identifier of the row to which this string refers is entered.  But in which table to search for a row by this identifier?  This is determined by the metadata of the field that is intended to store the reference (in the case in the figure, by the metadata of the MyReference field). <br>  When storing a link to a card in a table cell, the instance ID of the InstanceID card from the table [dbo]. [Dvsys_instances] is written.  The metadata indicates which type of card the link is stored. <br><table><tbody><tr><td>  Rowid </td><td>  MyCardReference </td></tr><tr><td>  Rowid </td><td>  Id1 </td></tr></tbody></table><br><table><tbody><tr><td>  InstanceID </td><td>  CardTypeID </td><td>  ... </td></tr><tr><td>  Id1 </td><td>  Type id </td><td>  ... </td></tr></tbody></table><br><h5>  <b>Link Types Hard, Weak, Auto</b> </h5><br>  The link to the card can be of type Hard, Weak, Auto. <br>  <i>Hard</i> , or hard link, means the following: when the last hard link to the card is deleted, the card will be deleted. <br>  <i>Weak</i> , or weak link, does not affect the removal of the card. <br>  <i>Auto</i> - the automatic link also does not affect the removal of the card, but when the card is removed, the link itself will be reset. <br><br><h5>  <b>Table [dbo]. [Dvsys_links]</b> </h5><br>  For storing links, the table [dbo]. [Dvsys_links] is used.  In this table, the link information is scattered across different sectional tables.  Rasynchronization cannot happen here, since adding / deleting records to the table provides the same stored procedures that work with sectional fields. <br><br>  The table has the following useful columns: <br><ul><li>  RowID - a line which refers </li><li>  FieldID - type identifier of the field used to store the reference value. </li><li>  SourceCardID - ID of the instance of the card that refers </li><li>  DestinationTypeID - ID of the instance of the card to which we refer </li><li>  Type - link type </li></ul><br><h5>  <b>What are links for?</b> </h5><br>  Links make the card a reuse component.  For example, if you want a card created by you to contain a collection of files that support versioning, then it is enough to make a field with a link to the FileList card of the Backoffice system library. <br><br><h4>  <b>Part 4. System tables and libraries</b> </h4><br><h5>  <b>Basic system tables</b> </h5><br>  [dbo]. [dvsys_globalinfo] - the table contains information about the version of the Docsvision database.  This table has a useful Version field containing the current version of the database. <br>  Sometimes it is required to update versions for all libraries to match the version of the database, and I don‚Äôt feel like immersing new versions of libraries into the database.  To do this, there is the following method: see the version in [dbo]. [Dvsys_globalinfo] and then call the stored procedure: <br><pre> <code class="sql hljs">exec [dbo].[dvsys_help_set_version] @Version =  </code> </pre><br>  Metadata tables: <br><ul><li>  [dbo]. [dvsys_libraries] - information about installed libraries of cards </li><li>  [dbo]. [dvsys_carddefs] - information about the installed cards </li><li>  [dbo]. [dvsys_sectiondefs] - section information </li><li>  [dbo]. [dvsys_fielddefs] - information about the fields </li></ul><br>  Other important tables <br><ul><li>  [dbo]. [dvsys_instances] card instance table </li><li>  [dbo]. [dvsys_links] link table </li><li>  [dbo]. [dvsys_locks] lock table </li><li>  [dbo]. [dvsys_security] security </li><li>  [dbo]. [dvsys_crypto] crypto objects </li><li>  [dbo]. [dvsys_log], [dbo]. [dvsys_log_application], [dbo]. [dvsys_log_security] log tables </li></ul><br>  Two tables are important for storing files: <br><ul><li>  [dbo] .dvsys_files </li><li>  [dbo] .dvsys_binaries </li></ul><br>  The dvsys_files table stores information about the file, and dvsys_binaries contains its contents. <br>  It is also important to mention that for card fields there is a fileId type.  This type of field will store the file ID from the dvsys_files table. <br><br><h5>  <b>Platform Library</b> </h5><br>  <b>Directory of folders</b> <br>  If you have ever opened Docsvision Navigator, then the first thing you saw was a folder and grid tree with a view of the cards contained in the folder.  In fact, the folder contains not the cards themselves, but the labels on them. <br><br>  Folder directory is the Platform library's FoldersCard directory, where information about folders is stored, as well as the folder labels on the cards.  Folders are stored in the wooden section Folders. <br><br>  Labels are stored in the child section of Shortcuts.  In this section there are HardCardID and CardID fields.  And that, and another field is a link to the card.  The only difference is that the HardCardID field is a hard link, and the CardID link is an Auto type.  Thus, labels for the same card can be located in different folders, and the card will be deleted when the last label with a hard link to it is deleted. <br><br>  Folders can be of the following types: normal folders, virtual folders, delegate folders and system folders.  Virtual folders are different in that they use a search query to return information about the labels contained in them.  Delegate folders are essentially pointers to other folders.  System folders are usually some special folders, such as the search results folder or the trash folder.  Many system folders are invisible to the user.  You can view the system folders as follows: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> [dbo].[dvtable_{FE27631D-EEEA<span class="hljs-number"><span class="hljs-number">-4E2</span></span>E-A04C-D4351282FB55}] Folders <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>] = <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-comment"><span class="hljs-comment">-- System</span></span></code> </pre><br>  <b>Version File Card</b> <br>  There is a VersionedFile card in the Platform library.  This card is useful when you need to store multiple versions of the same file.  The card has a wooden section of Versions, which allows you to store a tree of versions of the file.  In the Versions section there is a FileID field of type fileID, where the link to the file is stored.  In the MainInfo section there is a useful CurrentID field (of type refid) containing a link to a version that is considered to be current. <br><br>  <b>Numbering card</b> <br>  The numbering card is used to issue numbers to documents and other cards. <br><br>  <b>Card Saved Views</b> <br>  The card is used to store information about user views - those views that are shown by the Docsvision Navigator grid. <br><br>  <b>Card Saved Searches</b> <br>  The card is used to store information about user searches. <br><br><h5>  <b>Backoffice library</b> </h5><br>  <b>Species Reference</b> <br>  It so happened that the creators of the Backoffice library considered the division of cards into types insufficient, and decided within the library to specify the type of the card, adding a view to it.  Let's say there is a document, and there is an incoming document - this is a document type.  A species may have child species that inherit some of its features, and some have their own.  So it turned out tree species.  All these species are stored in the species directory. <br><br>  <b>Cards of the document, tasks, groups of tasks, coordination</b> <br>  These are the main work cards of the Docsvision system.  They correspond to the main entities of the workflow.  They provide a large number of different services and participate in different scenarios of work. <br><br>  <b>State Reference</b> <br>  The state directory stores the state machine for card states.  When moving from state to state, operations are performed. <br><br>  <b>Role directory</b> <br>  The role directory stores role-playing information.  In essence, this is a three-dimensional matrix of the role - state - available operations.  UI directory allows you to see the cross section of this three-dimensional matrix. <br><br>  <b>Markup Reference</b> <br>  In the markup directory, you can customize the appearance of the card, add controls to it, subscribe to their events, define dynamic fields, and associate them with controls. <br><br>  <b>Script reference</b> <br>  The scripts directory allows you to write your own scripts for the cards. <br><br>  <b>Employee Handbook</b> <br>  The employee reference book stores employees and departments, as well as groups and roles. <br><br>  <b>Counterparty Handbook</b> <br>  The counterparty directory stores organizations and employees - counterparties. <br><br><h4>  <b>Part 5. Search and Subsystem</b> </h4><br>  Search and submission is not much different from each other.  The main idea: using UI or using code to create a description of the search / presentation.  According to this description, the server will generate a stored procedure that will return a selection with the results.  Description of the search is stored in the directory of search queries, and views - in the directory of saved views.  The search / view must have an identifier so that when it is called again, an existing stored procedure is called, which affects performance. <br><br>  The view is what the user sees in the navigator grid.  First, there is a system view (digest), which is used by default.  Also, conventional views and views with paginated output of information (so-called keyset views) are distinguished.  Presentation as its data source can use a regular folder, or search results, or something else.  Search and views support parameters that are set at the time of the call, either by the user via the UI or programmatically.  Search parameters can be specified as parameters (Me, Today, My Deputies and many others).  Collectible options are allowed. <br><br>  The definition of search and representations is essentially a small language with the syntax of xml, and this language supports many different possibilities.  The system for generating stored procedures on the server is a translator from Xml to Sql. <br><br>  The search subsystem supports 2 types of search - <i>attribute</i> and <i>full-text</i> .  Full-text search allows you to search for cards or files containing a specific string.  An attribute search allows you to impose conditions on the values ‚Äã‚Äãof the fields of the displayed cards.  The condition on the field value can use operations equal, not equal, more, less, and others, depending on the type of field.  Conditions can be combined with AND or OR.  Thus, the tree of conditions turns out.  When the stored procedure is generated, conditions are generated in the WHERE. <br><br>  A similar approach is used in the submissions, since they, too, should not generally display all the cards.  Unlike search, views support so-called computed fields.  Generating a calculated field can be thought of as adding another expression to the list of a SELECT statement of the resulting sample of a stored procedure.  The expressions for the calculated field resemble the expressions for the condition tree.  In essence, this is the same tree, but instead of comparison operations, it most often uses arithmetic operations, as well as CASE WHEN expressions (resembling a switch in C #). <br><br>  For simplicity, the sampling scheme in the representations can be represented as follows: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> </code> </pre><br>  In fact, of course, everything is more complicated.  First, a view can contain more than one such sample, but several, and these samples are combined using UNION ALL.  This can be useful to display different types of cards into one view.  Secondly, in the page views, reading all the data for all pages from the database would lead to a significant decrease in performance, so the generator uses the <s>corresponding magic</s> from one sample to generate several stored procedures. <br><br>  Views also provide advanced features that include the use of aggregations, concatenations, and the opening of wooden sections.  Supports sorting for views.  And the grouping is already done on the client. <br><br>  In more detail, the search and presentation model can be considered in one of the future articles, and this block outlines basic information. </div><p>Source: <a href="https://habr.com/ru/post/233897/">https://habr.com/ru/post/233897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233883/index.html">Trivial SMS alert when server \ hardware is unavailable</a></li>
<li><a href="../233885/index.html">JSOC: the experience of the young Russian MSSP</a></li>
<li><a href="../233889/index.html">Working with graphic objects in Android</a></li>
<li><a href="../233891/index.html">The big story about BlackHat USA'2014</a></li>
<li><a href="../233895/index.html">Why Habr popular science?</a></li>
<li><a href="../233899/index.html">Integrating Git into Sublime Text</a></li>
<li><a href="../233901/index.html">Review of Garmin, Huawei and Sony fitness bracelets</a></li>
<li><a href="../233903/index.html">DDoS great and terrible</a></li>
<li><a href="../233905/index.html">Linear cryptanalysis for dummies</a></li>
<li><a href="../233907/index.html">Why Bitcoin is Good</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>