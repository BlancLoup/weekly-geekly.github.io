<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What happened to hook_menu in Drupal 8?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In connection with the recent release of the stable version of Drupal 8, I decided to make a small contribution and translate a short article. This is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What happened to hook_menu in Drupal 8?</h1><div class="post__text post__text-html js-mediator-article"><img width="50%" src="https://habrastorage.org/files/57d/855/e05/57d855e05ce7414c958c6879c534ecee.jpg"><br><br>  <i>In connection with the recent release of the stable version of Drupal 8, I decided to make a small contribution and translate a short article.</i>  <i>This is a very free translation of the article <a href="https://www.lullabot.com/articles/what-happened-to-hook_menu-in-drupal-8">What Happened to Hook_Menu in Drupal 8?</a></i>  <i>from Lullabot'ov.</i>  <i>I hope that someone will come in handy.</i> <br><br>  In Drupal 7 and earlier, <b>hook_menu</b> was like a Swiss knife.  He was responsible for almost everything: page paths, menu handlers, tabs and local tasks, contextual links, access control, arguments and parameters, form handlers, and even set menu items.  In my book, this is the most frequently used hook of all.  I don't know, there was not a single module in which I would not implement hook_menu. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But, in Drupal 8, everything changed.  This very important hook is no longer there, and now all these tasks are solved separately using the YAML system of files, in which you need to describe the metadata about each element and the corresponding PHP classes that provide logic. <br><br>  The new system makes sense, but it may seem confusing, especially since the API has changed several times over the lengthy development of Drupal 8, and the documentation is currently not true.  This article will explain how the new system works. <br><br>  I also want to talk about the situations that I encountered during the transfer of my module from Drupal 7 to Drupal 8 and give examples of the code before and after the transfer. <br><a name="habracut"></a><br><h5>  Custom pages </h5><br>  In the simplest case, <b>hook_menu was</b> used to create custom pages along a specified path.  In Drupal 8, paths are managed using the <b>MODULE.routing.yml</b> file, which describes the <b>mapping of</b> paths (routes) and classes of controllers containing data processing logic along this path.  Each class is inherited from the <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Controller!ControllerBase.php/class/ControllerBase/8">base controller</a> .  In Drupal 7, such logic controllers could be in <b>MODULE.pages.inc</b> . <br><br>  Sample code in Drupal 7: <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example_menu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $items = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $items[<span class="hljs-string"><span class="hljs-string">'main'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span>, <span class="hljs-string"><span class="hljs-string">'page callback'</span></span> =&gt; example_main_page, <span class="hljs-string"><span class="hljs-string">'access arguments'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'access content'</span></span>), <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; MENU_NORMAL_ITEM, <span class="hljs-string"><span class="hljs-string">'file'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MODULE.pages.inc'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $items; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example_main_page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t(<span class="hljs-string"><span class="hljs-string">'Something goes here'</span></span>); }</code> </pre> <br>  In Drupal 8, we describe the route information (path) in the <b>MODULE.routing.yml</b> file.  Each route has a name that is not responsible for anything, but is simply a unique identifier of the route, and must be prefixed with the name of your module in order to avoid name conflicts.  You can find in the documentation that there were once discussions about using <b>_content</b> or <b>_form</b> suffixes instead of <b>_controller</b> in YAML files, but this was later abandoned and now you always need to use the <b>_controller</b> suffix to determine the corresponding controller. <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main'</span></span> defaults: _controller: <span class="hljs-string"><span class="hljs-string">'\Drupal\example\Controller\MainPageController::mainPage'</span></span> _title: <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span></code> </pre><br>  Note the use of a slash at the beginning.  In Drupal 7, the path would be <b>‚Äúmain‚Äù</b> , and in Drupal 8 it would be <b>‚Äú/ main‚Äù</b> .  I constantly forget about the slash in the beginning, this is one of the problems of switching to the new version.  A forward slash is the first thing to check if your code is not working. <br><br>  In the example above, the controller class is named MainPageController.php, and it is located in the <b>MODULE / src / Controller / MainPageController.php</b> file.  The file name must match the class name of the controller, and all the controllers of your module must be in the <b>/ src / Controller</b> folder.  This place is described in the PSR-4 standard, which is adopted in Drupal 8. In principle, everything that lies in the expected place for <b>/ src</b> for Drupal will be automatically loaded if necessary, without using <b>module_load_include ()</b> , or listing in the <b>.info</b> file as we did this in Drupal 7. <br><br>  The method in the controller that will control this route can have any name.  In my example, I used the arbitrary name of <b>mainPage</b> .  Most importantly, the method that we will use in our controller must correspond to what we have described in the YAML file, in the <b>_controller</b> directive, as <b>class_name :: method</b> . <br><br>  One controller can manage one or more routes, since each has its own handler (callback) and its own entry in the YAML file.  For example, in the core, the <b>nodeController</b> controller manages four routes listed in <b>node.routing.yml</b> . <br>  The controller should always return an array for (render array), not text or HTML, as it was in Drupal 7. <br><br>  Translation in the controller is available via the <b>$ this-&gt; t ()</b> method instead of the <b>t ()</b> function.  This is done because <b>StringTranslationTrait has been</b> added to <b>BaseController</b> .  A good article on how PHP traits such as translations work in Drupal 8 on <a href="https://drupalize.me/blog/201503/dependency-injection-traits-drupal-8">DrupalizeMe</a> . <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@file</span></span></span><span class="hljs-comment"> * Contains \Drupal\example\Controller\MainPageController. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">example</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">ControllerBase</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainPageController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mainPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'#markup'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;t(<span class="hljs-string"><span class="hljs-string">'Something goes here!'</span></span>), ]; } }</code> </pre><br><h5>  Paths with arguments </h5><br>  For some routes, arguments (parameters) are needed.  If my page had a couple of arguments, then in Drupal 7 it would look like this: <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example_menu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $items = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $items[<span class="hljs-string"><span class="hljs-string">'main/%/%'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span>, <span class="hljs-string"><span class="hljs-string">'page callback'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'example_main_page'</span></span>, <span class="hljs-string"><span class="hljs-string">'page arguments'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'access arguments'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'access content'</span></span>), <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; MENU_NORMAL_ITEM, ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $items; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example_main_page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($first, $second)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t(<span class="hljs-string"><span class="hljs-string">'Something goes here'</span></span>); }</code> </pre><br>  Let's fix our YAML file for Drupal 8, and see how the transfer of arguments looks like there: <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main/{first}/{second}'</span></span> defaults: _controller: <span class="hljs-string"><span class="hljs-string">'\Drupal\example\Controller\MainPageController::mainPage'</span></span> _title: <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span></code> </pre><br>  And our controller will look like this (parameters are passed by arguments to the method): <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@file</span></span></span><span class="hljs-comment"> * Contains \Drupal\example\Controller\MainPageController. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">example</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">ControllerBase</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainPageController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mainPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($first, $second)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something with $first and $second. return [ '#markup' =&gt; $this-&gt;t('Something goes here!'), ]; } }</span></span></code> </pre><br><h5>  Paths With Optional Arguments </h5><br>  The above example will work correctly only when both arguments are passed.  That is, neither <b>"/ main"</b> nor <b>"/ main / first" will</b> work, only <b>"/ main / first / second"</b> .  If you want all three routes to work, you need to make a few changes to the YAML file, namely in the <b>defaults</b> section, add default values ‚Äã‚Äãfor the arguments to be passed: <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main/{first}/{second}'</span></span> defaults: _controller: <span class="hljs-string"><span class="hljs-string">'\Drupal\example\Controller\MainPageController::mainPage'</span></span> _title: <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span> first: <span class="hljs-string"><span class="hljs-string">''</span></span> second: <span class="hljs-string"><span class="hljs-string">''</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span></code> </pre><br><h5>  Restricting Parameters (Restricting Parameters) </h5><br>  After we have passed the parameters, we need to describe it in the YAML file of the module, which is allowed in these parameters.  The example below shows that the parameter named <b>$ first</b> can only contain the values <b>'Y'</b> or <b>'N'</b> , and the parameter named <b>$ second</b> must be a number.  Any parameters passed that do not comply with these rules will return a page with the code <b>404 Not found</b> . <br><br>  To learn more about setting up routes, you can refer to the <a href="http://symfony.com/doc/current/book/routing.html">symfony documentation</a> . <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main/{first}/{second}'</span></span> defaults: _controller: <span class="hljs-string"><span class="hljs-string">'\Drupal\example\Controller\MainPageController::mainPage'</span></span> _title: <span class="hljs-string"><span class="hljs-string">'Main Page'</span></span> first: <span class="hljs-string"><span class="hljs-string">''</span></span> second: <span class="hljs-string"><span class="hljs-string">''</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span> first: Y|N second: \d+</code> </pre><br><h5>  Passing Entities in Parameters (Entity Parameters) </h5><br>  Just as in Drupal 7, when you create a route, you can pass an entity object to it, and not just its identifier.  This is called <b>"upcasting"</b> (cast to base type).  In the seventh version, instead of the simple <b>‚Äú%‚Äù</b> sign, you would need to specify the keyword <b>‚Äú% node‚Äù</b> .  In Drupal 8, you just need to use the name of an object as a parameter name, for example, <b>{node}</b> or <b>{user}</b> . <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/node/{node}'</span></span> defaults: _controller: <span class="hljs-string"><span class="hljs-string">'\Drupal\example\Controller\MainPageController::mainPage'</span></span> _title: <span class="hljs-string"><span class="hljs-string">'Node Page'</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span></code> </pre><br>  Such <b>‚Äúupcasting‚Äù</b> will work only when the object of the transmitted type is present as a parameter in your controller.  Otherwise, there will be just the value of the passed parameter. <br><br><h5>  JSON handlers (JSON Callbacks) </h5><br>  All that we have considered above, as a result returns already ready HTML code.  That is, the array that you return in the handler method will be automatically converted by the system into HTML code.  But what if you need to return not HTML, but JSON?  I had a problem finding information on this topic.  In the old documentation it was written that you need to add <b>_format: json</b> to the <b>requirements</b> section of your YAML file, but this is not at all necessary if you want to provide a different format along the same route. <br><br>  Create an array consisting of the values ‚Äã‚Äãyou want to return and return it as a JsonResponse object.  Do not forget to add <b>‚Äúuse Symfony \ Component \ HttpFoundation \ JsonResponse‚Äù</b> in the upper part of your controller class to make this object available. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@file</span></span></span><span class="hljs-comment"> * Contains \Drupal\example\Controller\MainPageController. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">example</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">ControllerBase</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">JsonResponse</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainPageController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mainPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $return = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">// Create key/value array. return new JsonResponse($return); } }</span></span></code> </pre><br><h5>  Access Control </h5><br>  In Drupal 7, <b>hook_menu</b> also allowed access control.  Now access control is carried out in the <b>MODULE.routing.yml</b> file.  There are several ways to control access: <br><br>  Allow absolutely access for everyone on this route: <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main'</span></span> requirements: _access: <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span></code> </pre><br>  Access restriction, for example for those who have access to content, ‚Äúaccess content‚Äù (access to content): <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main'</span></span> requirements: _permission: <span class="hljs-string"><span class="hljs-string">'access content'</span></span></code> </pre><br>  Restrictions on roles, for example, only for those users who have the ‚Äúadmin‚Äù role: <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/main'</span></span> requirements: _role: <span class="hljs-string"><span class="hljs-string">'admin'</span></span></code> </pre><br>  Restriction on the interaction with the entity, for example, only when the user is allowed to edit the material (the entity must be passed as an argument along the way): <br><br><pre> <code class="php hljs">example.main_page_controller: path: <span class="hljs-string"><span class="hljs-string">'/node/{node}'</span></span> requirements: _entity_access: <span class="hljs-string"><span class="hljs-string">'node.edit'</span></span></code> </pre><br>  Access control is described in more detail in the <a href="https://www.drupal.org/node/2092643">documentation</a> . <br><br><h5>  hook_menu_alter </h5><br>  But what if we want to change an existing route (which was created by the kernel or another module)?  In Drupal 7, <b>hook_menu_alter</b> was for this <b>,</b> but it isn't in Drupal 8 either.  At the moment it is more difficult than it was before.  The simplest example I could find was in the <b>Node</b> module, it changed the route created by the <b>System</b> module. <br><br>  The file with the <b>MODULE / src / Routing / CLASSNAME.php class is</b> inherited from <b>RouteSubscriberBase</b> and works as follows.  It finds the route and modifies it using the <b>alterRoutes ()</b> method. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@file</span></span></span><span class="hljs-comment"> * Contains \Drupal\node\Routing\RouteSubscriber. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">node</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Drupal</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteSubscriberBase</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Listens to the dynamic route events. */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteSubscriber</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteSubscriberBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alterRoutes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RouteCollection $collection)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// As nodes are the primary type of content, the node listing should be // easily available. In order to do that, override admin/content to show // a node listing instead of the path's child links. $route = $collection-&gt;get('system.admin_content'); if ($route) { $route-&gt;setDefaults(array( '_title' =&gt; 'Content', '_entity_list' =&gt; 'node', )); $route-&gt;setRequirements(array( '_permission' =&gt; 'access content overview', )); } } }</span></span></code> </pre><br><pre> <code class="php hljs">services: node.route_subscriber: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drupal</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Routing</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteSubscriber</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tags</span></span></span><span class="hljs-class">: - </span></span>{ name: event_subscriber }</code> </pre><br>  Most core modules describe a class inherited from <b>RouteSubscriber</b> in the <b>MODULE / src / EventSubscriber / CLASSNAME.php folder</b> instead of <b>MODULE / src / Routing / CLASSNAME.php</b> .  I could not figure out why they used another folder. <br><br>  In fact, changing existing routes and creating new dynamic routes are quite complex topics, and are clearly beyond the scope of this article. <br><br>  More information on the topic: <br><br><ul><li>  <a href="https://api.drupal.org/api/drupal/8">https://api.drupal.org/api/drupal/8</a> </li><li>  <a href="https://www.drupal.org/developing/api/8/routing">https://www.drupal.org/developing/api/8/routing</a> </li><li>  <a href="http://symfony.com/doc/current/book/routing.html">http://symfony.com/doc/current/book/routing.html</a> </li><li>  <a href="http://symfony.com/doc/current/book/routing.html">https://drupalize.me/videos/symfony-routing?p=1856</a> </li><li>  <a href="https://drupalize.me/videos/introduction-yaml">https://drupalize.me/videos/introduction-yaml</a> </li><li>  <a href="https://www.drupal.org/node/2092643">https://www.drupal.org/node/2092643</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/272863/">https://habr.com/ru/post/272863/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272851/index.html">Avast Antivirus detects critical vulnerabilities</a></li>
<li><a href="../272853/index.html">Simple Blender. Part 3</a></li>
<li><a href="../272855/index.html">Security Week 50: DDoS root DNS servers, APT Sofacy life, lots of cryptography</a></li>
<li><a href="../272857/index.html">The world's worst captcha for a multimillion-dollar site.</a></li>
<li><a href="../272861/index.html">Java 9 First Steps and the Jigsaw Project - Part Two</a></li>
<li><a href="../272865/index.html">We are replacing the Bing search engine with the necessary one in Skype</a></li>
<li><a href="../272867/index.html">Organization of a hybrid port on the Alcatel-Lucent 7210 SAS-M</a></li>
<li><a href="../272869/index.html">About how I spent a week in Bareos</a></li>
<li><a href="../272871/index.html">Haskell for VK, Javascript and ReactJS, Or Alien vs. The Simpsons</a></li>
<li><a href="../272873/index.html">PhoneGap vs. Cordova</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>