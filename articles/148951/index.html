<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing REST API on symfony2: the right way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating a REST API is not an easy task. No seriously! If you want to write the API correctly, you will have to think a lot, decide whether to be a pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing REST API on symfony2: the right way</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d03/960/dfc/d03960dfc6cf5f445e629a99a8bf9452.png" alt="REST" align="right"><br>  Creating a REST API is not an easy task.  No seriously!  If you want to write the API correctly, you will have to think a lot, decide whether to be a pragmatist, or an API maniac.  REST is not only GET, POST, PUT and Delete.  In practice, you may have interactions between resources, you need to move resources somewhere else (for example, inside a tree), or you want to get a specific resource value. <br><br>  In this article, I collected everything that I learned by implementing various API services using <a href="http://github.com/symfony/symfony">Symfony2</a> , <a href="http://github.com/FriendsOfSymfony/FOSRestBundle">FOSRestBundle</a> , <a href="http://github.com/nelmio/NelmioApiDocBundle">NelmioApiDocBundle</a> and <a href="http://github.com/propelorm/Propel">Propel</a> for this purpose.  For example, let's make an API for working with users. <a name="habracut"></a><br><br><h4>  Do you speak...? </h4><br>  APIs use client applications.  They should know how to access your API service, and quality documentation is a good way to achieve this, but this is the end of the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, you also need to know how to communicate with customers, and the HTTP protocol, namely the <b>Accept</b> header, will help us with this.  In essence, customers will send a header with the type of data format they want to receive. <br><br>  However, in FOSRestBundle everything has been done for you.  It takes care of the need to keep track of this part, but you must determine in the settings which format you want to support.  Most likely, you usually use JSON, but if you are puzzled by the problem of semantics, you will send XML.  This part will also be covered later. <br><br><h4>  GET what? </h4><br>  The HTTP GET method is idempotent.  This means that no matter how many times you request data using this method, you should receive the same data.  There should be no change in them.  Use GET to get resources: a collection or a separate resource.  In Symfony2, the routing rule descriptions will look something like this: <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># src/Acme/DemoBundle/Resources/config/routing.yml acme_demo_user_all: pattern: /users defaults: { _controller: AcmeDemoBundle:User:all, _format: ~ } requirements: _method: GET acme_demo_user_get: pattern: /users/{id} defaults: { _controller: AcmeDemoBundle:User:get, _format: ~ } requirements: _method: GET id: "\d+"</span></span></code> </pre> <br><br>  The UserController class will contain the following code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Acme</span></span>\<span class="hljs-title"><span class="hljs-title">DemoBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Acme</span></span>\<span class="hljs-title"><span class="hljs-title">DemoBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Acme</span></span>\<span class="hljs-title"><span class="hljs-title">DemoBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">UserQuery</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">FOS</span></span>\<span class="hljs-title"><span class="hljs-title">RestBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Annotations</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Rest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">NotFoundHttpException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Rest</span></span></span><span class="hljs-comment">\View */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $users = UserQuery::create()-&gt;find(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'users'</span></span> =&gt; $users); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Rest</span></span></span><span class="hljs-comment">\View */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ $user = UserQuery::create()-&gt;findPk($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$user <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> User) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotFoundHttpException(<span class="hljs-string"><span class="hljs-string">'User not found'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $user); } }</code> </pre><br><br>  Instead of using a <a href="http://symfony.com/doc/master/bundles/SensioFrameworkExtraBundle/annotations/converters.html">parameter converter</a> in get * () methods, I always have to get objects myself.  Later I will explain why, but for now just trust me, it's really better. <br><br>  <b>The status code is</b> important for clients, so if the user does not exist, use a <i>NotFoundHttpException</i> exception, which will return a response with status code 404. <br><br>  Using the View annotation, you will display the user object in the desired format that the user specified in the <b>Accept</b> header.  Using the alias (Rest) for annotations is a trick that will help avoid conflicts with the View object, which we will discuss later.  Simply put, annotations refer to this class.  It is only a matter of taste, whether to use annotations or not. <br><br>  And lastly, the allAction () method.  It has the same behavior as getAction: you just get a sample of users and return it. <br><br>  The user object has 4 properties: id, email, username and password.  Probably common sense will not allow you to give passwords to users in free access through the API.  The easiest way to eliminate this property when serializing an object is by setting up the serializer.  Configuration example in YAML format: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># In Propel, the most part of the code is located in base classes # src/Acme/DemoBundle/Resources/config/serializer/Model.om.BaseUser.yml Acme\DemoBundle\Model\om\BaseUser: exclusion_policy: ALL properties: id: expose: true username: expose: true email: expose: true</span></span></code> </pre><br><br>  I advise by default to exclude all properties of the object, and add the necessary ones explicitly.  This gives more flexibility on large objects.  This does not really make sense with 4 properties, but still try to stick to this strategy, this is how to set up a firewall in the end. <br><br>  As a result, we get the following JSON response: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"user"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">999</span></span>, <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"xxxx@example.org"</span></span> } }</code> </pre><br><br>  Simple, isn't it?  But you will probably need to create, modify or delete users, and this will be the topic for the next chapter. <br><br><h4>  POST 'it </h4><br>  Creating a user involves using the HTTP POST method.  But how will you get the data?  How will you check them?  And how will you create a new object?  There are more than one answer or strategy to these three questions. <br><br>  You can use the deserialization mechanism to create a form object from the serialized entered data.  A guy named <a href="http://twitter.com/beberlei">Benjamin</a> works on a <a href="https://github.com/simplethings/SimpleThingsFormSerializerBundle">form-based desialyzer</a> .  This method is only slightly different from using <a href="https://github.com/symfony/Serializer">the Serializer component</a> , but it seems simpler. <br><br>  I use the cool <a href="https://github.com/symfony/Form">form component from symfony</a> to do everything at once.  Let's write a form class to create a new user.  Using the PropelBundle you can use the <i>propel</i> command <i>: form: generate command</i> : <br><pre> <code class="php hljs">php app/console propel:form:generate @AcmeDemoBundle User</code> </pre><br><br>  This command will create the following form class: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Acme</span></span>\<span class="hljs-title"><span class="hljs-title">DemoBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">AbstractType</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">FormBuilderInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">OptionsResolver</span></span>\<span class="hljs-title"><span class="hljs-title">OptionsResolverInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FormBuilderInterface $builder, array $options)</span></span></span><span class="hljs-function"> </span></span>{ $builder-&gt;add(<span class="hljs-string"><span class="hljs-string">'username'</span></span>); $builder-&gt;add(<span class="hljs-string"><span class="hljs-string">'email'</span></span>, <span class="hljs-string"><span class="hljs-string">'email'</span></span>); $builder-&gt;add(<span class="hljs-string"><span class="hljs-string">'password'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDefaultOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OptionsResolverInterface $resolver)</span></span></span><span class="hljs-function"> </span></span>{ $resolver-&gt;setDefaults(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'data_class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Acme\DemoBundle\Model\User'</span></span>, <span class="hljs-string"><span class="hljs-string">'csrf_protection'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )); } <span class="hljs-comment"><span class="hljs-comment">/** * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment">} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'user'</span></span>; } }</code> </pre><br><br>  Something I had to tweak with my hands: email and password types, and I also turned off CSRF protection.  In the REST API, you are most likely using a security layer, such as OAuth.  Having CSRF protection in a REST context makes no sense. <br><br>  Now we need to add validation rules, and thanks to the <a href="http://symfony.com/doc/master/book/validation.html">appropriate component</a> it will be easy.  I really like this component, as it makes it quite easy to check all incoming data in a safe way. <br><br>  Returning to our case, I used to describe the validation rules in YAML, but no one restricts you in choosing.  Here is an example: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># src/Acme/DemoBundle/Resources/config/validation.yml Acme\DemoBundle\Model\User: getters: username: - NotBlank: email: - NotBlank: - Email: password: - NotBlank:</span></span></code> </pre><br><br>  Let's now write a method in the controller: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... public function newAction() { return $this-&gt;processForm(new User()); }</span></span></code> </pre><br><br>  Another tip.  Always use a separate method for processing your forms.  Then you thank yourself.  The <i>processForm ()</i> method looks like this: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// ... private function processForm(User $user) { $statusCode = $user-&gt;isNew() ? 201 : 204; $form = $this-&gt;createForm(new UserType(), $user); $form-&gt;bind($this-&gt;getRequest()); if ($form-&gt;isValid()) { $user-&gt;save(); $response = new Response(); $response-&gt;setStatusCode($statusCode); $response-&gt;headers-&gt;set('Location', $this-&gt;generateUrl( 'acme_demo_user_get', array('id' =&gt; $user-&gt;getId()), true // absolute ) ); return $response; } return View::create($form, 400); }</span></span></code> </pre><br><br>  In short, you create a form, bind incoming data to it, and, if all data is valid, you save your user and return the answer.  If something goes wrong, you can return code 400 along with the form.  An instance of the form class will be serialized to display error messages.  For example, you can get the following error response: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"children"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: { <span class="hljs-string"><span class="hljs-string">"errors"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"This value should not be blank."</span></span> ] } } }</code> </pre><br><br>  Note: The View class that we see here is not the same as what we use in the annotations, which is why I used a nickname for them.  Read more about this class in the <a href="">‚ÄúThe View Layer‚Äù</a> chapter in the documentation for the FOSRestBundle. <br><br>  It is also important to pass the name of the form.  Typically, customers will send you some data like this: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"user"</span></span>: { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo@example.org"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"hahaha"</span></span> } }</code> </pre><br><br>  You can try calling this method with curl: <br><pre> <code class="bash hljs">curl -v -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> -X POST -d <span class="hljs-string"><span class="hljs-string">'{"user":{"username":"foo", "email": "foo@example.org", "password": "hahaha"}}'</span></span> http://example.com/users</code> </pre><br><br>  Make sure that you set the value of the <i>body_listener parameter</i> to true in the <i>FOSRestBundle</i> settings.  This option allows you to receive data in JSON, XML and others.  Again, everything works out of the box. <br><br>  As I said earlier, if everything goes well, you save your user ($ user-&gt; save to Propel) and then return the answer. <br><br>  You must send the status code 201, which says that the resource has been created.  Please note that I do not use the View annotation for this method. <br><br>  But if you look closely at the code, you may notice that I did a strange thing.  In fact, when creating a resource, you must return certain information: how to access this resource.  In other words, you must return a URI.  The HTTP specification says that you should use the <b>Location</b> header, which I did.  But you hardly want to make another request to get such information as the user id (you already have the rest of the information anyway).  And here comes my main concept: a pragmatist or a maniac? <br><br>  You know what?  I prefer the manic approach, and I follow the specification, returning only the <b>Location</b> header: <br><pre> <code class="php hljs">Location: http:<span class="hljs-comment"><span class="hljs-comment">//example.com/users/999</span></span></code> </pre><br><br>  If, as a client, I use the JavaScript framework ala Backbone.js, since I do not want to rewrite parts of it, because it does not support the correct APIsh, I return in addition to everything and Id.  Being a pragmatist is not so bad. <br><br>  Remember to add a routing rule for this action.  Creating a resource is a POST request to the collection, so add a new rule: <br><pre> <code class="php hljs">acme_demo_user_new: pattern: /users defaults: { _controller: AcmeDemoBundle:User:<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>, _format: ~ } requirements: _method: POST</code> </pre><br><br>  Knowing how to create a new resource, it will be quite easy to change it. <br><br><h4>  PUT vs PATCH, fight! </h4><br>  Changing a resource means replacing it, especially if you use the HTTP <b>PUT</b> method.  There is also a <b>PATCH</b> method that takes the difference between resources and applies a <i>patch</i> to the source resource, in other words, it makes a <b>partial update</b> . <br><br>  Thanks to the work done earlier, changing the resource will be quite easy to implement.  You must write a new method in the controller and add a new routing rule.  Here I can rely on the parameter converter to select our user object.  If such user does not exist, the parameter converter will throw an exception and this exception will be converted to a response with status code 404. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... public function editAction(User $user) { return $this-&gt;processForm($user); }</span></span></code> </pre><br><br>  Changing a resource means that you already know everything about it, so you can return in the PUT request only the URI for this resource: <br><pre> <code class="php hljs">acme_demo_user_edit: pattern: /users/{id} defaults: { _controller: AcmeDemoBundle:User:edit, _format: ~ } requirements: _method: PUT</code> </pre><br><br>  And it's all!  And what about the deletion of the resource? <br><br><h4>  DELETE </h4><br>  Deleting a resource is very easy.  Add a routing rule: <br><pre> <code class="php hljs">acme_demo_user_delete: pattern: /users/{id} defaults: { _controller: AcmeDemoBundle:User:remove, _format: ~ } requirements: _method: DELETE</code> </pre><br><br>  And write a short method: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... /** * @Rest\View(statusCode=204) */ public function removeAction(User $user) { $user-&gt;delete(); }</span></span></code> </pre><br><br>  Having written only a few dozen lines of code, you have implemented a fully working API that safely implements CRUD operations.  And now, what about adding interactions between users?  Like friendship? <br><br>  <i>How to get a list of friends for this user through REST?</i>  We just have to treat friends as a collection of users owned by a particular user.  Let's implement this interaction. <br><br><h4>  Friendship Algorithm </h4><br>  First we need to create a new routing rule.  Since we consider friends as a collection of users, we will get it directly from the resource: <br><pre> <code class="php hljs">acme_demo_user_get_friends: pattern: /users/{id}/friends defaults: { _controller: AcmeDemoBundle:User:getFriends, _format: ~ } requirements: _method: GET</code> </pre><br><br>  This action will look like this in the controller: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... public function getFriendsAction(User $user) { return array('friends' =&gt; $user-&gt;getFriends()); }</span></span></code> </pre><br><br>  That's all.  Now let's think about how to describe the process of becoming a friend to another user.  <i>How would you manage this through REST?</i>  You cannot use POST for a collection of friends because you are not going to create anything.  Both users already exist.  You cannot use the PUT method because you really do not want to replace the entire collection.  It can really put us in a dead end ... <br><br>  But, the HTTP protocol specification describes the LINK method, which solves our problem.  It says: <br><blockquote>  The LINK method establishes one or more links between an existing resource specified in the Request-URI and other existing resources. <br></blockquote><br><br>  This is exactly what we need.  We want to link two resources, we should not forget about resources while we write API services.  So how to do this in symfony2? <br><br>  My method is based on using the query listener.  The client sends a LINK request for the resource and sends at least one <b>Link</b> header. <br><pre> <code class="php hljs">LINK /users/<span class="hljs-number"><span class="hljs-number">1</span></span> Link: &lt;http:<span class="hljs-comment"><span class="hljs-comment">//example.com/users/2&gt;; rel="friend" Link: &lt;http://example.com/users/3&gt;; rel="friend"</span></span></code> </pre><br><br>  Using the query listener is a pretty nice option, as it allows you to get clean input in your methods.  In the end, the purpose of this method is to link objects, but we do not want to play with the URI in the controller.  All conversions must be performed before this. <br><br>  The request listener will take all of these <b>Link</b> headers and use them for the Symfony2 component <i>RouterMatcher</i> to get the controller and method names.  He will also prepare the parameters. <br><br>  In other words, it has all the necessary information to create a controller and call the correct method in it with the necessary parameters.  In our example, for each <b>Link</b> header, the getUser () method will be called in the UserController controller.  That is why I did not use the parameter converter, this allowed me to accept the value of the id argument so that I could get a resource from it.  I made a couple of suggestions: <br><ul><li>  If the user does not exist, an exception will be returned to me; </li><li>  I will get the array as a return value, since I used the View annotation. </li></ul><br><br>  When I get my resource objects, I will place them as request attributes, and for our listener this will complete the work.  Here is the code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Acme</span></span>\<span class="hljs-title"><span class="hljs-title">DemoBundle</span></span>\<span class="hljs-title"><span class="hljs-title">EventListener</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Event</span></span>\<span class="hljs-title"><span class="hljs-title">GetResponseEvent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">ControllerResolverInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">Matcher</span></span>\<span class="hljs-title"><span class="hljs-title">UrlMatcherInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkRequestListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ControllerResolverInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $resolver; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $urlMatcher; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> ControllerResolverInterface $controllerResolver The 'controller_resolver' service * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> UrlMatcherInterface $urlMatcher The 'router' service */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ControllerResolverInterface $controllerResolver, UrlMatcherInterface $urlMatcher)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;resolver = $controllerResolver; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;urlMatcher = $urlMatcher; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKernelRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GetResponseEvent $event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$event-&gt;getRequest()-&gt;headers-&gt;has(<span class="hljs-string"><span class="hljs-string">'link'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $links = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $header = $event-&gt;getRequest()-&gt;headers-&gt;get(<span class="hljs-string"><span class="hljs-string">'link'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *   ,     *     . * *         Link   * http://tools.ietf.org/html/rfc2068#section-19.6.2.4 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/^((?:[^"]|"[^"]*")*?),/'</span></span>, $header, $matches)) { $header = trim(substr($header, strlen($matches[<span class="hljs-number"><span class="hljs-number">0</span></span>]))); $links[] = $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($header) { $links[] = $header; } $requestMethod = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;urlMatcher-&gt;getContext()-&gt;getMethod(); <span class="hljs-comment"><span class="hljs-comment">//    GET    //     ,      (LINK/UNLINK) $this-&gt;urlMatcher-&gt;getContext()-&gt;setMethod('GET'); //           $stubRequest = new Request(); foreach ($links as $idx =&gt; $link) { $linkParams = explode(';', trim($link)); $resource = array_shift($linkParams); $resource = preg_replace('/&lt;|&gt;/', '', $resource); try { $route = $this-&gt;urlMatcher-&gt;match($resource); } catch (\Exception $e) { //        //     Link continue; } $stubRequest-&gt;attributes-&gt;replace($route); if (false === $controller = $this-&gt;resolver-&gt;getController($stubRequest)) { continue; } $arguments = $this-&gt;resolver-&gt;getArguments($stubRequest, $controller); try { $result = call_user_func_array($controller, $arguments); //       if (!is_array($result)) { continue; } //     $links[$idx] = current($result); } catch (\Exception $e) { continue; } } $event-&gt;getRequest()-&gt;attributes-&gt;set('link', $links); $this-&gt;urlMatcher-&gt;getContext()-&gt;setMethod($requestMethod); } }</span></span></code> </pre><br><br>  Now we can create a routing rule: <br><pre> <code class="php hljs">acme_demo_user_link: pattern: /users/{id} defaults: { _controller: AcmeDemoBundle:User:link, _format: ~ } requirements: _method: LINK</code> </pre><br><br>  And the code of our action will look like this: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... /** * @Rest\View(statusCode=204) */ public function linkAction(User $user, Request $request) { if (!$request-&gt;attributes-&gt;has('link')) { throw new HttpException(400); } foreach ($request-&gt;headers-&gt;get('Link') as $u) { if (!$u instanceof User) { throw new NotFoundHttpException('Invalid resource'); } if ($user-&gt;hasFriend($u)) { throw new HttpException(409, 'Users are already friends'); } $user-&gt;addFriend($u); } $user-&gt;save(); }</span></span></code> </pre><br><br>  If users are already friends, we will receive a response with the status code 409, which means that a conflict has occurred.  If the request does not have a Link header, then this is a bad request (400). <br><br>  The same goes for deletion from friends.  Only here we will use the <b>UNLINK</b> method. <br><br>  And finally.  I have not explained the PATCH method.  I mean, what's the script for this method?  The answer will be a partial update or any method that is unsafe, unreliable, or not idempotent.  If you have a non-standard method, and you do not know which method to use for it, then most likely PATCH will suit you. <br><br>  Suppose your users are allowed to change their email through third-party clients.  This client uses a two-step process.  The user requests permission to change his email address, he receives an email with a link and, after clicking on it, gets permission for the changes.  Skip the first stage and focus on the second.  The user sends a new email to the client, and the client must call your API method.  Either the client will receive the resource and its replacement, or, you are smart and provided him with the PATCH method. <br><br><h4>  Impose the PATCH world </h4><br>  First, we define a new routing rule: <br><pre> <code class="php hljs">acme_demo_user_patch: pattern: /users/{id} defaults: { _controller: AcmeDemoBundle:User:patch, _format: ~ } requirements: _method: PATCH</code> </pre><br><br>  And now is the time to turn on the imagination to write the secure patchAction () method in your controller.  Let's consider the usage scenario.  The client can send one or more value for your resource.  It would be nice to rely on the white list to prevent mass assignment, as all good rubists do ... <br><br>  Let's filter the incoming parameters: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $parameters = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($request-&gt;request-&gt;all() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $k =&gt; $v) { <span class="hljs-comment"><span class="hljs-comment">//   if (in_array($k, array('email'))) { $parameters[$k] = $v; } }</span></span></code> </pre><br><br>  As soon as we filtered the incoming parameters, we received exactly the parameters we wanted.  If we have not received anything, then this is a bad request and we must return a response with the status code 400. <br><br>  If all is well, then we can assign new values ‚Äã‚Äãto the resource.  Oh wait a minute ... No!  It is necessary to check the entity first and only if all the data is valid, save it. <br><br>  The code for this action will be something like this: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// .... public function patchAction(User $user, Request $request) { $parameters = array(); foreach ($request-&gt;request-&gt;all() as $k =&gt; $v) { // whitelist if (in_array($k, array('email'))) { $parameters[$k] = $v; } } if (0 === count($parameters)) { return View::create( array('errors' =&gt; array('Invalid parameters.')), 400 ); } $user-&gt;fromArray($parameters); $errors = $this-&gt;get('validator')-&gt;validate($user); if (0 &lt; count($errors)) { return View::create(array('errors' =&gt; $errors), 400); } $user-&gt;save(); $response = new Response(); $response-&gt;setStatusCode(204); $response-&gt;headers-&gt;set('Location', $this-&gt;generateUrl( 'acme_demo_user_get', array('id' =&gt; $user-&gt;getId()), true // absolute ) ); return $response; }</span></span></code> </pre><br><br>  It turned out pretty simple code, right?  As always, when you create or update a resource, you must send a response with the status code 2xx and the <b>Location</b> header.  Here we send code 204 because there is no content here and we do not create anything. <br><br>  And now, what's the plan?  We have already used the methods <i>GET, POST, PUT, DELETE, PATCH, LINK</i> , and <i>UNLINK</i> .  We can create, receive, modify, delete and even partially update users.  We can get a list of all users and establish a friendly relationship with them.  We know that if we need to change user data, we can safely use the <i>PATCH</i> method. <br><br>  In fact, with respect to <a href="http://www.crummy.com/writing/speaking/2008-QCon/act3.html">the Rijadsson Maturity model</a> , we covered only the second level.  So let's look at <b>HATEOAS</b> and unlock the third level! <br><br><img src="https://habrastorage.org/storage2/9f3/6e8/48d/9f36e848dc776b4188298d51f8e86ab7.png"><br><br><h4>  Who to hate? </h4><br>  HATEOAS has nothing to do with hate, but you may hate this approach if you consider yourself a pragmatic programmer.  This abbreviation stands for ‚ÄúHypermedia as the basis of application states‚Äù (Hypermedia As The Engine Of Application State).  For me, this is seen as adding semantics to your API services. <br><br>  Earlier in this article I talked about the formats used to exchange information between the client and your API.  JSON is not the best option if you decide to follow the principles of HATEOAS, despite the fact that some people <a href="https://github.com/kevinswiber/siren">offer solutions to this problem</a> . <br><br>  Transform our user‚Äôs representation into XML: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>999<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx@example.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  This is the output of your get method, if the client requests XML.  There is nothing from HATEOAS.  The first step is to add links: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>999<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx@example.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/999"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"self"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  It was simple, we just added a link that relates to the user whose data we received.  But if you have a collection of users paginated, you can get the following: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">users</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>999<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx@example.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/999"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"self"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/999/friends"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"friends"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>foobar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>foobar@example.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/123"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"self"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/123/friends"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"friends"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users?page=1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prev"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users?page=2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"self"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users?page=3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">users</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>      ,         /  . <br><br>     <b> </b>    : <b>?</b>   ?            ? <br><br>        : <br><pre> <code class="php hljs">Content-Type: application/vnd.yourname.something+xml</code> </pre><br><br>        : application/vnd.acme.user+xml. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>999<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>xxxx@example.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/999"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"self"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"friends"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/vnd.acme.user+xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.com/users/999/friends"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br> ,   ,       API-   .         URI: <br><pre> <code class="php hljs">/api/v1/users</code> </pre><br>        : <br><pre> <code class="xml hljs">application/vnd.acme.user-v1+xml</code> </pre><br><br>           <b>Accept</b> ,         : <br><pre> <code class="php hljs">application/vnd.acme.user+xml;v=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>     .    ,     RESTful   .        . <br><br><h4>  Testing </h4><br>  ,      API- ,    .   ,   REST     ,   API-   ,      . <br><br>     API-    ,         . Symfony2     ,      API    : <br><pre> <code class="php hljs">$client = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::createClient(); $crawler = $client-&gt;request(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'/users'</span></span>); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;getResponse(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertJsonResponse($response, <span class="hljs-number"><span class="hljs-number">200</span></span>);</code> </pre><br><br>     WebTestCase     assertJsonResponse(): <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... protected function assertJsonResponse($response, $statusCode = 200) { $this-&gt;assertEquals( $statusCode, $response-&gt;getStatusCode(), $response-&gt;getContent() ); $this-&gt;assertTrue( $response-&gt;headers-&gt;contains('Content-Type', 'application/json'), $response-&gt;headers ); }</span></span></code> </pre><br><br>    ,      API.    ,    ,       . <br><br>       API-,   ,     .    bad-             -    .  500         400. <br><br><h4>  Documentation </h4><br>     API   ,    ,      .        ? <br><br>     HATEOAS,  API   ,        ,         . <br><br>   ,  HATEOAS API  ,        .   API-     ,   ,       ! <br><br>      NelmioApiDocBundle.      <a href="http://nelm.io/">Nelmio</a>       API-.    ,     ,     - . <br><br><img src="https://habrastorage.org/storage2/4ae/f31/fb2/4aef31fb26b683f87f921bd0709655ba.png"><br><img src="https://habrastorage.org/storage2/6a1/afe/e3b/6a1afee3bbfe5f62aba1eba76f5b545b.png"><br><br>     ,     API-. <br><br><h4>  useful links </h4><br><ul><li> <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">RFC 2616 ‚Äî  10 ‚Äî  -;</a> </li><li> <a href="http://tools.ietf.org/html/rfc2068">RFC 2068 ‚Äî  19.6 ‚Äî  </a> </li><li> <a href="http://tools.ietf.org/html/rfc5988">RFC 5988 ‚Äî Web Linking.</a> </li></ul><br><br> <i>  :       .  ,    ,         ,      .     ,   .</i> </div><p>Source: <a href="https://habr.com/ru/post/148951/">https://habr.com/ru/post/148951/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148944/index.html">Discover Cach√© SQL Gateway for building federated systems or multibases</a></li>
<li><a href="../148945/index.html">Input attribute placeholder</a></li>
<li><a href="../148946/index.html">Mobile Developer Day in Odessa</a></li>
<li><a href="../148948/index.html">Configuration files Libconfig library</a></li>
<li><a href="../148950/index.html">ReactOS, do you get in touch again?</a></li>
<li><a href="../148953/index.html">One of our most difficult projects is ATP Pravo.ru for WP7</a></li>
<li><a href="../148954/index.html">Linux graphics stack</a></li>
<li><a href="../148956/index.html">New Transformation Competition</a></li>
<li><a href="../148957/index.html">Cloud computing: 10 changes by 2020</a></li>
<li><a href="../148958/index.html">MTS Connect: 3G router (Wi-Fi) \ WeTelecom WM-R100</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>