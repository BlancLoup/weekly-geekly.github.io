<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple Ethernet tunnel on Linux in four to six teams</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Brief cheat sheet: 


HOST1: ip link add grelan type gretap local <IP1> remote <IP2> HOST1: ip link set grelan up HOST1: iptables -I INPUT -p gre -s <...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple Ethernet tunnel on Linux in four to six teams</h1><div class="post__text post__text-html js-mediator-article">  Brief cheat sheet: <br><pre><code class="bash hljs">HOST1: ip link add grelan <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> gretap <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> &lt;IP1&gt; remote &lt;IP2&gt; HOST1: ip link <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> grelan up HOST1: iptables -I INPUT -p gre -s &lt;IP2&gt; -j ACCEPT HOST2: ip link add grelan <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> gretap <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> &lt;IP2&gt; remote &lt;IP1&gt; HOST2: ip link <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> grelan up HOST2: iptables -I INPUT -p gre -s &lt;IP1&gt; -j ACCEPT</code> </pre> <br><br>  Four commands on the tunnel and two on the firewall (not needed if traffic between their servers is already allowed) <br>  This is all that is needed, further a long explanation with details. <br><a name="habracut"></a><br><br>  When you need to combine several computers into a pseudo-local network via the Internet, this is often solved by configuring OpenVPN. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The solution works well, but not without flaws: <br>  1. You need to install additional software and configure it.  And from the first time it is not very easy to set up - you need to sit and pick it. <br>  2. Traffic encryption occurs in user mode and introduces additional delays, this is not always important, but it can be noticeable for IP-telephony. <br>  3. Encryption is not always necessary.  For example, in my case, all connections are already secure (ssh), I just need a convenient flat addressing between several computers as if they are connected to a local network. <br><br>  In Linux, GRE tunnels are configured to obscenely simple (if no encryption is needed), from Linux requirements and on public IP to each. <br>  On the Internet, information on this topic is somehow vanishingly small - basically IP (and not ethernet) tunnels are explained and immediately along with traffic encryption (which is not always necessary).  man ip is also very extensive and information on <br><br>  Suppose we have two hosts: <br>  HOST1 with external address 1.2.3.4 <br>  HOST2 with external address 2.3.4.5 <br><br>  I want to make an ethernet network between them, well, for example, you can configure IP addresses 192.168.0.1 192.168.0.2 on top of it, but you can also use any other IPv6 or anything else - you get a normal network through a switch. <br><br>  All commands are executed from ROOT, after a reboot they are lost.  In order not to get lost, you need to register commands in startup scripts or in configs (each distribution has its own). <br><br>  1. Add a virtual network gateway card to HOST1: <br><pre> <code class="bash hljs">HOST1: ip link add grelan <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> gretap <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> 1.2.3.4 remote 2.3.4.5</code> </pre><br>  On HOST1, it will look like a regular network card - you can assign IP addresses, start a DHCP server, enable it in Bridge, etc. <br><br>  2. Include added map <br><pre> <code class="bash hljs">ip link <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> grelan up</code> </pre><br><br>  2. If IP tables are running - enable GRE traffic <br><pre> <code class="bash hljs">HOST1: iptables -I INPUT -p gre -s 2.3.4.5 -j ACCEPT</code> </pre><br><br>  3. Symmetric configuration on the second host: <br><pre> <code class="bash hljs">HOST2: ip link add grelan <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> gretap <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> 2.3.4.5 remote 1.2.3.4 HOST2: ip link <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> grelan up HOST2: iptables -I INPUT -p gre -s 1.2.3.4 -j ACCEPT</code> </pre><br><br>  At this point, the ethernet network is already running.  To verify this, you can configure private IP-addresses on each side of the tunnel and let pings. <br><pre> <code class="bash hljs">HOST1: ip addr add 192.168.0.1/24 HOST2: ip addr add 192.168.0.2/24</code> </pre><br><br>  you can ping. <br><pre> <code class="bash hljs">root@ubuntu:~<span class="hljs-comment"><span class="hljs-comment"># ping 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_req=1 ttl=64 time=2.45 ms 64 bytes from 192.168.0.1: icmp_req=2 ttl=64 time=1.19 ms 64 bytes from 192.168.0.1: icmp_req=3 ttl=64 time=2.45 ms</span></span></code> </pre><br><br>  For pings, you may also have to add rules in iptables (or turn it off altogether for the duration of the experiments). <br><br>  The tunnel is quietly configured between different versions of linux, while writing this post one end was on ubuntu, the second on centos, there is absolutely no difference in the settings. <br><br>  I repeat - this tunnel does not provide any protection against listening / embedding traffic. </div><p>Source: <a href="https://habr.com/ru/post/227859/">https://habr.com/ru/post/227859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227847/index.html">Moto 360: smart and beautiful watch from Motorola</a></li>
<li><a href="../227849/index.html">ELibrary Record Manager</a></li>
<li><a href="../227853/index.html">Develop mobile javascript MVC applications with Framework7, RequireJS and Handlebars</a></li>
<li><a href="../227855/index.html">The best way to store a large number of files on the server</a></li>
<li><a href="../227857/index.html">Gamma, ColorMapping and LinearWorkflow</a></li>
<li><a href="../227861/index.html">OpenUI5 - new javascript framework from SAP</a></li>
<li><a href="../227863/index.html">Xamarin. Pros and cons</a></li>
<li><a href="../227867/index.html">Bacon number and graphs</a></li>
<li><a href="../227869/index.html">Smart Home (The Beginning) - Part 1</a></li>
<li><a href="../227871/index.html">Modernization of the MegaFon portal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>