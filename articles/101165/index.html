<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are friends with XNA and WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First, I will answer the question "Why should they be friends." The answer is simple - WPF is good for user interfaces, XNA for complex 3D graphics an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are friends with XNA and WPF</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i8.fastpic.ru/big/2010/0806/8d/6104728ecabc4151e44979fa3c220f8d.png" align="left">  First, I will answer the question "Why should they be friends."  The answer is simple - WPF is good for user interfaces, XNA for complex 3D graphics and if you make a client application with a complex interface and 3D elements in it, then a bunch of XNA &amp; WPF is just for you. <br>  I will illustrate the article on the example of a simple media player that I am writing now. <br><a name="habracut"></a><br>  So, we have a cover scroller written in XNA.  It looks like this: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Hc3kKE8nzSg%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhkpCwvhI6c3WGUKUf30RpHBqGeQg" frameborder="0" allowfullscreen=""></iframe><br><br>  We also have a WPF project for a future media player, here‚Äôs a screenshot of it: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href=""><img src="http://i8.fastpic.ru/thumb/2010/0806/b1/7c3c15f2f3a65d34cd8a37096f9cf1b1.jpeg"></a> <br><br>  Our task is to put the first into the second.  We will do the same as we did earlier with applications on Windows Forms: pass the handle to the control of the Game class to the control on top of which we will draw.  But there is one small problem: in WPF, only windows have handles.  However, this problem is easily solved: add a Windows FormsHost control to the window and place the panel (Panel) from the System.Windows.Forms namespace into it.  And here we will transfer the handle of this panel to the game designer.  So, we act in order: <br><ol><li>  Combine XNA and WPF projects in one solution </li><li>  We delete the Program.cs file from the XNA project and in the project properties we change the type from the Windows application to the class library. </li><li>  Add Microsoft.Xna.Framework.Game to the WPF project References </li><li>  Add the IntPtr handle parameter to the game constructor declaration </li><li>  In the WPF form constructor, create an instance of the game class and pass it the handle to the panel and call the Run () method on the game in a separate thread </li><li>  During the initialization of the device, assign our handle </li></ol><br>  I will explain the last point: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#2B91AF">IntPtr</font> Handle; <br> <font color="#0000ff">public</font> MainGame( <font color="#2B91AF">IntPtr</font> handle) <br> { <br> Handle = handle; <br> graphics = <font color="#0000ff">new</font> GraphicsDeviceManager( <font color="#0000ff">this</font> ); <br> graphics.PreparingDeviceSettings += <font color="#0000ff">new</font> EventHandler&lt;PreparingDeviceSettingsEventArgs&gt;(PreparingDeviceSettings); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> PreparingDeviceSettings( <font color="#0000ff">object</font> sender, PreparingDeviceSettingsEventArgs e) <br> { <br> e.GraphicsDeviceInformation.PresentationParameters.DeviceWindowHandle = Handle; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Great, our ‚Äúgame‚Äù is drawn into the panel reserved for it, but there are a few points that this solution does not suit me: <br><ul><li>  When you start the application in parallel, some kind of left window is created.  Of course, you can hide it, but still this is not good. </li><li>  When resizing the form, we have a blunt stretching / compression of the image.  I would like to re-initialize the device to ensure the best picture quality. </li><li>  In my opinion, the most important thing: the game and the application live in different streams.  This leads to errors when trying to work with WPF controls from XNA code. </li><li>  The panel blinks when changing its size. </li></ul><br>  We will solve these problems.  For this, I propose to stop using the game class and write a small device manager.  We will have to manually initialize the device, repaint the scene by timer, respond to the resizing of the control and its destruction.  We transfer the control to the manager, on which we will draw, subscribe to the resize and draw control events, create a device and a timer, according to which we will trigger the Update and Draw events.  You can view the source code of the graphical manager <a href="http://pastebin.com/9MqE7a0y">here</a> or in the attached project.  We just have to deal with the panel.  It turns out you just need to apply the appropriate styles and the panel will stop blinking.  The only inconvenience is that the access modifier of the SetStyle method is protected.  Well, nothing, inherit from the panel and in the designer apply the styles we need.  The source code of the optimized panel is simple to disgrace: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> OptimizedPanel : Panel <br> { <br> <font color="#0000ff">public</font> OptimizedPanel() <br> : <font color="#0000ff">base</font> () <br> { <br> <font color="#0000ff">this</font> .SetStyle(ControlStyles.UserPaint, <font color="#0000ff">true</font> ); <br> <font color="#0000ff">this</font> .SetStyle(ControlStyles.Opaque, <font color="#0000ff">true</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  So, everything is ready with us, we start the project and see that everything works as it should: the panel does not blink, the dimensions change correctly, the application does not open additional windows. <br>  <a href="http://ifolder.ru/18802445">Here</a> you can download the initial draft application with a bunch of WPF &amp; XNA.  Well, that's what happened with me: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/89OlLBrGaQo%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhghzraEKsyHvnV2vESuMkzPFhgpRw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/101165/">https://habr.com/ru/post/101165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101157/index.html">Habranayez to Peter this weekend</a></li>
<li><a href="../101159/index.html">Trends in online video and traditional TV</a></li>
<li><a href="../101160/index.html">Google Books has determined the total number of titles in the world.</a></li>
<li><a href="../101163/index.html">New Hotmail Review</a></li>
<li><a href="../101164/index.html">How long does ‚Äúlive‚Äù live?</a></li>
<li><a href="../101169/index.html">Duty-free shipment of overseas parcels worth up to 1000 Euro works!</a></li>
<li><a href="../101170/index.html">Ubuntu 10.10 Maverick Meerkat Alpha 3 released</a></li>
<li><a href="../101172/index.html">I sit high, look away, I watch over the Internet</a></li>
<li><a href="../101173/index.html">Why social networks turn your business around</a></li>
<li><a href="../101178/index.html">Playnatic Report from ChinaJoy 2010 and China GDC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>