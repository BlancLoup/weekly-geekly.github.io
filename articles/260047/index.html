<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interesting notes on C # and CLR (v2.0)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's time to lay out the second part of the notes on .NET. 

 The configuration file takes revenge. 
 * .CONFIG - can you really ask any application? ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interesting notes on C # and CLR (v2.0)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8de/186/c75/8de186c756754226b5df4d1de4ecf784.png"><br><br>  It's time to lay out the second part of the notes on .NET. <br><a name="habracut"></a><br>  The configuration file takes revenge. <br>  * .CONFIG - can you really ask any application? <br><br><div class="spoiler">  <b class="spoiler_title">Tyts</b> <div class="spoiler_text">  I launch the well-known utility from Mark R. ‚ÄúProcmon.exe‚Äù, then my test window application and immediately close, stop collecting events.  I filter in the received log my application by name (Include).  This is what it shows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>)   config: <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">36.0364337</span></span> WindowsFormsApplication1.exe <span class="hljs-number"><span class="hljs-number">7388</span></span> QueryOpen S:\WindowsFormsApplication1.exe.config NAME NOT FOUND <span class="hljs-number"><span class="hljs-number">2</span></span>)   INI: <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">36.0366595</span></span> WindowsFormsApplication1.exe <span class="hljs-number"><span class="hljs-number">7388</span></span> QueryOpen S:\WindowsFormsApplication1.INI NAME NOT FOUND <span class="hljs-number"><span class="hljs-number">3</span></span>)   Local: <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">36.0537481</span></span> WindowsFormsApplication1.exe <span class="hljs-number"><span class="hljs-number">7388</span></span> QueryOpen S:\WindowsFormsApplication1.exe.Local NAME NOT FOUND</code> </pre> <br><br>  Accidentally discovered that <a href="http://en.community.dell.com/techcenter/powergui/m/bits/20439049">PowerGUI</a> uses the configuration file for PowerShell scripts that are compiled into EXE (you can even password-protect or immediately make the service). <br>  The files themselves: Untitled.exe and Untitled.exe.config. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useLegacyV2RuntimeActivationPolicy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sku</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".NETFramework,Version=v4.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v2.0.50727"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">runtime</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loadFromRemoteSources</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">runtime</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  .INI - can tell the JIT compiler that the build does not need to be optimized.  So in Release, you can optimize MSIL, and JIT is already managed through this file, without using two different builds. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">.NET Framework Debugging Control</span></span>] GenerateTrackinglnfo = <span class="hljs-number"><span class="hljs-number">1</span></span> AllowOptimize = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  .Local - <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms682600(v%3Dvs.85).aspx">Dynamic-Link Library Redirection</a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Joke from john robbins</b> <div class="spoiler_text">  There is another place where the process looks. <br>  HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ Current Version \ Image File Execution Options \ <br><br>  Create a registry key MyApp.EXE and inside it a new string value Debugger, in which we specify the full path to the debugger (if it were), we write calc.exe. <br><br>  Now, when you try to run MyApp.EXE, the calculator will actually run. <br></div></div><br>  1) A bit of C # history <br><div class="spoiler">  <b class="spoiler_title">What was added in different versions</b> <div class="spoiler_text">  C # 2.0 <br>  Generalizations, null-tolerant types, anonymous methods and delegate improvements, iterative yield blocks.  Partial types, static classes, properties with different access modifiers, namespace aliases (locally using WinForms = System.Windows.Forms; globally -FirstAlias ‚Äã‚Äã:: Demo and SecondAlias ‚Äã‚Äã:: Demo), pragma directives, fixed-size buffers in unsafe code ( fixed byte data [20]). <br><br>  C # 3.0 <br>  LINQ, automatic properties, implicit typing of arrays and local variables, initializers of objects and collections in the place of declaration, anonymous types.  Lambda expressions and expression trees, extending methods, partial methods. <br><br>  C # 4.0 <br>  Named arguments, optional parameters, generic variant, type dynamic. <br><br>  C # 5.0 <br>  Async / Await, change in foreach loop, attributes information about the calling component. <br></div></div><br><br>  2) The minimum size of an instance of a reference type in memory. <br><div class="spoiler">  <b class="spoiler_title">For x86 and x64</b> <div class="spoiler_text">  Create an empty class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyClass</span></span> { }</code> </pre><br>  I compile to 32 bits, find out the size in Windbg: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">005</span></span>&gt; !<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-number"><span class="hljs-number">023849b</span></span>c Name: ConsoleApplication1.MyClass MethodTable: <span class="hljs-number"><span class="hljs-number">006</span></span>c39d4 EEClass: <span class="hljs-number"><span class="hljs-number">006</span></span>c1904 Size: <span class="hljs-number"><span class="hljs-number">12</span></span>(<span class="hljs-number"><span class="hljs-number">0xc</span></span>) bytes -   . File: E:\...\ConsoleApplication1.exe Fields: None</code> </pre><br>  I compile to 64 bits: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-number"><span class="hljs-number">0000007</span></span>c8d8465b8 Name: ConsoleApplication1.MyClass MethodTable: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4320 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d2548 Size: <span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-number"><span class="hljs-number">0x18</span></span>) bytes File: E:\...\ConsoleApplication1.exe Fields: None</code> </pre><br>  Less will not be because the first 4 or 8 bytes - the word of the object header.  It is used for synchronization, storage of service information of the garbage collector, finalization, storage of the hash code.  Some bits of this field determine what information is stored in it at any given time. <br>  The second 4 or 8 bytes - a link to the method table. <br>  The third 4 or 8 bytes for data and alignment, even if they have nothing. <br>  Total minimum size of an instance of the reference type for x86 - 12 bytes, x64 - 24 bytes. <br></div></div><br><br>  3) Non-static fields and class instance methods in memory (x64). <br><div class="spoiler">  <b class="spoiler_title">Now add one field and auto-property</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyClass</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _field1 = <span class="hljs-string"><span class="hljs-string">"Some string 1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Field2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  IL see two fields: <br><pre> <code class="cs hljs">.field <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;Field2&gt;k__BackingField'</span></span> .field <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _field1</code> </pre><br>  And two methods: <br><pre> <code class="cs hljs">.<span class="hljs-function"><span class="hljs-function">method </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> hidebysig specialname instance </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_Field2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) cil managed .method </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> hidebysig specialname instance </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_Field2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'value'</span></span></span></span></span><span class="hljs-function">) cil managed</span></span></code> </pre><br>  Let's see who got where: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-number"><span class="hljs-number">0000005400006600</span></span> Name: ConsoleApplication1.MyClass MethodTable: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4378 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d2548 Size: <span class="hljs-number"><span class="hljs-number">32</span></span>(<span class="hljs-number"><span class="hljs-number">0x20</span></span>) bytes File: E:\...\ConsoleApplication1.exe Fields: MT Field Offset Type VT Attr Value Name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000002</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> instance <span class="hljs-number"><span class="hljs-number">0000005400006620</span></span> _field1 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000003</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> instance <span class="hljs-number"><span class="hljs-number">00000054000035</span></span>a0 &lt;Field2&gt;k__BackingField</code> </pre><br><br>  The fields got directly to the instance, and affected its minimum size (32 because from 17 to 24 bits the first link occupied (previously they were empty), and 25-32 the second (to preserve the order of their sequence is an attribute). But the methods directly in there is no copy, only a link to them, and accordingly they did not affect its size. <br><br>  Let's look at the table of methods: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !dumpmt -md <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4378 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d2548 Module: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c2fc8 Name: ConsoleApplication1.MyClass mdToken: <span class="hljs-number"><span class="hljs-number">0000000002000003</span></span> File: E:\...\ConsoleApplication1.exe BaseSize: <span class="hljs-number"><span class="hljs-number">0x20</span></span> ComponentSize: <span class="hljs-number"><span class="hljs-number">0x0</span></span> Slots <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> VTable: <span class="hljs-number"><span class="hljs-number">7</span></span> Number of IFaces <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> IFaceMap: <span class="hljs-number"><span class="hljs-number">0</span></span> -------------------------------------- MethodDesc Table Entry MethodDesc JIT Name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89ae6300 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa896980e8 PreJIT System.Object.ToString() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b2e760 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa896980f0 PreJIT System.Object.Equals(System.Object) <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b31ad0 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89698118 PreJIT System.Object.GetHashCode() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b2eb50 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89698130 PreJIT System.Object.Finalize() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6e0390 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4358 JIT ConsoleApplication1.MyClass..ctor() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5cc130 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4338 NONE ConsoleApplication1.MyClass.get_Field2() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5cc138 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5c4348 NONE ConsoleApplication1.MyClass.set_Field2(System.String)</code> </pre><br>  And here they are, both have not yet been JIT-compiled, except for the constructor and the inherited instance methods from System.Object which Ngen themselves when installing .NET. <br><br>  In conclusion of this clause, let's see the full size of the instance with the size of the objects that its fields indicate: <br><pre> <code class="cs hljs">MyClass mcClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass(); mcClass.Field2 = <span class="hljs-string"><span class="hljs-string">"Some string 2"</span></span>; <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !objsize <span class="hljs-number"><span class="hljs-number">0000005400006600</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-number"><span class="hljs-number">0000005400006600</span></span>) = <span class="hljs-number"><span class="hljs-number">144</span></span> (<span class="hljs-number"><span class="hljs-number">0x90</span></span>) bytes (ConsoleApplication1.MyClass)</code> </pre><br>  Check it out by looking at the size of the fields: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !objsize <span class="hljs-number"><span class="hljs-number">0000005400006620</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-number"><span class="hljs-number">0000005400006620</span></span>) = <span class="hljs-number"><span class="hljs-number">56</span></span> (<span class="hljs-number"><span class="hljs-number">0x38</span></span>) bytes (System.String) <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !objsize <span class="hljs-number"><span class="hljs-number">00000054000035</span></span><span class="hljs-function"><span class="hljs-function">a0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizeof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">00000054000035</span></span></span></span><span class="hljs-function"><span class="hljs-params">a0</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">56</span></span> (<span class="hljs-number"><span class="hljs-number">0x38</span></span>) bytes (System.String)</code> </pre><br>  Total: 56 + 56 + 32 = 144. <br></div></div><br><br>  4) Static field and method (x64). <br><div class="spoiler">  <b class="spoiler_title">Tyts</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyClass</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _name = <span class="hljs-string"><span class="hljs-string">"Some string"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _STR = <span class="hljs-string"><span class="hljs-string">"I'm STATIC"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImStaticMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } MyClass mcClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyClass(); Console.WriteLine(MyClass._STR);</code> </pre><br>  The minimum size of the instance (static field is not taken into account): <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c65f8 Name: ConsoleApplication1.MyClass MethodTable: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4370 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6c2550 Size: <span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-number"><span class="hljs-number">0x18</span></span>) bytes File: E:\...\ConsoleApplication1.exe Fields: MT Field Offset Type VT Attr Value Name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000002</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> instance <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c6610 _name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000003</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c35a0 _STR</code> </pre><br>  List of methods: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !dumpmt -md <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4370 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6c2550 Module: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b2fc8 Name: ConsoleApplication1.MyClass mdToken: <span class="hljs-number"><span class="hljs-number">0000000002000003</span></span> File: E:\...\ConsoleApplication1.exe BaseSize: <span class="hljs-number"><span class="hljs-number">0x18</span></span> ComponentSize: <span class="hljs-number"><span class="hljs-number">0x0</span></span> Slots <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> VTable: <span class="hljs-number"><span class="hljs-number">7</span></span> Number of IFaces <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> IFaceMap: <span class="hljs-number"><span class="hljs-number">0</span></span> -------------------------------------- MethodDesc Table Entry MethodDesc JIT Name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89ae6300 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa896980e8 PreJIT System.Object.ToString() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b2e760 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa896980f0 PreJIT System.Object.Equals(System.Object) <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b31ad0 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89698118 PreJIT System.Object.GetHashCode() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89b2eb50 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89698130 PreJIT System.Object.Finalize() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d0110 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4350 JIT ConsoleApplication1.MyClass..cctor() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d03f0 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4348 JIT ConsoleApplication1.MyClass..ctor() <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5bc130 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4338 NONE ConsoleApplication1.MyClass.ImStaticMethod()</code> </pre><br>  ConsoleApplication1.MyClass..cctor () - the static constructor was executed only because I turned to a static field.  It is also called a type constructor, and when it is exactly called is not known.  It is created automatically in the presence of static fields.  If you do not need to make any actions in it, then it is better not to prescribe it explicitly, since  this places optimization with the help of the beforefieldinit flag in the metadata.  For more information <a href="https://msdn.microsoft.com/ru-ru/library/dd335949.aspx">msdn.microsoft.com/ru-ru/library/dd335949.aspx</a> . <br><br>  Check sizes: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !objsize <span class="hljs-number"><span class="hljs-number">00000033b</span></span><span class="hljs-function"><span class="hljs-function">a2c65f8 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizeof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">00000033b</span></span></span></span><span class="hljs-function"><span class="hljs-params">a2c65f8</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">72</span></span> (<span class="hljs-number"><span class="hljs-number">0x48</span></span>) bytes (ConsoleApplication1.MyClass) <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !objsize <span class="hljs-number"><span class="hljs-number">00000033b</span></span><span class="hljs-function"><span class="hljs-function">a2c6610 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizeof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">00000033b</span></span></span></span><span class="hljs-function"><span class="hljs-params">a2c6610</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-number"><span class="hljs-number">48</span></span> (<span class="hljs-number"><span class="hljs-number">0x30</span></span>) bytes (System.String)</code> </pre><br>  Total: 24 + 48 = 72. <br>  A static field, like methods, is not stored as a copy in each instance. <br></div></div><br><br>  5) Find the parent and who keeps the copy from garbage collection. <br><div class="spoiler">  <b class="spoiler_title">For heap</b> <div class="spoiler_text">  Data and addresses from 3 points. <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !dumpclass <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6c2550 Class Name: ConsoleApplication1.MyClass mdToken: <span class="hljs-number"><span class="hljs-number">0000000002000003</span></span> File: E:\...\ConsoleApplication1.exe Parent Class: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89684908 Module: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b2fc8 Method Table: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4370 Vtable Slots: <span class="hljs-number"><span class="hljs-number">4</span></span> Total Method Slots: <span class="hljs-number"><span class="hljs-number">6</span></span> Class Attributes: <span class="hljs-number"><span class="hljs-number">100000</span></span> Transparency: Critical NumInstanceFields: <span class="hljs-number"><span class="hljs-number">1</span></span> NumStaticFields: <span class="hljs-number"><span class="hljs-number">1</span></span> MT Field Offset Type VT Attr Value Name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000002</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> instance _name <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d60e08 <span class="hljs-number"><span class="hljs-number">4000003</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> System.String <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c35a0 _STR</code> </pre><br>  We go to the parent: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !dumpclass <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89684908 Class Name: System.Object mdToken: <span class="hljs-number"><span class="hljs-number">0000000002000002</span></span> File: C:\WINDOWS\Microsoft.Net\assembly\GAC_64\mscorlib\v4<span class="hljs-number"><span class="hljs-number">.0</span></span>_4<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>__b77a5c561934e089\mscorlib.dll Parent Class: <span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> -  . Module: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89681000 Method Table: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa89d613e8 Vtable Slots: <span class="hljs-number"><span class="hljs-number">4</span></span> Total Method Slots: a Class Attributes: <span class="hljs-number"><span class="hljs-number">102001</span></span> Transparency: Transparent NumInstanceFields: <span class="hljs-number"><span class="hljs-number">0</span></span> NumStaticFields: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Who holds mcClass = new MyClass (): <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">003</span></span>&gt; !gcroot <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c65f8 Thread <span class="hljs-number"><span class="hljs-number">3310</span></span>: <span class="hljs-number"><span class="hljs-number">00000033b</span></span>81fedb0 <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6d031f ConsoleApplication1.Program.Main rbx: -&gt; <span class="hljs-number"><span class="hljs-number">00000033b</span></span>a2c65f8 ConsoleApplication1.MyClass</code> </pre><br>  It looks like the truth. <br></div></div><br><br>  6) Who is Foreach. <br><div class="spoiler">  <b class="spoiler_title">Tyts</b> <div class="spoiler_text">  1. Using foreach creates a hidden local variable - a loop iterator. <br><br>  2. The foreach statement automatically calls Dispose () at the end of the loop if the IDisposable interface has been implemented. <br><br>  3. Compiled into a call to the GetEnumerator (), MoveNext () methods and a call to the Current property. <br><br>  4. Foreach, like yield return, LINQ is a lazy iteration, very useful when, for example, we read a multi-gigabyte file one line at a time, saving memory. <br><br>  5. Foreach for an array uses its Length property and an array indexer, rather than creating an iterator object. <br><br>  6. In C # 5, the captured variables inside the foreach loops are now working correctly, while C # 3 and C # 4 capture only one instance of the variable (the last one). <br></div></div><br><br>  7) LINQ <br><div class="spoiler">  <b class="spoiler_title">Klats</b> <div class="spoiler_text">  1. LINQ to Object is executed in JIT as normal delegates (in-process query), LINQ to SQL builds an expression tree and executes it already in SQL, or any other medium.  The tree can be translated to delegates. <br><br>  2. OrderBy for LINQ to Objects requires loading all data. <br><br>  3. When using Join () in LINQ to Objects, the right sequence is buffered, but for the left one a stream is organized, so if you want to connect a large sequence with a small one, then it is useful to specify the small sequence as right if possible. <br><br>  4. EnumType.Select (x =&gt; x) - this is called a degenerate query expression, the result is just a sequence of elements and not the source itself, it can be important from the point of view of data integrity.  (Valid for properly designed LINQ data providers.) <br></div></div><br><br>  8) Collections. <br><div class="spoiler">  <b class="spoiler_title">Cry</b> <div class="spoiler_text">  List T - internally stores an array.  Adding a new element is either setting a value in the array, or copying an existing array into a new one, which is twice as large (undocumented) and then setting the value.  Removing an item from List T requires copying the items behind it to a position backward.  By the RemoveAt () index, remove significantly faster than by the Remove () value (each element is compared wherever it is). <br><br>  Arrays are always fixed in size, but changeable in terms of elements. <br><br>  LinkedList T - linked list, allows you to quickly delete, insert new items, there is no index, but the passage on it remains effective. <br><br>  ReadOnlyDictionary is just a wrapper that hides all mutable operations behind an explicit interface implementation.  You can change items through the collection passed on to its base. <br></div></div><br><br>  9) Optional method parameters. <br><div class="spoiler">  <b class="spoiler_title">Spoiler!</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x </span></span></span><span class="hljs-function">)</span></span> { x = <span class="hljs-number"><span class="hljs-number">5</span></span>; } IL: .<span class="hljs-function"><span class="hljs-function">method </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> hidebysig instance </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">int32 x</span></span></span><span class="hljs-function">) cil managed</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Code size 4 (0x4) .maxstack 8 IL_0000: ldc.i4.5 IL_0001: starg.sx IL_0003: ret } // end of method TestClass::Method1 void Method ( int x = 5 ) { } IL: .method private hidebysig instance void Method([opt] int32 x) cil managed { .param [1] = int32(0x00000005) // Code size 1 (0x1) .maxstack 8 IL_0000: ret } // end of method TestClass::Method</span></span></code> </pre><br>  int x is a constant.  And the constants are stored directly in the metadata, and it means that to change them, you must recompile all the code using this method.  (2 source, page 413.) <br><br>  Starting in C # 4, renaming method parameters can affect other code if it uses named arguments. <br></div></div><br><br>  10) Optimization of applications on the .NET platform <br><div class="spoiler">  <b class="spoiler_title">hacer clic</b> <div class="spoiler_text">  1. <a href="https://technet.microsoft.com/ru-ru/library/dd744567(v%3Dws.10).aspx">Performance counters</a> . <br>  Counters are updated no more than several times per second, while the Performance Monitor itself does not allow reading the values ‚Äã‚Äãof the counters more often than once per second. <br><br>  2. <a href="https://msdn.microsoft.com/ru-ru/library/windows/desktop/aa363668(v%3Dvs.85).aspx">Event Tracing for Windows ETW</a> . <br>  This is a high-performance event registration framework. <br><br>  Read ETW events: <br>  a) <a href="https://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D39982">Windows Performance Toolkit</a> . <br>  b) <a href="http://bcl.codeplex.com/wikipage%3Ftitle%3DPerfMonitor%26referringTitle%3DHome">PerfMonitor</a> .  (open project CLR team at Microsoft.) <br>  c) <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D28567">PerfView</a> .  (Microsoft's free combine.) <br><br>  3. Memory profiler (besides VS built-in) <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D16273">CLR Profiler</a> . <br>  It can connect to existing processes (CLR 4.0 or lower) or start new ones, collect all memory allocation and garbage collection events.  Builds a bunch of graphs. <br><br>  <a href="https://msdn.microsoft.com/ru-ru/library/ee329530.aspx">Common templates for malfunctioning multi-threaded applications</a> . <br></div></div><br><br>  11) Synchronization. <br><div class="spoiler">  <b class="spoiler_title">Tyk</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> ( obj ) { }</code> </pre><br>  It is carried out only on demand, time-consuming.  The CLR creates the ‚Äúsync block‚Äù structure in the global ‚Äúsync block table‚Äù array, it has a backward reference to the object that owns the lock on a weak link (for recyclability) and another link to the monitor implemented on Win32 events.  The numeric index of the sync block is stored in the title word of the object.  If the synchronization object has been disposed of, its connection with the synchronization unit is erased for reuse on another object. <br><br>  But not everything is so simple, there is still a thin lock (thin lock).  If the synchronization block has not been created yet and only one thread owns the object, another one will try to wait for a short time when the owner information disappears from the object title word, if this does not happen, then a thin lock will be converted to the normal one. <br></div></div><br><br>  12) Packaging. <br><div class="spoiler">  <b class="spoiler_title">Package Nnada</b> <div class="spoiler_text">  We have structure: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Point { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y; } List&lt;Point&gt; polygon = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Point&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10000000</span></span>; i++ ) { polygon.Add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point() { X = rnd.Next(), Y = rnd.Next() } ); } Point point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point { X = <span class="hljs-number"><span class="hljs-number">5</span></span>, Y = <span class="hljs-number"><span class="hljs-number">7</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> contains = polygon.Contains( point );</code> </pre><br>  We are launching number 1. <br><br>  Now add the methods: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (X &amp; Y) ^ X; <span class="hljs-comment"><span class="hljs-comment">//  . } public override bool Equals( object obj ) { if ( !( obj is Point ) ) return false; Point other = ( Point ) obj; return X == other.X &amp;&amp; Y == other.Y; } public bool Equals( Point other ) { return X == other.X &amp;&amp; Y == other.Y; }</span></span></code> </pre><br>  We are launching number 2. <br><br>  Now add the interface implementation (there is already a suitable method): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Point : IEquatable&lt;Point&gt; { ... }</code> </pre><br>  We are launching number 3. <br>  (List T has no IEquatable T interface implementation) <br><br>  Try anonymous type: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Prop1 = <span class="hljs-number"><span class="hljs-number">2</span></span>, Prop2 = <span class="hljs-number"><span class="hljs-number">80000</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = Enumerable.Range( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10000000</span></span> ) .Select( i =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Prop1 = i, Prop2 = i+i } ) .ToList(); items.Contains(someType);</code> </pre><br>  We are launching number 4. <br>  The compiler found out that the type of someType is identical to the type in extension methods, and therefore there were no problems. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Results</b> <div class="spoiler_text">  Test results: <br><img src="https://habrastorage.org/files/d9f/8b8/39b/d9f8b839b56c490a8c18ba3014b79b58.png"><br><br>  And this is what an anonymous type looks like in IL: <br><img src="https://habrastorage.org/files/0cd/542/b1b/0cd542b1b71f4ed8b0042fe515720bf4.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">If you are wondering what someType looks like in memory</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { Prop1 = <span class="hljs-number"><span class="hljs-number">2</span></span>, Prop2 = <span class="hljs-number"><span class="hljs-number">80000</span></span> }; <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">005</span></span>&gt; !<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-number"><span class="hljs-number">0000008</span></span>da2745e08 Name: &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[System.Int32, mscorlib],[System.Int32, mscorlib]] MethodTable: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4238 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6c2548 Size: <span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-number"><span class="hljs-number">0x18</span></span>) bytes File: E:\...\BoxingUnboxingPointList.exe Fields: MT Field Offset Type VT Attr Value Name <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">4000003</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> System.Int32 <span class="hljs-number"><span class="hljs-number">1</span></span> instance <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;Prop1&gt;i__Field <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">4000004</span></span> c System.Int32 <span class="hljs-number"><span class="hljs-number">1</span></span> instance <span class="hljs-number"><span class="hljs-number">80000</span></span> &lt;Prop2&gt;i__Field</code> </pre><br>  The type of value stores the most value - 2 and 80,000. <br><br>  Method table: <br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">005</span></span>&gt; !dumpmt -md <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b4238 EEClass: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b6c2548 Module: <span class="hljs-number"><span class="hljs-number">00007f</span></span>fa2b5b2fc8 Name: &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[System.Int32, mscorlib],[System.Int32, mscorlib]] mdToken: <span class="hljs-number"><span class="hljs-number">0000000002000004</span></span> File: E:\...\BoxingUnboxingPointList.exe BaseSize: <span class="hljs-number"><span class="hljs-number">0x18</span></span> ComponentSize: <span class="hljs-number"><span class="hljs-number">0x0</span></span> Slots <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> VTable: <span class="hljs-number"><span class="hljs-number">7</span></span> Number of IFaces <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> IFaceMap: <span class="hljs-number"><span class="hljs-number">0</span></span> -------------------------------------- MethodDesc Table Entry MethodDesc JIT Name <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]].ToString() <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]].Equals(System.Object) <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]].GetHashCode() <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> PreJIT System.Object.Finalize() <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]]..ctor(Int32, Int32) <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]].get_Prop1() <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>.<span class="hljs-number"><span class="hljs-number">.8</span></span> NONE &lt;&gt;f__AnonymousType0`<span class="hljs-number"><span class="hljs-number">2</span></span>[[...]].get_Prop2()</code> </pre><br>  I also expected to see more :) <br></div></div><br><br>  13) Async / Await <br><div class="spoiler">  <b class="spoiler_title">Inside it is bigger</b> <div class="spoiler_text">  Async - has no representation in the generated code. <br>  Await - state machine, structure.  If by the time of this type of meeting the result of the work is already available, the method will continue to work with the result obtained in a synchronous mode.  The <a href="https://msdn.microsoft.com/ru-ru/library/hh194876(v%3Dvs.110).aspx">Task TResult.ConfigureAwait</a> method with a value of true will attempt to marshal the continuation back to the original captured context, if this is not required, we use the value false. <br><br>  <a href="https://www.youtube.com/watch%3Fv%3Dfi_N_ghu4Ug">Excellent free video lesson on this topic from Alexander.</a> <br><br>  It is also very good to read the translation of the article " <a href="http://habrahabr.ru/post/232169/">SynchronizationContext - when MSDN fails</a> ." <br></div></div><br><br>  14) Garbage Collection <br><div class="spoiler">  <b class="spoiler_title">Tyk</b> <div class="spoiler_text">  If you play with the fixed objects in the generation "0", then the CLR can declare this generation older, and select a new one for yourself. <br><br>  The generation ‚Äú1‚Äù can only be reached from ‚Äú0‚Äù, objects having finalization will definitely be in it. <br><br>  The size of generation ‚Äú2‚Äù is not artificially limited, all available memory is used (which Windows can share with the CLR), but the GC does not wait for it to be completely filled, but uses threshold values ‚Äã‚Äã(which I don‚Äôt know). <br><br>  In the marking phase, an object marked as live may lose its link, thus surviving one assembly. <br><br>  Objects larger than 85 KB fall into the Large Object Heap, but this refers to one object and not its graph (included objects).  Associated with the generation of "2", get together. <br></div></div><br><br>  Sources: <br>  1) John Robbins "Debugging Applications for Microsoft .NET and Microsoft Windows." <br>  2) John Skit "C # for Professionals. Programming Subtleties", 3rd edition. <br>  3) Sasha Goldstein, Dima Zurbalev, Ido Flatov ‚ÄúApplication Optimization on the .Net Platform‚Äù. <br><br>  A lot of letters turned out, the JIT compiler remains for later. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/260047/">https://habr.com/ru/post/260047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260027/index.html">Passing Stored Arguments to a Function</a></li>
<li><a href="../260029/index.html">Detector of UI locks in WPF with notification</a></li>
<li><a href="../260031/index.html">Windows and Mac OS Integration with Acronis Access Connect</a></li>
<li><a href="../260033/index.html">Is it true that Go is faster than Ruby?</a></li>
<li><a href="../260045/index.html">Material Design and Search by the example of a reference application</a></li>
<li><a href="../260049/index.html">One of the features of PHP related to methods and functions</a></li>
<li><a href="../260053/index.html">How to bind Docker containers without forcing the application to read environment variables</a></li>
<li><a href="../260061/index.html">Development of modular C / C ++ applications using annotations</a></li>
<li><a href="../260065/index.html">NGINX inside: born for performance and scaling</a></li>
<li><a href="../260067/index.html">Reactive User Interface Programming in Jancy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>