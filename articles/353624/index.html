<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript java what's the difference now</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past, JPoint promised to write an article about using GraalVM to mix Java and JS. Here she is. 


 What is the problem? In everyday practice, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript java what's the difference now</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/7e/jm/t6/7ejmt6kx631lotx-5er9bkz6na4.png"><br></p><br><p>  <a href="https://jpoint.ru/talks/6zcfkzjjyia4iwekogeae0/">In the past, JPoint</a> promised to write an article about using GraalVM to mix Java and JS.  Here she is. </p><br><p>  What is the problem?  In everyday practice, applications are often found that consist of two parts: a JavaScript front end and a Java backend.  The organization of interop between them requires effort.  As a rule, they are made by people from different sides of the barricades, and when they try to get into a foreign area, they start to suffer.  There is still a full stack of web developers, but everything is clear about them: they must always suffer. </p><br><p>  In this article, we will look at a new technology that can make the process a bit less painful.  More precisely, there is a way for a long time, but somehow passed by the attention of the masses. </p><a name="habracut"></a><br><p>  If one of the javistes has not yet written on React, then there will be a tutorial allowing it to be done.  If one of the Java scripters did not try to write in Java, then in the same tutorial you will be able to touch it (albeit with just one line and through the JS bindings). </p><br><h1 id="js-java-tryahnem-starinoy-nashorn">  JS-&gt; Java.  We shake old: Nashorn </h1><br><p>  If you want interop Java-&gt; JS, this technology in the JDK was a long time ago, and it is called Nashorn (read: "Nashorn"). </p><br><p>  Let's take some real situation.  People from time to time, from year to year, continue to write "server" validators in Java and "client" validators in JS.  The special cynicism here is that checks often coincide by 80%, and all this activity, in fact, is a special form of ineptly wasted time. </p><br><p>  Imagine that we have a very stupid validator: </p><br><pre><code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (target &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"success"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"fail"</span></span>; } };</code> </pre> <br><p>  We can run it on all three platforms: </p><br><ul><li>  Browser </li><li>  Node.js </li><li>  Java </li></ul><br><p>  In a browser, this is trivial.  Just embed this piece of code anywhere, and it works. </p><br><p>  In Node.js, you must either respect their feng shui by using require, or hack it to hell with such simple code: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vm'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> includeInThisContext = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = fs.readFileSync(path); vm.runInThisContext(code, path); }.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); includeInThisContext(__dirname + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + filename);</code> </pre> <br><p>  I have a ready-made example <a href="https://github.com/olegchir/node-shared-example">on GitHub</a> . </p><br><p>  Get ready for the fact that if you use these techniques, then pretty soon colleagues can begin to consider you a stuffed animal.  We, javistam - are no strangers, but professional javascripters can be embarrassed. </p><br><p>  Now it's all the same, but near Nashorno in Java. </p><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSExecutor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger logger = LoggerFactory.getLogger(JSExecutor.class); ScriptEngine engine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScriptEngineManager().getEngineByName(<span class="hljs-string"><span class="hljs-string">"nashorn"</span></span>); Invocable invoker = (Invocable) engine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JSExecutor() { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { File bootstrapFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassPathResource(<span class="hljs-string"><span class="hljs-string">"validator.js"</span></span>).getFile(); String bootstrapString = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(Files.readAllBytes(bootstrapFile.toPath())); engine.<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(bootstrapString); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { logger.error(<span class="hljs-string"><span class="hljs-string">"Can't load bootstrap JS!"</span></span>, e); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object execute(String code) { Object result = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = engine.<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(code); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { logger.error(<span class="hljs-string"><span class="hljs-string">"Can't run JS!"</span></span>, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object executeFunction(String name, Object... args) { Object result = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = invoker.invokeFunction(name, args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { logger.error(<span class="hljs-string"><span class="hljs-string">"Can't run JS!"</span></span>, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre> <br><p>  I <a href="https://github.com/olegchir/nashorn-shared-example">also have</a> this example <a href="https://github.com/olegchir/nashorn-shared-example">on GitHub</a> . </p><br><p>  As you can see, you can pull an arbitrary code, or a separate function by its name. </p><br><p>  There are, of course, such problems that can be solved only manually.  For example, you can concoct a polyfill like this: </p><br><pre> <code class="hljs coffeescript">var <span class="hljs-built_in"><span class="hljs-built_in">global</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; var <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; var process = {env:{}}; var <span class="hljs-built_in"><span class="hljs-built_in">console</span></span> = {}; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.debug = <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log = <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.warn = <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error = <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>;</code> </pre> <br><p>  If you want the validator code to be perfectly identical both on the server and on the client, you will have to write stubs for ‚Äúserver‚Äù methods, which are pushed only into the browser.  These are details of a specific implementation. </p><br><p>  By the way, <code>ab</code> on my laptop ( <code>ab -k -c 10 -n 100 http://localhost:3000/?id=2</code> ) shows 6-7 thousand requests per second to this code, and it doesn't matter what it is running on - on Nashorn or Node.js.  But there is nothing interesting in this: firstly, <code>ab</code> on localhost measures weather on Mars, and secondly, we both believe that there are no obvious mistakes in these engines, they are competitors. </p><br><p>  It is clear that if you live in the ‚Äúred zone‚Äù of the curve named after Sh., You cannot use Nashorn without turning on the brain and writing benchmarks.  If you think carefully, you can write a benchmark where Nashorn will sink, and it would be more correct to write native code.  But we must clearly understand that the world is not limited to the highload and performance themes, sometimes the convenience of writing is more important than any performance. </p><br><h1 id="java-js-problema">  Java-&gt; JS.  Problem </h1><br><p>  Let's try to push the data in the opposite direction, from Java to JS. </p><br><p>  Why it may be necessary? </p><br><p>  First, and most importantly, in many companies, there is a non-negotiable axiom: we use Java.  In some banks.  Secondly, in the course of solving everyday problems such problems arise constantly. </p><br><p>  Consider a real-life toy case.  Imagine: you need to generate a front webpack, and you want to write in the upper right corner of the web page the current version of the application.  It is likely that the version of the backend can be pulled out in a normal way only by calling up some kind of java code (the same).  So, you need to create such a Maven project that will work in two passes: nail to the Maven Build Lifecycle phase the assembly of a pair of classes and their launch, which will generate the properties file with the version number, which in the next phase will be picked up manually by npm. </p><br><p>  I will not give an example of such pom.xml here, because it is disgusting :) </p><br><p>  More globally, the problem is that modern culture supports and encourages polyglot programmers and projects written in many languages.  From this arise the following points: </p><br><ul><li>  Developers want to use the language that is most suitable for the problem being solved.  It is very painful to write a web interface to Java (at least until the JVM and OpenJDK stabilize on WebAssembly), and on JS it is easy and convenient. </li><li>  Often you want to simultaneously develop several code bases.  For example, there is one base on JS - the front, and another base on Java - backing.  I want to develop projects, slowly rewriting the entire application on Node.JS, including the server code - in those places where Java is not needed.  There should not be a ‚Äúday number zero‚Äù when the entire Java backend or JS frontend is sent to a landfill, and let the whole world wait until we write a new one. </li><li>  When crossing the border of the language, you have to manually write a lot of garbage code that provides interop. </li></ul><br><p>  Sometimes there are ready-made solutions - for example, the Java / C border transition is done using JNI. </p><br><p>  The use of such integration is also good because, as programmers-functionals like to say, ‚Äúthat which does not exist will not break.‚Äù  If we in our code support the hellish pom.xml, properties and xml-files and other manual interop, then they tend to break in the most unpleasant moments.  If this layer was written by some real battle nerds, such as Oracle or Microsoft, it hardly breaks, and when it breaks, it‚Äôs not for us to fix it. </p><br><p>  Returning to the previous example: why do we have to get up twice and do wonders with Nashorny, if you can not get up at all and write the whole UI only on Noda? </p><br><p>  But how to do this, given that you need to transparently suck data from Java? </p><br><p>  The first thought that comes to mind is to continue using Nashorn.  Suck all the necessary libraries into it, file it with a file, and maybe they even run.  If among them there are no those who need native extensions.  And manually emulate the entire infrastructure of the Node.  And something else.  It seems to be a problem.  In general, such a project has already been, called Project Avatar, and, unfortunately, it is bent.  If the developers from Oracle were unable to complete it, then what is the chance that you can do it yourself? </p><br><h1 id="java-js-graal">  Java-&gt; JS.  Graal </h1><br><p>  Fortunately, we have another fairly new and interesting project - Graal.js.  That is the part of Graal responsible for running JavaScript. </p><br><p>  Innovative projects from the world of JDK are often perceived as something far and unreal.  Graal is different in this regard - very suddenly he came on the scene as a mature competitor. </p><br><p>  Graal is not part of OpenJDK, but a separate product.  It is known for the fact that in recent versions of OpenJDK, you can switch the JIT compiler from C2 to the one that comes with Graal.  In addition, Graal comes with the Truffle framework, with which you can implement various new languages.  In this case, the developers at Oracle Labs have implemented JavaScript support. </p><br><p>  To feel how easy and convenient it is, let's look at a toy example project. </p><br><p>  Imagine that we are cutting UFOs in Habr√©. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/om/bp/pf/ombppfbx0u7choo0p2jvpu5_tmq.png"></div><br><p>  In the first version of Cutting, a UFO will be able to ban random people, and the button will be called ‚ÄúBan someone!‚Äù.  In the second version, the button will ban either trolls or spammers, and who exactly we are currently banning will be loaded from Java.  In order to minimize the example, only the inscription on the button will be changed, we will not pass the business logic. </p><br><p>  To make a reactor application, you need to perform many actions, so they are neatly divided into steps.  In the end it turns out a working application, I checked. </p><br><h1 id="chast-1-zagotovka-prilozheniya">  Part 1. Procurement applications </h1><br><h3 id="1-kachaem-enterprayznuyu-graalvm-po-ssylkehttpwwworaclecomtechnetworkoracle-labsprogram-languagesdownloadsindexhtml-i-propisyvaem-obychnye-dlya-java-peremennye-okruzheniya">  1. Download the "GraalVM" enterprise ( <a href="http://www.oracle.com/technetwork/oracle-labs/program-languages/downloads/index.html">by reference</a> ) and write the usual for Java environment variable. </h3><br><p>  The enterprise version is needed because only GraalJS is in it. </p><br><p>  You can, for example, write this in the .bash_profile: </p><br><pre> <code class="hljs bash"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graalvm</span></span></span></span> () { <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LABSJDK=/Users/olegchir/opt/graalvm-0.33/Contents/Home <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LABSJRE=/Users/olegchir/opt/graalvm-0.33/Contents/Home/jre <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JDK_HOME=<span class="hljs-variable"><span class="hljs-variable">$LABSJDK</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JRE_HOME=<span class="hljs-variable"><span class="hljs-variable">$LABSJRE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> JAVA_HOME=<span class="hljs-variable"><span class="hljs-variable">$JDK_HOME</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$JDK_HOME</span></span>/bin:<span class="hljs-variable"><span class="hljs-variable">$JRE_HOME</span></span>/bin:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span> }</code> </pre> <br><p>  And then after rebooting the shell, call this function: <code>graalvm</code> . </p><br><p>  Why do I propose to make a separate bash function and call it as needed, and not immediately?  It's all very simple: after GraalVM gets into PATH, your normal system npm (for example, <code>/usr/local/bin/npm</code> at macOS) will be replaced with our special Java version ( <code>$JDK_HOME/bin/npm</code> ).  If you are a JS developer, such a permanent change is not a good idea. </p><br><h3 id="2-delaem-direktoriyu-dlya-proekta">  2. Make a project directory </h3><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -p ~/git/habrotest <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/git/habrotest</code> </pre> <br><h3 id="3-npm-init-zapolnit-s-umom-no-mozhno-i-prosto-proschelkat-knopku-enter">  3. <code>npm init</code> (fill wisely, but you can just click the enter button) </h3><br><h3 id="4-ustanavlivaem-nuzhnye-moduli-webpack-babel-react">  4. Install the necessary modules: Webpack, Babel, React </h3><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> --save-dev webpack webpack-cli webpack-dev-server npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> --save-dev babel-core babel-loader babel-preset-es2015 babel-preset-react npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> --save react react-dom</code> </pre> <br><p>  Note that npm may be a slightly outdated version (relative to the ‚Äúpresent‚Äù) and will ask for an update.  It is not worth updating. </p><br><h3 id="5-sozdaem-direktorii-v-kotoryh-budet-proishodit-rabota">  5. Create directories in which work will take place: </h3><br><pre> <code class="hljs axapta">mkdir -p src/<span class="hljs-keyword"><span class="hljs-keyword">client</span></span>/app mkdir -p src/<span class="hljs-keyword"><span class="hljs-keyword">client</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">public</span></span> mkdir -p loaders</code> </pre> <br><h3 id="6-uchim-babel-nashim-yazykam">  6. We teach Babel our languages: </h3><br><p>  <code>./.babelrc</code> : </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"presets"</span></span> : [<span class="hljs-string"><span class="hljs-string">"es2015"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span>] }</code> </pre> <br><h3 id="7-nastraivaem-vebpak">  7. Configure webpack: </h3><br><p>  <code>./webpack.config.js</code> : </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BUILD_DIR = p.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'src/client/public'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> APP_DIR = p.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'src/client/app'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: BUILD_DIR, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: APP_DIR + <span class="hljs-string"><span class="hljs-string">'/index.jsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">module</span></span> : { <span class="hljs-attr"><span class="hljs-attr">rules</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span> : <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?/</span></span>, <span class="hljs-attr"><span class="hljs-attr">include</span></span> : APP_DIR, <span class="hljs-attr"><span class="hljs-attr">loader</span></span> : <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> } ] } }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = config;</code> </pre> <br><h3 id="8-sozdaem-stranichku-dlya-nashego-prilozheniya">  8. Create a page for our application: </h3><br><p> <code>./src/client/index.html</code> </p> <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"public/bundle.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="9-sozdaem-indeks-chtoby-potom-pihat-v-nego-demonstracionnyy-komponent">  9. Create an index (in order to later push a demo component into it): </h3><br><p> <code>./src/client/app/index.jsx</code> </p> <br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {render} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NLOComponent <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./NLOComponent.jsx'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   , </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">NLOComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'app'</span></span>));</code> </pre> <br><h3 id="10-sozdaem-komponent">  10. Create a component! </h3><br><p> <code>./src/client/app/NLOComponent.jsx</code> </p> <br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NLOComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {<span class="hljs-attr"><span class="hljs-attr">banned</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onBan = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onBan.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } onBan () { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newBanned = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.banned + <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({<span class="hljs-attr"><span class="hljs-attr">banned</span></span>: newBanned}); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   : </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.state.banned}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.onBan}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> -!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> NLOComponent;</code> </pre> <br><h3 id="11-zapuskaem-sborku-webpack--d">  11. Run the build: <code>webpack -d</code> </h3><br><p>  Everything should successfully gather and bring something like: </p><br><pre> <code class="hljs pgsql">joker:habrotest olegchir$ webpack -d Hash: b19d6529d6e3f70baba6 <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>: webpack <span class="hljs-number"><span class="hljs-number">4.5</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-type"><span class="hljs-type">Time</span></span>: <span class="hljs-number"><span class="hljs-number">19358</span></span>ms Built at: <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-04</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> Asset Size Chunks Chunk Names bundle.js <span class="hljs-number"><span class="hljs-number">1.69</span></span> MiB main [emitted] main Entrypoint main = bundle.js [./src/client/app/NLOComponent.jsx] <span class="hljs-number"><span class="hljs-number">3.03</span></span> KiB {main} [built] [./src/client/app/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.jsx] <span class="hljs-number"><span class="hljs-number">2.61</span></span> KiB {main} [built] + <span class="hljs-number"><span class="hljs-number">21</span></span> hidden modules</code> </pre> <br><h3 id="12-teper-mozhno-otkryt-v-brauzere-srcclientindexhtml-i-nasladitsya-sleduyuschim-vidom">  12. Now you can open in the browser <code>./src/client/index.html</code> and enjoy the following view: </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/om/bp/pf/ombppfbx0u7choo0p2jvpu5_tmq.png"></div><br><p>  The first part of the tutorial is completed, now you need to learn how to change the label on the button. </p><br><h1 id="chast-2-podsovyvaem-peremennye">  Part 2. Slip Variables </h1><br><h3 id="13-poprobuem-vnedrit-v-nash-komponent-peremennuyu-nazvanie-knopki-buttoncaption-i-spisok-variantov-buttonvariants-o-kotoryh-nichego-ne-izvestno-v-js-v-dalneyshem-oni-budut-podtyagivatsya-iz-java-no-seychas-prosto-proveryaem-chto-ih-ispolzovanie-privodit-k-oshibke">  13. Let's try to insert into our component the variable ‚Äúbutton name‚Äù ( <code>buttonCaption</code> ) and ‚Äúlist of options‚Äù ( <code>buttonVariants</code> ), about which nothing is known in JS.  In the future, they will pull up from Java, but for now just check that using them results in an error: </h3><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NLOComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {<span class="hljs-attr"><span class="hljs-attr">banned</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">button</span></span>: buttonCaption}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onBan = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onBan.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } onBan () { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newBanned = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.banned + <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({<span class="hljs-attr"><span class="hljs-attr">banned</span></span>: newBanned, <span class="hljs-attr"><span class="hljs-attr">button</span></span>: buttonVariants[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random())]}); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   : </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.state.banned}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.onBan}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.state.button}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> NLOComponent;</code> </pre> <br><p>  We observe an honest mistake: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">NLOComponent</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jsx</span></span>?8<span class="hljs-selector-tag"><span class="hljs-selector-tag">e83</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Uncaught</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ReferenceError</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">buttonCaption</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">defined</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">NLOComponent</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">NLOComponent</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jsx</span></span>?8<span class="hljs-selector-tag"><span class="hljs-selector-tag">e83</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">constructClassInstance</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6789)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">updateClassComponent</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8324)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">beginWork</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8966)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">performUnitOfWork</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11798)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">workLoop</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11827)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">HTMLUnknownElement</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.callCallback</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:104)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.invokeGuardedCallbackDev</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:142)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">invokeGuardedCallback</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:191)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">replayUnitOfWork</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">react-dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.development</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span>?61<span class="hljs-selector-tag"><span class="hljs-selector-tag">bb</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11302)</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>) @ bundle.js:<span class="hljs-number"><span class="hljs-number">72</span></span> react-dom.development.js?<span class="hljs-number"><span class="hljs-number">61</span></span>bb:<span class="hljs-number"><span class="hljs-number">9627</span></span> The above error occurred in the &lt;NLOComponent&gt; component: in NLOComponent (created by App) in div (created by App) in App</code> </pre> <br><h3 id="14-teper-davayte-poznakomimsya-s-legalnym-sposobom-podsovyvat-peremennye-v-vebpake-eto-loadery">  14. Now let's get acquainted with the legal way to slip variables in the Webpack.  These are loaders. </h3><br><p>  First, you need to rewrite the webpack configuration a bit to conveniently load custom loaders: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BUILD_DIR = p.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'src/client/public'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> APP_DIR = p.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'src/client/app'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> defaults = { <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: BUILD_DIR, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: APP_DIR + <span class="hljs-string"><span class="hljs-string">'/index.jsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">module</span></span> : { <span class="hljs-attr"><span class="hljs-attr">rules</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span> : <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?/</span></span>, <span class="hljs-attr"><span class="hljs-attr">include</span></span> : APP_DIR, <span class="hljs-attr"><span class="hljs-attr">loader</span></span> : <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> } ] }, <span class="hljs-attr"><span class="hljs-attr">resolveLoader</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: [<span class="hljs-string"><span class="hljs-string">'node_modules'</span></span>, p.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'loaders'</span></span>)] } }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dd = defaults; dd.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span> : <span class="hljs-regexp"><span class="hljs-regexp">/index\.jsx/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">"preload"</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: {} }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dd; };</code> </pre> <br><p>  (Note that you can slip any data into the <code>options</code> loader and then take it using <code>loaderUtils.getOptions(this)</code> from the <code>loader-utils</code> module) </p><br><p>  Well, now, actually, we write loader.  The loader is stupid: the initial code comes to the source parameter, we change it at will (we can not change it) and then return it back. </p><br><p>  <code>./loaders/preload.js</code> : </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> loaderUtils = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"loader-utils"</span></span>), schemaUtils = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"schema-utils"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cacheable(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"applying loader"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initial = <span class="hljs-string"><span class="hljs-string">" !"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variants = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify([<span class="hljs-string"><span class="hljs-string">" !"</span></span>, <span class="hljs-string"><span class="hljs-string">" !"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`window.buttonCaption=\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${initial}</span></span></span><span class="hljs-string">\";`</span></span> + <span class="hljs-string"><span class="hljs-string">`window.buttonVariants=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${variants}</span></span></span><span class="hljs-string">;`</span></span> + <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${source}</span></span></span><span class="hljs-string">`</span></span>; };</code> </pre> <br><p>  <code>webpack -d</code> with <code>webpack -d</code> . </p><br><p>  Everything works fine, there are no errors. </p><br><h1 id="chast-3-dobavlyaem-java-kod">  Part 3. Add Java code </h1><br><h3 id="15-teper-vy-sprosite-horosho-my-vyuchili-odin-malenkiy-gryaznyy-hak-vebpaka-no-pri-chem-zdes-java">  15. Now you ask: well, we learned one small dirty hack of Webpack, but what does Java have to do with it? </h3><br><p>  The interesting thing here is that our loader is executed for a reason, and under the Grail.  So, using an API similar to Nashorn, you can work from JS with Java types. </p><br><pre> <code class="hljs pgsql">const loaderUtils = require("loader-utils"), schemaUtils = require("schema-utils"); module.exports = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> main(source) { this.cacheable(); console.log("applying loader"); //          var JavaString = Java.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>("java.lang.String"); var initial = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JavaString(" !"); //    , ,   var jsVariants = [" !", " !"]; var javaVariants = Java.<span class="hljs-keyword"><span class="hljs-keyword">to</span></span>(jsVariants, "java.lang.String[]"); var variants = <span class="hljs-type"><span class="hljs-type">JSON</span></span>.stringify(javaVariants); //    ,      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> `<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.buttonCaption=\"${initial}\";` + `<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.buttonVariants=${variants};` + `${source}`; };</code> </pre> <br><p>  And of course, <code>webpack -d</code> . </p><br><h3 id="16-pri-popytke-sobrat-vebpakom-vidim-oshibku">  16. When trying to build a webpack, we see an error: </h3><br><pre> <code class="hljs ruby">ERROR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./src/client/app/index.jsx Module build <span class="hljs-symbol"><span class="hljs-symbol">failed:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">ReferenceError:</span></span> Java is <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">defined</span></span> at Object.main (<span class="hljs-regexp"><span class="hljs-regexp">/Users/olegchir</span></span><span class="hljs-regexp"><span class="hljs-regexp">/git/habrotest</span></span><span class="hljs-regexp"><span class="hljs-regexp">/loaders/preload</span></span>.<span class="hljs-symbol"><span class="hljs-symbol">js:</span></span><span class="hljs-number"><span class="hljs-number">9</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">19</span></span>)</code> </pre> <br><p>  It arises because Java types are not available by default and are turned on by the special flag - <code>--jvm</code> , which is available only in GraalJS, but not in the ‚Äúnormal‚Äù Node. </p><br><p>  Therefore, you need to collect a special team: </p><br><p> <code>node --jvm node_modules/.bin/webpack -d</code> </p> <br><p>  Since typing all this is quite a chore, I use alias in bash.  For example, the following line can be inserted into <code>.bash_profile</code> : </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> graal_webpack_build=<span class="hljs-string"><span class="hljs-string">"node --jvm node_modules/.bin/webpack -d"</span></span></code> </pre> <br><p>  Or, somehow, even shorter, to recruit was pleasant. </p><br><h3 id="17-profit">  17. PROFIT! </h3><br><p>  The result can be viewed <a href="https://github.com/olegchir/graal-shared-example">in my repository on GitHub</a> .  The collected files are committed directly to the repository, so you can see without even going through the tutorial. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/88/zc/qn/88zcqndahftknfwxexmwa5el4os.png"></div><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  In such a simple and convenient way, we can now integrate Java and JS.  All this is far from an isolated case, you can think of many ways to use it. </p><br><p>  Finally, a drop of tar in a barrel of honey.  What is the catch? </p><br><ul><li><del>  GraalJS - not yet Open Source, although it is rumored that they want to open it; </del>  <a href="http://www.graalvm.org/">Already everything is in order</a> . </li><li>  Java npm is still slowing down.  Why - it is necessary to study.  It is npm that is slowing down, not the JS-engine itself; </li><li>  Under the hood of all this is fierce magic, and when you try to climb there will have to learn a lot more; </li><li>  All of this is relative to JDK8.  New chips from Java 11 will have to wait long enough; </li><li>  Graal is a pilot project.  You need to take this into account when trying to integrate it into a very bloody enterprise without the right to make a mistake. </li></ul><br><blockquote>  Minute advertising.  As you probably know, we do conferences.  The nearest JavaScript conference is <a href="https://holyjs-piter.ru/">HolyJS 2018 Piter</a> , which will be held May 19-20, 2018 in St. Petersburg.  You can come there, listen to the reports (what reports are there - described in <a href="https://holyjs-piter.ru/">the conference program</a> ), talk live with practicing experts from JavaScript and the frontend, developers of various modern technologies.  In short, come in, we are waiting for you! </blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/353624/">https://habr.com/ru/post/353624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353612/index.html">Manage your browser with PHP and Selenium</a></li>
<li><a href="../353614/index.html">Internet Marketing and Web Analytics Strategy Avinash Koshyk</a></li>
<li><a href="../353616/index.html">We manage a big long project: why is it important to speak with words</a></li>
<li><a href="../353618/index.html">Reservoir Dogs: Angular 2 vs React</a></li>
<li><a href="../353622/index.html">We optimize (debounce) the triggering of events in React</a></li>
<li><a href="../353626/index.html">New encoder frees up your files if you play PUBG</a></li>
<li><a href="../353628/index.html">Security Week 13: Facebook fuss, extortionists' popularity, Specter patches</a></li>
<li><a href="../353630/index.html">The ILV has blocked several Amazon and Google MAJOR subnets (UPD .: and continues to block new ones!)</a></li>
<li><a href="../353632/index.html">Learn OpenGL. Lesson 5.2 - Gamma Correction</a></li>
<li><a href="../353634/index.html">PushAll as a partial Telegram replacement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>