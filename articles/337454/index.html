<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A set of useful tips for the effective use of FreeIPA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="During the operation of FreeIPA, non-trivial tasks often arise that run into not-so-well-documented or incompletely implemented places. Therefore, I d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A set of useful tips for the effective use of FreeIPA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/896/d36/95e/896d3695e1894c258203e7e5ff27157b.jpg"><br><br>  During the operation of FreeIPA, non-trivial tasks often arise that run into not-so-well-documented or incompletely implemented places.  Therefore, I decided to supplement my <a href="https://habrahabr.ru/company/pixonic/blog/325546/">previous article with</a> some solutions that will save you some time. <br><br>  Content: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  FreeIPA agent in lxc containers </li><li>  Library to use API in python </li><li>  Some words about Ansible modules </li><li>  FreeIPA agent in debian </li><li>  Replica in Amazon </li></ol><br><a name="habracut"></a><h4>  FreeIPA agent in lxc containers </h4><br>  We have for dev-environments in some places use such a thing as Proxmox and lxc-containers in it.  The container template for the container was taken from the standard centos-7-default version 20170504, which we customized.  But with the banal installation of the agent, he refused to work.  After analysis, it turned out that there are no sudo packages in this build and no SELinux in the containers.  So, the points that need to be done: <br><br><ul><li>  yum install sudo </li><li>  install and configure </li><li>  in the /etc/sssd/sssd.conf file, in the [domain / $ DOMAINNAME] section add the line selinux_provider = none </li><li>  restart sssd systemctl restart sssd </li></ul><br>  If during installation and configuration of the agent everything was done without errors, then after restart everything will start working. <br><br>  If configs are rolled out with Ansible, you can use variables: <br><br><pre><code class="bash hljs">ansible_virtualization_role == <span class="hljs-string"><span class="hljs-string">"guest"</span></span> and ansible_virtualization_type == <span class="hljs-string"><span class="hljs-string">"lxc"</span></span></code> </pre> <br><h4>  Library to use API in Python </h4><br>  In modern versions of FreeIPA, a wonderful API appeared, but we could not find full Python libraries.  There is a <a href="https://github.com/nordnet/python-freeipa-json">repository</a> on the githaba, but the little implemented there turned out to be small.  Since the solution is distributed under the MIT license, we decided to copy it and add it ourselves.  Our implementation is available at <a href="http">this link</a> . <br><br>  It will still be finished as needed, but you can pick it up now, finish it and replace it.  At the moment, only what we needed was implemented. <br><br><h4>  Some words about Ansible modules </h4><br>  I will make a reservation at once, it will be about the version of Ansible 2.3.1.0 installed via pip.  In general, add user and group modules work fine.  But when adding sudoroles some problems arose.  The first and most unpleasant - they simply do not add.  The error looks like this: <br><br><pre> <code class="bash hljs">get_sudorule_diff() takes exactly 2 arguments (3 given)</code> </pre> <br>  Heal in haste, it is quite elementary.  In the file of the ipa_sudorule.py module, we need line 307. Here it is: <br><br><pre> <code class="bash hljs">diff = get_sudorule_diff(client, ipa_sudorule, module_sudorule)</code> </pre> <br>  We change it to this: <br><br><pre> <code class="bash hljs">diff = get_sudorule_diff(ipa_sudorule, module_sudorule)</code> </pre> <br>  Adding starts to work.  You can read about it <a href="https://github.com/ansible/ansible/issues/21152">here</a> and <a href="https://github.com/ansible/ansible/pull/21150">here</a> , but we have not yet verified. <br><br>  The second problem is related to the addition of options for sudoroles, which we plan to find out soon. <br><br><h4>  FreeIPA agent in debian </h4><br>  Installing an agent in a debian like system for some reason causes some problems for some people.  I want to present our version of the development of agents on debian-like systems: <br><br><pre> <code class="bash hljs">1.   wget -qO - http://apt.numeezy.fr/numeezy.asc | apt-key add - <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">'deb http://apt.numeezy.fr jessie main'</span></span> &gt;&gt; /etc/apt/sources.list 2.   apt-get update apt-get install -y freeipa-client 3.   mkdir -p /etc/pki/nssdb certutil -N -d /etc/pki/nssdb mkdir -p /var/run/ipa 4.    mv /etc/ipa/default.conf ~/ 5.     ipa-client-install 6.    <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'session required pam_mkhomedir.so'</span></span> &gt;&gt; /etc/pam.d/common-session 7. ,   /etc/nsswitch.conf   sss  passwd: files sss group: files sss shadow: files sss 8.  sssd systemctl restart sssd</code> </pre> <br><h4>  Amazon Replica </h4><br>  As you know, in the Amazon external addresses are not listed directly on the hosts.  And the installer does not like it very much.  In general, this is relevant not only for Amazon, but for all options when the external address is not configured directly on the host. <br><br>  To solve this problem during installation, it is enough to add an external IP to any interface during the installation.  As an example, this can be done using ip addr add: <br><br><pre> <code class="bash hljs">ip addr add <span class="hljs-variable"><span class="hljs-variable">$ADDR</span></span> dev <span class="hljs-variable"><span class="hljs-variable">$IFACE</span></span></code> </pre> <br>  After successful installation and configuration using ip addr del: <br><br><pre> <code class="bash hljs">ip addr del <span class="hljs-variable"><span class="hljs-variable">$ADDR</span></span></code> </pre> <br>  Also, do not forget to specify different DNS names for the external and internal addresses, otherwise there will be confusion. <br><br>  As a result, we get that clients in lxc and debian-like systems are quite real and have no particular problems.  All these solutions work for us without any noticeable problems for quite a long time.  Managing full access via Ansible is not quite convenient, but you can speed up and automate part of the routine work.  As for the library for Python, you need to implement quite a lot more, but all the basic functions are already there.  However, new ideas are also welcome. </div><p>Source: <a href="https://habr.com/ru/post/337454/">https://habr.com/ru/post/337454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337442/index.html">Cybersecurity: Flipping through Cisco's annual report</a></li>
<li><a href="../337446/index.html">Data masking as a tool to minimize labor costs at the stage of putting new information systems into operation</a></li>
<li><a href="../337448/index.html">Statistics on basic operating systems in images on the Docker Hub</a></li>
<li><a href="../337450/index.html">CSS immersion: font metrics, line-height and vertical-align</a></li>
<li><a href="../337452/index.html">Record of the webinar ‚ÄúHow expert information and a model for predicting malicious behavior help protect companies‚Äù</a></li>
<li><a href="../337456/index.html">The Internet of Things is Popular: Why We Stop Walking the Dogs</a></li>
<li><a href="../337458/index.html">15 years at ISDEF: the experience of the oldest participant</a></li>
<li><a href="../337460/index.html">How JS works: about the V8 internals and code optimization</a></li>
<li><a href="../337464/index.html">let's live in peace</a></li>
<li><a href="../337466/index.html">Data Science Week 2017: The market is becoming more mature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>