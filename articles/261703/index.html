<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET 5 beta5 in Visual Studio 2015</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few days ago a new beta version of ASP.NET 5 - beta5 was released. It turned out that in the new version there are quite a lot of innovations and it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET 5 beta5 in Visual Studio 2015</h1><div class="post__text post__text-html js-mediator-article">  A few days ago a new beta version of ASP.NET 5 - beta5 was released.  It turned out that in the new version there are quite a lot of innovations and it is not so easy to migrate from the previous beta version.  Consider the main innovations and how to upgrade the standard template ASP.NET 5 project with Visual Studio to fully upgrade to the new version. <br>  + sorsy <br>  + test based on the article <br>  + video of the latest ASP.NET Community Standup <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/APagQ1CIVGA%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj8EI7Cg73Dm7knlnqY5FQHHjbJmw" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  <a href="http://blogs.msdn.com/b/webdev/archive/2015/06/30/asp-net-5-beta5-now-available.aspx">The main news</a> about the new release is published in a <a href="http://blogs.msdn.com/b/webdev/">web-dev blog on msdn</a> .  The most interesting, in my opinion, innovations: <br><ul><li>  Support for nuget feeds of the third version - now loading and checking packages is much faster. </li><li>  Support for C # 6 syntax in Razor markup. </li><li>  Improvements in JSON.NET - now the version of this library in runtime and packages may not match, and you can also simply serialize .NET objects in views, for example, Json.Serialize (Model) <br></li><li>  In addition, new features in the attributes of routing, tag-helpers refinement, etc. </li></ul><br>  Well, in general, for me this is the first version, after picking which everything seemed stable enough to work with it further.  The only thing that is not very convenient yet is clear - this is work with the Identity framework and a few things related to the Entity framework. <br><br>  Let's get down to business.  What you need to do in order to start everything on the new beta. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Build project </h5><br>  In the new ASP.NET, the entire build package is runtime (one of the runtimes) and all dependencies are nuget packages.  Therefore, in fact, in order to upgrade to the new version, you need to download the new runtime and change all the old versions of the packages to the new ones. <br><br>  The problem with using new beta is that in the current version of Visual Studio 2015, by default a project on ASP.NET 5 is created with packages of the previous beta.  And in order to upgrade to the new version, just updating all the packages is not enough; moreover, it just breaks all the functionality, since beta5 has changes that are not compatible with beta4.  To track such changes is quite simple, they are all published in a special <a href="https://github.com/aspnet/Announcements/issues">project on the githaba</a> .  But with their implementation in a real project, difficulties may arise.  Therefore, I decided to create a minimal application on beta5, making changes to the default project on beta4 and leave it as a template for the future. <br><br><h5>  Create a project in Visual Studio 2015 </h5><br>  If you still don't have Visual Studio 2015, the release candidate can be downloaded at <br>  <a href="https://www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs.aspx">www.visualstudio.com/en-us/downloads/visual-studio-2015-downloads-vs.aspx</a> <br>  By the way, the Community edition is available with all the important functionality.  The release of this version in less than a month - July 20, but it will not include the release of ASP.NET 5. <br><br>  With the creation of the project, everything is standard - ASP.NET Web application -&gt; <br><br><img src="https://habrastorage.org/files/a72/e19/502/a72e195023984aa3b9ffee4d42459881.png"><br><br>  -&gt; Web site <br><br><img src="https://habrastorage.org/files/9d2/c87/fdd/9d2c87fdd856440f9f8db27df97caed7.png"><br><br>  Let's see what we have at this stage and what we can do.  We have created an ASP.NET 5 project with beta4 version packages, on that runtime which is set by default in dnvm.  Now in parts, starting from the end.  The dnvm command ( <a href="https://github.com/aspnet/dnvm">https://github.com/aspnet/dnvm</a> ) is the .NET version manager, a command-line utility with which you can manage .NET versions.  The utility is installed with Visual Studio 2015, or you can install it separately, on different operating systems, details - <a href="https://github.com/aspnet/home">github.com/aspnet/home</a> and <a href="http://docs.asp.net/en/latest/getting-started/index.html">docs.asp.net/en/latest/getting-started/index.html</a> . <br><br>  If you run the dnvm list in the console, this command will show you all runtime versions that you currently have installed. <br><br><img src="https://habrastorage.org/files/38d/c3d/a6a/38dc3da6aff44daa855cd23457bef1a1.png"><br><br>  Also, the default runtime version will be specified in the global.json file and for each project you can select the runtime and platform. <br><br><img src="https://habrastorage.org/files/62c/c59/89c/62cc5989cb844c469ee15dbee46f68d8.png"><br><br>  There are 2 platform options - full .net or a new Core version, which is distributed via nuget and which can be used on different platforms.  In general, the whole concept of cross-platform .NET now uses the name DNX - from dot net x-plattform.  In general, DNX is the SDK + Runtime, details are <a href="http://docs.asp.net/en/latest/dnx/overview.html">docs.asp.net/en/latest/dnx/overview.html</a> . <br><br>  You can start the project, like the old way - Ctrl + F5 in the studio, and new, via the console, using the dnx command.  web.  But before that, you need to run dnx restore to slacken packages (not only nuget, but also npm, bower) and dnx build to build the project.  By default, after <br>  dnx restore <br>  dnx build <br>  dnx.  web <br>  there will be a mini web server (http: // localhost: 5000) that will host your project.  Commands that start on dnx.  registered in project.json: <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"commands"</span></span>: { <span class="hljs-string"><span class="hljs-string">"web"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNet.Hosting --server Microsoft.AspNet.Server.WebListener --server.urls http://localhost:5000"</span></span>, <span class="hljs-string"><span class="hljs-string">"gen"</span></span>: <span class="hljs-string"><span class="hljs-string">"Microsoft.Framework.CodeGeneration"</span></span>, <span class="hljs-string"><span class="hljs-string">"ef"</span></span>: <span class="hljs-string"><span class="hljs-string">"EntityFramework.Commands"</span></span> },</code> </pre> <br>  If there are no problems with launching the initial project using different methods, you can go on.  Among the problems - there are situations when packages are ‚Äúbadly‚Äù tightened, or the .net version in dnvm is not the same as the version of packages, in such a situation it is necessary to register all versions with the same (for example, beta4) and try to restart the project again. <br><br><h5>  Beta5 migration </h5><br>  First we need to update the .NET version.  To do this, perform the following in the console: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> DNX_FEED=https://www.nuget.org/api/v2 dnvm upgrade</code> </pre><br>  Now back to the project and make changes to it: <br><ul><li>  In the global.json file, write the beta5 version. </li><li>  In the project.json file, all beta4 is changed to beta5. </li><li>  In the properties of the project, too, choose beta5. </li></ul><br>  We are waiting for packages.  As a result, we get the error: <br><br><pre> <code class="bash hljs">Errors <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c:\Users\vkot\documents\visual studio 14\Projects\aspnet5\src\aspnet5\project.json Unable to locate Microsoft.Framework.ConfigurationModel.UserSecrets &gt;= 1.0.0-beta5 Unable to locate Microsoft.Framework.ConfigurationModel.Json &gt;= 1.0.0-beta5</code> </pre><br>  Look in the list of incompatible changes (Breaking changes) <br>  <a href="https://github.com/aspnet/Announcements/issues">github.com/aspnet/Announcements/issues</a> . <br>  Find <a href="https://github.com/aspnet/Announcements/issues/25">github.com/aspnet/Announcements/issues/25</a> . <br>  We remove the word Model in these packages in the project.json file. <br>  We return to the console, go to the project folder, hit: <br><pre> <code class="bash hljs">dnu restore dnu build</code> </pre><br>  Results of changes <a href="https://github.com/gbdrm/aspnet5/commit/f4a89eb92f8b144795bec8eece6d3003df995455">github.com/gbdrm/aspnet5/commit/f4a89eb92f8b144795bec8eece6d3003df995455</a> <br><br>  Restore should go fine, but the project is not yet being built.  If Restore does not work or there are more than 2 thousand errors in the project, try to close the project, once again run dnvm and then open the project.  If done correctly, at least Restore should earn. <br><br>  Further, there are several problems with compiling. <br>  First: <br><br><pre> <code class="cs hljs">PasswordSignInAsync(model.Email, model.Password, model.RememberMe, shouldLockout: <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br>  just delete the last parameter name, it looks like this parameter has been renamed. <br><br>  The second problem with the configuration, more detailed you can look at: <br>  <a href="https://github.com/aspnet/Announcements/issues/33">github.com/aspnet/Announcements/issues/33</a> <br>  <a href="https://github.com/aspnet/Announcements/issues/26">github.com/aspnet/Announcements/issues/26</a> <br><br>  The next problem is changes in the Entity Framework 7, can be found at: <a href="https://github.com/aspnet/Announcements/issues/35">github.com/aspnet/Announcements/issues/35</a> <br>  To fix it, we delete the entire contents of the Migrations folder and try to regenerate it using the Entity Framework commands.  After deleting files, the build should go without errors.  After a successful build, type in the console: <br><br><pre> <code class="bash hljs">dnx . ef migration add init</code> </pre><br>  And the Entity Framework re-builds the migration. <br><br>  Results changes <a href="https://github.com/gbdrm/aspnet5/commit/b1f7f56f6c6f91416e4d97b1e17a840c2b61741c">github.com/gbdrm/aspnet5/commit/b1f7f56f6c6f91416e4d97b1e17a840c2b61741c</a> <br><br>  It would seem - hurray!  Back to back  But the fact that it builds does not mean that it works.  We try to start the project.  First, I get an error on the line <br>  app.UseBrowserLink (); <br>  This feature is useful, but not critical, so for now I have simply deleted it. <br><br>  Farther: <br><br><pre> <code class="cs hljs">The type or <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">name</span></span> '<span class="hljs-title"><span class="hljs-title">IOptions</span></span>&lt;<span class="hljs-title"><span class="hljs-title">AppSettings</span></span>&gt;' <span class="hljs-title"><span class="hljs-title">could</span></span> <span class="hljs-title"><span class="hljs-title">not</span></span> <span class="hljs-title"><span class="hljs-title">be</span></span> <span class="hljs-title"><span class="hljs-title">found</span></span></code> </pre><br>  This is another incompatible change: <a href="https://github.com/aspnet/Announcements/issues/27">github.com/aspnet/Announcements/issues/27</a> <br>  Just changing the name from one to another. <br>  Run ... and it works! <br>  Results of changes: <a href="https://github.com/gbdrm/aspnet5/commit/40d744099a7d110117d4c17fd6499a68c719ddb4">github.com/gbdrm/aspnet5/commit/40d744099a7d110117d4c17fd6499a68c719ddb4</a> <br><br>  Most likely, after all these changes, everything will work for you, but some specific problems are possible. <br><br><h5>  Add new functionality </h5><br>  Let's add some simple feature to see a few more points.  Add a page where any user can add a message.  To do this, we will have to add a new table to the database - messages.  We describe a simple class: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Message</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Text { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Time { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Author { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  And also add it to the database. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbSet&lt;Message&gt; Messages { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  In order to start the application now there are not enough two more things - to configure the context (this is also a beta5 innovation) and add + apply migration by adding a new tablet.  In order to configure the database, you need to add the implementation of the OnConfiguring method to the context. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnConfiguring</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EntityOptionsBuilder optionsBuilder</span></span></span><span class="hljs-function">)</span></span> { optionsBuilder.UseSqlServer(Startup.Configuration[<span class="hljs-string"><span class="hljs-string">"Data:DefaultConnection:ConnectionString"</span></span>]); }</code> </pre><br>  For me at the moment, the easiest way to make the Configuration property of the Startup class is static to get the configuration out of it.  Perhaps you can find a more flexible solution. <br><br>  To work with migrations at the moment, you can only use the console commands of the Entity Framework 7. To do this, we need to make sure that the project is being built and go to the console in the project folder.  First, let's try if the EF commands work: <br><br><pre> <code class="bash hljs">dnx . ef migration list</code> </pre><br>  This command should display all current migrations.  We still have one - init.  If everything worked well, add a new migration - adding the Messages label. <br><br><pre> <code class="bash hljs">dnx . ef migration add Messages dnx . ef migration apply</code> </pre><br>  These two commands must add the Messages table to our database. <br><br>  Results of changes - <a href="https://github.com/gbdrm/aspnet5/commit/518fd2e3b6ab1c763be15ca6ae78eece2a630540">github.com/gbdrm/aspnet5/commit/518fd2e3b6ab1c763be15ca6ae78eece2a630540</a> <br><br><h5>  Add functionality </h5><br>  If everything is ready with the base, it's time to add the functionality itself.  Let's start with the controller.  Add a new method to HomeController that will return a view with messages.  And the very presentation with messages.  The code is of no value, but if you can see interesting - <a href="https://github.com/gbdrm/aspnet5/commit/ff0bc33d1d656cfd2db04a851a0c7c930e0a045c">github.com/gbdrm/aspnet5/commit/ff0bc33d1d656cfd2db04a851a0c7c930e0a045c</a> <br><br>  Demo project is ready. <br><br><h4>  results </h4><br>  First of all I really liked it.  I just liked working with the new stack.  For example, if you forgot to rebuild - do not worry, now it is not necessary.  Everything has become somehow faster, more convenient.  Of course, there is still a lot of raw stuff, but now you can almost put up with it, and before the release everything should be just fine. <br><br>  I had some problems with authorization on another machine, and so far I didn‚Äôt understand why, but most likely due to the fact that there are many versions of packages and runtimes installed on it and something didn‚Äôt fit somewhere.  But while I was dealing with this problem, I downloaded the weights of several projects from the githaba and just connected them instead of packages, and everything immediately worked without problems.  This is unrealistic to watch the details directly in the code of the framework itself, spending only a couple of minutes to put the weights in place of the nuget packages.  Generally very pleased with the socialization of ASP.NET developers.  Open source, public weekly stand-ups, a lot of examples on the github, there is still a public chat where ASP.NET developers hang out - <a href="http://jabbr.net/">jabbr.net/#/rooms/AspNetvNext</a> , etc. <br><br>  In general, if you are interested in asp.net 5, then you can and should dig.  Everything is ready for this and moreover, everything is very interesting. <br><br>  Sources: <a href="https://github.com/gbdrm/aspnet5">github.com/gbdrm/aspnet5</a> <br>  Demo + test: <a href="http://aspdotnet.azurewebsites.net/">aspdotnet.azurewebsites.net</a> </div><p>Source: <a href="https://habr.com/ru/post/261703/">https://habr.com/ru/post/261703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261687/index.html">Microsoft is preparing a major update for Windows RT</a></li>
<li><a href="../261689/index.html">Compromise microservices</a></li>
<li><a href="../261691/index.html">FLProg - continuation of evolution</a></li>
<li><a href="../261699/index.html">How I compiled the application bundle for MacOS on Linux</a></li>
<li><a href="../261701/index.html">Deploying Nano Server with Windows Assessment and Deployment Kit (ADK) RC for Windows 10</a></li>
<li><a href="../261707/index.html">Apple fixed OS X vulnerabilities</a></li>
<li><a href="../261709/index.html">Financial Transmission Ways # 3: Plaza II Protocol</a></li>
<li><a href="../261711/index.html">Basics of using Cocoapods in iOS app development</a></li>
<li><a href="../261715/index.html">DevStack as a tool</a></li>
<li><a href="../261717/index.html">Magic Tensor Algebra: Part 3 - Curvilinear Coordinates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>