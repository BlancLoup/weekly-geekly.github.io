<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP-AMQP version 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article RabbitMQ AMQP for PHP , New Ideas for PHP , published a draft of the PHP-AMQP API 

 In continuation of previously published ideas, I pres...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP-AMQP version 2</h1><div class="post__text post__text-html js-mediator-article">  The article <a href="http://akalend.habrahabr.ru/blog/70902/">RabbitMQ AMQP for PHP</a> , <a href="http://akalend.habrahabr.ru/blog/70902/">New Ideas for PHP</a> , published a draft of the PHP-AMQP API <br><br>  In continuation of previously published ideas, I present their implementation, which is more than the first version. <br><a name="habracut"></a><br>  extension code can be found <a href="http://code.google.com/p/php-rabbit/downloads/list">here the</a> description of the project and svn until the old version (1.0), translated into English <br><br>  Brief description of version 2.0: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Class AMQPConnection - opening a logical connection, including a channel connection. </h4><br><h5>  Constructor: </h5><br>  APMQConection :: APMQConection ([array params]) <br><br>  Parameters (all optional): <br><ul><li>  host = [localhost] </li><li>  port = [5672] </li><li>  login = [guest] </li><li>  psw = [guest] </li><li>  vhost = [/] </li></ul><br>  Exception - no logical or physical connection. <br><br>  Example: <br> <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1', 'vhost'=&gt;'v1' ) );</code> <br> <br><h4>  AMQPExchange Exchange Class </h4><br><h5>  constructor: </h5><br>  creating exchange, if the name is specified otherwise class initialization <br>  AMQPExchange :: AMQPExchange (APMQConection cnn, string [name]) <br>  name - the name of the exchange <br><br>  Example: <br><br> <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $exchange = new AMQPExchange($cnn, 'ex_name'); <br></code> <br><br><h5>  Ad exchange: </h5><br>  proto bool AMQPEexchange :: declare ([string name], [string type = direct], [bit params]); <br><br>  name - the name of the exchange <br>  type - type of exchange, allowed types: direct, topic &amp; fanout <br>  params - parameters: <br><ul><li>  AMQP_PASSIVE </li><li>  AMQP_DURABLE </li><li>  AMQP_AUTODELETE </li><li>  AMQP_INTERNAL </li></ul><br>  returns the result of the operation <br><br>  Example: <br> <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $exchange = new AMQPExchange($cnn); <br> $exchange-&gt;declare('ex_name', 'topic',AMQP_DURABLE ); <br></code> <br><br><h5>  Removing exchange: </h5><br>  proto bool AMQPExchange :: delete ([string name], [bit params]); <br><br>  name - the name of the exchange <br>  params - parameters: <br><ul><li>  AMQP_IFUNUSED </li></ul><br>  returns the result of the operation <br><br>  Example: <br> <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $exchange = new AMQPExchange($cnn, 'ex_name'); <br> $res = $exchange-&gt;delete(); <br> //     -    ,    . <br></code> <br><br><h5>  Binding exchange to the queue: </h5><br>  proto bool AMQPExchange :: bind (string queueName, string routingKey); <br><br>  queueName - the name of the queue <br>  key - routing-key, route key, string <br><br>  returns the result of the operation <br><br>  Example: <br> <code>$msg = " ,  ..."; <br> $cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $exchange = new AMQPExchange($cnn, 'ex_name'); <br> $exchange-&gt;bind('mylogin','spb.news') <br> $res = $exchange-&gt;publish( $msg, 'spb.news'); <br></code> <br><br><h5>  Publication: </h5><br><br>  proto bool AMQPExchange :: publish (string msg, [string key], bit [parms]); <br><br>  Posting a message with the key key for a topic type topic or direct <br><br>  msg - message, string <br>  key - routing-key, route key, string <br>  params - parameters: <br><ul><li>  AMQP_MANDATORY </li><li>  AMQP_IMMEDIATE </li></ul><br><br>  returns the result of the operation <br><br>  Example: <br> <code>$msg = "  ..."; <br> $cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $exchange = new AMQPExchange($cnn, 'ex_name'); <br> $res = $exchange-&gt;publish( $msg, 'spb.news'); <br></code> <br><br><h4>  Queue Class AMQPQueue </h4><br><h5>  constructor - class initialization </h5><br>  AMQPQueue :: AMQPQueue (AMQPConnection cnn, string [name]) <br><br>  name - the name of the queue <br><br><h5>  Ad queue </h5><br>  proto int AMQPQueue :: declare (string [name], bit [params]) <br><br>  name - the name of the queue <br>  params - parameters: <br><ul><li>  AMQP_AUTODELETE (default) </li><li>  AMQP_DURABLE </li><li>  AMQP_PASSIVE </li><li>  AMQP_EXCLUSIVE </li></ul><br>  returns the number of items in the queue if the queue already exists. <br><br>  Example: <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $queue = new AMQPQueue($cnn,'chat_12'); <br> $queue-&gt;declare('chat_12', AMQP_AUTEDELETE | AMQP_DURABLE); <br></code> <code>$cnn = new APMQConection(array ('port'=&gt;5673, 'login' =&gt; 'sector1' )); <br> $queue = new AMQPQueue($cnn,'chat_12'); <br> $queue-&gt;declare('chat_12', AMQP_AUTEDELETE | AMQP_DURABLE); <br></code> <br><br><h5>  Deleting a queue </h5><br>  proto bool AMQPQueue :: delete (string [name], bit [params]) <br><br>  name - the name of the queue <br>  params - parameters: <br><ul><li>  AMQP_IFUNUSED </li><li>  AMQP_IFEMPTY </li></ul><br>  returns the result of the operation <br><br>  Example: <code>$queue = new AMQPQueue(new APMQConection(),'chat_12'); <br> $queue-&gt;delete();</code> <code>$queue = new AMQPQueue(new APMQConection(),'chat_12'); <br> $queue-&gt;delete();</code> <br> <br><h5>  Binding queue to exchange </h5>  : <br>  proto bool AMQPQueue :: bind (string exchangeName, string routingKey); <br><br>  name - the name of the exchange <br>  routingkey - route key <br><br>  Example: <br> <code>//   'mylogin'   'ex_estate'   '*.spb' <br> $queue = new AMQPQueue(APMQConection(), 'mylogin'); <br> $queue-&gt;declare(); <br> $queue-&gt;bind('ex_estate','*.spb'); <br></code> <br><br><h5>  Subscribe </h5><br>  proto array AMQPQueue :: consume (int n); <br>  get an array of n-messages from the queue (all others are reset) <br>  n - number of received messages <br>  params - parameters: <br><ul><li>  AMQP_NOLOCAL </li><li>  AMQP_NOACK </li><li>  AMQP_EXCLUSIVE </li></ul><br><br>  <b>Attention!</b> <br>  The number of received messages cannot exceed the total number of messages in the queue, otherwise the API will wait for the broker to receive all messages. <br>  If you specify the number of messages that are less than the current time in the queue, then all not selected messages will be marked as selected, that is, they will be lost when re-reading from the queue, if the AMQP_NOACK flag is not set. <br><br>  Example: <code>$i=0; <br> $queue = new AMQPQueue(APMQConection()); <br> $n = $queue-&gt;declare('mylogin'); <br> $queueMessages = $queue-&gt;consume( $n ); <br> foreach($queueMessages as $item){ <br> $i++; <br> echo "$i.$item"; <br> } <br></code> <code>$i=0; <br> $queue = new AMQPQueue(APMQConection()); <br> $n = $queue-&gt;declare('mylogin'); <br> $queueMessages = $queue-&gt;consume( $n ); <br> foreach($queueMessages as $item){ <br> $i++; <br> echo "$i.$item"; <br> } <br></code> <br><br><h5>  Unsubscribe </h5><br>  proto bool AMQPQueue :: unbind (string exchangeName, string routingKey); <br>  detaches the current queue from the exchangeName cheat for routingKey <br><br>  name - the name of the exchange <br>  routingkey - route key <br><br>  returns the result of the operation <br><br><h5>  Queue reset </h5><br>  proto bool AMQPQueue :: purge (string [name]) <br>  All messages in the queue are reset, the queue itself remains. <br><br>  name - the name of the queue <br>  returns the result of the operation <br><br>  Example: <code>$queue = new AMQPQueue(new APMQConection()); <br> $queue-&gt;purge('chat_12'); <br></code> <code>$queue = new AMQPQueue(new APMQConection()); <br> $queue-&gt;purge('chat_12'); <br></code> <br><br><h5>  Get queue item </h5><br>  proto array AMQPQueue :: get (string [name], bit [params]) <br><br>  name - the name of the queue <br>  params - parameters: <br><ul><li>  AMQP_NOASK (default) </li></ul><br><br>  returns an associative array: <br><ul><li>  msg - current message </li><li>  count - the number of messages remaining in the queue if: <br><ul><li>  count = 0 - this message is the last in the queue </li><li>  count = -1 queue is empty, the msg key is absent </li></ul><br></li><br><br>  If you compare speed, the consume () method is faster than get () <br>  but the get method is more reliable. </ul></div><p>Source: <a href="https://habr.com/ru/post/73671/">https://habr.com/ru/post/73671/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../73665/index.html">PHP: Implementing Formal Grammar</a></li>
<li><a href="../73666/index.html">Mr Wiegles - Usability</a></li>
<li><a href="../73667/index.html">Twitter lists are now available to everyone.</a></li>
<li><a href="../73668/index.html">AT & T UNIX PC</a></li>
<li><a href="../73669/index.html">Do you study further?</a></li>
<li><a href="../73672/index.html">Search for Chrome extensions from Google</a></li>
<li><a href="../73673/index.html">GFS Distributed File System (Google File System)</a></li>
<li><a href="../73675/index.html">The second release candidate of the FreeBSD 8.0 operating system has been released</a></li>
<li><a href="../73678/index.html">Guys with google street view</a></li>
<li><a href="../73679/index.html">What kind of hosting do you use?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>