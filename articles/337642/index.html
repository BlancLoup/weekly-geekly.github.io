<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn OpenGL. Lesson 2.5 - Light Sources</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sources of light 
 Up to this article, we were content with lighting coming from one point in space. And the result was not bad, but in reality there ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn OpenGL. Lesson 2.5 - Light Sources</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="Ogl3" align="left" width="300"><br><h2>  Sources of light </h2><br>  Up to this article, we were content with lighting coming from one point in space.  And the result was not bad, but in reality there are many sources of illumination with differing "behavior".  This lesson discusses several such light sources.  The ability to simulate the characteristics of different light sources is another tool to enrich the created scenes. <br><br>  We begin the lesson with a directional light source, then move on to a point source, which is a development of the above simple lighting method.  In the end we will look at how the source is imitating the properties of a spotlight (spotlight). <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Part 1. Start <br><br><ol><li>  <a href="https://habrahabr.ru/post/310790/">Opengl</a> </li><li>  <a href="https://habrahabr.ru/post/311198/">Creating a window</a> </li><li>  <a href="https://habrahabr.ru/post/311234/">Hello window</a> </li><li>  <a href="https://habrahabr.ru/post/311808/">Hello triangle</a> </li><li>  <a href="https://habrahabr.ru/post/313380/">Shaders</a> </li><li>  <a href="https://habrahabr.ru/post/315294/">Textures</a> </li><li>  <a href="https://habrahabr.ru/post/319144/">Transformations</a> </li><li>  <a href="https://habrahabr.ru/post/324968/">Coordinate systems</a> </li><li>  <a href="https://habrahabr.ru/post/327604/">Camera</a> </li></ol><br>  Part 2. Basic lighting 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/329592/">Colors</a> </li><li>  <a href="https://habrahabr.ru/post/333932/">Lighting Basics</a> </li><li>  <a href="https://habrahabr.ru/post/336166/">Materials</a> </li><li>  <a href="https://habrahabr.ru/post/337550/">Texture Cards</a> </li><li>  <a href="https://habrahabr.ru/post/337642/">Sources of light</a> </li><li>  <a href="https://habrahabr.ru/post/338254/">Multiple light sources</a> </li></ol><br>  Part 3. Loading 3D Models <br><br><ol><li>  <a href="https://habrahabr.ru/post/338436/">Assimp library</a> </li><li>  <a href="https://habrahabr.ru/post/338436/">Mesh mesh class</a> </li><li>  <a href="https://habrahabr.ru/post/338998/">Model class</a> </li></ol><br>  Part 4. OpenGL advanced features <br><br><ol><li>  <a href="https://habrahabr.ru/post/342610/">Depth test</a> </li><li>  <a href="https://habrahabr.ru/post/344238/">Stencil test</a> </li><li>  <a href="https://habrahabr.ru/post/343096/">Mixing colors</a> </li><li>  <a href="https://habrahabr.ru/post/346964/">Face clipping</a> </li><li>  <a href="https://habrahabr.ru/post/347354/">Cadre buffer</a> </li></ol></div></div><br><h3>  Directional light source </h3><br>  If the light source is significantly removed from the object of observation, then the incoming rays of light are practically parallel to each other, giving the impression that the light is directed equally regardless of the location of the object and / or observer.  A simulated infinitely distant light source is called a directional, since all its rays are considered to go in one direction and do not depend on the location of the source itself. <br>  A good example of this type of source is our sun.  Suppose it is not infinitely distant from us, but this distance is enough to consider it infinitely remote in the calculations of illumination.  And assume that the rays of sunlight are parallel, as shown in the figure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/a77/4f3/195/a774f31957874c5a90dc009191b8e993.png"></div><br>  Since we consider the rays parallel, the mutual arrangement of the illuminated object and the source is not important - the direction of the rays will be the same throughout the scene.  Accordingly, the calculation of lighting will be the same for all objects, since the direction vector of the lighting is the same for any object in the scene. <br><br>  To model a directional source, we can specify the direction vector of the light, and the position vector is no longer needed.  The model of calculations in the shader remains almost unchanged: the calculation of the source direction vector <i>lightDir</i> using the source position vector is replaced by the direct use of the specified direction vector <i>direction</i> . <br><br><pre><code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Light</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// vec3 position; //    . vec3 direction; vec3 ambient; vec3 diffuse; vec3 specular; }; ... void main() { vec3 lightDir = normalize(-light.direction); ... }</span></span></code> </pre> <br>  Notice the inverse of the <i>light.direction</i> vector.  Until now, the computation model accepted the direction vector of the light source as oriented from the fragment <b>to the source</b> , but for directional sources the direction vector is usually set as oriented <b>from the source</b> .  Therefore, an inversion is performed, and in a variable we save the vector directed to the light source.  Also do not forget about the normalization - it is better not to hope that the input data will be normalized. <br><br>  So, as a result, <i>lightDir is</i> used in the calculations of the diffuse and specular component in the same way as before. <br><br>  In order to demonstrate that the directional source equally affects the illumination of many objects, we will use the familiar scene code with a crowd of containers from the final of the <a href="https://habrahabr.ru/post/324968/">Coordinate Systems</a> lesson.  For those who missed: first we set <a href="https://learnopengl.com/code_viewer.php%3Fcode%3Dlighting/light_casters_container_positions">10 different positions of</a> containers and set each of them on a unique model matrix that stores the corresponding transformations from the local coordinate system to the world: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { glm::<span class="hljs-function"><span class="hljs-function">mat4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; model = glm::translate(model, cubePositions[i]); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> angle = <span class="hljs-number"><span class="hljs-number">20.0f</span></span> * i; model = glm::rotate(model, glm::radians(angle), glm::vec3(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>)); lightingShader.setMat4(<span class="hljs-string"><span class="hljs-string">"model"</span></span>, model); glDrawArrays(GL_TRIANGLES, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>); }</code> </pre> <br>  Also, do not forget to pass the direction of our directional source to the shader (once again I remind you that we set the direction from the source; by the form of the vector you can determine that it is directed downwards): <br><br><pre> <code class="cpp hljs">lightingShader.setVec3(<span class="hljs-string"><span class="hljs-string">"light.direction"</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>);</code> </pre> <br><blockquote>  So far, we have transmitted the positions and directions as three-component vectors ( <i>vec3</i> ), however some developers prefer transmission in the form of vectors with four components ( <i>vec4</i> ).  When specifying positions with the help of <i>vec4,</i> it is extremely important to set the component <i>w</i> to 1 so that the transfer and projection transformations are correctly applied.  At the same time, when specifying directions in the form of vec4, we would not want the transfer to affect the direction (this is the direction vector, after all), and therefore we must set <i>w = 0</i> . <br><br>  Thus, the direction vector is represented as <i>vec4 (0.2f, 1.0f, 0.3f, 0.0f)</i> .  Such a record can also be used for an affordable check on the type of light source and the choice of the lighting calculation model: if the component <i>w</i> is 1, then this is clearly the position vector of the light source, if <i>w</i> is 0, then we have the direction vector: <br><br><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lightVector.w == <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) /<span class="hljs-regexp"><span class="hljs-regexp">/      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       else if(lightVector.w == 1.0) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/        /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ (   )</span></span></code> </pre> <br>  Fun fact: this is how OpenGL defined the light source as directional or positioned and changed the calculation model during the fixed-pipeline times (fixed-functionality). <br></blockquote>  If we now assemble our application, then moving around the scene, we can see that all objects are illuminated by a source that is similar to the sun in its behavior.  See how the diffuse and specular component of illumination on objects changes as if a source of light is located somewhere in the conventional sky?  The results should be something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/b48/38c/12b/b4838c12b41446a191d3531f1b54a356.png"></div><br>  The source code of the sample can be found <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/2.lighting/5.1.light_casters_directional/light_casters_directional.cpp">here</a> . <br><br><h3>  Point sources </h3><br>  Directional light sources do a good job with lighting the entire scene, but usually we need to place a few more point sources in the scene space.  A point light source has a predetermined position in space and radiates uniformly in all directions, and the illumination intensity decreases with distance.  Conventional incandescent lamps or torches can be cited as an example of point sources. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/f39/7c8/f3c/f397c8f3c34248af9357e6c40515fd69.png"></div><br>  In previous lessons we used the simplest implementation of a point source with a given position, which spreads light in all directions.  However, the rays of this source did not fade with removal, which made the source look extremely powerful.  In most scenes created, it would be desirable to have sources that affect the environment in close proximity to them, but not to the whole scene at once. <br><br>  If you add 10 containers to the scene of the previous example, you will notice that even the most distant ones are lit with the same intensity as those directly in front of the source.  And this is expected - we did not take into account any expressions that control the intensity of illumination.  But we want the removed containers to be only slightly highlighted compared to those closest to the source. <br><br><h4>  Attenuation </h4><br>  Attenuation of light intensity with distance is called attenuation.  The simplest method for calculating attenuation is using a linear law.  In this case, the intensity will linearly decrease with distance, providing less illumination of distant objects.  But visually this model gives unrealistic results.  In the general case, real light sources give strong illumination in the vicinity, but the intensity rather sharply decreases in a small radius and then its remaining stock slowly decreases with distance.  To imitate such behavior, a calculation is needed that is sharper than linear. <br>  Fortunately, physicists are not asleep, and the generalized expression for calculating the attenuation coefficient from distance has long been derived.  It remains only to calculate the value for each fragment and multiply the intensity vector of a specific source by the result: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-msubsup" id="MJXp-Span-3"><span class="MJXp-mrow" id="MJXp-Span-4" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">F</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-6" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">t</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-11">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">c</span><span class="MJXp-mrow" id="MJXp-Span-16"><span class="MJXp-mn" id="MJXp-Span-17">1.0</span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mrow" id="MJXp-Span-19"><span class="MJXp-msubsup" id="MJXp-Span-20"><span class="MJXp-mrow" id="MJXp-Span-21" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-23" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">c</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-26"><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mrow" id="MJXp-Span-28" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-30" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">l</span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">d</span><span class="MJXp-mo" id="MJXp-Span-33" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-34"><span class="MJXp-msubsup" id="MJXp-Span-35"><span class="MJXp-mrow" id="MJXp-Span-36" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-38" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">q</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-40"><span class="MJXp-msubsup" id="MJXp-Span-41"><span class="MJXp-mrow" id="MJXp-Span-42" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">d</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-44" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-45">2</span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="32.742ex" height="3.142ex" viewBox="0 -987.6 14097.2 1352.7" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-46" x="0" y="0"></use><g transform="translate(643,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="529" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="890" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-3D" x="1906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-66" x="3213" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-72" x="3763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-61" x="4215" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-63" x="4744" y="0"></use><g transform="translate(5178,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-30" x="779" y="0"></use></g><g transform="translate(6457,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-63" x="1201" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2B" x="1478" y="0"></use><g transform="translate(2478,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-6C" x="1201" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-64" x="3639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2B" x="4385" y="0"></use><g transform="translate(5385,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-71" x="1201" y="-213"></use></g><g transform="translate(6661,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-32" x="741" y="596"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> {{F} _ {att}} = \ frac {1.0} {{{K} _ {c}} + {{K} _ {l}} d + {{K} _ {q}} {{d} ^ {2}}} </script></p>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-46"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.057ex" viewBox="0 -780.1 523.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-64" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> d </script>  - the distance from the fragment to the source, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-48"><span class="MJXp-msubsup" id="MJXp-Span-49"><span class="MJXp-mrow" id="MJXp-Span-50" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-52" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">c</span></span></span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mrow" id="MJXp-Span-56" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">l</span></span></span><span class="MJXp-mo" id="MJXp-Span-60" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-61"><span class="MJXp-mrow" id="MJXp-Span-62" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-64" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65">q</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.642ex" height="2.66ex" viewBox="0 -780.1 4582.1 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-63" x="1201" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2C" x="1256" y="0"></use><g transform="translate(1701,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-6C" x="1201" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2C" x="2861" y="0"></use><g transform="translate(3306,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-71" x="1201" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> {K} _ {c}, {K} _ {l}, {K} _ {q} </script>  - constant, linear and quadratic coefficients. <br><br><ul><li>  The constant coefficient is, as usual, equal to 1.0, performing protection against reducing the value of the denominator to values ‚Äã‚Äãless than unity, which would lead to an increase in the illumination intensity at certain distances.  For us, this effect is undesirable. </li><li>  The linear coefficient determines the term that linearly reduces the intensity of light with increasing distance. </li><li>  The quadratic coefficient determines the term defining the quadratic intensity decrease.  At small distances, the contribution of the quadratic term will be covered by the linear contribution, but with increasing distance it will become dominant in the expression. </li></ul><br>  The combination of linear and quadratic dependence allows you to create an effect when the intensity decreases linearly near the source, and after a certain removal line begins to subside much faster.  As a result, the brightness of the source is high near, decreases rather rapidly with increasing distance, and at large distances decreases more slowly.  The following graph shows an example of the attenuation coefficient over 100 units of distance: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/9bf/6a3/76f/9bf6a376f62b48dea73ce0f4a35ee57b.png"></div><br>  As can be seen, the intensity is greatest at small distances, but with growth it decreases significantly and tends to zero in the vicinity of 100 units. <br><br><h4>  Selection of coefficients </h4><br>  There is a question of choosing three factors. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-66"><span class="MJXp-msubsup" id="MJXp-Span-67"><span class="MJXp-mrow" id="MJXp-Span-68" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-70" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">c</span></span></span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mrow" id="MJXp-Span-74" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-76" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">l</span></span></span><span class="MJXp-mo" id="MJXp-Span-78" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mrow" id="MJXp-Span-80" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">K</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-82" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83">q</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.642ex" height="2.66ex" viewBox="0 -780.1 4582.1 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-63" x="1201" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2C" x="1256" y="0"></use><g transform="translate(1701,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-6C" x="1201" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMAIN-2C" x="2861" y="0"></use><g transform="translate(3306,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-71" x="1201" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> {K} _ {c}, {K} _ {l}, {K} _ {q} </script>  .  Suitable values ‚Äã‚Äãare searched based on the environment being developed in the scene, the required lighting distance, type of source, and other factors.  In most cases, this becomes a matter of experience and a certain amount of adjustment by trial and error.  The table below contains a list of parameters that provide a realistic, in a certain sense, behavior of a light source covering a specified distance.  The first column indicates the distance of coverage at fixed coefficients.  The table is taken from the <a href="http://www.ogre3d.org/tikiwiki/tiki-index.php%3Fpage%3D-Point%2BLight%2BAttenuation">wiki page</a> of the Ogre3D engine and is an excellent starting point for selecting the values ‚Äã‚Äãyou need. <br><table><tbody><tr><th>  Distance </th><th>  Constant </th><th>  Linear </th><th>  Quadratic </th></tr><tr><td>  7 </td><td>  1.0 </td><td>  0.7 </td><td>  1.8 </td></tr><tr><td>  13 </td><td>  1.0 </td><td>  0.35 </td><td>  0.44 </td></tr><tr><td>  20 </td><td>  1.0 </td><td>  0.22 </td><td>  0.20 </td></tr><tr><td>  32 </td><td>  1.0 </td><td>  0.14 </td><td>  0.07 </td></tr><tr><td>  50 </td><td>  1.0 </td><td>  0.09 </td><td>  0.032 </td></tr><tr><td>  65 </td><td>  1.0 </td><td>  0.07 </td><td>  0.017 </td></tr><tr><td>  100 </td><td>  1.0 </td><td>  0.045 </td><td>  0.0075 </td></tr><tr><td>  160 </td><td>  1.0 </td><td>  0.027 </td><td>  0.0028 </td></tr><tr><td>  200 </td><td>  1.0 </td><td>  0.022 </td><td>  0.0019 </td></tr><tr><td>  325 </td><td>  1.0 </td><td>  0.014 </td><td>  0.0007 </td></tr><tr><td>  600 </td><td>  1.0 </td><td>  0.007 </td><td>  0.0002 </td></tr><tr><td>  3250 </td><td>  1.0 </td><td>  0.0014 </td><td>  0.000007 </td></tr></tbody></table><br>  As you can see, the constant coefficient is everywhere equal to one.  The linear coefficient is chosen small when illuminating large distances, and the quadratic coefficient is even smaller.  Try experimenting with these values ‚Äã‚Äãand personally see what effect their change has on your implementation.  For the scenes in question, the coverage distance is from 32 to 100 units.  quite enough. <br><br><h4>  Implementation </h4><br>  To implement the attenuation, we need three additional parameters in the fragment shader code: the actual, constant, linear, and quadratic coefficients.  It is most logical to store them as part of the declared <i>Light</i> structure that we used earlier.  Note that the calculation of the <i>lightDir</i> vector <i>is</i> carried out similarly to the previous lesson, and not by the method described in the directional light source section. <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Light</span></span></span><span class="hljs-class"> {</span></span> vec3 position; vec3 ambient; vec3 diffuse; vec3 specular; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> constant; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> linear; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> quadratic; };</code> </pre> <br>  Next, set the specific values ‚Äã‚Äãof the parameters in the code.  We will need a lighting distance of about 50 units, for which the following values ‚Äã‚Äãare given in the table: <br><br><pre> <code class="cpp hljs">lightingShader.setFloat(<span class="hljs-string"><span class="hljs-string">"light.constant"</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); lightingShader.setFloat(<span class="hljs-string"><span class="hljs-string">"light.linear"</span></span>, <span class="hljs-number"><span class="hljs-number">0.09f</span></span>); lightingShader.setFloat(<span class="hljs-string"><span class="hljs-string">"light.quadratic"</span></span>, <span class="hljs-number"><span class="hljs-number">0.032f</span></span>);</code> </pre> <br>  The calculation code in the fragment shader is obvious: we calculate the attenuation coefficient and then multiply the background, diffuse and specular lighting components by it. <br><br>  For calculations, however, we need the value of the distance from the fragment to the light source.  How do we get it?  It's simple: just calculate the difference of the position vector of the fragment and the source, and use the built-in GLSL function <i>length ()</i> : <br><br><pre> <code class="hljs swift">float <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> = length(light.position - <span class="hljs-type"><span class="hljs-type">FragPos</span></span>); float attenuation = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / (light.constant + light.linear * <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> + light.quadratic * (<span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span>));</code> </pre> <br>  As a result, we multiply the coefficient obtained by all the components of the lighting model. <br><blockquote>  It would be possible to leave the background component without fading, however, in scenes with several sources, the contribution of this component will begin to add up, which is usually undesirable.  In this case, attenuation is also included for the background component. <br></blockquote><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ambient</span></span> *= attenuation; <span class="hljs-attribute"><span class="hljs-attribute">diffuse</span></span> *= attenuation; <span class="hljs-attribute"><span class="hljs-attribute">specular</span></span> *= attenuation;</code> </pre> <br>  By running the test application, you can expect something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/ba7/79d/3c2/ba779d3c2dfc423196102c59e32ea26a.png"></div><br><br>  It can be seen that now only the containers in front are highlighted, and the closest one is the brightest.  The containers in the back of the stage are not illuminated at all, because they are too far from the source. <br><br>  Full sample code can be found <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/2.lighting/5.2.light_casters_point/light_casters_point.cpp">here</a> .  Summing up, we can say that the point source we call a source with adjustable position and taking into account the attenuation of the intensity in the calculations of illumination.  Another tool in our piggy bank! <br><br><h3>  Spotlight </h3><br>  The last considered source type will be a spotlight.  Such a source has a predetermined position, but radiates not in all directions, but only in the selected one.  At the same time, objects are illuminated only in a small neighborhood from a given direction, while objects lying outside this area remain without illumination.  As an example, imagine a street lamp or a hand torch. <br><br>  In our model, the searchlight will be represented by the position in world coordinates, the direction vector and the <b>cut-off angle</b> , which determines the radius of illumination of the searchlight.  To determine whether a fragment is highlighted or not, we will calculate whether it is inside or outside the cone-shaped source cut-off zone.  This scheme will help to figure out how everything works: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/bf0/a7d/937/bf0a7d93705d4514be398d27b72a2736.png"></div><br>  Here <i>LightDir</i> is the vector directed from the fragment to the source, <i>SpotDir</i> is the vector of the direction of the searchlight, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-mtext" id="MJXp-Span-85">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.891ex" height="2.419ex" viewBox="0 -780.1 1675.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-68" x="753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-69" x="1330" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> \ phi </script>  ( <i>phi</i> ) - clipping angle that determines the radius of the backlight (fragments outside this angle will not be highlighted) <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-89"><span class="MJXp-mtext" id="MJXp-Span-90">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.912ex" height="2.057ex" viewBox="0 -780.1 2545.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-68" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-65" x="1188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="1654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-61" x="2016" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ theta </script>  ( <i>theta</i> ) - the angle between the <i>LightDir</i> and <i>SpotDir vectors</i> (if <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-96"><span class="MJXp-mtext" id="MJXp-Span-97">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.912ex" height="2.057ex" viewBox="0 -780.1 2545.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-68" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-65" x="1188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-74" x="1654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/337642/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhh91fUwrMciVbyPaqnYQdy2gcZKtg#MJMATHI-61" x="2016" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> \ theta </script>  less than <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mtext" id="MJXp-Span-104">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> \ phi </script>  , the fragment falls into the backlight zone). <br><br>  Thus, all that needs to be done is to calculate the scalar product of the vectors <i>LightDir</i> and <i>SpotDir</i> and compare the value obtained with the specified cut-off angle (with the cosine of the angle, because scalar multiplication returns the cosine of the angle between two normalized vectors).  Now that you have a basic understanding of the device of the searchlight, you can proceed to the implementation. <br><br><h4>  Implementation </h4><br>  Let's bring the model to life in the form of a flashlight, i.e.  source recorded at the position of the observer and directed straight ahead from his point of view.  In fact, a flashlight is a source of the type of searchlight, with a position and direction rigidly attached to the position and orientation of the player. <br><br>  To transfer to the shader, we need the position values ‚Äã‚Äã(to calculate the vector to the light source), the direction vector of the spotlight and the clipping angle.  All this can be put into the <i>Light</i> structure: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Light</span></span></span><span class="hljs-class"> {</span></span> vec3 position; vec3 direction; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cutOff; ... };</code> </pre> <br>  Next, we transfer the data to the shader in the program code: <br><br><pre> <code class="cpp hljs">lightingShader.setVec3(<span class="hljs-string"><span class="hljs-string">"light.position"</span></span>, camera.Position); lightingShader.setVec3(<span class="hljs-string"><span class="hljs-string">"light.direction"</span></span>, camera.Front); lightingShader.setFloat(<span class="hljs-string"><span class="hljs-string">"light.cutOff"</span></span>, glm::<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(glm::radians(<span class="hljs-number"><span class="hljs-number">12.5f</span></span>)));</code> </pre> <br>  As you can see, here we are not transmitting the cut-off angle, but its cosine, since in the shader we calculate the scalar product of vectors, which returns the cosine of the angle between them.  In order to avoid calculating the cosine angle with the call to the expensive <i>acos ()</i> function, we will pass the finished cosine of the cut-off angle to the shader and compare these values ‚Äã‚Äãdirectly, saving some computational resources. <br><br>  Actually, we will calculate and determine whether we are inside the zone of the searchlight or not: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> theta = <span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(lightDir, <span class="hljs-keyword"><span class="hljs-keyword">normalize</span></span>(-light.direction)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(theta &gt; light.cutOff) { <span class="hljs-comment"><span class="hljs-comment">//   } //     ,     //      else color = vec4(light.ambient * vec3(texture(material.diffuse, TexCoords)), 1.0);</span></span></code> </pre> <br>  First, we compute the scalar product of the vectors of <i>LightDir</i> and the inverted vector of <i>direction</i> (since we need a vector directed to the source, not from it).  Do not forget to normalize all used vectors! <br><blockquote>  You may be surprised at the use of the comparison sign ‚Äú&gt;‚Äù instead of ‚Äú&lt;‚Äù in the conditional operator.  It seems <i>theta</i> must be less than the cut-off value so that the fragment is in the cone of the action of the searchlight?  That's right, but we are not comparing the corners here, but their cosines.  The cosine of 0 ¬∞ is 1, and 90 ¬∞ is 0. Look at the graph: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/690/a13/1a8/690a131a857546ba9861a57f571715b3.png"></div><br>  Obviously, the cosine value tends to 1 as the angle decreases, which explains why theta should be greater than the cut-off value.  In this example, the cutoff value is equal to the cosine of an angle of 12.5 ¬∞, which is equal to 0.9978.  Accordingly, the fragment will be in the backlight cone, if the <i>theta</i> value is in the range from 0.9978 to 1.0. <br></blockquote>  The launch of the test application will show that now only those fragments are highlighted that lie inside the searchlight cone: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/ab6/14f/b92/ab614fb9244d4d94ba017e4033c6e6e8.png"></div><br>  The complete example code is <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/2.lighting/5.3.light_casters_spot/light_casters_spot.cpp">here</a> . <br><br>  The results, however, are not impressive.  The hard, sharp edges of the highlighted area look especially unrealistic.  Fragments that have fallen from the spotlight cone are shaded instantly, without a decrease in brightness.  It is realistic to smoothly reduce the illumination intensity in the cut-off zone. <br><br><h4>  Smooth attenuation </h4><br>  To implement a spotlight with soft edges of the backlight zone, we will need to specify the inner and outer cones of this zone.  The inner cone can be determined based on the data discussed in the previous section.  From its borders to the borders of the outer cone, the intensity should fade out smoothly. <br><br>  The outer cone is determined by the cosine of the angle of the solution of this cone.  As a result, for a fragment that is in the gap between the boundaries of two cones, the illumination intensity between 0.0 and 1.0 should be calculated.  Fragments lying in the inner cone are always illuminated with an intensity of 1.0, and those outside the outer cone are not illuminated at all. <br><br>  You can calculate the parameter that determines the smooth decrease in intensity using the following formula: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">I</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-111">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">c</span><span class="MJXp-mrow" id="MJXp-Span-116"><span class="MJXp-mtext" id="MJXp-Span-117">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">a</span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">a</span></span><span class="MJXp-mrow" id="MJXp-Span-130"><span class="MJXp-mtext" id="MJXp-Span-131">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">n</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> I = \ frac {\ theta - \ gamma} {\ varepsilon} </script></p>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-142"><span class="MJXp-mtext" id="MJXp-Span-143">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-154" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156"><font style="vertical-align: inherit;">p </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157"><font style="vertical-align: inherit;">h </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;">- </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161"><font style="vertical-align: inherit;">g </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163"><font style="vertical-align: inherit;">m </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164"><font style="vertical-align: inherit;">m </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165"><font style="vertical-align: inherit;">a</font></span></font><span class="MJXp-mtext" id="MJXp-Span-155">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-160">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> \ varepsilon = \ phi - \ gamma </script>  - the difference of cosines of the angles defining the internal ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-166"><span class="MJXp-mtext" id="MJXp-Span-167">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> \ phi </script>  ) and external ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-171"><span class="MJXp-mtext" id="MJXp-Span-172">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> \ gamma </script>  ) cones, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> I </script>  - coefficient of the intensity of illumination for this fragment. <br><br>  Practically, it can be difficult to imagine how a given expression behaves, so consider a couple of examples: <br><table><tbody><tr><th>  Œ∏ </th><th>  Œò ¬∞ </th><th>  œï (internal) </th><th>  œï ¬∞ </th><th>  Œ≥ (external) </th><th>  Œ≥ ¬∞ </th><th>  Œµ </th><th>  I </th></tr><tr><td>  0.87 </td><td>  thirty </td><td>  0.91 </td><td>  25 </td><td>  0.82 </td><td>  35 </td><td>  0.91 - 0.82 = 0.09 </td><td>  0.87 - 0.82 / 0.09 = 0.56 </td></tr><tr><td>  0.9 </td><td>  26 </td><td>  0.91 </td><td>  25 </td><td>  0.82 </td><td>  35 </td><td>  0.91 - 0.82 = 0.09 </td><td>  0.9 - 0.82 / 0.09 = 0.89 </td></tr><tr><td>  0.97 </td><td>  14 </td><td>  0.91 </td><td>  25 </td><td>  0.82 </td><td>  35 </td><td>  0.91 - 0.82 = 0.09 </td><td>  0.97 - 0.82 / 0.09 = 1.67 </td></tr><tr><td>  0.83 </td><td>  34 </td><td>  0.91 </td><td>  25 </td><td>  0.82 </td><td>  35 </td><td>  0.91 - 0.82 = 0.09 </td><td>  0.83 - 0.82 / 0.09 = 0.11 </td></tr><tr><td>  0.64 </td><td>  50 </td><td>  0.91 </td><td>  25 </td><td>  0.82 </td><td>  35 </td><td>  0.91 - 0.82 = 0.09 </td><td>  0.64 - 0.82 / 0.09 = -2.0 </td></tr><tr><td>  0.966 </td><td>  15 </td><td>  0.9978 </td><td>  12.5 </td><td>  0.953 </td><td>  17.5 </td><td>  0.966 - 0.953 = 0.0448 </td><td>  0.966 - 0.953 / 0.0448 = 0.29 </td></tr></tbody></table><br>  As you can see, this is a simple interpolation operation between the cosine of the external and internal cut-off angle depending on the value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-180"><span class="MJXp-mtext" id="MJXp-Span-181">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> \ theta </script>  .  If now it is not clear what is happening, then do not worry - you can simply take the formula as a given and return to it after a year as an experienced and sophisticated person. <br><br>  One problem - value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> I </script>  now it turns out to be less than zero in the region outside the outer cone, greater than one in the region of the inner cone and intermediate values ‚Äã‚Äãbetween the boundaries.  It is necessary to correctly limit the range of values ‚Äã‚Äãin order to eliminate the need for conditional operators and simply multiply the components of the lighting model by the calculated intensity value: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> theta = <span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(lightDir, <span class="hljs-keyword"><span class="hljs-keyword">normalize</span></span>(-light.direction)); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> epsilon = light.cutOff - light.outerCutOff; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> intensity = <span class="hljs-keyword"><span class="hljs-keyword">clamp</span></span>((theta - light.outerCutOff) / epsilon, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">// we'll leave ambient unaffected so we always have a little light. diffuse *= intensity; specular *= intensity; ...</span></span></code> </pre> <br>  Pay attention to the function <i>clamp ()</i> , which limits the range of values ‚Äã‚Äãof its first parameter to the values ‚Äã‚Äãof the second and third parameters.  In this case, the <i>intensity</i> value will lie on the segment [0, 1]. <br><br>  Do not forget to add the <i>outerCutOff</i> parameter to the <i>Light</i> structure and configure the transfer of a specific value to the uniform variable of the shader.  For this image, the inside angle is set at 12.5 ¬∞, and the outside angle is 17.5 ¬∞: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/1fb/afd/2e1/1fbafd2e17494e41afe894ef6d0f3cfb.png"></div><br>  Much better!  Now you can play with the settings of the clipping zones and get a spotlight that is perfect for your task.  The source code of the application can be found <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/2.lighting/5.4.light_casters_spot_soft/light_casters_spot_soft.cpp">here</a> . <br><br>  This type of flashlight source is ideal for horror games, and in combination with directional and point sources, the scenes you create will be radically transformed. <br><br>  In the next lesson, we will try to use all the types of sources and graphic techniques that are currently considered. <br><br><h2>  Tasks </h2><br>  Try experimenting with all the types of sources described and their fragment shaders.  Invert some vectors and / or change the comparison signs.  Understand for yourself the results of such actions. <br><br>  <a href="https://learnopengl.com/Lighting/Light-casters">Original article</a> . </div><p>Source: <a href="https://habr.com/ru/post/337642/">https://habr.com/ru/post/337642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337630/index.html">AMD is preparing to press Intel in the market of server solutions</a></li>
<li><a href="../337632/index.html">PostgreSQL: materialized views and FDW</a></li>
<li><a href="../337634/index.html">How we cheat customers. Software as a Service</a></li>
<li><a href="../337636/index.html">We have nothing to hide - everything is fair in the HPE 3PAR Data Reduction Guarantee</a></li>
<li><a href="../337640/index.html">Survey: Does the creator of the product need additional study in order to conduct user research?</a></li>
<li><a href="../337644/index.html">tig - we improve productivity of work with git</a></li>
<li><a href="../337646/index.html">Technocup 2017-2018</a></li>
<li><a href="../337648/index.html">A curious feature of the Java language and insidious errors that it may cause</a></li>
<li><a href="../337652/index.html">Platform for collecting donations in two weeks - the results of anti-hacking</a></li>
<li><a href="../337654/index.html">Read user input (digits) in the 3CX Call Flow Designer application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>