<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RedBeanPHP - CodeFirst PHP Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will discuss a very interesting ORM framework RedBeanPHP . It is remarkable, above all, the ability to create a database structure on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RedBeanPHP - CodeFirst PHP Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/8ce/760/d3b/8ce760d3b77af1dbe25300a1d17af7e2.jpg" alt="RedBeanPHP"><br>  In this post we will discuss a very interesting ORM framework <a href="http://redbeanphp.com/">RedBeanPHP</a> .  It is remarkable, above all, the ability to create a database structure on the fly.  In addition, the framework is easy to use as a penny.  My story will be divided into 3 parts. <br>  In the second part, the main topic will be the models.  In the third - change the logic of the framework. <br><br>  Before writing a post, I took the trouble and made a <a href="http://apps.facebook.com/insp_social_commerce/%3Ffb_source%3Dsearch%26ref%3Dts">test application</a> with 15,000 entries, in order to be convinced in my experience of the possibility of incredibly easy work.  After all, I probably am not the only one who prescribes the fields in several places with a terrible awareness of the meaninglessness of this work, especially at the initial stage of development.  Finally, an analogue of Entity Framework Code First from .NET appeared, which at one time made me wildly delighted.  So in order. <br><a name="habracut"></a><br><h4>  Origins </h4><br>  This miracle is written by a man with the equally wonderful name Gabor.  Gabor is a failed student who has studied cognitive psychology.  The failure happened because of the banal lack of demand for these specialists, but still ready to admit that Gabor is a very good psychologist.  Using the framework does not leave me feeling simple and obvious what is happening. <br><br><h4>  Start </h4><br>  To connect you need to add only one file, which contains all the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rb.php'</span></span>);</code> </pre> <br>  Quite simply, isn't it?  Let's look inside and find that the data file weighs 260 kilobytes and is a version of the framework assembled from a variety of files.  On GitHub, you can download a regular version of about 40 files.  In this case, you need the following code to connect: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'redbean.inc.php'</span></span>);</code> </pre><br><h4>  Structure </h4><br>  The framework has a well-organized class structure.  The structure includes drivers for PDO and Oracle.  This means that RedBeanPHP supports a wide range of databases.  The documentation indicates support for the following databases: MySQL 5, SQLite, PostgreSQL, CUBRID, Oracle.  Support for the latter is not included in rb.php, it must be downloaded from GitHub separately.  But no one bothers us to write our own driver, inheriting from the class RedBean_Driver. <br>  And in order to modify the internal logic of the framework, you need to create your own version of QueryWriter.  I will discuss this topic in detail in the third part of the review. <br>  The framework supports Plugins, and has a simple Logger class for displaying all framework requests to the base on the screen.  I did not find an entry in the file, but I don‚Äôt have any problems inheriting my own class. <br>  Here is the code of the logger coming in the delivery: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedBean_Logger_Default</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedBean_Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (func_num_args() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (func_get_args() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $argument) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($argument)) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> print_r($argument,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $argument; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;br&gt;\n"</span></span>; } } } }</code> </pre><br>  All files are well documented using PHPDocs.  Hints in the IDE work fine, with the exception of the object fields associated with the table columns. <br><br><h4>  Using </h4><br>  To connect, you must specify the PDO format string: <br><br><pre> <code class="php hljs">R::setup(<span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=mydatabase'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>,<span class="hljs-string"><span class="hljs-string">'password'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//mysql R::setup('pgsql:host=localhost;dbname=mydatabase', 'user','password'); //postgresql R::setup('sqlite:/tmp/dbfile.txt', 'user','password'); //sqlite</span></span></code> </pre><br>  An example of creating a new record and a new table in the event of its absence (only in fluid mode): <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   (bean)    book $book = R::dispense( 'book' ); //   ,          $book-&gt;title = 'Gifted Programmers'; $book-&gt;author = 'Charles Xavier'; $book-&gt;price = 99.99; //,   id   $id = R::store($book);</span></span></code> </pre><br>  And so the existing ‚Äúbean‚Äù is loaded. <br><br><pre> <code class="php hljs">$book = R::load(<span class="hljs-string"><span class="hljs-string">'book'</span></span>, $id);</code> </pre><br>  The author calls bean'mi objects (bin - English bean plants) containing data.  This object is not a model and has the goal of simply storing data and working with records in the database.  How to associate a model containing business logic with them will be described in the second part of the review. <br><br>  The framework decides whether to create or update a record by the presence of the id field of the object.  How to change this logic, I will show in the third part. <br><br>  The search for a bean occurs by specifying the WHERE expression: <br><br><pre> <code class="php hljs">$needles = R::find(<span class="hljs-string"><span class="hljs-string">'needle'</span></span>, <span class="hljs-string"><span class="hljs-string">' haystack = :haystack ORDER BY :sortorder'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">':sortorder'</span></span>=&gt;$sortorder, <span class="hljs-string"><span class="hljs-string">':haystack'</span></span>=&gt;$haystack ) );</code> </pre><br>  In the same place, in the second parameter, you can specify the ORDER BY and LIMIT constructs. <br><br><h4>  Connections </h4><br>  Working with a relational database implies connectivity between tables.  RedBeanPHP supports all necessary types of links.  To create a one-to-many relationship, we use the property with the prefix own. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  bean    village $village = R::dispense('village'); //  bean'    building list($mill,$tavern) = R::dispense('building',2); //      bean     own $village-&gt;ownBuilding = array($mill,$tavern); R::store($village);</span></span></code> </pre><br>  A table will be created in the database.  The village_id field will be added to the building table, indicating the id field of the village table.  It will also create a link in the parent table and create the necessary indexes.  The link will have a cascade update and delete property. <br><br>  If you look at the other side of the connection, it is possible to refer to the parent object as follows: <br><br><pre> <code class="php hljs">$village = $mill-&gt;village</code> </pre><br>  RedBeanPHP supports the concept of ‚Äúlazy loading‚Äù.  That is, the loading of related data will occur at the moment of accessing the object field. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    building   $village = R::load('village',$id); //    building $buildings = $village-&gt;ownBuilding;</span></span></code> </pre><br>  Own field is an associative array, so we can replace a separate object: <br><br><pre> <code class="php hljs">$village-&gt;ownBuilding[$id] = $house;</code> </pre><br>  To remove the connection between the objects, you must call the following code (the objects themselves will not be deleted): <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($village-&gt;ownBuilding[$someID]); R::store($village);</code> </pre><br>  To remove the bean and its associated parent objects: <br><br><pre> <code class="php hljs">R::trash( $book ); <span class="hljs-comment"><span class="hljs-comment">//     R::trashAll( $books );</span></span></code> </pre><br>  To clear the table: <br><br><pre> <code class="php hljs">R::wipe( <span class="hljs-string"><span class="hljs-string">'book'</span></span> );</code> </pre><br>  To create a many-to-many relationship, use the property with the prefix shared. <br><br><pre> <code class="php hljs">$army = R::dispense(<span class="hljs-string"><span class="hljs-string">'army'</span></span>); $village-&gt;sharedArmy[] = $army; $village2-&gt;sharedArmy[] = $army;</code> </pre><br>  As a result, an additional table army_village will be created and links and indices will be created.  The rest of the work with shared lists is similar to the own list. <br><br>  Typically, the type of a bean is indicated by the name of an object field. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// $village   village $village = $building-&gt;village</span></span></code> </pre><br>  But sometimes it is necessary to assign bean to fields of an object not following this rule. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($teacher,$student) = R::dispense(<span class="hljs-string"><span class="hljs-string">'person'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); $project-&gt;student = $student; $project-&gt;teacher = $teacher;</code> </pre><br>  When saving, the framework is guided by the type of bean specified in dispence, and both child objects will be saved in the person table, and the student_id and teacher_id fields will be created in the project table. <br>  In this case, when sampling a bean from the database, a non-unambiguous situation can occur, since the framework cannot determine which type is in the $ project-&gt; student and $ project-&gt; teacher fields.  In this case, the type is specified by calling fetchAs: <br><br><pre> <code class="php hljs">$teacher = $project-&gt;fetchAs(<span class="hljs-string"><span class="hljs-string">'person'</span></span>)-&gt;teacher;</code> </pre><br><h5>  Trees </h5><br>  The framework supports one-to-many, many-to-many ring links. <br>  For example, creating a category tree: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//$subbean  $bean   category $subbean = R::dispense('category'); $subbean-&gt;title = $title; $subbean-&gt;url = $url; $subbean-&gt;parent = $bean; R::store($subbean);</span></span></code> </pre><br>  The parent_id field and the necessary links and indexes will be created in the table. <br><br><h4>  Speed ‚Äã‚Äãperformance </h4><br>  Freymfork has 2 modes of operation: fluide and frozen.  In fluide mode of the RedBeanPHP, it will take care of the structure of your table itself, sacrificing speed.  After development is complete, you can increase performance by translating the framework with the frozen mode: <br><br><pre> <code class="php hljs">R::freeze( <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> );</code> </pre><br><h4>  Requests to the database </h4><br>  ORM supports SQL queries. <br><br><pre> <code class="php hljs">R::exec( <span class="hljs-string"><span class="hljs-string">'update page set title="test" where id=1'</span></span> );</code> </pre><br>  The query builder is also present: <br><br><pre> <code class="php hljs">R::$f-&gt;begin() -&gt;select(<span class="hljs-string"><span class="hljs-string">'*'</span></span>)-&gt;from(<span class="hljs-string"><span class="hljs-string">'bean'</span></span>) -&gt;where(<span class="hljs-string"><span class="hljs-string">' field1 = ? '</span></span>)-&gt;put(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)-&gt;get(<span class="hljs-string"><span class="hljs-string">'row'</span></span>);</code> </pre><br><br><h4>  Overview of models </h4><br>  I'll run a little bit in the second part and describe how the model is created in RedBeanPHP. <br><br>  At the beginning you work with bean, without attracting models.  When you need a model, you create a class of the form Model_BeanName, for example Model_User, and there you describe additional logic.  The bean and model are linked automatically. <br><br><pre> <code class="php hljs">$user = R::dispence(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); $user-&gt;modelMethod();</code> </pre><br>  That is, we start with ActiveRecord and, if necessary, expand to models.  The author calls this approach FUSE (English fusion). <br><br>  <b>In the second</b> part, we will continue to talk about the functions of the framework for daily work: <br><ul><li>  Models </li><li>  Transactions </li><li>  and other topics </li></ul><br>  <b>In the third</b> part we will discuss additional features of the RedBeanPHP: <br><ul><li>  Debugging </li><li>  Server for Javascript application. </li><li>  Plugins </li><li>  A practical example of changing internal logic </li><li>  and other topics </li></ul><br><br><h4>  Resources </h4><br>  <a href="http://redbeanphp.com/">RedBeanPHP official website</a> </div><p>Source: <a href="https://habr.com/ru/post/150023/">https://habr.com/ru/post/150023/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150015/index.html">Geo-module for PHP applications</a></li>
<li><a href="../150019/index.html">Runetology (161): Matthew Lannegrand, General Director of Sapato.ru</a></li>
<li><a href="../150020/index.html">5 facts about the Chinese gaming market</a></li>
<li><a href="../150021/index.html">Practical metametamodeling</a></li>
<li><a href="../150022/index.html">Downloading price lists of suppliers in the online store</a></li>
<li><a href="../150025/index.html">Comparison of client-banks of different eras</a></li>
<li><a href="../150027/index.html">Practice refactoring in large projects</a></li>
<li><a href="../150028/index.html">Alarm clock for computer in C #</a></li>
<li><a href="../150030/index.html">CSS slider</a></li>
<li><a href="../150031/index.html">Cach√© + Java + Flex. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>