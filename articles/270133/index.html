<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cocos2d-x - simple game development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 
 This article will discuss the development of a prototype game for Android / Linux using Cocos2d-x . Cocos2d-x is a cross-platform fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cocos2d-x - simple game development</h1><div class="post__text post__text-html js-mediator-article"><h4>  1. Introduction </h4><br>  This article will discuss the development of a prototype game for Android / Linux using <b><a href="http://www.cocos2d-x.org/">Cocos2d-x</a></b> .  Cocos2d-x is a cross-platform framework for creating two-dimensional games and other graphical applications.  It is based on <a href="http://www.cocos2d-iphone.org/">cocos2d-iphone</a> , but instead of Objective-C Cocos2d-x uses C ++.  Applications can be run on platforms: iOS, Android, Windows Phone, OS X, Windows, Linux. <br>  This article is about developing an application for Android / Linux, the development platform is Ubuntu. <br>  Unfortunately, Cocos IDE exists only under Window and Mac, and under the Linux version is not expected, but since I love Ubuntu very much and this is the platform I work with every day, I use to develop <a href="https://www.jetbrains.com/clion/">Clion</a> . <br>  Some parts of this article are translations of the relevant parts of the documentation ( <a href="http://www.cocos2d-x.org/wiki">http://www.cocos2d-x.org/wiki</a> ). <br>  The article is aimed at those who begin their acquaintance with Cocos2d-x.  In it, I will talk about how to create the simplest application with sprites, scenes and how to work with the accelerometer.  This may be a start in order to go further in the future, delving into the Cocos2d-x API. <br><br><h4>  2. Requirements </h4><br>  We define the necessary set of tools that we need. <br>  <b><i>Ubuntu 14.04 - development platform</i></b> <b><i><br></i></b>  <b><i>Cocos2d-x v3.8.1 - <a href="https://cocos2d-x.org/download">https://cocos2d-x.org/download</a></i></b> <b><i><br></i></b>  <b><i>CMake 2.8+</i></b> <b><i><br></i></b>  <b><i>JDK 1.6+</i></b> <b><i><br></i></b>  <b><i>Android SDK</i></b> <b><i><br></i></b>  <b><i>Android NDK r9d +</i></b> <b><i><br></i></b>  <b><i>Apache Ant - to build Android-build</i></b> <b><i><br></i></b>  <b><i>Python 2.7.5</i></b> <b><i><br></i></b>  <b><i>Clion 1.1 - <a href="https://www.jetbrains.com/clion/">www.jetbrains.com/clion</a></i></b> <br><br><h4>  3. Cocos2d-x </h4><br>  Cocos2d-x appeared in 2010, is an open source project, distributed under the <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D1%2586%25D0%25B5%25D0%25BD%25D0%25B7%25D0%25B8%25D0%25B8_MIT">MIT license</a> .  Cocos2d-x allows you to write in languages ‚Äã‚Äãsuch as C ++, Lua and Javascript.  Cocos2d-x is fast, simple and has great features.  Currently, many games written using this framework are in the top of the AppStore and Google Play. <br>  Big guys like <a href="https://www.zynga.com/">Zynga</a> , <a href="http://www.wooga.com/">Wooga</a> , <a href="http://www.glu.com/">Glu</a> , <a href="http://www.bigfishgames.com/">Big Fish Games</a> , <a href="https://www.konami.com/">Konami</a> use Cocos2d-x to develop games. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here I must make a small digression.  The fact is that Cocos2d-x allows you to use C ++ for writing code, and all of this will be built for Android and Linux.  If you use Cocos2d-JS, then you can write to Javascript.  Then in the case of a build for Linux / Ubuntu, the code will be translated into C ++ and then compiled.  This entails many different problems (complicates work with third-party libraries, for example).  In the case of the web, java-script will be executed (by the way, the build time in this case is zero, which is not bad). <br>  If you use Cocos2d-x, then under the web it does not work, but under Linux and Android the code is compiled directly.  For Android, of course, Android NDK is used. <br><br><a name="habracut"></a><br><h5>  Key features: </h5><br><ul><li>  Opengl </li><li>  Scene Management </li><li>  Scene Effects </li><li>  Sprites </li><li>  Visual effects </li><li>  Various actions, such as moving, scaling, turning, etc. </li><li>  Action combinations </li><li>  Menus and buttons </li><li>  Touch processing on mobile devices </li><li>  Sound support </li><li>  Layouts </li><li>  ListView, PageView, ScrollView </li><li>  Button, CheckBox, LoadingBar, Slider, TextField </li></ul><br><br>  References: <br>  <a href="http://www.cocos2d-x.org/wiki/Cocos2d-x">http://www.cocos2d-x.org/wiki/Cocos2d-x</a> <br>  <a href="http://www.cocos2d-x.org/wiki/About_Cocos2d-x">http://www.cocos2d-x.org/wiki/About_Cocos2d-x</a> <br><br><h4>  4. Install and run the application </h4><br>  This part of the article shows how to create and run the first application. <br><br>  First, we need to <a href="http://www.cocos2d-x.org/download">download</a> and unpack <b>Cocos2d-x</b> .  Or you can use the latest version from the repository: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/cocos2d/cocos2d-x.git</code> </pre> <br>  After everything has been successfully downloaded, you need, you need to install all the dependencies.  To do this, you can run the script *: <br><br><pre> <code class="bash hljs">~/work/cocos/cocos2d-x-3.8.1/build/install-deps-linux.sh</code> </pre><br>  <i>* Hereinafter, it is assumed that cocos2d-x-3.8.1 is unpacked into the ~ / work / cocos / cocos2d-x-3.8.1 directory.</i> <br><br>  Or install them manually: <br><div class="spoiler">  <b class="spoiler_title">list</b> <div class="spoiler_text">  libx11-dev <br>  libxmu-dev <br>  libglu1-mesa-dev <br>  libgl2ps-dev <br>  libxi-dev <br>  g + ¬± 4.9 <br>  libzip-dev <br>  libpng12-dev <br>  libcurl4-gnutls-dev <br>  libfontconfig1-dev <br>  libsqlite3-dev <br>  libglew-dev <br>  libssl-dev <br>  glfw3 <br></div></div><br><br>  To install glfw3, you need to run another script. <br><br><pre> <code class="bash hljs">~/work/cocos/cocos2d-x-3.8.1$ tools/travis-scripts/install_glfw.sh</code> </pre><br><br>  After that, run the installation: <br><br><pre> <code class="bash hljs">~/work/cocos/cocos2d-x-3.8.1$ ./setup.py</code> </pre><br><br>  Run cmake to create a makefile: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/work/cocos/cocos2d-x-3.8.1/build mkdir linux-build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> linux-build cmake ../..</code> </pre><br><br>  Now it remains to run the test application: <br><br><pre> <code class="bash hljs">make <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> bin/cpp-tests/ ./cpp-tests</code> </pre><br><br>  Everything.  If everything went well, you should see a test application, something like a demo version.  If everything worked out, then you can go further.  We need to create a project. <br>  To create an application, run: <br><br><pre> <code class="bash hljs">cocos new MyGame -p com.your_company.mygame -l cpp -d NEW_PROJECTS_DIR</code> </pre><br>  where MyGame is the name, cpp is the language.  You can specify js or lua.  But we specify cpp. <br>  Now the project has been created, and we will continue to work with it.  A blank project contains a label and a picture.  You can immediately look at it: <br><br><pre> <code class="bash hljs">cocos run -s ~/work/cocos/MyCompany/MyGame/ -p android</code> </pre><br>  or <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/work/cocos/MyCompany/MyGame cocos run -p linux</code> </pre><br><br>  Here, in fact, you can begin to work. <br><br><h4>  <b>5. Clion</b> </h4><br>  As I already wrote, Cocos IDE is not for Ubuntu, but we don‚Äôt want to write code in notepad?  Fortunately, there is a Clion from Jetbrains. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dda/340/cb2/dda340cb2dc3c88707f03c632653ff7c.png" alt="image"></div><br><br>  Clion supports cmake, which means that simply importing the MyGame project is enough, and you can write code.  And not just write, but also debug it!  True, it all runs under Linux.  But, I think that is enough for the beginning.  After debugging, the Android application can always be built via the console. <br><br>  Learn more about Clion: <a href="http://habrahabr.ru/company/JetBrains/blog/255723/">http://habrahabr.ru/company/JetBrains/blog/255723/</a> <br><br><h4>  <b>6. Basics</b> </h4><br>  So, we downloaded Cocos2d-x, installed all the tools, imported the project into Clion, started it and ... and now it's time to figure out what's what.  Let's start. <br>  Cocos2d-x is a cross-platform game engine.  But what is a game engine?  The game engine provides the overall functionality that all games should have.  It includes components that together allow for faster development.  For example renderer (I do not translate some of the terms in the article, since they are generally accepted. I will not use the word "Activity" either), graphics, collision detection mechanism, physics, sound, animation.  Cocos2d-x provides a simple API for developing cross-platform applications (or rather, allows you to build an application for different platforms). <br>  Cocos2d-x provides such objects as Scene, Transition, Sprite, Menu, Sprite3D, Audio and others. <br><br><h5>  <b>Main components</b> </h5><br>  It may not seem so at the beginning, but actually getting started with Cocos2d-x is very simple.  The core of Cocos2d-x is Scene, Node, Sprite and Action.  Let's see what them them what. <br><br>  Most games look something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ed5/273/27a/ed527327a5ff4e8291fd9e7abd85e550.png"></div><br><br>  Here are all these components: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d2c/494/491/d2c494491ad446849e8cf800e7940b5c.png"></div><br><br><h5>  <b>Director</b> </h5><br>  Director in Cocos2d-x is like a director on the set.  He controls all the objects and tells them what they should do.  Director manages scene changes and transition effects, he is a singleton and is accessible from everywhere (although the movie is probably not the case). <br><br><h5>  <b>Scene</b> </h5><br>  Your game will most likely have a menu, several levels, and a few more screens (‚ÄúYou lost!‚Äù).  Each such screen is a scene (Scene).  Again, like in the movies.  Each movie is divided into scenes - separate parts of one story.  The scene is rendered by the Renderer object.  Renderer is responsible for rendering sprites and other objects of the scene.  For a better understanding of this process, let's talk about Scene Graph. <br><br><h5>  <b>Scene graph</b> </h5><br>  Scene Graph is a data structure that is used in Scene.  Scene Graph contains Nodes.  By the way, Scene Graph is called Scene Graph, but in reality it is a tree. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ab7/495/c75/ab7495c757f9496ca77f8310df8b05d2.jpg"></div><br><br>  This already looks a bit complicated.  You have to ask, what the hell do I need to know about how Scene works inside, if I just need a moving man?  This is important for understanding how the Scene is drawn.  When adding sprites and animations to your games, you need to be sure that you get the result you want. <br>  Cocos2d-x performs a symmetric tree traversal (in which the left subtree is visited first, then the node, then the right subtree).  This means that the right-hand part of the tree will be rendered last, and this means that it will be visible ‚Äúfrom above‚Äù (that is, visually the rest will be under it). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bab/8c7/410/bab8c74105ba434d883352434c692336.png"></div><br><br>  Illustrating this is very easy, let's just take a look at this scene: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e33/453/90f/e3345390f3b84998b82ee4f184617091.png"></div><br><br>  Which is simplified (some of the objects are not sheets, but branches) can be represented as a tree: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/211/261/fd1/211261fd174b458aba31f25100e4d2bd.png"></div><br><br>  An attribute associated with an order is a z-order.  The left side of the tree has a negative z-order, while the right is positive.  You can keep this in mind to avoid mistakes.  Plus, you can add items in any order with the specified z-order, then the items will be sorted automatically. <br><br>  You can consider Scene as a collection of objects (Node).  We split the scene shown above to view the scene graph: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/461/946/328/461946328dd64ca7a774be286fb2b751.png"></div><br><br>  The scene on the left is the nodes that are put together (Node) with different z-order, which determine the order in which they are drawn. <br><br>  You can add an element to the scene by calling the API: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/    z-order ‚àí2, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       scene-&gt;addChild(title_node, ‚àí2); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    z-order ,     ‚Äî 0 scene-&gt;addChild(label_node); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    z-order 1, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       scene-&gt;addChild(sprite_node, 1);</span></span></code> </pre><br><br><h5>  <b>Sprites</b> </h5><br>  All games use sprites.  These are the things that move around the screen.  You can manage them.  The protagonist of the game, most likely, is a sprite.  It is important to note: not every graphic element of the game is a sprite.  If the item does not move around the screen, then this is just a Node. <br>  Take another look at the scene from the game: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1f3/741/fbd/1f3741fbd34e4d369db34845ea65618c.png"></div><br><br>  Sprites are key elements of the game.  Creating a sprite is very easy: <br><br><pre> <code class="hljs erlang-repl">//   auto mySprite = Sprite::create(<span class="hljs-string"><span class="hljs-string">"mysprite.png"</span></span>); //     mySprite-&gt;setPosition(Vec2(<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); //   mySprite-&gt;setRotation(<span class="hljs-number"><span class="hljs-number">40</span></span>); mySprite-&gt;setScale(<span class="hljs-number"><span class="hljs-number">2.0</span></span>); //  addChild(mySprite); //    .</code> </pre><br><br><h5>  <b>Actions</b> </h5><br>  Creating a scene with adding sprites to the screen is only part of the task.  After all, we still need to make it all move.  For this and there are actions (Actions).  Movement, turns, rotation are all actions.  The actions are very similar to the <a href="http://developer.android.com/intl/ru/reference/android/animation/ValueAnimator.html">ValueAnimator</a> in the Android API. <br><br><pre> <code class="hljs pgsql">auto mySprite = Sprite::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>("Blue_Front1.png¬´); //   50     10 ,   : auto moveBy = MoveBy::create(2, Vec2(50,10)); mySprite-&gt;runAction(moveBy); //    : auto moveTo = MoveTo::create(2, Vec2(50,10)); mySprite-&gt;runAction(moveTo);</code> </pre><br><br><h5>  <b>Coordinate system</b> </h5><br>  It should be noted that Cocos2d uses Cartesian coordinate system.  That is, the point (0, 0) is at the bottom left.  This distinguishes Cocos2d, say, from the same Android API. <br><br><h4>  <b>7. The idea of ‚Äã‚Äãthe game</b> </h4><br>  Next, we will create a prototype of the game to illustrate working with Cocos2d.  The idea of ‚Äã‚Äãthe game is very simple: objects randomly move around the screen, say, emoticons (and why not?), And there is someone who should eat them.  And from the sad smiles on the contrary, try to hide.  Moreover, the management eater occurs due to the deviation of the phone in different directions.  Thus, we use sprites, actions, scene changes, work with the accelerometer. <br>  It is clear that the idea is very simple and boring, but we do not set ourselves the task of making a million (but only for now, right?), And we need to figure out what is happening in Cocos2d, and this idea is quite appropriate.  Well, let's start! <br><br><h4>  <b>8. Adding sprites</b> </h4><br>  We take as a basis the application MyGame, which we created at the beginning of the article.  We can use smiles that you can easily find on the Internet, or you can replace them with something else.  Any balls. <br>  All resources must be put in the Resources directory. <br><br>  Add the following code to the init () method: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SMILES_COUNT; i++) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> result = ¬´emoji-¬ª + itos(i); Sprite *sprite = Sprite::create(result); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sprite != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;addChild(sprite); listSprites.push_front(sprite); } }</code> </pre><br><br>  listSprites is a list of all emoticons, it is useful to us to add movement around the screen.  Let's make one more thing so that they rotate a little, in the process of movement: <br><br><pre> <code class="hljs ruby">Point *sizeStart = randomEndPoint(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Point *sizeStop = randomEndPoint(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   auto rotateAction = RotateTo::create(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">90</span></span>    . auto moveAction = MoveTo::create(<span class="hljs-number"><span class="hljs-number">2</span></span>, *sizeStop); sprite-&gt;setPosition(*sizeStart); auto mySpawn = Spawn::createWithTwoActions(rotateAction, moveAction); auto seq = Sequence::create(mySpawn, CallFunc::create(callback), nullptr); sprite-&gt;runAction(seq);</code> </pre><br>  Here we create Spawn and Sequence to execute two actions at the same time, and plus to this, in Sequence we pass a callback - a link to the function that will be called when the action is executed.  This will allow us to restart the action every time so that the sprites move endlessly.  We need to create such an action for each sprite. <br>  The randomEndPoint method returns a point on the screen border, selected at random. <br>  Now we have a lot of moving sprites: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d3a/78d/8e9/d3a78d8e9f874579928eb6c990a3b55b.png"></div><br><br>  We also need to add a devourer, but this is done in a similar way; we will not dwell on this. <br><br><h4>  <b>9. Resolution of collisions</b> </h4><br>  Now we need to write some code to resolve the collisions.  That is, to find the moment when small smiles will touch the devourer. <br>  To do this, override the onUpdate method: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HelloWorld::update(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt) { ... }</code> </pre><br><br>  To call this method when refreshing the screen, call <i>scheduleUpdate ()</i> : <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HelloWorld::init(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;scheduleUpdate(); ... }</code> </pre><br><br>  Now each time the screen is updated (and the sprites' positions change, respectively), the <i>update</i> method will be called.  For simplicity, you can write something like this: <br><br><pre> <code class="hljs php">void HelloWorld::init(float dt) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(spriteSmile-&gt;getPosition().distance(eaterSprite-&gt;getPosition()) &lt; spriteSmile-&gt;getBoundingBox().size.width/<span class="hljs-number"><span class="hljs-number">2</span></span> + eaterSprite-&gt;getBoundingBox().size.width/<span class="hljs-number"><span class="hljs-number">2</span></span>){} }</code> </pre><br><br>  When a conflict is found, you can count the points and restart the Action: <br><br><pre> <code class="hljs php">void HelloWorld::init(float dt) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(spriteSmile-&gt;getPosition().distance(eaterSprite-&gt;getPosition()) &lt; spriteSmile-&gt;getBoundingBox().size.width/<span class="hljs-number"><span class="hljs-number">2</span></span> + eaterSprite-&gt;getBoundingBox().size.width/<span class="hljs-number"><span class="hljs-number">2</span></span>){ score‚Äî; spriteSmile-&gt;stopAllActions(); spriteSmile-&gt;setPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); runActionForSmile(spriteSmile); } }</code> </pre><br><br><h4>  <b>10. Accelerometer</b> </h4><br>  Working with an accelerometer is as easy as resolving collisions, even easier. <br>  To begin with, we will subscribe for the necessary event: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HelloWorld::init(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt) { ... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;setAccelerometerEnabled(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); ... }</code> </pre><br><br>  To get accelerometer values, override the <i>onAcceleration</i> method: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">void</span></span> HelloWorld::init(float dt) { <span class="hljs-attribute"><span class="hljs-attribute">void</span></span> GameScene::<span class="hljs-literal"><span class="hljs-literal">on</span></span>Acceleration(cocos2d::Acceleration *acc, cocos2d::Event *unused_event) { <span class="hljs-attribute"><span class="hljs-attribute">Director</span></span> *director = Director::getInstance(); <span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> viewSize = director-&gt;getWinSize(); <span class="hljs-attribute"><span class="hljs-attribute">float</span></span> minSize = MIN(viewSize.width, viewSize.height); <span class="hljs-attribute"><span class="hljs-attribute">double</span></span> targetSpeedY = acc-&gt;y * minSize*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">double</span></span> targetSpeedX = acc-&gt;x * minSize*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">eaterPointsPerSecY</span></span> = (eaterPointsPerSecY * .8f) + (targetSpeedY * .2f); <span class="hljs-attribute"><span class="hljs-attribute">eaterPointsPerSecX</span></span> = (eaterPointsPerSecX * .8f) + (targetSpeedX * .2f); } }</code> </pre><br><br>  Calculating eaterPointsPerSecX and eaterPointsPerSecY in the update method, call <i>setPosition ()</i> : <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> diffY = (eaterPointsPerSecY * dt)*<span class="hljs-number"><span class="hljs-number">1.3</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> diffX = (eaterPointsPerSecX * dt)*<span class="hljs-number"><span class="hljs-number">1.3</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> newY = eaterSprite-&gt;getPosition().y + diffY; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> newX = eaterSprite-&gt;getPosition().x + diffX; eaterSprite-&gt;setPosition(newX, newY);</code> </pre><br><br>  Of course, in a real game, you also have to watch out for our devourer to go beyond the screen.  But for now let's stop on this. <br>  So, we created flying emoticons, added an eater, we manage it with an accelerometer ... left, add a ‚ÄúGame Over!‚Äù Screen. <br><br><h4>  <b>11. Game Over!</b> </h4><br>  Here we need a new scene.  You can spy in HelloWorld and create it on the model.  So we will do: <br><br><pre> <code class="hljs pgsql">// GameOverScene.h #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> ¬´cocos2d.h¬ª <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> GameOverScene : <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> cocos2d::Layer { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: virtual <span class="hljs-type"><span class="hljs-type">bool</span></span> init(); static cocos2d::Scene *createScene(); <span class="hljs-type"><span class="hljs-type">void</span></span> startAgainCallback(cocos2d::<span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span> *pSender); CREATE_FUNC(GameOverScene); };</code> </pre><br><pre> <code class="hljs pgsql">// GameOverScene.cpp #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;ui/UIDeprecated.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> ¬´GameOverScene.h¬ª #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> ¬´GameScene/GameScene.h¬ª <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> namespace std; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> namespace cocos2d; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> namespace cocos2d::ui; Scene *GameOverScene::createScene() { auto scene = Scene::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(); GameOverScene* layer = GameOverScene::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(); scene-&gt;addChild(layer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scene; } <span class="hljs-type"><span class="hljs-type">bool</span></span> GameOverScene::init() { ////////////////////////////// // <span class="hljs-number"><span class="hljs-number">1.</span></span> super init first <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Layer::init()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } Size visibleSize = Director::getInstance()-&gt;getVisibleSize(); Vec2 origin = Director::getInstance()-&gt;getVisibleOrigin(); auto gameOVerLabel = Label::createWithTTF("Game over!¬´, ¬´fonts/Comfortaa-Bold.ttf¬ª, 24); gameOVerLabel-&gt;setTextColor(Color4B::WHITE); auto startAgainLabel = Label::createWithTTF("Play again¬´, ¬´fonts/Comfortaa-Bold.ttf¬ª, <span class="hljs-number"><span class="hljs-number">30</span></span>); startAgainLabel-&gt;setTextColor(Color4B::ORANGE); auto playAgainItem = MenuItemLabel::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(startAgainLabel, CC_CALLBACK_1(GameOverScene::startAgaingCallback, this)); auto menu = Menu::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(playAgainItem, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>); gameOVerLabel-&gt;setPosition(visibleSize.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, visibleSize.height/<span class="hljs-number"><span class="hljs-number">2</span></span> + gameOVerLabel-&gt;getContentSize().height * <span class="hljs-number"><span class="hljs-number">3</span></span>); menu-&gt;setPosition(visibleSize.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, gameOVerLabel-&gt;getPosition().y ‚Äî gameOVerLabel-&gt;getContentSize().height); this-&gt;addChild(gameOVerLabel); this-&gt;addChild(menu); } <span class="hljs-type"><span class="hljs-type">void</span></span> GameOverScene::startAgaingCallback(<span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span> *pSender) { Director::getInstance()-&gt;replaceScene( TransitionFade::<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, HelloWorld::createScene(), Color3B(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>))); } #endif //MYGAME_GAMEOVERSCENE_H</code> </pre><br>  Almost everything that is written here, we already know. <br>  Here, by analogy with HelloWorld, we create a label that is a menu item, that is, we can handle the onClick event.  When creating MenuItemLabel, we pass one of the parameters to the link to the startAgaingCallback function, in which we change the scene.  Note that changing the scene is also using the TransitionFade effect. <br>  In the same way, we can change the game scene on GameOverScene: <br><br><pre> <code class="hljs php">void HelloWorld::update(float dt) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(score &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>){ Director::getInstance()-&gt;replaceScene(TransitionFade::create(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, GameOverScene::createScene(score), Color3B(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>))); }}</code> </pre><br><br>  Gameover! <br><br>  Links <br>  <a href="http://www.cocos2d-x.org/">www.cocos2d-x.org</a> <br>  <a href="https://www.jetbrains.com/clion/">www.jetbrains.com/clion</a> <br>  <a href="http://habrahabr.ru/post/126582/">habrahabr.ru/post/126582</a> <br>  <a href="http://www.cocos2d-x.org/programmersguide/">www.cocos2d-x.org/programmersguide</a> <br>  <a href="http://www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game">www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game</a> </div><p>Source: <a href="https://habr.com/ru/post/270133/">https://habr.com/ru/post/270133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270123/index.html">Amazon Web Services is now in the Github Students Development Pack</a></li>
<li><a href="../270125/index.html">Asterisk: We will provide VIP clients with the first place in the call queue, as well as we will connect the client with a specific operator for a specified time.</a></li>
<li><a href="../270127/index.html">On projects on open data, the search for funding for public projects and on open data on public finances</a></li>
<li><a href="../270129/index.html">Unobvious features of product sorting and "dance of reality"</a></li>
<li><a href="../270131/index.html">Kaggle competition for analyzing population survey data</a></li>
<li><a href="../270137/index.html">Start using Rust</a></li>
<li><a href="../270141/index.html">Online compilation on a static site, a recipe for beginners</a></li>
<li><a href="../270143/index.html">Pirate metrics: how to create an email campaign based on the AARRR principle. Part 3</a></li>
<li><a href="../270145/index.html">Street magic in scripts or what connects Groovy, Ivy and Maven?</a></li>
<li><a href="../270147/index.html">PHP html generation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>