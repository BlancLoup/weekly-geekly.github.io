<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Speaking bot on php + prolog</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Many people believe that the programming language prolog is a purely scientific and outdated language for teaching students. The majori...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Speaking bot on php + prolog</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Many people believe that the programming language prolog is a purely scientific and outdated language for teaching students.  The majority at the university ‚Äústrained‚Äù with this language on subjects, at least a little close to the topic of artificial intelligence, this topic did not bypass me. <br><br>  The standard task I came across turned out to be so boring and common for this language that I was tempted to download it for free without registration, but I decided to take the most out of this course and turn the subject of the prologue to write something practically meaningful and interesting.  After reading quite a lot of different documentation, including posts on the prolog in Habr√©, I came to the conclusion that the prolog is an excellent tool for processing sentences of a formal language.  I decided that it would be cool to write a bot that would know how to respond to phrases (maybe even smoothly) on VKontakte. <br><a name="habracut"></a><br><h4>  Implementation </h4><br>  First, I wrote the main functionality of the bot, i.e.  an interface that allows me, as an admin, to send commands to execute the bot. <br><br>  List of current commands: <br><pre><code class="php hljs">$commands = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'up'</span></span>, <span class="hljs-string"><span class="hljs-string">'uptime'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'last'</span></span>);</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, each team speaks for itself.  It is necessary to stop on two teams: <br><ul><li>  listen to% text% tells the bot to put the song into status, where the performer is the name =% text%.  The case does not apply at all, just became curious. </li><li>  And last - displays the last message sent to the bot.  And the user who sent it. </li></ul><br>  It looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/95e/f99/10f/95ef9910fe84aa955115bf211abcc2ca.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/593/500/cf0/593500cf096e57cf1cf8dbc773a806d0.png"><br><br>  All this was done as part of the processing of incoming messages.  Further, the processing of messages is not from the admin, i.e.  suggestions that require a response. <br><br>  Here comes the prolog.  Or rather, swi-prolog, the implementation of which is available for both windows (it was developed there) and * nix (it works there now).  Plus swi-prolog is that it is interpretable.  Therefore, you just need to feed the script file to the swi interpreter and catch the result.  At the same time, remember the input phrase, and with the resulting phrase - write this bundle to a file.  A sheet of masks is best presented by example for the input line: <br><pre> <code class="perl hljs"> ,   ?</code> </pre> <br><br>  the list of masks will look like: <br><pre> <code class="perl hljs">[<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>]</code> </pre><br><br>  In this case, we must remember that this is exactly the question.  For this we enclose the list of masks with the predicate request, and save it to a file.  Example: <br><pre> <code class="perl hljs">request(<span class="hljs-string"><span class="hljs-string">'?'</span></span>,[<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'**'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>,<span class="hljs-string"><span class="hljs-string">'*'</span></span>]).</code> </pre><br><br>  Next, run the script, the description of the algorithm of which is reduced to several lines: <br><ul><li>  We read the predicate from the input file (the same request) <br><pre> <code class="perl hljs">consult(<span class="hljs-string"><span class="hljs-string">'request.txt'</span></span>)</code> </pre><br>  And in order for the text in the file to be perceived as a set of predicates, you need to add a description of dynamic predicates somewhere in the title: <br><pre> <code class="perl hljs">:-dynamic(request/<span class="hljs-number"><span class="hljs-number">2</span></span>).</code> </pre><br></li><li>  We read the knowledge base and get a list of questions and answers and a list of unanswered questions. <br><pre> <code class="perl hljs">:-dynamic(question/<span class="hljs-number"><span class="hljs-number">2</span></span>). :-dynamic(answer/<span class="hljs-number"><span class="hljs-number">2</span></span>). :-dynamic(notanswered/<span class="hljs-number"><span class="hljs-number">1</span></span>). :-consult(<span class="hljs-string"><span class="hljs-string">'questionanswerlink.txt'</span></span>). :-consult(<span class="hljs-string"><span class="hljs-string">'withoutanswer.txt'</span></span>).</code> </pre><br></li><li>  We are looking for a question / answer <br><pre> <code class="perl hljs">goal2 :- toFile, consult(<span class="hljs-string"><span class="hljs-string">'request.txt'</span></span>), request(Type, KeyWords),%     twoFindAllByType(Type, KeyWords, ActualByType), %  ,       (  - ,  ,  )     KeyWords (  ). str(ActualByType, ActualPhrasesString),%   toFile(ActualPhrasesString),fail.%  </code> </pre><br></li><li>  if the answer is not found - take a random question from the list of questions (for which there is no answer) <br><pre> <code class="python hljs">noAnswer :- toFile, consult(<span class="hljs-string"><span class="hljs-string">'request.txt'</span></span>), %  request(Type, _), %     twoAsk(Type, Res),%    str(Res, ActualPhrasesString),write(ActualPhrasesString), %        toFile(S),fail.</code> </pre><br></li><li>  Write the result to another file (usually, the result is a few phrases) </li></ul><br><br><h5>  Additional functions: </h5><br>  List in row <br><pre> <code class="perl hljs">str([], <span class="hljs-number"><span class="hljs-number">_</span></span>). %   -  str([H|[]], S):- %   string_concat(<span class="hljs-string"><span class="hljs-string">''</span></span>, H, S),!. %   (H)    S   ! str([H|<span class="hljs-number"><span class="hljs-number">_</span></span>], String) :- %      string_concat(H, <span class="hljs-string"><span class="hljs-string">''</span></span>, S),%   S String = S. %   String</code> </pre><br><br>  Saving to a data file <br><pre> <code class="perl hljs">toFile(Data) :- <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(<span class="hljs-string"><span class="hljs-string">'output.txt'</span></span>, append, OS), toFile(OS, Data). toFile:- <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(<span class="hljs-string"><span class="hljs-string">'output.txt'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>, OS), <span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(OS). toFile(OS, Data) :- <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(OS,Data), nl(OS), false. toFile(OS, <span class="hljs-number"><span class="hljs-number">_</span></span>) :- <span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(OS).</code> </pre><br><br>  Well, getting unanswered questions: <br><pre> <code class="perl hljs">twoAsk(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, Res):- %      notanswered(R),Res = [R|Res]. %   notanswered(<span class="hljs-string"><span class="hljs-string">"- "</span></span>)      Res.</code> </pre><br><br>  Actually, this is all what the prolog script does.  The rest of the things are quite simple: we take a random line from the resulting file, and give it to the user, at the same time we write the question-answer to the BR file.  Also, if a bot asked a question, and no answer was given - this question is recorded in the database of questions that have not been answered. <br><br><h4>  Result </h4><br>  This is probably the most expected part of the article.  Even considering that this version of the bot was written in 3 days, taking into account the phrase output algorithm, the result may produce phrases depending on the context of the conversation (sometimes).  But, especially, he answers, if there are unique \ under-used phrases (it is understandable). <br><br>  The bot's algorithm is very crooked, especially the part that needs to be ‚Äúsmart.‚Äù  By the way, in order to train a little bot, I had to go for some inconvenience.  For example, he wrote a couple of times on behalf of a bot in groups where girls sell themselves or take pictures and sell photos.  This had an effect, and, as was to be expected, distribution by gender: 98% men, 2% the rest.  But it gave some negative effect.  Bot began to write on behalf of both men and women.  This confused users, and as a result, the knowledge base contains quite a lot of questions containing the words ‚Äúgender‚Äù, ‚Äúyour‚Äù, ‚Äúwhat‚Äù and the like.  But even taking into account these inconveniences, people continued to communicate with the bot, even without looking at the high response speed (half a second - second, especially for familiar phrases), repetition of messages, replies at random.  Some people just need to communicate, even if it is not natural. <br><br>  And recently we even began to learn: <br><img src="https://habrastorage.org/getpro/habr/post_images/686/0f1/864/6860f1864fa768782e4f3fd8762a5fb8.jpg"><br><br>  Sometimes the bot gave out philosophical phrases that you can think about looking at the sky for a very long time: <br><img src="https://habrastorage.org/getpro/habr/post_images/a0c/a25/08c/a0ca2508c8611ab5f90076036f49cd94.jpg"><br>  or not <br><img src="https://habrastorage.org/getpro/habr/post_images/e5b/538/72a/e5b53872a633f32541795b9a0fe1bc46.jpg"><br><br>  Sometimes, however, skips absolute nonsense. <br><img src="https://habrastorage.org/getpro/habr/post_images/d25/0dd/325/d250dd32555d7d4c7c02ca5206a687c8.jpg"><br><br>  But even so, it‚Äôs fun to watch: <br><br>  corrected in time: <br><img src="https://habrastorage.org/getpro/habr/post_images/e16/403/662/e16403662aced0f0b7cb022d65c02580.png"><br><br>  the most interesting was: <br><img src="https://habrastorage.org/getpro/habr/post_images/bea/4b8/8a0/bea4b88a0cd6e7b223674144071cb76b.jpg"><br><br>  In addition to the bot account, I created at the same time a public page to which screenshots of the most interesting dialogs were sent, and most of the dialogs can be read by writing ‚Äúgob baba vk‚Äù in Google, strictly +18.  There are already about 150 of them.  By the way, if this article is read by the prolog guru, maybe they will teach me a couple of lessons, or you can, for example, work together to create a more intelligent work algorithm, of course, if this is interesting to someone. <br><br>  Unfortunately, the current algorithm does not allow the bot to serve even 10 clients (very difficult), it happens that the processing process is interrupted for a couple of minutes, going through a large knowledge base with a large number of input masks.  Therefore, a link to the bot itself can only be given to a couple of people and exclusively in the LS. <br>  Thank you for reading up to this point. </div><p>Source: <a href="https://habr.com/ru/post/205418/">https://habr.com/ru/post/205418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205404/index.html">WebRTC Expo 2013 and new features of the VoxImplant platform</a></li>
<li><a href="../205406/index.html">Ball pen to create conductive drawings on Kickstarter collected 477 thousand dollars instead of 85 thousand</a></li>
<li><a href="../205410/index.html">The first part of 1,500,000 pages of ancient manuscripts is digitized.</a></li>
<li><a href="../205412/index.html">Google Analytics. Caution bots</a></li>
<li><a href="../205414/index.html">Computer mouse turned 45 years old</a></li>
<li><a href="../205420/index.html">The first Russian changed his operator without losing numbers</a></li>
<li><a href="../205424/index.html">Promotion of non-pop app on Google Play</a></li>
<li><a href="../205426/index.html">Profiling and debugging Python, debugging</a></li>
<li><a href="../205428/index.html">Linear regression on fingers in recognition</a></li>
<li><a href="../205432/index.html">Viks Bluetooth Vibro-Bracelet VI-T2: accessory for unresponsive ladies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>