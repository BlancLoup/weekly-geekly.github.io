<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization in compilers. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Delving into the wilds of LLVM , I suddenly found out for myself: how interesting the thing is - code optimization. Therefore, I decided to share with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization in compilers. Part 1</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/compilers/119850/">Delving into the wilds of</a> <a href="http://llvm.org/">LLVM</a> , I suddenly found out for myself: how interesting the thing is - code optimization.  Therefore, I decided to share with you my observations in the form of a series of review articles about optimization in compilers.  In these articles, I will try to ‚Äúchew on‚Äù the principles of optimization work and be sure to consider examples. <br>  I will try to build optimization in order of increasing "complexity of understanding", but this is purely subjective. <br>  And one more thing: some names and terms are not well-established and are used by ‚Äúsomeone-like‚Äù, therefore I will give several options, but I strongly recommend using English terms. <br><a name="habracut"></a><br><hr><h1>  <b><font color="#554444">Introduction</font></b> </h1><h3>  <b><font color="#665555">(very little theory about the types of optimizations you can skip)</font></b> </h3><br>  Before we dive into great ideas and algorithms, let's be a little bored with theory: let's look at what optimization is, what it is for, and what they are or are not. <br>  To begin with, we will give a definition ( <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BF%25D1%2582%25D0%25B8%25D0%25BC%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25B8%25D0%25BB%25D1%258F%25D1%2582%25D0%25BE%25D1%2580%25D0%25B0">from wikipedia</a> ): <blockquote>  <b>Optimization of program code</b> is a modification of programs performed by an optimizing compiler or interpreter in order to improve their characteristics, such as performance or compactness, without changing the functionality. </blockquote>  The last three words in this definition are very important: no matter how much the optimization optimizes the characteristics of the program, it must preserve the original meaning of the program under any conditions.  That is why, for example, there are various <a href="http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html">levels of</a> <a href="http://readthedocs.org/docs/gcc-python-plugin/en/latest/tables-of-passes.html">optimization</a> in <a href="http://gcc.gnu.org/">GCC</a> <b>(I strongly recommend to go through these links)</b> . <br><br>  Go ahead: optimizations are <i><b>machine-independent</b> (high-level)</i> and <i><b>machine-dependent</b> (low-level)</i> .  The meaning of the classification is clear from the names; in machine-dependent optimizations, features of specific architectures are used; in high-level optimizations, this occurs at the level of the code structure. <br><br>  Depending on their area of ‚Äã‚Äãapplication, optimizations can also be classified into local ones (operator, operator sequence, base unit), intraprocedural, interprocedural, intramodular and global (optimization of the whole program, ‚Äúoptimization during assembly‚Äù, <a href="http://en.wikipedia.org/wiki/Link-time_optimization">‚ÄúLink-time optimization‚Äù</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I feel that you are going to fall asleep now, let's finish this portion of the theoiai and begin to consider the optimizations themselves ... <br><br><hr><h1>  <b><font color="#554444">Constant folding</font></b> </h1><h3>  <b><font color="#665555">(Coagulation / Constant Convolution)</font></b> </h3><br>  The simplest, most famous and most common optimization in compilers.  The process of <i>"folding constants"</i> includes the search for expressions (or subexpressions) that include ONLY constants.  Such expressions are calculated at the compilation stage and are ‚Äúcollapsed‚Äù into the calculated value in the resulting code. <br><br>  Consider an example ( <i>invented on the move from the head, absolutely synthetic, trivial, abstract, meaningless, far from reality, etc</i> ... and all the examples will be like this): <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre><code class="hljs go">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> point { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; } p;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">32</span></span>*<span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">32</span></span>*<span class="hljs-number"><span class="hljs-number">32</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c;</code> </pre> <pre> <code class="hljs lisp"> // c = (<span class="hljs-name"><span class="hljs-name">a</span></span> + b) * (<span class="hljs-number"><span class="hljs-number">4</span></span>*4*sizeof(<span class="hljs-name"><span class="hljs-name">p</span></span>) - <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">32</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td><td><pre> <code class="hljs go">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> point { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; } p;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   32 * 32 int b = 4096; //   32 * 32 * 4</span></span></code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// 16 = 4*4, 30 = -2 + 32 c = (a + b) * (16*sizeof(p) + 30);</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td></tr></tbody></table>  It seems to be fine and the optimization is done, but in fact the compilers have become smarter and move on.  The fact is that in this case the size ( <code>sizeof</code> ) of the <b><code>"p"</code></b> structure is also a constant, and the compilers know about it, so we get: <table border="1"><tbody><tr><th>  Expand sizeof </th><th>  End the collapse </th></tr><tr><td><pre> <code class="hljs swift">... <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = (a + b) * (<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">8</span></span> + <span class="hljs-number"><span class="hljs-number">30</span></span>); ...</code> </pre> </td><td><pre> <code class="hljs swift">... <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = (a + b) * <span class="hljs-number"><span class="hljs-number">158</span></span>; ...</code> </pre> </td></tr></tbody></table>  Well ... A few processor cycles this optimization definitely saves us. <br>  It's pretty simple, if our code is presented as an <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B1%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE">Abstract Syntax Tree</a> ( <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a> ).  Then, to find numerical expressions and subexpressions, it suffices to search for tree nodes of the same level (that is, having a common ancestor) containing only numerical values.  Then the value in the parent node (parent) can be minimized.  For clarity, consider a simple example of a tree for one of the expressions, take our <code>"int a = 32*32;"</code>  : <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/storage/719a6a8b/887e82b5/c5952b7d/5f59405c.png"></a> </div><br><br>  That is, by recursively traversing our AST tree, we can collapse all such constant expressions.  By the way, the example with numbers is again simplified; instead of operations with numbers, there may well be <i>operations with strings</i> (concatenation) or <i>operations with strings and numbers</i> (similar to python's " <code>'-' * 10</code> ") or <i>constants of any other data types</i> supported by the source language programming. <br><br><hr><h1>  <b><font color="#554444">Constant propagation</font></b> </h1><h3>  <b><font color="#665555">(Spreading constants)</font></b> </h3><br>  This optimization is usually always described in a set with ‚ÄúConstant folding‚Äù (after all, they complement each other), but this is still a separate optimization.  The process of <i>‚Äúpropagation of constants‚Äù</i> includes in the search for expressions that will be constant in any possible way of execution (before using this expression) and replacing them with these values.  In fact, everything is simpler than it sounds - let's take the same example that we have already used, but given that we have already gone through it with the optimization of <i>‚ÄúConstant folding‚Äù</i> : <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs go">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> point { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; } p;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">4096</span></span>;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// c = (a + b) * 94;</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td><td><pre> <code class="hljs go">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> point { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; } p;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">4096</span></span>;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c;</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// c = (1024 + 4096) * 94 c = 481280;</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td></tr></tbody></table>  That is, in our initial program, in general, it was not necessary to do any calculations.  What happened?  Everything is simple ... Since the values ‚Äã‚Äãof the variables <b><code>"a"</code></b> and <b><code>"b"</code></b> in no way change between their declaration and the use of the value <b><code>"c"</code></b> in the calculation, the compiler itself can substitute their values ‚Äã‚Äãinto the expression and calculate it. <br>  That is, it is necessary for the compiler to check for each expression whether its value will always be constant (or rather, whether it can change).  Let's try to sketch: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/storage/d3d4fd7d/279b6605/2f61d65e/42274b8e.png"></a> </div><br><br>  Suppose that the compiler detects the use of the variables <b><code>"a"</code></b> and <b><code>"b"</code></b> during the next optimization pass.  As can be seen from the diagram, after declaring the variable <b><code>"a"</code></b> in block A and the variable <b><code>"b"</code></b> in block B, neither one nor the other variable can change the value in subsequent blocks (A, B, C) before using them.  This case is trivial, since the whole program is linear and is the so-called <b><a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BA">Base unit</a> ( <a href="http://en.wikipedia.org/wiki/Basic_block">BB</a> )</b> .  But the algorithm for determining the "variability" of a variable in the base unit is far from all.  The program may include conditional constructions, cycles, unconditional transitions, etc.  Then, to determine the ‚Äúvariability‚Äù of a variable, it is necessary to construct a directed graph with base blocks at the vertices, and edges ‚Äî transfer of control between the base blocks.  Such a graph is called <b><a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D1%2584_%25D0%25BF%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25B0_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">a Control Flow</a></b> Graph ( <a href="http://en.wikipedia.org/wiki/Control_flow_graph"><b>CFG</b></a> ) and is used to implement many optimizations.  In this box, you can determine all the basic blocks that need to go from initializing the variable to its use and determine for each block whether the variable value can change in it.  If it cannot be changed, the compiler can easily replace its value with a constant. <br>  "Constant propagation" and "Constant folding" are usually run several times until they stop making any changes to the program code. <br><br><hr><h1>  <b><font color="#554444">Copy propagation</font></b> </h1><h3>  <b><font color="#665555">(Distribution of copies)</font></b> </h3><br>  And this is another companion of the two previous optimizations, practically twin brother ‚ÄúConstant Folding‚Äù, performing very similar work, but it allows you to get rid of unnecessary (intermediate) variable assignments, replacing intermediate variables in expressions.  It will be much clearer on the simplest example: <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> {</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * a + b * b;</code> </pre> <pre> <code class="hljs">}</code> </pre> </td><td><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> {</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// // return x * x + y * y;</span></span></code> </pre> <pre> <code class="hljs">}</code> </pre> </td></tr></tbody></table><br><hr><h1>  <b><font color="#554444">Dead Code Elimination (DCE)</font></b> </h1><h3>  <b><font color="#665555">(Elimination / Exclusion of unavailable code)</font></b> </h3><br>  Very simple, but, unfortunately, there is little that improves the performance optimization in terms of performance.  Everything is simple: the code that can not be used in the program can be deleted.  Let's look at a couple of examples of ‚Äúdead code <s>load</s> ‚Äù: <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs vbscript">#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> main(<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { printf(<span class="hljs-string"><span class="hljs-string">"Hi, I'm very hardy code =) !"</span></span>); }</code> </pre> <pre> <code class="hljs lisp"> printf(<span class="hljs-string"><span class="hljs-string">"Hi, I'm dead code =( !"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td><td><pre> <code class="hljs vbscript">#include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> main(<span class="hljs-built_in"><span class="hljs-built_in">int</span></span> argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { printf(<span class="hljs-string"><span class="hljs-string">"Hi, I'm very hardy code =) !"</span></span>); }</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// Here there was a dead code</span></span></code> </pre> <pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> </td></tr></tbody></table>  As you can see, the line " <code>printf("Hi, I'm dead code =( !");</code> " Is unreachable under any circumstances: either the program runs infinitely or ends "forcibly." Let's give a couple more examples: <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">stdlib</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">stdio</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">argc</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">char</span></span> **<span class="hljs-selector-tag"><span class="hljs-selector-tag">argv</span></span>) {</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <pre> <code class="hljs perl"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">x</span></span>; scanf(<span class="hljs-string"><span class="hljs-string">"%d"</span></span>, &amp;<span class="hljs-keyword"><span class="hljs-keyword">x</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">x</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"x &gt;= 10 \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"x &lt; 10 \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <pre> <code class="hljs lisp"> printf(<span class="hljs-string"><span class="hljs-string">"x = %d \n"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">&amp;x</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <pre> <code class="hljs">}</code> </pre> </td><td><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">stdlib</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">stdio</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.h</span></span>&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">argc</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">char</span></span> **<span class="hljs-selector-tag"><span class="hljs-selector-tag">argv</span></span>) {</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// Here there was a dead code</span></span></code> </pre> <pre> <code class="hljs perl"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">x</span></span>; scanf(<span class="hljs-string"><span class="hljs-string">"%d"</span></span>, &amp;<span class="hljs-keyword"><span class="hljs-keyword">x</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">x</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"x &gt;= 10 \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"x &lt; 10 \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">// Here there was a dead code</span></span></code> </pre> <pre> <code class="hljs">}</code> </pre> </td></tr></tbody></table>  I think everything here is also clear without comments: the line " <code>printf("x = %d \n", &amp;x);</code> " also, as in the previous example, is unreachable in any way of program execution, and the variable declared in the first line of the function main is y not used. <br>  Well, the last example for this optimization: <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs mel">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sum(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; }</code> </pre><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">x</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">y</span></span>; }</code> </pre> <pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> </td><td><pre> <code class="hljs mel">#include &lt;stdlib.h&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sum(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; }</code> </pre><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/</span></span></code> </pre> <pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> </td></tr></tbody></table>  And again, everything is simple: the sub function is not called in any place in the program, so you can get rid of it. <br>  On the one hand, the ‚Äúdead code‚Äù in the program is very easy to find using <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D1%2584_%25D0%25BF%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25B0_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">the control flow graph</a> .  If the program has a dead code, then the graph will either be disconnected and you can ‚Äúthrow away‚Äù some fragments of the graph.  On the other hand, it is necessary to take into account address arithmetic and many <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B1%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%25BE%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B8">other nuances</a> - it is not always possible to determine unambiguously whether the code is ‚Äúdead‚Äù. <br><br><hr><h1>  <b><font color="#554444">Common Sub-Expression Elimination (CSE)</font></b> </h1><h3>  <b><font color="#665555">(Elimination of common subexpressions)</font></b> </h3><br>  Very useful and ‚Äúbeautiful‚Äù optimization.  It consists in the following: if you use the calculation of an expression two or more times, then it can be calculated once, and then substituted into all expressions using it.  Well, where are we without an example: <table border="1"><tbody><tr><th>  Before optimization </th><th>  After optimization </th></tr><tr><td><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = (x + y) * (x - y) - x * y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = x * (x + y) - y * (x - y); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (a * b + x - y) * (a * b + x + y); }</code> </pre></td><td><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tmp1 = x + y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tmp2 = x - y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = tmp1 * tmp2 - x * y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = x * tmp1 - y * tmp2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tmp3 = a * b; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (tmp3 + tmp2) * (tmp3 + tmp1); }</code> </pre> </td></tr></tbody></table>  Yes, this optimized code looks much worse and more cumbersome, but it is free from ‚Äúextra calculations‚Äù (adding and subtracting x and y once instead of triple, multiplying a and b once twice together).  Now imagine how much this optimization saves CPU time in a large computing program. <br><br><hr><br>  <b>PS In fact, I wanted to bring the schematics for each of the optimizations, but excuse me, I only had enough to draw two.</b> <b><br></b>  <b>PPS Prompt CONVENIENT service for drawing sherik and graphs.</b> <b><br></b>  <b>PPPS To be continued?</b> </div><p>Source: <a href="https://habr.com/ru/post/124131/">https://habr.com/ru/post/124131/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124124/index.html">They said ... i.e. tweeted "Let's go!"</a></li>
<li><a href="../124125/index.html">inmile.com - second launch</a></li>
<li><a href="../124126/index.html">LG: 3D without glasses</a></li>
<li><a href="../124127/index.html">Apple vs W3C</a></li>
<li><a href="../124128/index.html">Unsolicited Advice - Sberbank Pilot Series</a></li>
<li><a href="../124132/index.html">On Tech ‚àô Ed Russia 2011 a plenary report will be delivered by S. Somasegar - senior vice president of Microsoft</a></li>
<li><a href="../124133/index.html">‚ÄúPrice Sensitivity‚Äù</a></li>
<li><a href="../124134/index.html">Ukrainian experts raise apostrophe question in Ukrainian domain names to ICANN</a></li>
<li><a href="../124135/index.html">Live a hundred years and not grow old</a></li>
<li><a href="../124137/index.html">Russian Twitter users have put a three-letter word in the top trends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>