<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Object in a case or Optional in Java 8 and Java 9. Part 2: ‚ÄúHow it is done in Java 8‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Optional class is devoted a lot of articles and tutorials, including this and this one on Habr√©. 
 Most of them tell how methods of this class are cal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Object in a case or Optional in Java 8 and Java 9. Part 2: ‚ÄúHow it is done in Java 8‚Äù</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ys/0h/kg/ys0hkgszo0x804sxkfr0q6svqcm.jpeg" alt="Object in the case"><br>  Optional class is devoted a lot of articles and tutorials, including <a href="https://habrahabr.ru/post/346782/">this</a> and <a href="https://habrahabr.ru/post/225641/">this one</a> on Habr√©. <br>  Most of them tell <b>how</b> methods of this class are called.  In this tutorial I emphasize <b>why, why, in what cases</b> it is possible (or rather even necessary) to apply one or another class method.  I think this is very important, because, as the survey showed after the <a href="https://habrahabr.ru/post/347480/">first article in</a> this tutorial, not all Java programmers are in the taste of using all the power of the methods of this class. <br>  For a better explanation of the class methods, I will use more complex and illustrative examples than in most other tutotials ‚Äî a coffee maker, a filtration unit, a mixer, etc. <br>  This is the second article in the series on the use of the Optional class when processing objects with dynamic structure.  The <a href="https://habrahabr.ru/post/347480/">first article</a> was about ways to avoid NullPointerException in situations where you can‚Äôt or don‚Äôt want to use Optional. <br>  In this article, we will look at all the class methods as provided by Java 8. The class extensions in Java 9 are discussed in the <a href="https://habrahabr.ru/post/347748/">third article in</a> this series.  <a href="https://habrahabr.ru/post/347836/">The fourth article is</a> devoted to the necessary (from the point of view of the author) addition to this class. <br>  Well, in the <a href="https://habrahabr.ru/post/350904/">fifth article</a> I tell about where the Optional should be used inside the class, summarize and give every reader who has read the series to the end, a valuable gift. <a name="habracut"></a><br>  In this tutorial there will be a lot of source code, including Junit tests.  I share the opinion of some of my colleagues on the pen that reading the test code helps to better master the material.  You'll find all the sources in <a href="https://github.com/vsirotin/Smartenesse-Java">my GitHub project</a> . <br>  So, in the <a href="https://habrahabr.ru/post/347480/">first article of this series</a> I tried to consider approaches that you can use when implementing objects with dynamic structure and promised to justify why the Optional almost always works better than other approaches in this situation.  Let's start fulfilling promises.  Let's start with the definition. <br><br><h3>  What is Optonal? </h3><br>  Before we get to the concrete example, let's try to answer the question, what is Optional? <br><br>  I would venture to give my own visual definition.  In the first approximation, Optional is a software analogue of a case of a physical object, for example, glasses.  Whether the object is inside the case, you can find out using the isPresent () method.  If it is there, you can take it using the get () method.  In general, approximately as shown in the title picture of the series. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So: <br><blockquote>  In the first approximation, Optional is a case for some object. </blockquote><br><h3>  Use to a minimum </h3><br>  In our first example, we try using Java 8 Optional to simulate the operation of a device that combines a drinking water faucet and a boiler. <br>  His diagram is shown in the picture below: <br><br><img src="https://habrastorage.org/webt/ap/uc/b1/apucb1yne-dfcnjut0ghbaunu0o.png"><br><br>  As you can see, the device needs water and electricity to operate.  At the exit, it can produce raw or boiled water. <br><br>  Thus, the input of this device can be described with the following interface: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterAvailable, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span></span>; }</code> </pre> <br>  And the output is like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Optional&lt;CupOfWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Optional&lt;CupOfBoiledWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfBoiledWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  Since (depending on the input data) the device may or may not give out raw and boiled water, we present the result of calling get ... with the help of Optional. <br><br>  The behavior of the device as a whole describes an interface that combines input and output methods. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoiler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInput</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerOutput</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  Classes representing the varieties of water are of little interest to us, so we implement them in a minimal way.  This is the class for serving raw water: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CupOfWater</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CupOfBoiledWater </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boil</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfBoiledWater();} }</code> </pre> <br>  We will assume that a portion of boiled water is a new object, different from raw water.  Therefore, we will present it as a separate class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CupOfBoiledWater</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  So, the task is set.  In the best traditions of TDD (Test-Driven Development), we first write a test to check whether we simulated the behavior of our simple device: <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test Boiler1Test</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boiler1Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IBoiler boiler; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ boiler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Boiler1(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBothNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertFalse(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testPowerAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); assertFalse(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWaterAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertTrue(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBothAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); assertTrue(boiler.getCupOfWater().isPresent()); assertTrue(boiler.getCupOfBoiledWater().isPresent()); } }</code> </pre> </div></div><br>  Our test verifies that the appliance actually delivers raw water if water is supplied to the inlet, regardless of the presence of electricity.  But the device produces boiled water only if there is both water and electricity. <br><br>  Before moving on to implementation, stop for a moment and think through your head or even behind the keyboard, how would you program this solution within the framework of the approaches discussed in the first article of the series: <br>  With a pair of has ... get ... <br>  C using the return array or sheet of values <br>  With the help of a sign of activity issued to the outside product. <br>  If you really tried to imagine it, and even better, try to program the solution of the problem within these approaches, you will certainly appreciate the simplicity and elegance that Java 8 Optional brings to our programming life. <br><br>  Look at my, probably not the optimal solution: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boiler1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoiler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> waterAvailable; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> powerAvailable; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterAvailable, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.waterAvailable = waterAvailable; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.powerAvailable = powerAvailable; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;CupOfWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterAvailable ? Optional.of(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater()) : Optional.empty(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;CupOfBoiledWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfBoiledWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!powerAvailable)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.empty(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCupOfWater().map(cupOfWater-&gt;cupOfWater.boil()); } }</code> </pre> <br>  Pay attention to the last line of listing where the map () method from the Optional class is used.  This way you can build processing chains.  If it turns out at one of the links in the chain that no further processing is possible, the entire chain will return an empty response. <br><br>  The results of our boiler model depend on external conditions, which were set using Boolean variables.  But in the majority of practically interesting problems, not simple variables are fed into the input, but objects.  Including those that can be null. <br><br>  Consider how you can apply Optional if the behavior is not determined by Boolean variables, but by ‚Äúold-mode‚Äù objects that admit zero values. <br>  Let the input of our boiler a slightly different model than in the first example is defined as follows: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInput2</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater water, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span></span>; }</code> </pre> <br>  The zero value of the water object means that water does not flow into the device from the water supply system. <br>  Then the behavior of the device as a whole is defined by the following interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoiler2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInput2</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerOutput</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  As in the previous example, we define tests that verify the correctness of our implementation: <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test Boiler2Test</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boiler2Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IBoiler2 boiler; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ boiler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Boiler2(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBothNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertFalse(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testPowerAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); assertFalse(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWaterAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); assertTrue(boiler.getCupOfWater().isPresent()); assertFalse(boiler.getCupOfBoiledWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testBothAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ boiler.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); assertTrue(boiler.getCupOfWater().isPresent()); assertTrue(boiler.getCupOfBoiledWater().isPresent()); } }</code> </pre> </div></div><br>  If we compare these tests with tests for the boiler of the first model, we will see their very similarity.  Checking the results of the same tests from different sets is the same.  Well, the input differs in that instead of true for the water source, we submit the object, and instead of false, -null. <br><br>  And here is the implementation itself: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boiler2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoiler2</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CupOfWater water; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> powerAvailable; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater water, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.water = water; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.powerAvailable = powerAvailable; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;CupOfWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(water); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;CupOfBoiledWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfBoiledWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!powerAvailable)<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.empty(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCupOfWater().map(cupOfWater-&gt;cupOfWater.boil()); } }</code> </pre> <br>  As we can see, the Optional.ofNullable () method allows you to elegantly ‚Äúput‚Äù a dangerous object with a potentially zero value into a case.  If the object has a zero value, the case will be empty.  Otherwise, it contains the object we need. <br><br>  It is time to sum up the first results and formulate the first rules for minimal use of the Optional: <br><blockquote>  If your method returns an object that may or may not be present, you ‚Äústack‚Äù it in the Optional.  When laying you use the following rules: <br><table><tbody><tr><th>  Condition </th><th>  Class method used </th></tr><tr><td>  Object missing </td><td>  Optional.empty () </td></tr><tr><td>  The object is present and not exactly null. </td><td>  Optional.of (...) </td></tr><tr><td>  The object is present, but may be null </td><td>  Optional.ofNullable (...) </td></tr></tbody></table><br>  Whether the object is in a case, you define using the isPresent () method.  And if the check is positive, you get the object out of the case with get (). <br></blockquote><br>  So we mastered using Optional so that we no longer use null as the return result. <br><br>  But we will not stop there. <br><br>  Let us now consider another, not so rare situation, when a certain resource is represented by the main and reserve element. <br><br><h3>  Well, when there is a stash ... </h3><br>  Zanachka is a common definition for a backup resource.  Let us distract from the emotional side of this term and consider the technical side of the question. <br><br>  In technical systems, resources of the same kind are often available in more than one way. <br><br>  In the following example, we consider a simple water supply fixture.  This is how irrigation devices used by summer residents are arranged.  Rainwater is collected in a special container, which is then consumed first.  If it is not there or it is over, water is consumed from the water supply system. <br><br>  We will not complicate the task with unnecessary details about the incomplete filling of the rain tank and its size, and simply use the familiar CupOfWater class again. <br><br>  The input of such a device is described as follows: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenserInput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater firstPortion)</span></span></span></span>; }</code> </pre> <br>  If rainwater is not collected, then at the entrance we have a zero object, otherwise - a normal object. <br><br>  The output of the device is described by the following interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenserOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">CupOfWater </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  Note that at the output we have a CupOfWater object and not an Optional.  We do so in order to more clearly show the mechanism of interest.  After you, dear readers, understand it, you can easily reprogram an example and receive an Optional output. <br><br>  The behavior of the device as a whole is determined by the combination of these interfaces: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenserInput</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenserOutput</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  As in the previous examples, we first prepare tests to test the behavior of our implementation: <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test WaterDispenser1Test</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaterDispenser1Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IWaterDispenser waterDispenser; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ waterDispenser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WaterDispenser1(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMainAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ waterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater()); assertNotNull(waterDispenser.getCupOfWater()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMainNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ waterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); assertNotNull(waterDispenser.getCupOfWater()); } }</code> </pre> </div></div><br>  Our expectations are as follows: the device produces water regardless of whether the tank with rain water is filled or not, because in the latter case the water will be taken from the ‚Äúreserve‚Äù (water supply system). <br><br>  Consider now the implementation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaterDispenser1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenser</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CupOfWater mainCup; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater mainCup)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainCup = mainCup; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CupOfWater </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(mainCup).orElse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater()); } }</code> </pre> <br>  As we see, the orElse method has been added to the ofNullable () method.  If the first element gives an empty Optional (no rainwater accumulated), the second method will add an object from itself.  If the first method gives a non-empty Optional, the second method will simply pass it through itself and the tap water will remain untouched. <br><br>  This implementation assumed the presence of a backup object.  If you need to create an object before this (in our case, pump up water), you can use the orElseGet () method with the Supplier type parameter: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaterDispenser2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenser</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CupOfWater mainCup; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater mainCup)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainCup = mainCup; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CupOfWater </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(mainCup).orElseGet(()-&gt;<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater()); } }</code> </pre> <br><h3>  Do not let the genie out of the bottle </h3><br>  In some cases, restrictions on your API do not allow you to use Optional as a return value. <br><br>  Suppose that our interface is defined in such a way that the client always expects an object at the output of our function.  If the requested resource is not present at the time of the request, and we do not want to return null, we have only one tool left - throw Exception.  Thus, we do not release the genie from the bottle - we do not allow the released zero object to turn into the client code NullPoiner Exception. <br><br>  Can Java 8 Optional help us in this case?  Yes maybe. <br>  But before considering the solution, we will prepare a test verifying the correctness of its work: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> (expected = IllegalStateException.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMainNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ waterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); waterDispenser.getCupOfWater(); fail(<span class="hljs-string"><span class="hljs-string">"This code line must be not reached"</span></span>); }</code> </pre> <br>  And here is the solution: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaterDispenser3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IWaterDispenser</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CupOfWater mainCup; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater mainCup)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mainCup = mainCup; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CupOfWater </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupOfWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(mainCup).orElseThrow(()-&gt;<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Resource not available"</span></span>)); } }</code> </pre> <br>  I think many readers will not be convinced by this decision.  In fact, how is it better to check for null using if? <br><br>  The main argument in favor of this decision is the possibility of building chains of functional calls in this way.  However, the chain may fail with Exception.  In the fourth article of this series, I venture to offer my solution to the problem of handling Exception in such chains of functional calls. <br><br>  The time has come to formulate a new group of rules on using Optional for the case when we have several alternatives for creating a dynamic object: <br><blockquote>  If you have two or more alternatives for creating a dynamic object, use the following rules: <br><table><tbody><tr><th>  Condition </th><th>  Class method used </th></tr><tr><td>  An alternate object is present. </td><td>  orElse (...) </td></tr><tr><td>  An alternate object must first be created (for example, retrieved from a repository) </td><td>  orElseGet (() -&gt; ...) </td></tr><tr><td>  Alternative resource dried up (throw exception) </td><td>  orElseThrow (() -&gt; new IllegalStateException (...)) </td></tr></tbody></table><br></blockquote><br>  So far, we have considered using Optional at the stages of creating and using objects with dynamic structure.  We now consider the question of how Optional can help us in the transformation of such objects. <br><br><h3>  Using Optional in Converters </h3><br>  A transformer (Transformer) receives an object as input and either modifies it or converts it into some other object.  In our case, since we are limited to using Optional, we always have an Optional as an input object.  Recall that this can be imagined as a case or container in which the object is located or not. <br><br>  You can convert it either to a ‚Äúreal‚Äù object of any type, or to a new case with a new object. <br><br>  At the abstract level, all variants of such a transformation can be expressed in the form of the three formulas below: <br><br>  <b>T t = f1 (Optional &lt;T&gt; opt)</b> <b><br><br></b>  <b>U u = f2 (Optional &lt;T&gt; opt)</b> <b><br><br></b>  <b>Optional &lt;U&gt; = f3 (Optional &lt;T&gt; opt)</b> <br><br>  Candidates for the roles of the f1, f2, and f3 transformation functions ‚Äî methods from the Optional class are presented in this table: <br><blockquote><table><tbody><tr><th>  Candidates for the role of f1 </th><th>  Candidates for the role of f2 </th><th>  Candidates for the role of f3 </th></tr><tr><td rowspan="2">  filter () </td><td rowspan="3">  map () </td><td>  flatMap () </td></tr><tr><td>  orElse () </td></tr><tr><td>  map () </td><td>  orElseGet () </td></tr></tbody></table><br></blockquote><br>  In the previous posts of this cycle, we have already reviewed most of these methods.  Only filter and flatMap remained unreviewed. <br><br>  Below we consider examples of the use of these methods. <br><br><h3>  Filtering (using the filter method) </h3><br>  In the following example, we will consider using the filter () method which returns an object only if the case is not empty and the object it contains satisfies some criteria. <br>  In our case, as an object, we will use a portion of water in the tank to collect irrigation of the suburban area.  Without going into the analysis of physical and chemical features, we will assume that the collected water can either be clean (meet the criteria) or not. <br>  The maximum simplified diagram of the device is shown in the figure below. <br><br><img src="https://habrastorage.org/webt/st/ms/nx/stmsnxcww5qidz0v9vyn0jk7tnk.png"><br><br>  We simplify the behavior of our device as much as possible, reducing everything to a question: whether a portion of water is given out in this or that case or not.  After this simplification, the semantics of the instrument behavior can be described by this table: <br><br><img src="https://habrastorage.org/webt/ki/ap/rq/kiaprqymxvhsd-7h_v9vt71d1z4.png"><br><br>  You can find the complete codes for this example in the project on GitHuB mentioned at the beginning of the article in package eu.sirotin.example.optional4 <br><br>  First we will get acquainted with the class representing collected rainwater: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWater</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> clean; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RainWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> clean)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.clean = clean; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clean; } }</code> </pre> <br>  As you can see, using the isClean () method, you can find out whether the collected water is clean or not. <br><br>  This class is used as an input parameter in our device. <br>  The same object but in the ‚Äúcase‚Äù is used at the exit of the device. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenserInput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable RainWater rainWater)</span></span></span></span>; }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenserOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Optional&lt;RainWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRainWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  And the full behavior of the device is described by a composite interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenserInput</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenserOutput</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  And again we will first prepare a test to verify the correctness of modeling the behavior of our device.  It is not difficult to see that the expectations in the tests below completely correspond to the behavior table presented above. <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test RainWaterDispenser1Test</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWaterDispenser1Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IRainWaterDispenser rainWaterDispenser; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ rainWaterDispenser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWaterDispenser1(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableAndClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); assertTrue(rainWaterDispenser.getRainWater().isPresent()); assertTrue(rainWaterDispenser.getRainWater().get().isClean()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWaterNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); assertFalse(rainWaterDispenser.getRainWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableNotClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); assertFalse(rainWaterDispenser.getRainWater().isPresent()); } }</code> </pre> </div></div><br>  Now let's get down to the implementation of our class with the help of Optional. <br>  Here is its full text: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWaterDispenser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterDispenser</span></span></span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RainWater rainWater; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable RainWater rainWater)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rainWater = rainWater; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;RainWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRainWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(rainWater).filter(RainWater::isClean); } }</code> </pre> <br>  The last line shows the use of the filter () method.  As a criterion, the value returned by the isClean () method of the object is used. <br><br>  Notice also the use of the methods ofNullable () and filter () in the call chain.  Doesn't it look very elegant? <br><br><h3>  Transformation - (using the flatMap method) </h3><br>  Suppose that the device described in the previous example is replaced by another, capable of purifying contaminated rainwater. <br><br>  Its most simplified diagram is shown below. <br><br><img src="https://habrastorage.org/webt/uf/32/bx/uf32bxtfmrh2f4i0dzcjj8ovsx4.png"><br><br>  And the behavior of the device is described by this semantic table: <br><br><img src="https://habrastorage.org/webt/59/ys/wv/59yswvdfaqst0kb4v8d3lz1irv4.png"><br><br>  If we compare this and the previous table, we will see the obvious advantage of the new device: it gives out clean water even if polluted rainwater has entered the inlet. <br>  As always, let's start with the interfaces describing the input and output of the device: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterCleanerInput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable RainWater rainWater)</span></span></span></span>; }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterCleanerOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Optional&lt;CupOfWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCleanedWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  Let's prepare a test verifying whether the device implements the expected behavior from it: <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test RainWaterCleanerTest</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWaterCleanerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IRainWaterCleaner rainWaterDispenser; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ rainWaterDispenser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWaterCleaner(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableAndClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); assertTrue(rainWaterDispenser.getCleanedWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWaterNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); assertFalse(rainWaterDispenser.getCleanedWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableNotClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rainWaterDispenser.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); assertTrue(rainWaterDispenser.getCleanedWater().isPresent()); } }</code> </pre> </div></div><br>  Well, now consider the class itself: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWaterCleaner</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterCleaner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RainWater rainWater; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable RainWater rainWater)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rainWater = rainWater; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;CupOfWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCleanedWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(rainWater).flatMap(w-&gt;Optional.of(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CupOfWater())); } }</code> </pre> <br>  Using the flatMap () method is shown in the last line.  Unlike the map () method, this method does not return the object itself, but a case (container), which may be empty. <br><br><h3>  Using Optional in object consumers (Consume) </h3><br>  In the first example, we looked at the use of the isPresent () method, which allows us to determine if an object is in a case.  In case further processing is supposed only in case of its presence, instead of isPresent (...) it is more expedient to use ifPresent (...) <br><br>  This method does not return any value, but allows you to process an object in a case, if it is there.  If it's not there, nothing happens. <br><br>  Consider its effect on the example of another device, which is a complication of the previous one due to an additional function.  The new version of the device can not only purify rainwater from pollution, but also mix it with certain additives.  As in the previous examples, we will not be interested in the details about these additives. <br><br>  The device is shown in the figure below: <br><br><img src="https://habrastorage.org/webt/5f/rk/1a/5frk1au0m11jr53pf00rd648sua.png"><br><br>  First, we define a new class representing the result of mixing: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MixedWater</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CupOfWater</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MixedWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CupOfWater water)</span></span></span><span class="hljs-function"> </span></span>{} }</code> </pre> <br>  The output of the device is determined by this interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMixerOutput</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterCleanerOutput</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Optional&lt;MixedWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMixedWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  We use the interface from the previous example as input.  Then the full input and output of the device is determined by such a joint interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMixer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IRainWaterCleanerInput</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMixerOutput</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  The behavior of the device is similar to the behavior of the previous device, only instead of purified rainwater, we get purified rainwater with the desired additives. <br><br>  Let's make a test to check the correctness of the behavior of our device: <br><br><div class="spoiler">  <b class="spoiler_title">JUnit test MixerTest</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MixerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IMixer mixer; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mixer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mixer(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableAndClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mixer.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); assertTrue(mixer.getMixedWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWaterNotAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mixer.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); assertFalse(mixer.getMixedWater().isPresent()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRainWaterAvailableNotClean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mixer.setAvailability(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RainWater(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); assertTrue(mixer.getMixedWater().isPresent()); } }</code> </pre></div></div><br>  And here is the implementation of the main class: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mixer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RainWaterCleaner</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMixer</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MixedWater result = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;MixedWater&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMixedWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getCleanedWater().ifPresent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::mix); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Optional.ofNullable(result); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CupOfWater water)</span></span></span><span class="hljs-function"> </span></span>{ result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MixedWater(water); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a closer look at using the ifPresent () method. </font><font style="vertical-align: inherit;">As we can see, the method from our mix () class is used as the input parameter of the method. </font><font style="vertical-align: inherit;">He, in turn, expects a CupOfWater object as an input parameter. </font><font style="vertical-align: inherit;">Notice that a case with an object of this type is returned by the getCleanedWater () method. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let us formulate the rules for using Optional in consumers (clients).</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the processing of a potentially empty object will be done only in the positive case (the object is not empty) - use the IfPresent (...) method. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otherwise, you can find out whether the object lies inside the case using the isPresent () method. </font><font style="vertical-align: inherit;">If it is there, you can take it using the get () method.</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, these are all the examples that I wanted to consider with reference to the Optional class in Java 8. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But our conversation about this class is not over yet. </font><font style="vertical-align: inherit;">In the following articles, I will discuss the innovations in this class in Java 9, as well as some of its drawbacks and limitations. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transition to the </font></font><a href="https://habrahabr.ru/post/347748/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">third article of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this series.</font></font><br>  Illustration: <a href="https://pixabay.com/de/k%25C3%25A4tzchen-tier-haustiere-katze-491013/">ThePixelman</a> </div><p>Source: <a href="https://habr.com/ru/post/347576/">https://habr.com/ru/post/347576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347562/index.html">Announcement of ElixirLangMoscow Meetup # 7</a></li>
<li><a href="../347564/index.html">Xception: compact deep neural network</a></li>
<li><a href="../347570/index.html">Again about services for ICO: read and be terrified</a></li>
<li><a href="../347572/index.html">The story of how two graduates of "mathex" made the first sales</a></li>
<li><a href="../347574/index.html">We use Apple Pay and Troika card as a pass to work</a></li>
<li><a href="../347578/index.html">‚ÄúWhen you tell a true story, they believe it much more‚Äù - Interview with Oleg Shelaev, part 2</a></li>
<li><a href="../347580/index.html">On Lee effect waves: Pitonizing DAF generation</a></li>
<li><a href="../347582/index.html">Personal experience: how we transferred the infrastructure from one data center to the US to another</a></li>
<li><a href="../347584/index.html">Disable triggers in ZABBIX on schedule</a></li>
<li><a href="../347586/index.html">How I made AI to identify fake news with an accuracy of 95% and almost went crazy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>