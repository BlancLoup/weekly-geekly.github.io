<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Thinking out loud about protocol X</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Two years ago, while working on Awesome , I joined the development of XCB , which is part of the Freedesktop initiative. I had to learn the secrets of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Thinking out loud about protocol X</h1><div class="post__text post__text-html js-mediator-article">  Two years ago, while working on <a href="http://awesome.naquadah.org/">Awesome</a> , I joined the development of <a href="http://xcb.freedesktop.org/">XCB</a> , which is part of the <a href="http://www.freedesktop.org/">Freedesktop</a> initiative.  I had to learn the secrets of the X11 protocol and the whole ancient and mysterious world surrounding it. <br><br>  Over the past few months, I have finally washed away all this dirt from myself, and now I feel the need to share my thoughts on all this mess that has been going on for decades. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  When I was not in the world ... </h2><br><br>  ... the <a href="http://en.wikipedia.org/wiki/Toto_(band)">Toto</a> group released their <a href="http://en.wikipedia.org/wiki/Africa_(Toto_song)">famous song "Africa"</a> , and a few smart guys were working on a window system - the X Window System (this is the full name), which also has a (too) long story.  The final protocol version (11th) was developed in the 80s.  You can find out the details of the story in an <a href="http://en.wikipedia.org/wiki/X_Window_System">article on Wikipedia</a> . <br><br>  In 2010, we still listen to disco, and still use various protocols developed in the 80s (and even earlier than X).  Music evolves, protocols change, and X11 does not stand still. <br><br>  The problem is that X11 does not evolve correctly.  The guys from MIT-and-any-other-places-with-wise men created the first version of X in 1984 and made changes up to the 11th version of the protocol.  It was released in 1987, and we use it today.  Eleven versions were released in 3 years in full compliance with the ‚Äúearly release, frequent updates‚Äù model.  I do not know why, but this approach was no longer applied over the next 23 years (although the developers added (and removed) many protocol extensions). <br><br>  I do not know what changes were made in the first 11 major versions of Protocol X, but I am more than confident that in the past 20+ years there is a great need to make major changes to it. <br><br>  In my humble opinion, X11 was not designed with the expectation that he would live for 23 years.  True, I do not blame anyone: I was a 4-year-old child and played Lego when the latest version of Protocol X was released, so I had very few chances to do something better. <br><br><h2>  We will not fix it.  We will adapt </h2><br><br>  This is perhaps the main slogan of protocol X in recent years.  Just do not get me wrong: I'm not going to make a spanking. <br><br>  The X11 protocol grew older over the years, and developers began to add <a href="http://en.wikipedia.org/wiki/X_Window_System_protocols_and_architecture">extensions</a> to it.  Over the years, tons of extensions have been added.  In strict accordance with one of the <a href="http://en.wikipedia.org/wiki/X_Window_System_protocols_and_architecture">initial principles of X</a> : <br><blockquote>  It is important to clearly define what the system is and what it is not.  Do not try to serve the needs of the whole world;  instead, the system should be made expandable so that additional needs can be satisfied in an appropriate way. <br></blockquote><br>  All of them, without exception, were added because (alas, X) the X11 protocol did not provide for all things that have appeared in the last 23 years, such as video, OpenGL, multiple monitors, or the pleasure of drawing oval windows.  Some of these extensions are still in use, and some have already sunk into oblivion. <br><br>  Protocol extensions are not something bad, but attempts to fix the protocol with extensions like <a href="http://en.wikipedia.org/wiki/XFixes">XFixes</a> seem like a bad idea to me, despite all the good intentions that Keith Packard could have guided. <br><br><h2>  Actually, it's still worse than you think. </h2><br><br>  The X11 protocol (without extensions) defines about 120 types of queries: window creation, window movement, and so on. <br><br>  Nowadays, at least 25% of them are completely useless: the use of server-side fonts or the drawing of squares and polygons are not used by any modern application or toolkit.  All of them are redefined in requests from extensions, such as, for example, <a href="http://en.wikipedia.org/wiki/XRender">XRender</a> . <br><br>  Working with multiple monitors is completely confusing.  X11 was designed to work in <a href="http://en.wikipedia.org/wiki/Zaphod_Beeblebrox">Zaphod</a> mode (independent monitors).  But <a href="http://en.wikipedia.org/wiki/Xinerama">Xinerama</a> , and nowadays <a href="http://en.wikipedia.org/wiki/XRandR">XRandR has</a> completely supplanted it - the latest versions of server X (from about 2007) no longer support the Zaphod mode, even though it is part of the core of the X11 protocol. <br><br>  Even worse: many requests contain limitations or flaws in the design, for example, those described in the document by researchers from DEC: <a href="http://www.std.org/~msm/common/protocol.pdf">Why X is not our ideal window system</a> . <br><br><h2>  We pile on top of even more broken standards. </h2><br><br>  Following its <a href="http://en.wikipedia.org/wiki/X_Window_System_protocols_and_architecture">original principles</a> , X does not define policies, but only provides mechanisms that look right. <br><br>  As a result, the developers got together and started writing specifications to define a set of rules and dogmas: <a href="http://en.wikipedia.org/wiki/ICCCM">ICCCM</a> .  That was 22 years ago, in 1988.  It is useless to add that many items of this specification are already hopelessly outdated, because they did not take into account many modern technologies. <br><br>  I am not the only one who thinks so.  The authors of the projects, which became the two main desktop environments, <a href="http://www.kde.org/">KDE</a> and <a href="http://www.gnome.org/">GNOME</a> , saw this already in the 90s, when I was just learning to count.  And they wrote <a href="http://en.wikipedia.org/wiki/Extended_Window_Manager_Hints">EWMH</a> , another standard that perched on top of the ICCCM, complementing it with a number of nice features (maximization, full screen mode, and others). <br><br>  The problem is that this standard was also written by not very far-sighted people who were simultaneously working on their own environments (GNOME, KDE, and maybe some others).  These desktop environments had then and still have a number of strong concepts that determine how the desktop should work: ‚Äúit should have workspaces‚Äù, ‚Äúa window can exist only on one workplace‚Äù, ‚Äúwe can only see one workplace at a time, ‚Äù‚Äú we do not have multiple screens, ‚Äùand so on. <br><br><h2>  Dude, don't worry: we have tulkits! </h2><br><br>  The idea of ‚Äã‚Äãhow the desktop should work nowadays is carved in marble for each application or library that implements EWMH, including <a href="http://www.gtk.org/">GTK +</a> and <a href="http://qt.nokia.com/">Qt</a> . <br><br>  As a result, now everyone just forgot about the standards.  Tulkits implement them independently, bypassing the limitations and flaws of the X11 protocol, and no one wants to look back. <br><br>  And with these toolkits, people are treated as carelessly as with standards.  This sometimes leads to unpleasant side effects.  For example, <a href="http://julien.danjou.info/blog/2009.html">Openoffice as a switch jobs</a> . <br><br><h2>  We do not want to look back?  Worse, we forgot where we came from! </h2><br><br>  The desktop with all these poorly designed standards continues to evolve for over a decade.  New standards continue to be added to it, the most recent of which are based on D-Bus, for example, the <a href="http://www.galago-project.org/specs/notification/">Desktop Notification Specification</a> or the new <a href="http://www.notmart.org/misc/statusnotifieritem/index.html">Status Notifier Specification</a> , developed in KDE. <br><br>  Status Notifier is a new implementation of the good old system tray, based on <a href="http://en.wikipedia.org/wiki/XEmbed">XEmbed</a> , but now using <a href="http://en.wikipedia.org/wiki/D-Bus">D-Bus</a> mechanisms instead of X11, and adding the ability to show something more than just icons in the system tray. <br><br>  The draft specification contains a serious design flaw, which Wolfgang Draxfinger noticed in his <a href="http://lists.freedesktop.org/archives/xdg/2010-May/011516.html">appeal to the XDG mailing list</a> .  Wolfgang points out that X is a network-centric protocol, and D-Bus is not.  Therefore, using the Status Notifier D-Bus specification to send system tray events is a bad idea: running a graphics application from computer A on computer B will update the tray on the wrong host! <br><br>  From the reading of the correspondence it is obvious that this <a href="http://lists.freedesktop.org/archives/xdg/2010-May/011531.html">does not frighten some KDE developers</a> : <br><blockquote>  Of course, you should not worry much about this bizarre particular case.  At the very least, you will consider him as such until you come across him yourself (just testing something or setting up some sophisticated kiosk). " <br></blockquote><br>  What Oswald describes as a special case for many of us is the most typical situation.  In general, as anyone lucky. <br><br>  In my opinion, this is a step back in the wrong direction.  But we can also conclude that the network part of X has become useless, at least for KDE. <br><br><h2>  I prefer to believe in XCB </h2><br><br>  When I joined Freedestop, I had to work on the XCB library, XC Binding.  XCB has a nice, clean, 21st century-based API for working with the X11 protocol.  Its code is generated automatically based on an XML file with a description of the protocol. <br><br>  For comparison, Xlib consists of a muddy code of the 80s codes, practically uncommented and full of hard-coded things.  Only a few are able to understand some of its nooks, such as internationalization or the implementation of XKB.  And all his code is <i>synchronous</i> . <br><br>  Let me explain to those who are not yet up to date: X is a network protocol in which you must send a request (like GET to HTTP) in order to get an answer.  Xlib causes the application to wait for a response to the request, so the application is blocked until server X sends an answer.  XCB does not block the application, which allows you to send a series of requests, do something useful during the waiting time, and then get answers. <br><br>  Imagine that your browser sends to the web server one request at a time and makes you wait for the page to display until it downloads the latest image. <br><br>  In the case when X and all its clients are located on the same computer, the delay is small and inconspicuous, so the benefit of asynchronous XCB is small.  However, on a slow network, the performance gains can be huge, as <a href="http://bugs.freedesktop.org/show_bug.cgi%3Fid%3D4232">Peter Harris proved by rewriting xlsclients to XCB</a> . <br><br>  One of the long-term goals of XCB developers is to finally get rid of Xlib in order to increase speed and reduce the response time of X11 applications.  To do this, you need to port a lot of libraries, because almost none of them (with the exception of <a href="http://www.cairographics.org/">Cairo</a> ) support XCB. <br><br>  From my point of view, now it is a rather useless work.  The desktop world is trusted to GNOME and KDE projects, that is, GTK + and Qt.  At the same time, it seems that none of these toolkits are interested in working either on XCB or on protocol X. They rather make great efforts to circumvent the existing limitations and flaws of X, and still sit atop a barrow of crutches and implementations of perverse by design standards.  It seems to me that no one wants to look back on all these levels and see how they can be improved. <br><br>  They climbed too high to look down and see what recoil could be. <br><br>  <a href="http://www.enlightenment.org/">Enlightenment</a> with its <a href="http://www.enlightenment.org/p.php%3Fp%3Dabout%26l%3Den">EFL</a> was the first toolkit to have an XCB backend (thanks to the work of Vincent Torri).  Unfortunately, this backend is no longer supported, and no one cares about it.  The last time I took it, it did not even compile. <br><br><h2>  X12? </h2><br><br>  The Freedesktop wiki has a page called <a href="http://www.x.org/wiki/Development/X12">X12</a> that lists all the things that need to be fixed.  Unfortunately, this list is only growing, and no one stutters about working on X12. <br><br>  On the other hand, there are several people who are working on <a href="http://www.freedesktop.org/wiki/Software/XKeyboardConfig/XKB2Dreams">XKB2</a> in their free time, the second version of the ‚Äú <a href="http://www.freedesktop.org/wiki/Software/XKeyboardConfig/XKB2Dreams">let's</a> -again-try-fix-keyboard-part-protocol-written-23-year-back‚Äù extension. <br><br>  In general, it does not appear that X12 will appear in the coming decade. <br><br><h2>  Alternatives? </h2><br><br>  Do we have an alternative to X?  There is a <a href="http://en.wikipedia.org/wiki/Wayland_(display_server)">wayland</a> , but for now it is rather useless.  There is also <a href="http://www.directfb.org/">DirectFB</a> , but it doesn‚Äôt port well.  In my opinion, there are no candidates to replace X yet. <br><br>  In any case, none of the main toolkits support such an alternative.  GTK + once supported DirectFB, but as far as I know, now nothing works (as noted by <a href="http://np237.livejournal.com/27459.html">Josselin Mouette</a> ).  That is why the latest versions of the Debian installer have moved to using X in the graphical part (thanks to the work of Cyril Brulebois). <br><br><h2>  Conclusion </h2><br><br>  XCB has existed for more than five years, but very few have become interested in it.  As far as I can see, no one is interested in using the X protocol, everyone is just trying to encapsulate it with some high-level API in order to stop seeing it as soon as possible.  This leads to poorly written applications and toolkits full of ugly hacks. <br><br>  All this also means that writing new applications and XCB-based toolkits should be a very interesting project, but this will have to spend too much time to figure out how to bypass the flaws of Protocol X, introduced by many predecessors over many years, including Qt and GTK + . <br><br>  The main toolkits practically do nothing to win at the expense of returning to the dark waters of X. I think most of their developers prefer to work on beautiful 3D effects based on geolocation than on redefining the best base for everyone. <br><br>  There is too little labor in world X.  The lack of maintainers of X in Debian is a simple consequence of this situation.  Of course, there are very competent and qualified X developers, as you can easily see by reading the blogs on <a href="http://planet.freedesktop.org/">Planet Freedesktop</a> (I don't count).  Unfortunately, their number is not enough to cover the entire scope of X: input devices, graphic devices, specifications of new protocol extensions, and so on.  Server X is a fairly late development, and most developers are more interested in working on it, and not on the protocol itself.  This can be understood. <br><br>  I wonder where we will come with all this in a few years.  By now, I have been cooking in a pot called X for 3 years now, and I feel that sooner or later all the alternatives to KDE and GNOME will become extinct.  The time when you could choose between a dozen ‚Äúmodern‚Äù window managers has passed. <br><br>  In the end, maybe this is simple Darwinism as applied to computer software. <br><br>  <i>Translator's note: The author of this article is French programmer Julien Danjou, the developer of the Awesome window manager.</i>  <i>The original article is located <a href="http://julien.danjou.info/blog/">here</a> .</i>  <i><s>This is my translation.</s> I have not practiced translations for a long time, so I will be grateful for corrections and clarifications.</i> </div><p>Source: <a href="https://habr.com/ru/post/96305/">https://habr.com/ru/post/96305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96291/index.html">PHP interactive console</a></li>
<li><a href="../96292/index.html">Thunderbird extension: quick search on the web</a></li>
<li><a href="../96294/index.html">plink: hide IP address and encrypt traffic in 5 minutes</a></li>
<li><a href="../96298/index.html">Painful compilation of pidgin-2.7.0 and pidgin-sipe-1.10.0</a></li>
<li><a href="../96300/index.html">Subversion Installation on Synology DS210j</a></li>
<li><a href="../96307/index.html">Thunderbird 3.1 RC2 released</a></li>
<li><a href="../96308/index.html">Black market reopened</a></li>
<li><a href="../96310/index.html">Project Offset</a></li>
<li><a href="../96314/index.html">Overview and installation of the iRedMail mail server</a></li>
<li><a href="../96315/index.html">Habrex first update</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>