<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we held a hardware hack contest at Chaos Constructions 2015</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 This weekend in St. Petersburg, the next Chaos Constructions festival was held, which brought together fans, programmers and developers to c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we held a hardware hack contest at Chaos Constructions 2015</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  This weekend in St. Petersburg, the next Chaos Constructions festival was held, which brought together fans, programmers and developers to compete in the skill of creating demo. <br><br>  You can read about the demo <a href="http://chaosconstructions.ru/">on the website of the organizers</a> .  And if in brief, the participants are given the task to do something impressive on the spectrum or similar retro-hardware, and at the same time set limits on the size of the programs and the duration of the demo.  For example, I was very impressed <a href="http://www.youtube.com/watch%3Fv%3D12V_SlZzuq0">with this one on the Spectrum, which fit just 256 bytes</a> !  Yes, the demo is displayed on a big screen with a great sound, so the spectacle is impressive! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our company sponsored the festival, and my colleagues and I organized and held a hardware hack competition, the goal of which was to determine the processor architecture, with a minimum of knowledge about it and a modest set of tools. <br><br><img src="https://habrastorage.org/files/b09/840/a85/b09840a850f84e98be96ca03dc3573a6.jpg"><br><br>  About how the competition was held, how and what we prepared for it and there will be my article.  Who cares, I ask under the cat. <br><a name="habracut"></a><br><br>  So, the aim of the hardware hack competition was to determine the processor architecture, with a minimum of knowledge about it and a modest set of tools.  After the architectural excavations, it was necessary to make changes to the original program or program something different.  In the end, estimated time spent and the wow factor of what happened. <br><br>  An important caveat - in the hands of "players" should have got some piece of iron (and, better than retro), and not the usual comp.  And, as they say, "use what is at hand, and do not look for something else for yourself."  So we took the motherboard from our device <a href="http://metrotek.spb.ru/b3et.html">Berkut-ET</a> , did some work on the file (as well as a little bit on the cutter, screwdrivers, etc.) and instead of the usual device we got a cool gadget: <br><br><img src="https://habrastorage.org/files/6bf/794/c37/6bf794c373df44859c8870096d21268e.JPG"><br><br>  On the reverse side (the interface board, where there is 1G ethernet and FPGA, we did not connect): <br><br><img src="https://habrastorage.org/files/0c3/0b6/825/0c30b6825d9f42a3b369a1ac5a5d467e.JPG"><br><br><h5>  A little bit about architecture and board interiors </h5><br><br>  On board the board is quite old-school stuffing (in fact, the new Bercut-ET already has a more modern, ARM marketing platform): <br><ul><li>  AVR ATmega256 8 MHz + as many as 40 kilobytes of memory (the external chip is connected to 32, and the built-in 8) and 256K programs! </li><li>  FPGA Cyclone II, connected to the AVR via a parallel bus (separate chip select), 5000 logic cells </li><li>  LCD 320x240, operating in eight-color mode (see below), connected to FPGA </li><li>  matrix keyboard connected to FPGA </li><li>  8 LEDs </li><li>  beep'er </li><li>  ftdi USB to uart converter </li></ul><br><br>  Since before the controllers did not have such a developed periphery as now (plus we didn‚Äôt know something many years ago), we got everything we could on the FPGA, and then we programmed interfaces at our discretion.  So on the periphery of the FPGA got LCD, LEDs, keyboard. <br><br>  AVR resources are very limited - he already has a million measurement management tasks, etc.  things.  Therefore, the FPGA has a graphics controller.  Own, with <s>preference and professional mesh frames</s> and Brezenham lines, as well as rectangles, sectors, circles, sign-generator (three sizes of characters + spread) and even dotted lines.  This controller allows you to display graphics on the screen almost at lightning speed, because  it, unlike AVR, operates at 50 MHz.  For example, such a picture appears in a split second: <br><br><img src="https://habrastorage.org/files/fed/a4a/8c8/feda4a8c8ff948ab9ce9a6eeccbcac82.png"><br><br>  However, with all the wealth of functions there is one bottleneck - the memory capacity of the framebuffer.  Enough for only 8 colors.  Therefore, for each pixel, 3 bits are used, which are neatly packed into bytes for optimal memory usage. <br><br>  The situation is similar with the keyboard: FPGA generates pulses to the matrix and tracks keystrokes, while the processor takes only the interrupt and the status register of the pressed buttons.  And with diodes - the processor writes to the FPGA register, and the register outputs are already connected to the diodes. <br><br>  Architecture (enlarged) is: <br><br><img src="https://habrastorage.org/files/ff6/934/10c/ff693410cd67448390e5f0711b2708ba.png"><br><br>  But something I became interested in architecture.  I just wanted to give an idea about the exhibits, so that they were not a black box for the reader. <br><br>  Thus, we already had a piece of iron with all the necessary I / O peripherals for holding a competition (as many as five), and it was quite suitable for the format. <br><br><img src="https://habrastorage.org/files/c99/4db/d4d/c994dbd4d93d4f008bb3e757acc8fed0.JPG"><br><br><h5>  And what will reverse engineer'it? </h5><br><br>  As planned, we had to provide for the "excavation" a processor, whose architecture is not known to the participants beforehand.  In practice, this meant that we had to give a tool that would allow us to study memory, variables, stack, etc.  and experiment with changing its contents and, therefore, the algorithm.  Giving a debugger for AVR seemed too cumbersome and a dreary decision - after all, it took only 3 hours to dig, and I didn‚Äôt really want to connect to each board with a debugger and computer ... <br><br>  And then we decided to write our lightweight stack interpreter, which, in addition to working with the stack and mathematical / logical operations, would be able to display graphic primitives on the screen, squeak and ‚Äúlight‚Äù the LEDs.  Why exactly stack?  It seemed to us rather simple, and besides, it was just interesting to try to do something like Forth, but with a limited set of commands, but also a transparent interface for expanding the system of commands. <br><br>  Well, for the "tinkering" in the memory decided to write a debugger.  What is there to grind: do, so in an adult;) <br><br><h5>  A little about the stack interpreter </h5><br><br>  I did not plan to talk in detail about the stack interpreter in this article (let me know, I will write a separate article with all the details, code and compiler).  Limited to a brief excursion. <br><br>  The stack interpreter reads the program memory and, depending on the operation code, performs certain actions on the top of the stack.  As a rule, 1-2-3 is taken from the top of the stack, rarely 4 values ‚Äã‚Äã(and generally, as many as you like) and the result of the operation is put back on the stack.  This architecture is very simple to implement, and not only programmatically. <br><br>  At the same time, the program looks somewhat unusual, because there is no ‚Äúfamiliar‚Äù record (instead, the reverse Polish one is used).  For example, to sum up two numbers, you must perform two operations ‚Äúput a number on the stack‚Äù, and then the operation ‚Äúsum‚Äù.  As a result, the result of summation will be at the top of the stack, and two operands from the stack will be removed.  In short, the brain needs a little break. <br><br><h5>  Stack interpreter funfte </h5><br><br>  For our interpreter, we took the most necessary set of commands (a total of just over 20): <br><ul><li>  to work with the stack (push, drop, swap, etc ...) </li><li>  for mathematical operations (add, sub, mul, inc, dec, etc ..) </li><li>  for conditions and transitions (if, jump, cond. jump) </li><li>  and, of course, for output to the screen, to the squeaker and diodes </li></ul><br><br>  Such a set makes it possible to organize cycles, conditional transitions, increments of counters and other essential construction.  From the definition of functions (as in FED) we refused <br>  right away so as not to complicate.  Variables also did not implement, as it turned out - in vain. <br><br>  At first they wrote an interpreter in C for a regular Linux machine.  At the same time, a ‚Äúcompiler‚Äù in python appeared, which translates text commands into bytecode. <br><br>  When with the interpreter (by the way, they called it funfte, since forth is ‚Äúfourth‚Äù, and the English ‚Äúfifth‚Äù is already taken under another interpreter) everything became clear, it only remained to develop a debugger, and then put everything together. <br><br><h5>  Debugger: only in hex, only hardcore! </h5><br><br>  This is what we did (do not forget that for the participants everything should be as confusing as possible, so there can be no signatures on the screen itself), schematically: <br><br><img src="https://habrastorage.org/files/42b/b26/128/42bb261289bf4dd3abd8d039511aab6e.png"><br><br>  Due to the fact that funfte has only two memory areas - software and stack, two columns automatically appeared in the debugger.  In the first - a printout remembering programs, and in the second - the stack.  The PC is displayed at the bottom right, and the input line at the bottom allows you to enter write and read memory commands from the built-in keyboard, as well as manage breakpoints and listing. <br><br>  All numbers, of course, in hex. <br><br>  Controlling the debugger and entering commands was moved to the buttons: <br><ul><li>  F1 - restart, execute the entered program from the beginning </li><li>  F3 - continue </li><li>  F4 - next </li><li>  Enter - execution of the entered command </li><li>  0..9 - input of numbers and symbols (as on push-button phones) </li><li>  X - delete the last character entered (backspace) </li><li>  reboot (button on the right, it is not visible on the photo) - reboot the device and get the initial state </li></ul><br><br>  And our debugger taught the most necessary: <br><ul><li>  execute the program step by step (next): to the F4 button </li><li>  set breakpoint: b addr </li><li>  remove breakpoint: d addr </li><li>  continue execution (continue): to the F3 button </li><li>  write value to memory: w addr data </li><li>  change program counter: p new-pc-value </li><li>  make a listing starting at the address in memory: l addr.  The source will be automatically executed from the address p c, if after the command l the program continues. </li></ul><br><br>  As a result, when everything was encoded and transferred to the AVR (of course, they used all the developments from the ‚Äúnative‚Äù project, including the keyboard, diodes, LCD-controller and a lot of ready-made objects), they wrote a simple example on the resulting language, which ‚Äúsets fire‚Äù in the cycle diodes, displays the line "DEMO" and causes the green cube to run across the screen from left to right and back. <br><br>  Cheers, Earned!  And here is how it looks in interactive <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/L5oX71CLD6M%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhKlg6ps59w246A7ooGqghoXRF2kw" frameborder="0" allowfullscreen=""></iframe><br><br><h5>  First day of the festival </h5><br><br>  On Saturday, August 29, with five stitched devices, we arrived at chaos construction and located in the hack space zone. <br><br><img src="https://habrastorage.org/files/48f/314/f52/48f314f5220644d0a5f3c97e98d22d2f.JPG"><br><br>  What pleased us: we didn‚Äôt even have time to wait for the official start of our competition, because our mysterious devices fell into the hands of burned-out memory-diggers. <br><br><img src="https://habrastorage.org/files/f9a/90a/830/f9a90a83085040d1854bb2522cff84af.JPG"><br><br>  My colleagues and I were very afraid that we came up with something too complicated and no one could figure it out.  And, fortunately, made a mistake!  Within ten minutes, one of the participants was able to change the color of the displayed rectangle and ran a whisper about ‚Äústack‚Äù, ‚Äúfort‚Äù and the like. <br><br>  An hour later, the rectangle, which was supposed to move from left to right and back, changed its behavior (not itself, of course, but with the help of one of the contest winners).  To do this, it was necessary to reverse the list of commands, understand the algorithm in the cycle where the rectangle changes the X coordinates, change the Y coordinate. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/-U_y2uEuckM%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhglDQK5uHc6jRmzWV_os8_4fQdS-g" frameborder="0" allowfullscreen=""></iframe><br><br>  Moreover, hackers already had a complete list of commands of our mega-processor on the tables, including (attention!) Even those commands that were not used in the example. <br><br>  At the next call, after two hours of excavation, we were given a device in which a program of only 16 bytes was stitched <s>(, Karl)</s> !  In the overall standings, this work won first place. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/O2dfj9wyrEk%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhi-Ap9lHyxeR1l7y3FdW9CkNL7Kiw" frameborder="0" allowfullscreen=""></iframe><br><br>  And here is another interesting work: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/BZoGwqw4aBU%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhMhxx_07ToY1jBIldxQPp5f8rwbw" frameborder="0" allowfullscreen=""></iframe><br><br>  The result of the first day: more than ten people participated, almost everyone managed.  Fine! <br><br><h5>  Second day of the festival </h5><br><br>  Well, the next day we decided to change the task a bit. <br><br>  Now the participants were open the whole system of commands and, what is already there, the interpreter code.  It was necessary to write something impressive.  And again, the result exceeded expectations: after a couple of hours, I already had a pull request for 4 new commands for the interpreter in github that allowed me to access any stack and memory cell.  Those.  in fact, it was possible to declare variables.  They certainly did not have a name, it was necessary to remember their address, but still. <br><br>  After the merge, building and uploading the firmware, we have a new demo that changes its own code during execution.  She took 52 bytes and second place in our competition. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/98abCxV6Tfw%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgLkijOZjRLGpJ4Tg-32FB2akriPQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Also on the second day we were helped to find and fix a few bugs, for which we thank all the participants! <br><br><h5>  Winner's reward ceremony </h5><br><br>  At the end of the day, at the official closing of the festival, we presented prizes to the winners. <br><br><img src="https://habrastorage.org/files/347/207/52c/34720752cde34c8e98a2d0f318b122bd.jpg"><br><br>  Prizes, of course, also made with their own hands <br><br><img src="https://habrastorage.org/files/908/d15/95e/908d1595ed8d42628ede9c152179479c.jpg"><br><br><h5>  Small conclusion </h5><br><br>  What I would like to say in conclusion.  Thanks to the organizers of the festival for the cool, driving event, for the opportunity to participate in it and for the pleasure of communicating with people who are really enthusiastic.  Thanks to everyone who participated in our competition: we were very pleased to see that we did not try in vain.  Of course, the interpreter in this form is not very practically useful, but allows you to escape from high-level programming, in which 90% of the interesting details are hidden from the developer, and to practice a little memory and attention, as well as learn something new and have fun. <br><br>  And, of course, I thank my colleagues for the teamwork in preparing for the competition. <br><br>  PS: we made one big omission: we didn‚Äôt do full beeper management.  We gave the opportunity to manage only the duration, but it was also necessary to lay the frequency control.  Then the demos could be with music.  Well, nothing, next year we catch up! </div><p>Source: <a href="https://habr.com/ru/post/265873/">https://habr.com/ru/post/265873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265863/index.html">Climb into the clouds - so as not to bury in the ground</a></li>
<li><a href="../265865/index.html">Today, at 12:00 (MSK), see Jump Start broadcast: "Windows 10 in the corporate network"</a></li>
<li><a href="../265867/index.html">Open Rambler.Android MAP</a></li>
<li><a href="../265869/index.html">What is the EIS notary of Russia</a></li>
<li><a href="../265871/index.html">LLVM for researchers</a></li>
<li><a href="../265875/index.html">The evolution of the cloud log collection and the log collector in open source</a></li>
<li><a href="../265883/index.html">Mobile integration with the new cloud PBX 3CX v14</a></li>
<li><a href="../265885/index.html">Video about effective altruism</a></li>
<li><a href="../265887/index.html">‚ÄúBigdata Conference‚Äù - the largest conference on big data very soon</a></li>
<li><a href="../265889/index.html">.NET Native - what does this mean for developers under a universal Windows platform (UWP)?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>