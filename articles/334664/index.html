<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About supporting C # language features in Visual Studio and CodeRush for Roslyn</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C # is constantly evolving. In the spring came the seventh version. This article will review the support for the latest C # features in CodeRush for R...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About supporting C # language features in Visual Studio and CodeRush for Roslyn</h1><div class="post__text post__text-html js-mediator-article"><p>  C # is constantly evolving.  In the spring came the seventh version.  This article will review the support for the latest C # features in CodeRush for Roslyn.  About C # 7.0, there have already been several publications on Habr√©, so the focus is on how it is supported in CodeRush for Roslyn. </p><br><p>  Bonus, at the end of the article, we give a recipe for those who for some reason do not want to use new language features. </p><br><p><img src="https://habrastorage.org/web/1fe/e6b/d69/1fee6bd693844c48960c66de4cbbe95f.png"></p><a name="habracut"></a><br><h2 id="task-like-vozvraschaemye-tipy-asinhronnyh-metodov">  Task-like return types of asynchronous methods </h2><br><p>  If earlier the asynchronous method could return only the <strong>Task</strong> or <strong>Task &lt;T&gt;</strong> types, then it is now possible to declare your own <strong>Task-</strong> like types that can be used in the returned values ‚Äã‚Äãof the asynchronous methods. </p><br><p>  First, let's check how the features work inside the asynchronous method, which returns a <strong>Task-</strong> like type.  For example, for a method with one parameter, try calling <a href="https://documentation.devexpress.com/CodeRushForRoslyn/115562/Coding-Assistance/Code-Providers/Contract-Providers/Exit-Method-Contract">Exit Method Contract</a> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5f7/cbc/ce1/5f7cbcce1ad989e104846ced6f95734c.png"></p><br><p>  As you can see, CodeRush for Roslyn correctly determined that the <strong>return</strong> operator should be empty and should not contain any expression, since  in this case, the return type is not universal (does not contain type parameters).  Other features that generate <strong>return</strong> operators also work correctly.  As an example, let's see how <a href="https://documentation.devexpress.com/">the</a> "r" <a href="https://documentation.devexpress.com/">template</a> , which calls <strong>Smart Return</strong> , will work out inside an asynchronous method: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9cd/f12/aca/9cdf12aca258260d6921f68acc12ae10.gif"></p><br><p>  In this case, CodeRush correctly recognized that the <strong>return</strong> operator should contain an expression of the type <strong>ArgumentKind</strong> and insert the corresponding default value. </p><br><p>  The second point is features that use <strong>await</strong> expressions with a call to an asynchronous method that returns a <strong>Task-</strong> like type.  As can be seen in the following screenshot, CodeRush correctly determines the type of such <strong>await</strong> expressions: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a70/215/2a8/a702152a8285c2be73df9bec11a4002a.png"></p><br><h2 id="kortezhi-znacheniy">  Tuples of values </h2><br><p>  Perhaps this innovation in the specifications of languages ‚Äã‚Äãclaims to be the most sought after.  Now, using convenient syntax, you can declare types that are tuples of multiple values.  You can set as just the types of elements, and their names.  For future releases, we have several ideas on the most extensive support for tuples: identify and delete unused points, swap points, use tuples in <a href="https://documentation.devexpress.com/">Convert to Tuple</a> refactoring, etc. In the meantime, there are support for tuples in existing features.  Let us demonstrate this with the example of <a href="https://documentation.devexpress.com/">Add Parameter</a> refactoring: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/662/261/1f5/6622611f5619a3d7dda181938fd8c5f9.gif"></p><br><p>  Refactoring correctly parsed the entered value as a tuple from <strong>SortingKind</strong> and <strong>SortingOrder</strong> and substituted the tuple from the default values ‚Äã‚Äãof these types as the default value. </p><br><p>  As another example, we will demonstrate the <strong>Smart Return</strong> feature, which is caused by the expansion of the r template: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cca/3d6/acc/cca3d6acc9e304179656093508d19873.gif"></p><br><p>  As you can see, CodeRush for Roslyn uses the names for the variables of the tuple, if they were declared. </p><br><h2 id="vlozhennye-lokalnye-funkcii">  Nested local functions </h2><br><p>  Sometimes it becomes necessary to write an auxiliary function using, which is restricted to a specific method.  In C # 7, it is possible to declare a local function directly in the method body.  Local functions are similar to lambda expressions, but often the code using local functions is more intuitive and understandable. </p><br><p>  First, we updated the <a href="https://documentation.devexpress.com/">Naming Assistant</a> feature so that it works with local functions: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/19f/704/d9c/19f704d9cb6d35ed5a81a04433392a0a.gif"></p><br><p>  And yet, the already familiar <a href="https://documentation.devexpress.com/">Add Parameter</a> also now works with the new syntax: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c35/813/614/c358136141f219b5779ec1ac4eb61171.gif"></p><br><p>  Refactoring correctly found the declaration and all references and added the parameter to the desired position. </p><br><h2 id="rasshirenie-ispolzovaniya-expression-body-i-throw-expression">  Extending the use of expression-body and throw-expression </h2><br><p>  I think that many people liked the use of expression-body in C # 6, now the list of elements where it can be expanded by property accessors, constructors and destructors.  Refactoring <a href="https://documentation.devexpress.com/">Use Expression Body</a> is available on new items: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f71/2e9/cc1/f712e9cc15fd6a0d9c4fd8cce4ed0ff0.png"></p><br><p>  Inverse to this refactoring, <a href="https://documentation.devexpress.com/">Expand Method</a> and <a href="https://documentation.devexpress.com/">Expand Accessor</a> are also available if new syntax is used. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/484/f31/7ec/484f317ec4d2fd859d885216d61ef5c3.png"></p><br><p>  <strong>Use Expression Body</strong> is available now also in cases when there is no implementation in the method / accessor body and only an exception call is present.  With the appearance of a <strong>throw-expression,</strong> writing such methods can be made shorter and clearer: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ed1/732/efd/ed1732efdf29621f5aefa163bf8519b1.png"></p><br><p>  Another case where a throw-expression improves the visibility of the code is the ternary operators.  Now the <strong>if</strong> / <strong>else</strong> expression, in which, depending on the condition, either an exception is called or some value is returned / assigned, you can replace with one expression with a ternary operator.  <a href="https://documentation.devexpress.com/">Compress to Ternary Expression</a> refactoring will help in this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/316/e0e/338/316e0e33836f4d58463abe0dd4239c48.png"></p><br><p>  The reverse refactoring of <a href="https://documentation.devexpress.com/">Expand Ternary Expression will of</a> course also be available on expressions with a throw-expression: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f5b/407/cda/f5b407cda77dffb2d50d2db9825ce968.png"></p><br><h2 id="sopostavlenie-s-obrazcom">  Pattern matching </h2><br><p>  It is also a very powerful innovation, which, I am sure, has already been loved by many users.  It allows in the <strong>if</strong> and <strong>case statements</strong> to check that a variable is an object of a certain type and immediately declare a variable of this type, avoiding unnecessary casting.  In <strong>case-</strong> operators, in addition to this, additional checks in the <strong>when-</strong> expression can be performed. </p><br><p>  In this section, we also have not yet embodied all their ideas.  As an example of what already exists, let's illustrate the work of the <a href="https://documentation.devexpress.com/">Declare Class</a> feature on a <strong>case</strong> expression that uses the new syntax: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a26/9d0/ddf/a269d0ddfadfb75ed7c223d4129a02cb.gif"></p><br><p>  In this case, CodeRush for Roslyn correctly determined that a type pattern was used here, and immediately declared the property used in the <strong>when-</strong> expression.  Let's now debug this method while turning on the <a href="https://documentation.devexpress.com/">CodeRush Debug Visualizer</a> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8f5/744/14d/8f574414da7dd0ce671f15291d0d684b.png"></p><br><p>  When the debugger reaches the <strong>switch-</strong> operator, the <strong>Debug Visualizer</strong> evaluates the expressions in all <strong>case</strong> branches and displays which of them will be executed in this case, making the code for the other branches fainter.  This makes code debugging more intuitive and convenient, showing what code will be executed in the next step. </p><br><h2 id="vozvrat-po-ssylke">  Return by reference </h2><br><p>  Now the variable reference can be used not only in the parameter, but also in the return type of the method.  You can also declare local variables that will contain a reference to the variable. </p><br><p>  Let's take a bunch of two familiar features: <strong>Smart Return</strong> and <strong>Declare Method</strong> and see how they work in the method that returns the value by reference: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a99/8df/c35/a998dfc357d91febdc747139607bba40.gif"></p><br><p>  Smart Return has substituted the ref keyword, since the return statement must contain a ref expression in this case.  <strong>The Declare Method</strong> , determining that the method is being invoked in a ref-expression, declared the correct type of <strong>ref SyntaxNode</strong> . </p><br><h2 id="binarnye-literaly">  Binary literals </h2><br><p>  Now the values ‚Äã‚Äãof some constants in the code can be set using a binary code.  This can be handy in listings.  CodeRush has in its arsenal a feature that allows you to speed up and simplify the task of adding a new element - <a href="https://documentation.devexpress.com/CodeRushForRoslyn/115903/Coding-Assistance/Typing-Helpers">Smart Duplicate Line</a> .  It is enough to press Shift + Enter and CodeRush will add a new element, selecting the text fields for those elements that will require changes: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/30c/805/9dd/30c8059dd8ce03d164448503523b6809.gif"></p><br><h2 id="i-obeschannyy-bonus">  And the promised bonus </h2><br><p>  Few people know, but at the project level, you can choose the language version.  CodeRush for Roslyn considers <strong>Build</strong> |  <strong>Advanced</strong> |  <strong>Language Version</strong> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3fa/9ae/460/3fa9ae460855bbd797568d72ee53d3c4.png"></p><br><p>  For example, if you put C # 4.0, the context menu changes, because the interpolation of the lines was invented in C # 6.0. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2ba/562/be0/2ba562be06548a30a25c82fffef2b8af.png"></p><br><p>  But we do not just hide unsupported menu items by condition, we implement full-fledged support for the necessary version of the language, including at the level of code generation. </p><br><p>  For example, if the project is version C # 6.0, then the <strong>Declare Comparison members</strong> from the <a href="https://documentation.devexpress.com/CodeRushForRoslyn/118647/Coding-Assistance/Declare-Menu">Declare Menu will</a> generate the code like this: </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// ... Class1 other = obj as Class1; if (other == null) { throw new ArgumentException(nameof(obj) + " is not a " + nameof(Class1)); } // ...</span></span></code> </pre> <br><p>  And in C # 3.0, for example, <strong>nameof ()</strong> was not yet, and the code would be like this: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// ... Class1 other = obj as Class1; if (other == null) { throw new ArgumentException("obj is not a Class1"); } // ...</span></span></code> </pre> <br><p>  Due to the use of regular parsers of CodeRush for Roslyn studio, it equally well supports both the new features of C # and the old ones.  CodeRush greatly enhances Visual Studio without slowing it down.  This is especially noticeable on serious enterprise-projects with a large amount of code. </p><br><p>  You can download a trial version of <strong>CodeRush for Roslyn</strong> <a href="">on our website</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/334664/">https://habr.com/ru/post/334664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334652/index.html">Android O: features support for the new operating system</a></li>
<li><a href="../334656/index.html">5 fresh examples of parsing and improving the design in simple ways</a></li>
<li><a href="../334658/index.html">How to try to make the user comfortable and bungle something in the process.</a></li>
<li><a href="../334660/index.html">Test documentation. Turn tables into trees</a></li>
<li><a href="../334662/index.html">Zimbra - we build communications in the company</a></li>
<li><a href="../334666/index.html">Generation of documents. Problems and Solutions</a></li>
<li><a href="../334668/index.html">Thematic modeling with BigARTM</a></li>
<li><a href="../334670/index.html">Math pack for Android - "Micro-Math" - now open source</a></li>
<li><a href="../334672/index.html">JetBrains MPS for those interested # 3</a></li>
<li><a href="../334674/index.html">How not to distract yourself from work. Tips and slak bot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>