<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to reduce the likelihood of errors at the stage of writing code. Note N2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second article on how to avoid a number of errors at the stage of writing code. In the previous article, we mentioned the advice to avoid ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to reduce the likelihood of errors at the stage of writing code. Note N2</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/7f8/628/851/7f86288518f7c60c2abdf4e1c3233e47.png" alt="Operator?:"><br>  This is the second article on how to avoid a number of errors at the stage of writing code.  In the previous article, we mentioned the advice to avoid multiple calculations in one expression.  However, this issue requires more attention.  Consider the danger of difficult conditions, and how you can prevent many logical errors. <br><br><a name="habracut"></a><br><br><h2>  Introduction </h2><br>  The previous article can be found <a href="http://habrahabr.ru/blogs/cpp/115143/">here</a> .  This time, examples of errors will be taken from various well-known projects to emphasize their prevalence.  The errors that will be demonstrated were found by me with the help of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer over a relatively long period of time.  Practically I wrote about everything to the developers and therefore it is possible to hope that they are corrected in new versions of the code.  This is what I write in the introduction, because after the articles I always receive letters asking ‚Äúwrite about the errors you found to the developers of the project‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  1. Do not use the ternary operation '?:' In compound expressions. </h2><br>  <a href="http://www.viva64.com/go.php%3Furl%3D673">The ternary conditional operation is</a> written in C / C ++ using the '?:' Operator.  An operation that returns its second or third operand depending on the value of the logical expression specified by the first operand.  Example: <br><pre>  int minValue = A &lt;B?  A: B; </pre><br>  Ternary operation has a very low priority (see table).  This is often forgotten, and it is because of this that the ternary operation is extremely dangerous. <br><img src="https://habrastorage.org/getpro/habr/post_images/ca9/0f0/347/ca90f0347b35716eea27f35db264ae99.png" alt="Figure 1 - C / C ++ operations, in order of decreasing priority"><br>  Figure 1 - C / C ++ operations, in order of decreasing priority <br><br>  Note that the '?:' Operation has a lower priority than addition, multiplication, the bitwise OR operator, and so on.  Consider the code: <br><br>  int Z = X + (A == B)?  12; <br><br>  This code does not work as it may seem at first glance.  The programmer most likely wanted to add the value of X with the number 1 or with the number 2, depending on the condition (A == B).  But in fact, the condition is the expression "X + (A == B)".  In fact, it says: <br><br>  int Z = (X + (A == B))?  12; <br><br>  I wanted to: <br><br>  int Z = X + (A == B? 1: 2); <br><br>  The first thought is that you need to know the priority of operations.  And the programmers know them, but this ternary operation is very cunning!  Not only beginners make mistakes with it, but also experienced programmers.  It can often be found even in the highest quality code.  Here are a couple of examples. <br><img src="https://habrastorage.org/getpro/habr/post_images/a65/a7b/6ef/a65a7b6effd76aa35b7a5a1cbdd8bca6.png" alt="Newton game dynamics"><br>  <a href="http://www.viva64.com/ru/d/0091/">V502</a> Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '*' operator.  physics dgminkowskiconv.cpp 1061 <br><pre>  dgInt32 CalculateConvexShapeIntersection (...)
 {
   ...
   den = dgFloat32 (1.0e-24f) *
         (den&gt; dgFloat32 (0.0f))? 
            dgFloat32 (1.0f): dgFloat32 (-1.0f);
   ...
 } </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/a7d/305/b84/a7d305b848ae85e15a5f6b0a68ceebc2.png" alt="Chromium"><br>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '-' operator.  views custom_frame_view.cc 400 <br><pre>  static const int kClientEdgeThickness;
 int height () const;
 bool ShouldShowClientEdge () const;
 void CustomFrameView :: PaintMaximizedFrameBorder (gfx :: Canvas * canvas) {
   ...
   int edge_height = titlebar_bottom-&gt; height () -
                     ShouldShowClientEdge ()?  kClientEdgeThickness: 0;
   ...
 } </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/a14/1c8/8e9/a141c88e9c6a2b645b5450d7279aad9a.png" alt="IPP Sample"><br>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower than the '|'  operator.  vm vm_file_win.c 393 <br><pre>  #define FILE_ATTRIBUTE_NORMAL 0x00000080
 #define FILE_FLAG_NO_BUFFERING 0x20000000
 vm_file * vm_file_fopen (...)
 {
   ...
   mds [3] = FILE_ATTRIBUTE_NORMAL |
            (islog == 0)?  0: FILE_FLAG_NO_BUFFERING;
   ...
 } </pre><br>  As you can see, errors of this type deserve attention.  And it was not by chance that I highlighted their description in a separate paragraph.  They are very, very common.  Other examples can be cited, but they are all of the same type. <br><br>  You can avoid such errors if you do not strive to put several operations in a single line of code.  And if you put, then do not be greedy to put additional brackets.  We will talk about brackets below.  For now, let's just try to prevent potential errors when using '?:'. <br><br>  Of course, the '?:' Operator is syntactic sugar and can almost always be replaced by if.  Rare exceptions include such tasks as link initialization: <br><pre>  MyObject &amp; ref = X?  A: B; </pre><br>  Of course, there are no problems with this, but creating a link to A or B without the '?:' Operator will be much more verbose: <br><pre>  MyObject * tmpPtr;
 If (x)
   tmpPtr = &amp; A;
 else
   tmpPtr = &amp; B;
 MyObject &amp; ref = * tmpPtr; </pre><br>  So, to refuse the operator '?:' Is not rational.  But it is easy to make a mistake with him.  Therefore, I personally developed the following rule for myself.  The result '?:' Should immediately be placed somewhere and not combined with other actions.  That is, to the left of the condition of the operator '?:' There must be an assignment operation.  Let's return to the original example: <br><pre>  int Z = X + (A == B)?  12; </pre><br>  I propose to write like this: <br><pre>  int Z = X;
 Z + = A == B?  12; </pre><br>  In the case of an example related to IPP Samples, I would write this: <br><pre>  mds [3] = FILE_ATTRIBUTE_NORMAL;
 mds [3] | = (islog == 0)?  0: FILE_FLAG_NO_BUFFERING; </pre><br>  You can disagree with the recommendation.  I will not defend it.  For example, I do not really like that instead of one line we get two or more.  A good alternative would be to necessarily put the '?:' Operator in parentheses.  I set the main task to show the error patterns.  The choice of the error protection pattern depends on the preferences of the programmer. <br><br><h2>  2. Feel free to use brackets </h2><br>  For some reason, it so happened that the use of extra brackets when programming in C / C ++ is considered to be some kind of shameful action.  Perhaps this comes from the fact that the question about the priority of operations is very much asked to ask at the interview.  And a person subconsciously postpones the desire to always make the most of the mechanism of priorities.  After all, if he puts extra brackets, then suddenly someone will think that he is a novice, and not a true Jedi. <br><br>  I even met a discussion on the Internet where a person categorically argued that using extra brackets is a bad form.  And if a person is not sure how the expression will be calculated, then he needs to learn, not to write programs.  Unfortunately, I could not find this discussion, but I do not share such points of view.  Of course, you need to know the priorities, but if heterogeneous operations are used in the expression, then it is better to secure yourself with brackets.  This will not only protect against potential errors, but also make the code more readable for other developers. <br><br>  Errors with the confusion of priorities also arise not only among beginners, but also among professionals.  In this case, the expression does not have to be very confusing and long.  The error can be made in relatively simple expressions.  Consider some examples. <br><img src="https://habrastorage.org/getpro/habr/post_images/942/f83/d4d/942f83d4de8f05c88a7f9be1d1ae355c.png" alt="Wolfenstein"><br>  <a href="http://www.viva64.com/ru/d/0159/">V564</a> The '&amp;' operator is applied to bool type value.  You have probably forgotten to include the operator.  game g_client.c 1534 <br><pre>  #define SVF_CASTAI 0x00000010
 char * ClientConnect (...) {
   ...
   if (! ent-&gt; r.svFlags &amp; SVF_CASTAI) {
   ...
 } </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/bc3/08d/006/bc308d0065895ce1a9c8c8257c38a9ae.png" alt="Dosbox"><br>  V564 The '&amp;' operator is applied to bool type value.  You have probably forgotten to include the operator.  dosbox sdlmain.cpp 519 <br><pre>  static SDL_Surface * GFX_SetupSurfaceScaled (Bit32u sdl_flags, 
                                             Bit32u bpp) {
   ...
   if (! sdl.blit.surface || (! sdl.blit.surface-&gt; flags &amp; SDL_HWSURFACE)) {
   ...
 } </pre><br>  Well, another example from Chromium: <br><br>  V564 The '&amp;' operator is applied to bool type value.  You have probably forgotten to include the operator.  base platform_file_win.cc 216 <br><pre>  #define FILE_ATTRIBUTE_DIRECTORY 0x00000010
 bool GetPlatformFileInfo (PlatformFile file, PlatformFileInfo * info) {
   ...
   info-&gt; is_directory =
     file_info.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY! = 0;
   ...
 } </pre><br>  The expressions are simple.  The developers are great.  But errors still exist.  So the use of brackets in slippery places will not be superfluous. <br><br>  Probably worth doing so.  If operations are simple and familiar, then additional brackets are not needed.  Examples: <br><pre>  if (A == B &amp;&amp; X! = Y)
 if (A - B &lt;Foo () * 2) </pre><br>  But if more rare operators are used (~, ^, &amp;, |, &lt;&lt;, &gt;&gt;,? :), then explicit brackets will not damage.  This will make it easier to read the code and protect against potential errors.  Examples: <br><pre>  If (! (A &amp; B))
 x = A |  B |  (z &lt;1? 2: 3); </pre><br>  Feel free to use brackets when using rare operations will also help for the "?:" Operator discussed earlier.  What exactly is better to do with "?:" - a matter of taste.  I prefer the simplified version. <br><br><h2>  Conclusion </h2><br>  Write simple and clear code.  By breaking long and complex expressions into several lines, you get a longer code.  But such code is much easier to understand and read.  It is less likely to make a mistake.  Do not be afraid to have an extra variable.  The compiler perfectly optimizes everything. <br><br>  <b>Do not be greedy on brackets in expressions where rare operators are used or where bitwise and logical operations are mixed.</b> <br><br>  A programmer who in the future will read your code with brackets will only say thank you for that. </div><p>Source: <a href="https://habr.com/ru/post/116397/">https://habr.com/ru/post/116397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116386/index.html">Management models of open source projects (Part 1)</a></li>
<li><a href="../116388/index.html">Resolving the password issue - once and for all</a></li>
<li><a href="../116390/index.html">Basic services and tariffs on the cybercrime market in the CIS countries</a></li>
<li><a href="../116391/index.html">ERP Implementation - The Perfect Storm</a></li>
<li><a href="../116393/index.html">Details about the breakthrough AI in Kinect</a></li>
<li><a href="../116398/index.html">Polygon Fill Algorithms</a></li>
<li><a href="../116399/index.html">HackDay # 12-13 will be held this weekend in Yaroslavl and Voronezh. Development of IT projects in two days</a></li>
<li><a href="../116400/index.html">Alternativa3D 8. Light and bones in ‚ÄúMetro 2033 Online‚Äù</a></li>
<li><a href="../116402/index.html">Third Generation Intel SSD 320</a></li>
<li><a href="../116404/index.html">Usmanov and Milner created DST Global-2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>