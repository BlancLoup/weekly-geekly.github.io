<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another mp3 box from mpd and raspberry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wanted to build a network audio player. Not ‚Äúmedia‚Äù, but exclusively to the music. Previously, this was done by the home server (foobar2000 + all so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another mp3 box from mpd and raspberry</h1><div class="post__text post__text-html js-mediator-article">  I wanted to build a network audio player.  Not ‚Äúmedia‚Äù, but exclusively to the music.  Previously, this was done by the home server (foobar2000 + all sorts of remote controls for it), but at last it was ripe to bring it closer to the point where the network wires entered the apartment, so a vacancy arose.  A desktop or laptop for this use is expensive in terms of resource consumption.  I am not picky, the music I play just to create a pleasant background, and not for aesthetic pleasure, therefore I didn‚Äôt have any high requirements for the audio section, just not to sizzle much. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30f/5d3/58d/30f5d358d1803df8570c5a0db8f80a75.jpg" alt="image"><br><br>  TK initially looked like this: <br>  1) ethernet, in extreme cases - wifi <br>  2) support for samba and all Internet radio <br>  3) support of any formats (minimum - mp3 and flac, you can ape) <br>  4) 3.5mm audio jack <br>  5) remote control from a computer (making playlists, etc.), plus a remote control is desirable (there will be enough volume control and track switching), instead of the remote control, the client for the android will be satisfied <br>  6) the finished device, not the designer <br><a name="habracut"></a><br>  Having rummaged in Google and forums, it turned out that if not a designer, then something like <a href="http://www.denon.ru/uk/product/pages/product-detail.aspx%3Fcatid%3DSystems%26subid%3Dminimicro%26productid%3Ddnpf109">Denon DNP-F109</a> or <a href="http://www.streamium.philips.com/">Philips Streamium</a> , etc. <br><img src="https://habrastorage.org/getpro/habr/post_images/f05/737/50b/f0573750b3f032b2b3fa721e66aef191.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Beautiful, of course, but for me it was a brute price / opportunity ratio.  Yes, and selling something they were not observed. <br>  I had to delete the sixth paragraph. <br>  MPD, a demon-player without an interface, but with advanced remote control capabilities ‚Äî there are clients for all operating systems ‚Äî has become a logical software choice; you can also connect a remote control via Lirc. <br><br>  It remains to decide how it will look like hardware.  First I stopped at Raspberry Pi, but not finding it in the nearest grocery, I ordered it from the Chinese, but for now I decided to try the ‚Äúrouter + openwrt + USB sound‚Äù option.  While discussing options with acquaintances, TP-Link ‚ÄúTL-MR3020‚Äù surfaced - cheap enough to buy it just for the sake of experiment.  On Habr√© even found <a href="http://habrahabr.ru/post/184110/">an article on how to screw the sound</a> . <br><br>  I put openwrt, connected a sound player, set up a samba, started mpd ... But the results were not pleased.  Formally, everything worked, but it felt that the router's power was barely enough to pull it all out, the sound creaked slightly, the boot drive with the root file system liked to fall off (the internal memory for sound + samba + mpd was not enough), and it looked like it's all unpresentable. <br><img src="https://habrastorage.org/getpro/habr/post_images/017/c1b/304/017c1b3041df92fe46f29cac6e0bb17a.jpg" alt="image"><br><br>  I had to go after raspberries.  The Chinese did not send in time, apologized, said that they wrapped the parcel, offered to send it via Singapore. But I decided not to wait another month, but I bought it in Moscow, even if it was 30 bucks more expensive than in China. <br><br>  I will not dwell on the Linux installation, I just downloaded and wrote down the raspbian image on the flash drive.  Linux is like Linux, standard debian, no tricks, 8 gig cards and machine performance is enough to restrict yourself.  Moreover, I do not need graphics.  It was necessary to register the autoloading of the sound module (snd_bcm2835). <br><br>  But on mpd and dopilivaniya sound dwell a little more. <br>  Everything is installed as usual, apt-get install mpd, as a service, it can start right away, the config lives in / etc. <br><br>  <b>/etc/mpd.conf</b> <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     music_directory "/mnt/mp3/music" #     playlist_directory "/mnt/mp3/playlists" #   IP- (  "any",      . bind_to_address "192.168.0.50" # port "6600" #       auto_update "yes" audio_output { type "alsa" name "AudioCardName" device "hw:0,0" #   mpd.   ,     alsamixer,   -  50%  ,     .      . mixer_type "software" }</span></span></code> </pre> <br>  I did not specify the connection password, all are in my home network.  The maximum than the harm - it will make the volume higher.  :) <br><br>  Server is ready.  Now you have to choose customers. <br><br>  <b>Android</b> <br>  There were practically no options. <br>  <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.namelessdev.mpdroid">MPDroid</a> or its fork <a href="https://play.google.com/store/apps/details%3Fid%3Dorg.musicpd.android">Mupeace</a> .  Everything else is worse.  What is the difference between these two, I do not understand yet, but I‚Äôve come across Mupeace earlier, so I use it.  There are phone and tablet interfaces, normal Russian support (if the tags are in Unicode), a media library and a file structure (I don't normally have tags written everywhere).  Able to pause music if someone calls.  What is missing is the playback control in the notification zone, but it is partially compensated by the widget. <br><img src="https://habrastorage.org/getpro/habr/post_images/615/f5f/3b4/615f5f3b41038b45c715f11bbca31658.png" alt="image"><br><br>  <b>Windows</b> <br>  There is no ideal option here, but eventually settled on the <a href="http://bitcheese.net/wiki/QMPDClient/">QMPDClient</a> .  Not too handsome, but quite workable. <br><img src="https://habrastorage.org/getpro/habr/post_images/3ae/4a7/7d8/3ae4a77d88451f2d937a3b90172df6d8.png" alt="image"><br><br>  Although <a href="http://gmpclient.org/home">GMPC is</a> also <a href="http://gmpclient.org/home">quite</a> good and generally seems more complete.  Although I will still stay with QMPDClient. <br><img src="https://habrastorage.org/getpro/habr/post_images/0f3/1cc/b5f/0f31ccb5f684d24d1009bc1c25730996.png" alt="image"><br><br>  <b>Windows phone</b> <br>  It's worse here.  There are only two options and both have their drawbacks. <br><br>  <a href="http://www.windowsphone.com/de-de/store/app/sevenmpc/32895bc8-01ae-4dd1-a736-70c9eb40b169">sevenMPC</a> .  Free, able to display a playlist, adjust the volume and switch tracks.  And everything, perhaps.  It does not even display what is being played now.  Well, you can still look at the file structure of the collection, just do nothing with it, you can not even add to the playlist. <br><img src="https://habrastorage.org/getpro/habr/post_images/273/4a3/407/2734a3407cf6550d21fb2e49fbebb763.png" alt="image"><br><br>  <a href="http://www.windowsphone.com/en-us/store/app/mpdi/ff91139c-5770-49bd-b56c-cdecf15b3ff4">MPDi</a> .  Paid, worth a whole dollar.  With a little better playlist, there are several server connection profiles.  But there are no buttons for switching tracks, and with the collection it works the same way as sevenMPC only displays.  Although there is still a search, I haven‚Äôt checked how it works, I didn‚Äôt buy it, but I tried the demo version. <br><img src="https://habrastorage.org/getpro/habr/post_images/811/7d0/4c9/8117d04c99d917dc45d11e2a76eb627f.png" alt="image"><br><br>  About other OS clients I will not say anything.  With Linux, Linux users already know what they have there :), I don‚Äôt have Apple devices, Windows Mobile didn‚Äôt reach my hands, although I should be - maybe an old HTC will be registered as a permanent remote control for the player.  Web interfaces do not interest me - independent clients are more convenient. <br><br>  <b>Underwater rocks</b> <br><br>  Stone One: <br>  Put the client, started the music - it worked.  But when pausing the playback, there was a loud click.  As it turned out, I am not the first to face this.  Mainly recommend to buy a normal USB-zvukushka.  But this is not the only solution. <br>  It helped update the distribution (apt-get dist-upgrade), update the firmware (rpi-update) and add lines to /etc/asound.conf <br><pre> <code class="bash hljs">pcm.!default { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> hw card 0 } ctl.!default { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> hw card 0 }</code> </pre><br>  After the restart, the clicks are gone.  Only a slight buzz at the end of the tracks remains, but when the music plays in the background, I don‚Äôt pay attention to it. <br><br>  Stone Two: <br>  Tags  Although I seem to have been using id3v2 for a long time, but for compatibility I left id3v1 in 1251. And for mpd, as it turned out, v1 is in priority.  So I had to cut v1.  Well, for the order is still fully go to v2.4.  Foobar2000 came to the rescue. <br><br>  Preferences -&gt; Display -&gt; Advanced -&gt; Tagging -&gt; MP3, Put the recording of tags in id3v2.4 format <br><img src="https://habrastorage.org/getpro/habr/post_images/e5c/422/08b/e5c42208b09529ce5af757872958bc21.jpg" alt="image"><br><br>  Allocated all mp3 in the collection and clicked Tagging -&gt; MP3 tag types <br><img src="https://habrastorage.org/getpro/habr/post_images/640/cbe/468/640cbe4686303b326070f2d87907e2db.jpg" alt="image"><br><br>  Removed ticks with ape and id3v1 and forced to write id3v2.4 <br><img src="https://habrastorage.org/getpro/habr/post_images/181/5ea/755/1815ea755fcb1a24b0d2d642b85ffdb1.jpg" alt="image"><br><br>  The server buzzed a couple of hours with a hard disk, after that I launched the collection rescan in mpd and the tags returned to normal. <br><br>  <b>Outcome and prospects</b> <br>  I got almost what I wanted in the TZ, inexpensively and relatively without a file.  The server can safely move. <br>  The old home server is on the right (already retired), the current one is on the left. <br><img src="https://habrastorage.org/getpro/habr/post_images/e0f/c45/ccd/e0fc45ccd008a7bc470be6a9711acd55.jpg" alt="image"><br><br>  How many watts the construction consumes, now I will not say - the power comes from the USB port of the wifi router, the total load of the outlet (desktop, two monitors, printer, scanner, router) practically did not affect everything within the measurement error.  How to take 200 watts with a penny, and takes. <br><br>  Looking forward <br>  1) To make music broadcasting on the Internet via http (now I just have an access folder ‚Äî this is not always convenient, especially from someone else‚Äôs machine). <br>  2) When the router leaves, it will be necessary to power the Raspberry from the amplifier unit (though I don‚Äôt know if there is 5V there). <br>  3) Replace the ethernet wifi.  There should be no special problems, there are compact USB-wifi adapters. <br>  4) Come up with something to use the usual remote control.  I have two of them at all - an old Scorpion, which is stuck in the PS / 2, I steer them with the desktop.  And maykrosoftovsky, from Windows Media Center.  It is easier, of course, to connect the second one, but ideally I will think about using the first one so that the consoles do not produce. </div><p>Source: <a href="https://habr.com/ru/post/201034/">https://habr.com/ru/post/201034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201020/index.html">Nexus 5: Unboxing</a></li>
<li><a href="../201022/index.html">Published source x86 emulator JavaScript</a></li>
<li><a href="../201026/index.html">Live Mobile in a week in Moscow</a></li>
<li><a href="../201028/index.html">We use the old working scanner with benefits</a></li>
<li><a href="../201030/index.html">The course "Industrial PHP-development". How to teach a turkey to fly?</a></li>
<li><a href="../201040/index.html">Apple has placed a hidden warning on the official report.</a></li>
<li><a href="../201042/index.html">Mikrotik and OSPF. What had to face and how we overcame it</a></li>
<li><a href="../201046/index.html">New version of Intel SDK for OpenCL applications</a></li>
<li><a href="../201048/index.html">Filtering by the registry of prohibited sites for Internet providers</a></li>
<li><a href="../201054/index.html">Attempt to transition from Entity Framework 5 to 6 or DataBase-First = Code-First + chart browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>