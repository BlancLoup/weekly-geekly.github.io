<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick installation of SSL certificate from StartSSL in iRedMail mail server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the daily practice of using the iRedMail mail server, it is necessary to replace SSL certificates (both during initial installation and annual chan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick installation of SSL certificate from StartSSL in iRedMail mail server</h1><div class="post__text post__text-html js-mediator-article">  In the daily practice of using the iRedMail mail server, it is necessary to replace SSL certificates (both during initial installation and annual change).  The topic describes the process of changing SSL certificates for iRedMail from StartSSL and suggests a script that allows you to automate all the necessary actions. <br><br>  If you are interested, then welcome under cat. <br><br>  <b>UDP</b>  As of 10.30.2016, the instruction has lost its relevance due to changes made by the developers of the iRedMail package. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h5>  About iRedMail </h5><br>  On Habr√© already there were several posts describing the mail server data: <a href="https://habrahabr.ru/post/96314/">here</a> and <a href="https://habrahabr.ru/post/197756/">here</a> . <br><br>  In short, this is a free open-source mail server with a web interface based on Postfix + Dovecot + SpamAssassin + ClamAV + Roundcube.  iRedMail is easy to install and works out of the box. <br><br><h5>  A little bit about StartSSL </h5><br>  Also on Habr√© already <a href="https://habrahabr.ru/post/127643/">described the</a> process of obtaining a free certificate from StartSSL.  I would like to note that recently StartSSL changed the design.  In my opinion, it has become more pleasant and simple. <br><br>  But more important for me was the fact that a year ago StartSSL did not allow us to confirm the domain of the 3rd level without owning the domain of the 2nd level, but now this possibility has appeared.  Those.  Previously, the system did not give the opportunity to send a letter with a confirmation code to an email of the type postmaster@subdomain.domain.com, any level 3 domain required confirmation from postmaster@domain.com. <br><br>  And now let's get to the bottom line. <br><br><h5>  Installing SSL certificate from StartSSL </h5><br>  For example, we will use example.com as the domain name.  Initial data: <br><br><ol><li>  example.com.key (password-protected RSA-key) </li><li>  example.com.txt (File containing the password for the RSA key) </li><li>  example.com.zip (Archive with certificates, downloaded from StartSSL) </li></ol><br>  We put these files in one directory and perform unpacking certificates. <br><br><pre><code class="bash hljs">chmod 755 ./example.com.zip unzip -o ./example.com -d ./example.com chmod -R 777 ./example.com unzip -o ./example.com/ApacheServer -d ./example.com/ApacheServer chmod -R 755 ./example.com/ApacheServer/*</code> </pre> <br>  Convert the publisher and domain certificates from the archive into the PEM format and glue them together. <br><br><pre> <code class="bash hljs">openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./example.com/ApacheServer/1_root_bundle.crt -outform PEM -out ./example.com/ApacheServer/1_root_bundle.pem -text openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./example.com/ApacheServer/2_example.com.crt -outform PEM -out ./example.com/ApacheServer/2_example.com.pem -text cat ./example.com/ApacheServer/2_example.com.pem ./example.com/ApacheServer/1_root_bundle.pem &gt; ./iRedMail_CA.pem chmod 755 ./iRedMail_CA.pem</code> </pre><br>  We copy the received certificates into the etc / ssl / certs / directory under standard names for iRedMail.  After copying, we will change the owner of the key for Postgresql. <br><br><pre> <code class="bash hljs">\cp ./iRedMail_CA.pem /etc/ssl/certs/iRedMail_CA.pem chmod 644 /etc/ssl/certs/iRedMail_CA.pem \cp ./iRedMail_CA.pem /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem chmod 600 /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem chown postgres:postgres /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem</code> </pre><br>  We get rid of the password in the RSA-key. <br><br><pre> <code class="bash hljs">openssl rsa -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./example.com.key -outform PEM -out ./example.com.key.unprotected -passin pass:$(cat ./example.com.txt)</code> </pre><br>  We copy the received RSA key into the / etc / ssl / private directory under standard names for iRedMail.  After copying, we will change the owner for the Postgresql key. <br><br><pre> <code class="bash hljs">\cp ./example.com.key.unprotected /etc/ssl/private/iRedMail.key chmod 644 /etc/ssl/private/iRedMail.key \cp ./example.com.key.unprotected /etc/ssl/private/iRedMail_PostgreSQL.key chmod 600 /etc/ssl/private/iRedMail_PostgreSQL.key chown postgres:postgres /etc/ssl/private/iRedMail_PostgreSQL.key</code> </pre><br>  Restart services: <br><br><pre> <code class="bash hljs">service postgresql restart service postfix restart service dovecot restart service apache2 restart</code> </pre><br>  We check server performance. <br><br>  To automate all of the above, combine everything into a single script.  We use $ domain as a variable. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash domain=example.com chmod 755 ./$domain.zip unzip -o ./${domain} -d ./${domain} chmod -R 777 ./${domain} unzip -o ./${domain}/ApacheServer -d ./${domain}/ApacheServer chmod -R 755 ./${domain}/ApacheServer/* openssl x509 -in ./${domain}/ApacheServer/1_root_bundle.crt -outform PEM -out ./${domain}/ApacheServer/1_root_bundle.pem -text openssl x509 -in ./${domain}/ApacheServer/2_${domain}.crt -outform PEM -out ./${domain}/ApacheServer/2_${domain}.pem -text cat ./${domain}/ApacheServer/2_${domain}.pem ./${domain}/ApacheServer/1_root_bundle.pem &gt; /tmp/ssl/iRedMail_CA.pem chmod 755 /tmp/ssl/iRedMail_CA.pem \cp /tmp/ssl/iRedMail_CA.pem /etc/ssl/certs/iRedMail_CA.pem chmod 644 /etc/ssl/certs/iRedMail_CA.pem \cp /tmp/ssl/iRedMail_CA.pem /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem chmod 600 /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem chown postgres:postgres /etc/ssl/certs/iRedMail_CA_PostgreSQL.pem openssl rsa -in ./${domain}.key -outform PEM -out ./${domain}.key.unprotected -passin pass:$(cat ./${domain}.txt) \cp ./${domain}.key.unprotected /etc/ssl/private/iRedMail.key chmod 644 /etc/ssl/private/iRedMail.key \cp ./${domain}.key.unprotected /etc/ssl/private/iRedMail_PostgreSQL.key chmod 600 /etc/ssl/private/iRedMail_PostgreSQL.key chown postgres:postgres /etc/ssl/private/iRedMail_PostgreSQL.key service postgresql restart service postfix restart service dovecot restart service apache2 restart</span></span></code> </pre><br>  I would be glad if this script will be useful to someone.  Thanks for reading. <br><br>  <b>UDP</b>  As of 10.30.2016, the instruction has lost its relevance due to changes made by the developers of the iRedMail package. </div><p>Source: <a href="https://habr.com/ru/post/276319/">https://habr.com/ru/post/276319/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276309/index.html">How to train CCIE</a></li>
<li><a href="../276311/index.html">EMET 5.5 released</a></li>
<li><a href="../276313/index.html">Authentication via ESIA OAuth2</a></li>
<li><a href="../276315/index.html">XAML Developer Chips: Conditional Converter</a></li>
<li><a href="../276317/index.html">I'm not smart, I just sat on it longer than you</a></li>
<li><a href="../276321/index.html">Multiprocess Firefox 44.b, Electrolysis Optimization</a></li>
<li><a href="../276323/index.html">Migrate NAS from vfiler NetApp to EMC VNX</a></li>
<li><a href="../276325/index.html">Attackers use Gcat backdoor for cyber attacks on Ukrainian energy companies</a></li>
<li><a href="../276327/index.html">Linux kernel support 2.6.32 LTS ends in February</a></li>
<li><a href="../276329/index.html">Quantum morris</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>