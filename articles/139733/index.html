<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of the author's autograph session for iBooks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work in a small publishing house. And, after the release of the paper version of the children's book, they decided to make its electronic version fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of the author's autograph session for iBooks</h1><div class="post__text post__text-html js-mediator-article"> I work in a small publishing house.  And, after the release of the paper version of the children's book, they decided to make its electronic version for the iPad.  Not an application, but a book in eEub format. <br>  We agreed on a presentation in a large shopping center: paper books are sold, the author signs them, the iPad version is downloaded by visitors of the center, plus they are also played with animation on the provided iPads. <br>  But, if the author signs paper books, why not sign an e-book? <br>  The idea is new and original, but is it realizable? <br>  I will say right away that it was not possible to implement the signing, and this is why ... <a name="habracut"></a><br><br>  Technically, everything is simple - we take the induction stylus, in the book we place the canvas-block with drawing handlers and two secret places, for erasing the unsuccessfully written and for its preservation.  We will save in LocalStorage. <br><br>  C writing texts in the book of problems did not arise.  The code for drawing on the canvas is full internet; the main ‚Äútrick‚Äù is to draw with lines, not points.  The drawing code was underlined <a href="http://modusponens.info/!/paint-1/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will save the canvas with <code>getImageData()</code> . <br>  Since our signature is black and white, you can save not all three RGB values, but only one.  Then we transform the resulting number into a character code and get a hefty line describing our picture. <br><br>  To save used jQuery-plugin <a href="http://www.jstorage.info/">jStorage</a> . <br>  Fine.  Everything works, really on the computer.  We transfer to the iPad. <br><br>  Written text is not restored.  We set alert'y, we look.  It turns out that the drawing is not saved.  We simplify the code, replace the jStorage plugin with a banal, but definitely working - <code>LocalStorage.name=‚Äù-‚Äù</code> . <br>  Does not work.  Google  It turns out that somewhere between iBooks 1.3 and iBooks 2 - Apple has cut off support for LocalStorage, but there is support for cookies. <br><br>  Our canvas is 767x600 pixels in size, which is more than 400 kilobytes of data. <br>  A cookie can save only 4 kilobytes.  So let's cut these pictures into pieces of 4K. <br>  Cook can be 20 pieces per site.  Just in case we create a 150 cookie in a cycle - it works. <br>  We are trying to distribute these images in them - it does not work.  It turns out that the total capacity of cookies is 20 * 4096, i.e., about 80 kilobytes, and the cookie may not be 20, but more, but with less data, so that it does not exceed 80 kilobytes. <br>  Along the way, we otbrebaem another problem - Apache, under which the debugged version ceases to open the page from which such large headers are transferred, you have to clean the cookies every time. <br><br>  It is necessary to reduce the volume of the picture.  You can encode each point not byte, but by bit, but the picture from grayscale becomes black and white, which is ugly. <br>  We google, we find library <a href="http://www.nihilogic.dk/labs/canvas2image/">Canvas2Image</a> .  The library returns either an object of type image, or saves the canvas to disk in jpeg, png or bmp format.  We don't need the object, we need clean data, so an unnecessary piece was thrown out of the library code.  Now we have base64 encoded png. <br>  The size of the picture starts to fluctuate between 20 and 50 KB, which suits us.  The author will receive instructions so as not to be interested in the wishes of the readers. <br><br>  We try to restore the drawn ... Use for this the <code>drawImage()</code> function from canvas.  Hmm, recovers from the second time.  The problem is that the image object that needs to be fed to the drawImage does not have time to fill with data.  For me it was unexpected, because as the image.src base64 data was used, which already seems to be loaded. <br>  The problem was solved by calling drawImage on the load event for the image. <br><br>  Check on your computer - it works. <br>  Transferring to ipad - does not work.  Ory use alert'y.  The picture is saved successfully, it is restored - no.  Put an alert to view each cookie.  The first cookie is read, the second is gone, the javascript in iBooks seems to be falling. <br>  We try to make cookies smaller.  To remove the old ones - I had to remove and re-install iBooks. <br>  Now everything stops after the second cookie is 200 bytes.  It seems that the size of the data for cookies is substantially less than in the browser.  Fail ... <br><br>  At this point, the development was discontinued.  It would be possible to find out the size of the iBooks storage, but debugging the interactive book on the device is too tedious and, it seems, is hopeless in this case.  The author will have to sign only paper books ... </div><p>Source: <a href="https://habr.com/ru/post/139733/">https://habr.com/ru/post/139733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139728/index.html">Sort letters by imap-folders on the mail server without using sieve and others like them</a></li>
<li><a href="../139729/index.html">Looking for a nice investor</a></li>
<li><a href="../139730/index.html">Why do people unsubscribe from your newsletter</a></li>
<li><a href="../139731/index.html">Data Mining in football: let's digitize a match and count everyone!</a></li>
<li><a href="../139732/index.html">How I made the most popular election site</a></li>
<li><a href="../139734/index.html">C # 5 - about async / await from the beginning</a></li>
<li><a href="../139736/index.html">Annotations in JAVA: syntax overview and creating your own</a></li>
<li><a href="../139737/index.html">Repair L-shaped Magsafe connector</a></li>
<li><a href="../139738/index.html">Comic Contest vs Limited Download: Protect user freedom on tablets and smartphones</a></li>
<li><a href="../139739/index.html">We draw the code from "Matrix" for PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>