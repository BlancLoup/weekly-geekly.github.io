<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backdoor on Ubuntu for Amazon EC2, check it out!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In November, a good habrachelovek karohos shared with us an excellent recipe for organizing a free personal VPN on Amazon cloud ( Free VPN from Amazon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backdoor on Ubuntu for Amazon EC2, check it out!</h1><div class="post__text post__text-html js-mediator-article">  In November, a good habrachelovek <a href="http://habrahabr.ru/users/karohos/" class="user_link">karohos</a> shared with us an excellent recipe for organizing a free personal VPN on Amazon cloud ( <a href="http://habrahabr.ru/blogs/infosecurity/107631/">Free VPN from Amazon</a> ).  In short, for those who missed, the idea is, the launch and constant uptime of the micro-image with Ubuntu Server 10.04 with the configured OpenVPN fit into the free Amazon quota (it is given only for a year, but still).  Many then took advantage of this opportunity, including myself. <br><br>  Today I received a letter from Amazon with the title ‚ÄúYour Action Required‚Äù. <a name="habracut"></a>  Summary of the letter: <br><blockquote>  Hey. <br><br>  We recently noticed that the publicly available AMI image contains a public SSH key inside, allowing the author of the image to enter under the root.  Also, according to our logs, you have (or had) instances running from this AMI. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      AMI compromised: <b>ami-c2a255ab</b> <br>  Your account ID: xxxxxxx <br>  Instance ID (s): xxxxxxx <br><br>  Blah blah blah, immediately transfer everything to other instances, do not start any more from this AMI instances.  Also ban entry to your instances with this key.  To do this, find and delete the line in <b>'/root/.ssh/authorized_keys'</b> file and <b>'/home/ubuntu/.ssh/authorized_keys' of the</b> following content: <br><br>  ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCU8QRvONa / Rv4mXSDMVFX7EnIiJd2nuQ0mUHPTGNUCq0PjyNemjXTLztxfbA9q8 + S9T7q1UJG3dp49EzE1Gq8KAQm6vmSn80pPrm3hTHAmiBboIZzoqv6PSedkUvZyqqBn1NK0VZxGH7JvsagW95R2AfTdEwdXRjorxtPzi / MpYdoOzM41yzysyjmIZYdeOcZLliLfv9B31lTaFY2RfxpJ4TWlKh1Fo4 / IyUyd3uyih17ucbKiSdJ2G5iYS01wL18o9Ett8cyjtrYXDewEsGtrL0taQMuPpiD66 + HE37k4GWwNho6vsMSO1qbeTY431EQSaIrr / SKn8ToqnnLBy6On guru <br><br>  Blah blah blah, sorry for the inconvenience, <br>  Amazon EC2 security team. <br></blockquote><br>  <b>ami-c2a255ab</b> is the very image that <a href="http://habrahabr.ru/users/karohos/" class="user_link">karohos</a> gave the link <a href="http://habrahabr.ru/users/karohos/" class="user_link">to</a> in its topic.  Google helpfully suggested that not only I received such a letter, some kind person had already posted it on <a href="http://pastebin.com/q1VH4rmF">PasteBin</a> .  (Funny, PasteBin is starting to compete with Twitter :) <br><br>  I went to my cozy VPV-chick, checked.  It turned out that for ubuntu I deleted this key earlier, but for root there is no.  I began to remember and remembered that I had seen these keys when setting up the instance, I was surprised at their presence, but I thought that Amazon itself needed them.  I was then the first to deal with Amazon EC2, and with setting up the server Ubunt.  In general, I left out of fear that I could not then go to the server. <br><br>  In logs of extraneous inputs did not see.  With default rotation settings, I have logs preserved for about a month.  If it were not for the constant swotting of some bots on the SSH port, probably more would have been preserved. <br><br>  <b>Commands for testing:</b> <br><pre>  # keys for ubuntu
 sudo cat /home/ubuntu/.ssh/authorized_keys
 # keys for root
 sudo cat /root/.ssh/authorized_keys
 # SSH log entries
 grep Accept /var/log/auth.log*
 zcat /var/log/auth.log.?.gz | grep Accept </pre><br>  There should be only one key in authorized_keys that Amazon gave you when creating an instance.  If there are other keys (not yours), delete them. <br><br>  I don‚Äôt know if it can be called a backdoor in the full sense, because the opportunity to enter is not disguised.  Most likely the key simply remained from the author of this image, who had no evil intentions.  A more interesting question, what exactly did the security guards of the Amazon react to?  Probably the complaint of one of the clients that climbed up to him.  (Although the letter does not explicitly say this.) But only the owner of the secret key, that is, the author of the image, could do it. <br><br>  In any case, their customer care (and their reputation) is a matter of respect.  A good example for our cloud services. <br><br>  <b>UPD.</b> <br>  As <a href="http://habrahabr.ru/users/silenceandy/" class="user_link">SilenceAndy</a> suggests, Ubuntu has pages with AMIs that can be used without fear: <a href="http://uec-images.ubuntu.com/releases/8.04/release/">8.04</a> , <a href="http://uec-images.ubuntu.com/releases/9.10/release/">9.10</a> , <a href="http://uec-images.ubuntu.com/releases/10.04/release/">10.04</a> , <a href="http://uec-images.ubuntu.com/releases/10.10/release/">10.10</a> , <a href="http://uec-images.ubuntu.com/releases/11.04/beta-1/">11.04 b1</a> <br><br>  <b>UPD2</b> <br>  The author of this image, Paulo Fisch (guru), has <a href="http://guru.gg/aether/ubuntu-10-4-amazon-aws-free-tier">unsubscribed</a> in his blog: <br><blockquote>  The image of ami-c2a255ab will be removed, since I foolishly left my public SSH key there, which would allow me to log into any instance running from this AMI. <br>  I apologize for the inconvenience, and assure you that this happened only because of inexperience, and not from malicious intent. <br>  After all, I was pointed out in the comments, but then I did not appreciate all the consequences.  My fault! </blockquote></div><p>Source: <a href="https://habr.com/ru/post/117101/">https://habr.com/ru/post/117101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117092/index.html">Google Corporation is close to the purchase of ITA for $ 700 million</a></li>
<li><a href="../117093/index.html">Federal Law of the Russian Federation N 63-FZ "On electronic signature"</a></li>
<li><a href="../117098/index.html">Toshiba stylish external hard drives with USB 3.0 support</a></li>
<li><a href="../117099/index.html">Features of the External Type 1 and External Type 2 routes in OSPF. Part 1</a></li>
<li><a href="../117100/index.html">Illustration of the psychology of modern gadget lovers</a></li>
<li><a href="../117102/index.html">Club Innovators now in Nizhny Novgorod</a></li>
<li><a href="../117103/index.html">Canobuvosti, 86th edition</a></li>
<li><a href="../117109/index.html">Cross-browser inline-block</a></li>
<li><a href="../117110/index.html">Features of the External Type 1 and External Type 2 routes in OSPF. Part 2</a></li>
<li><a href="../117111/index.html">Ubuntu 11.04 goes back to classic GNOME by default instead of Unity?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>