<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Many-to-many relationship, OLAP and MS SQL Server Analysis Services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many-to-many relationships and MS SQL Server Analysis Services 
 I want to devote this post to a simple problem, as it turned out, like handling an OL...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Many-to-many relationship, OLAP and MS SQL Server Analysis Services</h1><div class="post__text post__text-html js-mediator-article"><h4>  Many-to-many relationships and MS SQL Server Analysis Services </h4><br>  I want to devote this post to a simple problem, as it turned out, like handling an OLAP-cube of many-to-many connections using MS SQL Server Analysis Services. <br><a name="habracut"></a><br><br>  First, a little about how I approached this.  The authorities said that it would be nice to deploy some analytics on the existing database.  Having conducted a small Google search, it turned out that OLAP technology is perfect.  And since MS SQL Server is deployed on the company‚Äôs server, the Analysis Services component is even more suitable. <br><br>  Gladly rubbing my hands, I grabbed a Microsoft tutorial that comes bundled with SQL Server.  Two days later I was sure that everything was on my shoulder.  But it was not there ... In the existing database, most of the links between the tables turned out to be many-to-many connections, which at first did not foretell any complications.  But in practice, it turns out that without additional, very meaningful waving of hands is not enough, since  otherwise, the die simply gives out incorrect information. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In runet, finding information on this topic was not an easy task.  Whether it is so self-evident to everyone, or whether the skis do not go.  However, I did find a very cool, great English manual on this topic.  Actually, those who understand English very well or want to understand the topic very well, it is suggested not to read further, but to leave the link: <i><a href="http://www.sqlbi.com/articles/many2many/">http://www.sqlbi.com/articles/many2many/</a></i> <br><br>  Those who, like me earlier, do not have time to read English textbooks, read on.  The post does not constitute a translation of this manual: rather, a certain summation of its first examples + some basics from the Mayrosoft mentioned textbook. <br><br>  Actually what's the problem.  If the reader got acquainted with this post: <i><a href="http://habrahabr.ru/post/67272/">http://habrahabr.ru/post/67272/</a></i> , then he knows that the standard schemes for Olap are the schemes "Star" and "Snowflake".  And what if we were surrounded by many-to-many connections? <br><br>  The easiest option is to get away from many-to-many communication using views ‚Äî this will have a positive effect on the speed of processing requests.  Unable to leave?  Let's figure it out. <br><br>  Formulation of the problem.  Online store.  MS SQL Server, there is a database with notorious M2M links on it, which looks like this: Table of purchase identifiers, the table of categories (food, sport, other) and the table of accounts are attached to it.  Let's complicate the task: now let several people use one account at once (for example, a husband and wife make a purchase at home), respectively, a table of persons is connected via M2M.  And so that it is not sugar at all: let the table of categories of people be tied to the table of persons through M2M.  And we are interested in: what categories of people, what purchases do more often, and when they do it. <br><br><img src="https://habrastorage.org/storage2/48d/c41/fc6/48dc41fc67cbc3ff46d765e7f2298395.jpg" alt="ShcemeDB"><br><br>  The example is contrived, but the problem is still visible: how to connect the future dimension with the fact table right through two M2M links?  It's simple, we will tell SSAS where to look. <br>  After completing the preliminary steps for creating dimensions (Types, Dates, Categories, Persons, Accounts) (see <i><a href="http://habrahabr.ru/post/67272/">http://habrahabr.ru/post/67272/</a></i> ), we try to create a cube on the Sales measure (number of rows).  By default, Visual Studio will offer us only three measures (Types, Accounts, Dates) - after all, only they are directly related to our measure.  Having created a cube, we add the remaining two measures with our hands.  Plus, we create two more auxiliary measures inside the cube that will be responsible for processing the M2M connection: Bridge Accounts Persons and Bridge Persons Categories (both are the number of rows in which tables are understandable). <br>  Thus, we will have the following image: <br><br><img src="https://habrastorage.org/storage2/a2d/f97/189/a2df97189a3254f6552501a393412838.png" alt="Cube_Tables"><br><br><img src="https://habrastorage.org/storage2/994/dec/9b0/994dec9b0ef8a3fb9d3708d6ce9e8ae9.png" alt="Cube_Connections"><br><br>  We see a lot of gray boxes and the fact that Visual Studio has already processed one M2M connection: between the Bridge Persons Categories auxiliary measure and the Accounts dimension.  And that's good, but not enough.  If we ask our cube to give something away right now, we will not get anything good.  No, measurements Dates and Accounts will do everything correctly, but here with Persons and Categories alas. <br><br>  To correct this misunderstanding, let SSAS tell you where to look for information to process our requests.  To do this, fill in the gray boxes on the ‚ÄúUse of Measurements‚Äù tab as follows: click on the gray box-&gt; ellipsis-&gt; type of communication; select ‚ÄúMany to many‚Äù -&gt; Select the intermediate measure group, as it is written in the picture: <br><br><img src="https://habrastorage.org/storage2/d3b/c4f/bfb/d3bc4fbfb13e848c425790df3bfbe817.png" alt="New_Cube_Connections"><br><br>  Voila!  Everything is working.  You can make sure on the next picture: <br><br><img src="https://habrastorage.org/storage2/b94/c67/560/b94c675605b3744840e4be5decefa297.png" alt="Results_Table"><br><br>  What is the magic?  We have indicated SSAS, where and how to search for information about connections.  Note: it is impossible, for example, to correctly fill in the intersection of the "dimension of the Categories and the measure of Sales" before you correctly fill out the "dimension of the Categories and the measure of Bridge Account Persons".  In variants, only Bridge Persons Categories are dropped, since  Visual Studio simply does not know any other way.  But after all, auxiliary measures are also measures.  And the ways for them should be indicated the same way as for ordinary (targeted) measures.  As the table is filled, Visual Studio gains knowledge and offers more options. <br><br>  Now we formulate a mnemonic rule about how to fill the relationship table: "Between the target measure and the target dimension, select the closest measure table to the target measure."  Thus, it turned out that for the Type and Date measurements in the second column there will be a full, interesting Sales measure, and in the third auxiliary Bridge Accounts Persons.  Similarly, to measure Categories. <br><br>  Is it always worth filling out the link table?  Not.  Uninteresting information there is no need to handle.  M2M connections adversely affect the performance of the cube so that, if possible, it is better to get rid of them. <br><br>  Behind this all.  I hope I have a useful post.  At a minimum, I can say that I was looking for something similar at one time, but I did not find it.  I can send the source code of the database and cube from the example. </div><p>Source: <a href="https://habr.com/ru/post/181600/">https://habr.com/ru/post/181600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181588/index.html">Do I need undocumented APIs?</a></li>
<li><a href="../181592/index.html">Login to the site under someone else's account without having a password</a></li>
<li><a href="../181594/index.html">Communication experience with CyanogenMod 10.1</a></li>
<li><a href="../181596/index.html">CheckiNumber.ru: another result of code therapy</a></li>
<li><a href="../181598/index.html">XBMC 12.3 DSPlayer + SmoothVideo Project = dreams come true</a></li>
<li><a href="../181604/index.html">Visualization of lists in the Visual Studio debugger or a new word from ‚ÄúBugAid For Visual Studio‚Äù</a></li>
<li><a href="../181606/index.html">Three fifteen</a></li>
<li><a href="../181608/index.html">Curiosity talked about radiation in space</a></li>
<li><a href="../181610/index.html">We write the client for your favorite site on phoneGap</a></li>
<li><a href="../181614/index.html">SaaS Site Builders. Google sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>