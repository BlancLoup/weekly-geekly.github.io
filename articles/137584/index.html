<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a datepicker similar to the standard in Harmattan</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, as part of a contest for the best article on Qt , I developed the TimePicker component and wrote an article about it. Moreover, in the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a datepicker similar to the standard in Harmattan</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/538/435/1de/5384351debe746b25e7d059f47006208.png" align="left"><img src="https://habrastorage.org/storage2/232/fb9/673/232fb967351c9209a02d7646868bc424.png" align="right">  Some time ago, as part of a contest for the best article on <i>Qt</i> , I <a href="https://gitorious.org/harmattan-timepicker/harmattan-timepicker">developed</a> the <i>TimePicker</i> component and <a href="http://habrahabr.ru/blogs/qt_software/134397">wrote</a> an article about it.  Moreover, in the comments, I said that the next component will be the <i>DatePicker</i> .  A few days ago I finished it. <br><br>  For those who have not read the previous article, I explain: not all components used by <i>Nokia</i> in their Harmattan applications are free, some of them are not included in <i>Qt Components</i> for <i>MeeGo</i> , and some are replaced by surrogates, the picture on the left is the original, the picture on the right is the <i>DatePicker</i> component offered to developers . <br><a name="habracut"></a><br><h4>  Requirements </h4><br>  The first thing that is needed is to determine the requirements for the component, since I was going to implement an analogue of an already existing component, it is simple. <br>  So, the <i>DatePicker</i> should look like a calendar for a specified month, and capture the extreme days of the previous and next month.  Navigation between months is done by clicking on the arrows, by the shift gesture and by tapping on the number of the previous / next month.  The current selected day should be framed and switch by tap.  Today should also stand out a special frame. <br>  By the second requirement, I determined that the component should be implemented independently of the <i>MeeGo Qt Components</i> , which will ensure its portability to any platforms that support <i>Qt Quick</i> . <br><br><h4>  Component </h4><br><h5>  Lyrical digression </h5><br>  Initially, you should lay a flexible configuration of the appearance of the component.  And since it is rather complicated, it will have relatively many settings.  I went the same way as the authors of the original <i>Qt Components</i> , namely, I created a simple style component that is populated with properties set by default. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">QtObject { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: style property string orientationString: <span class="hljs-string"><span class="hljs-string">"portrait"</span></span> property string backgroundImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-calendar-monthgrid-background-"</span></span> + orientationString property string currentDayImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-current-day-"</span></span> + orientationString property string selectedDayImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-selected-day-"</span></span> + orientationString property string currentSelectedDayImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-selected-day-current-"</span></span> + orientationString property string leftArrowImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-calendar-monthgrid-previousbutton"</span></span> property string leftArrowPressedImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-calendar-monthgrid-previousbutton-pressed"</span></span> property string rightArrowImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-calendar-monthgrid-nextbutton"</span></span> property string rightArrowPressedImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-calendar-monthgrid-nextbutton-pressed"</span></span> property string eventImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-regular-day-eventindicator"</span></span> property string weekEndEventImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-regular-weekend-day-eventindicator"</span></span> property string currentDayEventImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-current-day-eventindicator"</span></span> property string selectedDayEventImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-selected-day-eventindicator"</span></span> property string otherMonthEventImage: <span class="hljs-string"><span class="hljs-string">"image://theme/meegotouch-monthgrid-daycell-othermonth-day-eventindicator"</span></span> property color weekEndColor: <span class="hljs-string"><span class="hljs-string">"#EF5500"</span></span> property color weekDayColor: <span class="hljs-string"><span class="hljs-string">"#8C8C8C"</span></span> property color otherMonthDayColor: <span class="hljs-string"><span class="hljs-string">"#8C8C8C"</span></span> property color dayColor: <span class="hljs-string"><span class="hljs-string">"#000000"</span></span> property color monthColor: <span class="hljs-string"><span class="hljs-string">"#000000"</span></span> property color currentDayColor: <span class="hljs-string"><span class="hljs-string">"#EF5500"</span></span> property color selectedDayColor: <span class="hljs-string"><span class="hljs-string">"#FFFFFF"</span></span> property int monthFontSize: <span class="hljs-number"><span class="hljs-number">32</span></span> property int dayNameFontSize: <span class="hljs-number"><span class="hljs-number">18</span></span> property int dayFontSize: <span class="hljs-number"><span class="hljs-number">26</span></span> }</code> </pre> <br>  In the future, any <i>DatePicker</i> user can change the settings by defining his style from the default.  As you can see, defaults are configured on the <i>Harmattan</i> platform and, when used on a great platform, must be redefined. <br><br><h5>  The main thing </h5><br>  First of all, it is necessary to determine the structure of our component, in general, it consists of three elements: <br><ul><li>  Hat with the name of the month and arrows </li><li>  Row with days of the week </li><li>  Grate with the dates of the month </li></ul><br>  Consider them separately. <br><br><h5>  Hat with the name of the month and arrows </h5><br><pre> <code class="javascript hljs">Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: header anchors { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: parent.left right: parent.right top: parent.top } height: <span class="hljs-number"><span class="hljs-number">65</span></span> Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: leftArrow anchors { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: parent.left top: parent.top bottom: parent.bottom } width: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">65</span></span> Image { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: leftArrowImage anchors { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: parent.left leftMargin: (header.width / <span class="hljs-number"><span class="hljs-number">7</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span> - (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) verticalCenter: parent.verticalCenter } width: height source: root.platformStyle.leftArrowImage } MouseArea { anchors.fill: parent onPressed: { leftArrowImage.source = root.platformStyle.leftArrowPressedImage } onReleased: { leftArrowImage.source = root.platformStyle.leftArrowImage previousMonthAnimation.start() dateModel.showPrevious() } } } Text { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: monthLabel anchors.centerIn: parent font.pixelSize: root.platformStyle.monthFontSize font.weight: Font.Light color: root.platformStyle.monthColor } Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: rightArrow anchors { <span class="hljs-attr"><span class="hljs-attr">right</span></span>: parent.right top: parent.top bottom: parent.bottom } width: <span class="hljs-number"><span class="hljs-number">100</span></span> height: <span class="hljs-number"><span class="hljs-number">70</span></span> Image { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: rightArrowImage anchors { <span class="hljs-attr"><span class="hljs-attr">right</span></span>: parent.right rightMargin: (header.width / <span class="hljs-number"><span class="hljs-number">7</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span> - (width / <span class="hljs-number"><span class="hljs-number">2</span></span>) verticalCenter: parent.verticalCenter } width: height source: root.platformStyle.rightArrowImage } MouseArea { anchors.fill: parent onPressed: { rightArrowImage.source = root.platformStyle.rightArrowPressedImage } onReleased: { rightArrowImage.source = root.platformStyle.rightArrowImage nextMonthAnimation.start() dateModel.showNext() } } } }</code> </pre><br>  Here, everything is quite simple and clear at first glance: in the middle is a text field, and along the edges are two pictures with arrows that change when you click, and start the month change procedures, as well as the animation. <br><br><h5>  Row with days of the week </h5><br><pre> <code class="javascript hljs">Row { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: weekDaysGrid anchors { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: parent.left right: parent.right top: header.bottom bottomMargin: <span class="hljs-number"><span class="hljs-number">10</span></span> } width: parent.width WeekCell { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: qsTr(<span class="hljs-string"><span class="hljs-string">"Mon"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: qsTr(<span class="hljs-string"><span class="hljs-string">"Tue"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: qsTr(<span class="hljs-string"><span class="hljs-string">"Wed"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: qsTr(<span class="hljs-string"><span class="hljs-string">"Thu"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: qsTr(<span class="hljs-string"><span class="hljs-string">"Fri"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">isWeekEnd</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> text: qsTr(<span class="hljs-string"><span class="hljs-string">"Sat"</span></span>) platformStyle: datePicker.platformStyle } WeekCell { <span class="hljs-attr"><span class="hljs-attr">isWeekEnd</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> text: qsTr(<span class="hljs-string"><span class="hljs-string">"Sun"</span></span>) platformStyle: datePicker.platformStyle } }</code> </pre><br>  The <i>Row</i> component builds its children in one line, in the order in which they are declared. <br>  As can be seen from the code, own components are used as children, which, however, are quite simple: <br><pre> <code class="javascript hljs">Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: weekCell property alias text: label.text property QtObject platformStyle: DatePickerStyle {} property bool isWeekEnd: <span class="hljs-literal"><span class="hljs-literal">false</span></span> height: label.height width: parent.width / <span class="hljs-number"><span class="hljs-number">7</span></span> Text { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: label anchors.centerIn: parent font.pixelSize: weekCell.platformStyle.dayNameFontSize color: weekCell.isWeekEnd ? weekCell.platformStyle.weekEndColor : weekCell.platformStyle.weekDayColor font.bold: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  Particular attention should be paid to the transfer of the style object to these components from the <i>DatePicker</i> , so we save the user from additional worries - in fact, he doesn‚Äôt have to know about the existence of the <i>WeekCell</i> component at <i>all</i> . <br><br><h5>  Grate with the dates of the month </h5><br>  For the grid with numbers, I used a GridView: <br><pre> <code class="javascript hljs">GridView { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: daysGrid anchors { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: weekDaysGrid.bottom left: parent.left right: parent.right bottom: parent.bottom } cellWidth: width / <span class="hljs-number"><span class="hljs-number">7</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> cellHeight: height / <span class="hljs-number"><span class="hljs-number">6</span></span> interactive: <span class="hljs-literal"><span class="hljs-literal">false</span></span> delegate: DayCell { <span class="hljs-attr"><span class="hljs-attr">platformStyle</span></span>: datePicker.platformStyle width: daysGrid.cellWidth; height: daysGrid.cellHeight isCurrentDay: model.isCurrentDay isOtherMonthDay: model.isOtherMonthDay hasEventDay: model.hasEventDay dateOfDay: model.dateOfDay } model: DateModel { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: dateModel currentDate: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>() onMonthChanged: { monthLabel.text = getMonthYearString() daysGrid.currentIndex = dateModel.firstDayOffset + selectedDate.getDate() - <span class="hljs-number"><span class="hljs-number">1</span></span> } onSelectedDateChanged: { root.selectedDateChanged(selectedDate) } } MouseArea { anchors.fill: parent property int pressedPosition: <span class="hljs-number"><span class="hljs-number">0</span></span> onPressed: { pressedPosition = mouseX } onReleased: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delta = mouseX - pressedPosition; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.abs(delta) &gt; <span class="hljs-number"><span class="hljs-number">100</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { nextMonthAnimation.start() dateModel.showNext() } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousMonthAnimation.start() dateModel.showPrevious() } } pressedPosition = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.abs(delta) &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = daysGrid.indexAt(mouseX, mouseY) daysGrid.currentIndex = index dateModel.selectedDate = daysGrid.currentItem.dateOfDay <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (daysGrid.currentItem.isOtherMonthDay) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (daysGrid.currentItem.dateOfDay.getMonth() &lt; dateModel.selectedDate.getMonth()) previousMonthAnimation.start() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextMonthAnimation.start() dateModel.changeModel(daysGrid.currentItem.dateOfDay) } } } } }</code> </pre><br>  Here we should pay special attention to the fact that <i>View has</i> the interactive mode disabled and the only <i>MouseArea</i> completely closes <i>it</i> , it solves the problem with shift gestures, we simply process the length of the path traversed by the finger, and if it exceeds the specified number, we switch to the new month.  If the path is not great at all, then the user simply clicked on a certain day.  We can determine the position of the required cell by the remarkable <i>indexAt</i> method, which returns the cell index by pixel coordinates. <br><br>  The cell delegate itself is very simple: <br><pre> <code class="javascript hljs">Item { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: dayCell property QtObject platformStyle: DatePickerStyle {} property bool isOtherMonthDay: <span class="hljs-literal"><span class="hljs-literal">false</span></span> property bool isCurrentDay: <span class="hljs-literal"><span class="hljs-literal">false</span></span> property bool isSelectedDay: <span class="hljs-literal"><span class="hljs-literal">false</span></span> property bool hasEventDay: <span class="hljs-literal"><span class="hljs-literal">false</span></span> property date dateOfDay <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GridView.isCurrentItem) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.selectedDayColor <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.currentDayColor <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isOtherMonthDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.otherMonthDayColor <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.dayColor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GridView.isCurrentItem) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.currentSelectedDayImage <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.selectedDayImage } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.currentDayImage <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eventImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GridView.isCurrentItem) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.selectedDayEventImage <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dateOfDay.getDay() === <span class="hljs-number"><span class="hljs-number">0</span></span> || dateOfDay.getDay() === <span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.weekEndEventImage <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCurrentDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.currentDayEventImage <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isOtherMonthDay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.otherMonthEventImage <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> platformStyle.eventImage } Image { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: background anchors.centerIn: parent source: dayCell.background() Text { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: label anchors.centerIn: parent font.pixelSize: dayCell.platformStyle.dayFontSize color: dayCell.color() font.weight: (dayCell.isCurrentDay || dayCell.GridView.isCurrentItem) ? Font.Bold : Font.Light text: dayCell.dateOfDay.getDate() } Image { anchors { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: label.bottom topMargin: <span class="hljs-number"><span class="hljs-number">-5</span></span> horizontalCenter: parent.horizontalCenter } visible: hasEventDay source: dayCell.eventImage() } } }</code> </pre><br>  These are just a couple of pictures and text, the main picture serves to highlight the current and today's element, and an additional one is displayed if an event is scheduled for this day.  Auxiliary functions are concerned with deciding what the appearance of an element should be depending on the state of its flags. <br><br><h4>  Model </h4><br>  The most difficult, dreary and ambiguous part of the component.  The fact is that I wanted to make the model exclusively on <i>Qml / ECMAScript</i> , although the <i>C ++</i> solution would be both more beautiful and simpler, but this would create additional difficulties with the implementation, because the user would have to carry a <i>Cml</i> plug-in with <i>C ++</i> code <br>  So, the difficulty lies in the fact that in <i>ECMAScript there is a</i> disgusting built-in class for working with a date, it is terrible, it can do almost nothing, for example, it cannot tell if there is a leap year on the current date, or how many days in the current month.  Or, for example, on what day of the week is the first day of the current month.  All this had to create yourself. <br><br><h6>  Auxiliary parts of the model </h6><br>  I am neither a guru nor a fan of ECMAScript / Javascript, so I am absolutely not sure that these methods are made as optimally as possible.  They perform their function, but in my opinion they are ugly. <br>  I will not give their implementation here, I will give only names. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLeapYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">year</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidDayByMonthAndDay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">month, day, leapYear</span></span></span><span class="hljs-function">);</span></span></code> </pre><br>  The first one returns the truth if the year is a leap year, and the second one returns the correct number in the month according to the expected date, month and leap year, in other words, it corrects the boundary values ‚Äã‚Äãduring the transition between months. <br><br><h6>  Interface methods of the model </h6><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//public: function setEvent(eventDate, enable) { if (eventDate.getMonth() !== selectedDate.getMonth() &amp;&amp; eventDate.getFullYear() !== selectedDate.getFullYear()) return setProperty(eventDate.getDate() + firstDayOffset, "hasEventDay", enable) } function getMonthYearString() { return Qt.formatDate(selectedDate, "MMMM yyyy") } function showNext() { showOtherMonth(selectedDate.getMonth() + 1) } function showPrevious() { showOtherMonth(selectedDate.getMonth() - 1) } function changeModel(_selectedDate) { clear() selectedDate = _selectedDate fillModel() monthChanged() }</span></span></code> </pre><br>  The <i>setEvent</i> method sets or clears the event flag on a given date, as can be seen from the code, now only events of the current month are processed, which forces users using events to track date changes and set events every time they change again.  In the future, I plan to resolve this issue by creating an array of events inside the model. <br>  The <i>getMonthYearString</i> method simply returns a date in the <i>‚Äúmonth year‚Äù</i> format, as you might guess, this is necessary for the <i>DatePicker</i> header. <br>  The <i>showNext</i> and <i>showPrevious methods</i> simply switch the model to the next or previous month, respectively. <br>  Well, the <i>changeModel</i> method <i>allows</i> me to change the current selected date to an arbitrary one. <br><br><h6>  Private model methods </h6><br>  Unfortunately, <i>Qml</i> does not yet know how to make methods private, but the methods that <i>MUST</i> be private will be presented <i>below</i> . <br><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showOtherMonth</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">month</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newDate = selectedDate <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentDay = selectedDate.getDate() currentDay = getValidDayByMonthAndDay(month, currentDay, isLeapYear(selectedDate.getFullYear())); newDate.setMonth(month, currentDay) changeModel(newDate) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmpDate = selectedDate tmpDate.setDate(selectedDate.getDate() - (selectedDate.getDate() - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstDayWeekDay = tmpDate.getDay() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (firstDayWeekDay === <span class="hljs-number"><span class="hljs-number">0</span></span>) firstDayWeekDay = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> firstDayWeekDay-- firstDayOffset = firstDayWeekDay <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span> * <span class="hljs-number"><span class="hljs-number">7</span></span>; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objectDate = selectedDate; objectDate.setDate(selectedDate.getDate() - (selectedDate.getDate() - <span class="hljs-number"><span class="hljs-number">1</span></span> + firstDayOffset - i)) appendDayObject(objectDate) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendDayObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dateOfDay</span></span></span><span class="hljs-function">) </span></span>{ append({ <span class="hljs-string"><span class="hljs-string">"dateOfDay"</span></span> : dateOfDay, <span class="hljs-string"><span class="hljs-string">"isCurrentDay"</span></span> : dateOfDay.getDate() === currentDate.getDate() &amp;&amp; dateOfDay.getMonth() === currentDate.getMonth() &amp;&amp; dateOfDay.getFullYear() === currentDate.getFullYear(), <span class="hljs-string"><span class="hljs-string">"isOtherMonthDay"</span></span> : dateOfDay.getMonth() !== selectedDate.getMonth(), <span class="hljs-string"><span class="hljs-string">"hasEventDay"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span> }) }</code> </pre><br>  The <i>showOtherMonth</i> method moves the model to another month, leaving the number unchanged (with adjustments to the boundaries, of course). <br>  The <i>fillModel</i> method Fills the model with the numbers of the month. To do this, it first finds out from which day of the week the month begins. <br>  The <i>appendDayObject</i> method simply adds a new entry to the model using the specified template. <br><br><h4>  Conclusion </h4><br>  That's all.  Comments, suggestions, suggestions, bug reports, patches - you are welcome. <br><br>  The component code <a href="https://gitorious.org/harmattan-timepicker/harmattan-datepicker">is available on Gitorius</a> .  It is distributed as a TimePicker, under the BSD License.  A quick usage guide <a href="http://va-sorokin.blogspot.com/2012/02/presentation-of-meego-harmattan-native.html">can be found</a> on my blog. </div><p>Source: <a href="https://habr.com/ru/post/137584/">https://habr.com/ru/post/137584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137571/index.html">EX.UA, LOIC and helpless Ukrainian police</a></li>
<li><a href="../137577/index.html">Ruby on rails to the masses: webvybory2012.ru issue a standard error page for the development of the Rails environment</a></li>
<li><a href="../137578/index.html">Opera Mini update - even if it is not installed</a></li>
<li><a href="../137581/index.html">Dynamic Access Control for ASP.NET MVC</a></li>
<li><a href="../137582/index.html">Mysterious indents between inline elements</a></li>
<li><a href="../137585/index.html">IT in tourism is a myth</a></li>
<li><a href="../137587/index.html">DNS server BIND (theory)</a></li>
<li><a href="../137588/index.html">Weigh CSS selectors</a></li>
<li><a href="../137589/index.html">fbi.gov also uses nginx</a></li>
<li><a href="../137590/index.html">How to protect against unexpected commenting by Ctrl + Enter?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>