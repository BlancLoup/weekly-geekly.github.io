<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kubernetes 1.14: a review of major innovations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This night will be the next release of Kubernetes - 1.14 . Following the tradition that has arisen for our blog, we talk about the key changes in the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kubernetes 1.14: a review of major innovations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/dx/2g/0e/dx2g0etf3mgkoidtla2dfbgmud4.png"><br><br>  This night <a href="">will be the</a> next release of Kubernetes - <a href="">1.14</a> .  Following the tradition that has arisen for our blog, we talk about the key changes in the new version of this wonderful Open Source product. <br><br>  The information used to prepare this material is taken from <a href="https://docs.google.com/spreadsheets/u/1/d/116X6E-lmDJG5UZPlqDAFw8hN9vS6SNY4qRNZ9fKtsMU/edit">the Kubernetes enhancements tracking table</a> , <a href="">CHANGELOG-1.14</a> and the corresponding issues, pull requests, Kubernetes Enhancement Proposals (KEP).  <b>UPDATE</b> (March 26): the <a href="https://kubernetes.io/blog/2019/03/25/kubernetes-1-14-release-announcement/">official announcement of the release</a> appeared on the K8s blog. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with an important introduction from cluster-lifecycle SIG: Kubernetes <b>dynamic fault-tolerant clusters</b> (and more precisely, self-hosted HA deployments) <a href="https://github.com/kubernetes/enhancements/issues/357">can</a> now <a href="https://github.com/kubernetes/enhancements/issues/357">be created</a> using the usual (in the context of single-node clusters) <code>kubeadm</code> ( <code>init</code> and <code>join</code> ) commands.  In short, for this: <br><br><ul><li>  certificates used by the cluster are transferred to secrets; </li><li>  in order to be able to use the etcd cluster inside the K8s cluster (i.e., getting rid of the external dependency that still existed), the <a href="https://github.com/coreos/etcd-operator">etcd-operator is</a> involved; </li><li>  The recommended settings for the external load balancer providing a fault-tolerant configuration are documented (in the future, the possibility of failure from this dependency is planned, but not at this stage). </li></ul><br><img src="https://habrastorage.org/webt/s0/0l/v4/s00lv4q1fpdozudahtus5ummwq4.png"><br>  <i>Kubernetes HA-cluster architecture created with kubeadm</i> <br><br>  Implementation details can be found in the <a href="https://docs.google.com/document/d/1P3oUJ_kdaRSTlGONujadGBpYegjn4RjBNZLHZ4zU7lI/edit">design proposal</a> .  This feature was really long-awaited: the alpha version was expected back in K8s 1.9, but it appeared only now. <br><br><h2>  API </h2><br>  The <code>apply</code> command and generally the <b>declarative management of objects are</b> <a href="https://github.com/kubernetes/enhancements/issues/555">moved</a> from <code>kubectl</code> to apiserver.  The developers themselves briefly explain their decision by the fact that <code>kubectl apply</code> is a fundamental part of working with configurations in Kubernetes, but ‚Äúis full of bugs and difficult to fix,‚Äù and therefore this functionality must be reduced to normal form and transferred to the control plane.  Simple and clear examples of existing problems today: <br><br><img src="https://habrastorage.org/webt/5b/sl/cw/5bslcwl-e_5kxq67oqrsgizwsk0.png"><br><br>  Details on implementation - in <a href="">KEP</a> .  Current readiness - alpha version (advance to beta is scheduled for the next release of Kubernetes). <br><br>  In the alpha version, it became possible <a href="https://github.com/kubernetes/enhancements/issues/692">to</a> use the OpenAPI v3 schema to <b>create and publish OpenAPI documentation on CustomResources</b> (CR) used for validating (on the server side) K8s user-defined resources (CustomResourceDefinition, CRD).  The OpenAPI publication for CRD allows clients (for example, <code>kubectl</code> ) to perform validation on their side (within the framework of <code>kubectl create</code> and <code>kubectl apply</code> ) and to issue documentation according to the scheme ( <code>kubectl explain</code> ).  Details - in <a href="">KEP</a> . <br><br>  Previously existing logs are <a href="https://github.com/kubernetes/kubernetes/pull/74837">now opened</a> with the <code>O_APPEND</code> flag (and not <code>O_TRUNC</code> ) in order to avoid losing the logs in some situations and for the convenience of truncate logs with external utilities for rotation. <br><br>  Also in the context of the Kubernetes API, it can be noted that the <code>PodSandbox</code> field has been <a href="https://github.com/kubernetes/kubernetes/pull/73833">added</a> to the <code>PodSandbox</code> and <code>PodSandboxStatus</code> to take into account information about the <code>RuntimeClass</code> in the pod Admission Webhooks <a href="https://github.com/kubernetes/kubernetes/pull/74998">implemented the</a> ability to determine which versions of <code>AdmissionReview</code> they support.  Finally, in the Admission Webhooks rules, <a href="https://github.com/kubernetes/kubernetes/pull/74477">you can</a> now <a href="https://github.com/kubernetes/kubernetes/pull/74477">limit the</a> scope of their use by namespaces and cluster boundaries. <br><br><h2>  Storage </h2><br>  <a href="https://kubernetes.io/docs/concepts/storage/volumes/"><code><b>PersistentLocalVolumes</b></code></a> , which had beta status since <a href="https://habr.com/ru/company/flant/blog/353114/">K8s 1.10</a> , have been <a href="https://github.com/kubernetes/kubernetes/pull/74769">declared</a> stable (GA): this feature gate will no longer be disabled and will be removed in Kubernetes 1.17. <br><br>  <a href="https://github.com/kubernetes/enhancements/issues/559">The ability to</a> use environment variables of the so-called <a href="https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/">Downward API</a> (for example, the name of the pod) for directory names that are mounted as <a href="https://kubernetes.io/docs/concepts/storage/volumes/"><code>subPath</code></a> has evolved - in the form of a new field <code>subPathExpr</code> , which now determines the desired directory name.  Initially, the feature appeared in Kubernetes 1.11, but for 1.14 it remained in the status of the alpha version. <br><br>  As in the previous release of Kubernetes, many significant changes are presented for the actively developing CSI (Container Storage Interface): <br><br><h3>  CSI </h3><br>  <a href="https://github.com/kubernetes/enhancements/issues/556">Support</a> <b>for resizing for CSI volumes has</b> become available (in the alpha version).  To use it, you will need to enable a feature gate called <code>ExpandCSIVolumes</code> , as well as the presence of support for this operation in a specific CSI driver. <br><br>  Another feature for CSI in the alpha version is the <a href="https://github.com/kubernetes/enhancements/issues/596">ability</a> to refer directly (that is, without using PV / PVC) to CSI volumes within the scope of the pod specification.  This <b>removes the restriction on using CSI as an exclusively remote data repository</b> , opening the door to the world of <a href="https://kubernetes-csi.github.io/docs/ephemeral-local-volumes.html">local ephemeral volumes</a> .  To use ( <a href="">example from the documentation</a> ) you need to enable the <code>CSIInlineVolume</code> feature gate. <br><br>  Progress has also been made in Kubernetes-related CSI internals, which are not so noticeable to end users (system administrators) ... At the moment, developers are forced to maintain two versions of each storage plugin: one - in the old way, inside the K8s codebase (in -tree), and the second - in the framework of the new CSI <i>(read more about it, for example, in <a href="https://habr.com/ru/company/flant/blog/424211/">here</a> )</i> .  This causes understandable inconveniences that need to be addressed as CSI stabilizes as such.  Simply taking and declaring the deprecated API of internal (in-tree) plug-ins is not possible due to the <a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/">corresponding policy of Kubernetes</a> . <br><br>  All this has led to the fact that alpha versions have reached the <b><a href="https://github.com/kubernetes/enhancements/issues/625">process of migration of the</a> internal code of plug-ins</b> implemented as in-tree in the CSI plugins, thanks to which the concerns of developers will be reduced to supporting one version of their plug-ins, and compatibility with the old APIs will be preserved and they will be declare obsolete in the usual way.  It is expected that by the next release of Kubernetes (1.15) all plug-ins of cloud providers will be migrated, the implementation will receive beta status and will be activated in K8s installations by default.  See the <a href="">design proposal for</a> details.  The consequence of this migration was also the <a href="https://github.com/kubernetes/kubernetes/pull/74544">waiver</a> of restrictions for volumes defined by specific cloud providers (AWS, Azure, GCE, Cinder). <br><br>  In addition, support for block devices with CSI ( <code>CSIBlockVolume</code> ) is <a href="https://github.com/kubernetes/kubernetes/pull/74909">translated</a> into beta. <br><br><h2>  Nodes / Kubelet </h2><br>  Introduced alpha version of the <a href="https://github.com/kubernetes/enhancements/issues/727">new endpoint</a> in Kubelet, designed to <b>return metrics on the main resources</b> .  Generally speaking, if earlier Kubelet received statistics on the use of containers from cAdvisor, now this data comes from the container's executable environment via the CRI (Container Runtime Interface), however, compatibility for working with old Docker versions is also preserved.  Previously, statistics collected in Kubelet were given through the REST API, and now the endpoint located at <code>/metrics/resource/v1alpha1</code> used for this.  The long-term strategy of developers <a href="https://github.com/kubernetes/kubernetes/issues/68522">is</a> to minimize the set of metrics provided by Kubelet.  <i>By the way, these metrics themselves are <a href="https://github.com/kubernetes/enhancements/pull/726">now called</a> not ‚Äúcore metrics‚Äù, but ‚Äúresource metrics‚Äù, and are described as ‚Äúfirst-class resources, such as cpu, and memory‚Äù.</i> <br><br>  A very interesting point: despite the clear advantage in gRPC endpoint performance compared to different uses of the Prometheus format <i>(the result of one of the benchmarks see below)</i> , the authors preferred the Prometheus text format because of the clear leadership of this monitoring system in the community. <br><br><blockquote>  <i>‚ÄúGRPC is not compatible with major monitoring pipelines.</i>  <i>Endpoint will only be useful for delivering metrics to Metrics Server or monitoring components that integrate directly with it.</i>  <i>When using caching in Metrics Server, the Prometheus text format performance <b>is good enough</b> for us to prefer Prometheus over gRPC, given the widespread prevalence of Prometheus in the community.</i>  <i>When the OpenMetrics format becomes more stable, we can get closer to the performance of gRPC using a proto-based format. ‚Äù</i> </blockquote><br><img src="https://habrastorage.org/webt/v5/st/uo/v5stuoyssgedyqibabti_oz6bbi.png"><br>  <i>One of the benchmarks for using gRPC and Prometheus in the new Kubelet endpoint for metrics.</i>  <i>More charts and other details can be found in <a href="">KEP</a> .</i> <br><br>  Among other changes: <br><br><ul><li>  Kubelet now <a href="https://github.com/kubernetes/kubernetes/pull/73651">accepts</a> the <code>pid=&lt;number&gt;</code> parameter in the <code>--system-reserved</code> and <code>--kube-reserved</code> options, ensuring that the specified PID is reserved for the system as a whole or the system Kubernetes daemons, respectively.  The feature is activated when the feature gate called <code>SupportNodePidsLimit</code> . </li><li>  Kubelet is now (once) <a href="https://github.com/kubernetes/kubernetes/pull/73802">trying to stop</a> containers in an unknown state before restarting and deleting operations. </li><li>  When using <a href="https://kubernetes.io/docs/concepts/workloads/pods/podpreset/"><code>PodPresets</code></a> now the same information as the regular container is <a href="https://github.com/kubernetes/kubernetes/pull/71479">added to</a> the init-container. </li><li>  Kubelet <a href="https://github.com/kubernetes/kubernetes/pull/73659">began using</a> <code>usageNanoCores</code> from a provider of CRI statistics, and network statistics were <a href="https://github.com/kubernetes/kubernetes/pull/74788">added</a> to nodes and containers in Windows. </li><li>  Information about the operating system and architecture is now recorded in the labels <code>kubernetes.io/os</code> and <code>kubernetes.io/arch</code> of Node objects (translated from beta to GA). </li><li>  The ability to specify a specific system user group for containers in the pod ( <code>RunAsGroup</code> , appeared in <a href="https://habr.com/ru/company/flant/blog/415349/">K8s 1.11</a> ) <a href="https://github.com/kubernetes/kubernetes/pull/73007">advanced</a> to the beta version (enabled by default). </li><li>  du and find, used in cAdvisor, are <a href="https://github.com/kubernetes/kubernetes/pull/74675">replaced</a> with Go-implementations. </li></ul><br><h2>  CLI </h2><br>  In cli-runtime and kubectl the -k flag has been <a href="https://github.com/kubernetes/kubernetes/pull/74140">added</a> for integration with <a href="https://github.com/kubernetes-sigs/kustomize"><b>kustomize</b></a> (by the way, its development is now carried out in a separate repository), i.e.  to process additional YAML files from the kustomization special directories (see <a href="">KEP for</a> details on their use): <br><br><img src="https://habrastorage.org/webt/nv/sf/uy/nvsfuyar7x570ia_zrcp_v4lohi.jpeg"><br>  <i>An example of a simple use of the <a href="">kustomization</a> file (perhaps a more complex use of kustomize in <a href="">overlays</a> )</i> <br><br>  Besides: <br><br><ul><li>  The kubectl logo and its documentation has been <a href="https://kubectl.docs.kubernetes.io/">updated</a> - see <a href="https://kubectl.docs.kubernetes.io/">kubectl.docs.kubernetes.io</a> . <br><br><img src="https://habrastorage.org/webt/n4/-1/kw/n4-1kwnebvlrzwahpkhdpjhlbsi.png"></li><li>  <a href="https://github.com/kubernetes/kubernetes/pull/71651">Added</a> new command <code>kubectl create cronjob</code> , whose name speaks for itself. </li><li>  In <code>kubectl logs</code> you can now <a href="https://github.com/kubernetes/kubernetes/pull/67573">combine the</a> flags <code>-f</code> ( <code>--follow</code> for streaming logs) and <code>-l</code> ( <code>--selector</code> for label query). </li><li>  kubectl <a href="https://github.com/kubernetes/kubernetes/pull/72641">taught to</a> copy files selected using wild card. </li><li>  The <code>kubectl wait</code> command <a href="https://github.com/kubernetes/kubernetes/pull/70599">added</a> the <code>--all</code> flag to the <code>kubectl wait</code> command to select all resources in the namespace of the specified resource type. </li><li>  Announced stable <a href="https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/">plugin</a> mechanism <a href="https://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/">for kubectl</a> . </li></ul><br><h2>  Other </h2><br>  Stable (GA) status received the following features: <br><br><ul><li>  Support for Windows sites (including Windows Server 2019), which implies the ability to schedule Windows Server containers in Kubernetes (see also <a href="">KEP</a> ); </li><li>  <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/"><code>ReadinessGate</code></a> used in the pod's specification to determine additional conditions that are taken into account in the pod's readiness; </li><li>  Support for large pages (feature gate called <a href="https://kubernetes.io/docs/tasks/manage-hugepages/scheduling-hugepages/"><code>HugePages</code></a> ); </li><li>  <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">CustomPodDNS</a> ; </li><li>  PriorityClass API, <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/">Pod Priority &amp; Preemption</a> . </li></ul><br>  Other changes introduced in Kubernetes 1.14: <br><br><ul><li>  The default RBAC policy no longer allows unauthenticated <i>(unauthenticated)</i> users access to the API <code>discovery</code> and <code>access-review</code> . </li><li>  Official CoreDNS support is <a href="https://github.com/kubernetes/kubernetes/pull/69940">provided</a> only for Linux, so when using kubeadm for its (CoreDNS) deployment in a cluster, the nodes should work only in Linux (for this limitation nodeSelectors are used). </li><li>  The default CoreDNS configuration now <a href="https://github.com/kubernetes/kubernetes/pull/73267">uses the</a> <a href="https://coredns.io/plugins/forward/">forward plugin</a> instead of the proxy.  In addition, a readinessProbe has been <a href="https://github.com/kubernetes/kubernetes/pull/74137">added to</a> CoreDNS, preventing load balancing on the appropriate (not ready for service) pods. </li><li>  In kubeadm, on the <code>init</code> or <code>upload-certs</code> , <a href="https://github.com/kubernetes/kubernetes/pull/73907">it became possible</a> to upload the certificates required to connect the new control-plane to the kubeadm-certs secret (the <code>--experimental-upload-certs</code> flag is used). </li><li>  For Windows installations, an alpha version of gMSA (Group Managed Service Account) <a href="https://github.com/kubernetes/enhancements/issues/689">support</a> appeared - special accounts in Active Directory that can also be used by containers. </li><li>  For GCE <a href="https://github.com/kubernetes/kubernetes/pull/70144">,</a> mTLS encryption between etcd and kube-apiserver was activated. </li><li>  Updates in the used / dependent software: Go 1.12.1, CSI 1.1, CoreDNS 1.3.1, support for Docker 18.09 in kubeadm, and the minimum supported version of the Docker API is 1.26. </li></ul><br><h2>  PS </h2><br>  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habr.com/company/flant/blog/432208/">Kubernetes 1.13: review of major innovations</a> ‚Äù; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/424331/">Kubernetes 1.12: a review of major innovations</a> ‚Äù; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/415349/">Kubernetes 1.11: an overview of major innovations</a> ‚Äù; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/353114/">Kubernetes 1.10: an overview of major innovations</a> .‚Äù </li></ul></div><p>Source: <a href="https://habr.com/ru/post/445196/">https://habr.com/ru/post/445196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445186/index.html">Creating a RPG fighting system</a></li>
<li><a href="../445188/index.html">What will be the gaming neural interfaces?</a></li>
<li><a href="../445190/index.html">Buy back / not buy back: our ML-pilot in the "Platypus"</a></li>
<li><a href="../445192/index.html">4K: evolution or marketing?</a></li>
<li><a href="../445194/index.html">10 concepts for the designer in 2019</a></li>
<li><a href="../445198/index.html">Console Player cmus for Linux</a></li>
<li><a href="../445200/index.html">Internet providers ask the Ministry of Communications and Mass Media to let them into homes without an agreement</a></li>
<li><a href="../445204/index.html">Stream Firebird 2.5 bases conversion to ODS12 format (Firebird 3.0)</a></li>
<li><a href="../445206/index.html">Reduce downtime when updating Zimbra</a></li>
<li><a href="../445208/index.html">Maturity Levels of Enterprise IT Infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>