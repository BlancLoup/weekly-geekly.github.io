<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>External dependencies in the gita: submodule or subtree?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Long ago, I learned that dependencies should be stored with the project code. Then, when you return to the old version of the code, it is much easier ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>External dependencies in the gita: submodule or subtree?</h1><div class="post__text post__text-html js-mediator-article">  Long ago, I learned that dependencies should be stored with the project code.  Then, when you return to the old version of the code, it is much easier to restore the environment. <br><br>  My project has several dependencies.  Most of the dependencies live in the git repositories.  The project itself also lives in the gita. <br><br>  One of the libraries we use is frequently updated.  We are sitting on the developer version, and often we ourselves commit to it the code that is required by our project.  That is, it is required to promptly skip our edits through the main repository of this library ‚Äî you don‚Äôt want to create and maintain your fork for a number of reasons. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Previously, I simply copied the dependencies to the project folder, and added to each file a VERSION.TXT with its version.  But, if you need to work with the current version of third-party code, it is inconvenient.  Yes, and copy files by hand when there is a git is somehow stupid.  I want to find a more modern solution. <br><a name="habracut"></a><br>  The most widely advertised and fashionable feature for working with third-party repositories is <a href="http://www.kernel.org/pub/software/scm/git/docs/git-submodule.html">git submodules</a> (‚Äúsubmodules‚Äù).  Naturally, first of all I began to look at her. <br><br>  Before that, I had already tried working with sub-modules in home projects.  While one person uses the repository carefully, there are no special problems.  In any case, it is much more convenient than copying the code by hand. <br><br>  However, as soon as I tried to transfer my experience to a more serious workflow, it turned out that not everything is so simple. <br><br>  This is what we encountered: <br><ul><li>  Each person working with the main repository must have access to the repository from which the submodule is taken. <br></li><li>  In general, it is not possible to get a complete working copy with a single command.  Now after git checkout you need to do git submodule update --init. <br></li><li>  The same applies to some other teams of the gita.  For example, git archive ignores submodules - it is no longer possible to pack an entire project into an archive with a single command. <br></li><li>  From the top-level project, no changes are seen within the submodules and vice versa.  To find out the full status of a working copy of a project, it is necessary to request it for each sub-module and for the parent project separately.  Without submodules, it suffices to say git status anywhere within the working copy. <br></li><li>  After replacing the subdirectory root directory with something else (for example, another submodule), you need to manually delete the old version in all working copies. <br></li><li>  The git submodule command does not understand the standard options --git-dir and --work-tree.  It can only be run from the root of a working copy.  This makes automation difficult. <br></li></ul>  In general, quite unpleasant.  Each of the problems can somehow be circumvented, but there are too many problems and new ones constantly appear. <br><br>  From submodules had to be abandoned. <br><br>  But every cloud has a silver lining.  Knowledgeable people <a href="http://stackoverflow.com/questions/1596822/git-submodules-workflow">suggested</a> that in gita for a long time (even before 1.5.2) there exists an alternative solution - <a href="http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html">subtree merge strategy</a> (‚Äúsubtrees‚Äù). <br><br>  The idea is to take the commit history from the external project and redirect it to the internal subdirectory.  It uses the standard guitar mechanism for working with external branches. <br><br>  Example from the documentation: add the code from the master repository branch Bproject (lies in / path / to / B) to our project in the dir-B / subdirectory. <br><br><blockquote><code>$ git remote add -f Bproject /path/to/B <br> $ git merge -s ours --no-commit Bproject/master <br> $ git read-tree --prefix=dir-B/ -u Bproject/master <br> $ git commit -m "Merge B project as our subdirectory" <br></code> </blockquote><br>  You need to pay attention to the -f switch of git remote add.  He tells the gita to immediately fetch this remote. <br><br>  Further, the changes in Bproject are tightened with the git pull command with explicit indication of the desired branch and merge strategy: <br><br><blockquote> <code>$ git pull -s subtree Bproject master <br></code> </blockquote><br>  If the corresponding remote-in subtree is not added to the working copy, the history of the main repository does not show the name of the branch from which the changes are pulled. <br><br>  The problem is purely cosmetic, and does not affect the work.  It is treated by adding this remote to the working copy: <br><br><blockquote> <code>$ git remote add -f Bproject /path/to/B <br></code> </blockquote><br>  In the future, if new branches appear, you can pull up the changes in the remote: <br><br><blockquote> <code>$ git fetch Bproject <br></code> </blockquote><br>  There are a couple of drawbacks: <br><ol><li>  As in the case of the usual merging of branches, in the commit logs, the history of the subtree is mixed with the history of the main project. <br></li><li>  Submitting changes to a subtree design is much more complicated than with submodules.  But it's easy to get around by making changes to a separate clone of this project. <br></li></ol>  None of these shortcomings is critical to our workflow. <br><br>  Working with subtrees is much more convenient than with submodules.  It does not need to re-educate users, it is easier to automate.  Subtrees easier to maintain.  Recommend. <br><br>  By the way, on Gitkhab there is a project aimed at developing work with subtrees: <a href="http://github.com/apenwarr/git-subtree">git-subtree</a> . <br><br>  Additional reading: <br><ol><li>  <a href="http://progit.org/book/ch6-6.html">Pro Git: Submodules</a> <br></li><li>  <a href="http://progit.org/book/ch6-7.html">Pro Git: Subtree Merging</a> <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/75964/">https://habr.com/ru/post/75964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../75953/index.html">Hacking the Climatic Research Unit server led to a big scandal around global warming</a></li>
<li><a href="../75956/index.html">About a wise investor and startups</a></li>
<li><a href="../75958/index.html">Packard Bell: Windows 7 upgrade</a></li>
<li><a href="../75959/index.html">Ivy Prize: extended acceptance of applications</a></li>
<li><a href="../75961/index.html">The life cycle of one HYIP. It was all over as usual ...</a></li>
<li><a href="../75966/index.html">Exporting birthdays from vk.com to Google Calendar</a></li>
<li><a href="../75967/index.html">Paranormal contraction of urls: ‚ÄúTO.‚Äù</a></li>
<li><a href="../75969/index.html">What office package do you use?</a></li>
<li><a href="../75971/index.html">Hello World! how should he be on C in Linux</a></li>
<li><a href="../75972/index.html">IP address habrahabr.ru in SORBS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>