<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to port libcURL to Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is intended for developers under the Android NDK, who are going to work with the wonderful libcURL library and have at its disposal its so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to port libcURL to Android</h1><div class="post__text post__text-html js-mediator-article">  The article is intended for developers under the Android NDK, who are going to work with the wonderful libcURL library and have at its disposal its source code for rebuilding into a static library.  The author does not claim to be an absolutely correct solution to the problem of porting this library, but only shares his experience. <br><br>  All interested in asking under the cat. <br><a name="habracut"></a><br><h5>  Preamble </h5><br>  I am developing my own Android application on Windows 7, using Eclipse Indigo for a Java wrapper for a native application compiled by Cygwin.  The Native part is written in C ++ with the inclusion of cross-platform C libraries and with the ability to debug in Visual Studio 2010 Express. <br><br>  Recently, during development, it became necessary to download images from the Internet.  According to previous experience of developing for Windows, nothing better than libcURL I did not see, that's why I decided to stop there. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Plot </h5><br>  The first surprise came to light when I started downloading the source from the developer‚Äôs website: <a href="http://curl.haxx.se/download.htm">curl.haxx.se/download.htm</a> .  Under Android, only the assembled version is posted there.  It does not matter, I thought - "Somehow I will build the assembly myself", I downloaded the raw materials (curl-7.27.0). <br><br>  It was not late in the evening and in an hour I planned to finish this task and move on to more interesting activities.  I looked through the Android.mk file fluently and put everything into my own Android.mk to build this miracle.  Very unpleasant errors began to come out in cygwin - ‚ÄúCURL_SIZEOF_LONG definition is missing!‚Äù, And others like them.  It is useful to look for a solution to the problem: <a href="http://stackoverflow.com/questions/4952169/using-curl-in-android">stackoverflow.com/questions/4952169/using-curl-in-android</a> .  I did everything as advised, but errors with missing macros remained.  As a result, I realized that it was stupid to experiment further on myself, I went to read articles of the type: <a href="http://thesoftwarerogue.blogspot.ru/2010/05/porting-of-libcurl-to-android-os-using.html">thesoftwarerogue.blogspot.ru/2010/05/porting-of-libcurl-to-android-os-using.html</a> .  It was already well past midnight, I had to wrap up on such a non-positive note. <br><br>  In the morning, I started to read the above article on a fresh mind and realized that the very concept of assembly is contrary to common sense.  To build, you need to create curl_config.h under the full source code of Android!  It was simply pointless to read further, especially since the found variants of this magic header did not allow to avoid the above errors in cygwin.  Having firmly decided for myself that this path is flawed, I began to develop an abandoned idea about building just from the sources, abandoned the day before.  I found an article where a friend very kindly said that you could do this and put it out ... a compiled version of <a href="http://blog.glowinteractive.com/2011/11/porting-curl-to-android-as-static-library/">blog.glowinteractive.com/2011/11/porting-curl-to-android-as-static-library</a> .  Thanks at least for the fact that at least I would suggest that you need to manually make the configuration header, which I did.  I took config-mac.h, made config-android.h out of it and included it in setup.h.  And about a miracle - bypassing the errors by refining config-android.h, it turned out to build a library from source and test the functionality I need (downloading images from the Internet). <br><br><h5>  Refinement Instructions: </h5><br><h6>  in include / curl / curlbuild.h </h6><br>  we find <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> defined(__GNUC__)</span></span></code> </pre>  add section <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta"># </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_SIZEOF_LONG 4 # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_TYPEOF_CURL_OFF_T long long # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_FORMAT_CURL_OFF_T </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lld"</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_FORMAT_CURL_OFF_TU </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"llu"</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_FORMAT_OFF_T </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%lld"</span></span></span><span class="hljs-meta"> # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_SIZEOF_CURL_OFF_T 8 # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_SUFFIX_CURL_OFF_T LL # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CURL_SUFFIX_CURL_OFF_TU ULL</span></span></code> </pre>  you can call her <pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> defined(ANDROID)</span></span></code> </pre>  following after <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">elif </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defined</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(__x86_64__)</span></span></span><span class="hljs-function"> || </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defined</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(__ppc64__)</span></span></span><span class="hljs-function">...</span></span></code> </pre><br><h6>  in lib / setup.h </h6><br>  we find <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __VXWORKS__ # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"config-vxworks.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre>  and add after it <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> __GNUC__ # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"config-android.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  Create lib / config-android.h from lib / config-mac.h <br><br><h6>  in lib / config-android.h </h6><br>  we change <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> OS </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mac"</span></span></span></span></code> </pre>  on <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> OS </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"android"</span></span></span></span></code> </pre><br>  we change <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HAVE_IOCTL_FIONBIO 1</span></span></code> </pre>  on <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HAVE_FCNTL_O_NONBLOCK 1</span></span></code> </pre><br>  we change <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SEND_TYPE_ARG3 size_T</span></span></code> </pre>  on <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SEND_TYPE_ARG3 size_t</span></span></code> </pre><br>  delete rows <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HAVE_EXTRA_STRICMP_H 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HAVE_EXTRA_STRDUP_H 1</span></span></code> </pre><br><br>  After writing the article, I stumbled upon <a href="https://groups.google.com/forum/%3Ffromgroups%3D">groups.google.com/forum/?fromgroups=#</a> ! Topic / android-ndk / JmJYxZ7s8G8.  There is the same thing as here, but again, too much needs to be thought out. <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/158743/">https://habr.com/ru/post/158743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158729/index.html">Building neural networks in php using FANN, an example implementation</a></li>
<li><a href="../158731/index.html">PostgreSQL - Asynchronous Replication + Pooling + Failover</a></li>
<li><a href="../158733/index.html">Q & A with Alexander Guest</a></li>
<li><a href="../158737/index.html">Last Ya.Subbotnik Year: St. Petersburg</a></li>
<li><a href="../158741/index.html">Found the remains of a pigeon with a cryptogram of World War II</a></li>
<li><a href="../158745/index.html">10 years of Xbox Live</a></li>
<li><a href="../158747/index.html">New promotion from Blackberry</a></li>
<li><a href="../158749/index.html">Tank maneuvers on the Russian AI Cup</a></li>
<li><a href="../158755/index.html">Edgar Frank Codd - IBM's Legend</a></li>
<li><a href="../158757/index.html">For the domain CyanogenMod.com demanded redemption</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>