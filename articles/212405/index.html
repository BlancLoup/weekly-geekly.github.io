<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We find common friends of people using VK API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Prehistory 
 Hi, Habrayuzer. 
 Once I had a need to find a person, knowing his appearance and knowing about his membership in a certain club. I als...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We find common friends of people using VK API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ed5/cd0/569/ed5cd05699dfb78e8a57af77ae166f54.png" alt="image"><br><h5>  0. Prehistory </h5><br>  Hi, Habrayuzer. <br>  Once I had a need to find a person, knowing his appearance and knowing about his membership in a certain club.  I also owned the addresses (VKontakte) of the pages of two other members of the club.  Almost certainly the desired person was each of them as friends.  This problem could be solved in different ways.  In the article I will write about how I implemented the solution using the vk.com API. <br><br><h5>  1.Task </h5><br>  Make a service that will find all the common friends of two separate users, without requiring verification and an account on the social network for users of the service.  Get data about mutual friends: <br><ul><li>  name </li><li>  the photo </li><li>  ID </li></ul><br>  Implement the task on the basis of API vkontakte.  Write a hotel class for this. <br><br><a name="habracut"></a><br><h5>  2. Decision </h5><br><h6>  2.1. Determine the required API methods </h6><br>  Go to the <a href="http://vk.com/dev/methods">list of</a> API <a href="http://vk.com/dev/methods">methods</a> .  And searching, we find what we need. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For receiving friends of the user there is a <a href="">friends.get</a> method. <br>  <b>friends.get</b> - <i>returns a list of identifiers of friends of the user or extended information about the friends of the user (using the fields parameter).</i> <br><br>  And, importantly, as part of the solution of the task, this is an open method that does not require an access_token. <br><br>  Only one required parameter: <br><img src="https://habrastorage.org/getpro/habr/post_images/50f/811/491/50f8114911385b1f9a165be62a0bd61c.png" alt="image"><br><br>  Using this method, you can get information about all the friends of each of our two sets, but this approach will not be optimal.  User A may have 2000 people as friends; only 3 people will intersect with friends.  In this case, the information about 1997 users will be unnecessary to us, and the resources spent on getting it will be wasted. <br>  We will only request user IDs, and having received the numbers we need (which belong to the set A and B), we will select information by them. <br><br>  For information about the user there is a <a href="">users.get</a> method. <br>  <b>users.get</b> - <i>Returns extended information about users.</i> <br><br>  This method also does not need access_token, that is, it is perfect for our task. <br><img src="https://habrastorage.org/getpro/habr/post_images/a2d/6c4/365/a2d6c4365541c11a547d2816d8349180.png" alt="image"><br>  In user_ids, we pass an array of user IDs that are found in both sets. <br>  We want to get only an avatar size of 100 * 100, for this, we give the value photo_100 in the fields parameter. <br><br><h6>  2.2. Moving to the practical side </h6><br>  I wrote a simple php class: <br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VkFriends</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_var</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($var)</span></span></span><span class="hljs-function"> </span></span>{ $var = strip_tags($var); $var = preg_replace(<span class="hljs-string"><span class="hljs-string">'~\D+~'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $var); $var = trim($var); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $var; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_friends</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u_id)</span></span></span><span class="hljs-function"> </span></span>{ $friends = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://api.vk.com/method/friends.get?user_id='</span></span>.$u_id); $friends = json_decode($friends); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($friends-&gt;error)){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $friends; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutual_friends</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($friends)</span></span></span><span class="hljs-function"> </span></span>{ $mutual = array_intersect($friends[<span class="hljs-number"><span class="hljs-number">0</span></span>]-&gt;response, $friends[<span class="hljs-number"><span class="hljs-number">1</span></span>]-&gt;response); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($mutual)){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $mutual; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_users_info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($users)</span></span></span><span class="hljs-function"> </span></span>{ $u_ids = implode(<span class="hljs-string"><span class="hljs-string">","</span></span>,$users); $u_info = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://api.vk.com/method/users.get?user_ids='</span></span>.$u_ids.<span class="hljs-string"><span class="hljs-string">'&amp;fields=photo_100'</span></span>); $u_info = json_decode($u_info); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u_info; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view_user_info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u_info)</span></span></span><span class="hljs-function"> </span></span>{ $uid = $u_info-&gt;uid; $first_name = $u_info-&gt;first_name; $last_name = $u_info-&gt;last_name; = $u_info-&gt;photo_100; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">" &lt;a href='http://vk.com/id$uid' target='_blank'&gt; &lt;div id='info'&gt; &lt;div id='ava'&gt; &lt;img src=''&gt; &lt;/div&gt; &lt;div id='name'&gt; $first_name &lt;br/&gt; $last_name &lt;/div&gt; &lt;/div&gt; &lt;/a&gt; "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view_users_info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($users_info)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i=<span class="hljs-number"><span class="hljs-number">0</span></span>;$i&lt;sizeof($users_info-&gt;response);$i++){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view_user_info($users_info-&gt;response[$i]); } } }</code> </pre> <br><br>  Now we look at our class in action: <br><br><pre> <code class="php hljs">$vkf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VkFriends; $u_id[<span class="hljs-number"><span class="hljs-number">0</span></span>] = $vkf-&gt;clean_var($_POST[<span class="hljs-string"><span class="hljs-string">"u1"</span></span>]);<span class="hljs-comment"><span class="hljs-comment">//clean variables from POST $u_id[1] = $vkf-&gt;clean_var($_POST["u2"]); if(($u_id[0]!='')&amp;&amp;($u_id[1]!='')){ echo '&lt;div id="block"&gt;'; $friends[0] = $vkf-&gt;get_friends($u_id[0]);//getting friends list from user with u_id $friends[1] = $vkf-&gt;get_friends($u_id[1]); if(($friends[0]!='')&amp;&amp;($friends[1]!='')){ $mutual = $vkf-&gt;mutual_friends($friends);//create new array from intersect arrays if($mutual!=''){ $users_info = $vkf-&gt;get_users_info($mutual);//getting info about users that are mutual $vkf-&gt;view_users_info($users_info);//view information about selected users }else{ print("&lt;center&gt;&lt;h2 class='error'&gt;  &lt;/h2&gt;&lt;/center&gt;"); } }else{ print("&lt;center&gt;&lt;h2 class='error'&gt;    &lt;/h2&gt;&lt;/center&gt;"); } echo '&lt;/div&gt;'; }</span></span></code> </pre><br><br><h5>  3. Summary </h5><br>  Link to the GitHub repository - <a href="https://github.com/SanGreel/vkfriends">vkfriends</a> . <br><br>  Thanks for reading, <br>  I sincerely hope that you were interested. </div><p>Source: <a href="https://habr.com/ru/post/212405/">https://habr.com/ru/post/212405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212391/index.html">Email protection in organizations using mobile devices</a></li>
<li><a href="../212393/index.html">Data Mining Camp: how we were inspired for the year ahead</a></li>
<li><a href="../212397/index.html">Strikethrough and underscore with symbolic means (Ã∂tÃ∂aÃ∂kÃ∂ Ã∂, ·πØaÃ±·∏µ or tÃ≤aÃ≤kÃ≤)</a></li>
<li><a href="../212401/index.html">Check the availability of the SIP provider</a></li>
<li><a href="../212403/index.html">‚ÄúYandex‚Äù has learned to look for music on the basis of the ‚Äúpu-pidu‚Äù type</a></li>
<li><a href="../212407/index.html">Yacy - Distributed Uncensored Search Engine: Three Years Later</a></li>
<li><a href="../212409/index.html">A world without accidents</a></li>
<li><a href="../212411/index.html">China announced the loss of the moonwalker "Yuytu", and he suddenly woke up</a></li>
<li><a href="../212413/index.html">Prevent the launch of a copy of a third-party application</a></li>
<li><a href="../212423/index.html">UAE launched a project to use unmanned vehicles for the delivery of important goods</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>