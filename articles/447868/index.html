<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Module underwater ultrasonic rangefinder. Part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, we described the process of developing a test version of the module of the underwater rangefinder. The time has come to share infor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Module underwater ultrasonic rangefinder. Part two</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/d9/7b/4h/d97b4htc0q8si0hr27zn2vrppre.jpeg" alt="image"><br><br>  In the <a href="https://habr.com/ru/post/440222/">first part,</a> we described the process of developing a test version of the module of the underwater rangefinder.  The time has come to share information about the second version of the module, since we have implemented the proposed changes stated in the first article. <br><a name="habracut"></a><br>  <b>Change # 1: Temporary automatic gain control (TAD).</b> <br>  In the process of testing the first version of the module, the problem of zaskalivanie reflected signal from obstacles that are close to the radiator clearly loomed.  Some commentators to the previous article recommended the SAIL.  Yes, the use of VARU was very appropriate.  Now, in the first moments after the sending of a probe pulse, it is possible to make the gain minimal and increase it over time. <br><br>  The implementation of the control is shown in diagram number 1. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The microcontroller DAC generates a voltage applied to the gate of the Q4 transistor. <br>  For the applied transistor, the characteristic of the introduced attenuation was experimentally obtained, depending on the voltage on the gate.  Based on this characteristic, and the environment parameters specified by the user, a table of values ‚Äã‚Äãis calculated, which is sent to the microcontroller's DAC via DMA. <br><br>  Actually, the transistor, operating in linear mode, partially closes the useful signal from the output of the first amplifier stage to ground, thereby adjusting the amplitude of the signal that goes to the next stages of the amplifier. <br><br><img src="https://habrastorage.org/webt/yx/vz/zp/yxvzzpgvi9eywsnkb-geehi9oi8.jpeg" alt="image"><br><br>  <b>Change # 2: Boost converter to power the output stage.</b> <br>  Scheme ‚Ññ2.  Everything is simple.  A booster transducer allows you to make our emitter a little louder.  You can adjust the output stage voltage from 5 to 16 volts.  Useful thing for long-range measurements. <br><br>  <b>Change # 3: MEMS gyro / accelerometer.</b> <br>  Scheme number 3.  Built ICM20602 chip.  This will allow you to receive not only information about the levels of reflection from objects in the beam path, but also the direction (angle) where the module is looking at at that moment.  Having made the simplest development of a module (even if you twist the module with your hand) you can get a realistic image of the scanned object using the principle of imaging with a lidar. <br><br>  The changes should also include the use of a cheaper, but not the worst amplifier MCP669-E / ML.  The gate drivers also selected the cheapest available TPS51604DSGR. <br>  The shape of the printed circuit boards is made round for more rational placement inside the metal case. <br><br>  For compactness and consistency of characteristics from instance to instance, the transformer is manufactured according to planar technology. <br><br>  Iron is ready.  What's next?  Starts programmers coming! <br><br>  Although the basic low-level functionality has already been tested in operation (driver control, working with ADCs, DACs, etc.), it is also necessary to implement convenient interaction with the host, create and describe in detail the API that gives access to all the capabilities of the module.  Let me remind you that we have chosen the UART as the physical interface for this purpose.  And here it is worth mentioning that a disagreement appeared in the team as to what kind of protocol it is worth while to stop: on text or binary.  On the one hand, the binary protocol is a speed, ease of processing on the host side.  On the other hand, the text protocol makes it easier to analyze the data exchange (even in the ‚ÄúHyperterminal‚Äù), and use meaningful commands / responses from the module.  Here is a small example of interaction with the module using text commands in the Putty terminal: <br><br><img src="https://habrastorage.org/webt/n8/r7/w0/n8r7w0oeu7ktm9fsixenvxnehh4.png" alt="image"><br><br>  Pressing the TAB key displays a list of all commands. <br><br>  An example is given of using the YPR command, which returns the current value of the direction of the module in three axes (Euler angles). <br><br>  The CHART command returns the value of the reflected signal from objects in the path of the probe pulse.  You can set the measurement resolution (while in centimeters) and the number of measurements. <br><br>  Of course, the ideal case is the support of both protocol and binary options.  But we, unfortunately, are limited in time, and I would like to immediately direct efforts to a more acceptable option for users.  From here a modest request: check off the option that would be more convenient for you. <br><br>  For the next article we will try to use all the functionality of the module in order to be able to scan underwater objects and get a picture with the outlines of these objects. <br><br><div class="spoiler">  <b class="spoiler_title">PS</b> <div class="spoiler_text">  Opinions about the content for the second article within the team were divided: dry, a little, but now, or capaciously, beautifully, but then ... "Now" won. <br><br>  Dry text diluted slightly with pictures that were made in the process of making the second version of the module. <br><br>  Build emitters <br><br><img src="https://habrastorage.org/webt/bq/ys/_w/bqys_wbo6llkxofuhazh9p5e_fk.jpeg" alt="image"><br><br>  Treated metal cases <br><br><img src="https://habrastorage.org/webt/cf/fu/rg/cffurgdkwliqlkkpt1uzjrqmbxg.jpeg" alt="image"><br><br>  Laser-coated enclosures <br><br><img src="https://habrastorage.org/webt/4h/ad/wh/4hadwhlgc_fzieveuqwdcjwpvru.jpeg" alt="image"><br><br>  Assembly of module boards <br><br><img src="https://habrastorage.org/webt/we/5n/ac/we5nacjpf_orb_ibfjlxft4ez6m.jpeg" alt="image"><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/447868/">https://habr.com/ru/post/447868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447854/index.html">Eight mistakes I made when I was a junior</a></li>
<li><a href="../447856/index.html">How to sell a window without parsing or about the importance of positioning before developing the site</a></li>
<li><a href="../447860/index.html">Thermodynamics of black holes</a></li>
<li><a href="../447862/index.html">Cisco Live EMEA 2019. Technical Sessions: External Simplification with Internal Complications</a></li>
<li><a href="../447864/index.html">News of the week: major events in IT and science</a></li>
<li><a href="../447870/index.html">JavaScript engine basics: prototype optimization. Part 1</a></li>
<li><a href="../447872/index.html">Alienware M15: compact gaming laptop with ample opportunities for upgrade</a></li>
<li><a href="../447874/index.html">Chaos Information Entropy</a></li>
<li><a href="../447876/index.html">Everything is very bad or a new type of traffic interception</a></li>
<li><a href="../447880/index.html">Checking rdesktop and xrdp using PVS-Studio analyzer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>