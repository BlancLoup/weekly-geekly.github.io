<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cloud management on open-source software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, solutions for building cloud systems have become very fashionable; clouds are built by all and sundry. For the end user, everything is trans...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cloud management on open-source software</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5ef/af4/6a5/5efaf46a59902f958cc5f6aabdb629a8.jpg" align="left">  Recently, solutions for building cloud systems have become very fashionable; clouds are built by all and sundry.  For the end user, everything is transparent: ‚ÄúHere's your entry point, that's where your resources are - use it!‚Äù And few of them think about how everything is arranged inside.  Yes, and they do not need to know, in essence.  However, people who are busy just configuring such systems is very interesting, but how does it work for others?  And most importantly - on what? <br><a name="habracut"></a><br><br>  At the moment, there is enough software to create and manage cloud infrastructure.  These are products from VMware, Citrix, Red Hat, etc. In the same row is a very interesting software called <a href="http://www.opennebula.org/">OpenNebula</a> .  It contains system administration tools with a console and graphical interface, as well as end-user tools that allow you to manage resources.  You can see an example of the work on the <a href="http://www.youtube.com/opennebula">video</a> . <br><br>  Well, let's try deploying our own cloud management system.  It should be said that this material will not address the issues of connecting to virtualization hosts - only installation and review capabilities. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Preconfig </h4><br>  So, for the beginning we install Ubuntu 11.10 64 bit Server (you can install both on bare hardware and as a virtual machine).  We do not consider the installation of Ubuntu, since it is simple and described wherever possible.  Next, start the server preconfiguration. <br><br>  Create oneadmin user and cloud group: <br><br> <code>mkdir -p /srv/cloud/ <br> groupadd -g 10000 cloud <br> /srv/cloud/one as home folder. <br> useradd -u 10000 -m oneadmin -d /srv/cloud/one -s /bin/bash -g cloud <br> passwd oneadmin <br> chown -R oneadmin:cloud /srv/cloud/</code> <br> <br>  Check if you can login under oneadmin: <br><br> <code>su -l oneadmin <br> exit</code> <br> <br>  We put mysql and create a database: <br><br> <code>apt-get install mysql-server mysql-admin <br> <br> # mysql -u root -p <br> mysql&gt; CREATE USER 'oneadmin'@'localhost' IDENTIFIED BY 'oneadmin'; <br> mysql&gt; CREATE DATABASE opennebula; <br> mysql&gt; GRANT ALL PRIVILEGES ON opennebula.* TO 'oneadmin' IDENTIFIED BY 'oneadmin'; <br> mysql&gt; quit;</code> <br> <br><img src="https://habrastorage.org/storage2/a2f/3c0/c02/a2f3c0c02d3c08c6d4f55ebb8479ec04.png"><br><br><h4>  Install &amp; Configure </h4><br>  Put the necessary packages: <br><br> <code>apt-get install g++ libxmlrpc-c3-dev scons libsqlite3-dev libmysqlclient-dev libxml2-dev libssl-dev ruby libxmlrpc-c3-0 libxmlrpc-core-c3-dev gems</code> <br> <br>  Go under oneadmin.  Download the OpenNebula 3.4.0 distribution, unpack and go to the directory: <br><br> <code><a href=""></a> su -l oneadmin <br> wget dev.opennebula.org/packages/opennebula-3.4.0/opennebula-3.4.0.tar.gz <br> tar xzf opennebula-3.4.0.tar.gz <br> cd opennebula-3.4.0/</code> <br> <br>  Set the package build parameters: <br><br> <code>scons sqlite=no mysql=yes <br> exit</code> <br> <br>  Install OpenNebula as root: <br><br> <code>./install.sh -u oneadmin -g cloud -d /srv/cloud/one</code> <br> <br>  Again, go under oneadmin: <br><br> <code>su -l oneadmin</code> <br> <br>  And create variable environments: <br><br> <code>nano ~/.bash_profile <br> export ONE_LOCATION=/srv/cloud/one <br> export ONE_AUTH=$ONE_LOCATION/.one/one_auth <br> export ONE_XMLRPC=http://localhost:2633/RPC2 <br> export PATH=$ONE_LOCATION/bin:/usr/local/bin:/var/lib/gems/1.8/bin/:/var/lib/gems/1.8/:$PATH</code> <br> <br>  Apply: <br><br> <code>source ~/.bash_profile</code> <br> <br>  Create an authentication file, the password is specified in the explicit form: <br><br> <code>mkdir ~/.one <br> echo "oneadmin:&lt;THE_PASSWORD&gt;" &gt; ~/.one/one_auth</code> <br> <br>  Next, we make the necessary changes to the oned.conf configuration file: <br><br> <code>nano ~/etc/oned.conf</code> <br> <br>  Need to comment out the line: <br><br> <code>#DB = [ backend = "sqlite" ]</code> <br> <br>  And specify mysql as a backend: <br><br> <code>DB = [ backend = "mysql", <br> server = "localhost", <br> port =3306, <br> user = "oneadmin", <br> # passwd = "password", <br> db_name = "opennebula" ]</code> <br> <br>  The passwd value was commented out because the password for the oneadmin user in mysql was not set. <br><br>  We start the oned service: <br><br> <code>one start</code> <br> <br>  And we give the command ‚Äúonevm list‚Äù, just to see if the service will start: <br><br><img src="https://habrastorage.org/storage2/0f5/31e/f0b/0f531ef0b9b45f91cf2856a70778168b.png"><br><br>  The conclusion, of course, will be empty. <br><br><h4>  Sunstone Install </h4><br>  So, the service has started, we put the necessary packages and GUI: <br><br> <code>apt-get install rubygems <br> gem install json sinatra thin install rack rails rake sequel sqlite3</code> <br> <br>  Next, you need to correct the Sunstone server configuration file: <br><br> <code>nano /srv/cloud/one/etc/sunstone-server.conf</code> <br> <br>  Find: <br><br> <code># Server Configuration <br> :host: 127.0.0.1 <br> :port: 9869</code> <br> <br>  And change to: <br><br> <code># Server Configuration <br> :host: 0.0.0.0 <br> :port: 8888</code> <br> <br>  Run the Sunstone server under oneadmin and get an error, look at the logs: <br><br> <code>sunstone-server start <br></code> <br><br><img src="https://habrastorage.org/storage2/136/6e6/6a0/1366e66a0d68d8430f06bc87416a6bac.png"><br><br>  Correcting errors: <br><br> <code>gem install rubygems-update <br> update_rubygems <br> gem update --system</code> <br> <br>  Starting sunstone: <br><br> <code>sunstone-server start</code> <br> <br><h4>  GUI </h4><br>  Go to the address http: // ip_address_or_hostname: 8888.  Fill in the name and password fields previously registered in one_auth: <br><br><img src="https://habrastorage.org/storage2/d5c/69d/759/d5c69d75947fe7522ee323849ca32e6f.png"><br><br>  Rather ascetic dashboard.  On the left side there is a tool tree, on the right - information about services and resources: <br><br><img src="https://habrastorage.org/storage2/9b8/c77/5da/9b8c775da11779cc339d87059aa70e88.png"><br><br>  You can switch to Russian: <br><br><img src="https://habrastorage.org/storage2/a91/b93/815/a91b9381573d7920024f7427e9e253e9.png"><br><br>  Who is more accustomed to: <br><br><img src="https://habrastorage.org/storage2/e6b/3d6/749/e6b3d674990ca55b374856c1735bd1f2.png"><br><br>  So what do we have? <br><br>  Tools for creating users, groups and access lists: <br><br><img src="https://habrastorage.org/storage2/560/536/6bb/5605366bbc9fafa39ccf86ece986a242.png"><br><br><img src="https://habrastorage.org/storage2/b35/7ec/279/b357ec2792cf21fdb72500bcde287e25.png"><br><br><img src="https://habrastorage.org/storage2/829/3c1/213/8293c121323ff65ea626c68b2bad3344.png"><br><br><img src="https://habrastorage.org/storage2/fe4/16f/64c/fe416f64c68ec23bf83eba542762815b.png"><br><br>  Panel for creating images of virtual machines, virtualoks and templates themselves: <br><br><img src="https://habrastorage.org/storage2/6c8/b3b/cd8/6c8b3bcd81d7e001dfa89bcb7ba41212.png"><br><br><img src="https://habrastorage.org/storage2/4e7/baf/e14/4e7bafe144f9cc9a6630722b332c24eb.png"><br><br>  And at the very bottom - managing hosts, creating clusters, adding storage and creating virtual networks: <br><br><img src="https://habrastorage.org/storage2/686/2e8/4b7/6862e84b7636052fa30c5672fad438bf.png"><br><br>  For example, a pop-up window: <br><br><img src="https://habrastorage.org/storage2/4fa/044/7e2/4fa0447e2966c92c4f96662041826c28.png"><br><br>  It is possible to connect various hypervisors: <br><br><img src="https://habrastorage.org/storage2/cee/e2e/114/ceee2e11445447ed1e210ff1e8e40465.png"><br><br><h4>  Enduser interface </h4><br>  This was the installation of administration tools.  And what should the end user do?  Do not give him access to the admin console ... For ordinary users, there is another toolkit. <br><br><h4>  Occi install </h4><br>  Find and edit the service occi configuration file: <br><br> <code>nano /srv/cloud/one/etc/occi-server.conf</code> <br> <br>  In this file, you need to fix one line: <br><br> <code># Host and port where OCCI server will run <br> :server: localhost <br> :port: 4567</code> <br> <br>  per line: <br><br> <code>:server: 0.0.0.0</code> <br> <br>  We also changed the port - we installed 8889, because the installation is performed on the same host.  Next, we deliver the necessary packages: <br><br> <code>apt-get install libxml2 libxslt expat</code> <br> <br>  And we start the occi service: <br><br> <code>occi-server start</code> <br> <br>  We go to our IP-address or domain name (by the way, the documentation says that it is necessary to specify the FQDN in the config) and see what happened: <br><br> <code>http:// ip-address_or_fqdn:8889/ui</code> <br> <br><img src="https://habrastorage.org/storage2/30b/58b/105/30b58b105cb6c2e4d68a11e7526344a8.png"><br><br>  Login to the self-service portal with the login oneadmin and the password that was specified earlier. <br>  Further we will see only that configured for this user.  If earlier we had created another user, configured a subnet, VM templates, etc. for him, we would see the corresponding image.  And so we see pristine clean dashboards: <br><br><img src="https://habrastorage.org/storage2/c4f/12f/b35/c4f12fb35bf304ebf1659eec37024dc1.png"><br><br>  Well, then the points: <br><br><img src="https://habrastorage.org/storage2/4c2/38b/296/4c238b296afba7f8b4b21558b90e2179.png"><br><br><img src="https://habrastorage.org/storage2/297/e01/2bb/297e012bb0240cbaa518952c73a4bd41.png"><br><br>  If you have the necessary rights, you can try to add something here, but it will not work, because hypervisors are not added. <br><br><img src="https://habrastorage.org/storage2/a17/e53/489/a17e534899c4989b504b3d4315c790eb.png"><br><br>  Unfortunately, there is no Russian language here, although it would be the way in the client part, and not in the admin panel. <br><br><img src="https://habrastorage.org/storage2/9b8/bb2/936/9b8bb2936d494b29f7994b88da06946c.png"><br><br><h4>  Conclusion </h4><br>  That's all.  The management server has been installed, the self-service portal is there - forward to the clouds!  All tools are quite simple and functional.  On our test bench, everything works without problems.  You can steer everything without a GUI, right from the console.  The documentation is quite detailed. <br><br>  By the way, there is another installation method: whoever is too lazy to go through the steps described above, you can put everything in one command: <br><br> <code>apt-get install opennebula</code> <br> <br>  and then mess with configuring configs. <br><br>  As already mentioned, the topic is devoted to the description of the installation of tools, so there are no examples of connecting hypervisors, creating networks, storages, and everything else.  If it is interesting, we will tell about the product in more detail in the next article. <br><br>  Good luck everyone! <br><br>  <a href="https://habrahabr.ru/users/madbug/" class="user_link">madbug</a> <br>  <a href="http://www.depo.ru/%3Futm_source%3Dtopic_150612%26utm_medium%3Dsign%26utm_campaign%3Dhabrahabr">DEPO Computers</a> </div><p>Source: <a href="https://habr.com/ru/post/145826/">https://habr.com/ru/post/145826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145817/index.html">Folding for JavaScript objects in TextMate</a></li>
<li><a href="../145818/index.html">How to enable new YouTube design</a></li>
<li><a href="../145820/index.html">Rainbow tables at home</a></li>
<li><a href="../145823/index.html">For IE7 users, the online store has introduced a special commission.</a></li>
<li><a href="../145825/index.html">Protect user passwords on your site with Yandex</a></li>
<li><a href="../145827/index.html">How we helped rewrite the population of Kuwait</a></li>
<li><a href="../145828/index.html">Media player in the home network</a></li>
<li><a href="../145829/index.html">Skype 4.0 for Linux</a></li>
<li><a href="../145830/index.html">Overview of WEB programmers salaries</a></li>
<li><a href="../145832/index.html">Clustering on the client or how to show 10,000 points on the map</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>