<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Social graph</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, I would like to tell a story about my small experiment with an audience of Habr. The subject of the experiment was to build a social graph of h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Social graph</h1><div class="post__text post__text-html js-mediator-article">  Today, I would like to tell a story about my small experiment with an audience of Habr.  The subject of the experiment was to build a social graph of habrasoobschestva. <br><br><img src="https://habrastorage.org/storage1/360b04a6/2572330f/32c23904/dbbf36d6.png"><br><a name="habracut"></a><br><h5>  Description </h5><br>  The objectives pursued in the experiment: <br><ul><li>  Perform parsing habcenter users </li><li>  Create a user graph based on the "Friends" field </li><li>  Visualize the constructed graph </li></ul><br><br><h5>  Parsing and filling the graph </h5><br>  To obtain information about users and their friends, I wrote the parser.py script: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding:utf-8 -*- # parser.py from BeautifulSoup import BeautifulSoup from urllib2 import urlopen, URLError from draw import Drawer class Parser(object): def __init__(self, address='http://habrahabr.ru/people/page', begin = 1, end = 3098): self.drawer = Drawer() self.queue_user = [] self.__begin = begin self.__end = end self.__address = address def parse(self): for i in xrange(self.__begin, self.__end): try: doc = BeautifulSoup(urlopen(self.__address + str(i))) #     . page = doc.findAll('td', attrs = {'class':'user'}) for user in page: #       print 'Parsing for user: %s' %user.dl.dt.a.string doc = BeautifulSoup(urlopen(user.dl.dt.a['href'])) page = doc.findAll('a', attrs = {'rel' : 'friend'}) #          if page: for friend in page: self.drawer.graph.add_nodes_from((user.dl.dt.a.string, friend.string)) self.drawer.graph.add_edge(user.dl.dt.a.string, friend.string) print "Add edge (%s, %s)"%(user.dl.dt.a.string, friend.string) else: self.drawer.graph.add_node(user.dl.dt.a.string) except URLError: #      -  i -= 1 print 'Nodes: %s' %self.drawer.graph.size() self.drawer.draw() if __name__ == '__main__': parse = Parser(end=8) parse.parse()</span></span></code> </pre> <br><br>  I used BeautifulSoup to parse the pages.  The Drawer class is responsible for storing and drawing the graph. <br><br><h5>  Graph drawing and image saving </h5><br>  As mentioned above, the Drawer class from the draw.py module is responsible for storing and drawing the graph: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding:utf-8 -*- # draw.py import networkx as nx import matplotlib.pyplot as plt class Drawer(object): def __init__(self, file_name = 'graph.png'): self.graph = nx.Graph() self.file_name = file_name def draw(self): '''      ''' nx.draw(self.graph,pos=nx.spring_layout(self.graph), node_size=3500, nodecolor='r',edge_color='b', node_shape='o') #      plt.gcf().set_size_inches(100,100) plt.savefig(self.file_name)</span></span></code> </pre><br><br>  In this class, we store in the internal field an instance of the Graph class from the NetworkX module, which will contain our social graph.  It should be noted that the Graph class provides a large number of methods for working with a graph.  Details on working with the module can be found in the <a href="http://networkx.lanl.gov/">documentation</a> .  Attention should be paid to the method that sets the size of the resulting figure / graph.  The parameter can be changed, depending on the number of vertices in the graph. <br><br><h5>  results </h5><br>  The result of the work done is somewhat different from the planned one.  During the script, I found a very significant resource consumption.  As is known, the approximate number of Habr's users is 60,000 people.  Even if we discard (as I actually did) users who have no friends, the number is still significant.  Checking the program was carried out on a machine with 3 GB of RAM.  As soon as the graph starts to draw, the system began to swap out godlessly, so the number of users in the graph had to be reduced.  As a result, I received several versions of a rendered graph with a different number of users. <br>  The figure shows a graph containing 852 users: <br><img src="https://habrastorage.org/storage1/f64c9ca5/64f45a30/91769a34/bf231d78.jpg"><br><br>  As you can see, the images have to be strongly compressed for the article, so the rest will be cited, due to the large size of the images (7-14Mb): <br><ul><li>  <a href="">852 users</a> </li><li>  <a href="">1745 users</a> </li><li>  <a href="">2439 users</a> </li><li>  <a href="">4045 users</a> </li><li>  <a href="">7071 users</a> </li></ul><br><br><h5>  Perspectives </h5><br><ul><li>  Perform optimization, and try to get a graph covering all users. </li><li>  Based on the graph obtained, verify the theory of <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D1%2588%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8_%25D1%2580%25D1%2583%25D0%25BA%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25B6%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B9">6 handshakes</a> . </li></ul><br><br><h5>  UPD: archive with images </h5><br>  I apologize for the problems with downloading images, flooded the <a href="http://narod.ru/disk/21947921001/pic.zip.html">people</a> . <br><br><h5>  UPD2: images on zoom.it </h5><br>  Thanks to <a href="http://habrahabr.ru/users/mstyura/" class="user_link">mstyura</a> for advice and assistance. <br>  <a href="http://zoom.it/K13x">4095 users</a> <br>  <a href="http://zoom.it/78SD">7071 users</a> </div><p>Source: <a href="https://habr.com/ru/post/126417/">https://habr.com/ru/post/126417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126410/index.html">Building positioning systems for mobile services</a></li>
<li><a href="../126411/index.html">Virus analysis by example - investigating Trojan-Downloader.Win32.Zanoza.ab</a></li>
<li><a href="../126412/index.html">Synchronization of LanBilling and RTU class 4 & 5 account status</a></li>
<li><a href="../126415/index.html">Cluster systems</a></li>
<li><a href="../126416/index.html">Results of the competition Part 3. Quiz</a></li>
<li><a href="../126418/index.html">How to avoid collisions when writing to Memcache from PHP</a></li>
<li><a href="../126419/index.html">PS3 steering wheel overview</a></li>
<li><a href="../126421/index.html">Amazing near or how to make fun of stock analysts (using Excel)</a></li>
<li><a href="../126422/index.html">Creating an application on the Cocos2d framework for iOS</a></li>
<li><a href="../126423/index.html">Mouse over translation in Lingvo x5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>