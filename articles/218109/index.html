<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tame ZoG (Part 5: Mana Collection)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, I am completing a series of articles telling about the capabilities of the ZRF language used to develop games at Zillions of Games . Since I in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tame ZoG (Part 5: Mana Collection)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/d10/e3a/469/d10e3a46907ba64c8ab326cec83c733e.gif">  Today, I am completing a series of <a href="http://habrahabr.ru/post/213391/">articles</a> telling about the capabilities of the ZRF language used to develop games at <a href="http://www.zillions-of-games.com/">Zillions of Games</a> .  Since I intentionally moved from simple to complex, it is logical to assume that today's game (in terms of implementation) will be more difficult than all previous ones.  It really is.  The fact is that ZRF in no case can not be attributed to the universal programming languages.  It is intended to describe games similar to Chess.  The more ‚Äúchess-like‚Äù the game is, the more obvious is its description (unless, of course, paying attention to the description of the rules of such tricky moves as <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25BE%25D0%25BA%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0">castling</a> or <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B7%25D1%258F%25D1%2582%25D0%25B8%25D0%25B5_%25D0%25BD%25D0%25B0_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2585%25D0%25BE%25D0%25B4%25D0%25B5">taking on the aisle</a> ).  The description of such a game can be quite large in scope (in this case, <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1663">PreZRF</a> , which I wrote <a href="http://habrahabr.ru/post/214713/">earlier</a> ) can help, but rather trivial in content. <br><br>  Everything changes when you have to do something for Chess is not at all (or not at all) similar.  Creating applications such as <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D5">Game of Life</a> or <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1543">Mine Finder</a> is a serious challenge when using pure ZRF, without any <a href="http://www.zillions-of-games.com/progsample.html">extensions</a> .  Today I will try to show with what difficulties this development can be connected. <br><a name="habracut"></a><br>  The source of inspiration, this time, was the collection of mana from the <a href="http://www.battlevschess.com/en/">Battle vs Chess</a> I mentioned earlier.  A player is given one or several chess pieces with which he must put <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B8%25D0%25BB%25D0%25BA%25D0%25B0_%2528%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B%2529">forks</a> , removing randomly placed ‚Äúcrystals‚Äù from the field: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/tJQGtj_Ltxc%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhiArR3y0QcqFsU_dP5DyA76sukKNQ" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's try to figure out what difficulties we will encounter when trying to implement a similar mini-game using ZRF.  The first difficulty is to count the number of pieces under combat, which is necessary to determine the presence of a "fork".  As I said, with all sorts of calculations in the ZRF tight, but, in particular cases, the problem is completely solvable: <br><br><div class="spoiler">  <b class="spoiler_title">Definition of forks</b> <div class="spoiler_text"><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> common-check mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> empty? (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> enemy? (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-first) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second true) else (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first true) ) ) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> common-capture mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> empty? (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> enemy? capture) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> queen-slide ($<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> empty? (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first false) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second false) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> n) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> s) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> w) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> e) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> se) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-second) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> n) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> s) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> w) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> e) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> se) ) add $<span class="hljs-number"><span class="hljs-number">1</span></span> ) ) )</code> </pre> <br></div></div><br>  Since we don‚Äôt have to know the exact number of pieces ‚Äúunder attack‚Äù to ‚Äúcount‚Äù, two boolean flags are enough.  If, after a series of <b>common-check</b> checks in various directions, the <b>is-second</b> flag <b>is set</b> , it is necessary to remove all the figures that are ‚Äúunder attack‚Äù. <br><br>  An important (and not obvious for understanding) point is that all these checks and captures must be performed before the formation of the <b>add</b> command, which completes a <b>possible</b> move (since they are part of this move).  In addition, unlike conventional chess, we cannot go to a busy field (enemy figure). <br><br>  Already in this place, the "cunning" of ZRF is fully manifested.  After playing a bit, you can notice the following bug: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Ckmg6saMJAs%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhiBnfQ7RAhg4lirvo0teFi5bhBlQg" frameborder="0" allowfullscreen=""></iframe><br><br>  It can be noted that the figure located behind the starting position, in the direction opposite to the course, is not considered to be ‚Äúunder attack‚Äù.  This is due to the fact that, at the time of calculating the course, the initial field is not considered empty.  Having understood the cause of the error, it is easy to fix it: <br><br><div class="spoiler">  <b class="spoiler_title">Corrected definition of forks</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> common-check mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-start) empty?) (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> enemy? (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-first) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second true) else (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first true) ) ) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> common-capture mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-start) empty?) (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> enemy? capture) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> queen-slide ( (<span class="hljs-name"><span class="hljs-name">set-position-flag</span></span> is-start true) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> empty? (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first false) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second false) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> n) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> s) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> w) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> e) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> se) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-second) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> n) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> s) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> w) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> e) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> se) ) add $<span class="hljs-number"><span class="hljs-number">1</span></span> ) ) )</code> </pre><br></div></div><br>  We simply mark the initial field with the position flag and treat it further as empty. <br><br>  The generalization of the rules formulated on the moves of the other figures is a matter of technique.  <a href="">This</a> solution works perfectly, in the case of playing with one queen, but when playing, for example, with two rooks, it is not complete. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/MWxXIljOGcg%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhi0nS3v-sh_E6g97F0Xl_EOBdpSEQ" frameborder="0" allowfullscreen=""></iframe><br><br>  The program does not take into account that one shape, moving, can "open" the plug with another shape.  This is exactly the case when it is quite clear what to do to correct the error, but (for now) it is not quite clear how.  Obviously, you need to go through all your pieces and check forks from each of them.  To automate the search for all the pieces on the board, it is useful to create a ‚Äúdirection‚Äù connecting all the fields in the chain: <br><br><div class="spoiler">  <b class="spoiler_title">Link all fields</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> Next-Definitions (<span class="hljs-name"><span class="hljs-name">dummy</span></span> offboard) (<span class="hljs-name"><span class="hljs-name">links</span></span> next (<span class="hljs-name"><span class="hljs-name">a1</span></span> b1) (<span class="hljs-name"><span class="hljs-name">b1</span></span> c1) (<span class="hljs-name"><span class="hljs-name">c1</span></span> d1) (<span class="hljs-name"><span class="hljs-name">d1</span></span> e1) (<span class="hljs-name"><span class="hljs-name">e1</span></span> f1) (<span class="hljs-name"><span class="hljs-name">f1</span></span> g1) (<span class="hljs-name"><span class="hljs-name">g1</span></span> h1) (<span class="hljs-name"><span class="hljs-name">h1</span></span> a2) (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2) (<span class="hljs-name"><span class="hljs-name">b2</span></span> c2) (<span class="hljs-name"><span class="hljs-name">c2</span></span> d2) (<span class="hljs-name"><span class="hljs-name">d2</span></span> e2) (<span class="hljs-name"><span class="hljs-name">e2</span></span> f2) (<span class="hljs-name"><span class="hljs-name">f2</span></span> g2) (<span class="hljs-name"><span class="hljs-name">g2</span></span> h2) (<span class="hljs-name"><span class="hljs-name">h2</span></span> a3) (<span class="hljs-name"><span class="hljs-name">a3</span></span> b3) (<span class="hljs-name"><span class="hljs-name">b3</span></span> c3) (<span class="hljs-name"><span class="hljs-name">c3</span></span> d3) (<span class="hljs-name"><span class="hljs-name">d3</span></span> e3) (<span class="hljs-name"><span class="hljs-name">e3</span></span> f3) (<span class="hljs-name"><span class="hljs-name">f3</span></span> g3) (<span class="hljs-name"><span class="hljs-name">g3</span></span> h3) (<span class="hljs-name"><span class="hljs-name">h3</span></span> a4) (<span class="hljs-name"><span class="hljs-name">a4</span></span> b4) (<span class="hljs-name"><span class="hljs-name">b4</span></span> c4) (<span class="hljs-name"><span class="hljs-name">c4</span></span> d4) (<span class="hljs-name"><span class="hljs-name">d4</span></span> e4) (<span class="hljs-name"><span class="hljs-name">e4</span></span> f4) (<span class="hljs-name"><span class="hljs-name">f4</span></span> g4) (<span class="hljs-name"><span class="hljs-name">g4</span></span> h4) (<span class="hljs-name"><span class="hljs-name">h4</span></span> a5) (<span class="hljs-name"><span class="hljs-name">a5</span></span> b5) (<span class="hljs-name"><span class="hljs-name">b5</span></span> c5) (<span class="hljs-name"><span class="hljs-name">c5</span></span> d5) (<span class="hljs-name"><span class="hljs-name">d5</span></span> e5) (<span class="hljs-name"><span class="hljs-name">e5</span></span> f5) (<span class="hljs-name"><span class="hljs-name">f5</span></span> g5) (<span class="hljs-name"><span class="hljs-name">g5</span></span> h5) (<span class="hljs-name"><span class="hljs-name">h5</span></span> a6) (<span class="hljs-name"><span class="hljs-name">a6</span></span> b6) (<span class="hljs-name"><span class="hljs-name">b6</span></span> c6) (<span class="hljs-name"><span class="hljs-name">c6</span></span> d6) (<span class="hljs-name"><span class="hljs-name">d6</span></span> e6) (<span class="hljs-name"><span class="hljs-name">e6</span></span> f6) (<span class="hljs-name"><span class="hljs-name">f6</span></span> g6) (<span class="hljs-name"><span class="hljs-name">g6</span></span> h6) (<span class="hljs-name"><span class="hljs-name">h6</span></span> a7) (<span class="hljs-name"><span class="hljs-name">a7</span></span> b7) (<span class="hljs-name"><span class="hljs-name">b7</span></span> c7) (<span class="hljs-name"><span class="hljs-name">c7</span></span> d7) (<span class="hljs-name"><span class="hljs-name">d7</span></span> e7) (<span class="hljs-name"><span class="hljs-name">e7</span></span> f7) (<span class="hljs-name"><span class="hljs-name">f7</span></span> g7) (<span class="hljs-name"><span class="hljs-name">g7</span></span> h7) (<span class="hljs-name"><span class="hljs-name">h7</span></span> a8) (<span class="hljs-name"><span class="hljs-name">a8</span></span> b8) (<span class="hljs-name"><span class="hljs-name">b8</span></span> c8) (<span class="hljs-name"><span class="hljs-name">c8</span></span> d8) (<span class="hljs-name"><span class="hljs-name">d8</span></span> e8) (<span class="hljs-name"><span class="hljs-name">e8</span></span> f8) (<span class="hljs-name"><span class="hljs-name">f8</span></span> g8) (<span class="hljs-name"><span class="hljs-name">g8</span></span> h8) (<span class="hljs-name"><span class="hljs-name">h8</span></span> offboard) ) ) (<span class="hljs-name"><span class="hljs-name">game</span></span> ... (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">Board-Definitions</span></span>) (<span class="hljs-name"><span class="hljs-name">Next-Definitions</span></span>)) )</code> </pre><br></div></div><br>  In addition to the <b>next</b> direction, we also define a fictitious <b>offboard</b> field used to complete the <b>iteration</b> .  This is a fairly common idiom ZRF.  In addition, in addition to the ability to link all fields, the <b>links</b> command can be used to create a variety of boards with a "modified topology."  With its help, you can, for example, ‚Äúglue‚Äù the edges of the board, turning it into a cylinder, torus or Mobius strip. <br><br>  Now you can use the created direction.  Unfortunately, the attempt to "bust" his pieces directly within the framework of the course of one of them faces technical difficulties.  Before starting the search, you need to remember the current position (in order to subsequently create the final move command <b>add</b> ).  Usually, a couple of <b>mark</b> / <b>back</b> commands are used for this, but we already use them in <b>common-check</b> and <b>common-capture</b> , and the stack of saved positions is not supported by the <b>mark</b> command. <br><br>  In order to solve this problem, create a fictitious player <b>? Clean</b> : <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">game</span></span> ... (<span class="hljs-name"><span class="hljs-name">players</span></span> Black ?White ?Clean) (<span class="hljs-name"><span class="hljs-name">turn-order</span></span> ?White ?White ?White ?White ?White ?White ?White ?White Black ?Clean) )</code> </pre><br>  As I mentioned in the previous <a href="http://habrahabr.ru/post/213391/">article</a> , the question mark at the beginning of the player's name means that he does not directly participate in the game and will execute his moves randomly.  But how exactly will it go <b>? Clean</b> ?  We need the moves of this player solely for the sake of a side effect (during his turn, he will check forks on the board and remove the pieces that fall under them).  Obviously, you should not <b>? Clean-</b> move figures, then have to put ( <b>drop</b> ) them on the board: <br><br><div class="spoiler">  <b class="spoiler_title">Search all forks</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> common-check mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-start) (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Cleaner) empty?)) (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Stone) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-first) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second true) else (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first true) ) ) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> common-capture mark (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-start) (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Cleaner) empty?)) (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>)) $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Stone) capture) ) back ) (<span class="hljs-name"><span class="hljs-name">define</span></span> clean-queen ( (<span class="hljs-name"><span class="hljs-name">verify</span></span> empty?) (<span class="hljs-name"><span class="hljs-name">set-position-flag</span></span> is-cleaner true) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Queen) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first false) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second false) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> n)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> s)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> w)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> e)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> se) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-second) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> n)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> s)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> w)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> e)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> se) ) ) next ) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-cleaner) add ) next ) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> slide ( (<span class="hljs-name"><span class="hljs-name">set-position-flag</span></span> is-start true) $<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-name"><span class="hljs-name">while</span></span> empty? add $<span class="hljs-number"><span class="hljs-number">1</span></span> ) ) ) (<span class="hljs-name"><span class="hljs-name">game</span></span> ... (<span class="hljs-name"><span class="hljs-name">players</span></span> Black ?White ?Clean) (<span class="hljs-name"><span class="hljs-name">turn-order</span></span> ?White ?White ?White ?White ?White ?White ?White ?White Black ?Clean) (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">Board-Definitions</span></span>) (<span class="hljs-name"><span class="hljs-name">Next-Definitions</span></span>)) (<span class="hljs-name"><span class="hljs-name">board-setup</span></span> (?Clean (<span class="hljs-name"><span class="hljs-name">Cleaner</span></span> off <span class="hljs-number"><span class="hljs-number">1</span></span>) ) (?White (<span class="hljs-name"><span class="hljs-name">Stone</span></span> off <span class="hljs-number"><span class="hljs-number">8</span></span>) ) (<span class="hljs-name"><span class="hljs-name">Black</span></span> (<span class="hljs-name"><span class="hljs-name">Queen</span></span> e4) ) ) (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Stone) (<span class="hljs-name"><span class="hljs-name">image</span></span> ?White <span class="hljs-string"><span class="hljs-string">"images\Chess\SHaag\wpawn.bmp"</span></span>) (<span class="hljs-name"><span class="hljs-name">help</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span>) (<span class="hljs-name"><span class="hljs-name">drops</span></span> (<span class="hljs-name"><span class="hljs-name">add-to-empty</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Cleaner) (<span class="hljs-name"><span class="hljs-name">image</span></span> ?Clean <span class="hljs-string"><span class="hljs-string">"images\DarkChess\Invisible.bmp"</span></span>) (<span class="hljs-name"><span class="hljs-name">drops</span></span> (<span class="hljs-name"><span class="hljs-name">clean-queen</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> Queen) (<span class="hljs-name"><span class="hljs-name">image</span></span> Black <span class="hljs-string"><span class="hljs-string">"images\Chess\SHaag\bqueen.bmp"</span></span>) (<span class="hljs-name"><span class="hljs-name">help</span></span> <span class="hljs-string"><span class="hljs-string">"Queen: can slide any number of squares in any direction"</span></span>) (<span class="hljs-name"><span class="hljs-name">moves</span></span> (<span class="hljs-name"><span class="hljs-name">slide</span></span> n)(<span class="hljs-name"><span class="hljs-name">slide</span></span> ne) (<span class="hljs-name"><span class="hljs-name">slide</span></span> e)(<span class="hljs-name"><span class="hljs-name">slide</span></span> nw) (<span class="hljs-name"><span class="hljs-name">slide</span></span> s)(<span class="hljs-name"><span class="hljs-name">slide</span></span> se) (<span class="hljs-name"><span class="hljs-name">slide</span></span> w)(<span class="hljs-name"><span class="hljs-name">slide</span></span> sw) ) ) )</code> </pre><br></div></div><br>  There are quite a few changes here, but the general meaning, I think, is clear.  We allowed the player <b>? Clean</b> to put his figure on the field (immediately after the <b>Black</b> move), checking, during the process, the presence of forks.  Since this figure is not related to the gameplay, it is desirable to make it invisible.  The resource of a completely transparent figure can be taken, for example, from this funny <a href="http://zillionsofgames.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D201">game</a> . <br><br>  <b>? Clean</b> does an excellent job with fork detection, but what about the figure he adds?  If this figure is even three times invisible, so that it does not interfere with the gameplay, it is advisable to remove it from the board.  Do this on the course <b>? White</b> : <br><br><div class="spoiler">  <b class="spoiler_title">Scavenging</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> add-to-empty ( (<span class="hljs-name"><span class="hljs-name">verify</span></span> empty?) (<span class="hljs-name"><span class="hljs-name">set-position-flag</span></span> is-cleaner true) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Cleaner) capture ) next ) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-cleaner) add ) next ) ) )</code> </pre><br></div></div><br>  In order for <b>Clean</b> to use his shape many times, we will enable the corresponding option: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">option</span></span> <span class="hljs-string"><span class="hljs-string">"recycle captures"</span></span> true)</code> </pre><br>  In principle, it all works, but if <b>Black</b> fails to put the plug during the move <b>,? Clean</b> will spend his piece, and <b>? White</b> will not be able to clear it, since he will not be able to make a move (since all his 8 pieces are already on the board).  Obviously, we must give the opportunity to complete the move <b>? Clean</b> only on the condition that he managed to find at least one plug: <br><br><div class="spoiler">  <b class="spoiler_title">Fixed fork search</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> clean-queen ( (<span class="hljs-name"><span class="hljs-name">verify</span></span> empty?) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-succeed false) (<span class="hljs-name"><span class="hljs-name">set-position-flag</span></span> is-cleaner true) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Queen) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-first false) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-second false) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> n)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> s)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> w)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-check</span></span> e)(<span class="hljs-name"><span class="hljs-name">common-check</span></span> se) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-second) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> is-succeed true) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> n)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> nw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> s)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> ne) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> w)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> sw) (<span class="hljs-name"><span class="hljs-name">common-capture</span></span> e)(<span class="hljs-name"><span class="hljs-name">common-capture</span></span> se) ) ) next ) a1 (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not-position</span></span>? offboard) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">flag</span></span>? is-succeed) (<span class="hljs-name"><span class="hljs-name">position-flag</span></span>? is-cleaner)) add ) next ) ) )</code> </pre><br></div></div><br>  In order for the game not to end abruptly, if one of the players cannot move, the following option will help us: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">option</span></span> <span class="hljs-string"><span class="hljs-string">"pass turn"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  Ufff ... Now everything <a href="">works</a> (though not as beautiful as in the original, but then we decide what set of pieces we will play).  Of course, this whole structure strongly resembles the construction of crutches supporting each other, but such is the price for doing something non-trivial in ZRF. <br><br>  As a dessert, I suggest enjoying the following <a href="">version of</a> Chess: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/lOtxkCGTPFc%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhh7Cg8kiEs6aOXi6RlaoVD6RpkQaQ" frameborder="0" allowfullscreen=""></iframe><br><br>  All the pieces go the same way as in ordinary Chess.  I made only one change, but it radically changed the whole course of the game.  Since I am subjective, it is difficult for me to evaluate its merits, but I can say that, for me personally, it is much more difficult to win at the computer than in ordinary Chess.  The game is very dynamic and rarely lasts longer than 10 moves.  Put the plugs to win! <br></div><p>Source: <a href="https://habr.com/ru/post/218109/">https://habr.com/ru/post/218109/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218093/index.html">AudioCodes against Asterisk or who has more buns</a></li>
<li><a href="../218099/index.html">Amazon introduced set-top box Amazon Fire TV</a></li>
<li><a href="../218103/index.html">Hubble eXtreme Deep Field: A small journey of 13 billion light years</a></li>
<li><a href="../218105/index.html">Overview of the Highscreen Zera F smartphone: "skit" from the flagships for 3,990 rubles</a></li>
<li><a href="../218107/index.html">Windows 8 on Intel Galileo now, for free already in the plans of Microsoft!</a></li>
<li><a href="../218113/index.html">A thousand and one gif</a></li>
<li><a href="../218115/index.html">Run Windows Server 2012R2 from a VHDX file from a USB disk through UEFI</a></li>
<li><a href="../218119/index.html">What is a switch and how to deal with it?</a></li>
<li><a href="../218121/index.html">How to write a "skorochitku" for iOS in half an hour</a></li>
<li><a href="../218123/index.html">Unity 3D Web Player on Linux via Pipelight</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>