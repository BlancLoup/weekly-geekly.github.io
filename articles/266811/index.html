<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How a relational database works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Relational databases (DDB) are used everywhere. They come in all sorts of ways, from small and useful SQLite to powerful Teradata. But at the same tim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How a relational database works</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1e7/e05/af0/1e7e05af0dc24cf2977fdd6e2bd69e9a.jpg" align="left">  Relational databases (DDB) are used everywhere.  They come in all sorts of ways, from small and useful SQLite to powerful Teradata.  But at the same time there are very few articles explaining the principle of operation and the device of relational databases.  Yes, and those that are - quite superficial, without much detail.  But in more ‚Äúfashionable‚Äù areas (big data, NoSQL or JS) many more articles are written, and much more profound.  Probably, this situation is due to the fact that relational databases are ‚Äúold‚Äù and too boring to be disassembled outside university programs, research papers and books. <br><br>  In fact, few people really understand how relational databases work.  And many developers do not like it when they do not understand something.  If relational databases use about 40 years, then there is a reason.  RBD is a very interesting thing, because it is based on useful and widely used concepts.  If you would like to understand how RBDs work, then this article is for you. <br><a name="habracut"></a><br>  Immediately you need to emphasize: from this material you will not learn how to use the database.  However, to assimilate the material, you should be able to write at least a simple connection request and a CRUD request.  This is quite enough for understanding the article, the rest will be explained. <br><br>  The article consists of three parts: <br><ol><li>  Overview of low-level and high-level database components. </li><li>  Overview of query optimization. </li><li>  Overview of transaction and buffer pool management. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  1. Basics </h1><br>  Once upon a time (in a far-away galaxy), developers had to keep in mind the exact number of operations they code.  They felt the algorithms and data structures with all their hearts, because they could not afford to waste processor and memory resources on their slow computers of the past.  In this chapter, we will recall some concepts that are necessary for understanding database operation. <br><br><h3>  1.1.  O (1) vs O (n <sup>2</sup> ) </h3><br>  Today, many developers do not really think about the <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC%25D0%25B0">time complexity of</a> algorithms ... and they are right!  But when you have to work with a large amount of data, or if you need to save milliseconds, the time complexity becomes extremely important. <br><br>  <b>1.1.1.</b>  <b>Concept</b> <br><br>  The time complexity is used to evaluate the performance of the algorithm, how long the algorithm will be executed for the input data of a certain size.  The time complexity is denoted as ‚ÄúO‚Äù (read as ‚ÄúO big‚Äù).  This designation is used in conjunction with a function that describes the number of operations performed by the algorithm for processing input data. <br><br>  For example, if you say ‚Äúthis algorithm is O large from a certain function‚Äù, then this means that for a certain amount of input data, the algorithm needs to perform a number of operations proportional to the value of the function from this certain amount of data. <br><br>  Here it is not the volume of data that is important, but the dynamics of the increase in the number of operations with increasing volume.  The time complexity does not allow to calculate the exact amount, but it is a good way to estimate. <br><br><img src="https://habrastorage.org/files/142/e4d/fbf/142e4dfbf9734a45ac8468bc425c2d45.jpg"><br><br>  In this graph, you can see how different classes of complexity change.  For clarity, a logarithmic scale is used.  In other words, the amount of data is rapidly increasing from 1 to 1,000,000. We see that: <br><ul><li>  O (1) is ‚Äúconstant time‚Äù, that is, its value is constant. </li><li>  O (log (n)) - logarithmic time, increases very slowly. </li><li>  The worst situation is with the complexity of O (n <sup>2</sup> ) - quadratic time. </li><li>  The other two classes of difficulty are rapidly increasing. </li></ul><br><br>  <b>1.1.2.</b>  <b>Examples</b> <br><br>  With a small amount of input data, the difference between O (1) and O (n <sup>2</sup> ) is negligible.  Suppose we have an algorithm that needs to process 2000 elements. <br><ul><li>  The algorithm with O (1) will require 1 operation. </li><li>  O (log (n)) - 7 operations. </li><li>  O (n) - 2000 operations. </li><li>  O (n * log (n)) - 14,000 operations. </li><li>  O (n <sup>2</sup> ) - 4,000,000 operations. </li></ul><br>  It seems that the difference between O (1) and O (n <sup>2</sup> ) is huge, but in fact you will lose no more than 2 ms.  Eye blink do not have time, literally.  Modern processors perform <a href="https://ru.wikipedia.org/wiki/MIPS_%2528%25D0%25B1%25D1%258B%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25B9%25D1%2581%25D1%2582%25D0%25B2%25D0%25B8%25D0%25B5%2529">hundreds of millions of operations per second</a> , and that is why in many projects, developers neglect performance optimization. <br><br>  But now we take 1 000 000 elements, which is not too much by the standards of the database: <br><ul><li>  The algorithm with O (1) for processing will require 1 operation. </li><li>  O (log (n)) - 14 operations. </li><li>  O (n) - 1,000,000 operations. </li><li>  O (n * log (n)) - 14,000,000 operations. </li><li>  O (n <sup>2</sup> ) - 1,000,000,000,000 transactions. </li></ul><br>  In the case of the last two algorithms, you can have time to drink coffee.  And if you add another 0 to the number of elements, then during the processing you can take a nap. <br><br>  <b>1.1.3.</b>  <b>Some more details</b> <br><br>  So that you can navigate: <br><ul><li>  Finding an item in a good hash table is O (1). </li><li>  In a well-balanced tree - O (log (n)). </li><li>  In the array - O (n). </li><li>  The best sorting algorithms have O (n * log (n)) complexity. </li><li>  Bad sorting algorithms - O (n <sup>2</sup> ). </li></ul><br>  Below we look at these algorithms and data structures. <br><br>  There are several time complexity classes: <br><ul><li>  Average complexity </li><li>  Difficulty at best </li><li>  Worst case difficulty </li></ul><br>  The most common third grade.  By the way, the concept of "complexity" is also applicable to the consumption by the algorithm of memory and I / O operations of the disk system. <br><br>  There are difficulties far worse than n <sup>2</sup> : <br><ul><li>  n <sup>4</sup> : characteristic of some bad algorithms. </li><li>  3 <sup>n</sup> : even worse!  Below will be considered one algorithm with a similar time complexity. </li><li>  n !: generally hellish trash.  You try to wait for the result even on small amounts of data. </li><li>  n <sup>n</sup> : if you have waited for the result of the implementation of this algorithm, then it is time to ask yourself: is it really worth it to you? </li></ul><br><br><h3>  1.2.  Merge sort </h3><br>  What do you do when you need to sort a collection?  Call the sort () function, right?  But do you understand how it works? <br><br>  There are a few good sorting algorithms, but here we look at only one of them: merge sort.  Perhaps now this knowledge does not seem useful to you, but you will change your opinion after the chapters on query optimization.  Moreover, an understanding of the operation of this algorithm will help to understand the principle of an important operation - merge merging. <br><br>  <b>1.2.1.</b>  <b>Merger</b> <br><br>  The merge sorting algorithm is based on one trick: to merge two sorted arrays of size N / 2, each requires only N operations, called merge. <br><br>  Consider an example of a merge operation: <br><br><img src="https://habrastorage.org/files/937/b9d/0b9/937b9d0b9bfa4b10b638c5296d02b1fd.png"><br><br>  As you can see, to create a sorted array of 8 elements, for each of them you need to carry out one iteration in two source arrays.  Since they are already sorted in advance, then: <br><ol><li>  First, they compare the available elements </li><li>  the smallest of them is transferred to the new array, </li><li>  and then returns to the array from which the previous element was taken. </li><li>  Steps 1-3 are repeated until only one element remains in one of the source arrays. </li><li>  After that, all the remaining elements are transferred from the second array. </li></ol><br>  This algorithm works well only because both source arrays were sorted in advance, so it does not need to return to their beginning during the next iteration. <br><br>  An example of merge sort pseudo code: <br><br><pre><code class="html">array mergeSort(array a)
   if(length(a)==1)
      return a[0];
   end if

   //recursive calls
   [left_array right_array] := split_into_2_equally_sized_arrays(a);
   array new_left_array := mergeSort(left_array);
   array new_right_array := mergeSort(right_array);

   //merging the 2 small ordered arrays into a big one
   array result := merge(new_left_array,new_right_array);
   return result;
</code></pre><br>
        ( ¬´  ¬ª).     ,   ,      :<br>
<ul>
<li>  ‚Äî      .</li>
<li>  ‚Äî     ().</li>
</ul><br>
<b>1.2.2.  </b><br>
<br>
<img src="https://habrastorage.org/files/bfe/f4b/f5e/bfef4bf5e726492b9d39ee4982c83a54.jpg"><br>
<br>
       ,    . ,      log(N) (   N=8, log(N) = 3).   ,        .       2.<br>
<br>
<b>1.2.3.  </b><br>
<br>
<img src="https://habrastorage.org/files/6e8/fd5/f7d/6e8fd5f7d6a3457cb6b043517febc3d5.jpg"><br>
<br>
   ,       .         8 :<br>
<ul>
<li>    4 ,  2  .</li>
<li>  ‚Äî 2   4 .</li>
<li>  ‚Äî 1   8 .</li>
</ul><br>
     log(N),  <b>     N * log(N).</b><br>
<br>
<b>1.2.4.   </b><br>
<br>
    ? <br>
<ul>
<li>      ,       ,    (  ¬´<a href="https://en.wikipedia.org/wiki/In-place_algorithm"> </a>¬ª).</li>
<li>          ,    /.    ,        ,       .   ,     ,         100.    ¬´<a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BD%25D0%25B5%25D1%2588%25D0%25BD%25D1%258F%25D1%258F_%25D1%2581%25D0%25BE%25D1%2580%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0"> </a>¬ª.</li>
<li>        //</li>
<li>,       <a href="https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/mapreduce/Reducer.html">Hadoop</a>.</li>
</ul><br>
    <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D1%2585%25D0%25B8%25D0%25BC%25D0%25B8%25D1%258F">   </a>!     (   ) ,     .      ,    <a href="http://wwwlgis.informatik.uni-kl.de/archiv/wwwdvs.informatik.uni-kl.de/courses/DBSREAL/SS2005/Vorlesungsunterlagen/Implementing_Sorting.pdf"> </a>,         .<br>
<br>
<h3>1.3. ,   -</h3><br>
,  œå    .      ,     .<br>
<br>
<b>1.3.1. </b><br>
<br>
  ‚Äî   .       :<br>
<br>
<img src="https://habrastorage.org/files/b8e/b43/386/b8eb433867494f39bf089e4f1a856a2a.jpg"><br>
<br>
     - ,  ‚Äî  .        ( , ,   ..).<br>
<br>
       ,     ,    -  . ,     ,   .      ,   ,    ‚ÄúUK‚Äù.    N  (N ‚Äî  ).     ,     .     .<br>
<br>
<i>:       ,     (,     ).         .</i><br>
<br>
<b>1.3.2.    </b><br>
<br>
   ‚Äî  ,        :<br>
<ul>
<li>,       .</li>
<li>,       .</li>
</ul><br>
<img src="https://habrastorage.org/files/12d/3f0/4bd/12d3f04bd8784a7b83b02665f1755f90.png"><br>
<br>
         .<br>
<br>
   N = 15 . ,       208:<br>
<ul>
<li>  ,   136.  136 &lt; 208,      .</li>
<li>398 &gt; 208,     ,    .</li>
<li>250 &gt; 208,     .</li>
<li>200 &lt; 208,     .       200  ,     .    ,   -200   .</li>
</ul><br>
,       40:<br>
<ul>
<li>    -136.  136 &gt; 40,     .</li>
<li>80 &gt; 40,  ¬´ ¬ª.</li>
<li>40 = 40,   .  ID ,     (   ),       .</li>
<li> ID ,      .</li>
</ul><br>
             .     Log(N),         .<br>
<br>
    .<br>
<br>
,     ,    .       .   ,   ‚ÄúUK‚Äù,    ,   ,     ID  ,   .      ,     log(N) .     .<br>
<br>
        ( , ,  ,   ..),         (..  ).         .<br>
<br>
<i><b> +</b></i><br>
<br>
    ,     ,    <b>     </b>. √°    (N),             .  ,       /,     .        <b> </b>.          ‚Äî +.    ,   (ID   )      (¬´¬ª),          .<br>
<br>
<img src="https://habrastorage.org/files/f58/7b0/194/f587b019492c41d38173a018d729f945.jpg"><br>
<br>
 ,    . ¬´  ¬ª    ,  ID   .       (log(N)) (   ).    B-  ,  <b>¬´¬ª   </b>. <br>
<br>
,        40  100:<br>
<ul>
<li>  ,   40  ,   ,  40  .     .</li>
<li> ,    ,  ,   100.</li>
</ul><br>
   N ,      .      log(N) ,     .   ,         .       + log(N) ,    N     .       ,    + log(N) ,      .     (, 200),  N ‚Äî , , (1 000 000),        .<br>
<br>
       .        , , ,     +, :<br>
<ul>
<li>      -,      .</li>
<li>,  +       ,  √°    (log(N)),  (N).</li>
</ul><br>
 , +     .     , +    .  ,        ¬´¬ª   .     :      +   (log(N)).         : <b>      </b>.        // ,       ,      (log(N)) .         ,     .<br>
<br>
  +    <a href="https://ru.wikipedia.org/wiki/B%252B_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE"></a>,     (<a href="http://blog.jcole.us/2013/01/07/the-physical-structure-of-innodb-index-pages/"></a>, <a href="http://blog.jcole.us/2013/01/10/btree-index-structures-in-innodb/"></a>)    MySQL.     ,  InnoDB ( MySQL)   .<br>
<br>
<b>1.3.3. -</b><br>
<br>
      ,     .   -       ,  - (hash join). -        ( ,  ).          .   - :<br>
<ul>
<li><b>   .</b></li>
<li><b>-,    .</b>    .</li>
<li><b>  .</b>   ,           .</li>
</ul><br>
   -:<br>
<br>
<img src="https://habrastorage.org/files/0a9/76a/46e/0a976a46e8324b88baa4719be1dad1ae.jpg"><br>
<br>
 10 ,   -   10   .            :   0,      0,  1,    1,  ..         . <br>
<br>
,     78:<br>
<ul>
<li>-   ,   8. </li>
<li>   8     .</li>
</ul><br>
      :        . <br>
<ul>
<li>   59:</li>
<li> ,   9.</li>
<li>   9,    99.  99   59,      (9),    (79),       (29). </li>
<li>  .</li>
</ul><br>
   7 .<br>
<br>
 ,      .  -,      1 000 000 (    6 ).       59    ,    000059   . <b>     -,         .</b><br>
<br>
      .     .    -,  :<br>
<ul>
<li> (, ).</li>
<li>  (  ).</li>
<li>    (  )</li>
</ul><br>
 ..<br>
      -,        (1).<br>
<br>
<i><b>  -</b></i><br>
<br>
     ?   , :<br>
<ul>
<li>-     ,     .</li>
<li>         .      ,          .</li>
<li>      -. ,     .</li>
</ul><br>
       <a href="http://coding-geek.com/how-does-a-hashmap-work-in-java/">Java HashMap</a>,     -.        Java,  .<br>
<br>
<h1>2.  </h1><br>
    .         .<br>
<br>
    ,        .          .  ,  ,  SQLite,        .   ,          ,  SQLite :<br>
<ul>
<li>       .</li>
<li>       .</li>
</ul><br>
       :<br>
<br>
<img src="https://habrastorage.org/files/526/1d8/513/5261d8513d5943f9818f46f7aa02c220.jpg"><br>
<br>
  ,      ,     .        .   ,      ,   .<br>
<br>
   (Core Components):<br>
<ul>
<li><b> </b>.      /,   .           ,    .</li>
<li><b> </b>.      ,    . </li>
<li><b>  </b>.  ¬´ ¬ª      .     ,           .</li>
<li><b> </b>.        ,     .  ,    ,     .       ,  .</li>
<li><b> </b>.     .</li>
<li><b> </b>.   .</li>
</ul><br>
 (Tools):<br>
<ul>
<li><b>  .</b>  .</li>
<li><b> .</b>        .</li>
<li><b> .</b>             .</li>
<li><b>  .</b>   (    )     , ,    ..</li>
</ul><br>
  (Query Manager):<br>
<ul>
<li><b> </b>.   .</li>
<li><b> .</b>   .</li>
<li><b> </b>.</li>
<li><b> . </b>  .</li>
</ul><br>
  (Data Manager):<br>
<ul>
<li><b> </b>.   .</li>
<li><b> </b>.           .</li>
<li><b>   </b>.       .</li>
</ul><br>
  ,    SQL-  :<br>
<ul>
<li> .</li>
<li> .</li>
<li> .</li>
</ul><br>
<h1>3.  </h1><br>
<img src="https://habrastorage.org/files/b1d/998/7e4/b1d9987e40f14195bbcb1d28deb9dd53.jpg"><br>
<br>
      ‚Äî -   /.              API (JDBC, ODBC, OLE-DB  ..),     .<br>
<br>
    :<br>
<ul>
<li>    (   ),      .      DBA.</li>
<li>  ,     ( ),     .</li>
<li>  ,        .</li>
<li>  ,     .    ,    ,       .</li>
<li>   ,       .</li>
<li>         ,          .</li>
<li>       -    .</li>
</ul><br>
<h1>4.  </h1><br>
<img src="https://habrastorage.org/files/7a5/aaf/62a/7a5aaf62ab8a47ba94d7144746a58d1f.jpg"><br>
<br>
    .         ,   ,     .      :<br>
<ul>
<li>     ().</li>
<li>          .</li>
<li>      .           .</li>
<li> .</li>
<li> .</li>
</ul><br>
    ,     :<br>
<ul>
<li><a href="http://www.cs.berkeley.edu/~brewer/cs262/3-selinger79.pdf">Access Path Selection in a Relational Database Management System</a>.  1979   .</li>
<li>    <a href="http://infolab.stanford.edu/~hyunjung/cs346/db2-talk.pdf"></a>  ,  DB2 9.x  .</li>
<li>   <a href="http://momjian.us/main/writings/pgsql/optimizer.pdf"></a>  ,      PostgreSQL.       .</li>
<li> <a href="https://www.sqlite.org/optoverview.html"></a> SQL  .   ,  SQLite   .          .</li>
<li> <a href="https://blogs.msdn.com/cfs-filesystemfile.ashx/__key/communityserver-components-postattachments/00-08-50-84-93/QPTalk.pdf"></a>  ,  SQL Server 2005  .</li>
<li> <a href="http://www.oracle.com/technetwork/database/bi-datawarehousing/twp-optimizer-with-oracledb-12c-1963236.pdf"></a>    Oracle 12c.</li>
<li>         ‚ÄúDatabase System Concepts‚Äù: <a href="http://codex.cs.yale.edu/avi/db-book/db6/slide-dir/PPT-dir/ch12.ppt"></a>  <a href="http://codex.cs.yale.edu/avi/db-book/db6/slide-dir/PPT-dir/ch13.ppt"></a>.  ,      /.       CS.</li>
<li>   <a href="https://www.informatik.hu-berlin.de/de/forschung/gebiete/wbi/teaching/archive/sose05/dbs2/slides/09_joins.pdf"></a>,    .         /.</li>
</ul><br>
<h3>4.1.  </h3><br>
 SQL-        .      ,    . ,  SLECT  SELECT. <br>
<br>
     .   ,       . ,  WHERE    SELECT,    .<br>
<br>
        .      :<br>
<ul>
<li>   .</li>
<li>   .</li>
<li>      . ,     ,    substring()   ).</li>
</ul><br>
  ,       ( )   .       DBA.<br>
<br>
     SQL-     (   ).    ,      .<br>
<br>
<h3>4.2.  </h3><br>
   :<br>
<ul>
<li>  .</li>
<li>  .</li>
<li>      .</li>
</ul><br>
      .     ,   .     :<br>
<ul>
<li><b>  ()</b>.      ,      SQL-.</li>
<li><b> .</b>     ,       ,    . </li>
</ul><br>
,  : <br>
<br>
<pre><code class="sql">SELECT PERSON.*
FROM PERSON
WHERE PERSON.person_key IN
(SELECT MAILS.person_key
FROM MAILS
WHERE MAILS.mail LIKE 'christophe%');
</code></pre><br>
  :<br>
<br>
<pre><code class="sql">SELECT PERSON.*
FROM PERSON, MAILS
WHERE PERSON.person_key = MAILS.person_key
and MAILS.mail LIKE 'christophe%';
</code></pre><br>
<br>
<ul>
<li><b>  .</b> ,   DISTINCT   ,      UNIQUE,     .      DISTINCT  .</li>
<li><b>  .</b>          ,        ,    - ,   .</li>
<li><b> .</b>    -,  ,       . , WHERE AGE &gt; 10+2   WHERE AGE &gt; 12.  TODATE (- )      .</li>
<li><b>Partition pruning</b>.     ,     .</li>
<li><b>  .</b>      ,      ,   ,    ,    ,       .</li>
<li><b> .</b>        (  Oracle),     .</li>
<li><b>OLAP-.</b>   /,  ,   ..       , ,  , OLAP-    ,   .</li>
</ul><br>
      ,     .<br>
<br>
<h3>4.3. </h3><br>
      ,    ,       .        ,     ,    . <br>
<br>
    ?<br>
<br>
  ,      .        ,     (  4  8   ).     1 ,    -   .            .<br>
<br>
   .      , :<br>
<ul>
<li>  /  .</li>
<li>  :<br>
<ul>
<li>   .</li>
<li>    (, , ).</li>
<li>    (, , ).</li>
</ul></li>
<li>    .</li>
</ul><br>
        /,          .<br>
<br>
       . ,       : ¬´¬ª  ¬´¬ª.    ,     1 000   ¬´¬ª  1 000 000 ‚Äî ¬´¬ª.         ‚Äî ¬´, ¬ª,   ¬´, ¬ª:      ,      ,         2-3   . <br>
<br>
    .          .        . ,     ,   ..         .       (WHERE AGE=18)    (WHERE AGE &gt; 10 AND AGE &lt; 40),       ,      (, ).<br>
<br>
    . ,     : <br>
<ul>
<li>Oracle: USER/ALL/DBA_TABLES  USER/ALL/DBA_TAB_COLUMNS</li>
<li>DB2: SYSCAT.TABLES  SYSCAT.COLUMNS</li>
</ul><br>
   .   ,  , ,    500 ,        1 000 000.  ,      ,           .     ,       .        ,      (, 10%)      .     ,       ,      .            .<br>
<br>
      ,     .     <a href="http://www.postgresql.org/docs/9.4/static/row-estimation-examples.html"> PostgreSQL</a>. <br>
<br>
<h3>4.4.  </h3><br>
    CBO (Cost Based Optimization),  .     ,       ¬´¬ª,           ¬´¬ª  .<br>
<br>
              ,            .        ·ª≥ ,    ¬´¬ª   ,    /.  √°  ‚Äî  ,          ,  ,  if, ,   ..<br>
<br>
 :<br>
<ul>
<li>          .</li>
<li>   (   )     ,        .</li>
</ul><br>
       .  ,        ,    .<br>
<br>
<b>4.4.1. </b><br>
<br>
   ,   -.   ,   .  ,     , ,  (bitmap index).          ,         -.  ,           ,       .<br>
<br>
<b>4.4.2.  </b><br>
<br>
    ,     .     .<br>
<ul>
<li><b> .</b>       .   ,      ,  .</li>
<li><b> .</b> , ,      WHERE AGE &gt; 20 AND AGE &lt; 40. ,           AGE. <br>
<br>
      ,  √°      M + log(N),  N ‚Äî    ,   ‚Äî     .        .       ,          .</li>
<li><b>   .</b>    ,        -  . </li>
<li><b>  ID .</b>    ,  œå          . ,    :<br>
<br>
<pre><code class="sql">SELECT LASTNAME, FIRSTNAME from PERSON WHERE AGE = 28
</code></pre><br>
       ,        28-,    ID   ,       . <br>
<br>
,    :<br>
<br>
<pre><code class="sql">SELECT TYPE_PERSON.CATEGORY from PERSON, TYPE_PERSON
WHERE PERSON.AGE = TYPE_PERSON.AGE
</code></pre><br>
   TYPE_PERSON      PERSON.         PERSON,       ID    . <br>
<br>
       ,       /.       ID,     .</li>
<li><b> </b>.      <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_optop.htm"> Oracle</a>.       ,       . </li>
</ul><br>
<b>4.4.3.  </b><br>
<br>
,  ,   ,    .       : <b>    </b>.   :<br>
<ul>
<li>,</li>
<li>,</li>
<li>    (,  ).</li>
</ul><br>
    ,     -. , A JOIN B     ,     ,   ‚Äî .<br>
<br>
   A JOIN B    B JOIN A.<br>
<br>
,     N ,   ‚Äî .   ,      . N  M  <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D1%2589%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25BC%25D0%25BD%25D0%25BE%25D0%25B6%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0">  </a>.<br>
<ul>
<li><b>    .</b>    .<br>
<br>
<img src="https://habrastorage.org/files/a34/dd3/6d7/a34dd36d7a1e4cffb148981782045d39.jpg"><br>
<br>
  :            . <br>
<br>
 :<br>
<br>
<pre><code class="html">nested_loop_join(array outer, array inner)
  for each row a in outer
    for each row b in inner
      if (match_join_condition(a,b))
        write_result_in_output(a,b)
      end if
    end for
   end for
</code></pre><br>
   , √°    (N*M).<br>
<br>
   N         .      N + N*M   .     ,       ,         M + N .         ,    .<br>
<br>
   œå   . <br>
<br>
     ,     /.<br>
       ,    ,    . <br>
<ul>
<li>    ,     (bunch),           . </li>
<li>      ,     . </li>
<li>           . </li>
</ul><br>
  ,    .<br>
<br>
 :<br>
<br>
<pre><code class="html">// improved version to reduce the disk I/O.
nested_loop_join_v2(file outer, file inner)
  for each bunch ba in outer
  // ba is now in memory
    for each bunch bb in inner
	    // bb is now in memory
		for each row a in ba
          for each row b in bb
            if (match_join_condition(a,b))
              write_result_in_output(a,b)
            end if
          end for
       end for
    end for
   end for
</code></pre><br>
   √°    ,      : (   +    *   ).           . <br>
<br>
<i>:          ,     ,   .</i></li>
<li><b>-.</b>    ,       . <br>
<br>
<img src="https://habrastorage.org/files/c36/2cf/ad5/c362cfad544a4a369aad6879245df9b5.jpg"><br>
<br>
 :<br>
<ol>
<li>     .</li>
<li>   -.</li>
<li>        .</li>
<li>     (     -),         .</li>
<li>        .</li>
</ol><br>
       œå ,    :<br>
<ul>
<li>    .</li>
<li>-       .       .</li>
<li>                .</li>
</ul><br>
 √°   :<br>
<br>
( / ) * (N / X) + __-() + _- * N<br>
<br>
  -    ,  √°    ( + N).<br>
<br>
    -,          /:<br>
<ol>
<li> -   .</li>
<li>  .</li>
<li>       (    ,    ).</li>
</ol><br>
<b> .</b>    ,      .        ,        ,    .      , ,    .<br>
<br>
      :<br>
<ol>
<li>()    ,         .</li>
<li>  .</li>
</ol><br>
<u></u><br>
<br>
     ,       ,     . <br>
<br>
 ,      , :<br>
<ul>
<li>   .</li>
<li>       .</li>
<li>      .</li>
</ul><br>
<u> </u><br>
<br>
<img src="https://habrastorage.org/files/17f/b9b/ec2/17fb9bec205a46edbad5c65410a94d63.jpg"><br>
<br>
          .            .<br>
<ol>
<li>     .</li>
<li>  ,     ,      ,     .</li>
<li>   ,   ,             ,       .</li>
<li> 1-3 ,       .</li>
</ol><br>
    ,  √°   (N + M).<br>
<br>
     ,  √°   O(N * Log(N) + M * Log(M)).<br>
<br>
   ,      ,        -.     :    ,        ,      .       . : <br>
<br>
<pre><code class="html">mergeJoin(relation a, relation b)
  relation output
  integer a_key:=0;
  integer b_key:=0;

  while (a[a_key]!=null and b[b_key]!=null)
    if (a[a_key] &lt; b[b_key]) a_key++; else if (a[a_key] &gt; b[b_key])
      b_key++;
    else //Join predicate satisfied
      write_result_in_output(a[a_key],b[b_key])
      //We need to be careful when we increase the pointers
      integer a_key_temp:=a_key;
      integer b_key_temp:=b_key;
      if (a[a_key+1] != b[b_key])
        b_key_temp:= b_key + 1;
      end if
      if (b[b_key+1] != a[a_key])
        a_key_temp:= a_key + 1;
      end if
      if (b[b_key+1] == a[a_key] &amp;&amp; b[b_key] == a[a_key+1])
        a_key_temp:= a_key + 1;
        b_key_temp:= b_key + 1;
      end if
      a_key:= a_key_temp;
      b_key:= b_key_temp;
    end if
  end while
</code></pre></li>
</ul><br>
<i><b>  ?</b></i><br>
<br>
      ,       .          :<br>
<ul>
<li><b>  </b>.   ,    -.   ,      .</li>
<li><b>    .</b>      ,    ,         ,   -     .       ,          .</li>
<li><b> .</b>      -,     .</li>
<li><b>   .</b> ,       ( ),      .       ,       .          ,   ORDER BY/GROUP BY/DISTINCT.</li>
<li><b>   </b>.       .</li>
<li><b>    </b>.    (.1 = .2)?  , ,     (self-join)?        .</li>
<li><b> </b>.       (,     ,    ),        -.  -        . </li>
<li><b>      /.</b></li>
</ul><br>
       <a href="https://www-01.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.admin.perf.doc/doc/c0005311.html">DB2</a>, <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/optimops.htm">ORACLE</a>  <a href="https://technet.microsoft.com/en-us/library/ms191426%2528v%3Dsql.105%2529.aspx">SQL Server</a>.<br>
<br>
<b>4.4.4.  </b><br>
<br>
,     ,       .    :<br>
<ul>
<li>   .</li>
<li>   .</li>
<li>  .</li>
<li>   .</li>
</ul><br>
        :<br>
<br>
<pre><code class="sql">SELECT * from PERSON, MOBILES, MAILS,ADRESSES, BANK_ACCOUNTS
WHERE
PERSON.PERSON_ID = MOBILES.PERSON_ID
AND PERSON.PERSON_ID = MAILS.PERSON_ID
AND PERSON.PERSON_ID = ADRESSES.PERSON_ID
AND PERSON.PERSON_ID = BANK_ACCOUNTS.PERSON_ID
</code></pre><br>
      .    :<br>
<ol>
<li>   ?    (-,  ,     ),    0, 1  2 .     ,      .</li>
<li>     ?</li>
</ol><br>
,         :<br>
<br>
<img src="https://habrastorage.org/files/1b9/91d/46c/1b991d46cddd4a0ebc2c5dd2b1e78340.png"><br>
<br>
  ,    ?<br>
<ol>
<li> -.               .    .          ,  34=81   .              ,     (2 * 4)! / (4 + 1)!..  ,             34 * (2 * 4)! / (4 + 1)! = 27 216.     ,      0, 1  2  -,       210 000.   ,     ?</li>
<li>  .  ,  ,    .</li>
<li>      .        ,             ,       .</li>
<li> ¬´¬ª      .<br>
   :<br>
<ol>
<li>¬´¬ª,       .      . , ¬´            ¬ª.</li>
<li>               . , ¬´  ,      ,   ‚Äî    -¬ª.</li>
</ol></li>
</ol><br>
        .          : OUTER JOIN, CROSS JOIN, GROUP BY, ORDER BY, PROJECTION, UNION, INTERSECT, DISTINCT  ..         .<br>
<br>
     ?<br>
<br>
<b>4.4.5.  , ¬´¬ª   </b><br>
<br>
    ,     .           . <b>      ,    .</b><br>
<br>
       .                .    .<br>
<br>
    ,      . <br>
<br>
<img src="https://habrastorage.org/files/d6d/0c9/2f4/d6d0c92f47bf48d7b3fcaeadeab5bb49.png"><br>
<br>
        A JOIN B.       ,            ,  .  ,   <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25BC%25D0%25BE%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F"></a>    ,     . <br>
<br>
    œå  (2*N)!/(N+1)!   ¬´ ¬ª 3<sup>N</sup>.              336  81.     8  ( ),      57 657 600  6 561.<br>
<br>
        ,     :<br>
<br>
<pre><code class="html">procedure findbestplan(S)
if (bestplan[S].cost infinite)
   return bestplan[S]
// else bestplan[S] has not been computed earlier, compute it now
if (S contains only 1 relation)
         set bestplan[S].plan and bestplan[S].cost based on the best way
         of accessing S  /* Using selections on S and indices on S */
     else for each non-empty subset S1 of S such that S1 != S
   P1= findbestplan(S1)
   P2= findbestplan(S - S1)
   A = best algorithm for joining results of P1 and P2
   cost = P1.cost + P2.cost + cost of A
   if cost &lt; bestplan[S].cost
       bestplan[S].cost = cost
      bestplan[S].plan = ‚Äúexecute P1.plan; execute P2.plan;
                 join results of P1 and P2 using A‚Äù
return bestplan[S]
</code></pre><br>
        ,      (),     :<br>
<ul>
<li>    -    (,     ),   3<sup>N</sup>     N*2<sup>N</sup>.<br>
<br>
<img src="https://habrastorage.org/files/f58/3a6/736/f583a6736e2d42d697d26b271ce84a58.jpg"><br>
<br>
</li>
<li>   (¬´      ,      ,   ¬ª)          . </li>
<li>  ¬´ ¬ª (, ¬´       ¬ª)      .</li>
</ul><br>
<i><b> </b></i><br>
<br>
    ,        ,     ‚Äî  .<br>
<br>
            ().            .     JOIN,        JOIN    .<br>
<br>
  .    4  5  (A, B, C, D  E).     ,         .    ¬´    ¬ª.<br>
<ul>
<li>    , , .</li>
<li>      (     ,    ).</li>
<li>,      A JOIN B.</li>
<li>       A JOIN B (     ).</li>
<li>,     (A JOIN B) JOIN C.</li>
<li>    .</li>
<li>‚Ä¶</li>
<li>      : (((A JOIN B) JOIN C) JOIN D) JOIN E)/</li>
</ul><br>
       ,    B,   C  ..     ,     .<br>
<br>
   ¬´<a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%25B1%25D0%25BB%25D0%25B8%25D0%25B6%25D0%25B0%25D0%25B9%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D1%2581%25D0%25BE%25D1%2581%25D0%25B5%25D0%25B4%25D0%25B0_%25D0%25B2_%25D0%25B7%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B5_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BC%25D0%25B8%25D0%25B2%25D0%25BE%25D1%258F%25D0%25B6%25D1%2591%25D1%2580%25D0%25B0">  </a>¬ª.<br>
<br>
    ,       N*log(N)     <a href="http%253A%252F%252Fwww.cs.bu.edu%252F~steng%252Fteaching%252FSpring2004%252Flectures%252Flecture3.ppt%26ei%3DhyK3VZGRAYn2UtX9MA%26usg%3DAFQjCNGL41kMNkG5cH"> </a>. √°    (N*log(N))  (3<sup>N</sup>)      .       20 ,    26  3 486 784 401.  , ?<br>
<br>
  .  ,        ,             .    A JOIN B    ,  (A JOIN C) JOIN B    ,  (A JOIN B) JOIN C.<br>
<br>
             ,           .<br>
<br>
<b><i> </i></b><br>
<br>
<i>        ,     .        .</i><br>
<br>
        .      -    . ,   ,     ..<br>
<br>
        .        .    ,              .  ,     ,    ,  .<br>
<br>
      :<br>
<ul>
<li>       .</li>
<li>   ()       .</li>
<li>   ,    .</li>
<li>     ,     .</li>
<li>   ,      .</li>
<li>      .</li>
<li>    Y .</li>
<li>      .</li>
</ul><br>
  ,      .  ,  ,   .<br>
,   <a href="http://www.postgresql.org/docs/9.4/static/geqo-intro.html">  PostgreSQL</a>. <br>
<br>
      ,    (Simulated Annealing),   (Iterative Improvement),   (Two-Phase Optimization).   ,      , ,   ‚Äî  .<br>
<br>
<b>4.4.6.  </b><br>
<br>
<i>  ,   .</i><br>
<br>
       . ,   <a href="https://www.sqlite.org/optoverview.html"> SQLite</a>.  ¬´¬ª ,          :<br>
<ul>
<li>SQLite        CROSS JOIN.</li>
<li>     .</li>
<li>      ,    .</li>
<li>   3.8.0          ¬´ ¬ª (Nearest Neighor).    3.8.0  ¬´<a href="https://www.sqlite.org/queryplanner-ng.html">N  </a>¬ª (N3, N Nearest Neighbors).</li>
</ul><br>
   .   <a href="https://www-01.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.admin.perf.doc/doc/r0005278.html"></a> IBM DB2,   ,     7   :<br>
<ul>
<li> :<br>
<ul>
<li>0 ‚Äî  .   ,          .</li>
<li>1 ‚Äî  </li>
<li>2 ‚Äî  </li>
</ul></li>
<li> :<br>
<ul>
<li>3 ‚Äî     </li>
<li>5 ‚Äî  ,    </li>
<li>7 ‚Äî   ,   </li>
<li>9 ‚Äî    ,     .     ,   .</li>
</ul></li>
</ul><br>
    5.  :<br>
<ul>
<li>   ,     .</li>
<li>    ,       ).   ,   ,      .</li>
<li>       :<br>
<ul>
<li>    . </li>
<li>         .</li>
</ul></li>
<li>    ,     (  ),     AND       .</li>
</ul><br>
,      ,    ,   ‚Äî       .  ,          ,  .<br>
<br>
  (GROUP BY, DISTINCT  ..)   .<br>
<br>
<b>4.4.7.   </b><br>
<br>
    ,        .          .   ,       .     ,       ,  ,    ,   .<br>
<br>
<h3> </h3><br>
      .      ,   , . ,    (JOIN, SORT BY  ..)    ,   ,   .          .<br>
<br>
<h1>5.  </h1><br>
<img src="https://habrastorage.org/files/ede/a11/1fa/edea111fa1d241a99d3f14faba580e21.jpg"><br>
<br>
           .      ,     :<br>
<ul>
<li>    .         ,        - /.</li>
<li>  ‚Äî     .        ,     .</li>
</ul><br>
<h3>5.1.  </h3><br>
    ,        .       .<br>
<br>
<img src="https://habrastorage.org/files/ef4/6b8/379/ef46b837956d4e4b94fa8698df1e843f.jpg"><br>
<br>
 ,       ,        .       ,      .     ,     ,   :<br>
<ul>
<li>  ( )   (  ID ).</li>
<li>  .</li>
</ul><br>
     ,    : ¬´¬ª     , SSD,  RAID   .   ,     100-100 000  ,  .<br>
<br>
      .         ,     .         .<br>
<br>
<b>5.1.1. </b><br>
<br>
  ,    ,     , ,       .<br>
<br>
     ,        .      ,       ,       .<br>
<br>
       .        (, latch),        . <br>
<br>
   ,     ,       .     (speculative prefetching) (,     1, 3, 5,      7, 9, 11)    (sequential prefetching) (            .<br>
<br>
         ¬´  /¬ª (buffer/cache hit ratio).  ,       ,     .           .       <a href="http://docs.oracle.com/database/121/TGDBA/tune_buffer_cache.htm"> Oracle</a>.<br>
<br>
 ,      .           .           .       ,            .           .<br>
<br>
<b>5.1.2.   </b><br>
<br>
  (  , SQL Server, MySQL, Oracle  DB2)     LRU (Least Recently Used).        ,   ,    ,     .<br>
<br>
<img src="https://habrastorage.org/files/508/be3/e8e/508be3e8ed0f464686e5b5514dd88133.jpg"><br>
<br>
     ,        (latch),     .         :<br>
<ol>
<li>    1      .</li>
<li>    4      .</li>
<li>       3.</li>
<li>   9.  -  .      1,       .       9.</li>
<li>     4.     ,     . </li>
<li>    1.     ,     3,     .</li>
</ol><br>
  ,      .         ?  ,   /   ?           ,     ,  ,     . <br>
<br>
<i><b> </b></i><br>
<br>
   ,      .  <a href="http://docs.oracle.com/database/121/CNCPT/memory.htm"> Oracle</a>:<br>
<br>
<i>¬´       ,      ,     .         ,     .     ,         LRU,    ¬ª.</i><br>
<br>
    LRU ‚Äî LRU-K.  SQL Server  LRU-K   = 2.     ,           ,       .     ,     ,      .    .      ,  ,     ,     . ,     ,   -  .      ,       .<br>
<br>
   ,   SQL Server  LRU-K      2.        .        <a href="http://www.cs.cmu.edu/~christos/courses/721-resources/p297-o_neil.pdf">  1993- </a>.<br>
<br>
<i><b> </b></i><br>
<br>
, LRU-K   .   2Q  CLOCK (   LRU-K), MRU (Most Recently Used,     LRU,    , LRFU (Least Recently and Frequently Used)  ..     ,    .<br>
<br>
<b>5.1.3.  </b><br>
<br>
     ,      ,        ,   .     /.<br>
,    <b></b> (  ),     .      ¬´¬ª,   ,     .    ,        .        .<br>
<br>
<h3>5.2.  </h3><br>
    ,        .      ,    ACID-.<br>
<br>
<b>5.2.1. ¬´ ¬ª ( ,    )</b><br>
<br>
ACID- (Atomicity, Isolation, Durability, Consistency) ‚Äî   ,  ,   4 :<br>
<ul>
<li><b> (Atomicity).</b>   ¬´¬ª ,    .     10 .          ¬´¬ª,    .</li>
<li><b> (Isolation)</b>.          ,        ,      ,      .</li>
<li><b> (Durability).</b>    (commited),    ,            (, ). </li>
<li><b> () (Consistency).</b>       (      ).      .</li>
</ul><br>
<br>
<img src="https://habrastorage.org/files/49d/9c4/1f2/49d9c41f22fb48138ded56c8b680d4d9.jpg"><br>
<br>
   -     SQL-  , ,    .  ,         .   ‚Äî        . ,     :<br>
<ul>
<li>1  $100         .</li>
<li>2  $50          .</li>
</ul><br>
       ACID-:<br>
<ul>
<li><b></b>   ,         1 ( ,  ),    ,  $100    ,      (     ¬´ ¬ª).</li>
<li><b></b>   ,    1  2  ,       $100       .         .</li>
<li><b></b>     ,  1 ,       1.</li>
<li><b></b>         .</li>
</ul><br>
<i>   ,        .</i><br>
<br>
       ,        .  SQL  4  :<br>
<ul>
<li><b>  (Serializable).</b>   .     SQLite.     ,   .</li>
<li><b>  (Repeatable read).</b>     MySQL.     ,    :   <b>  </b>   ,      ,    .    <b> </b>   ,           .        . <br>
<br>
,    <br>
<br>
<pre><code class="sql">SELECT count(1) from TABLE_X
</code></pre><br>
          .         count(1),     . <br>
<br>
   .</li>
<li><b>   (Read commited)</b>.     Oracle, PostgreSQL  SQL Server.    ,    ,     . ,    ;       ,    .      ,     (  ),  .<br>
<br>
    (non-repeatable read). </li>
<li><b>   (Read uncommited).</b>    .        . ,    ;      (  ,    ).     ,    .      ,        ,     .<br>
<br>
   .</li>
</ul><br>
<br>
      (,   ,   PostgreSQL, Oracle  SQL Server).          ,    .<br>
<br>
             .        .<br>
<br>
<b>5.2.2.  </b><br>
<br>
,     ,   ,            (,   ).<br>
<br>
      ,    ,     .<br>
      ,   ,          .   ,        ,     .<br>
<br>
   .<br>
<br>
     .      (     ),       .<br>
<br>
      (     ):<br>
<ul>
<li>    .</li>
<li>      - /     ,       ,      .</li>
<li>      .       .</li>
<li>  ,     .</li>
</ul><br>
     ,     .    ,      .              .     ,       . <br>
<br>
<b>5.2.3.  </b><br>
<br>
         (locks) /  . <br>
   - ,    .      ,    ,      .<br>
<br>
   .<br>
<br>
       ,       .    ?      .     ,        .            .   -     ,    ,       .        .          ,    .<br>
<br>
<img src="https://habrastorage.org/files/4fd/77b/779/4fd77b7796cb4f64a08608244d720dc5.jpg"><br>
<br>
  ‚Äî  ,     .    - (   ).     ,        .<br>
<br>
<i><b>  (deadlock)</b></i><br>
<br>
     ,       :<br>
<br>
<img src="https://habrastorage.org/files/e5a/ee4/e3d/e5aee4e3dd0c40039f3c9ca5dcc8f217.jpg"><br>
<br>
      1     2.          2     1.<br>
<br>
    ,    ( ).      :<br>
<ul>
<li>    ,      ( ,    )?</li>
<li>      ,      ?</li>
<li>    ,      ?</li>
<li>     ?</li>
</ul><br>
    ,   ,     .<br>
<br>
 -   ,    .      ,    .         ( ,     ,   ),     :  .        ,       .<br>
<br>
      ,        .      ,     .          .<br>
<br>
<i><b> </b></i><br>
<br>
    ,          .  ,         ,        .    ,           .<br>
<br>
 DB2  SQL Server    ,       :<br>
<ul>
<li><b>  (growing phase)</b>,      ,    .</li>
<li><b>  (shrinking phase)</b>,       ( ,        ),    .</li>
</ul><br>
 ,     :<br>
<br>
<img src="https://habrastorage.org/files/dc3/b0f/d26/dc3b0fd266c14f66a392bbff1242167f.jpg"><br>
<br>
<i>   X = 1  Y = 1.    Y = 1,          .          Y = 2.</i><br>
<br>
,       : <br>
<ul>
<li> ,    ,      .</li>
<li> ,    ,    .      .</li>
</ul><br>
   ,   ,         ,    .         ,     .    ,         .<br>
<br>
,      ,        ( , , , ,  ),    .<br>
<br>
<i><b> </b></i><br>
<br>
       ‚Äî   . <br>
<ul>
<li>              .</li>
<li>      () .</li>
<li>        ,      ,   ,       (,  , ).</li>
</ul><br>
   , :<br>
<ul>
<li>    ,  .</li>
<li>     .</li>
</ul><br>
 ,     ,  ,   ,         .         .<br>
<br>
  ‚Äî    ‚Äî    ,    ,      (    ).   <a href="http://momjian.us/main/writings/pgsql/mvcc.pdf">  </a>,       PostgreSQL.<br>
<br>
   (DB2   9.7, SQL Server)   . ,  PostgreSQL, MySQL  Oracle,   . <br>
<br>
<i>:      .      ,     ,      ..</i><br>
<br>
       ,    ,    ,        .          .<br>
<br>
 ,       : <a href="http://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-model.html">MySQL</a>, <a href="http://www.postgresql.org/docs/9.4/static/mvcc.html">PostgreSQL</a>, <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/consist.htm">Oracle</a>.<br>
<br>
<b>5.2.4.  </b><br>
<br>
   ,          .        ,       .      .<br>
<br>
,     ,        ,      .<br>
<br>
 ,  ,     .<br>
<br>
   :<br>
<ul>
<li><b> /.</b>       (  ),     .     .    ,                ,    ¬´¬ª .</li>
<li><b> .</b>   .           .        ,      .</li>
</ul><br>
<i><b>WAL</b></i><br>
<br>
       /       .       .        . <br>
<br>
  ( , Oracle, <a href="https://technet.microsoft.com/en-us/library/ms186259%2528v%3Dsql.105%2529.aspx">SQL Server</a>, <a href="http://www.ibm.com/developerworks/data/library/techarticle/0301kline/0301kline.html">DB2</a>, <a href="http://www.postgresql.org/docs/9.4/static/wal.html">PostgreSQL</a>, MySQL  <a href="https://www.sqlite.org/wal.html">SQLite</a>)       WAL (Write-Ahead Logging).     :<br>
<ol>
<li>        ,      ,      .</li>
<li>          . </li>
<li>  ,            .</li>
</ol><br>
<img src="https://habrastorage.org/files/700/99e/45a/70099e45a5894adda0f54044d78af730.jpg"><br>
<br>
      .           .     ,  ,     .  ?<br>
<br>
!  ,         ,    ,        ¬´  ¬ª.  ,    ,       ,     .      ,      .<br>
<br>
<i><b>ARIES</b></i><br>
<br>
 1992    IBM    WAL,   ARIES.      ARIES    .       ,   <a href="http://www.cs.berkeley.edu/~brewer/cs262/Aries.pdf"> </a>.<br>
<br>
, ARIES   <b>A</b>lgorithms for <b>R</b>ecovery and <b>I</b>solation <b>E</b>xploiting <b>S</b>emantics.     :<br>
<ol>
<li>     .</li>
<li>    .</li>
</ol><br>
  ,      :<br>
<ol>
<li>  .</li>
<li>   .</li>
<li>   . ,      UNIQUE,    .</li>
<li>  .</li>
</ol><br>
      , ,    .<br>
<br>
  ?    ,     ,     .<br>
<br>
<i><b></b></i><br>
  (//)          .  :<br>
<ul>
<li><b>LSN (Log Sequence Number)</b>.   ,     .         , LSN     LSN  .     LSN ,        .</li>
<li><b>TransID.</b>  ,  .</li>
<li><b>PageID</b>.   ,    . </li>
<li><b>PrevLSN</b>.      ,    .</li>
<li><b>UNDO</b>.   . <br>
<br>
,     ,   UNDO   /   ( UNDO)   ,      ( UNDO).  ARIES   ,     .</li>
<li><b>REDO</b>.   .</li>
</ul><br>
 ,     (  ,   )  LSN  ,    .<br>
<br>
 , UNDO     PostgreSQL.     ,    .         .<br>
<br>
        ,    ,     UPDATE FROM PERSON SET AGE = 18;.       18:<br>
<br>
<img src="https://habrastorage.org/files/533/387/10d/53338710d408419e889dd336c8202444.jpg"><br>
<br>
    LSN.         ,       (      ).<br>
<br>
<i><b> </b></i><br>
         ,   .<br>
<br>
<img src="https://habrastorage.org/files/11f/e3c/a8d/11fe3ca8dac94c37997d0b8597ca5ef3.jpg"><br>
<br>
     :<br>
<ol>
<li>     .</li>
<li>       .</li>
<li>  ,   , , ,     .</li>
<li>       .      .</li>
<li>     .      .</li>
</ol><br>
  ,  ,      1  5.      ,    ¬´  -   ¬ª.             ,   ,       .<br>
<br>
<i><b> STEAL  FORCE</b></i><br>
<br>
     5    ,            REDO.   ¬´ NO-FORCE¬ª.<br>
<br>
      FORCE      .    5   . <br>
<br>
  ,       ( STEAL) ,      ,    (NO-STEAL).    ,   :        ?<br>
<br>
     :<br>
<ul>
<li> STEAL/NO-FORCE  UNDO  REDO.  ,         ( ARES).      . </li>
<li> STEAL/FORCE   UNDO.</li>
<li> NO-STEAL/NO-FORCE ‚Äî  REDO.</li>
<li> NO-STEAL/FORCE    .      ,     .</li>
</ul><br>
<i><b></b></i><br>
<br>
,       ? ,      ( ‚Ññ1:   !).       .<br>
ARIES    :<br>
<ol>
<li><b></b>.    ,      ,     .   ,    .       .   ,          .</li>
<li><b></b>.         REDO.      .     LSN   ,  ,   . <br>
<br>
 LSN(__)&gt;=LSN(__),          .     ,          .     ,   . <br>
<br>
 LSN(__)&lt;LSN(__),      . <br>
<br>
    ,   ,      .       .</li>
<li><b>.</b>          .          UNDO       PrevLSN.</li>
</ol><br>
        ,   .         ,     .    ,  ,     .   ARIES      ,     .<br>
<br>
   ¬´¬ª,   ,  -  ,     .    REDO  UNDO    ,   :<br>
<ul>
<li>   (     ).</li>
<li>    (    ,      ).</li>
</ul><br>
    ,        .      ,      .<br>
<br>
              .      ARIES   .         ,       LSN.        ,    LSN.<br>
<br>
<h1>6. </h1><br>
          <a href="http://db.cs.berkeley.edu/papers/fntdb07-architecture.pdf"> Architecture of a Database System</a>.     ,    . <br>
<br>
      ,      ,     .         : <br>
<ul>
<li>      .</li>
<li>  ,    .</li>
<li>     .</li>
<li>  .</li>
</ul><br>
   ,      NoSQL    .   ,  NoSQL-  .              ,    .<br>
<br>
,   - ,      ,   ,    ,   :<br>
<br>
<img src="https://habrastorage.org/files/25d/d71/e87/25dd71e87db1477d8696a1ca5651de2b.gif"><br>
<br>
        .</div><p>Source: <a href="https://habr.com/ru/post/266811/">https://habr.com/ru/post/266811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266801/index.html">Publish Android library in jCenter</a></li>
<li><a href="../266803/index.html">Old code: why is it so</a></li>
<li><a href="../266805/index.html">King's Bounty III: Advanced remake of the original game under DOS in Javascript / HTML5</a></li>
<li><a href="../266807/index.html">Asterisk and Truecaller. Determining the name of an unknown caller for incoming calls</a></li>
<li><a href="../266809/index.html">Easy to use wrapper over LoadLibrary () and GetProcAddress ()</a></li>
<li><a href="../266813/index.html">Why we are engaged in translation of the book from English on the GitHub platform</a></li>
<li><a href="../266817/index.html">Kotlin and its almost language constructs</a></li>
<li><a href="../266821/index.html">Java Programmer Cheat Sheet 2: Three hundred and fifty of the most popular non-mobile Java opensource projects on github</a></li>
<li><a href="../266823/index.html">At the junction of ERP and ECM: how we automated the logistics process</a></li>
<li><a href="../266827/index.html">New Russian K-Meleon 75 for Real Pro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>