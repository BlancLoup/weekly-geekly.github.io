<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web services in theory and practice for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What are web services? 

 First of all, web services (or web services) is a technology. And like any other technology, they have a fairly well-defined...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web services in theory and practice for beginners</h1><div class="post__text post__text-html js-mediator-article"><h2>  What are web services? </h2><br><br>  First of all, web services (or web services) is a technology.  And like any other technology, they have a fairly well-defined application environment. <br><br>  If you look at web services in the context of the network protocol stack, we will see that this, in the classic case, is nothing more than another add-on over HTTP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On the other hand, if we hypothetically divide the Internet into several layers, we will be able to distinguish at least two conceptual types of applications ‚Äî compute nodes that implement non-trivial functions and web-based application resources.  At the same time, the latter are often interested in the services of the former. <br><br>  But the Internet itself is heterogeneous, i.e., different applications on different nodes of the network operate on different hardware and software platforms, and use different technologies and languages. <br><br>  To connect all this and provide the ability for some applications to exchange data with others, and web services were invented. <br><a name="habracut"></a><br>  In essence, web services are the implementation of absolutely clear data exchange interfaces between different applications, which are written not only in different languages, but also distributed across different nodes of the network. <br><br>  It was with the advent of web services that the idea of ‚Äã‚ÄãSOA ‚Äî Service Oriented Architecture ‚Äî was developed. <br><br><h2>  Web Services Protocols </h2><br><br>  To date, the following web-services implementation protocols have become most common: <br><br><ul><li>  <strong>SOAP</strong> (Simple Object Access Protocol) is essentially a triple of SOAP / WSDL / UDDI standards. </li><li>  <strong>REST</strong> (Representational State Transfer) </li><li>  <strong>XML-RPC</strong> (XML Remote Procedure Call) </li></ul><br><br>  In fact, SOAP is derived from XML-RPC and is the next step in its development.  While REST is a concept based on an architectural style rather than a new technology based on the theory of manipulation of CRUD objects (Create Read Update Delete) in the context of WWW concepts. <br><br>  Of course, there are other protocols, but since they are not widely used, we will focus on two main issues in this brief review - SOAP and REST.  XML-RPC in view of the fact that it is somewhat "outdated", we will not consider in detail. <br><br>  We are primarily interested in creating new web services, rather than implementing clients to existing ones (as a rule, web service providers supply packages with API functions and documentation, therefore the issue of building clients to existing web services is less interesting from the point of view of the author). <br><br><h2>  SOAP vs. REST </h2><br><br>  The problems of this confrontation are well described in the <a href="http://www.citforum.ru/internet/webservice/soap_rest/">article by Leonid Chernyak</a> , found on the portal <a href="http://www.citforum.ru/">www.citforum.ru</a> . <br><br>  According to the author, the following can be briefly highlighted: <br><br>  SOAP is more applicable in complex architectures, where interaction with objects is beyond the scope of the CRUD theory, but in those applications that do not leave the framework of this theory, REST can be completely applicable due to its simplicity and transparency.  Indeed, if any objects of your service do not need more complex relationships, except for ‚ÄúCreate‚Äù, ‚ÄúRead‚Äù, ‚ÄúChange‚Äù, ‚ÄúDelete‚Äù (as a rule, in 99% of cases this is enough), it is possible that REST will be the right choice.  In addition, REST as compared to SOAP may turn out to be more productive, since it does not require the cost of parsing complex XML commands on the server (regular HTTP requests are executed - PUT, GET, POST, DELETE).  Although SOAP, in turn, is more reliable and secure. <br><br>  In any case, it‚Äôs up to you to decide what‚Äôs best for your application.  It is likely that you will even want to implement both protocols in order to leave the choice to the users of the service and that is your right. <br><br><h2>  Practical use of web services </h2><br><br>  Since this is a practical application, we need to choose a platform for building a web service and set a task.  Since the author is closest to PHP 5, we will select it as a technology for building a service, and we will accept the following requirements as a task. <br><br>  Suppose we need to create a service that provides access to information about exchange rates, which is collected by our application, and is accumulated in the database.  Further, through the web service, this information is transmitted to third-party applications for display in a convenient form. <br><br>  As we see, the task is quite simple and, from the point of view of the service itself, is limited only to reading information, but for practical purposes this will be enough for us. <br><br><h3>  Stage one - the implementation of the application for collecting information on exchange rates. </h3><br><br>  Information about exchange rates, we will collect from the pages of the NBU site (National Bank of Ukraine) daily and put it into a database managed by MySQL DBMS. <br><br>  Create a data structure. <br><br>  Currency table (currency): <br><br><blockquote><pre>  + ------------- + ------------------ +
 |  Field |  Type |
 + ------------- + ------------------ +
 |  code |  int (10) unsigned |
 |  charcode |  char (3) |
 |  description |  varchar (100) |
 |  value |  int (10) unsigned |
 |  base |  tinyint (1) |
 + ------------- + ------------------ + </pre></blockquote><br><br>  Table of exchange values ‚Äã‚Äã(exchange): <br><br><blockquote><pre>  + ------------ + ------------------ +
 |  Field |  Type |
 + ------------ + ------------------ +
 |  id |  bigint (20) ai |
 |  rate_date |  timestamp |
 |  rate_value |  float |
 |  code |  int (10) unsigned |
 + ------------ + ------------------ + </pre></blockquote><br><br>  To work with the database, we will use the ORM layer based on the <a href="http://phpdoctrine.org/">PHP Doctrine</a> package.  Implement the grabber: <br><br>  Grubber class (models / Grabber.php): <br><br><blockquote><pre>  &lt;? php
 / *
  * @package Currency_Service
  * /
 class Grabber {

     / **
      * Extracts data from outer web resource and returns it
      *
      * @param void
      * @return array
      * /
     public static function getData () {
         / **
          * Extracting data drom outer web-resource
          * /
         $ content = file_get_contents ('http://www.bank.gov.ua/Fin_ryn/OF_KURS/Currency/FindByDate.aspx');
         if (preg_match_all ('/ (\ d +) &lt;\ / td&gt; ([AZ] +) &lt;\ / td&gt; (\ d +) &lt;\ / td&gt; (. +?) &lt;\ / td&gt; (\ d + \. \ d +) &lt;\ / td&gt; / i ', $ content, $ m) == false) {
             throw new Exception ('Can not parse data!');
         }

         / **
          * Preformatting data to return;
          * /
         $ data = array ();
         foreach ($ m [1] as $ k =&gt; $ code) {
             $ data [] = array (
                 'code' =&gt; $ code,
                 'charcode' =&gt; $ m [2] [$ k],
                 'value' =&gt; $ m [3] [$ k],
                 'description' =&gt; $ m [4] [$ k],
                 'rate_value' =&gt; $ m [5] [$ k]
             );
         }
         return $ data;
     }

     public static function run () {
         $ data = self :: getData ();

         / **
          Sets default currency if not exists
          * /
         if (! Doctrine :: getTable ('Currency') -&gt; find (980)) {
             $ currency = new Currency ();
             $ currency-&gt; setCode (980)
                      -&gt; setCharcode ('UAH')
                      -&gt; setDescription ('ukrain hryvnia')
                      -&gt; setValue (1)
                      -&gt; setBase (1)
                      -&gt; save ();
         }

         foreach ($ data as $ currencyData) {
             / **
              * Updating table of currencies with found values
              * /
             if (! Doctrine :: getTable ('Currency') -&gt; find ($ currencyData ['code'])) {
                 $ currency = new Currency ();
                 $ currency-&gt; setCode ($ currencyData ['code'])
                          -&gt; setCharcode ($ currencyData ['charcode'])
                          -&gt; setDescription ($ currencyData ['description'])
                          -&gt; setValue ($ currencyData ['value'])
                          -&gt; setBase (0)
                          -&gt; save ();
             }

             / **
              * Updating exchange rates
              * /
             $ date = date ('Ymd 00:00:00');
             $ exchange = new Exchange ();
             $ exchange-&gt; setRateDate ($ date)
                      -&gt; setRateValue ($ currencyData ['rate_value'])
                      -&gt; setCode ($ currencyData ['code'])
                      -&gt; save ();
         }

     }
 }
 ?&gt; </pre></blockquote><br><br>  and the grabber itself (grabber.php): <br><br><blockquote><pre>  &lt;? php
 require_once ('config.php');
 Doctrine :: loadModels ('models');
 Grabber :: run ();
 ?&gt; </pre></blockquote><br><br>  Now let's make our grabber work once a day at 10:00 in the morning, by adding the command to start the grabber into the cron tables: <br><br><blockquote><pre>  0 10 * * * / usr / bin / php /path/to/grabber.php </pre></blockquote><br><br>  All - we have quite a useful service. <br><br>  Now we are implementing a web service that will allow other applications to extract data from our database. <br><br><h3>  SOAP service implementation </h3><br><br>  To implement a web service based on the SOAP protocol, we will use the built-in package in PHP for working with SOAP. <br><br>  Since our web service will be public, a good option would be to create a WSDL file that describes the structure of our web service. <br><br>  WSDL (Web Service Definition Language) - is an XML file of a specific format.  A detailed description of the syntax can be found <a href="http://www.w3.org/2002/ws/desc/">here</a> . <br><br>  In practice, it will be convenient to use the automatic file generation function provided by <a href="http://www.zend.com/en/products/studio/">Zend Studio for Eclipse IDE</a> .  This feature allows you to generate a WSDL file from PHP classes.  Therefore, first of all, we must write a class that implements the functionality of our service. <br><br>  CurrencyExchange class (models / CurrencyExchange.php): <br><br><blockquote><pre>  &lt;? php
 / **
  * Class providing web-service with all necessary methods
  * to provide information about currency exchange values
  *
  * @package Currency_Service
  * /
 class CurrencyExchange {

     / **
      * Retrievs exchange value for a given currency
      *
      * @param integer $ code - currency code
      * @param string $ data - currency exchange rate date
      * @return float - rate value
      * /
     public function getExchange ($ code, $ date) {
         $ currency = Doctrine :: getTable ('Currency') -&gt; find ($ code);
         $ exchange = $ currency-&gt; getExchange ($ date);
         return $ exchange?  (float) $ exchange-&gt; getRateValue (): null;
     }

     / **
      * Retrievs all available currencies
      *
      * @return array - list of all available currencies
      * /
     public function getCurrencyList () {
         return Doctrine :: getTable ('Currency') -&gt; findAll () -&gt; toArray ();
     }

 }
 ?&gt; </pre></blockquote><br><br>  Note that in order to automatically generate WSDL, we need to write javadoc-style comments, because it is in them that we write information about the types of arguments and return values.  It is also good to describe in a few words the work of the methods - because WSDL will serve as a description of the API for third-party developers who will use your web service. <br><br><blockquote>  Do not write in <a href="https://habrahabr.ru/users/param/" class="user_link">param</a> void or <a href="https://habrahabr.ru/users/return/" class="user_link">return</a> void docblocks - this is not critical for WSDL, but you have problems when implementing REST access to the same class. </blockquote><br><br>  Now in Zend Studio we enter the menu File-&gt; Export ..., select PHP-&gt; WSDL, add our class, register the URI-address of our service and create the WSDL-file.  The result should be something like this: <a href="">http://mikhailstadnik.com/ctws/currency.wsdl</a> <br><br>  If you add new functionality to your web service, you will need to re-create the WSDL file.  But things are not so smooth here.  Note that the SOAP client that has already requested your WSDL file caches it on its side.  Therefore, if you replace the old content with the new one in the WSDL file, some clients will not read it.  So, when adding new functionality, add the version to the name of your file.  And don't forget to provide backward compatibility for old customers, especially if you are not their supplier. <br><br>  On the other hand, WSDL rather rigidly defines the structure of a web service, which means that if there is a need to limit client functionality compared to the server, you can not include certain methods of your classes in WSDL.  Thus, they cannot be called, despite the fact that they exist. <br><br>  The implementation of the server itself now presents no difficulty: <br><br>  index.php file: <br><br><blockquote><pre>  &lt;? php
 require_once ('config.php');

 Doctrine :: loadModels ('models');

 $ server = new SoapServer ('http://mikhailstadnik.com/ctws/currency.wsdl');
 $ server-&gt; setClass ('CurrencyExchange');
 $ server-&gt; handle ();
 ?&gt; </pre></blockquote><br><br>  You can try the web service at <a href="http://mikhailstadnik.com/ctws/">http://mikhailstadnik.com/ctws/</a> <br>  A test client is also available there: <a href="http://mikhailstadnik.com/ctws/client.php">http://mikhailstadnik.com/ctws/client.php</a> <br><br>  The simplest client code can be: <br><br><blockquote><pre>  &lt;? php
 $ client = new SoapClient ('http://mikhailstadnik.com/ctws/currency.wsdl');
 echo 'USD exchange:'.  $ client-&gt; getExchange (840, date ('Ym-d'));
 ?&gt; </pre></blockquote><br><br><h3>  REST service implementation </h3><br><br>  REST is not a standard or a specification, but an architectural style built on existing standards that are well known and controlled by the W3C consortium, such as HTTP, URI (Uniform Resource Identifier), XML and RDF (Resource Description Format).  In REST services, emphasis is placed on access to resources, and not on the execution of remote services;  this is their fundamental difference from SOAP-services. <br><br>  Still, remote procedure call is applicable in REST.  It uses the PUT, GET, POST, DELETE HTTP protocol methods to manipulate objects.  Its fundamental difference from SOAP is that REST remains an HTTP request. <br><br>  Since PHP does not yet have a REST implementation, we will use <a href="http://framework.zend.com/">Zend Framwork</a> , which includes the implementation of both the REST client and the REST of the north. <br><br>  Let's use the ready-made CurrencyExchange class.  Let's write the server itself: <br><br>  rest.php: <br><br><blockquote><pre>  &lt;? php
 require_once 'config.php';
 require_once 'Zend / Rest / Server.php';

 Doctrine :: loadModels ('models');

 $ server = new Zend_Rest_Server ();
 $ server-&gt; setClass ('CurrencyExchange');
 $ server-&gt; handle ();
 ?&gt; </pre></blockquote><br><br>  As you can see, everything is very similar and simple. <br><br>  However, it should be stipulated that our REST service is less secure than the SOAP service, since any added method to the CurrencyExchange class when it is called will work (the class itself determines the structure of the service). <br><br>  Check the work of our service.  To do this, it is enough to pass the parameters of the method call in the term of the GET request: <br><br><blockquote><pre>  ? method = getExchange &amp; code = 840 &amp; date = 2008-11-29 </pre></blockquote><br><br>  or <br><br><blockquote><pre>  ? method = getExchange &amp; arg1 = 840 &amp; arg2 = 2008-11-29 </pre></blockquote><br><br>  If you wish or need, you can autonomously define the structure of your XML responses for the REST service.  In this case, it will also be necessary to take care of creating the definition of the type of your XML document (DTD - Document Type Definition).  This will be the minimum description of the API of your service. <br><br>  The simplest test client to the REST service may be in our case as follows: <br><br><blockquote><pre>  &lt;? php
 $ client = new Zend_Rest_Client ('http://mikhailstadnik.com/ctws/rest.php');
 $ result = $ client-&gt; getExchange (840, date ('Ym-d')) -&gt; get ();
 if ($ result-&gt; isSuccess ()) {
     echo 'USD exchange:'.  $ result-&gt; response;
 }
 ?&gt; </pre></blockquote><br><br>  In principle, Zend_Rest today can not be called the most accurate implementation of the principles of REST.  Exaggerating, we can say that this implementation has come down to remote procedure call (RPC), although the REST philosophy is much broader. <br><br>  You can <a href="">download the example in source code</a> with PHP Doctrine and Zend Framework (4.42 MB). <br><br><h2>  Conclusion </h2><br><br>  We completed the task minimum and showed what web services are, what they are for and how to implement them.  Naturally, the given example may be somewhat divorced from life, but it was chosen only as a tool for explaining the subject and essence of web services. <br><br>  In addition, we saw that the implementation of a web service is a fairly simple task when using modern tools that allow you to concentrate primarily on developing the functionality of the service itself, without worrying about low-level implementation of protocols. <br><br>  The author hopes that this material will be really useful to those who are on the path of developing web services. <br><br>  Good luck in development! </div><p>Source: <a href="https://habr.com/ru/post/46374/">https://habr.com/ru/post/46374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../46364/index.html">Windows Vista - Tip of the Day</a></li>
<li><a href="../46368/index.html">How to call Ballmer for 3 rubles</a></li>
<li><a href="../46369/index.html">5 tips for startups and entrepreneurs</a></li>
<li><a href="../46370/index.html">More about layout and widgets</a></li>
<li><a href="../46372/index.html">MySQL online performance optimization course</a></li>
<li><a href="../46375/index.html">Back to the future, or learning Java</a></li>
<li><a href="../46376/index.html">Killing time</a></li>
<li><a href="../46377/index.html">The crisis and the studio of Artemy Lebedev</a></li>
<li><a href="../46403/index.html">Google has captured habr</a></li>
<li><a href="../46404/index.html">The design of the usual things. Tea Bags and Saucer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>