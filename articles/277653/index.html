<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing a Django project on a VPS (centOS 7) [For Beginners]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share practical experience in installing the finished project on Django on Reg.ru VPS. This guide is designed for beginners, it contains a n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing a Django project on a VPS (centOS 7) [For Beginners]</h1><div class="post__text post__text-html js-mediator-article">  I want to share practical experience in installing the finished project on Django on Reg.ru VPS.  This guide is designed for beginners, it contains a number of not the best solutions, but with it you can run your project on Django for an hour. <br><br>  The manual does not contain security settings.  It was created on the basis of English instructions and pain, a lot of pain (links at the end of the article).  The instruction is relevant for settings: centOS 7, Django 1.9.2 and Python 3.4.3 <br><br>  Remark: I thank Phillip Torchinsky for providing the PyCharm product version for creating a project on Django. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  What do we have </h3><br>  We have a ready project on Django in the PyCharm development environment for the local computer.  Those.  settings.py has a sqlite3 database, broken paths to the state and an empty ALLOWED_HOSTS.  This is normal. <a name="habracut"></a><br><br><h3>  We begin </h3><br><h5>  Stage 1 </h5><br><br>  We buy a domain name on the website Reg.ru.  Standard procedure, nothing out of the ordinary. <br><br>  We buy on Reg.ru VPS H-XEN-2 with XEN virtualization.  This is necessary in order not to have problems with the kernel configuration and load distribution.  We select CentOS 7 as the operating system. The tariff is rather weak, so we‚Äôll take it to the beam than Ubuntu.  Debian is not taken because it is more difficult to configure. <br><br>  After purchasing a VPS, we will receive a letter with all the data.  There we will be offered to link the VPS and domain.  As a solution you will be offered to use the DNSAdmin control panel.  However, for some reason, this thing does not work, so we skip and go to the Reg.ru control panel in the settings of your domain name. <br><br>  - Your domain is DNS Servers.  Set the settings according to the screenshot: <br><br><img src="https://habrastorage.org/files/750/40f/bf3/75040fbf3381407eb9ecb1e54fc033c4.png"><br><br>  - Your domain - Zone management - add an ‚ÄúA‚Äù entry For example: (Ip-change to yours) <br><br><img src="https://habrastorage.org/files/162/06a/926/16206a92608e4018bd03a888a41af43c.png"><br><br>  Done, we tied the domain name to the hosting.  The update will take some time. <br><br><h5>  Stage 2 </h5><br><br>  To work with CentOS 7, we need a program: <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a> .  Download launches and get down to work. <br><br>  <b>Primary host tuning.</b> <br><br>  To begin, we will need to add another user and assign permissions to modify the configs.  This is done so that you do not break the entire system by mistake through the root-user. <br><br>  1) connect via PuTTY as root and type the following commands: <br><br>  - add user: <code>adduser habrauser <br></code> <code>adduser habrauser <br></code> <br>  - add user password: <code>passwd habrauser <br></code> <code>passwd habrauser <br></code> <br>  - add habrauser rights to the user: <code>gpasswd -a habrauser wheel <br></code> <code>gpasswd -a habrauser wheel <br></code> <br>  - disconnect from the session as root-user: <code>exit <br></code> <code>exit <br></code> <br><br>  After that we will be able to run commands by the user habrauser on behalf of the administrator through the sudo prefix <br><br>  2) Connect via PuTTY under the user habrauser and type the following commands: <br><br>  - Put the time zone server: <code>sudo timedatectl set-timezone Europe/Moscow <br></code> <code>sudo timedatectl set-timezone Europe/Moscow <br></code> <br>  - Confirm: <code>sudo timedatectl <br></code> <code>sudo timedatectl <br></code> <br>  - We put the time synchronizer: <code>sudo yum install ntp <br></code> <code>sudo yum install ntp <br></code> <br>  - Put the autorun synchronizer: <br> <code>sudo systemctl start ntpd <br> sudo systemctl enable ntpd <br></code> <br><br><h5>  Stage 3 </h5><br><br>  - We put the necessary additional packages for centOS 7 <br><br> <code>sudo yum install epel-release <br></code> <br><br> <code>sudo yum install python-pip python-devel postgresql-server postgresql-devel postgresql-contrib gcc nginx <br></code> <br><br>  Now we can use pip to install the necessary python packages. <br><br>  - We put the editor <br> <code>sudo yum install nano <br></code> <br><br>  <b>Customizing PostgreSQL</b> <br><br>  - Initialize PostgreSQL: <br><br> <code>sudo postgresql-setup initdb <br></code> <br><br>  - We start the PostgreSQL service: <br><br> <code>sudo systemctl start postgresql <br></code> <br><br>  - Open the configuration file: <br><br> <code>sudo nano /var/lib/pgsql/data/pg_hba.conf <br></code> <br><br>  - Editing so that the database works with authorized users. <br><br> <code>. . . <br> <br> # TYPE DATABASE USER ADDRESS METHOD <br> <br> # "local" is for Unix domain socket connections only <br> local all all peer <br> # IPv4 local connections: <br> #host all all 127.0.0.1/32 ident <br> host all all 127.0.0.1/32 md5 <br> # IPv6 local connections: <br> #host all all ::1/128 ident <br> host all all ::1/128 md5 <br></code> <br><br>  To save the file, we need to press ctrl + O, then enter and yes.  To exit, press ctrl + X. <br><br>  - Restart service <br><br> <code>sudo systemctl restart postgresql <br></code> <br><br>  - Put the autorun: <br><br> <code>sudo systemctl enable postgresql <br></code> <br><br>  <b>Creating a PostgreSQL database:</b> <br><br>  - enter the service: <br><br> <code>sudo su - postgres <br></code> <br><br>  - enter the local session: <br><br> <code>psql <br></code> <br><br>  - create habradb database: <br><br> <code>CREATE DATABASE habradb; <br></code> <br><br>  - create a database user: <br><br> <code>CREATE USER user WITH PASSWORD 'password'; <br></code> <br><br>  - we give the user user rights to use the habradb database: <br><br> <code>GRANT ALL PRIVILEGES ON DATABASE habradb TO user; <br></code> <br><br>  - we finish the session of working with the base: <br><br> <code>\q <br></code> <br><br> <code>exit <br></code> <br><br><h5>  Stage 4 </h5><br><br>  Our project is designed to use Python3.4.3, so we will put it in a virtual environment. <br><br>  - we put Python 3.4.3 <br><br> <code>sudo yum install python34-devel <br></code> <br><br>  - set the virtual environment: <br><br> <code>sudo pip install virtualenv <br></code> <br><br>  - create the apifolder project folder in the system root (specify the name that you use in the project in PyCharm itself): <br><br> <code>mkdir ~/apifolder <br></code> <br><br>  - go to this folder: <br><br> <code>cd ~/apifolder <br></code> <br><br>  - we create virtual environment of djangoen with python python 3.4.3 <br><br> <code>mkvirtualenv -p /usr/bin/python3.4 djangoen <br></code> <br><br>  ps to correctly specify the path to python, you can use the command <code>which python3.4 <br></code> <code>which python3.4 <br></code> <br><br>  - we activate the virtual environment and enter it <br><br> <code>source myprojectenv/bin/activate <br></code> <br><br>  - we put jungle, unicorn and base handler <br><br> <code>pip install django gunicorn psycopg2 <br></code> <br><br>  To install another version of django, use the command: <code>pip install django==1.9.2 #   <br></code> <code>pip install django==1.9.2 #   <br></code> <br><br><h5>  Stage 5 </h5><br><br>  We start to create our project Django: <br><br>  - Create a Django project in the current folder (the project name is the same as mine in PyCharm): <br><br> <code>django-admin.py startproject apifolder . #     ,      ,      apifolder. <br></code> <br><br>  - We copy our project from the local machine. <br><br>  In principle, the project should be copied from your git repository with push, but if you don‚Äôt know what git is, push and so on, then there is a more primitive way. <br><ul><li>  Connect to your server via SFTP: <a href="https://www.reg.ru/support/hosting-i-servery/hosting-sajtov/nachalo-raboty-i-dostupy/kak-podklyuchitsya-po-sftp">instructions</a> </li><li>  Open the folder home / habrauser / apifolder </li><li>  Open your project on the local machine </li><li>  With the usual drag and drop, we supplement and replace the files of the apifolder project created earlier, with your project from the local machine (its name must also be apifolder, or what you specified earlier). </li></ul><br><br>  - Open the file settings.py and make changes to it <br><br> <code>nano apifoldert/settings.py <br></code> <br><br>  Or you can change its config in the IDE, and then update it via SFTP. <br><br> <code>DATABASES = { <br> 'default': { <br> 'ENGINE': 'django.db.backends.postgresql', #      django 1,8  . <br> 'NAME': 'habradb', <br> 'USER': 'user', <br> 'PASSWORD': 'password', <br> 'HOST': 'localhost', <br> 'PORT': '', <br> } <br> } <br> <br> #,     static     ,      . <br> <br> STATIC_URL = '/static/' <br> MEDIA_URL = '/media/' <br> STATIC_ROOT = os.path.join(BASE_DIR, "static") <br> MEDIA_ROOT = os.path.join(BASE_DIR, "media") <br> STATICFILES_DIRS = ( <br> ) <br> <br> #    . ALLOWED_HOSTS         . <br> <br> DEBUG = True <br> <br> ALLOWED_HOSTS = [ <br> '*', <br> ] <br></code> <br><br>  - We put the relevant packages.  For example, in my case, in order for the project to support the ImageFiled model, I needed to install Pillow <br><br> <code>sudo yum install libtiff-devel libjpeg-devel libzip-devel freetype-devel lcms2-devel libwebp-devel tcl-devel tk-devel <br></code> <br><br> <code>pip install Pillow <br></code> <br><br>  - We are checking the database, we are doing the migration (Statics cannot be collected yet, since we don‚Äôt give it anything yet). <br><br> <code>cd ~/apifolder <br> ./manage.py makemigrations <br> ./manage.py migrate <br></code> <br><br>  Sometimes these commands don't work, and you need to use: <code>python manage.py makemigrations <br></code> <code>python manage.py makemigrations <br></code>  etc <br><br>  You can also create a user <br><br> <code>./manage.py createsuperuser <br></code> <br><br>  - We start the project and check its work: <br><br>  ./manage.py runserver 0.0.0.0:8000 <br><br>  The site will be available at: <a href="http://server_domain_or_ip/">server_domain_or_IP</a> : 8000 <br><br>  - check all points and do debugging.  If at this stage you do not check all the pages, admin panel and so on, then in the future there may be many problems.  Most often forgotten some little things: packages, url, local configs. <br><br>  - disconnect <br><br> <code>deactivate <br></code> <br><br><h5>  Stage 6 </h5><br><br>  - create Unicorn config: <br><br> <code>sudo nano /etc/systemd/system/gunicorn.service <br></code> <br><br> <code>[Unit] <br> Description=gunicorn daemon <br> After=network.target <br> <br> [Service] <br> User=habrauser <br> Group=nginx <br> WorkingDirectory=/home/habrauser/apifolder <br> ExecStart=/home/habrauser/apifolder/djangoen/bin/gunicorn --workers 3 --bind unix:/home/habrauser/apifolder/apifolder.sock apifolder.wsgi:application <br> <br> [Install] <br> WantedBy=multi-user.target <br></code> <br><br>  - we start unicorn and we do it autostart: <br><br> <code>sudo systemctl start gunicorn <br> sudo systemctl enable gunicorn <br></code> <br><br>  - We connect Nginx <br><br> <code>sudo nano /etc/nginx/nginx.conf <br></code> <br><br>  sudo nano /etc/nginx/nginx.conf <br><br>  We insert a new config into: <br><br> <code>http { <br> . . . <br> <br> include /etc/nginx/conf.d/*.conf; <br> <br> #  <br> <br> server { <br> listen 80 default_server; <br> <br> . . . <br></code> <br><br>  config itself <br><br> <code>server { <br> listen 80; <br> server_name example.ru www.example.ru; <br> <br> location = /favicon.ico { access_log off; log_not_found off; } <br> location /static/ { <br> root /home/habrauser/apifolder; <br> } <br> <br> location / { <br> proxy_set_header Host $http_host; <br> proxy_set_header X-Real-IP $remote_addr; <br> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; <br> proxy_set_header X-Forwarded-Proto $scheme; <br> proxy_pass http://unix:/home/habrauser/apifolder/apifolder.sock; <br> } <br> } <br></code> <br><br>  - add nginx user: <br><br> <code>sudo usermod -a -G habrauser nginx <br></code> <br><br>  - we put rights: <br><br> <code>chmod 710 /home/habrauser <br></code> <br><br>  - check the nginx config (should give two successful lines): <br><br> <code>sudo nginx -t <br></code> <br><br>  - Put the autorun: <br><br> <code>sudo systemctl start nginx <br> <br> sudo systemctl enable nginx <br></code> <br><br><h5>  Stage 7 </h5><br><br>  The main part of the work is done, now we need to collect the static and restart the machine: <br><br>  - go to our folder <br><br> <code>cd ~/apifolder <br></code> <br><br>  - activate the environment: <br><br> <code>source djangoen/bin/activate <br></code> <br><br>  - We collect statics: <br><br> <code>./manage.py collectstatic <br></code> <br><br>  - we put in the file setting.py ALLOWED_HOSTS = your domain, and DEBUG = False <br><br>  - reboot server: reg.ru - my hosting and services - your VPS - Reboot server <br><br>  Sometimes there is not enough one time (not everything starts working as it should), so you have to load several times. <br><br>  ___________________________________ <br><br>  Starting the server <a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-centos-7">www.digitalocean.com/community/tutorials/initial-server-setup-with-centos-7</a> <br>  Advanced settings <a href="https://www.digitalocean.com/community/tutorials/additional-recommended-steps-for-new-centos-7-servers">www.digitalocean.com/community/tutorials/additional-recommended-steps-for-new-centos-7-servers</a> <br>  Config itself <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-centos-7">www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-centos-7</a> </div><p>Source: <a href="https://habr.com/ru/post/277653/">https://habr.com/ru/post/277653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277637/index.html">Automatic work with SMS on the modem ZTE-MF823</a></li>
<li><a href="../277639/index.html">Implementing a MODBUS RTU server using the Fastwel interface module and CoDeSys software</a></li>
<li><a href="../277643/index.html">Load testing - product quality assurance stage</a></li>
<li><a href="../277645/index.html">Amelisa. Offline and realtime engine for React and Mongo</a></li>
<li><a href="../277649/index.html">50 shades of paranoia or how to store passwords without saving</a></li>
<li><a href="../277655/index.html">Access MySQL data from a UWP application without using services</a></li>
<li><a href="../277657/index.html">Your cloud hosting in 5 minutes. Part 0: Virtualization</a></li>
<li><a href="../277663/index.html">What we should build LVM (principle of operation, performance, Thin Provision)</a></li>
<li><a href="../277665/index.html">Alternative to native support module in JIRA</a></li>
<li><a href="../277669/index.html">Java.util.concurrent. * Synchronizer reference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>