<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ArduPilot for beginners. Installation and configuration on BeagleBone Blue</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We with a team ( which you can join ) like-minded people from Habr are developing a robot for collecting golf balls at the driving range . This is a h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ArduPilot for beginners. Installation and configuration on BeagleBone Blue</h1><div class="post__text post__text-html js-mediator-article">  We with a team ( <b>which you can join</b> ) like-minded people from Habr are developing a <a href="https://habr.com/post/421467/">robot for collecting golf balls at the driving range</a> .  This is a highly specialized service robot, so we are planning to simultaneously develop a single hardware and software system that could later be used as a basis for other service robots and <b>UGVs</b> . <br><br><img src="https://habrastorage.org/webt/3x/wy/of/3xwyof39bhwkwbvvqoyjqmxdmay.jpeg"><br><br>  <a href="https://habr.com/post/429522/">In the last post,</a> we described why we stopped at this software.  When setting up our project, we used the <a href="https://github.com/imfatant/test">information from the article</a> .  Actually, here we present the translation of this brief guide, perhaps for someone it will be useful and help you make your first or next robot. <br><a name="habracut"></a><br>  Before I begin, I want to emphasize that it is worth using BeagleBone Blue (She is still blue).  As a rule, we will attach quite a lot of peripherals associated with navigation, and they will not work properly without enough power. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Part 1. Preparing BeagleBone </h2><br>  Go to <a href="https://rcn-ee.net/rootfs/bb.org/testing/">https://rcn-ee.net/rootfs/bb.org/testing/</a> and select the directory with the latest date.  Then open the <b>stretch-console</b> subdirectory.  Here you will see several files.  Download a file called Something like <b>'bone-debian-VV-console-armhf-20YY-MM-DD-1gb.img.xz'</b> .  This is the minimum distribution of Debian, containing only the most necessary.  An alternative is the "IoT" image (IoT = Internet of Things), which comes with additional software and can make work more comfortable if you are new to Linux.  It is available from the same site. <br><br>  We use: <a href="">https://rcn-ee.net/rootfs/bb.org/testing/2018-10-07/stretch-console/bone-debian-9.5-console-armhf-2018-10-07-1gb.img .xz</a> . <br><br>  Next, you will need to flash the image on the microSD card.  Whether you use Linux or Windows, I highly recommend a program called Etcher for this task ( <a href="https://etcher.io/">https://etcher.io/</a> ). <br><br>  Now you can download BeagleBone Blue from the microSD card.  It is beyond the scope of this document to describe in detail all methods of interaction, but often this is achieved by connecting via a micro USB cable either via SSH (to 'debian@192.168.7.2', password 'temppwd') or via the COM port ( user for Debian ', password' temppwd) in a program like minicom or PuTTY.  This is a connection to the Linux console through the COM port.  UART1 on BBB builds always zabinden console, first U-boot, and then Linux.  More information can be found here: <a href="https://beagleboard.org/blue">https://beagleboard.org/blue</a> <br><br>  BeagleBone drivers come with Windows 10. In BBB Linux, as a universal USB COM port, it may not pick up.  If you have problems, try the following: <br><br><pre><code class="bash hljs">sudo -s cat &gt;/etc/udev/rules.d/73-beaglebone.rules &lt;&lt;EOF ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"usb"</span></span>, ENV{DEVTYPE}==<span class="hljs-string"><span class="hljs-string">"usb_interface"</span></span>, ATTRS{idVendor}==<span class="hljs-string"><span class="hljs-string">"0403"</span></span>, ATTRS{idProduct}==<span class="hljs-string"><span class="hljs-string">"a6d0"</span></span>, DRIVER==<span class="hljs-string"><span class="hljs-string">""</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/sbin/modprobe -b ftdi_sio"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"drivers"</span></span>, ENV{DEVPATH}==<span class="hljs-string"><span class="hljs-string">"/bus/usb-serial/drivers/ftdi_sio"</span></span>, ATTR{new_id}=<span class="hljs-string"><span class="hljs-string">"0403 a6d0"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"00"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-jtag"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"01"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-serial"</span></span> EOF udevadm control --reload-rules <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Hope you are logged in at the command prompt now.  We will start by allowing the debian user to run sudo without having to enter a password every (subsequent) time: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"debian ALL=(ALL) NOPASSWD: ALL"</span></span> | sudo tee -a /etc/sudoers.d/debian &gt;/dev/null</code> </pre><br>  The next job is to upgrade and install software using an available internet connection, so it's time to set up connman for Wi-Fi access.  I do it because it will facilitate the work in the future.  First, write down your router's SSID and WiFi password.  Then enter the following: <br><br><pre> <code class="bash hljs"> sudo -s connmanctl services | grep <span class="hljs-string"><span class="hljs-string">'&lt;your SSID&gt;'</span></span> | grep -Po <span class="hljs-string"><span class="hljs-string">'wifi_[^ ]+'</span></span></code> </pre><br>  The answer will look something like this: 'wifi_38d279e099a8_4254487562142d4355434b_managed_psk'.  If you can't see anything, try again ‚Äî you probably made a typo. <br><br>  Now, using this network ID, we are going to enter the file directly from the keyboard (stdin) using cat, one line at a time: <br><br><pre> <code class="bash hljs"> cat &gt;/var/lib/connman/wifi.config [service_&lt;your <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>&gt;] Type = wifi Security = wpa2 Name = &lt;your SSID&gt; Passphrase = &lt;your WiFi password&gt;</code> </pre><br>  Important!  Before Ctrl + C, be sure to press Enter, otherwise the entire current line will be lost. <br>  Press Ctrl-C to exit, and then type: exit <br><br>  A prominent green LED will light up, meaning that Wi-Fi is on.  BBBlue is connected to the router, and its IP address on your Wi-Fi network can be found using: <br><br><pre> <code class="bash hljs">ip addr show wlan0</code> </pre><br>  If for any reason you cannot request BBBlue directly, use other methods to find its IP address utilities such as nmap (sudo nmap 192.168.0.0/24) or by logging into your router and looking there. <br><br>  Now try to connect over SSH using its Wi-Fi IP address.  Remember that 192.168.7.2 will also work. <br><br>  If you can't get WiFi to work with connman, or you just don't want to use connman, you can use the following method.  First, enter: sudo systemctl disable connman.  Then, with your SSID and WiFi password, edit / etc / network / interfaces <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface. auto lo iface lo inet loopback # WiFi w/ onboard device (dynamic IP). auto wlan0 iface wlan0 inet dhcp wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" dns-nameservers 8.8.8.8 1.1.1.1 # Ethernet/RNDIS gadget (g_ether). # Used by: /opt/scripts/boot/autoconfigure_usb0.sh iface usb0 inet static address 192.168.7.2 netmask 255.255.255.252 network 192.168.7.0 gateway 192.168.7.1</span></span></code> </pre><br>  Now restart BBBlue with: <b>sudo reboot</b> <br><br>  After logging in, enter: sudo ifup wlan0.  The green LED should light up. <br><br>  If you want BB to have a static IP (say, 192.168.0.99), change "# WiFi w / onboard device (dynamic IP)." To read the / etc / network / interfaces section: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># WiFi w/ onboard device (static IP). auto wlan0 iface wlan0 inet static wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" address 192.168.0.99 # &lt;--- The desired static IP address of the BBBlue. netmask 255.255.255.0 gateway 192.168.0.1 # &lt;--- The address of your router. dns-nameservers 8.8.8.8 1.1.1.1</span></span></code> </pre><br>  Update and install all the necessary support programs: <br><br><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y dist-upgrade sudo apt-get install -y cpufrequtils git</code> </pre><br>  Update scripts: cd / opt / scripts &amp; &amp; git pull <br><br>  <b>Real-time kernel currently has errors!</b>  <b>Use the following fix: Specify Ti real-time kernel 4_4.</b>  <b>Do not use 4_14.</b> <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/update_kernel.sh --ti-rt-channel --lts-4_4 sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt</code> </pre><br>  Finally, copy am335x-bone blue.dtb (from the bin directory in this repository) to / boot / dtbs/4.4.113-ti-rt-r149 <br><br>  Install the script on autorun <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/#dtb=/dtb=am335x-boneblue.dtb/g'</span></span> /boot/uEnv.txt</code> </pre><br>  Set the frequency <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/GOVERNOR="ondemand"/GOVERNOR="performance"/g'</span></span> /etc/init.d/cpufrequtils</code> </pre><br>  Configuring bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Configuring bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Disable Bluetooth (optional) <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> bb-wl18xx-bluetooth.service</code> </pre><br>  Expand the existing microSD card section (/ dev / mmcblk0p1): <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/grow_partition.sh</code> </pre><br>  Reboot now: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre><br><h2>  Part 2. Installing ArduPilot on BeagleBone </h2><br>  When BeagleBone reboots, we need to create some text files.  First, improving the environment configuration file, / etc / default / ardupilot: <br>  <i>(Hint: enter sudoedit / etc / default / ardupilot and insert your own target IP address, for example 192.168.0.13)</i> <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-C /dev/ttyO1"</span></span> TELEM2=<span class="hljs-string"><span class="hljs-string">"-A udp:&lt;target IP address&gt;:14550"</span></span> GPS=<span class="hljs-string"><span class="hljs-string">"-B /dev/ttyS2"</span></span></code> </pre><br>  This is a fairly typical configuration. <br><br>  This is the launch option -C maps ArduPilot's "Telem1" serial port (SERIAL1, default 57600) for UART1 in BBBlue.  For example, I have an RFDesign radio modem 868x connected to UART1.  This is a bi-directional data link with my drone.  It sends various telemetry data to the base station and receives commands and RTK differential corrections from the base station. <br><br>  This is the launch option -A maps ArduPilot's "Console" serial port (SERIAL0, default is 115200) with the protocol, target IP address, and a selectable port number.  For example, it allows me to receive MAVLink data received via Wi-Fi for test purposes.  Really useful, especially since data can immediately go to Mission Planner and QGroundControl. <br><br><img src="https://habrastorage.org/webt/3d/d7/m1/3dd7m1ilxlbkd3elqxnddq_1rcm.jpeg" alt="image"><br><br>  This is the launch option for -B maps ArduPilot's ‚ÄúGPS‚Äù serial port (SERIAL3, default 57600) with Uart2 BBBlue (UART, vaguely marked 'GPS' on the board itself).  For example, I have a U-blox NEO-M8P connected to UART2. <br><br>  There are other possibilities - there are other launch parameters, with predefined port speeds and the ports themselves: <br><br><pre> <code class="bash hljs">Switch -A --&gt; <span class="hljs-string"><span class="hljs-string">"Console"</span></span>, SERIAL0, default 115200 Switch -B --&gt; <span class="hljs-string"><span class="hljs-string">"GPS"</span></span>, SERIAL3, default 57600 Switch -C --&gt; <span class="hljs-string"><span class="hljs-string">"Telem1"</span></span>, SERIAL1, default 57600 Switch -D --&gt; <span class="hljs-string"><span class="hljs-string">"Telem2"</span></span>, SERIAL2, default 38400 Switch -E --&gt; Unnamed, SERIAL4, default 38400 Switch -F --&gt; Unnamed, SERIAL5, default 57600</code> </pre><br>  See the official ArduPilot documentation for more details on the various serial ports: <a href="http://ardupilot.org/plane/docs/parameters.html%3Fhighlight%3Dparameters">http://ardupilot.org/plane/docs/parameters.html?highlight=parameters</a> <br><br>  Next, we will create the ArduPilot systemd service files, one for the ArduCopter, /lib/systemd/system/arducopter.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduCopter Service After=networking.service StartLimitIntervalSec=0 Conflicts=arduplane.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arducopter <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  One for ArduPlane, /lib/systemd/system/arduplane.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduPlane Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arduplane <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  One for ArduRover, /lib/systemd/system/ardurover.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduRover Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/ardurover <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  What about AntennaTracker, too?  Create /lib/systemd/system/antennatracker.service: <br><br><pre> <code class="bash hljs">[Unit] Description=AntennaTracker Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service ardurover.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/antennatracker <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Moving to the sudo mkdir -p / usr / bin / ardupilot folder <br><br>  Create a hardware configuration file for ArduPilot, / usr / bin / ardupilot / aphw, which runs before the executable files. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # aphw # ArduPilot hardware configuration. /bin/echo 80 &gt;/sys/class/gpio/export /bin/echo out &gt;/sys/class/gpio/gpio80/direction /bin/echo 1 &gt;/sys/class/gpio/gpio80/value /bin/echo pruecapin_pu &gt;/sys/devices/platform/ocp/ocp:P8_15_pinmux/state</span></span></code> </pre><br>  Lines 5-7 include the power supply to the BBBlue + 5V servo, i.e. when you are using the servos.  No need for ESC. <br><br>  Line 8 includes the PRU. <br><br>  Use sudo chmod 0755 / usr / bin / ardupilot / aphw to set permissions for this file. <br><br>  Almost got it!  Now you should get the latest ArduCopter, ArduPlane, etc. executable files created specifically for the Arm BBBlue architecture and put them in the / usr / bin / ardupilot directory.  Mirko Denecke downloaded them on his website here: <a href="http://bbbmini.org/download/blue/">http://bbbmini.org/download/blue/</a> <br><br>  Copy to this repository: <a href="https://github.com/imfatant/test/blob/master/bin/">https://github.com/imfatant/test/blob/master/bin/</a> <br><br>  Remember to set permissions: sudo chmod 0755 / usr / bin / ardupilot / a * <br><br>  If you find that you need to compile from source, do not worry - it is not so difficult.  In addition, this means that you can create your own ArduPilot software. <br><br>  Picking them up at the BBBlue will take too much time.  Patrick Poirier explains the BBBMINI process (based on black BeagleBone) on his website.  Here is a BBBlue-specific procedure, assuming that you have completed all the steps so far and are in the / home / debian directory: <br><br><pre> <code class="bash hljs">sudo apt-get install g++ make pkg-config python python-dev python-lxml python-pip sudo pip install future git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ArduPilot/ardupilot <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ardupilot git checkout Copter-3.6 <span class="hljs-comment"><span class="hljs-comment"># &lt;-- For ArduCopter. git submodule update --init --recursive ./waf configure --board=blue # &lt;-- BeagleBone Blue. ./waf sudo cp ./build/blue/bin/a* /usr/bin/ardupilot</span></span></code> </pre><br>  Patrick also provides instructions for cross-compiling them on a relatively powerful desktop x64 PC in Ubuntu, which is much, much faster. <br><br>  Depending on which version of software you need <br>  sudo systemctl enable arducopter.service <br>  or <br>  sudo systemctl enable arduplane.service <br>  or <br>  sudo systemctl enable ardurover.service <br>  or <br>  sudo systemctl enable antennatracker.service <br><br>  After rebooting, your ArduPilot should start automatically.  You will see a flashing red LED! <br><br>  You can familiarize yourself with the systemctl ( <a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">https://www.freedesktop.org/software/systemd/man/systemctl.html</a> ).  Some useful command examples are: <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> ... sudo systemctl start ... sudo systemctl stop ...</code> </pre><br><h3>  Part 3. Connection of peripheral devices </h3><br><img src="https://habrastorage.org/webt/fx/xo/ae/fxxoaey0otck_4ti6yl0p1dzbgu.jpeg" alt="image"><br><br>  The basic minimum configuration is likely to include: <br><br><ul><li>  R / C receiver. </li><li>  GPS receiver (with or without integrated compass). </li><li>  Radio modem for bidirectional data transmission channel, especially over long distances. </li><li>  (BBBlue's built-in WiFi is great for debugging and testing at close range if 2.4 GHz is available, but a dedicated bidirectional data channel is recommended for something more interesting. Also keep in mind the type and placement of the antennas that use all these elements. ) </li></ul><br>  A few words about the connectors, cables and tools that you need.  I am going to give a few recommendations, otherwise, if you are a beginner, you can spend a lot of time, effort and money.  Mainly used connector type JST-SH 1.0 mm.  You should buy several female connectors in 4 and 6 position sizes and crimp contacts.  Then get a couple of meters of wires in different colors. <br><br>  So back to connecting peripheral devices: <br><br><img src="https://habrastorage.org/webt/h4/mq/7k/h4mq7kn51qxgbc4orkk4ghmluoo.jpeg"><br><br>  R / C receiver: can be turned off at any + 5V contact and GND.  All that remains is to connect the SBUS output of the receiver, DSM output or PPM output to one of the two SBUS pins marked in the diagram.  The following receivers have been tested and work: <br><br>  FrSky ( <a href="https://www.frsky-rc.com/">https://www.frsky-rc.com/</a> ): R-XSR, XR4SB, X6R, X8R, R9 Slim and R9 Mini (both EU LBT 868 MHz and Universal 915 MHz firmwares). <br><br>  Spektrum ( <a href="https://www.spektrumrc.com/">https://www.spektrumrc.com/</a> ): AR7700 DSMX with PPM / SRXL / Remote Rx. <br><br>  TBS ( <a href="http://team-blacksheep.com/">http://team-blacksheep.com/</a> ): 'Full' Crossfire with Nano Rx (Rx set to SBUS mode). <br><br>  By the way, they talk a lot about ‚Äúturned SBUS‚Äù.  In fact, SBUS is just a serial data transfer protocol that Futaba came up with and copied FrSky.  He turned upside down compared to the "standard" UART.  Fortunately, the Ardupilot Blue expects this inverted SBUS signal, so there is no need for a signal inverter. <br><br>  GPS receiver: most people use u-blox receivers, especially the NEO-M8N and NEO-M8P.  NEO-M8N is cheap and available from Chinese companies such as HobbyKing, usually in the form of a disk.  Conveniently, these they contain the receiver itself, a very small ceramic antenna of the patch, and often include a compass.  While BBBlue already has a built-in compass (AKM AK8963), the ArduPilot can be configured to use this ‚Äúexternal‚Äù compass instead of its own to eliminate pickups. <br><br>  A (much) more expensive alternative to the NEO-M8N is the NEO-M8P.  This receiver supports a mode of operation known as ‚ÄúRTK‚Äù, or kinematic in real time, which can achieve positioning accuracy of a few centimeters in real time.  However, this type of presentation comes at a price about 10 times as expensive as the NEO-M8N, and this is without a base station.  Later in the guide I will devote a special section of the M8P. <br><br>  I2C ArduPilot configuration file: /var/APM/{ArduCopter.stg,ArduPlane.stg,APMrover2.stg,AntennaTracker.stg} <br><br><pre> <code class="bash hljs">sudo apt-get install i2c-tools sudo i2cdetect -r -y 0 sudo i2cdetect -r -y 1 sudo i2cdetect -r -y 2</code> </pre><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 2 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- 0c -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 70: -- -- -- -- -- -- 76 --</code> </pre><br>  68 = InvenSense MPU-9250 IMU (onboard), 0c = AKM AK8963 compass (onboard), 76 = Bosch BMP280 barometer (onboard). <br><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 1 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 1e -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 70: -- -- -- -- -- -- -- --</code> </pre><br>  1e = Honeywell HMC5843 compass (external) - often integrated into u-blox NEO-M8N-based GPS modules. <br><br><h2>  Getting Started with Ground Management Station Software (GCS) </h2><br>  Download any mission planner (http://firmware.ardupilot.org/Tools/MissionPlanner/MissionPlanner-latest.msi) for Windows or QGroundControl (http://qgroundcontrol.com/) for Linux and Windows.  Both of these programs will connect to MAVLink data streams coming over the network (for example, via UDP port 14550) or via COM ports. <br><br><h2>  Additionally </h2><br>  Equipping your drone-based bbblue with a Bluetooth speaker can be fun, provided that the Bluetooth RF transmissions do not interfere with any other systems.  BlueZ / PulseAudio / ALSA has a lot of information, but fortunately, it all comes down to something rather simple. <br><br>  a) first install the necessary software (using the console or an IoT image): <br><br><pre> <code class="bash hljs"> sudo apt-get install -y bluetooth pulseaudio pulseaudio-module-bluetooth alsa-utils</code> </pre><br>  b) Enable Bluetooth (if disabled): sudo systemctl enable bb-wl18xx-bluetooth.service <br><br>  c) Edit /etc/pulse/default.pa: <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">### Automatically suspend sinks/sources that become idle for too long # load-module module-suspend-on-idle</span></span></code> </pre><br>  d) Reboot: sudo reboot <br><br>  e) After loading BBBlue, turn on the Bluetooth column in connection mode: <br><br><pre> <code class="bash hljs"> bluetoothctl scan on agent on default-agent pair &lt;Bluetooth speaker<span class="hljs-string"><span class="hljs-string">'s MAC address&gt; # &lt;--- eg AB:58:EC:5C:0C:03 connect &lt;Bluetooth speaker'</span></span>s MAC address&gt; <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Sometimes unnecessary. trust &lt;Bluetooth speaker's MAC address&gt; scan off exit</span></span></code> </pre><br>  f) Finally: <br><br><pre> <code class="bash hljs"> pulseaudio --start <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connect &lt;Bluetooth speaker's MAC address&gt;"</span></span> | bluetoothctl pactl list <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Use this to check that your Bluetooth speaker has been picked up by PulseAudio. pacmd set-card-profile 0 a2dp_sink aplay /usr/share/sounds/alsa/Front_Center.wav</span></span></code> </pre><br>  That's all!  By the way, if you're going to use a speech synthesizer, I recommend Festival. <br><br>  If you want to help - please write to me in the LAN or <a href="https://vk.com/slavagolitsin">VC</a> , <a href="https://www.facebook.com/slavagolitsin">FB</a> . <br><br><img src="https://habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg" alt="image">  <a href="">habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg</a> <br><br>  Thank you for reading, ask and criticize us completely. </div><p>Source: <a href="https://habr.com/ru/post/429510/">https://habr.com/ru/post/429510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429500/index.html">"It's time to do business" finally flew</a></li>
<li><a href="../429502/index.html">Is it worth developing cross-competences</a></li>
<li><a href="../429504/index.html">How to call audio methods vk</a></li>
<li><a href="../429506/index.html">Looking under the hood of the new Gmail</a></li>
<li><a href="../429508/index.html">Summary of the report "How to become a cool specimen for database" (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../429512/index.html">Digital events in Moscow from 12 to 18 November</a></li>
<li><a href="../429514/index.html">Microsoft told how to solve the problem of data security on SSD with "leaky" hardware encryption</a></li>
<li><a href="../429522/index.html">Designing a service robot. Problem statement, solution architecture</a></li>
<li><a href="../429524/index.html">Correct JSON API or JSON RPC</a></li>
<li><a href="../429528/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ338 (November 5 - 11, 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>