<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we broke up mobile Lenta.ru to the speed of light</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="AMP - for sure, you have already heard about this technology promoted by Google. It would seem that another fashionable technology for hipsters, which...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we broke up mobile Lenta.ru to the speed of light</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d5a/821/322/d5a821322a4b49b0a440763048500c54.jpg" alt="image"><br><br>  AMP - for sure, you have already heard about this technology promoted by Google.  It would seem that another fashionable technology for hipsters, which everyone will soon forget.  However, in reality, this feature is already running in the production of a significant number of news sites, including such giants as the Guardian, Times, Washington Post, and so forth, and so on.  A short story about AMP buns was already on the pages of ‚ÄúHabra‚Äù, and I would like to focus in a little more detail on how to incorporate this into the project, and what kind of profit you can actually get. <br><a name="habracut"></a><br><br><h2>  Very briefly on how this works. </h2><br>  AMP is a technology that allows you to speed up the loading of mobile pages.  At its core, this is the same HTML, but not just HTML, but slyly designed according to special rules.  The page is rendered using a special script (AMP runtime), which takes care of rendering optimization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Execution of other scripts on the page is prohibited so that their changes in DOM will not prevent us from optimizing.  This does not mean that your pages will not be interactivity.  It can be done, but again by special rules (for example, in a special component). <br>  In addition, when parsing, the Google bot detects AMP pages, caches their contents and will return them faster in the future. <br><br>  In the issue of Google AMP-resources are visible in a special carousel at the top of the page. <br><br><img src="https://habrastorage.org/files/dbf/3b7/066/dbf3b70666544bceb5fab3dd63ee3f93.png"><br><br>  If we talk about the automatic redirect to the amp-version with a direct access to the link, then browser support for amp-pages and automatic transition to them has not yet been implemented, but is only expected.  AMP is good for content pages where there are no significant number of behavioral scripts (however, we can implement various interactive infographics, mini-games, etc. inside the iframe). <br><br>  All of the above led us to the intention to make AMP at home.  And that's how it was: <br><br><h2>  Step 1 - Create New Templates </h2><br>  On the backend we use Rails, as a template engine - Slim.  First of all, we create new paths in routes.rb for entities that we are interested in (in this case it will be news and the article is the main content of our site).  It does not matter in principle what kind of address the amp version of the pages will have - it can be both a subdomain of amp.youpage.com/article, and, for example, youpage.com/article/amp, if only the scheme is uniform. <br><br>  Then we create new templates for rendering the AMP version of our pages, and boldly remove all unnecessary from them. <br><br>  Under the superfluous means the following things: <br>  - Javascript code <br>  - Inline-styles <br>  - Prohibited tags in amp-html, such as: object, frame, embed, select, form, input, option, textarea (however, the input specification may still change - follow the development of the project.) <br><br>  In general, it is necessary to cut out everything that complicates the rendering of the page or can block it. <br><br><pre><code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amp_strip_tags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> text .gsub(<span class="hljs-regexp"><span class="hljs-regexp">%r{&lt;img(.+?)\/&gt;}</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) .gsub(<span class="hljs-regexp"><span class="hljs-regexp">%r{&lt;iframe.+?\/iframe&gt;}m</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) .gsub(<span class="hljs-regexp"><span class="hljs-regexp">%r{&lt;script.+?&lt;\/script&gt;}m</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Particular attention would be paid to the head of our pages.  It should have a fairly clearly defined structure, like this: <br><br><div class="spoiler">  <b class="spoiler_title">Bed sheet html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äúviewport</span></span></span><span class="hljs-tag">" </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùwidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">device-width,minimum-scale</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">1,initial-scale</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">1‚Äù</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"canonical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{   }"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amp-custom</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined">{ }</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/ld+json"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined">{...}</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  FOUC --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amp-boilerplate</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-webkit-animation</span></span></span><span class="css">:-amp-start </span><span class="hljs-number"><span class="css"><span class="hljs-number">8s</span></span></span><span class="css"> </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">steps</span></span></span><span class="css">(1,end) </span><span class="hljs-number"><span class="css"><span class="hljs-number">0s</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1</span></span></span><span class="css"> normal both; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-moz-animation</span></span></span><span class="css">: -amp-start </span><span class="hljs-number"><span class="css"><span class="hljs-number">8s</span></span></span><span class="css"> </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">steps</span></span></span><span class="css">(1,end) </span><span class="hljs-number"><span class="css"><span class="hljs-number">0s</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1</span></span></span><span class="css"> normal both; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-ms-animation</span></span></span><span class="css">:-amp-start </span><span class="hljs-number"><span class="css"><span class="hljs-number">8s</span></span></span><span class="css"> </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">steps</span></span></span><span class="css">(1,end) </span><span class="hljs-number"><span class="css"><span class="hljs-number">0s</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1</span></span></span><span class="css"> normal both; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">animation</span></span></span><span class="css">:-amp-start </span><span class="hljs-number"><span class="css"><span class="hljs-number">8s</span></span></span><span class="css"> </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">steps</span></span></span><span class="css">(1,end) </span><span class="hljs-number"><span class="css"><span class="hljs-number">0s</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">1</span></span></span><span class="css"> normal both; } @-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">webkit</span></span></span><span class="css">-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">keyframes</span></span></span><span class="css"> -amp-start{ </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">from</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:hidden }</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">to</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:visible } } @-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">moz</span></span></span><span class="css">-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">keyframes</span></span></span><span class="css"> -amp-start{</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">from</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:hidden}</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">to</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:visible}} @-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">ms</span></span></span><span class="css">-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">keyframes</span></span></span><span class="css"> -amp-start{</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">from</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:hidden}</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">to</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:visible}} @-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">o</span></span></span><span class="css">-</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">keyframes</span></span></span><span class="css"> -amp-start{</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">from</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:hidden}</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">to</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:visible}} @</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">keyframes</span></span></span><span class="css"> -amp-start{</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">from</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:hidden}</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">to</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">visibility</span></span></span><span class="css">:visible}} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">noscript</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amp-boilerplate</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-webkit-animation</span></span></span><span class="css">:none;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-moz-animation</span></span></span><span class="css">:none;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">-ms-animation</span></span></span><span class="css">:none;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">animation</span></span></span><span class="css">:none}</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">noscript</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.ampproject.org/v0.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> {amp-components scripts}</code> </pre><br></div></div><br>  Please note that all scripts are connected with the async attribute. <br><br><h2>  Step 2 - Shovel Styles </h2><br>  Depending on the implementation, we can make the AMP version as similar to a normal mobile one as possible, or completely redesign it.  We chose the first path.  So, for CSS processing we use Stylus, and BEM-style naming.  On the mobile version, we have about the following set of files: <br><br><div class="spoiler">  <b class="spoiler_title">Long list</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/462/d35/156/462d3515612d493faae2fc66428ea44f.png"><br></div></div><br>  Obviously, we will not need some of them.  Therefore, not all will be included in the style sheet for AMP, and besides, we will probably need some corrections. <br>  In particular, inside the styles can not be applied: <br>  - Universal selector * and: not () <br>  - overflow: scroll, overflow: auto (you can‚Äôt do scrolling blocks) <br>  - filter <br>  -! Important <br><br>  This is how we get the root amp.styl: <br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'reset'</span></span> @import <span class="hljs-string"><span class="hljs-string">'variables'</span></span> @import <span class="hljs-string"><span class="hljs-string">'mixins'</span></span> @import <span class="hljs-string"><span class="hljs-string">'fonts'</span></span> @import <span class="hljs-string"><span class="hljs-string">'general'</span></span> @import <span class="hljs-string"><span class="hljs-string">'amp/icons'</span></span> @import <span class="hljs-string"><span class="hljs-string">'amp/blocks/**/*.styl'</span></span> @import <span class="hljs-string"><span class="hljs-string">'elements/button'</span></span> _apply_media_cache()</code> </pre><br>  Having gotten rid of the above, and having corrected the style design as necessary, the resulting styles should be displayed inside the resulting page.  The webpack builder is ours, and the resulting css file is inserted into the template via such a helper: <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amp_stylesheet_content</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css_file_path</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rails</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">root</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">join</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'public'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>.to_s + URI(stylesheet_path(<span class="hljs-string"><span class="hljs-string">'amp.css'</span></span>)).path File.read(css_file_path) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Inside the head: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amp-custom</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> =amp_stylesheet_content.html_safe </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  (In this case, we use raw html, since slim does not know how to create attributes with no values ‚Äã‚Äãat standard settings) <br><br>  It is important that the size of the style file does not exceed 50 kB.  In general, this is enough, besides, do not forget about the minification.  We took the style of 35 KB. <br><br><h2>  Step 3 - Media Content Must Be Inside AMP Components </h2><br>  Basically, the media content of the news site can be divided into 4 categories: <br>  - Images (perhaps a series of images - galleries) <br>  - Video <br>  - Social network widgets <br>  - Special interactive (for example, mini-games, infographics, etc.) <br><br>  In order to display all of this, various components are provided in AMP. <br><br>  So: for images we have a picture similar to HTML5 picture amp-img: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"420px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"280px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://icdn.lenta.ru/images/2016/02/11/12/20160211121428311/pic_8dc2c0121a05e635e509d1981d4fda63.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"responsive"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  As well as amp-carousel (suitable not only for images, but also for other content) <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-carousel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">400</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-img1.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">400</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-img2.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">400</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-img3.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">400</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-carousel</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  and amp lightbox (normal lightbox) <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tap:my-lightbox"</span></span></span><span class="hljs-tag">&gt;</span></span>  !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-lightbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-lightbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nodisplay"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lightbox"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my-full-image.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">800</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tap:my-lightbox.close"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-lightbox</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  For video - amp-video <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">400</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">300</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://supervideo.com/videos/myvideo.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">poster</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fallback-poster.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fallback</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Ooops! Sorry, your browser doesn't support HTML5 video!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foo.mp4"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/webm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"foo.webm"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And a diverse set of widgets for popular social networks (unfortunately, VK is not among them yet). <br><br>  For replacement it is convenient to use your own helper: <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amp_img</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cloud_unit, version, params={})</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cloud_unit.versions.present? &amp;&amp; cloud_unit.versions[version.to_s].present? version = cloud_unit.versions[version.to_s] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cloud_unit.caption.present? alt = cloud_unit.caption <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> cloud_unit.alt.present? alt = cloud_unit.alt <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> alt = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> attrs = { <span class="hljs-symbol"><span class="hljs-symbol">alt:</span></span> strip_tags(alt), <span class="hljs-symbol"><span class="hljs-symbol">width:</span></span> version.width.to_s + <span class="hljs-string"><span class="hljs-string">'px'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">height:</span></span> version.height.to_s + <span class="hljs-string"><span class="hljs-string">'px'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">src:</span></span> cloud_url(version.rel_url), <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addclass</span></span></span><span class="hljs-class">], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">layout</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">layout</span></span></span><span class="hljs-class">] </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#sizes: "(min-width: 650px) 50vw, 90vw" } content_tag('amp-img', nil, attrs) end end</span></span></span></span></code> </pre><br><br>  In order to make it easier for the editor to work with content, there are so-called in the admin panel.  ‚ÄúWidgets‚Äù are boxes where you can optionally embed various content.  For example, to insert -instagram or -facebook of a post it is enough for an editor to insert a link to it, from which a full-fledged widget code is then formed.  We need new views for amp widgets, which is quite simple - regular values ‚Äã‚Äãpulled out (for example, the youtube-roller code) are inserted into the template of the corresponding amp component, which is then displayed on the page. <br><br>  In addition, you need to connect the libraries of the required components inside the head. <br><br>  The important point to focus on is that in order to speed up the rendering, the size of the media elements must be determined in advance, so we explicitly set the width and height (real) for the images and widgets. <br><br>  If we want to inject some very special content into the page, then we can use the amp-iframe and implement any of the most bizarre behavior in it, without being limited to using js. <br><br>  There are a number of restrictions on its use - for example, the content inside the amp-iframe can be served only via https, in addition, the amp-iframe should not be located in the first screen.  Well, of course, the content can not access the DOM page, and the more so as to somehow change it.  Everything that happens in the sandbox - will remain in the sandbox. <br>  Loading of elements occurs asynchronously, so, most likely, in case of a bad connection, you will not first see their contents, but only placeholder (which, by the way, can be customized or turned off altogether).  But after the content is loaded, it will become visible without any FOUC! <br>  Instead of the social button widgets, you have to use the usual noscript option.  Here, for example, for VK: <br><br><pre> <code class="html hljs xml">.b-socials__button ab-socials__image.b-socials__image-vk href="http://vk.com/share.php?url=#{extlink}" target='_blank' title=("   ")</code> </pre><br><br><h2>  Step 4 - Micromarking </h2><br>  For AMP pages, Google strongly requires the introduction of micromarking.  In fact, a significant part of the sites already use this markup, but if you don‚Äôt have one yet, then it's time to start! <br>  The schema.org is used as a dictionary, in this case, the essence of the NewsArticle perfectly fits our goals.  You can insert markup into a page using JSON-LD (in my opinion, the most convenient way) or using microdata - special attributes that are set for tags with specific content.  All the necessary data for this, most likely, you already have, and it remains only to substitute them into the template. <br><br><h2>  Step 5 - Analytics and Advertising </h2><br>  As you probably noticed, any large project begins to overgrow with various counters and metrics, like a ship - with seashells, with a similar action - slows it down.  In order to somehow deal with this undesirable phenomenon, we can use the amp-pixel component, which, as the name implies, provides the functionality of a regular counter ‚Äî sends a request to the specified address when the page is displayed. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-pixel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://foo.com/pixel?RANDOM"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-pixel</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Very convenient - instead of RANDOM, a random number will be substituted. <br>  There is also a native component of Google Analytics - amp-analytics <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-analytics</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"analytics1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"googleanalytics"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/json"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">{ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"vars"</span></span></span><span class="actionscript">: { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"account"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"UA-*******"</span></span></span><span class="actionscript"> }, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"triggers"</span></span></span><span class="actionscript">: { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"trackPageview"</span></span></span><span class="actionscript">: { </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"on"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"visible"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"request"</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"pageview"</span></span></span><span class="actionscript"> } } }</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amp-analytics</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In principle, we decided that it is worth replacing a mountain of counters with one Google Analytics, however, if this option is not allowed for you, then there are possibilities. <br><br>  As far as advertising is concerned, currently, advertising content delivery systems that are widespread in the USA are mainly supported.  To make friends, for example, with adFox, you can do this: get a link to the contents of the banner and place it inside the amp-iframe of a given size.  Thus, advertising will come asynchronously and will never be able to prevent the page from loading. <br><br>  As part of our project, we have not yet implemented advertising in AMP.  Enjoy the freedom :) <br><br><h2>  Step 6 - Checking if everything is good </h2><br>  After you have successfully compiled your AMP versions of the pages, you need to check whether everything meets the specification so that the Google search bot processes them and includes them in the search results. <br><br>  First, right on the local machine or dev server, you can open the checked page with the hash parameter # development = 1, and then look in the developer console. <br><br>  If everything is OK, you will see something like this: <br><br><img src="https://habrastorage.org/files/84a/a22/ca6/84aa22ca61834c05b50ea8a816d5cd17.png"><br><br>  If not, the built-in validator will show where errors are found, and even provide links to documentation: <br><br><img src="https://habrastorage.org/files/fec/9d5/0b3/fec9d50b326546c29cc490231aa66869.png"><br><br>  After you roll out to production, take a look here, and check that the microdata parses normally and has the necessary fields. <br><br>  In addition, in the Google Webmaster tools you can find the ‚ÄúMobile pages‚Äù tab where statistics on the indexed pages are collected, there you can find statistics and information about errors throughout the site, if any, but be careful - indexing it happens quite infrequently (once every few days), so after making changes you have to wait. <br><br><h2>  Speed ‚Äã‚Äãmeasurement </h2><br>  The speed of loading amp versions of pages is much higher, and the worse the quality of the connection, the more noticeable the difference.  In general, we can talk about at least a 2-fold increase in download speed.  Let's compare with the help of <a href="http://tools.pingdom.com/">tools.pingdom.com</a> indicators of a usual mobile page: <br><br><img src="https://habrastorage.org/files/07f/758/cbd/07f758cbdc674a77b9edaec041b2539b.png"><br><br>  and amp versions: <br><br><img src="https://habrastorage.org/files/b7e/3f8/925/b7e3f8925d5e4f7688a19d49401aaf6b.png"><br><br>  The difference, as they say, is obvious.  It is especially interesting to consider the waterfall of loading resources and compare (I will leave this task for interested readers). <br><br>  For details in the nuances I recommend to see the official <a href="https://github.com/ampproject">github of the project</a> and <a href="https://www.ampproject.org/docs/get_started/about-amp.html">documentation</a> . </div><p>Source: <a href="https://habr.com/ru/post/280602/">https://habr.com/ru/post/280602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280584/index.html">Microsoft has confirmed rumors about the integration of the Linux subsystem in Windows 10</a></li>
<li><a href="../280586/index.html">Saving Fragment State (Fragment)</a></li>
<li><a href="../280588/index.html">How to fly free to Paris with a girl and get a development contract</a></li>
<li><a href="../280596/index.html">How I VK Mobile Challenge accepted</a></li>
<li><a href="../280598/index.html">Trends in the development of cloud data centers</a></li>
<li><a href="../280604/index.html">Legend of international avos</a></li>
<li><a href="../280606/index.html">Collection and analysis of the logs of demons in Badoo</a></li>
<li><a href="../280608/index.html">Tuples in programming languages. Part 2</a></li>
<li><a href="../280610/index.html">The tale of Tsar Saltan about the potential of the Laplacian</a></li>
<li><a href="../280614/index.html">Cisco Routermate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>