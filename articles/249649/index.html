<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring Kerio Control Firewall for 3CX Phone System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this manual, we will talk about setting up the Kerio Control firewall to work with the 3CX Phone System. We will analyze the process using the exam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring Kerio Control Firewall for 3CX Phone System</h1><div class="post__text post__text-html js-mediator-article">  In this manual, we will talk about setting up the Kerio Control firewall to work with the 3CX Phone System.  We will analyze the process using the example of Kerio version 8.3.0 build 1988. <br><br>  Typically, Kerio Control works correctly when used as a border gateway for connecting VoIP operators, remote subscribers (STUN) and connecting through the 3CX Tunnel.  The firewall includes functionality for checking SIP and HTTP traffic, but these mechanisms may affect the correct operation of remote 3CX Phone. <br>  Nat type: IP Restricted <br><a name="habracut"></a><br><h4>  So, let's proceed to the setup ... </h4><br>  Open the Kerio Control Web Admin control panel and go to ‚ÄúServices‚Äù: <br><br><img src="https://habrastorage.org/files/6c0/82e/0a0/6c082e0a09584935b6c758670025e47c.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Set the check for ‚ÄúSIP‚Äù to ‚ÄúNone‚Äù. </li><li>  Click ‚ÄúAdd‚Äù to create a new service.  The list of ports that need to be opened here: <a href="http://www.3cx.com/docs/firewall-router-configuration-voip/">http://www.3cx.com/docs/firewall-router-configuration-voip/</a> .  Note that port numbers may depend on the 3CX version. </li></ol><br><img src="https://habrastorage.org/files/3d2/19d/1f3/3d219d1f34824f559d4f81ffe8d4b4dd.png"><br><ol><li>  If the SIP service already exists by default, then Audio (1), 3CX Tunnel (2), HTTP (3) and HTTPs (4) must be added manually. </li></ol><br><img src="https://habrastorage.org/files/917/a2a/e47/917a2ae4711c4b85a05a36472eaff577.png"><br><ol><li>  Collect all services in one group. </li></ol><br><img src="https://habrastorage.org/files/9b6/847/0a0/9b68470a0ce642bfacf4236e888870e5.png"><ol><li>  Save the configuration by clicking ‚ÄúApply‚Äù. </li></ol><br><h4>  NAT setup </h4><br>  Via Kerio Control Web Admin, go to the ‚ÄúTraffic Rules‚Äù section: <br><img src="https://habrastorage.org/files/2e2/2c4/e40/2e22c4e4024a4c39938c63272c7b9952.png"><ol><li>  This is a list of rules.  Click ‚ÄúAdd‚Äù to create a new rule. </li></ol><br><img src="https://habrastorage.org/files/a9b/52e/e20/a9b52ee203a044e296598e6c64558b35.png">  Select "Port mapping" and specify the IP address (1) 3CX Phone System.  In the ‚ÄúService‚Äù field, click ‚ÄúSelect‚Äù (2) and select the ‚Äú3CX Phone System‚Äù service.  Click ‚ÄúNext‚Äù to complete. <br><br><img src="https://habrastorage.org/files/646/892/a18/646892a187cd43a890f17a10abd87e23.png">  A rule will be created and it must be placed so that it is not blocked by other rules. <br><br><br><h4>  Check </h4><br>  To check, run the 3CX Firewall Checker - 3CX Management Console ‚ÄúConfigure&gt;‚Äú Firewall Checker ‚Äù.  All ports should display green. <br><br><h4>  note </h4><br>  If you use this firewall at a remote point in front of an IP phone with STUN, a NAT rule must be created for each IP phone (the ‚ÄúSIP‚Äù check must be disabled).  There may be a situation when there are only outgoing calls, and for incoming calls there may be no voice in both directions.  This may be due to the fact that the firewall first waits for transmission of audio or data from the local network, and only after that allows reception to dynamic NAT.  Depending on the time, it may turn out that 3CX Phone System sends audio to a remote IP phone: RTP port before this unit (using STUN) sends data to the PBX.  Then the incoming stream from the 3CX media server will be blocked by the Firewall, while not allowing other devices on this network to work.  Therefore, NAT rules need to be configured separately for each IP phone. <br><br><h4>  NB </h4><br>  Since this configuration procedure is provided for informational purposes and is not an official manual, we cannot be held responsible for possible security problems that may arise in your network after passing through all the steps of this instruction. </div><p>Source: <a href="https://habr.com/ru/post/249649/">https://habr.com/ru/post/249649/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249639/index.html">KISS - the design principle, containing all other design principles</a></li>
<li><a href="../249641/index.html">Diablo 3 - Resource Bubbles</a></li>
<li><a href="../249643/index.html">New Year star with Wi-Fi based on ESP8266</a></li>
<li><a href="../249645/index.html">Kernel .Net (GC, JIT, interop, ...) in Open Source</a></li>
<li><a href="../249647/index.html">Making a queue of incoming calls with the callback function</a></li>
<li><a href="../249651/index.html">1987 - Exhibition "Computer Science in the Life of the United States"</a></li>
<li><a href="../249653/index.html">Isomorphic BEM</a></li>
<li><a href="../249655/index.html">Simple techniques of reverse engineering UEFI PEI-modules on a useful example</a></li>
<li><a href="../249657/index.html">Let's reinvent the wheel</a></li>
<li><a href="../249659/index.html">Weekly build Vivaldi 1.0.94.2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>