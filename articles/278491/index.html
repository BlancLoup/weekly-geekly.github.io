<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a system of placing objects by level using the blueprint editor. Part 2: Adding a Preview Window</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Dmitry. I create computer games on the Unreal Engine as a hobby. So, today I will continue to create a system of placement of object...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a system of placing objects by level using the blueprint editor. Part 2: Adding a Preview Window</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a3f/fae/b5e/a3ffaeb5ea41434585ff1318ba68d4a1.png" alt="image"><br><br>  Hello, my name is Dmitry.  I create computer games on the Unreal Engine as a hobby.  So, today I will continue to create a system of placement of objects.  After I did it, I thought that adding a preview window would speed up the process of placing objects.  I will tell about it today. <br><a name="habracut"></a><br>  If you have not read the first part, I recommend to do it ( <a href="https://habrahabr.ru/post/277515/">article</a> ).  Here I will give only the code that was changed to save space.  Sources, as always, can be downloaded from the links at the end of the article. <br><br>  First you need to add another tab to the editor window of the CustAssetEditor.cpp file: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TSharedRef&lt;FTabManager::FLayout&gt; StandaloneDefaultLayout = FTabManager::NewLayout(<span class="hljs-string"><span class="hljs-string">"CustomEditor_Layout_2"</span></span>) -&gt;AddArea ( FTabManager::NewPrimaryArea() -&gt;SetOrientation(Orient_Vertical) -&gt;Split ( FTabManager::NewStack() -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>) -&gt;SetHideTabWell(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) -&gt;AddTab(GetToolbarTabId(), ETabState::OpenedTab) ) -&gt;Split ( FTabManager::NewSplitter() -&gt;SetOrientation(Orient_Horizontal) -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>) -&gt;Split ( FTabManager::NewStack() -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.75f</span></span>) -&gt;SetHideTabWell(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) -&gt;AddTab(FCustomEditorTabs::ViewportID, ETabState::OpenedTab) ) -&gt;Split ( FTabManager::NewSplitter() -&gt;SetOrientation(Orient_Vertical) -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.25f</span></span>) -&gt;Split ( FTabManager::NewStack() -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.35f</span></span>) -&gt;SetHideTabWell(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) -&gt;AddTab(FCustomEditorTabs::DetailsID, ETabState::OpenedTab) ) -&gt;Split ( FTabManager::NewStack() -&gt;SetSizeCoefficient(<span class="hljs-number"><span class="hljs-number">0.65f</span></span>) -&gt;SetHideTabWell(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) -&gt;AddTab(FCustomEditorTabs::PreviewID, ETabState::OpenedTab) ) ) ) );</code> </pre> <br>  <b>Important:</b> If you add or remove a tab, you need to change the name of the layer. <br><br>  After that we create a new PreviewViewport object. <br><br><pre> <code class="cpp hljs">TPreviewViewport = SNew(SCustomEditorViewport) .CustomEditor(SharedThis(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) .ObjectToEdit(PropBeingEdited); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCustomEditorViewport</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SEditorViewport<span class="hljs-comment"><span class="hljs-comment">//, public FGCObject { public: SLATE_BEGIN_ARGS(SCustomEditorViewport){} SLATE_ARGUMENT(TWeakPtr&lt;FCustAssetEditor&gt;, CustomEditor) SLATE_ARGUMENT(UMyObject*, ObjectToEdit) SLATE_END_ARGS() void Construct(const FArguments&amp; InArgs); ~SCustomEditorViewport(); void SetParentTab(TSharedRef&lt;SDockTab&gt; InParentTab) { ParentTab = InParentTab; } EVisibility GetToolbarVisibility() const; FReply OnRebildScen(); FReply OnShowPropertyPreview(); void RebildScen(); protected: /** SEditorViewport interface */ virtual TSharedRef&lt;FEditorViewportClient&gt; MakeEditorViewportClient() override; virtual EVisibility OnGetViewportContentVisibility() const override; virtual void OnFocusViewportToSelection() override; virtual TSharedPtr&lt;SWidget&gt; MakeViewportToolbar() override; private: bool IsVisible() const; void DestroyActors(); FName ActorTag; TWeakPtr&lt;FCustAssetEditor&gt; CustomEditorPtr; UMyObject* ObjectToEdit; TWeakPtr&lt;SDockTab&gt; ParentTab; TSharedPtr&lt;class FEditorViewportClient&gt; EditorViewportClient; TSharedPtr&lt;FPreviewScene&gt; PreviewScene; USkyLightComponent* Skylight; UAtmosphericFogComponent* AtmosphericFog; };</span></span></code> </pre><br>  Here the most interesting for us is the MakeEditorViewportClient () method.  In this method, an FEditorViewportClient object is created that needs to pass a pointer to an FPreviewScene (this object was created in the Construct method).  Now, if you get a pointer to the world using this object, and then use it when creating an Actor object, then Actor will appear not in the editor window, but in the preview window. <br><br><pre> <code class="cpp hljs">World = PreviewScene-&gt;GetWorld(); World-&gt;SpawnActor&lt;AStaticMeshActor&gt;(AStaticMeshActor::StaticClass(), FVector(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), FRotator(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre><br>  In the MakeViewportToolbar () method, you guessed it, a preview window toolbar is created.  Here I created two buttons: one updates the preview window, the other displays the properties of this window.  The properties of the preview window are similar to those of TestActor.  These properties are not stored in the PreviewViewport object (because it lives only when the asset editor is open), but in the MyObjekt object (the file MyObjekt.h). <br><br><pre> <code class="cpp hljs">UCLASS() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UCustomEditorViewportProperties</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UObject { GENERATED_BODY() <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: UPROPERTY(EditAnywhere, BlueprintReadWrite) TArray&lt;FRoot&gt; Roots; }; UCLASS(Blueprintable) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UICUSTOM_API</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UMyObject</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UObject { GENERATED_UCLASS_BODY() <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: UPROPERTY(EditAnywhere, Category = <span class="hljs-string"><span class="hljs-string">"My Object Properties"</span></span>) FString Name; <span class="hljs-function"><span class="hljs-function">URootNode* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindRootFromType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ERootType RootType)</span></span></span></span>; UPROPERTY() UEdGraph* UpdateGraph; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> WITH_EDITORONLY_DATA UPROPERTY() UCustomEditorViewportProperties* PreviewViewportProperties; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// WITH_EDITORONLY_DATA };</span></span></span></span></code> </pre><br>  Actually that's all about the preview window.  In addition, for more convenient editing, I added the ability to open the rule editor for nodes by double-clicking on these nodes (you just need to select a rule). <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FCustAssetEditor::OnNodeDoubleClicked(class UEdGraphNode* Node) { ((UCustomNodeBase*)Node)-&gt;DoubleClicke(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> URuleNode::DoubleClicke() { FStreamableManager AssetLoader; TArray&lt;FString&gt; Name; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Rule) { Name.Add(Rule-&gt;GetPathName()); FAssetEditorManager::Get().OpenEditorsForAssets(Name); } }</code> </pre><br>  That's all. <br><br>  Source project <a href="https://cloud.mail.ru/public/E9DC/uKCyH2dzm">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/278491/">https://habr.com/ru/post/278491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278477/index.html">CSS cascading and specificity</a></li>
<li><a href="../278479/index.html">Photo tour of the "cloud" of 1cloud</a></li>
<li><a href="../278481/index.html">April 28 will be the fifth international mobile conference MBLT16</a></li>
<li><a href="../278483/index.html">Special folders. Translation from Richard Siddaway's Blog</a></li>
<li><a href="../278485/index.html">What is bad to be full stack by the enterprise administrator</a></li>
<li><a href="../278493/index.html">Compile SQLCipher for Android x86</a></li>
<li><a href="../278495/index.html">Magic Tensor Algebra: Reboot</a></li>
<li><a href="../278497/index.html">Anti-virus bot for Telegram</a></li>
<li><a href="../278501/index.html">Published records of the conference reports ALM Summit 2016</a></li>
<li><a href="../278503/index.html">JS testing. Karmic webpack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>