<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all! 

 You've probably already heard about the Internet Map. If not, then you can look at it here , and you can read about it in my previous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web architecture</h1><div class="post__text post__text-html js-mediator-article">  Hello to all! <br><br>  You've probably already heard about the Internet Map.  If not, then you can look at it <a href="http://internet-map.net/">here</a> , and you can read about it in my <a href="http://habrahabr.ru/post/148351/">previous post</a> . <br><br>  In this article I would like to tell you how the Internet Map site is arranged, what technologies ensure its normal operation and what steps had to be taken to withstand a large flow of visitors who want to look at the map. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The performance of the Internet Map is supported by modern technologies from the Internet giants: Google Maps is powered by Google Maps, web requests are processed by Microsoft's .net technology, and Amazon Web Services by Amazon is used to host and deliver content.  All three components are vital for normal card operation. <br><br>  Further, a large sheet about the internal architecture of the card: mainly AWS praises, performance issues and hosting prices will also be affected.  If you are not afraid - welcome under cat. <br><br><a name="habracut"></a><br><br><h4>  Amazon CloundFront and Google Maps </h4><br>  The Google Maps technology involves the use of tiles - small 256x256 pixels of which the map image is formed.  The main point associated with these pictures is that there are a lot of them.  When you see a map on your screen in high resolution, it consists of all these small pictures.  This means that the server must be able to very quickly handle multiple requests and give tiles at the same time so that the client does not notice the mosaic.  The total number of tiles required to display a map is equal to sum (4 ^ i), where i runs from 0 to N, where N is the total number of zooms.  In the case of the Internet Map, the number of zooms is 14, i.e.  The total number of tiles should be approximately 358 million.  Fortunately, this astronomical figure was reduced to 30 million, abandoning the generation of empty tiles.  If you open the browser console, you will see a lot of 403 errors, this is exactly what they are - missing tiles, but the map is not visible because  if there is no tile, the square is filled with a black background.  Anyway, 30 million tiles is also a significant figure. <br><br>  Therefore, the standard scheme for placing content on a dedicated server, in this case, is not suitable.  There are a lot of tiles, there are many users, there should also be a lot of servers and they should be near the users so that they do not notice the delay.  Otherwise, users from Russia will receive a good response, and users from Japan will remember the time of dial-up modems looking at your card.  Fortunately, Amazon has a solution for this case (there is also the company Akamay, but it's not about her).  It is called CloudFront and is a global content delivery network (CDN).  You place your content somewhere (this is called Origin) and create a distribution (Distribution) in CloudFront.  When a user requests your content, CloudFront automatically finds its site closest to the user and, if there is no copy of your data there, they will be requested either from another site or from Origin. <br><br>  It turns out that your data is replicated many times and with high probability will be delivered from CloudFront servers, and not from your expensive, weak and unreliable storage.  In the case of the Internet Map, the CloudFront connection actually meant that the data from my hard disk was physically copied to the Singapore Simple Storage Service (S3) segment, and then through the AWS console a distribution was created (Distribution) in CloudFront, where S3 was specified as the data source (Origin).  If you look at the code of the Internet Map page, you can see that the tiles are taken from the address CloudFront <a href="http://d2h9tsxwphc7ip.cloudfront.net/">d2h9tsxwphc7ip.cloudfront.net</a> .  Determining the nearest site, keeping the content up to date and all such things, CloudFront does automatically.  Hooray! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/155/321/0a9/1553210a9a2721f36cbb529728e7a781.jpg" alt="image"><br><br>  In the picture you can see how the original map is broken into tiles, the tiles are stored in S3, and from there they are loaded into CloudFront and already from its nodes are delivered to users. <br><br><h4>  Amazon RDS </h4><br><br>  To ensure the search site on the map, you need a database where you will store information about the sites and their coordinates.  In this case, we have MS SQL Express in the Amazon cloud.  This is called the Relational Database Service (RDS).  Relationality is not particularly necessary for us.  we have only one table, but it's better to still have a full-fledged database than reinventing bicycles.  RDS allows you to use not only MS SQL, but also Oracle, MySql and, probably, something else. <br><br>  In the picture you can see how the original map turns into a table in the RDS database. <br><br><h4>  Amazon Elastic Beanstalk </h4><br><br>  Probably, this feature in the Amazon cloud services family amazed me the most.  Elastic Beanstalk allows literally one click to release a project under load with minimal time or without leaving the site offline.  Knowing how hard releases are being made, especially when the infrastructure contains several servers and a load balancer, I was just amazed at how easily and gracefully Elastic Beanstalk handles this!  During the first deployment, it creates all the infrastructure necessary for your application (environment): load balancer (Elastic Load Balancer - ELB), computing units (Elastic Compute Cloud - EC2) and determines the scaling parameters.  Roughly, if you have one server and all requests go directly to it, then when you reach a certain threshold, your server will stop coping with the load and most likely will fall.  Sometimes he will not even be able to rise under the load on which he had previously worked perfectly, because  it usually takes some time to get into working mode, and constant requests do not allow this.  In general, who fought he knows. <br><br>  Elastic Beanstalk takes all the infrastructure issues for you.  In fact, you can put the plugin in MS Visual Studio and forget about the details.  He will himself maintain version control, deploy, etc.  And in the event of an increase in load, it will create as many EC2 instances as necessary. <br>  The Elastic Beanstalk chart is circled with a dotted line, inside you can see an ELB that accepts incoming requests and distributes them to IISs in EC2 instances. <br><br><h5>  Performance and price </h5><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5d/93e/1d8/c5d93e1d8e19912aa6a70296ad7bb8e4.jpg" alt="image"><br><br>  Immediately after the publication of the article on the Habrahabr.ru website, a stream of visitors went to the Internet Map.  On the graph you can see a very sharp increase in attendance, for the first 6 hours the site was visited by 30,000 people, and on the first day almost 50,000, mostly from Russia and the countries of the former USSR.  Feeling that something was wrong, Elastic Beanstalk created 10 EC2 instances and they did a good job.  There were no complaints about problems with access to the site.  The map could be viewed freely.  But RDS immediately died: first, the search began to work very slowly, then intermittently, and then completely stopped.  The account for the first day was about $ 200.  Approximately 100 for S3 + CloudFront and 50 each for EC2 and RDS. <br><br>  Having studied the experience, I optimized and reconfigure the autoscaling parameters.  And it helped.  During the week, the site was visited by an average of 30-50 thousand people a day from different countries of the world and nothing fell off.  True, such a sharp influx as the first day was not there either. <br><br>  Then someone posted information about the Card on reddit.com and this caused an explosive increase in attendance.  On Sunday, about half a million people visited the site and at the same time only one small instance EC2 and one small RDS instance worked.  True, there was one complaint that the map does not load, but I think that this is normal for such a wave. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e36/5a8/f40/e365a8f40d65a6532cffcf79a013d784.jpg" alt="image"><br><br>  And here is the bill for the first week <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a08/a69/034/a08a6903422b2cdd9ff2ba1f7dba0b21.png" alt="image"><br><br><h4>  Conclusion </h4><br>  I started working on information technology when the word cloud had nothing to do with IT.  Since then, much has changed and the standalone server is living its time.  Of course, hosting in the cloud has its drawbacks (you can ask Instagram for example).  But the ability to shift most of the worries to the cloud service, in my opinion, is more than worth the risk.  If you start to develop your project and quality, availability, reliability and scalability are important for you, then most likely you are on the road to the cloud. </div><p>Source: <a href="https://habr.com/ru/post/148721/">https://habr.com/ru/post/148721/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148715/index.html">Why computer vision is used very little in practice</a></li>
<li><a href="../148717/index.html">Heuristics in scheduling classes</a></li>
<li><a href="../148718/index.html">Returning to multitasking in PHP</a></li>
<li><a href="../148719/index.html">Opened CFP at ZeroNights 2012</a></li>
<li><a href="../148720/index.html">How masterhost for their mistakes "apologizes"</a></li>
<li><a href="../148722/index.html">Denial: iPhone design has not been stolen from Sony</a></li>
<li><a href="../148723/index.html">Tariff "Free". Hacking a payphone at PHDays</a></li>
<li><a href="../148724/index.html">Video Capture-2</a></li>
<li><a href="../148726/index.html">Sim-Sim, open up!</a></li>
<li><a href="../148728/index.html">Comments on the July Application Excellence Labs and an invitation to the August</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>