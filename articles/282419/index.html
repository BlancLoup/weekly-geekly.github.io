<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Restore in 60 seconds (or how to speed up data recovery using Arcserve UDP)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes, looking from the porch to the courtyard and the pond, he would talk about how nice it would be if you suddenly made an underground passage ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Restore in 60 seconds (or how to speed up data recovery using Arcserve UDP)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/3e4/f16/5fd/3e4f165fdb2c4ac59e44269008d562d8.jpg"><br><br>  <i>Sometimes, looking from the porch to the courtyard and the pond, he would talk about how nice it would be if you suddenly made an underground passage from the house or built a stone bridge across the pond ...</i> <br>  N.V. Gogol <br>  Dead Souls <br><br>  It would also be nice if any restoration could be performed instantly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Imagine that our server has failed, taking 1 terabyte of useful information with it.  If we restore its data using traditional methods, that is, by transferring them from a backup copy over the network, then at a recovery rate of, say, 8 GB per minute, we will get at least two hours of nervous waiting, annoyed user calls, and possibly lost due to idle profit. <br><br>  However, there are ways that allow you to recover data in minutes, and sometimes seconds.  About them, and will be discussed in the article. <br><a name="habracut"></a><br><br><h3>  Method 1. Restore in advance </h3><br>  Immediately after creating the backup, we will get a virtual machine from it (we migrate).  In case the working server fails, we launch its virtual twin instead. <br><br>  When we have repaired the working server, we‚Äôll fill it with not the backup copy, but the latest data from this virtual server.  This technology is called ‚ÄúVirtual Standby‚Äù and has existed in Arcserve UDP (and its predecessor, Arcserve D2D) for several years.  Virtual machines from backups can be created in vSphere and Hyper-V environments. <br><br>  The advantage of this method is the low recovery time, in fact, this is the start time of the virtual machine. <br><br>  The disadvantage is the need to sacrifice storage space for virtual machines. <br><br><div class="spoiler">  <b class="spoiler_title">For Arcserve practitioners: how to do it</b> <div class="spoiler_text">  Add one more step to the backup plan of the servers you need by clicking on the ‚ÄúAdd a Task‚Äù button: <br><br><img src="https://habrastorage.org/files/180/2ed/da2/1802edda25ff4a2896676cac555f3aca.png"><br><br>  The type of this step will be ‚ÄúVirtual Standby‚Äù: <br><br><img src="https://habrastorage.org/files/645/1b7/36a/6451b736aed8490c8e66ec176b29a82e.png"><br><br>  As a virtualization environment, you can use vSphere or Hyper-V. <br><br>  In the case of Hyper-V, fill in the ‚ÄúVirtualization Server‚Äù section like the one below: <br><br><img src="https://habrastorage.org/files/d59/2c2/c00/d592c2c00ea645fe80ee574f5f047683.png"><br><br>  In the case of vSphere, otherwise: <br><br><img src="https://habrastorage.org/files/fac/f5d/f46/facf5df46ece48e9a4de878babb40a96.png"><br><br>  For the vSphere virtual environment, we also need to specify a machine with an installed Arcserve UDP agent that will monitor the availability of the server we reserve.  We call this tracking agent a monitor. <br><br><img src="https://habrastorage.org/files/3f7/2c1/c09/3f72c1c0951a4056bf0373b12c54e10e.png"><br><br>  In the case of Hyper-V, the monitor is an agent on the Hyper-V host. <br><br>  On the ‚ÄúVirtual Machine‚Äù tab, we define how the names of servers that we reserve will be converted into virtual machine names.  Usually, the UDPVM_ (1) prefix is ‚Äã‚Äãadded. <br><br>  We indicate how many snapshots of this virtual machine we need to store (each new backup creates a new snapshot) (2).  The remaining parameters specify the number of processors, the amount of RAM and the network configuration of the virtual machine. <br><br><img src="https://habrastorage.org/files/7d4/3a5/ee5/7d43a5ee5a1544cdbf6d22dd170a1043.png"><br><br>  When choosing a vSphere virtualization environment, the part of the screen that defines the location of the virtual machine files and the virtual network is slightly different: <br><br><img src="https://habrastorage.org/files/97b/c85/902/97bc85902fcf4360adc2dff145ff4301.png"><br><br>  Finally, on the ‚ÄúAdvanced‚Äù tab, you can specify whether the monitor should start the virtual machine if it cannot reach the reserved server during the specified time interval: <br><br><img src="https://habrastorage.org/files/da7/bf4/083/da7bf40836eb4437ae257c5721ad18db.png"><br><br>  After the next backup is completed, the ‚ÄúVirtual Standby‚Äù task will start to update the virtual machine: <br><br><img src="https://habrastorage.org/files/fc1/20e/66e/fc120e66ee6a4813900b7688c15e9aa8.png"><br><br>  The virtual machine will soon be visible in the appropriate virtual environment.  Here: <br><br><img src="https://habrastorage.org/files/258/565/c1c/258565c1c54144abaefcf790aa17500a.png"><br><br>  Or here: <br><br><img src="https://habrastorage.org/files/dc1/ebd/bed/dc1ebdbed77348ddbdf1d14932ecd26d.png"><br><br></div></div><br><br><h3>  Method 2. Mount Backup </h3><br><br>  In some cases, it is enough not to restore the data, but mount the backup as a network drive in read-only mode. <br><br>  In this case, the data remains to lie on the server that stores the backup copies, and only what we explicitly read, for example, individual files, is transmitted over the network. <br><br>  The disk is mounted instantly, although the speed of reading data over the network, of course, will be lower than if we read these files locally. <br><br><div class="spoiler">  <b class="spoiler_title">For Arcserve practitioners: how to do it</b> <div class="spoiler_text">  In the context menu of the agent icon, select ‚ÄúMount Recovery Point‚Äù: <br><br><img src="https://habrastorage.org/files/26f/160/76c/26f16076c3074a1d960d95ba408ab8b4.png"><br><br>  The agent will offer you to mount your own backup copies.  If this does not suit you, click the ‚ÄúChange‚Äù button to see backup copies of other servers: <br><br><img src="https://habrastorage.org/files/ff9/5b2/9af/ff95b29afa0641c89e7fbfc05d04e4ae.png"><br><br>  Select the server of interest to us and click ‚ÄúOK‚Äù: <br><br><img src="https://habrastorage.org/files/b1f/4d7/e9f/b1f4d7e9fbd843a5b6dc04ec4ec2a1ca.png"><br><br>  Then we select the date (1) and time (2) of the backup copy we are interested in, as well as the server disk (3) of interest to us: <br><br><img src="https://habrastorage.org/files/347/177/f70/347177f702ca4abd8a682b5bf5405ee9.png"><br><br>  Finally, select the letter to be assigned to the disk: <br><br><img src="https://habrastorage.org/files/1a3/f12/0ea/1a3f120ea59f4b369d57d16e7aed5aa8.png"><br><br>  Click ‚ÄúOK‚Äù and you can use the disk Z :. <br><br></div></div><br><br><h3>  Method 3: Continuous Backup </h3><br><br>  If you track everything that a computer writes to a disk, you can notify another computer about these changes so that it can repeat these changes on its own disk. <br><br>  Thus we get two computers with the same data on the disks.  (To be precise, the data of the second computer is lagging behind during transmission over the network). <br><br>  In the case when the main computer fails, the backup computer is able to replace it with current data on the disk. <br><br>  It would seem that the main drawback of such a system is the need to duplicate all servers, with each working server needing one more backup one.  However, virtual servers may also be backup.  Moreover, in the case of Windows servers, their backup twins remain turned off until changes are copied to them, that is, they are simply .vmdk or .vhdx files that will turn into running virtual machines only at the moment they are really needed. <br><br>  The great advantage of this technology is that data loss is minimal compared to periodic backups, when we can, for example, recover data on the evening before yesterday, but lost everything we did after that.  With continuous backup, we will return the data to the point in time immediately preceding the server failure.  This technology is implemented in the module Arcserve Replication and High Availability, available as a separate product, as well as a component of Arcserve UDP in the Premium Plus edition. <br><br>  A detailed description of working with Arcserve Raplication and High Availability requires a separate article, which we will publish soon. <br><br><h3>  Method 4: Starting physical Linux machines still at the recovery stage </h3><br><br>  First, restore the files needed to start the machine (bootloader, kernel, etc.).  Add another driver that will intercept disk access.  Everything.  Reboot the machine. <br><br>  The car started and breathed, however, it has not yet been fully restored.  Only a small part of it has been restored, and the restoration continues. <br><br>  But look, it took the car to turn to that part of the disk that has not yet been restored!  What to do?  This is where the driver we introduced starts to work.  It intercepts the read operation from the disk and restores exactly the requested data block, changing the standard sequence of recovery blocks. <br><br>  Yes, the work of the machine will be slowed down every time when the requested data block has not yet been restored.  Yes, the machine will run slower than usual until fully recovered. <br><br>  But it earned already when we uploaded the first hundreds of megabytes to it.  A couple of minutes - and the server came to life!  In some cases, recovery time is paramount. <br><br><div class="spoiler">  <b class="spoiler_title">For Arcserve practitioners: how it is done.</b> <div class="spoiler_text">  Just when restoring a Linux-machine, put a tick in the box ‚ÄúEnable Instant BMR‚Äù and it will start to recover as described above. <br><br><img src="https://habrastorage.org/files/d46/d3a/41a/d46d3a41a7a84523b175fd2dc714e4ac.png"><br><br></div></div><br><br><h3>  Method 5: Instant recovery in a virtual machine image </h3><br><br>  We have already seen (in section 2) how it is possible to see the disks of the machine, without actually restoring them.  Is it possible to make these disks bootable and start the machine with them?  It turns out you can.  This technology appeared in Arcserve UDP version 6.0 and was called Instant VM (Instant Virtual Machine). <br><br>  It is a virtual machine (in a vSphere or Hyper-V environment) that can boot from a disk that is not actually a disk.  So, in the vSphere environment, the hypervisor is mounted on the NFS network storage, which detects virtual machine files, including .vmdk, which is a disk image.  In reality, this file is obtained on the fly by conversion from backup data. <br><br>  On the Hyper-V-host, no network storage is not mounted, it just appears on its local disk .vhdx-file, which is also not a regular file, but is converted on the fly from a backup. <br><br>  The advantage of this method is the ability to turn a backup into a virtual machine almost instantly, without sacrificing the expensive disk space for virtual machines and without wasting computing resources on the preliminary migration. <br><br>  I will make a special emphasis on the fact that the technology is suitable for restoring both physical and virtual servers. <br><br>  The disadvantages include a slower speed of the virtual machine located on the disk, connected via the network and obtained from the backup on the fly.  However, the ability to instantly restore without additional resource costs outweighs everything. <br><br>  If the virtual machine that replaces the failed server is planned to be used for a long time, you can transfer it to the real high-speed storage by means of the hypervisor. <br><br><div class="spoiler">  <b class="spoiler_title">For Arcserve practitioners: how it is done.</b> <div class="spoiler_text">  Find the server of interest in the server list.  Click on it with the right mouse button and select ‚ÄúCreate an Instant VM‚Äù in the context menu: <br><br><img src="https://habrastorage.org/files/ede/4db/549/ede4db549328462e81f82b90c7a753b7.png"><br><br>  Select the backup we are interested in, for example, the last one: <br><br><img src="https://habrastorage.org/files/fa1/2ee/542/fa12ee54262e492a93bed23e39b2b34f.png"><br><br>  We indicate in which virtual environment we will deploy a copy of the server. <br><br>  This could be a vSphere: <br><br><img src="https://habrastorage.org/files/e42/373/405/e4237340522543ffbb2ebbf9aeea2a2c.png"><br><br>  Or it could be Hyper-V: <br><br><img src="https://habrastorage.org/files/80d/0a5/959/80d0a59598324f3a948654602ed48a1f.png"><br><br>  In the case of vSphere, we need to assign a machine that will convert the backup to a virtual machine disk image on the fly.  It is quite reasonable to choose a server as such a machine where this backup is stored: <br><br><img src="https://habrastorage.org/files/902/396/cdc/902396cdcf3e4742934be77ff8ff8bc9.png"><br><br>  On the next screen, you first need to specify in which directory the virtual machine files will be generated.  Also there you can set the number of processors, the amount of RAM and the network configuration of the virtual machine. <br><br><img src="https://habrastorage.org/files/684/e2b/fa8/684e2bfa8d3344c6b0020203efce3c2d.png"><br><br>  Now click the ‚ÄúFinish‚Äù button and wait for the virtual appearance of the virtual machine.  If we chose Boot Now, the machine will start soon. <br><br>  Hyper-V: <br><br><img src="https://habrastorage.org/files/bfa/cf9/9f4/bfacf99f42224be584bce3936a74815a.png"><br><br>  vSphere: <br><br><img src="https://habrastorage.org/files/7ab/fe2/5cc/7abfe25cc3bc4694a6efa3b04f24f3ab.png"><br><br>  In the vSphere environment, we will see that another NFS mounted repository has appeared: <br><br><img src="https://habrastorage.org/files/cd0/85f/e25/cd085fe258df4711be94a8a5a3de7177.png"><br><br>  Interestingly, the virtual machine hard disk file can be quite weighty, but occupy almost nothing on the disk: <br><br>  For vSphere: <br><br><img src="https://habrastorage.org/files/684/ecc/095/684ecc09551e4700ac95311dfed3d283.png"><br><br>  For Hyper-V: <br><br><img src="https://habrastorage.org/files/349/8b9/3c0/3498b93c0ea34ffa93d3893cca2623d1.png"><br><br>  Virtual machines obtained in this way can be seen from the Arcserve UDP console in the ‚Äúresources-&gt; Infrastructure-&gt; Instant Virtual Machines‚Äù section. <br><br><img src="https://habrastorage.org/files/17e/4e3/fbd/17e4e3fbdbb848ba80533bfbca6b6923.png"><br><br>  If you plan to use these machines for a long time, you can transfer them to real storage by means of the hypervisor. <br></div></div><br><br>  *** <br>  Arcserve UDP is a modern tool that allows you to efficiently organize backup and recovery of data using the most advanced technologies.  Thanks to Arcserve UDP, you can achieve your goals within your budget: <br><ul><li>  data recovery time </li><li>  backup storage history depths </li><li>  observance of volume limits for storing backups </li><li>  Compliance with network traffic limits and backup windows </li><li>  backups in a distributed environment (central office and branch offices) </li></ul><br><br>  For those who want to try the product Arcserve UDP below is the download link (requires filling out the form): <br>  <a href="http://arcserve.com/free-backup-software-trial/%3Fsrc%3DRU/AR//MMitroshin">arcserve.com/free-backup-software-trial/?src=RU/AR//MMitroshin</a> <br><br>  You can always find more information about Arcserve products in Russian at <a href="http://arcserve.su/">arcserve.su</a> </div><p>Source: <a href="https://habr.com/ru/post/282419/">https://habr.com/ru/post/282419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282407/index.html">Yii: best practices</a></li>
<li><a href="../282411/index.html">Intel security hardware technology: a new word in the protection of biometric applications. Part 2</a></li>
<li><a href="../282413/index.html">YConfs - Conference Information Support System</a></li>
<li><a href="../282415/index.html">Device Attributes, or ioctl must die</a></li>
<li><a href="../282417/index.html">1 developer. 2 applications. 3 years</a></li>
<li><a href="../282421/index.html">Receiving payment from international customers with Payoneer</a></li>
<li><a href="../282423/index.html">Extending Splunk functionality is just</a></li>
<li><a href="../282425/index.html">Frontend Dev Conf 2016: the heroes, events and surprises of the conference</a></li>
<li><a href="../282427/index.html">Native advertising returns: Native Admob, RecyclerView and briefly about the rules</a></li>
<li><a href="../282429/index.html">We are looking for a replacement for Digital Ocean among domestic hosting companies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>