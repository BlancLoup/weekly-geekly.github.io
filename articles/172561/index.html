<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk Voice Tree with Perl AGI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear readers. 

 I want to share my example of creating a voice menu for Asterisk using Perl AGI. 

 After reading the Voice of the As...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk Voice Tree with Perl AGI</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear readers. <br><br>  I want to share my example of creating a voice menu for Asterisk using Perl AGI. <br><br>  After reading the <a href="http://habrahabr.ru/post/122751/">Voice of the Asterisk</a> article <a href="http://habrahabr.ru/post/122751/">with my own hands</a> , I had a few comments on the method of implementing the voice menu proposed in this article. <br>  My main complaint is that the caller is forced to listen to the menu to the end, and only then we let him press one of the proposed keys.  If he makes a mistake by pressing the wrong key, he will have to listen to the menu again. <br>  It seems to me that the subscriber will quickly get bored. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Also, the company is often called by people who already know the internal number of the employee.  It is necessary to give them the opportunity to dial the number, without waiting for the end of the voice menu. <br><br>  In addition, almost standard is pressing the "zero" key to call the secretary. <br>  If the subscriber does not want to listen to the menu, but wants to immediately speak with the secretary - I think we can allow him that. <br><br>  I will describe the rest in the given example. <br><a name="habracut"></a><br><br>  Asterisk works for me on FreeBSD.  Therefore, the ways that I will indicate in the future, you may differ. <br><br>  I assume that you have already installed Asterisk. <br>  You will also need an installed Perl and Asterisk module: AGI <br><br>  I won‚Äôt begin to describe the installation here for a long time, I‚Äôll just add that if Perl is already installed, then Asterisk: AGI is installed with one command: <br><pre><code class="bash hljs">cpan -i Asterisk:AGI</code> </pre> <br>  After which we can use it in our scripts. <br><br>  So, here are the snippets from the Asterisk configuration files: <br>  <b>extensions.conf</b> <br><pre> <code class="bash hljs">[default] exten =&gt; 84951223344,1,Macro(call-in,<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>) ;      call-in exten =&gt; _X.,1,Hangup ;</code> </pre> <br>  I use the macro for additional processing of an incoming call before connecting.  You can do without it. <br><br><pre> <code class="bash hljs">[macro-call-in] exten =&gt; s,1(agi),AGI(ivr.pl) ;       Perl-.</code> </pre> <br>  <b>/usr/local/share/asterisk/agi-bin/ivr.pl</b> <br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use Asterisk::AGI; $AGI = new Asterisk::AGI; %input = $AGI-&gt;ReadParse(); $timeout = 1300; #    .   . #         . #    $AGI-&gt;answer(); #        #     $key1 = $AGI-&gt;stream_file(["ivr"], "0123456789"); #   ,     . #    ,  *  # (     ). $key2 = $AGI-&gt;wait_for_digit($timeout); $key3 = $AGI-&gt;wait_for_digit($timeout); $key4 = $AGI-&gt;wait_for_digit($timeout); #     (     ). $num = join ('', chr($key1), chr($key2), chr($key3), chr($key4)); #     ,    . #    ,   . $num = $num + 0; #      . if ( $key1 == 0 ) { $num = 0 } #      ,     ,    . #   . #     Asterisk (  ). $AGI-&gt;verbose("IVR number is $num"); #     -     . if (length($num) = 4) { $AGI-&gt;exec("Macro","call-local,Local/$num\@office"); #       office.   call-local .  $AGI-&gt;hangup(); } #     ,    . #       ,     . elsif (length($num) &gt; 1) { $num = 0; } #      if ($num == 0) { $AGI-&gt;exec("Macro", "operator"); } if ($num == 1) { $AGI-&gt;exec("Macro", "sale"); } if ($num == 2) { $AGI-&gt;exec("Macro", "accounting"); } if ($num == 3) { $AGI-&gt;exec("Macro", "marketing"); } if ($num == 4) { $AGI-&gt;exec("Macro", "fax"); }</span></span></code> </pre><br>  Further calls are sent to the appropriate macros. <br><br>  Macro examples: <br><br>  Call Marketing: <br>  <b>extensions.conf</b> <br><pre> <code class="bash hljs">[macro-marketing] exten =&gt; s,1,Dial(SIP/1008,20,tTm)</code> </pre><br>  Call extension: <br>  <b>extensions.conf</b> <br><pre> <code class="bash hljs">[macro-call-local] exten =&gt; s,1,Dial(<span class="hljs-variable"><span class="hljs-variable">${ARG1}</span></span>,25,tTm)</code> </pre><br>  That's all. <br><br>  Maybe the proposed method will seem unnecessarily complicated. <br>  However, I like to keep all the logic of the IVR in a separate file. <br>  Also, the menu can be easily added, add submenus (by creating additional scripts). <br><br>  In addition, I use AGI in some additional scripts (for handling missed calls, forwarding to mobile, etc.), so it was convenient for me to use it for the voice menu. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/172561/">https://habr.com/ru/post/172561/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172543/index.html">Sony Xperia Z Review</a></li>
<li><a href="../172547/index.html">Began accepting applications for participation in the championship championship Devcup 2013</a></li>
<li><a href="../172549/index.html">In Vladikavkaz, QR-codes were hung on buildings in the historical center of the city</a></li>
<li><a href="../172551/index.html">Dropbox 2.0.0 released</a></li>
<li><a href="../172559/index.html">WebsiteSpark stops accepting new applications for participation</a></li>
<li><a href="../172565/index.html">Google Glass can be worn with ordinary glasses / glasses</a></li>
<li><a href="../172567/index.html">Basics of HPC technology</a></li>
<li><a href="../172569/index.html">Seafile 1.5 released with LDAP support and client CLI</a></li>
<li><a href="../172571/index.html">Why did I write another static site generator</a></li>
<li><a href="../172573/index.html">The results of the first week of the competition for BizSpark startups "Tell about yourself"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>