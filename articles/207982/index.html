<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Metaclasses in Smalltalk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article, I hope, will be useful not only for those who want to master Smalltalk, but also for those who want to better understand the problems of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Metaclasses in Smalltalk</h1><div class="post__text post__text-html js-mediator-article">  This article, I hope, will be useful not only for those who want to master Smalltalk, but also for those who want to better understand the problems of building object systems.  In Smalltalk, classes are full-fledged objects, and how this is implemented is an excellent example of building a developed system based on several simple principles without undue complication. <br><br>  (However, I will not deny the connection with the recently published article <a href="http://habrahabr.ru/post/207786/">Metaclasses in Objective-C</a> .) <br><a name="habracut"></a><br>  In order to understand the concept of metaclasses, we need only two principles, from which we draw (almost obvious) logical conclusions. <br><br>  The first principle is fundamental for object programming as a whole and, in theory, should be the same for any object language (for Smalltalk this is the case anyway): <br><blockquote>  Everything is an object, that is, it can receive messages and respond to them. </blockquote>  Classes also fall under this ‚Äúall‚Äù.  For example, we spawn objects by sending messages to the class whose instance we want to create: <br><pre><code class="smalltalk hljs">point := <span class="hljs-type"><span class="hljs-type">Point</span></span> x: <span class="hljs-number"><span class="hljs-number">1</span></span> y: <span class="hljs-number"><span class="hljs-number">2.</span></span></code> </pre>  No supernatural special operations for the miraculous creation of objects, only the sending of messages.  In this case, we send the message <code>#x:y:</code> class <code>Point</code> in the hope of getting a point in two coordinates. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second principle is not fundamental for object programming, but in Smalltalk (as in most modern object languages), unfortunately, was also laid down: <br><blockquote>  The behavior of an object is determined by its class: the class defines a set of methods that describe the reaction of instances to a particular message. </blockquote>  So, all methods for points are defined in the class <code>Point</code> - this is understandable.  We can recognize the class of an object by sending it a <code>#class</code> message. <br><pre> <code class="smalltalk hljs">point class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Point"</span></span></code> </pre>  But where is the <code>#x:y:</code> method, which describes the processing of the same-name message by the class <code>Point</code> defined? <br><br>  In order not to complicate the system by introducing some new entities or rules, you can use the existing ones: method <code>#x:y:</code> must be defined in the class instance of which is the class <code>Point</code> .  The construction ‚Äúclass of a class‚Äù is replaced by the term ‚Äúmetaclass‚Äù.  Of course, the <code>Point</code> metaclass can be obtained by sending the <code>#class</code> message <code>#class</code> the <code>Point</code> class: <br><pre> <code class="smalltalk hljs">point class class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Point class"</span></span> <span class="hljs-type"><span class="hljs-type">Point</span></span> class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Point class"</span></span></code> </pre>  As you can see, the <code>Point</code> metaclass is not assigned its own name in the system.  Metaclasses are denoted by smalltalk expressions with which they can be obtained. <br><br>  This circumstance also shows that <b>each class has its own metaclass</b> .  We don‚Äôt need more than one metaclass per class, but one for each class is also a bit too much.  Why do you need so much? <br><br>  In Smalltalk-76, there was only one metaclass for all classes.  But if several classes have the same object as their metaclass, then they have the same behavior, since it is defined in the metaclass.  For example, the message <code>#x:y:</code> in this case could be sent to any class: <code>String</code> , <code>Integer</code> , etc.  Obviously, this is not very good.  The alternative is the complete absence of custom behavior on the side of the class (which is no better), or (even worse) black magic at the level of the language, depending on otherworldly forces, on the level of the language - like in most "modern" mainstream creations. <br><br>  Therefore, for each class in the system, we need one and exactly one metaclass that determines the behavior of this class.  In Smalltalk, a metaclass is automatically created ‚Äúoff-screen‚Äù when creating a new class. <br><br>  Considering that metaclasses (see the first principle) are objects and (see the second principle) are instances of a certain class, we conclude that the above applies to the metaclasses themselves.  But there is a peculiarity: in contrast to ‚Äúordinary‚Äù classes, metaclasses do not need specific behavior - they all store the behavior of their instances in the same way, nothing more is required of them.  Therefore, there is no longer any need to create a separate (meta-) metaclass for each metaclass, just one object is enough to determine the behavior of all metaclasses in the system.  He was called <code>Metaclass</code> : <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Point</span></span> class class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Metaclass"</span></span></code> </pre>  Based on the same principles, and applying the same logic, we conclude that <code>Metaclass</code> should also have a metaclass: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Metaclass</span></span> class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Metaclass class"</span></span></code> </pre>  Please note that metaclass <code>Metaclass</code> did not receive its own name (as unnecessary). <br><br>  And once again we repeat the past: Metaclass metaclass (like all metaclasses) is <code>Metaclass</code> : <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Metaclass</span></span> class class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Metaclass"</span></span></code> </pre><br>  The chain is closed, that's what we got: <br><img src="https://habrastorage.org/getpro/habr/post_images/39a/7b0/a1e/39a7b0a1ed6241a7000b10f2c2f83bf4.png" alt="image"><br><br>  We did not touch on the issue of inheritance, but everything is simple here: since the behavior of classes is inherited in the same way as the behavior of objects, the superclass of metaclass C is the metaclass of superclass C: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Point</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Object"</span></span> <span class="hljs-type"><span class="hljs-type">Point</span></span> class superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Object class"</span></span> <span class="hljs-type"><span class="hljs-type">Object</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; ProtoObject"</span></span> <span class="hljs-type"><span class="hljs-type">Object</span></span> superclass class.<span class="hljs-comment"><span class="hljs-comment">"-&gt; ProtoObject class"</span></span></code> </pre>  This rule (forced) is violated only where the inheritance chain terminates: ProtoObject does not have a superclass, but its metaclass must be a class: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">ProtoObject</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; nil"</span></span> <span class="hljs-type"><span class="hljs-type">ProtoObject</span></span> class superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Class"</span></span></code> </pre><br>  In conclusion - a couple of small remarks, not relevant to the point, but interesting. <br>  Metaclasses are not full-fledged classes, since the former do not require all the functionality of the latter: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Metaclass</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; ClassDescription"</span></span></code> </pre>  And for those who want to complete the picture completely, but do not want to run Smalltalk: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Class</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; ClassDescription"</span></span> <span class="hljs-type"><span class="hljs-type">ClassDescription</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Behavior"</span></span> <span class="hljs-type"><span class="hljs-type">Behavior</span></span> superclass.<span class="hljs-comment"><span class="hljs-comment">"-&gt; Object"</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/207982/">https://habr.com/ru/post/207982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207962/index.html">You calendar 2014</a></li>
<li><a href="../207964/index.html">Game in 30 teams of the Assembler</a></li>
<li><a href="../207968/index.html">Django + Select2 = select autocomplete</a></li>
<li><a href="../207970/index.html">A gift to all front-end developers. grunt (Jade + Stylus + Watch)</a></li>
<li><a href="../207978/index.html">On the merits of spaghetti methodology</a></li>
<li><a href="../207984/index.html">4.6 million data messenger users have a data leak</a></li>
<li><a href="../207986/index.html">Programming kids or programming for kids?</a></li>
<li><a href="../207988/index.html">Python: things you might not know</a></li>
<li><a href="../207990/index.html">Part 2. How many megabits / s can be passed through the optic nerve and what is the resolution of the retina? Some theory</a></li>
<li><a href="../207996/index.html">Syrian e-army hacked blog and Twitter account Skype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>