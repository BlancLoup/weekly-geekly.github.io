<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multithreading in Unity by means of reactive extensions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss the main problems encountered in the development of multi-threaded mobile games using Unity, as well as ways to solve them u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multithreading in Unity by means of reactive extensions</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/de3/8c0/333/de38c03330344b7eb6fb78aa98e7d468.jpg"><br><br>  This article will discuss the main problems encountered in the development of multi-threaded mobile games using Unity, as well as ways to solve them using <a href="https://github.com/neuecc/UniRx">UniRx</a> (reactive extensions for Unity). <br><br>  The article consists of two parts.  The first is devoted to multithreading for the ‚Äúsmallest‚Äù, it tells in an accessible language about streams and how to create them, about stream synchronization.  The second part is devoted to reactive extensions, their device, principle of operation and methods of application. <br><a name="habracut"></a><br>  Since one of the languages ‚Äã‚Äãfor writing scripts in Unity is C #, in which we develop applications, all the code will be written only in it.  For an in-depth understanding of the principles of multithreading and reactive extensions, we recommend reading the <a href="http://habrahabr.ru/company/nixsolutions/blog/260745/">basics of multithreading</a> and <a href="http://habrahabr.ru/company/nixsolutions/blog/261031/">what is reactive extensions</a> .  If the reader is familiar with this topic, then you can skip the first section. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Multithreading for the smallest </h3><br>  Multi-threaded applications are applications that perform several tasks simultaneously in separate threads.  Applications that use multi-threading, more quickly respond to user actions, because the user interface remains active, while tasks that require intensive work of the processor are performed in other threads.  Multi-threaded C # applications using Mono are developed using keywords: Thread, ThreadPool, and asynchronous delegates. <br><br>  Let's look at a multithreaded application using the example of a build.  Suppose that each worker performs his duties simultaneously with other workers.  For example, one washes the floors, another washes the windows, etc.  (and it all happens at the same time).  These are our streams. <br><br><img src="https://habrastorage.org/files/c38/3ba/a17/c383baa179a94202a32c4aa270e3ba65.jpg"><br><br>  Thread is a class that allows you to create new threads within an existing application. <br>  Asynchronous delegates - an asynchronous method call using a delegate that is defined with the same signature as the method being called.  For an asynchronous method call, you must use the BeginInvoke method.  With this approach, the delegate takes a thread from the pool and executes some code in it. <br><br>  ThreadPool - implementation of the ‚Äúobject pool‚Äù pattern.  Its meaning is in effective flow management :: creating, deleting, assigning to it some kind of work.  Returning to the construction analogy, ThreadPool is a foreman who controls the number of builders at a construction site and assigns each of them a task. <br><br><img src="https://habrastorage.org/files/424/464/63b/42446463b557437f9a876c22a4489755.jpg"><br><br><h3>  Thread synchronization tools </h3><br>  The C # language provides tools for synchronizing threads.  These tools are presented in the form of lock and Monitor.  They are used to ensure that the execution of a block of code is not carried out simultaneously by several threads.  But there is one nuance.  Using these tools can lead to deadlock (deadlock threads).  It happens like this: thread A waits for thread B to return control, and thread B, in turn, waits for thread A to execute the blocked code.  Therefore, multithreading and synchronization of threads must be used with caution. <br><br><h3>  Problems of the built-in mechanisms of a multithreading in Unity </h3><br>  The main problem we face when developing single-threaded applications is UI-friezes, caused by performing complex operations in the main thread.  Unity has a task parallelization mechanism, presented in the form of coroutine (coroutine), but it works in one thread, and if you run something ‚Äúheavy‚Äù in coroutine - hello, freeze.  If we are satisfied with the parallel execution of functions in the main thread, then we can use korutiny.  There is nothing difficult in this, in the <a href="http://docs.unity3d.com/ru/current/Manual/Coroutines.html">Unity documentation</a> this topic is very well covered.  However, I would like to remind you that corutins are iterators, which work as follows in Unity: <br><br><ul><li>  the first thing is registration korutina, </li><li>  Further, after each call to <a href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.Update.html">Update</a> and before the call to <a href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.LateUpdate.html">LateUpdate</a> , Unity polls all registered corutines and processes the code that is described inside the method that has a return type of <a href="https://msdn.microsoft.com/ru-ru/library/78dfe2yb(v%3Dvs.110).aspx">IEnumerator</a> . </li></ul><br>  In addition to the benefits, Korutin also have disadvantages: <br><br><ol><li>  Unable to get return value <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadGoogle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> www = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WWW(<span class="hljs-string"><span class="hljs-string">"http://google.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> www; <span class="hljs-comment"><span class="hljs-comment">//  www.text    . }</span></span></code> </pre> </li><li>  Error processing <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadGoogle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> www = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WWW(<span class="hljs-string"><span class="hljs-string">"http://google.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> www; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </li><li>  Crutches with callbacks <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadGoogle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; callback</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> www = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WWW(<span class="hljs-string"><span class="hljs-string">"http://google.com"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> www; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (callback != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { callback(www.text); } }</code> </pre> </li><li>  Do not handle heavyweight methods in corintry <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thread id in start method = {0}"</span></span>, Thread.CurrentThread.ManagedThreadId)); StartCoroutine(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.HardMethod()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HardMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1001</span></span>); Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thread id in HardMethod method = {0}"</span></span>, Thread.CurrentThread.ManagedThreadId)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForEndOfFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">//Output: //Thread id in start method = 1 //Thread id in HardMethod method = 1 //Thread id in HardMethod method = 1 //Thread id in HardMethod method = 1</span></span></code> </pre> </li></ol><br>  As mentioned earlier, the cortinos are run in the main thread.  For this reason, we get friezes by running heavy methods in them. <br><br>  A number of these shortcomings are easily eliminated with the help of reactive extensions, which in the future will bring many more different features and facilitate development. <br><br><h3>  What is reactive expansion? </h3><br>  Reactive extensions - a set of libraries that allow you to work with events and asynchronous calls in the style of Linq.  The task of such extensions is to simplify the writing of code, in which asynchronous interaction appears.  Unity uses the UniRx library, which provides the basic functionality of reactive extensions.  UniRx - implementation of reactive extensions for Unity based on .NET Reactive Extensions.  Why not use this native implementation?  Because standard RX in Unity do not work.  The library is cross-platform and is supported on PC / Mac / Android / iOS / WP8 / WindowsStore platforms. <br><br>  What provides us UniRx? <br><ul><li>  Multithreading </li><li>  LINQ-like methods </li><li>  Simplified syntax for asynchronous communication </li><li>  Cross platform </li></ul><br><h3>  How it works? </h3><br>  The basis of reactive extensions are the <a href="https://msdn.microsoft.com/ru-ru/library/dd783449(v%3Dvs.110).aspx"><code>IObserver</code> and</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code>IObservable</code> .</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">They provide a generic mechanism for push notifications, also known as the ‚ÄúObserver‚Äù design pattern.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <ul><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The IObservable interface represents the class that sends notifications (provider).</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The IObserver interface represents the class that receives them (the supervisor).</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">T represents a class that provides information for notifications.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The IObserver implementation prepares to receive notifications from the provider (the IObservable implementation) by passing its copy to the </a><a href="https://msdn.microsoft.com/ru-ru/library/dd782981(v%3Dvs.110).aspx"><code>IObservable.Subscribe</code></a> provider <a href="https://msdn.microsoft.com/ru-ru/library/dd782981(v%3Dvs.110).aspx"><code>IObservable.Subscribe</code> .</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"></a><a href="https://msdn.microsoft.com/ru-ru/library/dd782981(v%3Dvs.110).aspx">This method returns an</a> <a href="https://msdn.microsoft.com/ru-ru/library/system.idisposable(v%3Dvs.110).aspx">IDisposable</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd782981(v%3Dvs.110).aspx">object</a> that can be used to unsubscribe an observer before the provider completes sending notifications. <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The IObserver interface defines the following three methods that the observer must implement:</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <ul><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The </a><a href="https://msdn.microsoft.com/ru-ru/library/dd782792(v%3Dvs.110).aspx">OnNext</a> method, which is usually called by the provider to provide the observer with new data or status information. </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The </a><a href="https://msdn.microsoft.com/ru-ru/library/dd781657(v%3Dvs.110).aspx">OnError</a> method, which is usually called by the provider to indicate that the data is inaccessible, corrupted, or the provider has other errors. </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The </a><a href="https://msdn.microsoft.com/ru-ru/library/dd782982(v%3Dvs.110).aspx">OnCompleted</a> method, which is usually called by the supplier to confirm that notifications have been sent to the observer. </li></ul> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Also in UniRx Scheduler is implemented - the main component with which multithreading is implemented.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Basic time operations (Interval, Timer) in UniRx are implemented using MainThread.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">This means that most operations (except <code>Observable.Start</code> ) work in the main thread and thread safety, in this case, can be neglected.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code>Observable.Start</code> uses the ThreadPool Scheduler by default, this means that a thread will be created.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">We have familiarized with the basic concepts and theoretical knowledge, now we will consider examples of using the UniRx library.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <h4>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">An example of creating an observer</a> </h4> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">In this example, we will try to get data from an Internet resource using the UniRx library.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">To download data using reactive extensions, we need to create an observer and use the <code>ObservableWWW</code> class, which is a wrapper over the standard <code>WWW</code> Unity class.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code>Get <br></code> method</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code>Get <br></code></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">uses coroutines and returns IObservable, to which we will sign an observer.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">This approach avoids the crutches described in the ‚ÄúProblems of embedded threading mechanisms in Unity‚Äù section.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observer = Observer.Create&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( x =&gt; { Debug.Log(<span class="hljs-string"><span class="hljs-string">"OnNext: "</span></span> + x); }, ex =&gt; Debug.Log(<span class="hljs-string"><span class="hljs-string">"OnError: "</span></span> + ex.Message), () =&gt; Debug.Log(<span class="hljs-string"><span class="hljs-string">"OnCompleted"</span></span>)); ObservableWWW.Get(<span class="hljs-string"><span class="hljs-string">"http://qweqweqwe.qwer.qwer/"</span></span>).Subscribe(observer); } <span class="hljs-comment"><span class="hljs-comment">//Output: //OnError: Exception of type 'UniRx.WWWErrorException' was thrown.</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">If we change the link to an adequate one, say, at </a><a href="http://www.nixsolutions.com/">http://www.nixsolutions.com/</a> , we get the following result: <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//Output: //OnNext: ‚Äùhtml  ‚Äù //OnCompleted</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a> <h3>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Example of creating a sequence subject</a> </h3> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Here we subscribe to two Debug.Logs, the first one is always executed when the <code>OnNext</code> method is <code>OnNext</code> , and the second one is triggered only under the condition.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subject&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject.Subscribe(x =&gt; Debug.Log(x)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subject.Where(x =&gt; x % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>).Subscribe(x =&gt; Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Hello from {0}"</span></span>, x))); } <span class="hljs-comment"><span class="hljs-comment">// Update is called once per frame void Update() { this.sub.OnNext(this.i++); } //Output: //0 //Hello from 0 //1 //2 //Hello from 2</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a> <h3>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">EveryUpdate usage example</a> </h3> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">An important feature in these extensions is the <code>EveryUpdate</code> method.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">It allows you to remove the code from the Update methods and <code>MonoBehaviour</code> successor <code>MonoBehaviour</code> .</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Here we check the mouse clicks and display some text.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs">Observable.EveryUpdate() .Where(x =&gt; Input.GetMouseButton(buttonIndex)) .Subscribe(x =&gt; Debug.Log(outputString)); <span class="hljs-comment"><span class="hljs-comment">//Output: //Left button pressed //Right button pressed</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a> <h3>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">An example of working with arrays</a> </h3> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Also an interesting feature of these extensions is working with arrays.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The code that is presented below, when executed in a single-threaded application, will freeze the display stream.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = Enumerable.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> arr) { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Result = {0}, UtcNow = {1}, ThreadId = {2}"</span></span>, i, DateTime.UtcNow, Thread.CurrentThread.ManagedThreadId)); } <span class="hljs-comment"><span class="hljs-comment">//Output: //Result = 0, UtcNow = 8/25/2015 1:23:14 PM, ThreadId = 1 //Result = 1, UtcNow = 8/25/2015 1:23:16 PM, ThreadId = 1 //Result = 2, UtcNow = 8/25/2015 1:23:17 PM, ThreadId = 1 //Result = 3, UtcNow = 8/25/2015 1:23:18 PM, ThreadId = 1 //Result = 4, UtcNow = 8/25/2015 1:23:19 PM, ThreadId = 1</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">To solve this problem, you can use UniRx, with an explicit indication of the ThreadPool scheduler, which will itself distribute the load between the threads.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr2 = Enumerable.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>).ToObservable(Scheduler.ThreadPool); arr2.Subscribe( x =&gt; { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Result = {0}, UtcNow = {1}, ThreadId = {2}"</span></span>, x, DateTime.UtcNow, Thread.CurrentThread.ManagedThreadId)); }); <span class="hljs-comment"><span class="hljs-comment">//Output: //Result = 0, UtcNow = 8/25/2015 1:23:20 PM, ThreadId = 2 //Result = 1, UtcNow = 8/25/2015 1:23:21 PM, ThreadId = 3 //Result = 2, UtcNow = 8/25/2015 1:23:22 PM, ThreadId = 4 //Result = 3, UtcNow = 8/25/2015 1:23:23 PM, ThreadId = 5 //Result = 4, UtcNow = 8/25/2015 1:23:24 PM, ThreadId = 5</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">An interesting feature of this approach is that a free flow will be assigned to each iteration.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <h4>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">An example of processing complex methods</a> </h4> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">In this example, we have a couple of complex methods that, when executed in the main thread, freeze our application.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">When using Rx, everything will be fine, we will get the return values ‚Äã‚Äãfrom the methods and process them.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod = Observable.Start(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeToSleep = <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnedValue = <span class="hljs-number"><span class="hljs-number">10</span></span>; Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thread = {0} UtcNow = {1}"</span></span>, Thread.CurrentThread.ManagedThreadId, DateTime.UtcNow)); Thread.Sleep(timeToSleep); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnedValue; }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod2 = Observable.Start(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeToSleep = <span class="hljs-number"><span class="hljs-number">2000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnedValue = <span class="hljs-number"><span class="hljs-number">20</span></span>; Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thread = {0} UtcNow = {1}"</span></span>, Thread.CurrentThread.ManagedThreadId, DateTime.UtcNow)); Thread.Sleep(timeToSleep); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnedValue; }); Observable.WhenAll(heavyMethod, heavyMethod2) .ObserveOnMainThread() .Subscribe(result =&gt; { Debug.Log(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thread = {0}, first result = {1}, second result = {2} UtcNow = {3}"</span></span>, Thread.CurrentThread.ManagedThreadId, result[<span class="hljs-number"><span class="hljs-number">0</span></span>], result[<span class="hljs-number"><span class="hljs-number">1</span></span>], DateTime.UtcNow)); }); } <span class="hljs-comment"><span class="hljs-comment">//Output: //Thread = 5 UtcNow = 8/25/2015 2:06:55 PM //Thread = 3 UtcNow = 8/25/2015 2:06:55 PM //Thread = 1, first result = 10, second result = 20 UtcNow = 8/25/2015 2:06:57 PM</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a> <h3>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Example use of bindings</a> </h3> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Binding is another great mechanism.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">With it, you can easily implement the MVP pattern.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">In this example, the model is the class Enemy, in which we describe the reactive properties.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The <code>IsDead</code> property depends directly on <code>CurrentHp</code> : when it is less than zero, <code>IsDead</code> becomes = true.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Enemy</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enemy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initialHp</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CurrentHp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReactiveProperty&lt;<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt;(initialHp); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IsDead = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CurrentHp.Select(x =&gt; x &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>).ToReactiveProperty(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReactiveProperty&lt;<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt; CurrentHp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReactiveProperty&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; IsDead { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Presenter is responsible for the connection of the model and the display, with its help we can tie the reactive properties of the model to the parts of the display.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The <code>MvpExample</code> class is a presenter and has a link to both the model (the <code>Enemy</code> class) and the display ( <code>Button</code> and <code>Toggle</code> ).</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Also, due to reactive extensions, we have the ability to set the behavior of various UI elements using a code.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Using the <code>OnClickAsObservable</code> and <code>OnValueChangedAsObservable</code> we described the behavior of Button and Toggle.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MvpExample</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EnemyHp = <span class="hljs-number"><span class="hljs-number">1000</span></span>; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button myButton; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Toggle myToggle; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Text myText; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enemy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Enemy(EnemyHp); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.myButton.OnClickAsObservable().Subscribe(x =&gt; enemy.CurrentHp.Value -= <span class="hljs-number"><span class="hljs-number">99</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      CurrentHp   Enemy this.myToggle.OnValueChangedAsObservable().SubscribeToInteractable(this.myButton); //   Toggle     enemy.CurrentHp.SubscribeToText(this.myText); enemy.IsDead.Where(isDead =&gt; isDead) .Subscribe(_ =&gt; { this.myToggle.interactable = this.myButton.interactable = false; }); } }</span></span></code></a> </pre> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Next we pribindili reactive properties for UI-elements.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">When changing <code>CurrentHp</code> in <code>Enemy</code> , we will automatically change the text.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">When <code>IsDead</code> changes its state to <code>true</code> , then both the button and <code>Toggle</code> will be disabled.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a> <h3>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">findings</a> </h3> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Using reactive extensions when developing applications on Unity has many advantages.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The main one is to simplify the syntax for building multi-threaded applications.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">The number of crutches with korutinami significantly reduced, the application becomes more flexible and faster.</a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Also, when building a multi-threaded application using UniRx, it must be remembered that any part of the data must be protected from being modified by many threads.</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br><br></a>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx">Useful links:</a> <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"><br></a> <ul><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"></a><a href="">http://rsdn.ru/article/dotnet/CSThreading1.xml</a> </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"></a><a href="http://professorweb.ru/my/csharp/thread_and_files/1/1_4.php">http://professorweb.ru/my/csharp/thread_and_files/1/1_4.php</a> </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"></a><a href="https://msdn.microsoft.com/ru-ru/library/ms173179.aspx">https://msdn.microsoft.com/ru-ru/library/ms173179.aspx</a> </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/dd990377(v%3Dvs.110).aspx"></a><a href="https://github.com/neuecc/UniRx">https://github.com/neuecc/UniRx</a> </li></ul></li></ul></div><p>Source: <a href="https://habr.com/ru/post/268781/">https://habr.com/ru/post/268781/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268767/index.html">Deploying Applications in InterSystems Cach√©</a></li>
<li><a href="../268769/index.html">MiML2</a></li>
<li><a href="../268771/index.html">Using web fonts, the best way (for 2015)</a></li>
<li><a href="../268773/index.html">Imitation of the radio using Freeswitch and a little about voip-conference</a></li>
<li><a href="../268777/index.html">DevTips: Web Developer Tips (17-32)</a></li>
<li><a href="../268785/index.html">Installing a white certificate on a Microsoft VDI farm</a></li>
<li><a href="../268787/index.html">Features of software and hardware firewalls</a></li>
<li><a href="../268789/index.html">HackedSim. Call from any number - fiction or reality?</a></li>
<li><a href="../268791/index.html">How to create a cross-platform Half-Life or "Headcrabs inside your watch"</a></li>
<li><a href="../268793/index.html">We return the auto-login to the Wi-Fi network of the Moscow metro in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>