<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Efficient power consumption in Hyper-V infrastructures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Discussing power management issues is something weird in the context of Hyper-V technology, isn't it? In the end, virtual servers run on virtual hardw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Efficient power consumption in Hyper-V infrastructures</h1><div class="post__text post__text-html js-mediator-article"><p>  Discussing power management issues is <nobr>something</nobr> weird in the context of <nobr>Hyper-V</nobr> technology, isn't it?  In the end, virtual servers run on virtual hardware, however, even in this situation, the cost of electricity and cooling make up a large part of the budget, so it makes sense to think about how these resources are used. to change. <br><br></p><div style="text-align:center;"><img src="https://habrastorage.org/files/d12/4d9/11a/d124d911abd4431397a99ee91e153e1a.jpg"></div><br><a name="habracut"></a><br><h2>  Windows power plans </h2><br>  If your goal is a more balanced power consumption without a negative impact on performance, then it would be nice to start with Windows power plans.  Power plans are designed to help administrators achieve the necessary balance between power consumption and performance. <br><br>  This approach forces us to consider power plans as an automated tool for turning off power to monitors and hard drives when the system is idle.  While the power plans, of course, can do all of the above, they also tend to affect the speed of the processor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For testing, we created a new virtual machine running Windows Server 2012 R2 on the <nobr>Hyper-V</nobr> server, which also runs on Windows Server 2012 R2.  Then they downloaded the free benchmarking program NovaBench (Fig. 1).  Prior to the analysis, all other VMs were disabled so as not to distort the test results. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f1c/0a2/7eb/f1c0a27eb0584328b90802b20b5f9d63.jpg"></div><br>  <i>Figure 1. Research meal plans with NovaBench.</i> <br><br>  Windows Server 2012 R2 uses a ‚ÄúBalanced‚Äù default power plan.  In the first test, the ‚ÄúEnergy Saving‚Äù, ‚ÄúBalanced‚Äù and ‚ÄúHigh Performance‚Äù plans were tested, tuning them at the virtual machine level.  Since NovaBench offers many different tests, it was decided to run a full set of tests and fix the total score and the test score of the processor.  Higher scores reflect higher performance. <img src="http://habr.habrastorage.org/post_images/330/ed7/08a/330ed708a1aa493498f25de98a59cf09.gif"><br><br>  Upon receipt of the first indicators (see Table 1), we noticed that the scores gradually decreased with each test passed, regardless of which power plan was used.  After several checks, it was discovered that it was caused by Windows Update, which were disabled before the analysis began. <br><br><img src="https://habrastorage.org/files/89c/cec/e34/89ccece34ca54dca885ee3efa27b9105.jpg"><br>  <i>Table 1 Test 1: Virtual Machine Power Plans</i> <br><br>  The full test results for the energy saving plan in Figure 2. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a6b/f2f/33f/a6bf2f33f1a94d9980750676ae56a9ba.jpg"></div><br>  <i>Fig.</i>  <i>2. Results of testing a virtual machine configured to use an energy-efficient power scheme.</i> <br><br>  For the second test (Table 2), the same power plans were checked, but this time configured at the host level.  The VM was set up to use a balanced plan, and indicators were collected inside the VM. <br><br><img src="https://habrastorage.org/files/872/efe/7d5/872efe7d579f43baa77f58901964b4b3.JPG"><br>  <i>Table 2 Test 2: Hypervisor Power Plans</i> <br><br>  The results of these tests are quite interesting.  When the power mode at the VM level was adjusted to high-performance, it actually led to a lower score (probably as a result of a background system process performing <nobr>some</nobr> task).  However, the results of the processor were almost identical for all power plans. <br><br>  When the power plan was configured at the hypervisor level, there was a huge drop in performance when the power saving mode was activated, and a slight increase in performance when the high performance mode was turned on. <br><br>  By the way, the power plan can be changed when you open the control panel and go to the indicators "Equipment / Energy parameters".  It is worth noting that, as a rule, it is preferable to set up a power plan at the group policy level.  You can find the necessary settings in Computer Configuration |  Administrative Templates |  System |  Power Management (Computer Configuration | Administrative Templates | System | Power Management).  The parameter you need is a ‚ÄúSelect‚Äù active power circuit, as shown in Figure 3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c6a/83f/7f2/c6a83f7f2d494b788aaf0b7d7f2af685.jpg"></div><br>  <i>Figure 3. Using group policies to manage your power plan</i> <br><br>  When implemented at the level of the parent operating system, the power plan determines how much power the server will consume and also affects the performance of the server.  This raises a number of questions: <br><br><ol><li>  Does the cost compensate for the advantage of using more power? </li><li>  Is this high performance suitable for any load? </li><li>  Is there a way to use less energy without giving up high performance? </li></ol><br>  Since it‚Äôs not always possible to quickly find answers to the first two questions, there are several different strategies that can be used to reduce energy consumption while maintaining a high level of performance.  It is worth noting that both of these strategies require System Center Virtual Machine Manager (VMM), since the required functionality is missing and does not exist in <nobr>Hyper-V</nobr> Manager or in the Windows operating system. <br><br><h2>  Using host groups </h2><br>  One option for managing the power consumption of <nobr>Hyper-V</nobr> is to use VMM host groups.  Host groups are nothing more than a set of host servers and host clusters. <br><br>  As you know, you can group servers in Active Directory and assign different group policies for each group.  In this way, you can assign a balanced power plan to one group of <nobr>Hyper-V</nobr> hosts and a high-performance plan to another group.  You can then create two corresponding separate host groups in VMM.  You can then place the <nobr>Hyper-V</nobr> hosts or clusters in the appropriate groups based on their group policies. <br><br>  After the <nobr>Hyper-V</nobr> hosts are distributed into groups, you can begin moving virtual machines based on performance needs.  Demanded virtual machines, such as <nobr>SQL servers</nobr> , probably need to be hosted on a host using a high-performance plan, while less demanding virtual machines, such as file servers or DHCP servers, can be hosted on a balanced power plan or even energy-efficient. . <br><br>  This distribution can be easily organized in many companies, since it is a common policy to organize host groups based on hardware capabilities.  For example, we met a company that uses a group of hosts called Gold Tier (or something similar), which contains the most high-performance virtualization hosts and is used for the most demanding virtual machines.  Adding an appropriate power plan for servers included in such a host group is fairly straightforward. <br><br><h2>  Energy Optimization </h2><br>  The second way to control the power consumption of <nobr>Hyper-V</nobr> is the VMM Power Optimization feature.  The basic idea is quite simple: in many companies there is a certain time of the day (or night) when the load is relatively small.  At this time, you can perform dynamic migration of virtual machines to alternate hosts of <nobr>Hyper-V</nobr> nodes in order to facilitate some servers.  In this case, empty hosts can be disabled until they become necessary.  At such moments, the hosts can be transferred to the backup state, and the load can be redistributed to use the available resources efficiently. <br><br>  There are several prerequisites that must be met in order to use energy optimization.  <nobr>First</nobr> , you need a suitable failover cluster.  Typically, the cluster will need at least five hosts, but you can use 4 as well if the cluster was created using VMM.  The reason is that the power optimization is designed to keep the cluster from losing quorum.  In this scenario, it will keep the minimum number of cluster hosts online, plus one additional node (in case of failure). <br><br>  As a rule, the smallest number of hosts that can support this model is five.  In a <nobr>five-node</nobr> cluster, at least three nodes must remain online in order to maintain the quorum.  When adding an additional host that will remain online in the event of a failure, the number of hosts required in the online state grows to four.  Consequently, a <nobr>five-node</nobr> cluster is the smallest cluster that can benefit from power optimization with one exception: if the cluster was created using VMM, it can use a disk instead of a host.  <nobr>Due to</nobr> node requirements, larger clusters tend to benefit most from energy savings. <br><br>  The second requirement is that the cluster nodes must be equipped with a Baseboard Management Controller (BMC) controller.  The controller provides out-of-band node management.  This is a mechanism that allows a host to shut down and start up again without administrator intervention. <br><br>  In Microsoft, it‚Äôs easy to set up power saving features: open the VMM console, then find the group of nodes containing the cluster for which you want to enable power optimization.  Next, right-click on the host group and select the "Properties" command in the context menu.  When you do this, the console will display the ‚ÄúProperties‚Äù window of the host group. <br><br>  Power optimization options are located on the Dynamic Optimization tab.  Dynamic optimization is a VMM feature that automatically performs load balancing of virtual machines running in a host cluster.  At the bottom of the window there is a checkbox with which you can enable power saving features.  This box is unavailable by default, but can be enabled by selecting the option to automatically migrate virtual machines for workload distribution, as shown in Figure 4. <br><br><img src="https://habrastorage.org/files/5f8/f06/dd2/5f8f06dd259843f69ae4d496f6e0ee11.jpg"><br>  <i>Figure 4. Enable automatic load balancing before enabling energy optimization.</i> <br><br>  Before turning on the power saving function, you should pay attention to two parameters.  <nobr>First</nobr> , the ‚ÄúAggressiveness‚Äù setting shown in fig.  4, as a rule, should be set at an average level.  Using more aggressive optimizations will result in a more balanced workload, but can cause live migrations that will occur so often that they will ultimately affect performance. <br><br>  Another parameter is the load balancing frequency.  This number determines how often VMM checks if virtual machines need Live Migrations.  The reason why you should pay attention to this value is that it is also used to optimize nutrition.  When the nodes are de-energized as a result of the power optimization function, VMM by default checks every 10 minutes whether the nodes should be returned to the online state. <br><br>  If you click the Parameters button shown in Figure 4, you will be taken to the Energy Optimization Schedule Settings dialog box shown in Figure 5. As you can see, this allows you to set the energy optimization schedule and the corresponding set of threshold values. <br><br><img src="https://habrastorage.org/files/02a/ba3/d44/02aba3d444a143429391a361f0e93c3c.jpg"><br>  <i>Figure 5. Setting the schedule for energy optimization</i> <br><br>  Keep in mind that the cluster nodes will not automatically turn off only when the set time is reached.  Before shutting down <nobr>any</nobr> nodes, VMM checks that the virtual machines can be moved to other nodes in the cluster without affecting performance and without depleting the hardware resources of the remaining nodes to the level of the threshold values ‚Äã‚Äãshown in the figure. <br><br><h2>  Energy saving </h2><br>  Power management is a problem for large and small data centers, because power and cooling tend to be a significant percentage of the total <nobr>IT budget</nobr> .  It is worth taking the time to develop a power management plan for the <nobr>Hyper-V</nobr> hosts in each company to get the potential to reduce energy consumption and reduce operating costs in the end. <p></p></div><p>Source: <a href="https://habr.com/ru/post/315460/">https://habr.com/ru/post/315460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315448/index.html">GitLab 8.13 release</a></li>
<li><a href="../315450/index.html">The reason for the misunderstanding between us and the misuse of technology. Based on the article "Five Worlds" (software)</a></li>
<li><a href="../315452/index.html">Microsoft has received the status of a platinum member of the Linux Foundation.</a></li>
<li><a href="../315454/index.html">Creating and testing a firewall in Linux, Part 1.3. Writing char device. Adding a virtual file system ...</a></li>
<li><a href="../315458/index.html">Black Friday - how to avoid falling services?</a></li>
<li><a href="../315462/index.html">Human factor</a></li>
<li><a href="../315468/index.html">Stripe Service Discovery</a></li>
<li><a href="../315470/index.html">History of programming languages: from BASIC to Visual Basic</a></li>
<li><a href="../315472/index.html">Cloud on Microsoft Hyper-V, Part 3: Storage Spaces Storage</a></li>
<li><a href="../315474/index.html">Snowden to Russia, Hammond behind bars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>