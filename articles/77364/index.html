<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We deal with the problem of dead code and inclusions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about some of the sometimes overlooked aspects of developers that affect the overall performance of a web application. In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We deal with the problem of dead code and inclusions</h1><div class="post__text post__text-html js-mediator-article">  In this article we will talk about some of the sometimes overlooked aspects of developers that affect the overall performance of a web application.  In particular, let us consider how the performance of multiple connections of external files, the presence of dead code, acceleration through the cache of the opcode and FastCGI for PHP affects the performance. <br><a name="habracut"></a><br>  To some extent, the article is a consequence of the topic <a href="http://habrahabr.ru/blogs/webdev/66309/">‚ÄúStoring the code in the database or building the code block by brick‚Äù</a> , since it was after him that there were multiple questions about performance (by the way, not so long ago, <a href="http://dowith.ru/">another project</a> based on this technology of storing all the code in the database started) .  One of the advantages of the considered approach was the possibility of obtaining at the output a pure monolithic code that does not contain ‚Äúdead‚Äù sections and connections of external files (for example, by means of <strong>include</strong> or <strong>require</strong> . Further, for simplicity, we call this simply ‚Äúincloud‚Äù).  For those who are not familiar with the topic, I will explain that the code is ‚Äúdead‚Äù, which will not be executed on the page. <br><br><br><blockquote>  A bit of science.  Here is what the <strike>director of the Institute of System Design of the Russian Academy of Sciences, Corresponding Member of the Russian Academy of Sciences,</strike> one authoritative uncle Viktor Ivannikov, tells about the dead code: <br><br>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúA dead code is such a part of a program or circuitry that is never, under any conditions, under any input data being executed. This is a significant problem, especially for systems with limited memory.  Dead code can take up to 30% of the program, especially it turns out a lot with the development of applications, because they bring in more and more new pieces.  The dead code problem is <strong>algorithmically unsolvable</strong> .  This means that I can not create a tool that would find dead code for any program. <br><br><br>  This problem became interested in the early 50s.  The corresponding Rice theorem and the Ouspensky theorem were proved simultaneously and independently, only Vladimir Andreevich can be formulated more generally.  Theorems actually state that recognition of any non-trivial property of an algorithm is an insoluble problem. ‚Äù <br><br><br>  From myself I will add that in web programming the amount of dead code is usually an order of magnitude larger.  With a swap connection, its share easily exceeds the threshold and is 80-90%.  That is, only every 20 line of code will actually be executed.  This is especially clearly seen when using "heavy" frameworks. <br><br><br><br>  Here we introduce a couple of definitions that we will use below: <br>  <strong>monolith</strong> - a code that does not use external file connections (inclusions) <br>  <strong>pure monolith</strong> is a monolith in which there is no dead code. <br></blockquote><br><br><br><br>  As stated, pure monolithic code significantly increases the overall performance of the application, which caused a lot of controversy and suspicion in the comments.  Fairly, there were questions about how ‚Äúdead‚Äù code and all applications slow down applications?  And as a solution to problems with the performance and purity of the code, the <strong>opcode caches</strong> were mentioned, the ‚Äúmagic‚Äù functions of autoconnection of classes and methods (hereinafter, for simplicity we will call this simply <strong>autoload</strong> ), as well as <strong>fastCGI</strong> . <br><br><br>  Well, let's try to sort out the question in search of truth.  So let's go. <br><br><br><h4>  Is there a problem? </h4><br>  To begin with, let's try to figure out how generally the dead code and the inclusions affect performance. <br><br><br><br>  Let's start with the dead code.  Create pages for 2000, 5000, 10000 lines of code and set the apacheBenchmark on them.  We get the following results: <br><br><table><tbody><tr><th>  number of lines </th><th>  requests / sec </th><th>  average request time </th><th>  dead code rate </th></tr><tr><td>  2000 </td><td>  72.24 </td><td>  0.013 </td><td>  0 </td></tr><tr><td>  5000 </td><td>  32.20 </td><td>  0.031 </td><td>  0.6 </td></tr><tr><td>  10,000 </td><td>  15.97 </td><td>  0.062 </td><td>  0.75 </td></tr></tbody></table><br><blockquote>  Hereinafter, the time obtained on an old FS Amilo 1718 laptop is indicated. The results of control tests conducted on different systems with different OS and FS did not differ in proportion <br></blockquote><br><br><br>  As you can see, the time spent on processing the script is actually directly proportional to the number of lines in it (which is quite logical, since we do not do anything in the script, most of the time is spent on its parsing. More lines - correspondingly more parsing time).  How big is this time?  It is <strong>significant</strong> .  Agree, even ideally, in the absence of a dead code, 13 thousandths are a lot (not to mention 62, as in the third test).  During this time, you can give the finished page by doing a connection to the database, requests, and so on.  There is only parsing ... <br><br><br>  Now let's deal with the inclusions.  We will simulate 4 situations: <br>  - "monolith" (without inclodes and dead code) <br>  - "swap" (Simulates the unconditional connection of all libraries, which are usually combined into large files. It involves <strong>few large files</strong> . A lot of dead code) <br>  - ‚Äúautoload‚Äù (Simulates connecting classes / methods / functions if necessary (usually at the time of accessing a nonexistent class / method / function). It entails <strong>many small files</strong> . Almost no dead code) <br>  - A couple of intermediate states between a swap and autoload.  <strike>Just for fun</strike> To complete the picture :) <br><br>  The results are shown in the following table (in performance order): <br><br><table width="750"><tbody><tr><th>  number of lines </th><th>  inclodes </th><th>  requests / sec </th><th>  average request time </th><th>  dead code rate </th><th>  imitation type </th></tr><tr><td>  2000 </td><td>  0 </td><td>  72.24 </td><td>  0.013 </td><td>  0 </td><td>  pure monolith </td></tr><tr><td>  2000 </td><td>  60 </td><td>  35.12 </td><td>  0.028 </td><td>  0 </td><td>  autoload </td></tr><tr><td>  5000 </td><td>  7 </td><td>  25.63 </td><td>  0.039 </td><td>  0.6 </td><td>  - </td></tr><tr><td>  10,500 </td><td>  14 </td><td>  13.2 </td><td>  0.076 </td><td>  0.81 </td><td>  - </td></tr><tr><td>  15,000 </td><td>  five </td><td>  9.78 </td><td>  0.1 </td><td>  0.87 </td><td>  swap </td></tr></tbody></table><br><br>  As expected, in the first place is a monolith, in the second with an almost two-fold lag autoload.  Well, the swap nervously smokes on the sidelines :) (The truth is only for now, then he will kick the ass off the car. Read the article further).  But the time to process the request is still very long ... <br><br><blockquote>  By the way, this table just confirms the number I indicated in the received gain of 600% when the system is transferred to a pure monolith. <br></blockquote><br><br><br><h4>  There is a problem - there is a solution </h4><br>  The main means of solving problems and increasing application performance by reducing the cost of parsing pages are cache bytes of code.  The most well-known caching systems (in PHP, for example) are <a href="http://eaccelerator.net/">eAccelerator</a> , <a href="httpd.net/">xCache</a> and <a href="http://www.php.net/apc">APC</a> .  For testing, eAccelerator was chosen as the most common and fastest in terms of our task.  In some detail, comparing caching systems can be found <a href="http://club.shelek.ru/viewart.php%3Fid%3D300">here</a> .  Here are the results using the opcode cache (in order of performance): <br><br><br><table width="750"><tbody><tr><th>  number of lines </th><th>  inclodes </th><th>  requests / sec <br>  (without opcode cache) </th><th>  requests / sec <br>  with opcode cache </th><th>  acceleration factor </th><th>  imitation type </th></tr><tr><td>  2000 </td><td>  0 </td><td>  72.24 </td><td>  412.86 </td><td>  5.71 </td><td>  pure monolith </td></tr><tr><td>  15,000 </td><td>  five </td><td>  9.78 </td><td>  204.6 </td><td>  20.92 </td><td>  swap </td></tr><tr><td>  10,500 </td><td>  14 </td><td>  13.2 </td><td>  192.2 </td><td>  14.56 </td><td>  - </td></tr><tr><td>  2000 </td><td>  60 </td><td>  35.12 </td><td>  112.11 </td><td>  3.19 </td><td>  autoload </td></tr></tbody></table><br><br><br>  And here we see very interesting facts.  When using the opcode cache, despite the huge amount of dead code, the <strong>swap connection is almost 2 times more efficient than autoload</strong> !  And all thanks to the insane acceleration rate of 21x.  But with autoload, the acceleration factor turned out to be the lowest - the cache of the opcode only 3 times reduced costs.  From here we make an uncomplicated conclusion: the opcode cache practically solves the problem of a ‚Äúdead‚Äù code, but <strong>does not solve the problem of inclusions.</strong> Keshera also do not like a large number of small files, showing them the smallest rate of performance increase. <br><br><br><h4>  What about FastCGI? </h4><br>  According to many, another way to speed up scripts and reduce the cost of "loading" the script is running PHP in FastCGI mode.  <strong>This is not true!</strong>  .  Why fastCGI does not speed up PHP, you can read <a href="http://dklab.ru/chicken/nablas/49.html">here</a> Koterov.  By the way, his eAccelerator tests were also conducted there using the example of the <a href="http://framework.zend.com/">Zend Framework</a> .  The results obtained by Dmitry Koterov are very close to those given in this topic. <br><br><br><h4>  Conclusion </h4><br>  The purpose of the article was to give a detailed look at the effect of the dead code and the connection of external files in the code to the final performance of the application.  As you can see the influence of these factors is quite significant. <br><br>  The article is written by <a href="http://habrahabr.ru/users/napolsky/" class="user_link">Napolsky</a> , for <a href="http://habrahabr.ru/users/napolsky/" class="user_link">obvious</a> reasons, it could not publish it.  All + in his karma;) </div><p>Source: <a href="https://habr.com/ru/post/77364/">https://habr.com/ru/post/77364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../77350/index.html">The Stockholm court accepted the appeal of the founders of The Pirate Bay</a></li>
<li><a href="../77351/index.html">Overclocking Canon 400d to 3200 ISO</a></li>
<li><a href="../77354/index.html">BlogNetStory - literary game for bloggers</a></li>
<li><a href="../77355/index.html">You learned about the Goolge Public DNS, and what did you do next?</a></li>
<li><a href="../77358/index.html">Habradget for Windows 7 / Vista</a></li>
<li><a href="../77366/index.html">Shame on Yandex for his search for letters in the mail interface</a></li>
<li><a href="../77369/index.html">problems with gwt in ubuntu linux</a></li>
<li><a href="../77371/index.html">Why train GLONASS?</a></li>
<li><a href="../77372/index.html">Those on whom the connection rests</a></li>
<li><a href="../77373/index.html">Sensor Examples for Windows 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>