<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of 802.1x for computers behind "stupid" phones</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many different languages ‚Äã‚Äãwritten on how to implement computer authentication on various RADIUS servers, including scenarios when the compu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of 802.1x for computers behind "stupid" phones</h1><div class="post__text post__text-html js-mediator-article">  There are many different languages ‚Äã‚Äãwritten on how to implement computer authentication on various RADIUS servers, including scenarios when the computer is connected to the network via the integrated switch in the phone, but these articles mention smart IP phones that support CDP or LLDP and can work with Voice Vlan. <br>  Unfortunately, I had to work with what is, namely the IP phone of the Panasonic KX-NT321, working under a proprietary protocol, neither LLDP, nor even CDP, or even TFTP configuration downloads.  But you can configure from the phone itself tagging on each of the switch port. <a name="habracut"></a><br>  So, what we have: RADIUS based on Microsoft NPS, Cisco 2960 switches, Panasonic IP phones and computers. <br>  I will not consider the basic configuration of RADIUS and switches, we will assume that our switches are already clients. <br>  Since  phones do not understand EAPoL packages, we will apply MAB (MAC Authentication Bypass) technology to them.  In short, the switch takes the mac address of the phone and sends it as a login / password on RADIUS for authentication, described in <a href="http://www.cisco.com/en/US/prod/collateral/iosswrel/ps6537/ps6586/ps6638/config_guide_c17-663759.html">more detail</a> on cisco.com <br>  And for computers we will use 802.1x, we will take for the fact that everything on our computer is configured properly. <br>  Accordingly, we should have 802.1x and MAB enabled on the switch port, for this we need only the MDA (Multidomain Authentication Mode) mode in more detail about the modes <a href="http://www.cisco.com/en/US/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/dot1x.html">here</a> and thus the port configuration will be as follows: <br><pre><code class="bash hljs">interface FastEthernet0/2 switchport access vlan 99 switchport mode access switchport voice vlan 2 authentication host-mode multi-domain authentication order mab dot1x authentication port-control auto authentication periodic mab dot1x pae authenticator dot1x timeout tx-period 3 spanning-tree portfast</code> </pre> <br>  The <b>mab</b> command is required because  without it, the switch sends packets using EAP-MD5 authentication, but MS NPS does not accept this mode, so you need to use PAP. <br>  We collect mac addresses of our phones and add them to ActiveDirectory in a separate OU and security group (let's call them Phone) as regular users with a login and password as the address of our phones. <br>  In NPS we create a rule for phones: <br><img src="https://habrastorage.org/getpro/habr/post_images/9b4/55b/927/9b455b927eb5c0e323f432bccaf37019.png" alt="image"><br><br>  The <b>device-traffic-class = voice</b> parameter tells the switch that this device will go to voice vlan. <br>  The <b>Tunnel-Pvt-Group-ID</b> parameter tells the switch which Vlan the device will fall into, but in our case it will not work, because  we set up the vlans with our hands on the phone. <br><br>  Create a similar rule for computers: <br><img src="https://habrastorage.org/getpro/habr/post_images/16e/4e5/53c/16e4e553c04ffc34cd301a4cfbc329a7.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You also need to create a connection request policy with permission to use PAP. <br><br>  In the switch, you can manually set a password for MAB requests, i.e.  sending a request for authentication in the login line will be the mac address, and in the password line, what we manually specify on the switch: <br><pre> <code class="bash hljs">(config)<span class="hljs-comment"><span class="hljs-comment">#mab request format attribute 2 yourpassword</span></span></code> </pre>  Then in AD all phone accounts must have this password. <br><br>  Used materials: <br>  <a href="http://www.cisco.com/en/US/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/dot1x.html">IEEE 802.1X Port-Based Authentication</a> <br>  <a href="http://www.cisco.com/en/US/prod/collateral/iosswrel/ps6537/ps6586/ps6638/config_guide_c17-663759.html">MAC Authentication Bypass Deployment Guide</a> </div><p>Source: <a href="https://habr.com/ru/post/196930/">https://habr.com/ru/post/196930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196916/index.html">Agile application in a fixed phase contract</a></li>
<li><a href="../196920/index.html">God bless Dynamic SQL</a></li>
<li><a href="../196922/index.html">How to cheap print a book in Linux</a></li>
<li><a href="../196924/index.html">Overview of the new TI Launchpad (MSP-EXP430F5529LP or MSP430F5529 USB LaunchPad)</a></li>
<li><a href="../196926/index.html">Booting Linux without bootloader</a></li>
<li><a href="../196932/index.html">11 years of playing Civilization II without restarting: continuing the story</a></li>
<li><a href="../196936/index.html">Subtleties in the process of design for startups</a></li>
<li><a href="../196938/index.html">LG G2: outside and inside the new Korean flagship</a></li>
<li><a href="../196940/index.html">Police London City successfully fights with the largest torrent trackers</a></li>
<li><a href="../196942/index.html">MSI Slidebook S20 Ultrabook Transformer Video Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>