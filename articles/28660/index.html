<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security. Modification of the kernel code of the platform with loadable applets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everything described below applies only to the client part implemented in JavaScript. Criticism of a technical nature (for example, a detour route) is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security. Modification of the kernel code of the platform with loadable applets</h1><div class="post__text post__text-html js-mediator-article">  Everything described below applies only to the client part implemented in JavaScript.  Criticism of a technical nature (for example, a detour route) is welcome, but not a critique in the style of ‚Äúwhat for‚Äù. <br><br>  When developing a module for connecting applets to a certain platform (let's call it Hyper), there was a security problem, since the plug-in applet, besides the passive data block (content), also contains an active (code).  And in the active block, an inattentive developer (attacker) can access the global window object and access variables or important kernel methods and make a substitution, which at best will simply lead to the collapse of the platform (within the browser of course), and at worst install various hooks not affecting the operation of the system, but intercepting the user's personal data.  In the future, an unsuspecting user will use the ‚ÄúWatch from Bob‚Äù gadget, which collects information about it quietly or sends spam to addresses from the contact list. <br><a name="habracut"></a><br>  The problem of collisions of global variables has already been considered and <a href="http://habrahabr.ru/blog/javascript/42315.html">a solution has been proposed to isolate the loadable code</a> from the platform core code.  Everyone knows that when creating a variable in the global namespace, it becomes a property of the window object.  For example, var a = 10;  same window.a = 10; <br><br>  Our task is to isolate the kernel code so that third-party scripts could not access it.  Isolation is based on creating an anonymous function and instantly calling this function to initialize local variables and objects. <br>  Example: (function () {a = 10;}) ();  The function is anonymous and will not be visible through the window object. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's get a simple kernel: <br><br><blockquote>  <font color="black"><font color="#0000ff">var</font> Core = {};</font> <font color="black"><br></font>  <font color="black">Core.sName = <font color="#A31515">"MyCore"</font> ;</font> <font color="black"><br></font>  <font color="black">Core.MyMethod = function (sMyValue) {alert (sMyValue);</font>  <font color="black">};</font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  Isolate the core: <br><br><blockquote>  <font color="black">(function () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> Core = {};</font> <font color="black"><br></font>  <font color="black">Core.sName = <font color="#A31515">"MyCore"</font> ;</font> <font color="black"><br></font>  <font color="black">Core.MyMethod = function (sMyValue) {alert (sMyValue);</font>  <font color="black">};</font> <font color="black"><br></font>  <font color="black">}) ();</font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  Now create the applet download function: <br><br>  Applet.Link = function (sCode, oContext) {(new Function (sCode)). Call (oContext);  } where <br><br>  sCode is the applet's executable code, oContext is an important parameter.  More broadly, this is the notion of context from the desktop world.  Who wrote in assembler under protected mode will understand what they mean.  Briefly, the context contains information about the state of the system.  In desktop applications, register information is stored there, i.e.  the application itself can change them without disrupting the entire system.  In our case, the context contains the variables and platform objects necessary for the applet to work.  Our task when launching the execution applet is to create a context.  To do this, we need to know which variables and platform methods the applet code needs.  We will consider the already created objects.  Suppose an applet needs the MyMethod method from the Core namespace. <br>  We will do the creation of the context manually (in Hyper, this is all automated, there is an applet handle in xml format and the concept of ImportBlock, which lists imported variables and objects).  The article for the assimilation of the material is all simplified.  So we get the context: var oContext = {MyMethod: Core.MyMethod)}.  Let's combine it all in the code: <br><br><blockquote>  <font color="black">(function () {</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Core module.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> Core = {};</font> <font color="black"><br></font>  <font color="black">Core.sName = <font color="#A31515">"MyCore"</font> ;</font> <font color="black"><br></font>  <font color="black">Core.MyClass = function () {};</font> <font color="black"><br></font>  <font color="black">Core.MyClass.prototype.MyMethod = function (sMyValue) {alert (sMyValue);</font>  <font color="black">};</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Applet module.</font></font> <font color="black"><br></font>  <font color="black">Applet = {};</font> <font color="black"><br></font>  <font color="black">Applet.Link = function (sCode, oContext) {( <font color="#0000ff">new</font> Function (sCode)). Call (oContext);</font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Load applet module.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> sCode = <font color="#A31515">"this.MyMethod ('Hello world');"</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> oContext = {MyMethod: Core.MyMethod};</font> <font color="black"><br></font>  <font color="black">Applet.Link (sCode, oContext);</font> <font color="black"><br><br></font>  <font color="black">}) ();</font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  What happens in the resulting code?  An applet is created with the code: this.MyMethod ('Hello world');  Since the function with this code was launched in the context of the oContext object containing the property MyMethod, this property is available in the body of this function through this.  Running the applet will output an alert with the text Hello world.  Back to the attackers or just inattentive developers. <br>  Applet # 1 was created with the code and launched for execution: <br><br><blockquote>  <font color="black"><font color="#0000ff">this</font> .MyMethod = function () {alert ( <font color="#A31515">"Hack !!!"</font> )};</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">this</font> .MyMethod ( <font color="#A31515">'Hello world !!!'</font> );</font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  As a result, this applet will show an alert with the text Hack.  The applet is trying to replace a method from the Core namespace, but in fact it will change the method only in its context.  And so another applet using the same method will work fine. <br><br>  Created applet # 2 with code and running for use: <br><br>  Core.MyMethod = function () {alert ('Hack !!!');  }; <br><br>  Here the attacker brazenly tried to change the Core.MyMethod, but his applet will work with an error, because the Core is undefined and we know why. <br>  And now all the code: <br><br><blockquote>  <font color="black">(function () {</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Core module.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> Core = {};</font> <font color="black"><br></font>  <font color="black">Core.sName = <font color="#A31515">"MyCore"</font> ;</font> <font color="black"><br></font>  <font color="black">Core.MyMethod = function (sMyValue) {alert (sMyValue);</font>  <font color="black">};</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Applet module.</font></font> <font color="black"><br></font>  <font color="black">Applet = {};</font> <font color="black"><br></font>  <font color="black">Applet.Link = function (sCode, oContext) {( <font color="#0000ff">new</font> Function (sCode)). Call (oContext);</font>  <font color="black">};</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Load applet module from hacker # 1.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> sCode = <font color="#A31515">"this.MyMethod = function () {alert ('Hack !!!');</font></font>  <font color="black"><font color="#A31515">};</font></font>  <font color="black"><font color="#A31515">this.MyMethod ('Hello world'); "</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> oContext = {MyMethod: Core.MyMethod};</font> <font color="black"><br></font>  <font color="black">Applet.Link (sCode, oContext);</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Load applet module from hacker # 2.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> sCode = <font color="#A31515">‚ÄúCore.MyMethod = function () {alert ('Hack !!!');</font></font>  <font color="black"><font color="#A31515">}; "</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> oContext = {MyMethod: Core.MyMethod};</font> <font color="black"><br></font>  <font color="black">Applet.Link (sCode, oContext);</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// Load applet module from right developer.</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> sCode = <font color="#A31515">"this.MyMethod ('Hello world');"</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> oContext = {MyMethod: Core.MyMethod};</font> <font color="black"><br></font>  <font color="black">Applet.Link (sCode, oContext);</font> <font color="black"><br><br></font>  <font color="black">}) ();</font> <font color="black"><br></font>  <font color="gray">* This source code was highlighted with <a href="http://poison.qsh.ru/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br>  IMPORTANT!!!  When forming the context, it is necessary to watch out for the link to the object, otherwise the malicious applet will be able to replace the whole object with the methods and the whole platform will work with the malicious code.  The problem is solved by writing a function for the formation of the context, which takes into account everything that is imported and produces a copy of the object hierarchy. <br><br>  <b>Conclusion:</b> The second security issue of a platform with the possibility of developing applets for it was considered.  The first, I remind you, is the <a href="http://habrahabr.ru/blog/javascript/42315.html">collision of variable names in the global namespace</a> .  There is a third problem that is access to global browser properties (window, document, etc.), but this topic is for another article. </div><p>Source: <a href="https://habr.com/ru/post/28660/">https://habr.com/ru/post/28660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../28659/index.html">Another pearl of Yandex</a></li>
<li><a href="../286590/index.html">For 2 years graduates of the Moscow Institute of Physics and Technology created the largest skype school in Russia</a></li>
<li><a href="../286592/index.html">SAP presents tools for working with analytics.</a></li>
<li><a href="../286594/index.html">Mail.Ru Group reviews monetization processes</a></li>
<li><a href="../286598/index.html">Why Ilon Musk is the exception rather than the rule</a></li>
<li><a href="../286602/index.html">The largest advertisers of Runet at the end of last year according to RBC</a></li>
<li><a href="../286604/index.html">37 tools to increase conversion and sales growth</a></li>
<li><a href="../286606/index.html">Oktogo online hotel booking service received more than $ 5 million in the next round of investment</a></li>
<li><a href="../286608/index.html">The head of Roskomnadzor doubts the advisability of blocking anonymizers</a></li>
<li><a href="../28661/index.html">Universal Annihilator Landscape Light - Intellectual and Apple Products</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>