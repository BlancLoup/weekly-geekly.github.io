<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with the server using Alamofire on Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just want to say, this article is intended primarily for beginners. There will be no best practice, creation of services, repositories and other code ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with the server using Alamofire on Swift</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/2a1/265/597/2a1265597ac54858ab6fd833e537ca99.png"></p><br><p>  Just want to say, this article is intended primarily for beginners.  There will be no best practice, creation of services, repositories and other code optimization.  I'll tell you about the basics of working with queries and show application with examples. </p><br><h2 id="soderzhanie">  Content </h2><br><ul><li>  <a href="https://habr.com/ru/post/330760/">What for</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Installation</a> </li><li>  <a href="&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiZvxrdPEzSAB7ksjh7l4Neg0Q4jg#setup-">HTTP access setup</a> </li><li>  <a href="https://habr.com/ru/post/330760/">The first minimum request</a> </li><li>  <a href="https://habr.com/ru/post/330760/">More about the minimum</a> </li><li>  <a href="&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiZvxrdPEzSAB7ksjh7l4Neg0Q4jg#">HTTP methods</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Alamofire.request</a> <br><ul><li>  <a href="https://habr.com/ru/post/330760/">URLConvertible</a> </li><li>  <a href="&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiZvxrdPEzSAB7ksjh7l4Neg0Q4jg#">HTTPMethod</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Parameters</a> </li><li>  <a href="https://habr.com/ru/post/330760/">ParameterEncoding</a> </li><li>  <a href="&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiZvxrdPEzSAB7ksjh7l4Neg0Q4jg#">Httpheaders</a> </li><li>  <a href="https://habr.com/ru/post/330760/">DataRequest</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/330760/">Response processing</a> <br><ul><li>  <a href="https://habr.com/ru/post/330760/">Manual response processing</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Request setup</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/330760/">Response result processing</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Different types of answers</a> <br><ul><li>  <a href="https://habr.com/ru/post/330760/">responseJSON</a> </li><li>  <a href="https://habr.com/ru/post/330760/">responseData</a> </li><li>  <a href="https://habr.com/ru/post/330760/">responseString</a> </li><li>  <a href="https://habr.com/ru/post/330760/">response</a> </li><li>  <a href="https://habr.com/ru/post/330760/">responsePropertyList</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/330760/">Download progress</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Examples</a> <br><ul><li>  <a href="https://habr.com/ru/post/330760/">Creating an object (POST)</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Object Update (PUT)</a> </li><li>  <a href="https://habr.com/ru/post/330760/">Upload photos to the server (multipartFormData)</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/330760/">Total</a> </li></ul><a name="habracut"></a><br><h2 id="zachem-anchorwhyanchor">  What for <a name="why"></a></h2><br><p>  So, we needed to process data from the server.  This task is present in almost all mobile applications. </p><br><p>  There is a native tool for this - <strong>URLSession</strong> , but working with it is a bit more difficult than we would like.  To facilitate this process, there is a framework <strong>Alamofire</strong> - a wrapper over URLSession, which greatly simplifies life when working with the server. </p><br><h2 id="ustanovka-anchorsetupanchor">  Installation <a name="setup"></a></h2><br><p>  We use <strong>CocoaPods</strong> .  working with him is very easy and quick. </p><br><p>  Add to the <strong>Podfile</strong> : </p><br><pre><code class="ruby hljs">pod <span class="hljs-string"><span class="hljs-string">'Alamofire'</span></span></code> </pre> <br><p>  To use <strong>Alamofire</strong> version <strong>4+</strong> , the following requirements are required: </p><br><ul><li>  iOS 9.0+ / macOS 10.11+ / tvOS 9.0+ / watchOS 2.0+ </li><li>  Xcode 8.0+ </li><li>  Swift 3.0+ </li><li>  CocoaPods 1.1.0+ </li></ul><br><p>  We also need to add <code>use_frameworks!</code>  . </p><br><p>  This is what the <strong>minimum Podfile</strong> will look like: </p><br><pre> <code class="ruby hljs">platform <span class="hljs-symbol"><span class="hljs-symbol">:ios</span></span>, <span class="hljs-string"><span class="hljs-string">'9.0'</span></span> use_frameworks! target <span class="hljs-string"><span class="hljs-string">'Networking'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> pod <span class="hljs-string"><span class="hljs-string">'Alamofire'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h2 id="nastroyka-dostupa-http-anchorsetup-httpanchor">  HTTP access setup <a name="setup-http"></a></h2><br><p>  By default, the application does not allow access to HTTP connections, only HTTPS is available.  But so far a lot of sites have not switched to https. </p><br><p>  We will work with the server <strong><a href="http://jsonplaceholder.typicode.com/">http://jsonplaceholder.typicode.com</a></strong> , and it works on http.  Therefore, we need to open access to it. </p><br><p>  For training, we will open access to all sites.  Opening for one site in this article will not be considered. </p><br><p>  Open <strong>Info.plist</strong> and add <strong>App Transport Security Settings to it</strong> and inside this parameter you need to add <strong>Allow Arbitrary Loads</strong> , with the value <strong>YES</strong> . </p><br><p>  It should look like this: </p><br><p>  ! [Info.plist] (/ Users / zdaecqzezdaecq / Downloads / Working with queries using Alamofire / info_plist.png) </p><br><p>  Or here is the Source code that needs to be added: </p><br><blockquote>  right-click on <strong>Info.plist</strong> -&gt; <strong>Open as</strong> -&gt; <strong>Source code</strong> </blockquote><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSAppTransportSecurity<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSAllowsArbitraryLoads<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2 id="pervyy-minimalnyy-zapros-anchorfirst-requestanchor">  The first minimum request <a name="first-request"></a></h2><br><p>  Open the project. </p><br><blockquote>  Don't forget that we need to open Networking.  <strong>xcworkspace</strong> , not Networking.  <strong>xcodeproj</strong> , which was created after <strong>pod install</strong> </blockquote><p>  Open the <strong>ViewController.swift</strong> file and replace its code with the following: </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Alamofire <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIViewController { override func viewDidLoad</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseJSON { response <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(response) } print(<span class="hljs-string"><span class="hljs-string">"viewDidLoad ended"</span></span>) } }</code> </pre> <br><p>  Run the project. <br>  The console will display: </p><br><pre> <code class="hljs objectivec">viewDidLoad ended SUCCESS: ( { body = <span class="hljs-string"><span class="hljs-string">"quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; title = <span class="hljs-string"><span class="hljs-string">"sunt aut facere repellat provident occaecati excepturi optio reprehenderit"</span></span>; userId = <span class="hljs-number"><span class="hljs-number">1</span></span>; }, ...</code> </pre> <br><p>  Congratulations!  You made the first request to the server and received a response from it with the result. </p><br><h2 id="podrobnee-o-minimume-anchormore-about-minimumanchor">  More about the minimum <a name="more-about-minimum"></a></h2><br><p>  We need to access the new feature, because  these are not our files, but a separate library: </p><br><p> <code>import Alamofire</code> </p> <br><p>  Actually the request method itself: </p><br><p> <code>request</code> </p> <br><p>  Next, the first parameter is the URL to which the request will be made: </p><br><p> <code>"http://jsonplaceholder.typicode.com/posts"</code> </p> <br><p>  The <code>responseJSON</code> method says that we need a response from the server in JSON format. </p><br><p>  Further in the downloader we get a response from the server and output it to the console: </p><br><pre> <code class="hljs vbscript">{ <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(<span class="hljs-built_in"><span class="hljs-built_in">response</span></span>) }</code> </pre> <br><p>  It is important to note that the code in this coolizer occurs asynchronously and will be executed after exiting viewDidLoad, thus the string <code>viewDidLoad ended</code> is output to the console earlier. </p><br><h2 id="metody-http-anchorhttp-methodsanchor">  HTTP methods <a name="http-methods"></a></h2><br><p>  In fact, we made a GET request, but did not indicate it anywhere.  Starting with Alamofire 4, the GET request is executed by default.  We can explicitly specify it by replacing the corresponding code with the following: </p><br><pre> <code class="hljs pgsql">request("http://jsonplaceholder.typicode.com/posts", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>)</code> </pre> <br><p>  As you already understood in the parameter <strong>method:</strong> the request method is transmitted and it depends on it how we will communicate with the server.  Most often we will: </p><br><ol><li>  receive (GET) </li><li>  change (PUT) </li><li>  send, create (POST) </li><li>  delete (DELETE) </li></ol><br><p>  data from the server. </p><br><p>  You can read more about these and other HTTP methods on Wikipedia: </p><br><ol><li>  <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP protocol</a> </li><li>  <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP methods</a> </li></ol><br><h2 id="alamofirerequest-anchoralamofire-requestanchor">  Alamofire.request <a name="alamofire-request"></a></h2><br><p>  The <code>request</code> function is a global function, so we can call it through <code>Alamofire.request</code> or just <code>request</code> . </p><br><p>  This is the complete query with all the parameters: </p><br><pre> <code class="hljs swift">request(<span class="hljs-type"><span class="hljs-type">URLConvertible</span></span>, method: <span class="hljs-type"><span class="hljs-type">HTTPMethod</span></span>, parameters: <span class="hljs-type"><span class="hljs-type">Parameters?</span></span>, encoding: <span class="hljs-type"><span class="hljs-type">ParameterEncoding</span></span>, headers: <span class="hljs-type"><span class="hljs-type">HTTPHeaders?</span></span>)</code> </pre> <br><p>  Consider more: </p><br><h4 id="urlconvertible">  URLConvertible </h4><br><p>  The first parameter is the path to the request and it accepts <code>URLConvertible</code> .  (Your CEP) </p><br><p>  If we look at its implementation, we will see that this is a protocol with one function: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URL</span></span> }</code> </pre> <br><p>  and it is already implemented for the following data types: </p><br><ul><li>  String </li><li>  URL </li><li>  URLComponents </li></ul><br><p>  In this regard, we can pass any of the above types as a parameter or create our own data type with the implementation of this protocol. </p><br><h4 id="httpmethod">  HTTPMethod </h4><br><p>  This is enum, with all possible types of queries: </p><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum HTTPMethod: String { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = "OPTIONS" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> = "GET" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> head = "HEAD" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> post = "POST" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> put = "PUT" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> patch = "PATCH" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> = "DELETE" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> trace = "TRACE" <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> = "CONNECT" }</code> </pre> <br><p>  As we already figured out: the default <code>.get</code> <br>  There is nothing complicated, go ahead. </p><br><h4 id="parameters">  Parameters </h4><br><p>  This is a simple dictionary: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">Parameters</span></span> = [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>]</code> </pre> <br><p>  Through the parameters, we will transmit data to the server (for example, to modify or create objects). </p><br><h4 id="parameterencoding">  ParameterEncoding </h4><br><p>  This is also a protocol with one function: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParameterEncoding</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> urlRequest: URLRequestConvertible, with parameters: Parameters?)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLRequest</span></span> }</code> </pre> <br><p>  It is necessary to determine in what form we encode our parameters.  Different servers and requests require a specific encoding. </p><br><p>  This protocol is implemented: </p><br><ul><li>  URLEncoding </li><li>  JSONEncoding </li><li>  PropertyListEncoding </li></ul><br><p>  By default we have <code>URLEncoding.default</code> . </p><br><p>  Basically, this parameter is not used, but sometimes it is needed, in particular, <code>JSONEncoding.default</code> for encoding in JSON format and <code>PropertyListEncoding.default</code> in XML. </p><br><p>  I noticed that <code>Int</code> not sent without <code>JSONEncoding.default</code> , but maybe it was in Alamofire 3, or maybe because of the server.  Just keep that in mind. </p><br><h4 id="httpheaders">  Httpheaders </h4><br><p>  This is also a Dictionary, but of a different typing: </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> typealias HTTPHeaders = [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>]</code> </pre> <br><p>  Headers (headers) will be needed mainly for authorization. </p><br><p>  More about wikipedia titles: </p><br><p>  <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP headers</a> </p><br><h4 id="datarequest">  DataRequest </h4><br><p>  At the output, we get an object of type <code>DataRequest</code> - the request itself.  We can save it, pass it as a parameter to another function if necessary, tune and send.  About this further. </p><br><h2 id="obrabotka-otveta-anchorresponse-processinganchor">  Response processing <a name="response-processing"></a></h2><br><p>  The response from the server may come with both the result and the error.  In order to distinguish them, the response has parameters such as <code>statusCode</code> and <code>contentType</code> . </p><br><p>  We can check these parameters manually, and we can set up a request, so that he will immediately tell us, the answer came with an error or with a result. </p><br><h4 id="ruchnaya-obrabotka-otveta-anchormanual-response-processinganchor">  Manual response processing <a name="manual-response-processing"></a></h4><br><p>  If we did not set up validation, then </p><br><p> <code>responseJSON.response?.statusCode</code> </p> <br><p>  we will have the status of the response code, and in </p><br><p> <code>responseJSON.result.value</code> </p> <br><p>  there will be a result if the answer came without error, and in </p><br><p> <code>responseJSON.result.error</code> </p> <br><p>  if with an error. </p><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusCode = responseJSON.response?.statusCode <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"statusCode: "</span></span>, statusCode) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">200</span></span>..&lt;<span class="hljs-number"><span class="hljs-number">300</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">contains</span></span>(statusCode) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value = responseJSON.result.value <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>, value ?? <span class="hljs-string"><span class="hljs-string">"nil"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"error"</span></span>) } }</code> </pre> <br><p>  More information about state codes on wikipedia: </p><br><p>  <a href="https://ru.wikipedia.org/wiki/HTTP">HTTP status codes</a> </p><br><h4 id="nastroyka-zaprosa-anchorrequest-setupanchor">  Request setup <a name="request-setup"></a></h4><br><p>  For this, <code>DataRequest</code> has 4 methods: </p><br><ol><li>  validate (statusCode: _) </li><li>  validate (contentType: _) </li><li>  validate (courier for manual validation) </li><li>  validate () </li></ol><br><p>  Consider only the last one, because we will have enough of it for 95% of requests. </p><br><p>  Let's look at its implementation: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> validate(statusCode: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.acceptableStatusCodes).validate(contentType: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.acceptableContentTypes) }</code> </pre> <br><p>  We see that it consists of two other validations: </p><br><ol><li>  <code>self.acceptableStatusCodes</code> - returns an array of status codes (Int) from range 200 .. &lt;300 </li><li>  <code>self.acceptableContentTypes</code> - returns an array of valid headers (String) </li></ol><br><p>  <code>DataResponse</code> has a <code>result</code> parameter that can tell us whether the response came with an error or with a result. </p><br><p>  So apply validation for the query: </p><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).validate().responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><p>  If we do not have a request ( <code>validate()</code> ), then the <code>result</code> will always be equal to <code>.success</code> , except for errors due to the lack of Internet. </p><br><p>  You can handle the answer in both ways, but I strongly recommend using the request validation setting - there will be fewer errors! </p><br><h2 id="obrabotka-rezultata-otveta-anchorprocessing-response-resultanchor">  Response result processing <a name="processing-response-result"></a></h2><br><p>  The response from the server is most often in the form of a single object or an array of objects. </p><br><p>  If we look at the type of the result of the response, we will see the type <code>Any</code> .  To get something out of it - we need to bring it to the desired format. </p><br><p>  In the logs, we noticed that we have a dictionary array, so we‚Äôll bring to it: </p><br><pre> <code class="hljs markdown">request("http://jsonplaceholder.typicode.com/posts").responseJSON { responseJSON in switch responseJSON.result { case .success(let value): print("value", value) guard let jsonArray = responseJSON.result.value as? [<span class="hljs-string"><span class="hljs-string">[String: Any</span></span>]] else { return } print("array: ", jsonArray) print("1 object: ", jsonArray[<span class="hljs-string"><span class="hljs-string">0</span></span>]) print("id: ", jsonArray[<span class="hljs-string"><span class="hljs-string">0</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"id"</span></span>]!) case .failure(let error): print(error) } }</code> </pre> <br><p>  After that, as shown above, we can do anything, for example, create an object and save it, so that it is more convenient to work with the data. </p><br><p>  In a separate file, create a <strong>Post</strong> structure: </p><br><pre> <code class="hljs javascript">struct Post { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: Int <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> }</code> </pre> <br><p>  This will look like parsing into an array of objects: </p><br><pre> <code class="hljs javascript">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonArray = value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt;[<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: Any]&gt; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posts: [Post] = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jsonObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jsonArray { guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id = jsonObject[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Int, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> title = jsonObject[<span class="hljs-string"><span class="hljs-string">"title"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = jsonObject[<span class="hljs-string"><span class="hljs-string">"body"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userId = jsonObject[<span class="hljs-string"><span class="hljs-string">"userId"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = Post(id: id, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: title, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: body, <span class="hljs-attr"><span class="hljs-attr">userId</span></span>: userId) posts.append(post) } print(posts) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): print(error) } }</code> </pre> <br><p>  Parsing an object inside a request looks very bad + we will always have to copy these lines for each request.  To get rid of this, create the <code>init?(json: [String: Any])</code> constructor <code>init?(json: [String: Any])</code> : </p><br><pre> <code class="hljs rust">init?(json: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: Any]) { guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Int, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> title = json[<span class="hljs-string"><span class="hljs-string">"title"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = json[<span class="hljs-string"><span class="hljs-string">"body"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userId = json[<span class="hljs-string"><span class="hljs-string">"userId"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.id = id <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title = title <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.body = body <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userId = userId }</code> </pre> <br><p>  It can return <strong>nil</strong> if the server does not return something to us. </p><br><p>  And then the query method looks much clearer and more pleasant: </p><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonArray = value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Array</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>]&gt; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posts: [<span class="hljs-type"><span class="hljs-type">Post</span></span>] = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jsonObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jsonArray { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = <span class="hljs-type"><span class="hljs-type">Post</span></span>(json: jsonObject) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } posts.append(post) } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(posts) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><p>  Let's go even further and in <strong>Post</strong> we will add an array processing method: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from jsonArray: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Post</span></span>]? { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonArray = jsonArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Array</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>]&gt; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posts: [<span class="hljs-type"><span class="hljs-type">Post</span></span>] = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jsonObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jsonArray { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = <span class="hljs-type"><span class="hljs-type">Post</span></span>(json: jsonObject) { posts.append(post) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> posts }</code> </pre> <br><p>  Then the query method will take the following form: </p><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> posts = <span class="hljs-type"><span class="hljs-type">Post</span></span>.getArray(from: value) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(posts) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><p>  Final option of <strong>Post.swift</strong> file: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation struct Post { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: Int <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> init?(json: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: Any]) { guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Int, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> title = json[<span class="hljs-string"><span class="hljs-string">"title"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = json[<span class="hljs-string"><span class="hljs-string">"body"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userId = json[<span class="hljs-string"><span class="hljs-string">"userId"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } self.id = id self.title = title self.body = body self.userId = userId } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> func getArray(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> jsonArray: Any) -&gt; [Post]? { guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonArray = jsonArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt;[<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: Any]&gt; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posts: [Post] = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jsonObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jsonArray { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = Post(json: jsonObject) { posts.append(post) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> posts } }</code> </pre> <br><p>  For those who have already figured out how to work with flatMap, the <code>getArray</code> function can be written like this: </p><br><pre> <code class="hljs swift"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from jsonArray: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Post</span></span>]? { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonArray = jsonArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Array</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>]&gt; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonArray.flatMap { <span class="hljs-type"><span class="hljs-type">Post</span></span>(json: $<span class="hljs-number"><span class="hljs-number">0</span></span>) } }</code> </pre> <br><h2 id="raznye-tipy-otvetov-anchordifferent-answersanchor">  Different types of answers <a name="different-answers"></a></h2><br><h4 id="responsejson">  responseJSON </h4><br><p>  We learned how to send a request and receive a response in the form of JSON using <strong>responseJSON</strong> .  Now we analyze in what form we can get the answer. </p><br><h4 id="responsedata">  responseData </h4><br><p>  The answer will come to us in the form of <strong>Data</strong> .  Often, pictures come this way, but even our previous request can be received in the form of Data: </p><br><pre> <code class="hljs cs">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseData { responseData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseData.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = String(data: <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, encoding: .utf8) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } print(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): print(error) } }</code> </pre> <br><p>  In the example, we get the answer and convert it to a string.  It is inconvenient to receive data from it, as from a Dictionary, but there are parsers that will make an object out of stock. </p><br><h4 id="responsestring">  responseString </h4><br><p>  Everything is simple here.  The answer will come in the form of a JSON string.  In fact, it does what we wrote above in <strong>responseData</strong> : </p><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).responseString { responseString <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseString.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><h4 id="response">  response </h4><br><p>  You can say this is the basic method.  It does not process the data from the server in any way, gives it out in the form in which they came.  It does not have a <code>result</code> property, and therefore a construction like <code>switch response.result</code> will not work here.  Everything will have to be done manually.  We rarely need it, but you need to know about it. </p><br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">request</span></span>(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">response</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">response</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>.data, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(data: data, encoding: .utf8) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { return } print(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>) }</code> </pre> <br><p>  A string is displayed if the answer came without error. </p><br><h4 id="responsepropertylist">  responsePropertyList </h4><br><p>  There is another method <code>.responsePropertyList</code> .  It is needed to get the parsed <strong>plist</strong> file.  I have not used it yet and have not found a test server to give an example.  Just know that it is, or you can deal with it yourself by analogy with others. </p><br><h2 id="progress-zagruzki-anchordownload-progressanchor">  Download progress <a name="download-progress"></a></h2><br><p>  Sometimes we can get a big response from the server, for example, when we download a photo, and we need to display the download progress.  For this, <strong>request</strong> has a <code>downloadProgress</code> method: </p><br><blockquote>  Instead of <code>https://s-media-cache-ak0.pinimg.com/originals/ef/6f/8a/ef6f8ac3c1d9038cad7f072261ffc841.jpg</code> you can insert any link to the photo.  It is desirable more so that the request is not executed instantly and you see the process itself. </blockquote><br><pre> <code class="hljs swift">request(<span class="hljs-string"><span class="hljs-string">"https://s-media-cache-ak0.pinimg.com/originals/ef/6f/8a/ef6f8ac3c1d9038cad7f072261ffc841.jpg"</span></span>) .validate() .downloadProgress { progress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"totalUnitCount:\n"</span></span>, progress.totalUnitCount) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"completedUnitCount:\n"</span></span>, progress.completedUnitCount) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"fractionCompleted:\n"</span></span>, progress.fractionCompleted) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"localizedDescription:\n"</span></span>, progress.localizedDescription) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"---------------------------------------------"</span></span>) } .response { response <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = response.data, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(data: data) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(image) }</code> </pre> <br><blockquote>  The <code>Progress</code> class is a standard library class. </blockquote><p>  The logs will display the progress in the form of blocks: </p><br><pre> <code class="hljs matlab">totalUnitCount: <span class="hljs-number"><span class="hljs-number">2113789</span></span> completedUnitCount: <span class="hljs-number"><span class="hljs-number">2096902</span></span> fractionCompleted: <span class="hljs-number"><span class="hljs-number">0.992011028536907</span></span> localizedDescription: <span class="hljs-number"><span class="hljs-number">99</span></span><span class="hljs-comment"><span class="hljs-comment">% completed</span></span></code> </pre> <br><p>  We can divide the <strong>completedUnitCount</strong> into <strong>totalUnitCount</strong> and get a number from <strong>0 to 1</strong> that will be used in the <strong>UIProgressView</strong> , but we have already done it in the <strong>fractionCompleted</strong> property. </p><br><p>  To see the picture itself, put the <strong>breakpoint</strong> on the line with <code>print(image)</code> and click on <strong>Quick Look</strong> (the button with the eye) in the debug panel: </p><br><p>  ! [Debug console] (/ Users / zdaecqzezdaecq / Downloads / Working with queries using Alamofire / image_quick_look.png) </p><br><h2 id="primery-anchorexamplesanchor">  Examples <a name="examples"></a></h2><br><h4 id="sozdanie-obekta-post-anchorcreate-objectanchor">  Creating an object (POST) <a name="create-object"></a></h4><br><p>  The simplest creation of an object on the server looks like this: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">params</span></span>: [String: Any] = [ <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"new post"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"some news"</span></span>, <span class="hljs-string"><span class="hljs-string">"userId"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> ] request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts"</span></span>, method: .post, parameters: <span class="hljs-keyword"><span class="hljs-keyword">params</span></span>).validate().responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonObject = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [String: Any], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = Post(json: jsonObject) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } print(post) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): print(error) } }</code> </pre> <br><blockquote>  <strong>id is</strong> not passed because  the server must assign it itself.  In general, the necessary parameters must be written in the documentation for creating each object. </blockquote><br><h4 id="obnovlenie-obekta-put-anchorupdate-objectanchor">  Object Update (PUT) <a name="update-object"></a></h4><br><p>  When updating an object, its <strong>id is</strong> often written not in the parameter, but in the request path ( <code>~/posts/1</code> ): </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">params</span></span>: [String: Any] = [ <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"new post"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"some news"</span></span>, <span class="hljs-string"><span class="hljs-string">"userId"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> ] request(<span class="hljs-string"><span class="hljs-string">"http://jsonplaceholder.typicode.com/posts/1"</span></span>, method: .put, parameters: <span class="hljs-keyword"><span class="hljs-keyword">params</span></span>).validate().responseJSON { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>): guard <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> jsonObject = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [String: Any], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = Post(json: jsonObject) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } print(post) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): print(error) } }</code> </pre> <br><p>  Of course, they can also do this via a parameter, but this will not be by REST.  More about REST in the article on the habr: </p><br><p>  <a href="https://habrahabr.ru/post/38730/">REST architecture</a> </p><br><h4 id="zagruzka-fotografii-na-server-multipartformdata-anchorimage-uploadanchor">  Upload photos to the server (multipartFormData) <a name="image-upload"></a></h4><br><p>  This is how the photo upload to the server looks like: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"some_photo"</span></span>)! <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-type"><span class="hljs-type">UIImagePNGRepresentation</span></span>(image)! <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> httpHeaders = [<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Basic YWNjXzE4MTM2ZmRhOW*****A=="</span></span>] upload(multipartFormData: { multipartFormData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> multipartFormData.append(data, withName: <span class="hljs-string"><span class="hljs-string">"imagefile"</span></span>, fileName: <span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span>, mimeType: <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span>) }, to: <span class="hljs-string"><span class="hljs-string">"https://api.imagga.com/v1/content"</span></span>, headers: httpHeaders, encodingCompletion: { encodingResult <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> encodingResult { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> uploadRequest, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streamingFromDisk, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streamFileURL): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(uploadRequest) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(streamingFromDisk) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(streamFileURL ?? <span class="hljs-string"><span class="hljs-string">"streamFileURL is NIL"</span></span>) uploadRequest.validate().responseJSON() { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } })</code> </pre> <br><p>  Awful isn't it? </p><br><p>  Let's see what is responsible for what. </p><br><blockquote>  I threw a photo named <strong>some_photo</strong> into <strong>Assets.xcassets</strong> </blockquote><p>  Create an image object and convert it to <strong>Data</strong> : </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"some_photo"</span></span>)! <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIImagePNGRepresentation</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image</span></span></span><span class="hljs-class">)!</span></span></code> </pre> <br><p>  Create a dictionary to transfer the authorization token: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> httpHeaders = [<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Basic YWNjXzE4MTM2ZmRhOW*****A=="</span></span>]</code> </pre> <br><p>  This is necessary because  www.imagga.com service requires authorization to upload a picture. </p><br><blockquote>  To get your token, you just need to register on their website and copy it from your profile at the link: <a href="https://imagga.com/profile/dashboard">https://imagga.com/profile/dashboard</a> </blockquote><p>  Before we used the <code>request</code> method.  Here is the <code>upload</code> method.  The first parameter is the cougher to attach our image: </p><br><pre> <code class="hljs lisp">upload(<span class="hljs-name"><span class="hljs-name">multipartFormData</span></span>: { multipartFormData in multipartFormData.append(<span class="hljs-name"><span class="hljs-name">data</span></span>, withName: <span class="hljs-string"><span class="hljs-string">"imagefile"</span></span>, fileName: <span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span>, mimeType: <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span>) }</code> </pre> <br><p>  The following parameters are <strong>URLs</strong> and <strong>headers</strong> : </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">to</span></span>: <span class="hljs-string"><span class="hljs-string">"https://api.imagga.com/v1/content"</span></span>, headers: httpHeaders</code> </pre> <br><p>  Next comes the coder with the coded request: </p><br><pre> <code class="hljs swift">encodingCompletion: { encodingResult <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> encodingResult { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> uploadRequest, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streamingFromDisk, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> streamFileURL): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(uploadRequest) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(streamingFromDisk) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(streamFileURL ?? <span class="hljs-string"><span class="hljs-string">"streamFileURL is NIL"</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } })</code> </pre> <br><p>  From it we can get a request ( <strong>uploadRequest</strong> ), and two variables necessary for streaming (stream) files. </p><br><blockquote>  I won't talk about streams, it's quite a rare thing.  For now, you simply see that these two variables are false and nil, respectively. </blockquote><p>  Next, we must send a request in the form familiar to us: </p><br><pre> <code class="hljs swift">uploadRequest.validate().responseJSON() { responseJSON <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> responseJSON.result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .success(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .failure(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error): <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><p>  When you receive your token, insert your photo and complete the query, the result will be as follows: </p><br><pre> <code class="hljs objectivec">{ status = success; uploaded = ( { filename = <span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = <span class="hljs-number"><span class="hljs-number">83800</span></span>f331a7f97e41e0f0b70bf7847bd; } ); }</code> </pre> <br><blockquote>  <strong>The filename</strong> may not be different, but the <strong>id</strong> will be. </blockquote><br><h2 id="itog-anchortotalanchor">  Total <a name="total"></a></h2><br><p>  We got acquainted with the Alamofire framework, dealt with the request method, sending requests, processing the response, parsing a positive response, receiving information about the progress of the request.  We made some simple requests and learned how to upload photos to the server with authorization. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/330760/">https://habr.com/ru/post/330760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330750/index.html">Junior, who on the first day of work deleted the database from production</a></li>
<li><a href="../330752/index.html">Tape Recorder Emulator for ZX-Spectrum</a></li>
<li><a href="../330754/index.html">Full immersion in virtual reality: the present and the future</a></li>
<li><a href="../330756/index.html">Operation ‚ÄúMigration‚Äù: if your mail is somewhere there, but you need to be here</a></li>
<li><a href="../330758/index.html">GIS and distributed computing</a></li>
<li><a href="../330762/index.html">The cost of the error: who pays for the programmers' mistakes and how much?</a></li>
<li><a href="../330764/index.html">Virtual creatures and their habitats: the past and present TTY in Linux</a></li>
<li><a href="../330772/index.html">Apache step-by-step configuration with the choice of versions of php + Nginx as reverse proxy (with mod_pagespeed) on ubuntu 16.04</a></li>
<li><a href="../330774/index.html">Facebook Mobile Advertising Test</a></li>
<li><a href="../330776/index.html">OpenStack Test Automation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>