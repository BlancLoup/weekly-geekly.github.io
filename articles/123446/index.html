<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MS SQL 2011 - New Sequence Object</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The opportunity, which is not surprising now users of Oracle, DB2, PostgreSQL and many other relational databases, finally appeared in MS SQL Server. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MS SQL 2011 - New Sequence Object</h1><div class="post__text post__text-html js-mediator-article">  The opportunity, which is not surprising now users of Oracle, DB2, PostgreSQL and many other relational databases, finally appeared in MS SQL Server.  In the arena of Sequence! <br><br>  Sequence - generates a sequence of numbers as well as identity.  However, the main advantage of sequence is that the sequence does not depend on any particular table and is an object of the database. <br><br>  Consider an example script written in SQL Server 2008. Creating a simple table with two columns, one of which will be auto-increment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> WithOutSequence1 ( EmpId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> ,EmpName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithOutSequence1 <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-string"><span class="hljs-string">'Violet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Union</span></span> All <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-string"><span class="hljs-string">'Tape'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> WithOutSequence1</code> </pre> <br>  Similarly, create another table. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> WithOutSequence2 ( EmpId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> ,EmpName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithOutSequence2 <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-string"><span class="hljs-string">'Violet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Union</span></span> All <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-string"><span class="hljs-string">'Tape'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> WithOutSequence2</code> </pre> <br>  As you can see from the examples, we recorded the values ‚Äã‚Äãin the table, and the value of the incremental field was automatically and independently of us filled.  We cannot reuse the value of this field in another table.  Let's see how to get out of this situation using Sequence. <br><br>  The general syntax for a command is: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> [schema_name . ] sequence_name [ <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> { built_in_integer_type | <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-defined_integer_type } ] | <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>&gt; | <span class="hljs-keyword"><span class="hljs-keyword">INCREMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>&gt; | { <span class="hljs-keyword"><span class="hljs-keyword">MINVALUE</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>&gt; | <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MINVALUE</span></span> } | { MAXVALUE &lt;<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>&gt; | <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> MAXVALUE } | { <span class="hljs-keyword"><span class="hljs-keyword">CYCLE</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CYCLE</span></span> } | { <span class="hljs-keyword"><span class="hljs-keyword">CACHE</span></span> [&lt;<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span>&gt; ] | <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CACHE</span></span> }</code> </pre> <br><br><a name="habracut"></a><br><br>  Create a sequence of numbers: <br><pre> <code class="sql hljs">IF EXISTS (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.sequences <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> = N<span class="hljs-string"><span class="hljs-string">'GenerateNumberSequence'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>=<span class="hljs-string"><span class="hljs-string">'SO'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> ANSI_NULLS <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INCREMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; GO</code> </pre> <br>  After the execution of the specified script, in the base object browser, in the Sequences node you can find our object. <br><br> <a href=""><img title="01" src="https://habrastorage.org/getpro/habr/post_images/943/e17/f0b/943e17f0be1564b748ca914dc8cbfb99.jpg" width="235" height="43"></a> <br><br>  After the object is created, you can use it in creating and populating tables as shown below: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> WithSequence1 ( EmpId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> ,EmpName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithSequence1(EmpId, EmpName) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Violet'</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Tape'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> WithSequence1;</code> </pre> <br>  If you create a second table in the same way, you can again use the <strong>GenerateNumberSequence</strong> and get a through numbering of objects. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span> WithSequence2 ( EmpId <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> ,EmpName <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithSequence2(EmpId, EmpName) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Violet'</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Tape'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> WithSequence2;</code> </pre> <br>  The sequence (Sequence) that we created can be viewed in the <strong>sys</strong> system directory <strong>.</strong>  <strong>sequences</strong> . <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> ,Object_ID ,<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> ,Type_Desc ,Start_Value ,<span class="hljs-keyword"><span class="hljs-keyword">Increment</span></span> ,Minimum_Value ,Maximum_Value ,Current_Value ,Is_Exhausted <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.sequences</code> </pre> <br> <a href=""><img title="02" src="https://habrastorage.org/getpro/habr/post_images/9d1/02f/cff/9d102fcff0a8653c6f6d1478f8d59a52.jpg" width="606" height="43"></a> <br><br>  This is not all the available information on the sequence, we just need these columns later.  To get all the information, replace the column names with an asterisk.  Is_Exhausted will be mentioned later. <br><br>  Sequence can be of the following types: <br><ul><li>  Int </li><li>  Smallint </li><li>  Tinyint </li><li>  Bigint </li><li>  Decimal </li><li>  Numeric </li></ul><br>  It is not necessary to start the sequence from one.  You can start with any number within the possible values ‚Äã‚Äãof the declared type.  For example, for integer values, this could be from -2147483648 to 2147483647. <br><br>  Let's test in practice what SQL Server will say when setting the initial number outside the acceptable range.  Let's start with the left border. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">-2147483649</span></span> <span class="hljs-comment"><span class="hljs-comment">--outside the range of the int datatype boundary INCREMENT BY 1;</span></span></code> </pre> <br>  <strong><em>Analogous value for the given data type.</em></strong> <br><br>  As expected.  Now we break the right border. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">2147483647</span></span> <span class="hljs-comment"><span class="hljs-comment">--the max range of the int datatype INCREMENT BY 1;</span></span></code> </pre> <br><br>  The server will report the error to us like this: <br><br>  <strong><em>The sequence object "GenerateNumberSequence" is greater than the number of available values;</em></strong>  <strong><em>the cache has been set automatically.</em></strong> <br><br>  And if we pay attention to the Is_Exhausted column in the sys.sequences catalog, we will see that the value became equal to 1. That tells us about the impossibility of further use of this sequence. <br><br> <a href=""><img title="03" src="https://habrastorage.org/getpro/habr/post_images/0fd/b38/aa2/0fdb38aa2ba2f42e139b10bd7e12eb9a.jpg" width="606" height="33"></a> <br><br>  When you try to create a table using this sequence, the server will generate an error: <br><br>  <strong><em>The sequence object 'GenerateNumberSequence' has reached the minimum or maximum value.</em></strong>  <strong><em>Restart the sequence.</em></strong> <br><br>  This can be interpreted as a request from the engine to restart the specified sequence.  To do this, use the <strong>RESTART</strong> <strong>WITH</strong> construct. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> dbo.GenerateNumberSequence RESTART <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  The value must be within the valid range of the declared type.  Further, the sequence will start from the specified value, not from the following. <br><br>  Those.  if you specify: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> dbo.GenerateNumberSequence RESTART <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><br>  And then execute the script: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithSequence1(EmpId, EmpName) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'violet'</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'tape'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> WithSequence1;</code> </pre> <br>  That result will be: <br><pre> <code class="sql hljs">EmpId   EmpName <span class="hljs-comment"><span class="hljs-comment">-----   ------- 10      violet 11      tape</span></span></code> </pre> <br>  The sequence began with a given value. <br><br>  You can get the minimum and maximum values ‚Äã‚Äãfrom the <strong>sys</strong> directory <strong>.</strong>  <strong>sequences</strong> . <br><h3>  MIN and MAX values </h3><br>  For sequences, you can set the boundaries of valid values.  Let's try to execute such a script below. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INCREMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MINVALUE</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> MAXVALUE <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre> <br>  The minimum value is 10, the maximum is 20, but we are trying to set an initial value equal to one.  This is outside the acceptable range and therefore we will be pleased with the message: <br><br>  <strong><em>The object is generated for the object.</em></strong> <br><br>  Further, we can imagine that the next value in the sequence violates the boundary.  In this case, we get an error: <br><br>  <strong><em>The sequence object 'GenerateNumberSequence' has reached the minimum or maximum value.</em></strong>  <strong><em>Restart the sequence.</em></strong> <br><br>  There are two ways to solve the problem: <br><ul><li>  Use the service words Restart or Restart With. </li><li>  Use CYCLE option </li></ul><br><h3>  CYCLE option </h3><br>  This option loops the sequence and, having reached the maximum value, the sequence continues from the minimum.  For example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> GenerateNumberSequence <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INCREMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MINVALUE</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> MAXVALUE <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CYCLE</span></span></code> </pre> <br><br>  After the maximum value has been reached, the results will be as follows: <br><pre> <code class="sql hljs">EmpId   EmpName <span class="hljs-comment"><span class="hljs-comment">-----   ------- 10      Tape 20      Violet</span></span></code> </pre> <br>  For the sample the query was used: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> WithSequence1(EmpId, EmpName) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Violet'</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> GenerateNumberSequence, <span class="hljs-string"><span class="hljs-string">'Tape'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> WithSequence1;</code> </pre> <br>  If you look closely at the output, you will notice that the records were confused.  If we didn't use sequences, the output would be <br><pre> <code class="sql hljs">EmpId   EmpName <span class="hljs-comment"><span class="hljs-comment">-----   ------- 20      Violet 21      Tape</span></span></code> </pre> <br>  But due to the fact that the second entry crossed the range of valid values, the number was reset to the minimum value specified for the sequence (10).  If you now look at the sys.sequences directory, you will see that the current value is 10. <br><br>  Next time, filling in the table could be this: <br><pre> <code class="sql hljs">EmpId   EmpName <span class="hljs-comment"><span class="hljs-comment">----    ------- 11      Violet 12      Tape</span></span></code> </pre> <br>  At this point, the Sequence will check the order in which the records will be inserted, and since the ‚ÄúViolet‚Äù comes before the ‚ÄúTape‚Äù and the current number is 10, the records will be inserted as: <br><br>  <strong>Next_value = Current_value + Shift</strong> ie  10 +1 will be assigned to ‚ÄúViolet‚Äù.  Now the value of Sequence = 11 and for the second record the value will be 12 following the same formula. <br><h3>  NO CYCLE option </h3><br>  The behavior of this option has already been considered at the very beginning, and is the default when creating a Sequence. <br><h2>  Sequence in combination with Over () </h2><br>  You can use a sequence with an Over expression to generate sequence numbers as shown below: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--Declare a table Declare @tblEmp Table ( EmpId int identity ,EmpName varchar(50) not null ) --Populate some records Insert Into @tblEmp Select 'Niladri' Union All Select 'Arina' Union All Select 'Deepak' Union All Select 'Debasis' Union All Select 'Sachin' Union All Select 'Gaurav' Union All Select 'Rahul' Union All Select 'Jacob' Union All Select 'Williams' Union All Select 'Henry' --Fire a query SELECT e.* ,Seq = NEXT VALUE FOR GenerateNumberSequence OVER (ORDER BY EmpName) FROM @tblEmp e</span></span></code> </pre> <br>  Result: <br><br> <a href=""><img title="04" src="https://habrastorage.org/getpro/habr/post_images/7d0/587/e95/7d0587e9538a63f06f00a5a4b1e4ca93.jpg" width="182" height="213"></a> <br><br>  You may notice that the records were sorted and the sequence was applied correctly to the stored data.  This means that the records are sorted first and only then sequence numbering is applied. <br><h2>  Restrictions on the use of Next Value for functions. </h2><br>  In no case can the Sequence be used in conjunction with: <br><ul><li>  Constraints check (constraints) </li><li>  Defaults </li><li>  Calculated columns </li><li>  Views </li><li>  Custom Functions </li><li>  Custom aggregation functions </li><li>  Subqueries </li><li>  CTE (Common Table Expression) </li><li>  Subtables </li><li>  TOP expression </li><li>  Expression over </li><li>  Output expression </li><li>  Expression on </li><li>  Where expression </li><li>  Group By expression </li><li>  Having an expression </li><li>  Order By </li><li>  Compute expression </li><li>  Compute By </li></ul><br><h2>  Sp_sequence_get_range function </h2><br>  If we consider all the approaches used above to add rows to tables using <strong>NEXT</strong> <strong>VALUE</strong> <strong>FOR</strong> , it becomes noticeable that this expression is present in every level of VALUES, which looks a bit tedious.  Instead, you can use the sp_sequence_get_range function to get the necessary range of values ‚Äã‚Äãthat can be used later.  Now I will demonstrate how this can be done. <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,    IF EXISTS (SELECT * FROM sys.sequences WHERE NAME = N'GenerateRangeNumberSequence' AND TYPE='SO') DROP Sequence GenerateRangeNumberSequence GO --  ,    IF EXISTS (SELECT * FROM sys.objects WHERE name = N'tbl_RangeSequence' AND type = 'U') DROP TABLE tbl_RangeSequence GO SET ANSI_NULLS ON GO --   CREATE SEQUENCE GenerateRangeNumberSequence START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2000 CYCLE GO --   CREATE TABLE [dbo].[tbl_RangeSequence]( [EmpId] [int] NOT NULL, [EmpName] [varchar](50) NOT NULL, PRIMARY KEY CLUSTERED ( [EmpId] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] ) ON [PRIMARY] GO --     sp_sequence_get_range DECLARE @sequence_name nvarchar(100) = N'GenerateRangeNumberSequence', @range_size int = 1000, @range_first_value sql_variant, @range_last_value sql_variant, @sequence_increment sql_variant, @sequence_min_value sql_variant, @sequence_max_value sql_variant; --   sp_sequence_get_range EXEC sp_sequence_get_range @sequence_name = @sequence_name, @range_size = @range_size, @range_first_value = @range_first_value OUTPUT, @range_last_value = @range_last_value OUTPUT, @sequence_increment = @sequence_increment OUTPUT, @sequence_min_value = @sequence_min_value OUTPUT, @sequence_max_value = @sequence_max_value OUTPUT; --   SELECT @range_size AS [Range Size], @range_first_value AS [Start Value], @range_last_value AS [End Value], @sequence_increment AS [Increment], @sequence_min_value AS [Minimum Value], @sequence_max_value AS [Maximum Value]; --       ;With Cte As ( Select Rn = 1, SeqValue = Cast(@range_first_value as int) Union All Select Rn+1, Cast(SeqValue as int) + Cast( @sequence_increment as int) From Cte Where Rn&lt;@range_last_value ) --  100  Insert into tbl_RangeSequence(EmpId, EmpName) Select SeqValue,'Name' + Cast(SeqValue as varchar(3)) From Cte Where SeqValue&lt;=100 Option (MaxRecursion 0) --   SELECT * FROM tbl_RangeSequence</span></span></code> </pre> <br>  Here is what will happen as a result of execution <br><br> <a href=""><img title="05" src="https://habrastorage.org/getpro/habr/post_images/c24/4f4/178/c244f4178849165e45c1c28472e01723.jpg" width="492" height="416"></a> <br><br>  Here you can see that the sequence was increased to 1000 and the missing values ‚Äã‚Äãwere not used anywhere without our knowledge.  In this case, we used them to insert values. <br><h2>  Comparison between Sequence and Identity </h2><br>  You should not put a global equality sign between them due to the following factors: <br><ul><li>  Identity refers to the table and is part of its inseparable, Sequence - an independent database object. </li><li>  You can get a sequence set using sp_sequence_get_range, which is basically impossible with Identity. </li><li>  For Sequence, you can define boundaries of values, which is also impossible for Identity. </li><li>  The cyclic values ‚Äã‚Äãcan be set the same way only for Sequence. </li></ul><br>  And a few more words about Sequence. <br><ul><li>  Sequence gives a greater performance boost compared to Identity.  Comparison and results in the <a href="http://sqlblog.com/blogs/aaron_bertrand/archive/2010/11/11/sql-server-11-denali-using-sequence.aspx">article by</a> Aaron Bertrand </li><li>  You can set permissions to the Sequence, as well as to other database objects. </li></ul><br>  You can read more about Sequence on MSDN: <br><ol><li>  <a href="http://msdn.microsoft.com/en-us/library/ff878091(v%3Dsql.110).aspx">CREATE SEQUENCE</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ff878058(v%3DSQL.110).aspx%3FappId%3DDev10IDEF1%26amp%3Bl%3DEN-US%26amp%3Bk%3Dk(SEQUENCE_TSQL)%3Bk(SQL105.SWB.TSQLRESULTS.F1)%3Bk(SQL105.SWB.TSQLQUERY.F1)%26amp%3Brd%3Dtrue">Creating and Using Sequence Numbers</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ff878352(v%3Dsql.110).aspx">sp_sequence_get_range</a> </li></ol><br><br><br>  <i>Transfers from the cycle:</i> <i><br></i>  <i>MS SQL Server 2011: <a href="http://habrahabr.ru/blogs/htranslations/123345/">Autonomous databases</a> , <a href="http://habrahabr.ru/blogs/sql/123446/">new Sequence object</a> , <a href="http://habrahabr.ru/blogs/sql/123491/">Offset operator</a> , <a href="http://habrahabr.ru/blogs/sql/123507/">error handling</a> , <a href="http://habrahabr.ru/blogs/sql/123573/">With Result Set construction</a> , <a href="http://habrahabr.ru/blogs/sql/123664/">new in SSMS</a> .</i> </div><p>Source: <a href="https://habr.com/ru/post/123446/">https://habr.com/ru/post/123446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123439/index.html">Droider Chart 59. Hit parade of Android applications</a></li>
<li><a href="../123440/index.html">Rambler unites user contacts</a></li>
<li><a href="../123442/index.html">Triggers in TimesTen (XLA Application)</a></li>
<li><a href="../123444/index.html">Attempt to change the model of cinema monetization - the film "A Lonely Place For Dying"</a></li>
<li><a href="../123445/index.html">Craftsman added another display to the Nexus One</a></li>
<li><a href="../123447/index.html">Mobile Saturday is now in Odessa!</a></li>
<li><a href="../123448/index.html">metabus - a platform for building thematic search engines</a></li>
<li><a href="../123451/index.html">Gearman - distribution framework for tasks, introduction</a></li>
<li><a href="../123452/index.html">Pitfalls when working with php-handlersocket</a></li>
<li><a href="../123453/index.html">Do-it-yourself textile printer with minimum cost</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>