<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Efficient index management in Azure SQL Database using Index Advisor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are happy to share with you another article from the Microsoft Azure cloud services series. This time, Andrei Antyufeev, Microsoft program manager ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Efficient index management in Azure SQL Database using Index Advisor</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>We are happy to share with you another article from the Microsoft Azure cloud services series.</i>  <i>This time, Andrei Antyufeev, Microsoft program manager from the SQL Server team and the Azure SQL Database, will continue his story about working with indexes in the Azure SQL Database cloud database.</i>  <i>- Vladimir Yunev</i> </blockquote>  Hello everyone, this note will be useful to everyone using the Azure SQL Database. <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/2ef/e51/307/2efe513070cb403197e0c194ddb01f0a.png"></div><br>  <a href="http://habrahabr.ru/post/262125">Last time</a> , we reviewed the first version of Index Advisor.  Since then, the assistant has managed to grow to GA, increasing stability, and acquire new features: <br><br><ul><li>  ability to automatically apply the recommendations of the assistant </li><li>  new recommendations (Drop Index) </li><li>  load visualization after index creation </li><li>  other improvements </li></ul><br><h3>  Forget about managing indexes </h3><br>  The process of creating new indexes occurs in several stages: <br><a name="habracut"></a><br><ol><li>  Index Advisor provides user recommendations indexes that will give a performance boost; </li><li>  The user selects which recommendation to apply, the recommendation goes to the ‚ÄúPending‚Äù state; </li><li>  At this time, Index Advisor makes a control measurement of your load and creates an index; </li><li>  In the last stage, IA again measures performance and, if it is lower than before the operation with indexes, the operation is canceled.  Index in the status of ‚ÄúReverted‚Äù. </li></ol><br><div style="text-align:center;"><img height="650" src="https://habrastorage.org/files/81f/e94/f64/81fe94f64d45475d8f0fa84b32e34e3c.png"></div><br>  <em>Fig.</em>  <em>1. - Properties of the index, the effect of which was negative.</em>  <em>The operation can be repeated by clicking the ‚ÄúRevert‚Äù button.</em> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After some time, the load on the database may change, and a new index will be needed, or the old index will become unnecessary.  The user will have to run this process again and again. <br><br><h3>  Autopilot </h3><br>  For those who are tired of having to think about indexes, we created the autopilot function - it automatically applies new recommendations and rolls back changes if the effect is negative. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b11/cdb/e0a/b11cdbe0ac2b42d28867828120423b86.png"></div><br>  <em>Fig.</em>  <em>2. - Enable autopilot in the settings of Index Advisor</em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a3f/ca7/ffb/a3fca7ffb0b1432a832c4981cc130e96.png"></div><br>  <em>Fig.</em>  <em>3. - The properties of the completed operations will show who initiated it: the user or the autopilot.</em> <br><br><h3>  ‚ÄúI gave birth to you, I will kill you‚Äù </h3><br>  Index Advisor constantly monitors telemetry and database load - if it detects an index that no longer does any good or is duplicated by some other index, then it will offer to delete it. <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/74a/f64/dfe/74af64dfe62040c08d0ecba5b44d1c1c.png"></div><br>  <i>For example, in the internal testing stage, we found a database with 72 identical indices that simply took up space.</i>  <i>This was due to a third-party index administration program that did not work as it should.</i> <br><br>  To remove indexes, the distinctive feature of Index Advisor becomes even more important: <b>verification after</b> .  Through the use of the Query Store, Index Advisor knows what the effect of creating or deleting an index will be.  If it turns out to be negative, the assistant will automatically return everything as it was. <br><br><h3>  Additional notifications </h3><br>  Every day we publish thousands of recommendations.  If they are all applied, the performance of SQL Azure as a whole and for customers will significantly increase.  Therefore, we will try to convey these recommendations to users as soon as possible. <br><br>  The first step is the Status bar on the database screen: <br><br><div style="text-align:center;"><img height="650" src="https://habrastorage.org/files/58a/4b7/e3b/58a4b7e3b1a74b9a8d1f45967b520124.png"></div><br>  If you have active recommendations, then when you visit the new Azure portal, you will see a notification inviting them to apply them.  In the near future, we plan to make regular notifications about the availability of recommendations in the Index Advisor. <br><br><h3>  This is not a hoax!  It works </h3><br>  After creating or deleting an index, you can see in the operation properties how the database parameters have changed: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/125/c03/93a/125c0393a93043bcaf074df682e32d8c.png"></div>  To do this, select the operation that ended successfully, and run Query Insights: <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/58e/e95/84c/58ee9584cb9140958e0af92997d6c2af.png"></div><br>  As you can see, the index was created on the 6th, and the total DTU consumption fell from 80% to 40%, and the CPU consumption by requests dropped.  (The improvement is not always so significant, but it is always there) <br><br>  Coincidence?  I do not think.  Query Performance Insight is a useful tool in itself, and I‚Äôm going to tell you about it in the next article. <br><br><h3>  Why do I have no recommendations? </h3><br>  So it may happen that your database does not need additional indexes at the moment.  Then Index Advisor will display a message explaining the lack of recommendations.  The reasons may be as follows: <br><br><ol><li>  We have analyzed your database, and we have nothing to add or remove (you are a great developer!); </li><li>  We do not have enough data for reliable recommendations.  This happens for several reasons: </li><li>  We cannot make changes to the database structure (for example, if it is marked as Read-only); </li><li>  At the moment, there are other index change operations for your database (new recommendations may appear after completion of all planned changes); </li><li>  Index Advisor has a day off (and it happens). </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/files/285/f7a/af9/285f7aaf96824e64af5d19249990dbb6.png"></div><br>  The list may change over time, but we will always try to give a specific reason. <br><br><h3>  Other </h3><br>  Small changes like: <br><br><ul><li>  Syntax highlighting in the script field for manual implementation of the recommendation (Index Details -&gt; ‚ÄúView Script‚Äù); </li><li>  If the application of the recommendation fails, the reason will be indicated in the properties of the recommendation. </li></ul><br><h3>  New recommendation model </h3><br>  As you might have guessed, administering indexes is only the first step.  Over time, we hope to expand our Advisor with new tips and tricks. <br><br>  At first they will be launched as a pre-order and marked with an asterisk, for example, Drop Index. <br><br><div style="text-align:center;"><img width="650" src="https://habrastorage.org/files/383/4c4/62a/3834c462ab734ddb965d1f009b6d837c.png"></div><h3>  Total </h3><br>  Index Advisor is now in GA stage, it will help you find the missing indexes (and also offer to remove unnecessary ones) and improve the performance of your database. <br><br>  Turning on the autopilot Index Advisor, you can leave to forget about managing indexes, the cloud will do everything for you. <br><br><h3>  Feedback </h3><br><ul><li>  It would be very cool to hear the opinions / comments of experienced DBA and new Code-first developers.  You can start a discussion here. </li><li>  On the Index Advisor page there is a Feedback button, where you can express an opinion on a specific index. </li><li>  Would you like to send greetings to SQL Server / SQL Azure teams: <a href="">anant@microsoft.com I</a> will try to find the desired destination. </li></ul><br>  In the second part, we will look at Query Performance Insight, a tool that shows the top 10 most voracious queries in your database. <br><br><h3>  about the author </h3><br>  <b>Andrey Antyufeev</b> <br><br><img width="300" src="https://habrastorage.org/files/39c/c86/72f/39cc8672fc0840f685b9b42b42f26d4d.jpg"><br><br>  SQL Server &amp; Azure SQL Database Program Manager, Microsoft <br>  <a href="https://habrahabr.ru/users/sitox/" class="user_link">sitox</a> </div><p>Source: <a href="https://habr.com/ru/post/275609/">https://habr.com/ru/post/275609/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275599/index.html">Entity vs Value Object: full list of differences</a></li>
<li><a href="../275601/index.html">Engineer's opinion: Why not use Docker anytime and anywhere</a></li>
<li><a href="../275603/index.html">Selection: 40+ useful tools, resources and research on working with email</a></li>
<li><a href="../275605/index.html">OpenShift: some gear internals</a></li>
<li><a href="../275607/index.html">Entity Framework in WinForms. Part 1</a></li>
<li><a href="../275611/index.html">How I Fought Death Screens on Legacy Blade Servers</a></li>
<li><a href="../275613/index.html">Digital sound: DSD vs PCM</a></li>
<li><a href="../275615/index.html">Desktop JavaScript applications. Part 2</a></li>
<li><a href="../275617/index.html">Being a deaf developer</a></li>
<li><a href="../275619/index.html">Create a region plugin for Oracle Application Express</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>