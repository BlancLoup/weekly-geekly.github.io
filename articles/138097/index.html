<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Porting games to Nokia N9</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will focus on porting the Forest Tower Defense game to your Nokia N9 phone. 

 I am well acquainted with Qt, but poorly with QML, fortuna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Porting games to Nokia N9</h1><div class="post__text post__text-html js-mediator-article">  This article will focus on porting the <a href="http://habrahabr.ru/blogs/gdev/136725/">Forest Tower Defense</a> game to your Nokia N9 phone. <br><img src="https://habrastorage.org/storage2/69f/99d/283/69f99d2835d4d1bc1000d77155dcebb9.png"><br>  I am well acquainted with Qt, but poorly with QML, fortunately I completely avoided using it in the application (yes, it is possible!).  All code in this article will be in C ++, oldfags approve. <br><a name="habracut"></a><br><br><h4>  Window </h4><br>  The main and only window of the game is <a href="http://developer.qt.nokia.com/doc/qt-4.8/qglwidget.html">QGLWidget</a> <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QGLWidget, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Platform { Q_OBJECT <span class="hljs-comment"><span class="hljs-comment">//...</span></span></code> </pre> <br>  What is Platform, and how to design cross-platform games, you can read <a href="http://habrahabr.ru/blogs/gdev/133897/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Graphics </h4><br>  All painting takes place in <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">QWidget :: paintEvent</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::paintEvent(QPaintEvent *) { <span class="hljs-function"><span class="hljs-function">QPainter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">painter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; m_painter = &amp;painter; Application::instance().render(); flushFragments(); }</code> </pre><br>  I want to share an interesting find - the <a href="http://developer.qt.nokia.com/doc/qt-4.8/qpainter.html">QPainter :: drawPixmapFragments method</a> (appeared in Qt 4.7).  If all images are stored in one <a href="http://developer.qt.nokia.com/doc/qt-4.8/qpixmap.html">QPixmap</a> , it is enough to create an array of <a href="http://developer.qt.nokia.com/doc/qt-4.8/qpainter-pixmapfragment.html">QPainter :: PixmapFragment objects</a> , each element of which will contain coordinates, dimensions, angle, scale, transparency and position in the original QPixmap.  After this, we make one call to QPainter :: drawPixmapFragments - and all fragments will be drawn: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::flushFragments() { m_painter-&gt;drawPixmapFragments(m_fragments.constData(), m_fragments.size(), pixmap); m_fragments.clear(); }</code> </pre><br>  This approach is faster than individual <a href="http://developer.qt.nokia.com/doc/qt-4.8/qpainter.html">QPainter :: drawPixmap calls</a> . <br><br><h4>  Full screen mode </h4><br>  To hide the toolbar and statusbar, simply call the <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">showFullScreen</a> method <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">.</a> <br><img src="https://habrastorage.org/storage2/0d8/1eb/7c8/0d81eb7c866b25c52fcbd4bcca3d891b.png" align="right"><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">** argv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">QApplication </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argc, argv)</span></span></span></span>; QWidget w; w.showFullscreen(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.exec(); }</code> </pre><br><br>  It would seem obvious, but I found out about it completely by accident - I noticed this method in the documentation and decided to try it.  If you search Google for something like ‚Äúmeego harmattan hide toolbar‚Äù, you will most likely find how to do this in QML, but not in C ++.  Be careful, QWidget also has a <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">showMaximized</a> method that doesn‚Äôt work like showFullScreen. <br><br><h4>  Sound </h4><br> <a href="https://projects.developer.nokia.com/qtgameenabler"><img src="https://habrastorage.org/storage2/a9e/77a/bff/a9e77abffc2e9bcfa4f2bf90cd8946a0.png" align="left"></a>  <a href="http://developer.qt.nokia.com/doc/qt-4.8/QSound.html">QSound</a> on the Nokia N9 does not work, this option disappears.  <a href="http://developer.qt.nokia.com/doc/qt-4.8/phonon-module.html">Phonon</a> works, but is only suitable for playing background music.  For short and fast sound effects that can be superimposed on each other, it was necessary to find something else.  My choice fell on <a href="https://projects.developer.nokia.com/qtgameenabler">QtGameEnabler</a> - a set of classes for developing games with Qt. <br><br>  I figured it out pretty quickly, here are the basic steps for adding sound effects to the game: <br><br>  a) copy the qtgameenabler folder to the project root, add a line in the .pro file <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(qtgameenabler/qtgameenableraudio.pri)</code> </pre><br>  b) create objects <a href="">AudioMixer</a> , <a href="">AudioOut</a> <br><br><pre> <code class="cpp hljs">GE::AudioMixer audioMixer; GE::<span class="hljs-function"><span class="hljs-function">AudioOut </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audioOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;audioMixer)</span></span></span></span>;</code> </pre><br>  c) create an <a href="">AudioBuffer</a> for each sound <br><br><pre> <code class="cpp hljs">GE::AudioBuffer* appleHit = GE::AudioBuffer::loadOgg(<span class="hljs-string"><span class="hljs-string">"/opt/foresttd-n9/assets/audio/appleHit.ogg"</span></span>); GE::AudioBuffer* iceCrash = GE::AudioBuffer::loadOgg(<span class="hljs-string"><span class="hljs-string">"/opt/foresttd-n9/assets/audio/iceCrash.ogg"</span></span>); GE::AudioBuffer* arrowFly = GE::AudioBuffer::loadOgg(<span class="hljs-string"><span class="hljs-string">"/opt/foresttd-n9/assets/audio/arrowFly.ogg"</span></span>);</code> </pre><br>  d) every time we want to play a sound, create an <a href="">AudioBufferPlayInstance</a> object and add it to AudioMixer <br><br><pre> <code class="cpp hljs">GE::AudioBufferPlayInstance* playOneTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GE::AudioBufferPlayInstance(appleHit); playOneTime-&gt;setDestroyWhenFinished(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); audioMixer.addAudioSource(playOneTime);</code> </pre><br><br>  There are cases when more than 10 sounds are played simultaneously, the result is an unpleasant mess.  I did not find a simple way to overcome this, but I came up with a rather elegant way out - I inherited from AudioBufferPlayInstance and created a global counter of current sounds: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundInstance</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GE::AudioBufferPlayInstance { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SoundInstance(GE::AudioBuffer* buffer) : GE::AudioBufferPlayInstance(buffer) { ++ms_count; } <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~SoundInstance() { --ms_count; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">count</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ms_count; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ms_count; }; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SoundInstance::ms_count = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Before playing each sound counter increases, after - decreases.  Thus, I can control the number of simultaneously played sounds: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SoundInstance::count() &lt; MAX_SOUNDS) { GE::AudioBufferPlayInstance* playOneTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoundInstance(sound); playOneTime-&gt;setDestroyWhenFinished(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); audioMixer.addAudioSource(playOneTime); }</code> </pre><br>  Thanks to the QtGameEnabler developers for making AudioBufferPlayInstance destructor virtual, and also for the setDestroyWhenFinished method!  And also for the fact that the latest version of the trunk supports the ogg format! <br><br>  Another very important point: in order for the game to be able to change the volume using the hardware keys, you need to: <br><br>  a) add to the .pro file <br><br><pre> <code class="hljs pgsql"># Classify the application <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> a game <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> support volume keys <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Harmattan gameclassify.files += qtc_packaging/debian_harmattan/$$<span class="pgsql"><span class="pgsql">{TARGET}.conf gameclassify.path = /usr/</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">share</span></span></span><span class="pgsql">/</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">policy</span></span></span><span class="pgsql">/etc/syspart.conf.d INSTALLS += gameclassify</span></span></code> </pre><br>  b) The file qtc_packaging / debian_harmattan / your_target_name.conf should be <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">classify gaming</span></span>] /opt/usr/bin/your_target_name</code> </pre><br><br><h4>  Input processing </h4><br>  Since I did not use multi-touch, it was enough for me to override <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">QWidget :: mousePressEvent</a> , <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">QWidget :: mouseMoveEvent</a> and <a href="http://developer.qt.nokia.com/doc/qt-4.8/qwidget.html">QWidget :: mouseReleaseEvent</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::mousePressEvent(QMouseEvent *e) { QGLWidget::mousePressEvent(e); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = height() - e-&gt;y(); m_mouseDown = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Application::instance().touch(e-&gt;x(), y); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::mouseReleaseEvent(QMouseEvent *e) { QGLWidget::mouseReleaseEvent(e); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = height() - e-&gt;y(); m_mouseDown = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Application::instance().release(e-&gt;x(), y); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::mouseMoveEvent(QMouseEvent *e) { QGLWidget::mouseMoveEvent(e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_mouseDown) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = height() - e-&gt;y(); Application::instance().drag(e-&gt;x(), y); } }</code> </pre><br>  Notice the drain "float y = height () - e-&gt; y ()".  This is to translate the ‚Äúy‚Äù values ‚Äã‚Äãfrom the QWidget coordinate system to Cartesian. <br><br><h4>  Game cycle </h4><br>  To implement the simplest game loop, I did the following: <br><br>  a) redefined <a href="http://developer.qt.nokia.com/doc/qt-4.8/qobject.html">QObject :: timerEvent</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Widget::timerEvent(QTimerEvent *) { Application::instance().simulate(); <span class="hljs-comment"><span class="hljs-comment">// game logic update(); // repaint }</span></span></code> </pre><br>  b) at the start of the game <br><br><pre> <code class="cpp hljs">m_timerId = startTimer(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  c) when the game goes into pause state <br><br><pre> <code class="cpp hljs">killTimer(m_timerId);</code> </pre><br><br><h4>  Pause </h4><br>  When the user turns off the game, you must switch to the "pause" mode: <br><br>  a) override <a href="http://developer.qt.nokia.com/doc/qt-4.8/qobject.html">QObject :: eventFilter</a> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Widget::eventFilter(QObject* object, QEvent* event) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;type() == QEvent::ActivationChange) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isActiveWindow()) { resume(); <span class="hljs-comment"><span class="hljs-comment">// start timers, resume music } else { pause(); // kill timers, pause music } } return QWidget::eventFilter(object, event); }</span></span></code> </pre><br>  b) set an event filter <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">** argv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">QApplication </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argc, argv)</span></span></span></span>; Widget w; w.show(); a.installEventFilter(&amp;w); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.exec(); }</code> </pre><br>  When I first sent the game to moderation in the Ovi Store, QA found a bug - the application did not unfold, if you minimize it and try to start it again by clicking on the .desktop icon: <br><br>  <b>Application icon after suspending the application in background.</b> <br><br>  I was very surprised by this behavior, the game was normally deployed from the screen of running applications (Open Apps Screen), but when I clicked on the icon, nothing happened.  The search for a solution to this problem was unsuccessful, all that was found was the <a href="http://harmattan-dev.nokia.com/docs/library/html/guide/html/Developer_Library_Essential_concepts_for_Harmattan_developers_Application_fundamentals_Application_lifecycle.html">MeeGo Harmattan application lifecycle</a> , but alas, QML again.  Stackoverflow was silent, developer.support@nokia.com, too, had to look for a way out.  I decided to check if any events come to QWidget :: eventFilter when I click on the icon: <br><br><pre> <code class="hljs scala">bool <span class="hljs-type"><span class="hljs-type">Widget</span></span>::eventFilter(<span class="hljs-type"><span class="hljs-type">QObject</span></span> *<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QEvent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*event</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">==</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QEvent</span></span></span></span>::<span class="hljs-type"><span class="hljs-type">ActivationChange</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isActiveWindow()) { resume(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { pause(); } } qDebug() &lt;&lt; event-&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">QWidget</span></span>::eventFilter(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">)</span></span>; }</code> </pre><br>  It turned out that an event with code 50 arrives. I looked at this event: <br>  <b><a href="http://developer.qt.nokia.com/doc/qt-4.8/qevent.html">QEvent :: SockAct</a> - Socket activated, used to implement QSocketNotifier.</b> <br>  WTF?  What is a socket ?!  After all, my game does not go online.  Know, tell me, please.  The funniest thing is the only event for which I could catch, which I did: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Widget::eventFilter(QObject *object, QEvent *event) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;type() == QEvent::ActivationChange) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isActiveWindow()) { resume(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { pause(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event-&gt;type() == QEvent::SockAct) <span class="hljs-comment"><span class="hljs-comment">// pure magic { activateWindow(); resume(); } return QWidget::eventFilter(object, event); }</span></span></code> </pre><br><br><h4>  Vibro </h4><br>  To add vibro effects you need: <br><br>  a) add the following lines to the .pro file <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">CONFIG</span></span> += mobility MOBILITY += feedback</code> </pre><br>  b) connect the necessary header file <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QFeedbackHapticsEffect&gt;</span></span></span></span></code> </pre><br>  c) create an effect object <br><br><pre> <code class="cpp hljs">QFeedbackHapticsEffect vibro; vibro.setAttackIntensity(<span class="hljs-number"><span class="hljs-number">0.0</span></span>); vibro.setAttackTime(<span class="hljs-number"><span class="hljs-number">40</span></span>); vibro.setIntensity(<span class="hljs-number"><span class="hljs-number">0.5</span></span>); vibro.setDuration(<span class="hljs-number"><span class="hljs-number">80</span></span>); vibro.setFadeTime(<span class="hljs-number"><span class="hljs-number">40</span></span>); vibro.setFadeIntensity(<span class="hljs-number"><span class="hljs-number">0.0</span></span>);</code> </pre><br>  d) at the right time call <br><br><pre> <code class="cpp hljs">vibro.start();</code> </pre><br>  Everything seems to be simple here, but initially I wanted to achieve such a vibro effect as when pressing the buttons of the virtual keyboard in the Nokia N9.  If someone knows how to do this - please share. <br><br><h4>  Resources </h4><br>  I did not want to pack resources into a .rc file, because I have a shared folder for Android / Desktop / MeeGo and it is two levels higher, while QtCreator requires that all resources be inside the project folder (a bit strange requirement, do not find?) <br><br>  So I went a different way and added a rule to copy resources into the .pro file: <br><br><pre> <code class="hljs mel">assetsDir.<span class="hljs-keyword"><span class="hljs-keyword">source</span></span> = ../../assets DEPLOYMENTFOLDERS = assetsDir installPrefix = /opt/$${TARGET} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(deploymentfolder, DEPLOYMENTFOLDERS) { item = item$${deploymentfolder} itemfiles = $${item}.files $$itemfiles = $$<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>($${deploymentfolder}.<span class="hljs-keyword"><span class="hljs-keyword">source</span></span>) itempath = $${item}.path $$itempath = $${installPrefix}/$$<span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>($${deploymentfolder}.target) export($$itemfiles) export($$itempath) INSTALLS += $$item }</code> </pre><br>  Now all files and folders that were in ../../assets will be copied to N9 during installation and will be available at / opt / foresttd-n9 / assets <br><br><h4>  Icon </h4><br><img src="https://habrastorage.org/storage2/dca/8b8/89e/dca8b889e2682b84ff55eeced984f04a.png" align="left"><br>  Making an icon in the style of MeeGo Harmattan is easy if you use the blank file <a href="http://harmattan-dev.nokia.com/docs/ux/pages/Development.html">from here</a> (Icon Templates) <br><br><br><br><h4>  Result </h4><br>  The application has already appeared in the <a href="http://store.ovi.com/content/253781">Ovi Store</a> , its cost is 2EUR.  It should be noted that this is the only tower defense game for the Nokia N9 in the Ovi Store.  The QA process was pretty fast - the game was pending for 2 days and another 1 day after I fixed a bug.  Free testing of your application by Nokia engineers is a positive thing. <br><br>  I want to express gratitude to Nokia for the N9, the phone is very cool. <br>  Also, I thank all the habrawans for numerous bug reports, reviews and ideas for improving the free version of the game for Android, on the market you can find an <a href="https://market.android.com/details%3Fid%3Dcom.foresttd.free">update with new levels</a> . </div><p>Source: <a href="https://habr.com/ru/post/138097/">https://habr.com/ru/post/138097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138092/index.html">Mailing questions: how to send UniSender letters</a></li>
<li><a href="../138093/index.html">Expensive roads: Wi-Fi for travelers</a></li>
<li><a href="../138094/index.html">HTML5 Comics</a></li>
<li><a href="../138095/index.html">Microsoft Research Summer School on Parallel Computing opens the registration of participants</a></li>
<li><a href="../138096/index.html">Excavations build photohosting VK</a></li>
<li><a href="../138098/index.html">Argentina, Chile and Bolivia plan to create a lithium cartel modeled on OPEC</a></li>
<li><a href="../138100/index.html">The controller of the new Xbox will be touch</a></li>
<li><a href="../138101/index.html">The best way to learn Rails</a></li>
<li><a href="../138102/index.html">How to access all properties of an object without using "reflection"</a></li>
<li><a href="../138103/index.html">DIY server-side LESS file processing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>