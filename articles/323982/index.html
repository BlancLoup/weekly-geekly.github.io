<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to extend the functionality of an application hosted on the Mac Store using Apple Script</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the passage of moderation on the Mac Store began to require support for Sandbox, 5 years have passed. Although the capabilities of MacOS and San...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to extend the functionality of an application hosted on the Mac Store using Apple Script</h1><div class="post__text post__text-html js-mediator-article">  Since the passage of moderation on the Mac Store began to require support for Sandbox, 5 years have passed.  Although the capabilities of MacOS and Sandbox are gradually expanding, developers who want to publish in the official Apple store are still limited in their capabilities to work with this OS.  This problem is especially acute for utilities and system applications. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/577/f0b/acc/577f0baccc4d4fa0896697cb9aa82019.jpg"></div><br>  Sandbox is designed to make macOS safer and protect the user from malicious and potentially dangerous applications - all applications that can hypothetically harm should be accompanied by a request to the user to provide access.  In theory, this is a reasonable precaution, but in reality many applications that require user data to perform basic functions are subject to sanctions.  In this article, we will describe how they implemented similar functions in the application, maintaining compatibility with Sandbox - perhaps this experience will be useful for other developers working with the official market. <br><br>  We are faced with a similar need when working with the utility for monitoring the <a href="http://wgames.ssdzoner.com/go.php%3Fid%3DW9iL17">MaCleaner X</a> system.  The entire MaCleaner product line is distributed exclusively through the Mac App Store. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Distinctive features of MaCleaner X are the <a href="https://habrahabr.ru/company/everydaytools/blog/317232/">touchbar</a> support and customized design: the application automatically detects the Mac model and offers a special interface option for each device.  However, in addition to this, we are currently working on implementing in the extended version some functions that users would like to see in the program and which are considered familiar for utilities distributed outside the Mac Store. <br><a name="habracut"></a><br>  First of all it is: <br><br><ul><li>  removal of applications and all related information; </li><li>  Removal of unused service files from macOS (logs, localization, temp); </li><li>  obtaining system information about hardware (for example, about a hard disk); </li><li>  temperature monitoring and other system indicators. </li></ul><br>  <b>Solution</b> <br><br>  To begin with, we will outline in general terms, according to which scheme the whole process will take place: <br><br><ul><li>  The user must consent to access to extend the functionality (in fact, he will need to perform several actions outside the application); </li><li>  The application always works in the sandbox, but if necessary, before each action that requires administrative access rights, it requests permission from the user. </li></ul><br>  To perform this operation outside the sandbox, we will use the following macOS feature: applications that support extending their functionality using Apple Script can run these scripts outside the sandbox, if they are located in the ~ / Library / Application Scripts folder.  An application that supports Sandbox cannot copy scripts to this folder by itself ‚Äî this is stopped by Apple moderators. <br><br>  Thus, the sequence of actions we have the following: <br><br><ol><li>  Implementing a master application that supports extensions using Apple Script from the Application Scripts folder. </li><li>  Passage of moderation and publication of the application in the Mac Store </li><li>  Preparation of the extension-application.  His tasks will include copying the necessary scripts into a shared folder with the master application.  To do this, they must have a common AppGroup, through which the exchange will take place. </li><li>  Publication of the extension-application on its own website. </li></ol><br>  <b>Example</b> <br><br>  As an example, consider the possibility of obtaining information about current media using the bash-command <code>system_profiler SPStorageDataType</code> . <br><br>  <b>Extension Application Preparation</b> <br><br>  All that is required of this component is copying the script to a specific folder.  Therefore, in its interface we will display the only possibility: enabling or disabling the display of information about media (in order not to load the user with details, this can be represented as enabling / disabling plug-ins in the master application). <br><br>  Apple Sript - bash <br><br>  The contents of the file extract_storage_info.scpt, which is copied by ectention: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> shell script <span class="hljs-string"><span class="hljs-string">"system_profiler SPStorageDataType"</span></span></code> </pre> <br>  <b>Preparing Master Applications</b> <br><br>  For the application to work correctly from the user's point of view, it is necessary to check the availability of additional functionality and hide the corresponding parts of the UI: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>) isStorageInfoAvailable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> _storageInfoScriptTask] != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; } <span class="hljs-meta"><span class="hljs-meta">#pragma mark - Private - (NSUserAppleScriptTask *)_storageInfoScriptTask { NSUserAppleScriptTask *result = nil; NSError *error; NSURL *directoryURL = [[NSFileManager defaultManager] URLForDirectory:NSApplicationScriptsDirectory inDomain:NSUserDomainMask appropriateForURL:nil create:YES error:&amp;error]; if (directoryURL) { NSURL *scriptURL = [directoryURL URLByAppendingPathComponent: StorageInfoScriptFileName]; result = [[NSUserAppleScriptTask alloc] initWithURL:scriptURL error:&amp;error]; if (error != nil) { NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"No AppleScript \"</span></span></span><span class="hljs-meta">%@\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" task error: %@"</span></span></span><span class="hljs-meta">, StorageInfoScriptFileName, error); } } else { //   ,      Sandbox NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"No Application Scripts folder error: %@"</span></span></span><span class="hljs-meta">, error); } return result; }</span></span></code> </pre> <br>  If the script is available, it is called as follows: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSUserAppleScriptTask</span></span> * automationScriptTask = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> _storageInfoScriptTask]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (automationScriptTask != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { [automationScriptTask executeWithAppleEvent:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> completionHandler:^(<span class="hljs-built_in"><span class="hljs-built_in">NSAppleEventDescriptor</span></span> *resultEventDescriptor, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"AppleScript \"%@\" executing error: %@"</span></span>, StorageInfoScriptFileName, error); <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    GUI } else { NSString* resultString = [resultEventDescriptor stringValue]; NSLog(@"Result string:\n%@", resultString); //     } }]; } else { //</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">    GUI }</span></span></code> </pre><br>  In our simplified example, we display the string received from the executed script as is.  To style an application, it will be necessary to parse the result and display only the necessary information. <br><br>  <b>Application collaboration</b> <br><br>  As a result, we get the following scheme of work. <br><br>  <b>Master application</b> <br><br><ol><li>  In case of unavailability of additional functionality, it hides UI elements. </li><li>  In the case of expanding scripts, Apple Script (in a specific format) activates the UI and executes them. </li><li>  If the functions that Apple Script performs require that the administrator's account data be entered, the user will see the standard authorization dialog ‚Äî Apple Script will do the work for us. </li></ol><br>  <b>Extension application</b> <br><br><ol><li>  Must be downloaded by the user from the developer site.  We are talking about a special site, because it is necessary to explain to the user the principle of the system functioning and the actions that he needs to carry out in order to work correctly.  In part, this can be done through the GUI extension. </li><li>  Despite the fact that we work outside the sandbox, we suggest using the general AppGroup for component solutions. </li><li>  This component can be represented even more widely - as an Extension Manager.  Thanks to a consistent interface, the master application can expand as extensions appear in the shared folder: they can be added along with the description files and configurations. </li><li>  The Apple Script copied may even contain a common task function (bash_script) that accepts an arbitrary bash command as input and executes it.  But this approach opens a big security hole, and also obliges the master-application to contain an extension before publishing to the App Store. </li></ol><br>  <b>findings</b> <br><br>  Advantages of the approach: <br><br><ul><li>  Expansion of application functionality </li><li>  Configurability extensions </li></ul><br>  Minuses: <br><br><ul><li>  Not rational in terms of usability.  An additional action is required from the user - downloading a third-party application. </li><li>  Potential security hole and the need for additional checks, format consistency. </li></ul><br>  This article offers a solution to the problem with product functionality restrictions dictated by Sandbox for developers.  In the future, we will tell you about how the situation looks from the users.  If you found other workarounds, we will be happy if you share them in the comments. </div><p>Source: <a href="https://habr.com/ru/post/323982/">https://habr.com/ru/post/323982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323972/index.html">What was accepted in C ++ 17 is a photograph of Bjarne Straustrup and a survey for C ++ 20</a></li>
<li><a href="../323974/index.html">Want to know everything about web and mobile development? Ask me how: DevCon School IV</a></li>
<li><a href="../323976/index.html">How to wake up an application in iOS: on schedule and not</a></li>
<li><a href="../323978/index.html">Intel and Google - we are friends "clouds"</a></li>
<li><a href="../323980/index.html">Cloud Digest: 35 materials on information security and data center technology development</a></li>
<li><a href="../323984/index.html">Two DHCP servers on Centos7 with failover, dhcp-relay and dynamic zone update</a></li>
<li><a href="../323986/index.html">Conference Axis Tel Aviv 2017, Israel (day one)</a></li>
<li><a href="../323988/index.html">Conference Axis Tel Aviv 2017, Israel (second day)</a></li>
<li><a href="../323990/index.html">Dealer Mobility Ecosystem: How We Made Friends of Official Dealers With Their Customers</a></li>
<li><a href="../323992/index.html">Frequently used passwords: how not to get caught yourself and protect users</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>