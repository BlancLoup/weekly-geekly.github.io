<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to Gjallarhorn.Bindable.WPF (F #) on the example of the test</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In articles in Russian, the topic of using F# conjunction with WPF paying little attention. 


 Today I will try to introduce you to one of the F# lib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to Gjallarhorn.Bindable.WPF (F #) on the example of the test</h1><div class="post__text post__text-html js-mediator-article"><p> In articles in Russian, the topic of using <code>F#</code> conjunction with <code>WPF</code> paying little attention. </p><br><p>  Today I will try to introduce you to one of the <code>F#</code> libraries, which greatly simplifies this development. </p><br><p>  As a demo, let's take one of the <code>WPF</code> test tasks, which give applicants for the position of Junior-developer to test their knowledge. </p><br><p>  The task itself sounds like this </p><br><blockquote>  It is necessary to develop an application using the data presented in the Students.xml file. <br><br>  The specified file contains the following information about students: last name, first name, age, gender. </blockquote><p>  Of course, there are additional recommendations and restrictions on implementation, but we will not copy them entirely.  The main parts will be given in the text if necessary, and the full version is available <a href="">here.</a> </p><a name="habracut"></a><br><p>  To begin, create an empty console project for the .NET Framework in Visual Studio (or any other preferred IDE).  If you do not want to see the debugging console, then you will need to change the type of output data in the project settings. </p><br><p>  We start the work on our simple application from the main step - defining the main data types (those that are not dependent on the user interface). </p><br><p>  Let's use F # - types which (for the time being) have no analogues in C # - records ( <code>Record</code> ) and marked associations ( <code>Discriminated Union</code> ). </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class"> = |</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Male</span></span></span><span class="hljs-class"> |</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Female</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Student</span></span></span><span class="hljs-class"> = {</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FirstName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LastName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Age</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class">}</span></span></code> </pre> <br><p>  Here, perhaps, it is worth staying.  There is one more thing on which the emphasis in the task was not made - the uniqueness of the record.  In theory, there may be students who will have all the listed fields coincide. </p><br><p>  But, if we look at the sample xml file </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Students</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span>Robert<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span>Jarman<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span>21<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Students</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  then we note that the ID is specified as an attribute, so we can simply add another field: </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Student</span></span></span><span class="hljs-class"> = {</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FirstName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LastName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Age</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class">; }</span></span></code> </pre> <br><p>  Such an announcement has one major drawback - having an ID does not guarantee the uniqueness of the record. </p><br><p>  That is, in theory, you can add any number of records with the same identifier. </p><br><p>  F # does not allow assignment of access modifiers for individual fields, but allows for types. </p><br><p>  If we wanted to protect ourselves, we could put an explicit indication that we want to see the <code>Student</code> type private: </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Student</span></span></span><span class="hljs-class"> = private {</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FirstName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LastName</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Age</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Gender</span></span></span><span class="hljs-class">; }</span></span></code> </pre> <br><p>  and write a function to create an object </p><br><pre> <code class="hljs sql">let <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> firstname lastname age gender = let <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = getNextId() { <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> FirstName = firstname ... }</code> </pre> <br><p>  Consider the requirements for limiting the allowed field values: </p><br><blockquote>  fields with first name, last name and gender are required; <br>  The age cannot be negative and must be in the range [16, 100]. </blockquote><p>  A natural question immediately arises - where to check the correctness of the input parameters? </p><br><p>  If the type <code>Student</code> was protected, then it would be possible to write a function <code>tryCreate</code> , which would return <br>  <code>None</code> / <code>Error&lt;string&gt;</code> or <code>Some&lt;Student&gt;</code> / <code>Ok&lt;Student&gt;</code> depending on the test result. </p><br><blockquote>  <code>Result</code> useful if you need not only to signal that an attempt to issue a student was unsuccessful, but also to specifically indicate where the problem occurred. </blockquote><p>  Beyond the obvious implementation, we will not add the code of this function to the article. </p><br><p>  Let's remember the approach described above, but we will take the responsibility of controlling the data to the link between View and Model. </p><br><p>  Before moving on to the part responsible for the presentation, close the topic of the main features of the application. </p><br><blockquote><ul><li>  creating a new item and adding to the list; </li><li>  editing any entry in the list; </li><li>  delete one or more entries from the list. </li></ul><br></blockquote><p>  With the creation have already figured out, add a few more features </p><br><pre> <code class="hljs haskell">//  ; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> add xs student = student :: xs //   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> remove students = <span class="hljs-type"><span class="hljs-type">List</span></span>.filter (fun student -&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>.contains student students |&gt; not) //    ; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> editFirstName firstname student = { student with <span class="hljs-type"><span class="hljs-type">FirstName</span></span> = firstname } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> editLastName lastname student = { student with <span class="hljs-type"><span class="hljs-type">LastName</span></span> = lastname } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> editAge age student = { student with <span class="hljs-type"><span class="hljs-type">Age</span></span> = age} <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> editGender gender student = { student with <span class="hljs-type"><span class="hljs-type">Gender</span></span> = gender } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> editId student id = {student with <span class="hljs-type"><span class="hljs-type">ID</span></span> = id} <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> edit student = <span class="hljs-type"><span class="hljs-type">List</span></span>.map (fun st -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> st.<span class="hljs-type"><span class="hljs-type">ID</span></span> = student.<span class="hljs-type"><span class="hljs-type">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> student <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> st)</code> </pre> <br><p>  and move on to the next step. </p><br><h3 id="chtenie-i-zapis-v-xml">  Reading and Writing XML </h3><br><p>  To work with data in F # there is an excellent mechanism called the type provider (sometimes it is also called the data provider (for) data, but due to the greater prevalence, we will use the first option in the future). </p><br><p>  There are many implementations for convenient work with this or that format. <br>  In this part we need only XmlProvider (from the library <a href="http://fsharp.github.io/FSharp.Data/"><code>FSharp.Data</code></a> ). <br>  Add this <a href="https://www.nuget.org/packages/FSharp.Data/">package</a> to the project: </p><br><p> <code>Install-Package FSharp.Data</code> </p> <br><p>  Note that the <code>XmlProvider</code> type is used inside the <code>XmlProvider</code> , so we still need a reference to <br>  <code>System.Xml.Linq</code> . </p><br><pre> <code class="hljs xml">open FSharp.Data let [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Literal</span></span></span><span class="hljs-tag">&gt;</span></span>] Sample = """ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Students</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span>Robert<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span>Jarman<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span>21<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span>Leona<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span>Menders<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Last</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span>20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Age</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Gender</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Student</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Students</span></span></span><span class="hljs-tag">&gt;</span></span>""" type Students = XmlProvider<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Sample</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  In the sample used, <code>Id</code> specified as <code>{0, 2}</code> and not <code>{0, 1}</code> as in the file, so that the type is defined as an <code>int</code> , not a <code>bool</code> . </p><br><p>  In general, complex logic may be required in order to convert types from the data source format to the types adopted in the application.  However, since we have these data structures almost completely coincide, we will need only one additional function to establish the correspondence between the value of type <code>bool</code> and the marked union. </p><br><pre> <code class="hljs rust"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fromBool = function | <span class="hljs-literal"><span class="hljs-literal">true</span></span> -&gt; Female | <span class="hljs-literal"><span class="hljs-literal">false</span></span> -&gt; Male</code> </pre> <br><p>  Record <code>function | true -&gt; Female | false -&gt; Male</code> <code>function | true -&gt; Female | false -&gt; Male</code>  <code>function | true -&gt; Female | false -&gt; Male</code> means exactly the same as <br>  <code>match x with</code> but only in a shorter form.  This form is convenient to use for trivial comparison with the sample. </p><br><p>  The next part also does not cause problems - everything is simple and clear. </p><br><pre> <code class="hljs kotlin">let toCoreStudent (student:Students.Student) = student.Gender |&gt; fromBool |&gt; create student.Id student.FirstName student.Last student.Age let readFromFile (path : string) = Students.Load path |&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> x -&gt; x.Students |&gt; Seq.map toCoreStudent</span></span></code> </pre> <br><p>  But that's not all, you need to consider that the user can add data to the list, therefore you need to be able not only to extract data from a file, but also to write. </p><br><p>  The code will be exactly the same, except that the conversion will go in a different direction. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> toBool = function | Male -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> | Female -&gt; <span class="hljs-function"><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">true</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromCoreStudent</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">student:Student</span></span></span><span class="hljs-function">)</span></span> = Students.Student(student.ID, student.FirstName, student.LastName, student.Age, toBool student.Gender) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> toXmlStudents data = data |&gt; Seq.map fromCoreStudent |&gt; Seq.toArray |&gt; Students.<span class="hljs-function"><span class="hljs-function">Students </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToFile</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path : </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span></span><span class="hljs-function">) data</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> students = data |&gt; toXmlStudents students.XElement.Save path</code> </pre> <br><p>  We emphasize that everything that has so far been considered does not have a dependency on WPF and, with the possible transfer (for example, to a different type of interface), there will be no changes in this part. </p><br><p>  Normally, it makes sense to bring such code into the class library, but since the functional part not related to a specific format (.xml) is too small, a separate project was not used to create a completely separate module. </p><br><h3 id="polzovatelskiy-interfeys">  User interface </h3><br><p>  Our goal is to write a project entirely in F #, so we‚Äôll resort to the help of <a href="https://github.com/fsprojects/FsXaml"><code>FsXAML</code></a> in the interface issue. <br>  There is nothing wrong with writing a part in C #, but agree that this would not be so interesting. </p><br><p>  <code>FsXAML</code> is a type provider that allows us to conveniently use <code>xaml</code> files.  You can add it to the project via <a href="https://www.nuget.org/packages/FsXaml.Wpf/">NuGet</a> . </p><br><p> <code>Install-Package FsXaml.Wpf</code> </p> <br><p>  <code>XamlReader</code> can read about the benefits of <code>XamlReader</code> in a separate response to <a href="https://stackoverflow.com/questions/30859148/advantage-of-fsxaml-type-provider-over-xamlreader">StackOverFlow (in English)</a> </p><br><p>  One of its drawbacks is the lack of documentation, so it‚Äôs not at once possible to find out that there are converters there, as well as a convenient wrapper for writing your own. </p><br><p>  Here we just need a converter to correctly display the age and errors of validation. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AgeToStringConverter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> = <span class="hljs-function"><span class="hljs-function">inherit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConverterBase</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fun </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _ _ _ -&gt; match </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params"> with | :? </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> -&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params"> |&gt; unbox |&gt; AgeToStringConverter.ageToStr |&gt; box | _ -&gt; </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> member ageToStr age</span></span> = ...</code> </pre> <br><p>  where <code>ConverterBase</code> is the base class from <code>FsXAML</code> for creating converters. </p><br><p>  Let's repeat the main requirements for the application, but now we will look at them from the point of view of appearance. </p><br><blockquote><ul><li>  display a list of existing elements; </li><li>  creating a new item and adding to the list; </li><li>  editing any entry in the list; </li><li>  delete one or more entries from the list. </li></ul><br></blockquote><p>  In order to display a list of items it will be convenient to use <code>ListView</code> . <br>  In addition to the student table, the control buttons will also be located in the main window. <br>  All together forms a <code>UserControl</code> which represents the main ‚Äúpage‚Äù of the application. </p><br><p><img src="https://habrastorage.org/webt/jy/ze/sn/jyzesnu-xi7tpzizpyuoi0ilddo.jpeg"></p><br><p>  No other pages are foreseen, so using navigation may seem like a redundant solution. </p><br><p>  But for demonstration, simple examples are the best fit. </p><br><p>  We will edit and add information about the student in the dialog box. </p><br><p>  After creating <code>xaml</code> files, you need to create types for them. </p><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">XAML</span></span>&lt;<span class="hljs-string"><span class="hljs-string">"App.xaml"</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainWin</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">XAML</span></span>&lt;<span class="hljs-string"><span class="hljs-string">"MainWindow.xaml"</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentsControl</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">XAML</span></span>&lt;<span class="hljs-string"><span class="hljs-string">"StudentsControl.xaml"</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentDialogBase</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">XAML</span></span>&lt;<span class="hljs-string"><span class="hljs-string">"StudentDialog.xaml"</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StudentDialog</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span></span>= inherit <span class="hljs-type"><span class="hljs-type">StudentDialogBase</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-type"><span class="hljs-type">CloseClick</span></span> (_sender, _e) = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-type"><span class="hljs-type">Close</span></span>()</code> </pre> <br><p>  Beginning with version <code>FsXAML</code> , basic support for event handling has been added to <code>FsXAML</code> .  In the example above, the window is closed after clicking on the confirmation button. </p><br><h4 id="gjallarhornbindable">  Gjallarhorn.Bindable </h4><br><p>  To connect our model with the presentation we will use the new, but very promising, library <a href="https://github.com/ReedCopsey/Gjallarhorn.Bindable">Gjallarhorn.Bindable</a> </p><br><p> <code>Install-Package Gjallarhorn.Bindable.Wpf -Version 1.0.0-beta5</code> </p> <br><p>  The latest available <a href="https://www.nuget.org/packages/Gjallarhorn.Bindable.Wpf/">release</a> , which is still in beta. </p><br><p>  The basic concept is a peculiar transposition of the <code>Elm</code> architecture with <code>wpf</code> specificity over the main <a href="http://reedcopsey.github.io/Gjallarhorn/">Gjallarhorn</a> library.  In addition to the <code>wpf</code> version, there is also a <a href="https://www.nuget.org/packages/Gjallarhorn.Bindable.XamarinForms/">package</a> for <code>XamarinForms</code> . </p><br><p>  To create an application, it is convenient to use the <code>application</code> function from the <code>Framework</code> module: </p><br><pre> <code class="hljs sql">Framework.application model <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> appComponent <span class="hljs-keyword"><span class="hljs-keyword">nav</span></span></code> </pre> <br><p>  which connects the individual parts (model, function to update it, component to communicate with the view and navigator) </p><br><ul><li>  <code>model</code> - application model (top-level model) - basic data with which further work is to be done. </li><li>  <code>update:('message -&gt; 'model -&gt; 'model)</code> function that processes the model ( <code>model</code> ) depending on the message received ( <code>message</code> ) and returns a new value. </li></ul><br><p>  Based on the task, our application should be able to add, edit and delete items from the list. </p><br><p>  For each action, it is convenient to create a separate message, represented as a named variant of the marked association. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> AppMessages = |<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student |Edit <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student |Remove <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student seq |Save</code> </pre> <br><p>  To the already listed features added another function to overwrite the file. </p><br><p>  When adding a new entry to the list, you need to take into account the increment ( <code>ID</code> ) for the unique identifier. </p><br><p>  To do this, you can write a helper function <code>getId</code> , which returns the next sequence number after the maximum one in the list. </p><br><p>  There are no other pitfalls in the update function, so as a result it takes the following form </p><br><pre> <code class="hljs sql">let <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> |<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> student -&gt; <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> |&gt; getId |&gt; editId student |&gt; <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> |Edit newValue -&gt; <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> |&gt; edit newValue |Remove students -&gt; <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> |&gt; remove students |<span class="hljs-keyword"><span class="hljs-keyword">Save</span></span> -&gt; XmlWorker.writeToFile <span class="hljs-keyword"><span class="hljs-keyword">path</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> <span class="hljs-keyword"><span class="hljs-keyword">model</span></span></code> </pre> <br><p>  To determine the navigation states, we also use the tagged union. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> CollectionNav = | ViewStudents | AddStudent | EditStudent <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student</code> </pre> <br><p>  All, the navigation framework is ready and you can proceed to linking navigation messages with messages for the application. </p><br><p>  Similar to updating the model, the status update is also implemented in the <code>update</code> function. </p><br><pre> <code class="hljs kotlin">let updateNavigation (_ : ApplicationCore&lt;Student list,_,_&gt;) request : UIFactory&lt;Student list,_,_&gt; = match request with |ViewStudents -&gt; Navigation.Page.fromComponent StudentsControl id appComponent id |AddStudent -&gt; Navigation.Page.dialog StudentDialog (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> _ -&gt; defaultStudent) studentComponent Add |EditStudent x -&gt; Navigation.Page.dialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StudentDialog</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">fun</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _ -&gt; x)</span></span></span></span> studentComponent Edit</code> </pre> <br><p>  It uses two functions provided by the library. </p><br><p> <code>Navigation.Page.fromComponent</code> </p> <br><pre> <code class="hljs rust">fromComponent : (makeElement : unit -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'UIElement</span></span>) -&gt; (modelMapper : <span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'Submodel</span></span>) -&gt; (comp : IComponent&lt;<span class="hljs-symbol"><span class="hljs-symbol">'Submodel</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">'Nav</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">'Submsg</span></span>&gt;) -&gt; (msgMapper : <span class="hljs-symbol"><span class="hljs-symbol">'Submsg</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'Message</span></span>) -&gt; UIFactory&lt;_,_,_&gt;</code> </pre> <br><p>  and </p><br><p> <code>Navigation.Page.dialog</code> </p> <br><pre> <code class="hljs rust">dialog : (makeElement : unit -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'Win</span></span>) -&gt; (modelMapper : <span class="hljs-symbol"><span class="hljs-symbol">'Model</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'Submodel</span></span>) -&gt; (comp : IComponent&lt;<span class="hljs-symbol"><span class="hljs-symbol">'Submodel</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">'Nav</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">'Submsg</span></span>&gt;) -&gt; (msgMapper : <span class="hljs-symbol"><span class="hljs-symbol">'Submsg</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'Message</span></span>) = -&gt; UIFactory&lt;_,_,_&gt;</code> </pre> <br><p>  Between themselves, they are very similar, so we will not give their descriptions separately. </p><br><p>  The first argument is the function ( <code>makeElement</code> ), which sets the displayed element (window ( <code>Window</code> ) or control ( <code>UIElement</code> )). </p><br><p>  A constructor is essentially the same function, so in most cases it is enough for us to pass the desired type. </p><br><p>  The second argument ( <code>modelMapper</code> ) is the conversion function from the top level model to the model level below. </p><br><p>  In our case, with editing, we get the object of interest ( <code>Student</code> ) as a parameter, so we can simply pass it on.  For adding, we pass the default value. </p><br><p>  For the main state of <code>ViewStudents</code> the main component model will be an application model, so no changes need be made and you can apply <br>  standard F # <a href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/operators.id%255B%2527t%255D-function-%255Bfsharp%255D"><code>id</code></a> function </p><br><p>  Next comes the component ( <code>comp</code> ), which contains all the necessary bindings for interacting with the interface. </p><br><p>  The <code>appComponent</code> component is <code>IComponent&lt;Student list, CollectionNav, AppMessages&gt;</code> , and the <code>studentComponent</code> type is <code>IComponent&lt;Student, CollectionNav, Student&gt;</code> respectively. </p><br><p>  The last argument ( <code>msgMapper</code> ) is the inverse transform function for messages.  The <code>studentComponent</code> component will return the student, so here we can only send the correct message to the top. </p><br><p>  You can proceed to the final part - the consideration of the components themselves. </p><br><p>  The data binding in <code>Gjallarhorn.Bindable.WPF</code> is responsible for the <code>Bind</code> module, which in turn is divided into several submodules. </p><br><p>  The main (root) API (comment has been added since the first version) is more secure, but <em>sometimes</em> more cumbersome and the second is <em>explicit</em> (functions from the <code>Explicit</code> module). </p><br><p>  Here, to show both approaches, <code>Explicit</code> used to obtain information about the student and <code>Implicit</code> for the main one. </p><br><p>  Note that both components are independent of each other. </p><br><p>  Let's start with the main <code>appComponent</code> - <code>appComponent</code> </p><br><p>  To use the new API, you need to declare an intermediate type, which should contain all the properties and commands that are set. </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppViewModel</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Students</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Student</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VmCmd</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CollectionNav</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Edit</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VmCmd</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CollectionNav</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Remove</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VmCmd</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppMessages</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RemoveAll</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VmCmd</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppMessages</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Save</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VmCmd</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppMessages</span></span></span><span class="hljs-class">&gt; }</span></span></code> </pre> <br><p>  Commands are set using a special type of <code>VmCmd</code> that simply stores the message. <br>  This leads to the fact that the names for teams are obtained using quoting (sometimes called quoting). </p><br><p>  Thus, we avoid the "magic lines", which reduces the risk of errors due to mismatched names caused by typos. </p><br><p>  Before creating the component, we need to create a basic instance (the default value) of the <code>VM</code> type </p><br><pre> <code class="hljs dos">let appvd = { Students = [] Edit = Vm.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> (CollectionNav.EditStudent defaultStudent) Add = Vm.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> CollectionNav.AddStudent Remove = Vm.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> (AppMessages.Remove [defaultStudent]) RemoveAll = Vm.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> (AppMessages.Remove [defaultStudent]) Save = Vm.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> AppMessages.Save }</code> </pre> <br><p>  First you need to take into account the blocking of some buttons, if the list is empty, therefore we define a function that contains information about the presence of elements: </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> hasStudents = List.<span class="hljs-built_in"><span class="hljs-built_in">isEmpty</span></span> &gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">not</span></span></code> </pre> <br><p>  (in principle, it was possible to use a data trigger ( <code>DataTrigger</code> ) as it was done to change the <code>ListView</code> template). </p><br><p>  Then create a component by passing the list of all bindings to the <code>Component.create</code> function as shown below. </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> appComponent = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> hasStudents = List.isEmpty &gt;&gt; not Component.create&lt;Student list, CollectionNav, AppMessages&gt; [ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.Students</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.oneWay id </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.Edit</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.cmdParam EditStudent |&gt; Bind.toNav </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.Add</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.cmd |&gt; Bind.toNav </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.Save</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.cmd </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.Remove</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.cmdParamIf hasStudents (Seq.singleton &gt;&gt; Remove) </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">@</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">appvd.RemoveAll</span></span></span></span><span class="xml"><span class="hljs-tag"> @&gt;</span></span></span><span class="xml"> |&gt; Bind.cmdParamIf hasStudents (Seq.cast &gt;&gt; Remove) ]</span></span></code> </pre> <br><p>  <code>Bind.oneWay</code> designed to create a unidirectional binding. </p><br><p>  <code>Bind.cmd</code> , <code>Bind.cmdParam</code> and <code>Bind.cmdParamIf</code> create respectively a command, commands with a parameter and a command with an additional check for execution. </p><br><p>  Let's pay attention to some moments - in order not to start two separate messages (for deleting one and several elements) the transferred object forms a sequence of unit length. </p><br><pre> <code class="hljs cmake">&lt;@ appvd.<span class="hljs-keyword"><span class="hljs-keyword">Remove</span></span> @&gt; |&gt; Bind.cmdParamIf hasStudents (Seq.singleton &gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">Remove</span></span>)</code> </pre> <br><p>  Since <code>SelectedItems</code> , unfortunately, is not a generalized collection, an additional transformation has to be applied here. </p><br><pre> <code class="hljs pgsql">&lt;@ appvd.RemoveAll @&gt; |&gt; Bind.cmdParamIf hasStudents (Seq.<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span> &gt;&gt; Remove)</code> </pre> <br><p>  Navigation messages are sent using <code>Bind.toNav</code> . </p><br><p>  It is worth noting here that instead you can use another approach that leaves the components "clean" (without the side effects of navigation). </p><br><p>  Its essence is to make not only all changes in the <code>update</code> functions, but also the change requests themselves. </p><br><p>  In our case, they are requests to add and edit information about the student. </p><br><p>  In other words, it is necessary to remove calls to <code>Bind.toNav</code> in the component or direct dispatches through the dispatcher (if an explicit API is used). </p><br><p>  Let's look at this method by example. </p><br><p>  Add the <code>AddRequest</code> and <code>EditRequest</code> to the <code>AppMessages</code> type which reflect the necessary requests: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> AppMessages = |<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student |Edit <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student |Remove <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student seq |Save |AddRequest |EditRequest <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Student</code> </pre> <br><p>  then rewrite the <code>AppViewModel</code> type so that the next part is responsible for adding and editing in the component </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">@</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">appvd.Edit</span></span></span><span class="hljs-tag"> @&gt;</span></span> |&gt; Bind.cmdParam EditRequest <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">@</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">appvd.Add</span></span></span><span class="hljs-tag"> @&gt;</span></span> |&gt; Bind.cmd</code> </pre> <br><p>  Next, before the <code>update</code> function, we create a dispatcher. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> disp = <span class="hljs-type"><span class="hljs-type">Dispatcher</span></span>&lt;<span class="hljs-type"><span class="hljs-type">CollectionNav</span></span>&gt;()</code> </pre> <br><p>  and using it in the function we send requests when receiving messages </p><br><pre> <code class="hljs matlab">|AddRequest -&gt; AddStudent |&gt; <span class="hljs-built_in"><span class="hljs-built_in">disp</span></span>.Dispatch model |EditRequest st -&gt; EditStudent st |&gt; <span class="hljs-built_in"><span class="hljs-built_in">disp</span></span>.Dispatch model</code> </pre> <br><p>  To connect the dispatcher (in this case responsible for managing the navigation), we use the <code>Framework.withNavigation</code> function </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> app = <span class="hljs-type"><span class="hljs-type">Framework</span></span>.application model update appComponent nav.<span class="hljs-type"><span class="hljs-type">Navigate</span></span> |&gt; <span class="hljs-type"><span class="hljs-type">Framework</span></span>.withNavigation disp</code> </pre> <br><p>  Yes, in this case the code takes up more space, but the component turns out to be ‚Äúclean‚Äù. </p><br><p>  Now we turn to <code>studentComponent</code> , which we will not give here in full, leaving only the main parts </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> StudentUpdate = |FirstName <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> string |LastName <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> string |Age <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> |Gender <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Gender let studentBind _ source model = let mstudent = model |&gt; Signal.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> |&gt; Mutable.<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> [Female; Male] |&gt; Signal.<span class="hljs-keyword"><span class="hljs-keyword">constant</span></span> |&gt; Bind.Explicit.oneWay source "Genders" let first = mstudent |&gt; Signal.map (fun student -&gt; student.FirstName) |&gt; Bind.Explicit.twoWayValidated source "FirstName" (Validators.notNullOrWhitespace &gt;&gt; Validators.noSpaces) |&gt; Observable.toMessage FirstName //    let upd msg = match msg <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> | FirstName <span class="hljs-type"><span class="hljs-type">name</span></span> -&gt; Mutable.step (editFirstName <span class="hljs-type"><span class="hljs-type">name</span></span>) mstudent | LastName <span class="hljs-type"><span class="hljs-type">name</span></span> -&gt; Mutable.step (editLastName <span class="hljs-type"><span class="hljs-type">name</span></span>) mstudent | Age age -&gt; Mutable.step (editAge age) mstudent | Gender gender -&gt; Mutable.step (editGender gender) mstudent [last; age; gender] |&gt; List.fold Observable.merge first |&gt; Observable.subscribe upd |&gt; source.AddDisposable [ Bind.Explicit.createCommandChecked "SaveCommand" source.<span class="hljs-keyword"><span class="hljs-keyword">Valid</span></span> source |&gt; Observable.map(fun _ -&gt; mstudent.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>) ] let studentComponent : IComponent&lt;_,CollectionNav,_&gt; = Component.fromExplicit studentBind</code> </pre> <br><p>  Here, when linking data, validation is also carried out (validation) using the features of the <code>Gjallarhorn</code> library. </p><br><p>  To track the state of validity of parameters, the <code>source.Valid</code> signal <code>source.Valid</code> . </p><br><p>  The <code>Validators</code> module contains several support functions that can be easily combined with each other. </p><br><p>  For example, we want the name field not to be an empty string or not to contain whitespace. <br>  For this, both functions are simply compatible. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Validators</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.notNullOrWhitespace</span></span> &gt;&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Validators</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.noSpaces</span></span></code> </pre> <br><p>  If standard functions are not enough, you can always write your own and add it to the chain of checks. <br>  How to do this, as well as other details about validating data with <code>Gjallarhorn</code> can be found in the <a href="http://reedcopsey.github.io/Gjallarhorn/validation.html">documentation</a> . </p><br><p>  The function <code>Validators.noValidation</code> useful in cases where no checks are needed. </p><br><p>  As a result, the dialog box for adding a student will look like this: </p><br><p><img src="https://habrastorage.org/webt/e6/yw/gj/e6ywgjuacwhnnfbvw4c1k9lrijq.jpeg"></p><br><p>  Shown approach </p><br><pre> <code class="hljs kotlin">mstudent |&gt; Signal.map (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> student -&gt; student.FirstName) |&gt; Bind.Explicit.twoWayValidated source "FirstName" </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Validators.notNullOrWhitespace &gt;&gt; Validators.noSpaces)</span></span></span></span></code> </pre> <br><p>  probably someone seems too verbose.    ‚Äî   <code>Bind.Explicit.memberToFromView</code> ,        . </p><br><p>      ,     : </p><br><ul><li>     </li><li>        </li><li>         </li><li>  ... </li></ul><br><p>      ,     .      F# ;) </p><br><p>    <a href="https://github.com/FoggyFinder/StudentsWpfTestTask"></a> . </p><br><p>       F# ,      (  ).         F# Slack (       F# Software Foundation) </p><br><p>   <a href="https://stackoverflow.com/users/65358/reed-copsey">Reed Copsey</a>       (           F#),       API           . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f95/c6d/92c/f95c6d92c5b1126b093792a43955aa43.png" width="100" height="100" align="left"> , ,             F#       . </p><br><p>  See you again! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350538/">https://habr.com/ru/post/350538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350524/index.html">Results of MentorHack: chat bot for selecting conversations from dialogues, services for building career paths and teams</a></li>
<li><a href="../350526/index.html">WhiteList vs BlackList: how to implement file extension checks and not become a victim of hackers</a></li>
<li><a href="../350528/index.html">How we did the Olympiad in SQL (end)</a></li>
<li><a href="../350530/index.html">Tibero and Oracle compatibility issues. Part 1. Conditional PL / SQL Compilation</a></li>
<li><a href="../350536/index.html">Elegant Patterns of Modern JavaScript: RORO</a></li>
<li><a href="../350540/index.html">Detective story about RMCP + and OpenSSL, or how Wireshark helped defeat an incorrect argument in OpenIPMI</a></li>
<li><a href="../350542/index.html">Prospects for the development of the video surveillance industry: the capabilities of modern video analytics systems</a></li>
<li><a href="../350544/index.html">Learned helplessness in software development</a></li>
<li><a href="../350546/index.html">FastTrack Training. "Network Basics". "Products in the field of wireless local networks." Eddie Martin December 2012</a></li>
<li><a href="../350550/index.html">Straight DNS: doing the right thing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>