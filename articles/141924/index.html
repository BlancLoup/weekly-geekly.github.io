<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Looking for music on z-music.org with bash</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is clear that the ‚Äúvictim‚Äù of today's experiment will be  z-music.org  z-music.org . On this site you can find a song, listen and download it. 
 Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Looking for music on z-music.org with bash</h1><div class="post__text post__text-html js-mediator-article"> It is clear that the ‚Äúvictim‚Äù of today's experiment will be <code><a href="http://z-music.org/"></a> z-music.org</code>  <code><a href="http://z-music.org/"></a> z-music.org</code> .  On this site you can find a song, listen and download it. <br>  The goal is to write a <code>bash</code> script to search for music using the ‚Äúgentleman's set‚Äù of <code>sed</code> , <code>awk</code> and <code>grep</code> .  Well, plus a little curl or wget to taste. <br><a name="habracut"></a><br>  Having studied z-music.org a <code>z-music.org</code> , it becomes clear that: <br><ol><li>  The search is located at <code>z-music.org/search/</code> .  As a GET parameter, you can pass the query text <code>q</code> , the type of the query (AJAX) <code>action</code> and the page number of the search result <code>page</code> </li><li>  You can learn the bitrate of a song by sending a POST request to <code>z-music.org/bitrate/</code> with the data <code>"id=&lt;SONG_ID&gt;"</code> </li><li>  Direct link to download the song looks like <code>m1.z-music.org/t/&lt;SONG_ID&gt;_&lt;HASH&gt;</code> .  <code>&lt;HASH&gt;</code> found in the script at <code>z-music.org/theme/new/js/lang.js</code> </li></ol><br>  You can start writing a script.  For server requests, I will use <code>curl</code> , but nothing prevents you from using <code>wget</code> .  Instead of <code>curl -s</code> will be <code>wget -q -O -</code> , and instead of <code>curl -F</code> will be <code>wget --post-data</code> <br><br>  To begin with, write <code>&lt;HASH&gt;</code> in the <code>hsh</code> variable: <br><pre> <code class="bash hljs">hsh=$(curl -s http://z-music.org/theme/new/js/lang.js | sed -n <span class="hljs-string"><span class="hljs-string">'s/^var hsh="\([^"]*\)";$/\1/p'</span></span>)</code> </pre><br>  The variables <code>$query</code> and <code>$page</code> will contain the query text and the page number of the result.  Send a request to the server: <br><pre> <code class="bash hljs">curl -s <span class="hljs-string"><span class="hljs-string">"http://z-music.org/search/?page=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$page</span></span></span><span class="hljs-string">&amp;action=ajax&amp;q=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$query</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  We get a piece of HTML.  Information about the song is located in lines like <code>&lt;a class="info" data-aid="SONG_ID"...&gt;SONG_NAME&lt;/a&gt;</code> .  Get <code>&lt;SONG_ID&gt;</code> and <code>&lt;SONG_NAME&gt;</code> separated by tabs: <br><pre> <code class="bash hljs">sed -n <span class="hljs-string"><span class="hljs-string">'s/^\s*&lt;a class="info" data-aid="\([^"]*\)"[^&gt;]*&gt;\([^&lt;]*\)&lt;\/a&gt;\s*$/\1\t\2/p'</span></span></code> </pre><br>  Knowing <code>&lt;SONG_ID&gt;</code> you can send a request to bitrate.  JSON will be returned.  In order to pull out the very value of bitrate, use the <code>cut</code> utility.  For a change. <br><pre> <code class="bash hljs">curl -sF <span class="hljs-string"><span class="hljs-string">"id=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$songid</span></span></span><span class="hljs-string">"</span></span> http://z-music.org/bitrate/ | cut -d<span class="hljs-string"><span class="hljs-string">'"'</span></span> -f8</code> </pre><br>  The link to download the song is as follows: <code>m1.z-music.org/t/${songid}_${hsh}/</code> <br>  It remains to combine all this in one script.  Let it be ‚Äúpage by page‚Äù to search for songs and display information only about those whose bitrate is the same as the specified one. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash case $# in 1) query=$1 bitrate=320 ;; 2) query=$1 bitrate=$2 ;; *) echo -e 'Usage:\n\tzmusic "song name"\nor:\n\tzmusic "song name" 256\nwhere 256 is bitrate' exit ;; esac hsh=$(curl -s http://z-music.org/theme/new/js/lang.js | sed -n 's/^var hsh="\([^"]*\)";$/\1/p') # infinite loop incrementing search page for (( page=1; page&gt;0; page++ )) do result=$( \ curl -s "http://z-music.org/search/?page=$page&amp;action=ajax&amp;q=$query" | \ sed -n 's/^\s*&lt;a class="info" data-aid="\([^"]*\)"[^&gt;]*&gt;\([^&lt;]*\)&lt;\/a&gt;\s*$/\1\t\2/p' | \ awk -v hsh=$hsh -F"\t" ' \ { \ system("curl -sF \"id=" $1 "\" http://z-music.org/bitrate/ | cut -d\"\\\"\" -f8"); \ print "http://m1.z-music.org/t/" $1 "_" hsh "/"; \ print $2 "\n"; \ }') # stop the script if nothing found on this page if [ -z "$result" ]; then exit; fi # output songs with $bitrate only while read -r res; do echo -e $res; done &lt;&lt;&lt; "$result" | grep -A2 "$bitrate" echo -e "-- end of page $page --\n" done</span></span></code> </pre><br>  We try to find something about habrakhabr: <br><pre> $ zmusic "Habr" "256 \ | 320"
 320
 http://m1.z-music.org/t/-3ev4fnuc23h_2b49895762/
 Habr - Addict song
 -
 320
 http://m1.z-music.org/t/-3ev4fnubytf_2b49895762/
 HaBr - Nedomassaraksh
 -
 320
 http://m1.z-music.org/t/-3ev4fnuc1d3_2b49895762/
 HaBr - Travel [Hedgehogs and Petruccio cover]
 -
 320
 http://m1.z-music.org/t/-3ev4fntmcfl_2b49895762/
 Habr - Do not take the elevator (new single)
 - end of page 1 -

</pre></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/141924/">https://habr.com/ru/post/141924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141918/index.html">Do you believe in the botnet that Doctor Web found?</a></li>
<li><a href="../141920/index.html">CSS Variables</a></li>
<li><a href="../141921/index.html">Konversbank website was attacked</a></li>
<li><a href="../141922/index.html">The art of public speaking</a></li>
<li><a href="../141923/index.html">Programmer from Germany condemned for 3 years and 10 months</a></li>
<li><a href="../141926/index.html">Yota: The first test launches of the new LTE in Moscow</a></li>
<li><a href="../141927/index.html">BrandMaker - among the leaders in the field of MRM rated Gartner</a></li>
<li><a href="../141929/index.html">New "Center for beginners" on TechNet!</a></li>
<li><a href="../141930/index.html">Tags vs folders: a side view</a></li>
<li><a href="../141931/index.html">PayPal intends to create its own non-bank credit organization in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>