<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Repository Pattern via CSLA .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating low-coupling systems (Low Coupling) between modules provides many advantages when developing software. In applications written using the CSLA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Repository Pattern via CSLA .NET</h1><div class="post__text post__text-html js-mediator-article">  Creating low-coupling systems (Low Coupling) between modules provides many advantages when developing software.  In applications written using the <a href="http://cslanet.com/">CSLA .NET framework</a> , the use of standard templates for breaking dependencies may not always be obvious. <br><br>  This article will look at the option of separating the data access layer (Data Access Layer, DAL) from the Business Logic layer (Business Layer) using <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx">the Repository template</a> and describe the most common way to integrate dependencies (Depency Injection) into CSLA .NET business objects.  Used by CSLA version 4.1. <br><a name="habracut"></a><br><h2>  Example </h2><br>  So let us have the root business object Person.  This business object has several simple properties from the subject area, a child collection of Order objects, and a child Address object: <br><br><pre><code class="hljs pgsql">//Person.cs [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person : BusinessBase&lt;Person&gt; { private Person( ) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Person NewPerson( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>&lt;Person&gt;( ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Person GetPerson( <span class="hljs-type"><span class="hljs-type">int</span></span> personId ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.<span class="hljs-keyword"><span class="hljs-keyword">Fetch</span></span>&lt;Person&gt;( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( personId ) ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> RemovePerson( <span class="hljs-type"><span class="hljs-type">int</span></span> personId ) { DataPortal.<span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span>&lt;Person&gt;( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( personId ) ); } private static readonly PropertyInfo&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; IdProperty = RegisterProperty&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( c =&gt; c.Id ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( IdProperty ); } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( IdProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; FirstNameProperty = RegisterProperty&lt;string&gt;( c =&gt; c.FirstName ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( FirstNameProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( FirstNameProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; SecondNameProperty = RegisterProperty&lt;string&gt;( c =&gt; c.SecondName ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string SecondName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( SecondNameProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( SecondNameProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; AgeProperty = RegisterProperty&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( c =&gt; c.Age ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( AgeProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( AgeProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; CommentProperty = RegisterProperty&lt;string&gt;( c =&gt; c.<span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( CommentProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( CommentProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;Orders&gt; OrdersProperty = RegisterProperty&lt;Orders&gt;( c =&gt; c.Orders, RelationshipTypes.Child | RelationshipTypes.LazyLoad ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Orders Orders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !FieldManager.FieldExists( OrdersProperty ) ) { Orders = Orders.NewOrders( ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( OrdersProperty ); } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( OrdersProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); OnPropertyChanged( OrdersProperty ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;Address&gt; AddressProperty = RegisterProperty&lt;Address&gt;( c =&gt; c.Address, RelationshipTypes.Child | RelationshipTypes.LazyLoad); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Address Address { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !FieldManager.FieldExists( AddressProperty ) ) { Address = Address.NewAddress( ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( AddressProperty ); } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( AddressProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); OnPropertyChanged( AddressProperty ); } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Child Class Code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//Orders.cs [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Orders : BusinessListBase&lt;Orders, <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt; { private Orders( ) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Orders NewOrders( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.CreateChild&lt;Orders&gt;( ); } } //<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>.cs [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> : BusinessBase&lt;<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt; { private <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>( ) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> NewOrder( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.CreateChild&lt;<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt;( ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; IdProperty = RegisterProperty&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( c =&gt; c.Id ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( IdProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( IdProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; DescriptionProperty = RegisterProperty&lt;string&gt;( c =&gt; c.Description ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( DescriptionProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( DescriptionProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } } //Address.cs [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Address : BusinessBase&lt;Address&gt; { private Address( ) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Address NewAddress( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.CreateChild&lt;Address&gt;( ); } private static readonly PropertyInfo&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; IdProperty = RegisterProperty&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;( c =&gt; c.Id ); private <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( IdProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( IdProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; FirstAddressProperty = RegisterProperty&lt;string&gt;( c =&gt; c.FirstAddress ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string FirstAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( FirstAddressProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( FirstAddressProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;string&gt; SecondAddressProperty = RegisterProperty&lt;string&gt;( c =&gt; c.SecondAddress ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string SecondAddress { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetProperty( SecondAddressProperty ); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetProperty( SecondAddressProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } }</code> </pre><br></div></div><br>  The resulting class diagram is shown in the figure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/10d/cd7/528/10dcd75289e244f5b4d7a08a560c4e5d.png"><br><br>  Note that business classes are marked with the partial modifier, and the entire data access code has been moved to other parts of the classes to improve readability.  Let's now look at the DAL access code. <br><br><h2>  Standard interaction with DAL </h2><br>  First we turn to the code related to the creation of the Person object.  As you can see, the class has a single constructor without parameters.  The creation and retrieval of an object is answered by factory methods that access the CSLA client data portal.  The data client portal, in turn, accesses the server data portal.  The latter refers, through reflection, to the private methods of the DataPortal_Create or DataPortal_Fetch of the Person class - to create or retrieve an object, respectively: <br><br><img src="https://habrastorage.org/files/47d/9a1/6ef/47d9a16effea44b99a9443855a4088d8.png"><br><img src="https://habrastorage.org/files/6d7/b67/237/6d7b67237d094518ab69d7d6c1073c0c.png"><br><br>  The same scheme is used for inserting, updating, and deleting the Person object, but the DataPortal_Insert, DataPortal_Update and DataPortal_DeleteSelf methods are used, respectively: <br><br><img src="https://habrastorage.org/files/688/b8d/66b/688b8d66baf94201be61c64e64ba6df6.png"><br><br>  Remember that the Save method (CSLA infrastructure method) actually returns a new business object created on the server data portal, which is why you should update all references to the saved object in the client code (the concept of the so-called mobile business objects, Mobile Object Pattern): <br><br><img src="https://habrastorage.org/files/34d/51e/4b9/34d51e4b91b2469eb631029881591f17.png"><br><br>  Finally, for the force removal, the DataPortal_Delete method is used: <br><br><img src="https://habrastorage.org/files/006/ca4/4ce/006ca44ceaba493fa9320e2ed96f02ca.png"><br><br>  Thus, the DataPortal_XYZ methods contain all the data access logic ‚Äî not only for creating and extracting data, but also for updating and deleting a Person object in the DAL.  In these methods, we see specific logic that is commonly used to access data: SQL query code, connect to a database, create transactions to update child objects, etc. <br><br><pre> <code class="hljs pgsql">//Person.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; LastChangedProperty = RegisterProperty&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;( c =&gt; c.LastChanged ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> LastChanged { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReadProperty( LastChangedProperty ); } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( LastChangedProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Create( ) { BusinessRules.CheckRules( ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Fetch( SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt; idCriteria ) { const string query = @"SELECT id ,first_name ,second_name ,age ,comment ,last_changed ,address_id ,first_address ,second_address FROM All_persons WHERE id = :p_id"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.Text; command.CommandText = query; command.Parameters.AddWithValue( "p_id", idCriteria.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SafeDataReader( command.ExecuteReader( CommandBehavior.SingleRow ) ) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( reader.<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>( ) ) { FetchFromReader( reader ); } } } LoadProperty( OrdersProperty, Orders.GetOrders( this ) ); } } private <span class="hljs-type"><span class="hljs-type">void</span></span> FetchFromReader( SafeDataReader reader ) { LoadProperty( FirstNameProperty, reader.GetString( "first_name" ) ); LoadProperty( SecondNameProperty, reader.GetString( "second_name" ) ); LoadProperty( CommentProperty, reader.GetString( "comment" ) ); LoadProperty( AddressProperty, Address.GetAddress( reader ) ); Id = reader.GetInt32( "Id" ); LastChanged = reader[ "last_changed" ]; } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Insert( ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.BeginTransaction( ) ) { try { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.add_person"; var personParameters = GetPersonParameters( ); command.Parameters.AddRange( personParameters ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); Id = ( <span class="hljs-type"><span class="hljs-type">int</span></span> )command.Parameters[ "p_id" ].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; LastChanged = command.Parameters[ "p_last_changed" ]; } FieldManager.UpdateChildren( this, <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } catch { <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); throw; } } } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Update( ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.BeginTransaction( ) ) { try { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.add_person"; var personParameters = GetPersonParameters( ); command.Parameters.AddRange( personParameters ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); LastChanged = command.Parameters[ "p_last_changed" ]; } FieldManager.UpdateChildren( this, <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } catch { <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); throw; } } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Delete( SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt; idCriteria ) { DoDelete( idCriteria.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ); } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_DeleteSelf( ) { DoDelete( Id ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> DoDelete( <span class="hljs-type"><span class="hljs-type">int</span></span> personId ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.BeginTransaction( ) ) { try { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.delete_person"; command.Parameters.AddWithValue( "p_id", personId ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); } <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } catch { <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); throw; } } } } private OracleParameter[] GetPersonParameters( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>[] { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_id", Id ) {Direction = ParameterDirection.InputOutput}, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_first_name", FirstName ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_second_name", SecondName ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_age", Age ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_comment", <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_last_changed", OracleType.Int32 ) {Direction = ParameterDirection.Output} }; } }</code> </pre><br>  The DAL access code for child objects of Person is the same, except that when updating child objects, Person sends a link to the data portal to itself and an ADO .NET transaction instance, so the corresponding DataPortal_XYZ methods of the child objects contain additional arguments. <br><br><div class="spoiler">  <b class="spoiler_title">Child class code:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//Orders.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Orders { <span class="hljs-type"><span class="hljs-type">internal</span></span> static Orders GetOrders( Person person ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.FetchChild&lt;Orders&gt;( person ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Fetch( Person person ) { const string query = @"SELECT id ,description FROM All_orders WHERE person_id = :p_person_id"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.Text; command.CommandText = query; command.Parameters.AddWithValue( "p_person_id", person.Id ); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SafeDataReader( command.ExecuteReader( CommandBehavior.SingleRow ) ) ) { RaiseListChangedEvents = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( reader.<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>( ) ) { <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>.GetOrder( reader ) ); } RaiseListChangedEvents = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Update( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { base.Child_Update( person, <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ); } }</code> </pre><br><br><pre> <code class="hljs pgsql">//<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> { <span class="hljs-type"><span class="hljs-type">internal</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span> GetOrder( SafeDataReader reader ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.FetchChild&lt;<span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt;( reader ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Fetch( SafeDataReader reader ) { LoadProperty( IdProperty, reader.GetInt32( "id" ) ); LoadProperty( DescriptionProperty, reader.GetString( "description" ) ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Insert( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.add_order"; command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.Parameters.AddRange( GetParameters( ) ); command.Parameters.AddWithValue( "person_id", person.Id ); command.ExecuteNonQuery( ); Id = ( <span class="hljs-type"><span class="hljs-type">int</span></span> )command.Parameters[ "p_id" ].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Update( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.edit_order"; command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.Parameters.AddRange( GetParameters( ) ); command.Parameters.AddWithValue( "person_id", person.Id ); command.ExecuteNonQuery( ); } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_DeleteSelf( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.remove_order"; command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.Parameters.AddWithValue( "p_person_id", person.Id ); command.Parameters.AddWithValue( "p_order_id", Id ); command.ExecuteNonQuery( ); } } } private OracleParameter[] GetParameters( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>[] { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_id", Id ) {Direction = ParameterDirection.InputOutput}, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_description", Description ) }; } }</code> </pre><br><br><pre> <code class="hljs pgsql">//Address.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Address { <span class="hljs-type"><span class="hljs-type">internal</span></span> static Address GetAddress( SafeDataReader reader ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.<span class="hljs-keyword"><span class="hljs-keyword">Fetch</span></span>&lt;Address&gt;( reader ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Fetch( SafeDataReader reader ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( BypassPropertyChecks ) { LoadProperty( IdProperty, reader.GetInt32( "address_id" ) ); LoadProperty( FirstAddressProperty, reader.GetString( "first_address" ) ); LoadProperty( SecondAddressProperty, reader.GetString( "second_address" ) ); } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Insert( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.add_address"; command.Parameters.AddRange( GetParameters( ) ); command.Parameters.AddWithValue( "p_person_id", person.Id ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); Id = ( <span class="hljs-type"><span class="hljs-type">int</span></span> )command.Parameters[ "p_id" ].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Update( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.edit_address"; command.Parameters.AddRange( GetParameters( ) ); command.Parameters.AddWithValue( "p_person_id", person.Id ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); } } } private <span class="hljs-type"><span class="hljs-type">void</span></span> Child_DeleteSelf( Person person, OracleTransaction <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( "CSLAPROJECT" ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = "csla_project.remove_address"; command.Parameters.AddWithValue( "p_address_id", Id ); command.Parameters.AddWithValue( "p_person_id", person.Id ); command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; command.ExecuteNonQuery( ); } } } private OracleParameter[] GetParameters( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>[] { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_id", Id ) {Direction = ParameterDirection.InputOutput}, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_first_address", FirstAddress ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_second_address", SecondAddress ) }; } }</code> </pre><br></div></div><br><h2>  Repository pattern </h2><br>  So far we have seen the standard implementation of CSLA business objects, which can often be seen in the code of many legacy programs developed using CSLA .NET.  As can be seen from the code, the data access layer and the business logic layer are closely related to each other.  If we abstract from the data access layer, then we will get rid of the low-level details in the business logic and the specific dependencies that they have.  This will simplify the unit testing of our business objects and allow us to change the data access logic regardless of the logic of the business level.  Therefore, the task of creating an additional level of indirection between business logic and the data access layer arises.  For example, you can use the famous <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx">template Repository</a> .  Create an interface with the necessary methods: <br><br><pre> <code class="hljs pgsql">//IPersonRepository.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> interface IPersonRepository { PersonData FindPerson( <span class="hljs-type"><span class="hljs-type">int</span></span> id ); <span class="hljs-type"><span class="hljs-type">void</span></span> AddPerson( PersonData newPerson, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> newId, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged ); <span class="hljs-type"><span class="hljs-type">void</span></span> EditPerson( PersonData existingPerson, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged ); <span class="hljs-type"><span class="hljs-type">void</span></span> RemovePerson( <span class="hljs-type"><span class="hljs-type">int</span></span> personId ); }</code> </pre><br>  The PersonData class is a simple data transfer object (DTO, Data Transfer Object): <br><br><pre> <code class="hljs pgsql">//PersonData.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> sealed <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PersonData { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string SecondName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> LastChanged { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  To abstract from transactional ADO .NET code, create simple IContext and ITransaction interfaces: <br><br><pre> <code class="hljs pgsql">//IContext.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> interface IContext { ITransaction BeginTransaction( ); } //ITransaction.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> interface ITransaction : IDisposable { <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); }</code> </pre><br>  Now I would like the methods of the interfaces defined above to be used in the DataPortal_XYZ methods of the Person class instead of the specific DAL code.  The challenge is to inject dependencies into the Person business object.  The classic way is to push dependencies through the Person constructor because of the limitations of the CSLA (using factory methods), so consider other possible ways to solve this problem. <br><br><h2>  Setter method injection </h2><br>  Add a private field of type IPersonRepository to the Person class: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">NonSerialized</span></span>] [NotUndoable] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IPersonRepository _personRepository;</code> </pre><br>  Note the use of attributes [NonSerialized] [NotUndoable] - the IPersonRepository dependency should not be serialized when moving a Person object from one physical node to another (Mobile Object Pattern) and participate in a multi-level CSLA (N-Level Undo) cancellation. <br><br>  Next, add the repository configuration method: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">Inject</span></span>] <span class="hljs-comment"><span class="hljs-comment">//   DI- Ninject private void Configure( IPersonRepository personRepository ) { _personRepository = personRepository; }</span></span></code> </pre><br>  Instead of the configuration method, you can use the PersonRepository property (the so-called Property Setter Injection): <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">Inject</span></span>] [EditorBrowsable( EditorBrowsableState.Never )] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IPersonRepository PersonRepository { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _personRepository; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _personRepository = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  Note that in our case, the PersonRepository property will be used only on the server side of the data portal, so you can hide it from Intellisence using the EditorBrowsable attribute. <br><br>  In general, you can embed dependencies into a business object already created by the CSLA infrastructure using the following anchors of the BusinessBase abstract class: <br><br>  DataPortal_OnDataPortalInvoke, Child_OnDataPortalInvoke and OnDeserialized.  The first two methods are called by the server side of the data portal before calling the DataPortal_XXX methods of the business object.  The first method is if the business object is the root, the second is if the child.  The third method is called after the mobile object is deserialized on the server or client.  As part of the Repository template, it is not necessary to override it (dependencies are used only on the server), but it is necessary for the general case of dependency injection in the CSLA business objects. <br><br>  Thus, we can write the Inject method, which will be called in all three methods and inject dependencies into the business object created by the CSLA.  Based on the foregoing, we will write a new stereotype InjectableBusinessBase, which will serve as a substitute for the standard stereotype of BusinessBase: <br><br><pre> <code class="hljs pgsql">//InjectableBusinessBase.cs [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> abstract <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> InjectableBusinessBase&lt;T&gt; : BusinessBase&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : BusinessBase&lt;T&gt; { protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_OnDataPortalInvoke( DataPortalEventArgs e ) { Inject( ); base.DataPortal_OnDataPortalInvoke( e ); } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> Child_OnDataPortalInvoke( DataPortalEventArgs e ) { Inject( ); base.Child_OnDataPortalInvoke( e ); } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> OnDeserialized( <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Runtime.Serialization.StreamingContext context ) { Inject( ); base.OnDeserialized( context ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Inject( ) { //         . } }</code> </pre><br>  Note that for each stereotype of the CSLA business objects, a new stereotype with redefined anchors must be created.  The code of new stereotypes will be similar to the code above.  Now, business classes with dependencies should inherit new stereotypes: <br><br><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person : InjectableBusinessBase&lt;Person&gt; { //‚Ä¶ } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Orders : InjectableBusinessListBase&lt;Orders, <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>&gt; { //‚Ä¶ } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Address : InjectableBusinessBase&lt;Address&gt; { //‚Ä¶ }</code> </pre><br>  To implement the Inject method, add the following front DI container class (using <a href="http://www.ninject.org/">Ninject</a> ): <br><br><pre> <code class="hljs pgsql">//Container.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Container { private static readonly <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> SyncRoot = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>( ); private static <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> IKernel _kernel; //   DI-  Ninject <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static IKernel Kernel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _kernel == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> ( SyncRoot ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _kernel == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { ConfigureKernel( ); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _kernel; } } //      . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> InjectInto( <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> target ) { Kernel.Inject( target ); } private static <span class="hljs-type"><span class="hljs-type">void</span></span> ConfigureKernel( ) { //   } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> InjectKernel( IKernel kernel ) { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> ( SyncRoot ) { _kernel = kernel; } } }</code> </pre><br>  We do not care how to configure the DI container itself right now, but only the InjectInto method is important.  Now you can return to the Inject () method of the InjectableBusinessBase stereotype: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { Container.InjectInto( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ); }</code> </pre><br>  Finally, add the IPersonRepository and IContext properties to the server part of the Person class and rewrite the DataPortal_XYZ methods as follows: <br><br><pre> <code class="hljs pgsql">//Person.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Person { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static readonly PropertyInfo&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; LastChangedProperty = RegisterProperty&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;( c =&gt; c.LastChanged ); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> LastChanged { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReadProperty( LastChangedProperty ); } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { LoadProperty( LastChangedProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> ); } } [NonSerialized] [NotUndoable] private IPersonRepository _personRepository; [Inject] [EditorBrowsable( EditorBrowsableState.Never )] private IPersonRepository PersonRepository { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _personRepository; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _personRepository = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } [NonSerialized][NotUndoable] private IContext _context; [Inject] [EditorBrowsable(EditorBrowsableState.Never)] private IContext Context { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _context; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _context = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Create( ) { BusinessRules.CheckRules( ); } private <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Fetch( SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt; idCriteria ) { var personData = PersonRepository.FindPerson( idCriteria.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( personData != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { CopyValuesFrom( personData ); LoadProperty( OrdersProperty, Orders.GetOrders( personData ) ); LoadProperty( AddressProperty, Address.GetAddress( personData ) ); } } private <span class="hljs-type"><span class="hljs-type">void</span></span> CopyValuesFrom( PersonData personData ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( BypassPropertyChecks ) { DataMapper.Map( personData, this ); } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Insert( ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> = Context.BeginTransaction( ) ) { try { var personData = GetPersonData( ); <span class="hljs-type"><span class="hljs-type">int</span></span> newId; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged; PersonRepository.AddPerson( personData, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> newId, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> lastChanged ); Id = newId; LastChanged = lastChanged; FieldManager.UpdateChildren( personData); <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } catch { <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); throw; } } } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Update( ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> = Context.BeginTransaction( ) ) { try { var personData = GetPersonData( ); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged; PersonRepository.EditPerson( personData, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> lastChanged ); LastChanged = lastChanged; FieldManager.UpdateChildren( personData ); <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } catch { <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ); throw; } } } private PersonData GetPersonData( ) { //  ,        //- Person  DTO PersonData ,    // CSLA DataMapper    DTO,     . var personData = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PersonData( ); DataMapper.Map( this, personData, OrdersProperty.Name, AddressProperty.Name ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> personData; } private <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_Delete( SingleCriteria&lt;Person, <span class="hljs-type"><span class="hljs-type">int</span></span>&gt; idCriteria ) { PersonRepository.RemovePerson( idCriteria.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ); } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DataPortal_DeleteSelf( ) { PersonRepository.RemovePerson( Id ); } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Child class code:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//Orders.<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Orders { [NonSerialized] [NotUndoable] private IOrderRepository _orderRepository; [Inject] [EditorBrowsable( EditorBrowsableState.Never )] protected IOrderRepository OrderRepository { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _orderRepository; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _orderRepository = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-type"><span class="hljs-type">internal</span></span> static Address GetAddress( Person person ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DataPortal.FetchChild&lt;Address&gt;( person ); } protected <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Fetch( PersonData person) { var data = OrderRepository.FindOrders( person.Id ); RaiseListChangedEvents = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; AddRange( data.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">Order</span></span>.GetOrder ) ); RaiseListChangedEvents = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } protected <span class="hljs-type"><span class="hljs-type">void</span></span> Child_Update( PersonData person ) { base.Child_Update( person, OrderRepository ); } }</code> </pre><br><pre> <code class="hljs haskell">//<span class="hljs-type"><span class="hljs-type">Order</span></span>.<span class="hljs-type"><span class="hljs-type">Server</span></span>.cs public partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-type"><span class="hljs-type">Order</span></span> { internal static <span class="hljs-type"><span class="hljs-type">Order</span></span> <span class="hljs-type"><span class="hljs-type">GetOrder</span></span>( <span class="hljs-type"><span class="hljs-type">OrderData</span></span> orderData ) { return <span class="hljs-type"><span class="hljs-type">DataPortal</span></span>.<span class="hljs-type"><span class="hljs-type">FetchChild</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Order</span></span>&gt;( orderData ); } protected void <span class="hljs-type"><span class="hljs-type">Child_Fetch</span></span>( <span class="hljs-type"><span class="hljs-type">OrderData</span></span> orderData ) { using ( <span class="hljs-type"><span class="hljs-type">BypassPropertyChecks</span></span> ) { <span class="hljs-type"><span class="hljs-type">DataMapper</span></span>.<span class="hljs-type"><span class="hljs-type">Map</span></span>( orderData, this ); } } protected void <span class="hljs-type"><span class="hljs-type">Child_Insert</span></span>( <span class="hljs-type"><span class="hljs-type">PersonData</span></span> person, <span class="hljs-type"><span class="hljs-type">IOrderRepository</span></span> orderRepository ) { var <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetOrderData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> = orderRepository.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddOrder</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> ); } protected void </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Child_Update</span></span></span><span class="hljs-class">( </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PersonData</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IOrderRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderRepository</span></span></span><span class="hljs-class"> ) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetOrderData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderRepository</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EditOrder</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> ); } protected void </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Child_DeleteSelf</span></span></span><span class="hljs-class">( </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PersonData</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IOrderRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderRepository</span></span></span><span class="hljs-class"> ) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderRepository</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RemoveOrder</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> ); } private </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OrderData</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetOrderData</span></span></span><span class="hljs-class">( ) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderData</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OrderData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataMapper</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Map</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderData</span></span></span><span class="hljs-class"> ); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orderData</span></span></span><span class="hljs-class">; } }</span></span></code> </pre><br><br><pre> <code class="hljs haskell">//<span class="hljs-type"><span class="hljs-type">Address</span></span>.<span class="hljs-type"><span class="hljs-type">Server</span></span>.cs public partial <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-type"><span class="hljs-type">Address</span></span> { [<span class="hljs-type"><span class="hljs-type">NonSerialized</span></span>, <span class="hljs-type"><span class="hljs-type">NotUndoable</span></span>] private <span class="hljs-type"><span class="hljs-type">IAddressRepository</span></span> _addressRepository; [<span class="hljs-type"><span class="hljs-type">Inject</span></span>] [<span class="hljs-type"><span class="hljs-type">EditorBrowsable</span></span>( <span class="hljs-type"><span class="hljs-type">EditorBrowsableState</span></span>.<span class="hljs-type"><span class="hljs-type">Never</span></span> )] protected <span class="hljs-type"><span class="hljs-type">IAddressRepository</span></span> <span class="hljs-type"><span class="hljs-type">AddressRepository</span></span> { get { return _addressRepository; } set { _addressRepository = value; } } internal static <span class="hljs-type"><span class="hljs-type">Address</span></span> <span class="hljs-type"><span class="hljs-type">GetAddress</span></span>( <span class="hljs-type"><span class="hljs-type">PersonData</span></span> person ) { return <span class="hljs-type"><span class="hljs-type">DataPortal</span></span>.<span class="hljs-type"><span class="hljs-type">FetchChild</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Address</span></span>&gt;( person ); } protected void <span class="hljs-type"><span class="hljs-type">Child_Fetch</span></span>( <span class="hljs-type"><span class="hljs-type">PersonData</span></span> personData ) { using ( <span class="hljs-type"><span class="hljs-type">BypassPropertyChecks</span></span> ) { var addressData = <span class="hljs-type"><span class="hljs-type">AddressRepository</span></span>.<span class="hljs-type"><span class="hljs-type">FindAddress</span></span>( personData.<span class="hljs-type"><span class="hljs-type">Id</span></span> ); <span class="hljs-type"><span class="hljs-type">DataMapper</span></span>.<span class="hljs-type"><span class="hljs-type">Map</span></span>( addressData, this ); } } protected void <span class="hljs-type"><span class="hljs-type">Child_Insert</span></span>( <span class="hljs-type"><span class="hljs-type">PersonData</span></span> person ) { var <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetAddressData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddressRepository</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddAddress</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> ); } protected void </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Child_Update</span></span></span><span class="hljs-class">( </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PersonData</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class"> ) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetAddressData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddressRepository</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EditAddress</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> ); } protected void </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Child_DeleteSelf</span></span></span><span class="hljs-class">( </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PersonData</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class"> ) { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddressRepository</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RemoveAddress</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> ); } private </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddressData</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetAddressData</span></span></span><span class="hljs-class">( ) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addressData</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddressData</span></span></span><span class="hljs-class">( ); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataMapper</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Map</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addressData</span></span></span><span class="hljs-class"> ); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addressData</span></span></span><span class="hljs-class">; } }</span></span></code> </pre><br></div></div><br>  The specific DAL reference code has disappeared.  Now, before accessing the DataPortal_XYZ methods, the server data portal using the overridden anchors will resolve all dependencies of the Person class, which will allow encapsulating all DAL access code in the repository implementation. <br><br>  The idea of ‚Äã‚Äãthis method is taken from the <a href="https://jonnybekkum.wordpress.com/2010/12/30/cslacontrib-mef-and-repository-pattern-with-csla4/">blog Johny Bekkum</a> .  He created the <a href="https://github.com/marimerllc/cslacontrib">CSLAContrib</a> library, which contains many useful additions to the CSLA.  In particular, it has a set of CSLA stereotypes that support Property Setter Injection.  The code for these stereotypes is similar to the code above.  The <a href="https://msdn.microsoft.com/ru-ru/library/dd460648(v%3Dvs.110).aspx">MI</a> (Managed Extensibility Framework), introduced in the .NET Framework 4.0, is used as a DI container. <br><br>  Note that all difficulties can be avoided simply by using the Container directly: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IPersonRepository GetPersonRepository { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Core.Container.Kernel.Get&lt;IPersonRepository&gt;(); }</code> </pre><br>  In this case, the Container class is used as a Service Locator, which is often <a href="http://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern/">referred to as an anti-pattern</a> .  However, this method can also be useful, especially when accompanied by large legacy projects on the CSLA. <br><br><h2>  CSLA via Repository Pattern </h2><br>  Let us consider in more detail the implementation of the Repository template.  We'll take out the code common for all future repositories for working with Oracle databases to the base class RepositoryBase: <br><br><pre> <code class="hljs pgsql">//RepositoryBase.cs <span class="hljs-type"><span class="hljs-type">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RepositoryBase { private readonly string _databaseName; protected RepositoryBase( string databaseName ) { _databaseName = databaseName; } protected virtual <span class="hljs-type"><span class="hljs-type">void</span></span> ExecuteProcedure( string procName, params OracleParameter[] parameters ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = TransactionManager&lt;OracleConnection, OracleTransaction&gt;.GetManager( _databaseName ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.StoredProcedure; command.CommandText = procName; command.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> = manager.<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( parameters != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { command.Parameters.AddRange( parameters ); } command.ExecuteNonQuery( ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( manager.RefCount == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { manager.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); } } } } protected virtual IEnumerable&lt;T&gt; GetRows&lt;T&gt;( string query, Func&lt;SafeDataReader, T&gt; fetchFromReader, params OracleParameter[] parameters ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var manager = ConnectionManager&lt;OracleConnection&gt;.GetManager( _databaseName ) ) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var command = manager.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>.CreateCommand( ) ) { command.CommandType = CommandType.Text; command.CommandText = query; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( parameters != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { command.Parameters.AddRange( parameters ); } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( var reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SafeDataReader( command.ExecuteReader( ) ) ) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( reader.<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>( ) ) { yield <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetchFromReader( reader ); } } } } } }</code> </pre><br>    IPersonRepository,  RepositoryBase: <br><br><pre> <code class="hljs pgsql">//PersonRepository.cs <span class="hljs-type"><span class="hljs-type">internal</span></span> sealed <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PersonRepository : RepositoryBase, IPersonRepository { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> PersonRepository( ) : base( "CSLAPROJECT" ) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> PersonData FindPerson( <span class="hljs-type"><span class="hljs-type">int</span></span> id ) { const string query = @"SELECT id ,first_name ,second_name ,age ,comment ,last_changed FROM All_persons WHERE id = :p_id"; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetRows( query, FetchFromReader, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_id", id ) ).First( ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> AddPerson( PersonData newPerson, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> newId, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged ) { var parameters = GetPersonParameters( newPerson ); ExecuteProcedure( "csla_project.add_person", parameters ); newId = ( <span class="hljs-type"><span class="hljs-type">int</span></span> )parameters.First( ).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; lastChanged = parameters.Last( ).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> EditPerson( PersonData existingPerson, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> lastChanged ) { var parameters = GetPersonParameters( existingPerson ); ExecuteProcedure( "csla_project.update_person", parameters ); lastChanged = parameters.Last( ).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> RemovePerson( <span class="hljs-type"><span class="hljs-type">int</span></span> personId ) { ExecuteProcedure( "csla_project.delete_person", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter("p_id", personId) ); } private PersonData FetchFromReader( SafeDataReader reader ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PersonData { Id = reader.GetInt32( "id" ), FirstName = reader.GetString( "first_name" ), SecondName = reader.GetString( "second_name" ), Age = reader.GetInt32( "age" ), <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> = reader.GetString( "comment" ), LastChanged = reader["last_changed"] }; } private OracleParameter[] GetPersonParameters( PersonData personData ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>[] { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_id", personData.Id ){Direction = ParameterDirection.InputOutput}, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_first_name", personData.FirstName ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_second_name", personData.SecondName ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_age", personData.Age ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_comment", personData.<span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> ), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> OracleParameter( "p_last_changed", OracleType.Int32 ) { <span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> = personData.LastChanged, Direction = ParameterDirection.Output } }; } }</code> </pre><br>      : <br><br><pre> <code class="hljs pgsql">//Context.cs <span class="hljs-type"><span class="hljs-type">internal</span></span> sealed <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Context : IContext { ITransaction IContext.BeginTransaction( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span>( ); } } //<span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span>.cs <span class="hljs-type"><span class="hljs-type">internal</span></span> sealed <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> : ITransaction { private readonly TransactionManager&lt;OracleConnection, OracleTransaction&gt; _manager = TransactionManager&lt;OracleConnection, OracleTransaction&gt;.GetManager( "CSLAPROJECT" ); <span class="hljs-type"><span class="hljs-type">void</span></span> ITransaction.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ) { _manager.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>( ); Dispose( ); } <span class="hljs-type"><span class="hljs-type">void</span></span> ITransaction.<span class="hljs-keyword"><span class="hljs-keyword">Rollback</span></span>( ) { Dispose( ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Dispose( ) { _manager.Dispose( ); } }</code> </pre><br>          CSLA <a href="">TransactionManager</a> ,             ADO .NET            .  AddressRepository  OrderRepository    PersonRepository. <br><br>        : <br><br><img src="https://habrastorage.org/files/735/ac2/f04/735ac2f0442b4b139c75e26355ccb4ce.png"><br><br>  -,      .     : <br><br><img src="https://habrastorage.org/files/c08/e10/39a/c08e1039ada2439296e860a7064536b0.png"><br><br> ,   CslaProject.DataAccess.OracleDb  Ninject   DAL: <br><br><pre> <code class="hljs pgsql">//Module.cs <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Module : NinjectModule { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( ) { Bind&lt;IPersonRepository&gt;( ).<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>&lt;PersonRepository&gt;( ).InSingletonScope( ); Bind&lt;IOrderRepository&gt;( ).<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>&lt;OrderRepository&gt;( ).InSingletonScope( ); Bind&lt;IAddressRepository&gt;( ).<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>&lt;AddressRepository&gt;( ).InSingletonScope( ); Bind&lt;IGroupRepository&gt;( ).<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>&lt;GroupRepository&gt;( ).InSingletonScope( ); Bind&lt;IContext&gt;( ).<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>&lt;Context&gt;( ).InSingletonScope( ); } }</code> </pre><br><h2>   </h2><br>     Container        DAL   . <br><br><pre> <code class="hljs pgsql">private static <span class="hljs-type"><span class="hljs-type">void</span></span> ConfigureKernel( ) { // InjectNonPublic = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ..   var kernel = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StandardKernel( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> NinjectSettings {InjectNonPublic = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>} ); //   . var dependencyCatalogs = GetDependencyCatalogs( ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( dependencyCatalogs.<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>( ) ) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( var <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dependencyCatalogs.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>( d =&gt; ConfigurationManager.AppSettings[ d ].Split( <span class="hljs-string"><span class="hljs-string">';'</span></span> ) ) ) { var catalogPath = <span class="hljs-type"><span class="hljs-type">Path</span></span>.Combine( AppDomain.CurrentDomain.BaseDirectory, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[ <span class="hljs-number"><span class="hljs-number">0</span></span> ] ); IEnumerable&lt;string&gt; depedencyLibNames; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>.Count( ) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) { var searchPattern = <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>[ <span class="hljs-number"><span class="hljs-number">1</span></span> ]; depedencyLibNames = Directory.GetFiles( catalogPath, searchPattern ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { depedencyLibNames = Directory.GetFiles( catalogPath ); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( var file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> depedencyLibNames ) { var dependency = Assembly.LoadFile( <span class="hljs-type"><span class="hljs-type">Path</span></span>.Combine( catalogPath, file ) ); kernel.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>( dependency ); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   ,   //    ,     CslaProject kernel.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>("CslaProject*.dll"); } _kernel = kernel; } private static string[] GetDependencyCatalogs( ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ConfigurationManager.AppSettings.AllKeys.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>( p =&gt; p.StartsWith( "CslaProject.Depencies", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, CultureInfo.InvariantCulture ) ).ToArray( ); }</code> </pre><br>  App.Config   : <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CslaProject.Dependencies"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Dependencies;CslaProject*.dll"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;add name="CSLAPROJECT" providerName="System.Data.OracleClient" connectionString="user id=test_user;password=12345;data source=testdb;" /&gt; --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">connectionStrings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sku</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".NETFramework,Version=v4.0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>       appSettings     CslaProject.Dependencies.         ,       . <br><br>      App.Config   CslaProject.Dependencies (,   -     - CslaProject.UnitTests),    ,     CslaProject. ,     -   Ninject,    DAL  ,    DataPortal_XYZ    . <br><br><h2>  Conclusion </h2><br>         - CSLA  .    : <br><br><ul><li>  -     Injectables,    . </li><li>   .          DataPortal_XYZ       ,   -        . </li><li>   . </li><li>    DI-. </li></ul><br>  On this, perhaps, everything.   ,      . </div><p>Source: <a href="https://habr.com/ru/post/314110/">https://habr.com/ru/post/314110/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314096/index.html">Paul Graham thought about death and updated his todo list</a></li>
<li><a href="../314100/index.html">Software Cost Estimation: Dan Galloth and SEER-SEM</a></li>
<li><a href="../314104/index.html">Docker: PostgreSQL configuration master-slave</a></li>
<li><a href="../314106/index.html">How we started a failover cluster</a></li>
<li><a href="../314108/index.html">Remotely enable Mikrotik scripts from Telegram</a></li>
<li><a href="../314112/index.html">US authorities allowed researchers to do pentest and reverse engineering without legal consequences</a></li>
<li><a href="../314114/index.html">Enum in PHP</a></li>
<li><a href="../314116/index.html">About how I wrote an ad blocker and trackers for Samsung smartphones on Android. Adhell</a></li>
<li><a href="../314118/index.html">The tortuous path of the developer</a></li>
<li><a href="../314120/index.html">The book "Graphic Design. Visual Grammar ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>