<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tracing PHP Applications with xdebug</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome to the second series of our story about xdebug. The xdebug installation and its basic features were discussed in the first series. In this art...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tracing PHP Applications with xdebug</h1><div class="post__text post__text-html js-mediator-article">  Welcome to the second series of our story about xdebug.  The xdebug installation and its basic features were discussed in the first series.  In this article we will look at tracing the program. <br>  The previous series of the cycle <a href="http://habrahabr.ru/blog/php/37002.html">Introducing xdebug</a> <br><a name="habracut"></a><br>  <strong>Creating a trace log</strong> <br><br>  Instead of manually adding various debugging output functions, we can use xdebug to create a trace log.  The trace log is a list of calls to functions and methods of the class throughout the execution of the script.  The advantage is that each call will be reflected in the log <br>  The trace log usually differs from run to run, as it depends on incoming data that is different from the request to request. <br>  Tracing the trace log helps us to understand how our program runs, but it is very difficult to visualize all possible branches, unless our program is very simple.  One if suggests two possible paths for program development.  With each further if, the number of (theoretically) possible paths of development is multiplied by 2. It is because of this that testing large programs is quite difficult: there are too many different paths of development and each must be tested. <br>  Now let's start creating the trace log.  xdebug supports two different logging formats.  By default, logies are created in a format that is pleasant to the human eye, and it is convenient to read and analyze them.  If you want to process the trace log with any program (intended for processing xdebug logs), you need to configure xdebug in a different format.  This format (computer-readable) is easily processed by the program (log analyzer), because it contains fixed-length columns. <br>  If you want to get a trace log for each script that you run, add the following commands <br><blockquote>  xdebug.auto_trace = On <br>  xdebug.trace_output_dir = c: \ data </blockquote><br>  in php.ini.  Do not forget to restart your web server after changing php.ini. <br>  The second line defines the path by which xdebug will save logs.  By default, this path is set to / tmp, this is a good choice for, but will cause problems in Windows, since c: \ tmp (it is assumed that c: is the current disk) is usually not created.  Therefore, you need to create a directory in Windows (or register an existing one) in which xdebug will save the trace logs, otherwise it will not work. <br>  The execution of functions and methods will be very slow since each of their calls, as well as the results will be recorded in the log. <br><br>  <strong>Tracing part of the application</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since the size of the trace log is growing very quickly, a good solution is to create a log only for the ‚Äúinteresting‚Äù parts of the application, for example, creating a trace log during the initialization phase. <br>  Let's take a look at how to create a trace log for a small recursive function (factorial calculation), in this example we will start and finish the trace in real time.  If you have activated tracing in php.ini, you will see a warning that tracing has already been started for your script. <br><blockquote>  xdebug_start_trace ('c: /data/fac.xt'); <br>  print fac (7); <br><br>  function fac ($ x) <br>  { <br>  if (0 == $ x) return 1; <br>  return $ x * fac ($ x - 1); <br>  } <br><br>  xdebug_stop_trace (); </blockquote><br>  As you can see by the path and file name, the program is running in Windows.  If you are working in Unix, you must use a different file name.  The xdebug_start_trace function starts tracing recording, and xdebug_stop_trace stops.  When this code is launched, approximately such a log file will be generated: <br><blockquote>  TRACE START [2007-10-26 12:18:48] <br>  0.0068 53384 -&gt; fac () C: \ www \ fac.php: 5 <br>  0.0069 53584 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0069 53840 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0070 54096 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0070 54376 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0071 54656 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0072 54936 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0072 55216 -&gt; fac () C: \ www \ fac.php: 10 <br>  0.0073 55392 -&gt; xdebug_stop_trace () C: \ www \ fac.php: 13 <br>  0.0237 55392 <br>  TRACE END [2007-10-26 12:18:48] </blockquote><br>  In each row, the first column shows the total time the code was run.  The second column shows the amount of memory that the script currently occupies.  The last column shows the file, line and function name.  xdebug indents each function according to the stack space for readability. <br>  If you want xdebug to show the difference in memory usage, add <br><blockquote>  xdebug.show_mem_delta = On </blockquote><br>  in php.ini.  The difference is the difference between memory usage between the current line and the previous one.  You can add this setting at runtime using the ini_set function, but only after the trace begins. <br>  The xdebug_start_trace function has a second optional parameter.  You can use one or more of the following three settings: XDEBUG_TRACE_APPEND adds to the existing trace file.  When XDEBUG_TRACE_COMPUTERIZED is set, xdebug creates a trace log in a readable format by the analyzer.  Using this parameter is the same as setting the xdebug.trace_format parameter to 1. The XDEBUG_TRACE_HTML parameter sets the format of the trace log in HTML. <br>  The following screenshot shows the HTML trace log format: <br><img src="http://devzone.zend.com/images/articles/2871/trace_html.jpg"><br><br>  <strong>Adding information to the trace log</strong> <br><br>  We can also configure xdebug to save us the parameters we pass to the functions.  This is very useful to better understand how the program runs. <br>  Saving parameters to the trace log is set with the xdebug.collect_params parameter described in the previous article.  xdebug.collect_params accepts numeric values, 0 means no additional information, 4 means you need to display the name of the variable and all the information about each function parameter.  A value of 3 will display the names and values ‚Äã‚Äãof the variables cropped in accordance with the settings of the parameters xdebug.var_display_max_data, debug.var_display_max_children and xdebug.var_display_max_depth described in the previous article. <br>  Below is an excerpt from the trace log with preservation of function parameters: <br><blockquote><br>  0.0033 54320 -&gt; fac ($ x = 7) C: \ www \ fac.php: 6 <br>  0.0034 54432 -&gt; fac ($ x = 6) C: \ www \ fac.php: 11 <br></blockquote><br>  Let's add more information.  Using <br><blockquote>  xdebug.collect_return = On </blockquote><br>  we will configure xdebug to save the return values ‚Äã‚Äãfor each function.  This will make the log a little difficult to read, but look at the log of our function, you will see what value is returned at each stage of the recursion: <br><blockquote>  TRACE START [2007-10-26 12:30:04] <br>  0.0133 55704 +48 -&gt; fac ($ x = 7) C: \ www \ fac.php: 8 <br>  0.0133 55840 +136 -&gt; fac ($ x = 6) C: \ www \ fac.php: 13 <br>  0.0134 56096 +256 -&gt; fac ($ x = 5) C: \ www \ fac.php: 13 <br>  0.0134 56352 +256 -&gt; fac ($ x = 4) C: \ www \ fac.php: 13 <br>  0.0134 56632 +280 -&gt; fac ($ x = 3) C: \ www \ fac.php: 13 <br>  0.0135 56912 +280 -&gt; fac ($ x = 2) C: \ www \ fac.php: 13 <br>  0.0135 57192 +280 -&gt; fac ($ x = 1) C: \ www \ fac.php: 13 <br>  0.0135 57472 +280 -&gt; fac ($ x = 0) C: \ www \ fac.php: 13 <br>  &gt; =&gt; 1 <br>  &gt; =&gt; 1 <br>  &gt; =&gt; 2 <br>  &gt; =&gt; 6 <br>  &gt; =&gt; 24 <br>  &gt; =&gt; 120 <br>  &gt; =&gt; 720 <br>  &gt; =&gt; 5040 <br>  0.0140 57648 +176 -&gt; xdebug_stop_trace () C: \ www \ fac.php: 26 <br>  0.0140 57648 <br>  TRACE END [2007-10-26 12:30:04] </blockquote><br>  As you can see in this example, the xdebug.show_mem_delta parameter is set. <br><br>  <strong>Caption Tracing Log</strong> <br><br>  Up to now, we have clearly indicated the name of the trace log.  This is not always convenient.  If you need to view the logs depending on the incoming data or the state of the application, it is good that xdebug itself automatically assign a name.  xdebug can assign a name depending on what you use, the xdebug.auto_trace parameter or the xdebug_start_trace () function to activate tracing.  If in the last example you pass an empty argument as parameters to the xdebug_start_trace function, xdebug automatically selects a name for the file. <br>  The name of the generated xdebug file always starts with ‚Äútrace.‚Äù And has the extension .xt.  The part of the name between the default dots is the CRC from the working directory.  By setting xdebug.trace_output_name you can define another name for the trace log.  xdebug.trace_output_name takes a string as an argument; a string can contain various qualifiers.  Below is a list of the most important qualifiers: <ul><li>  % c - working directory CRC </li><li>  % p - process ID </li><li>  % r is a random number </li><li>  % u - current time with microseconds </li><li>  % H - $ _SERVER ['HTTP_HOST'] </li><li>  % R - $ _SERVER ['REQUEST_URI'] </li></ul><br>  Using a clever combination of these qualifiers, you can force xdebug to create a different number of trace logs and understand which log belongs to which script, depending on the name of the virtual host or requests. <br>  In most cases, you will want to create a single script run.  Therefore, xdebug will overwrite the existing log with the specified name.  You can configure xdebug to add information to the current using the following setting. <br><blockquote>  xdebug.trace_options = 1 </blockquote><br>  in php.ini. <br>  If you need to know at startup what name xdebug will select to write the log, you can call the function xdebug_get_tracefile_name (). <br><br>  <strong>Conclusion</strong> <br><br>  Being able to use function tracing is a very useful thing that xdebug gives us.  You can create logies of your programs without adding calls to various functions.  All function calls will be displayed without explicit help function calls. <br>  You can use various utilities like grep to find the necessary information or section in the trace log, or write a small program in PHP that will parse this file for you.  Tracing is not a replacement for the debugger.  The debugger will be discussed in the fourth part of the story. <br>  You do not need to activate tracing on combat vehicles, this will greatly degrade performance, each line of the program will be reflected in the trace log. <br>  The next article will be devoted to Profiling PHP Applications With xdebug. </div><p>Source: <a href="https://habr.com/ru/post/31463/">https://habr.com/ru/post/31463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../31462/index.html">Soon: nothing between you and your device</a></li>
<li><a href="../314620/index.html">Product Design Digest October 2016</a></li>
<li><a href="../314622/index.html">Setting up email notifications in MS SQL Server</a></li>
<li><a href="../314624/index.html">EF Core: Setting the name of the generated models in Scaffolding</a></li>
<li><a href="../314628/index.html">Auto-collection of data on completed tasks in MS SQL Server</a></li>
<li><a href="../314630/index.html">Auto-collection of data about changes in database schemas in MS SQL Server</a></li>
<li><a href="../314632/index.html">Automatic removal of hung processes in MS SQL Server</a></li>
<li><a href="../31464/index.html">7 Torrent rocking for your phone.</a></li>
<li><a href="../314642/index.html">Remote work: 50 shades of freedom</a></li>
<li><a href="../314644/index.html">Is DevOps afraid of modern QA?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>