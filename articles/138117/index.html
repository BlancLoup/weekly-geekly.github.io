<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are developing a ‚Äúhome budget‚Äù. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is the first part of a potential series, which will describe the process of creating an application for convenient management of the home...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are developing a ‚Äúhome budget‚Äù. Part 1</h1><div class="post__text post__text-html js-mediator-article">  This article is the first part of a potential series, which will describe the process of creating an application for convenient management of the home budget for WP7 from the very beginning.  At the same time, various APIs and platform capabilities will be used in the development in order to maximize their coverage.  At the same time, the program will be absolutely usable (it will have at least one permanent user), and there will not be garbage used exclusively for academic purposes. <br><br>  The choice of the type of application is due to the fact that the first program I bought in the marketplace was exactly a budget but some useful functions (for example, automatic backup on SkyDrive, etc.) are not in it and are not planned. <br><br><h5>  <b>Principles of development</b> </h5><br>  The functionality will be increased gradually, by small iterations of 10-14 days, of which 3-5 days are allocated for running into the previous version, 1 day for brainstorming and the rest for the implementation of the conceived, testing and design of the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since I plan to use the created application on a daily basis instead of a similar utility, the functionality will have to be exactly what is needed, and not what is easier to write. <br><a name="habracut"></a><br><h5>  <b>First iteration: plan</b> </h5><br>  In the first case, we should be able to add transactions and have at least basic categories, because otherwise, after a week of use, there will be a small cesspool that you don‚Äôt even want to open. <br>  In this article we will in detail (perhaps even too much) consider the process of creating a database and the process of adding categories.  We will not consider the process of adding transactions since it is almost 100% similar to working with categories and its consideration would inflate an article to too large.  Also, we will not consider the process of editing categories, but given the model of work used - it will take + - 10 minutes. <br>  If necessary, these topics can be glimpsed in the next article or skip. <br><br>  Accordingly, we will consider the following questions: <ul><li>  Basic principles of development for WP7 </li><li>  <s>Some Metro Basics</s> <sup>[1]</sup> </li><li>  Working with SQLCE database and creating a model based on the code-first principle </li></ul><br><h5>  <b>Prerequisites</b> </h5><ul><li>  Basic knowledge of .NET and C # </li><li>  <a href="http://www.microsoft.com/download/en/details.aspx%3Fdisplaylang%3Den%26id%3D27570">Windows Phone SDK 7.1</a> </li><li>  <a href="http://silverlight.codeplex.com/">Silverlight for Windows Phone Toolkit</a> ( <a href="http://silverlight.codeplex.com/releases/view/75888">November 2011</a> version) </li><li>  <a href="http://compositewpf.codeplex.com/releases/view/75760">Prism for Phone updated for Mango</a> <sup>[2]</sup> </li></ul><br><h5>  <b>Development: database creation</b> </h5><br>  <font color="gray"><i>In case someone has a desire to use this article as a lesson - after each logically completed and more or less important stage, a link to the archive with the results will be given.</i></font>  <font color="gray"><i>All sources on <a href="https://skydrive.live.com/redir.aspx%3Fcid%3D6ea65959da3149f3%26resid%3D6EA65959DA3149F3!863%26parid%3Droot">SkyDrive</a></i> .</font>  <font color="gray">Separate files in the case of abbreviations will be presented on pastebin</font> <font color="gray"><img src="https://habrastorage.org/storage2/852/ddf/b7c/852ddfb7ca8a556a7b609de5671d7ac3.png"></font>  <font color="gray">.</font> <br><br><img align="right" src="http://habrastorage.org/storage2/3f6/bb0/879/3f6bb08795038ab0836dff60eee4a333.png">  Choosing the structure of the application, I focus primarily on the logical separation of the functions performed by projects.  Based on these considerations, to create a database and all data types, we create a separate project, Entities, do not forget to add System.Data.Linq and Microsoft.Practices.Prism to References.  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3D6ea65959da3149f3%26resid%3D6EA65959DA3149F3!868%26parid%3D6EA65959DA3149F3!867">Solution here</a> . <br><br>  <font color="gray"><i>Immediately make a reservation - by the concept of a transaction I mean a financial transaction, not a transaction in the database.</i></font> <br>  When creating the database, we will use the code-first approach <sup>[3]</sup> . For today's task, we will be satisfied with as many as two tables - Transactions and Categories.  Create two empty tables and add them to the database. <br><br>  <b>Transaction.cs</b> <br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Table(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Transactions"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Transaction</span></span> : <span class="hljs-title"><span class="hljs-title">NotificationObject</span></span></code> </pre> <br>  <b>Category.cs</b> <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Table(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Categories"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Category</span></span> : <span class="hljs-title"><span class="hljs-title">NotificationObject</span></span></code> </pre> <br>  <b>Database.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Database</span></span> : <span class="hljs-title"><span class="hljs-title">DataContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> DBConnectionString = <span class="hljs-string"><span class="hljs-string">"Data Source=isostore:/Database.sdf"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Database</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Database.DBConnectionString</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DeferredLoadingEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Table&lt;Bick.Budget.Entities.Categories.Category&gt; Categories; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Table&lt;Bick.Budget.Entities.Transactions.Transaction&gt; Transactions; }</code> </pre>  <font color="gray"><i>Do not even think of making tables in the database properties and not fields.</i></font>  <font color="gray"><i>I, because of the stylistic habit of using properties for public, killed about an hour trying to understand why the database is not working at all.</i></font> <br>  Here, transactions and categories inherit the NotificationObject defined in Prism for normal interaction with the UI in the future.  By the way, we use the MVVM pattern when developing. <br>  In the database constructor, set the DefferedLoadingEnabled flag to disable the automatic loading of related objects from the database.  It will be necessary - we will separately specify. <br>  We proceed to the formation of the contents of the tables.  As a result, we should have something like this: <br><img src="https://habrastorage.org/storage2/f7d/1a7/5b2/f7d1a75b2cefdfc62010c4f6702e39d5.png"><br>  Highlights in <b>Transaction.cs</b> <a href="http://pastebin.com/ezYbG9Ze"><img src="https://habrastorage.org/storage2/852/ddf/b7c/852ddfb7ca8a556a7b609de5671d7ac3.png"></a>  : <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Column(IsPrimaryKey = true)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid ID { ... } ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EntityRef&lt;Categories.Category&gt; category; [Association(Name = <span class="hljs-string"><span class="hljs-string">"FK_Transactions_Category"</span></span>, Storage = <span class="hljs-string"><span class="hljs-string">"category"</span></span>, ThisKey = <span class="hljs-string"><span class="hljs-string">"CategoryID"</span></span>, IsForeignKey = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Categories.Category Category { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category.Entity; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Categories.Category previousValue = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category.Entity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((previousValue != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category.HasLoadedOrAssignedValue == <span class="hljs-literal"><span class="hljs-literal">false</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((previousValue != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category.Entity = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; previousValue.Transactions.Remove(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category.Entity = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.AddedTransactions == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.AddedTransactions.Contains(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Transactions.Add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CategoryID = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ID; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.category = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityRef&lt;Categories.Category&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaisePropertyChanged(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Category); } } }</code> </pre>  The ID parameter is a table column and primary key.  The remaining columns are also specified by the Column attribute.  More details about Attribute-based mapping can be read on <a href="http://msdn.microsoft.com/en-us/library/bb386971.aspx">msdn</a> . <br>  Category together with CategoryID are responsible for linking transactions to categories, and in this example we created the foreign key FK_Transactions_Category.  The reason for the bloated setter is that when assigning a transaction to the parent category, we must delete the transaction from the previous parent category, and add the new one to the new one.  Roughly speaking - Navigation Property from <acronym>EF</acronym> .  In turn, Category uses minimum code to implement this. <br><br>  <b>Category.cs</b> <a href="http://pastebin.com/L8nkPxNE"><img src="https://habrastorage.org/storage2/852/ddf/b7c/852ddfb7ca8a556a7b609de5671d7ac3.png"></a>  : <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EntitySet&lt;Transactions.Transaction&gt; Transactions { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactions == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntitySet&lt;Transactions.Transaction&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactions.CollectionChanged += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Collections.Specialized.NotifyCollectionChangedEventHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.OnTransactionsChanged); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactions; } ... } ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTransactionsChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.AddedTransactions = e.NewItems; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Transactions.Transaction t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> e.NewItems) { t.Category = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.AddedTransactions = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.RaisePropertyChanged(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Transactions); }</code> </pre>  As a matter of fact, in Category we catch the situation when no category is assigned to a transaction, and a new item is added to the category transaction list. <br>  The base is ready.  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3D6ea65959da3149f3%26resid%3D6EA65959DA3149F3!870%26parid%3D6EA65959DA3149F3!865">Solution on SkyDrive</a> . <br><br><h5>  <b>Development: we create UI</b> </h5><br>  The Shell project was created as a Windows Phone Application, that is, at this stage we will not use such controls as Pivot / Panorama.  User interaction with the application will be approximately as follows: <br><img src="https://habrastorage.org/storage2/94d/d03/091/94dd0309156885e54f77af0b29599a5b.png"><br>  <font color="gray"><i>Expression Blend with SketchFlow (not included in the free SDK) and the sketchflow template for WP7 ( <a href="http://wp7sketchflow.codeplex.com/">CodePlex</a> ) were used for creation.</i></font> <br><br><img align="right" src="https://habrastorage.org/storage2/def/a96/eb8/defa96eb820ed34151f9c3513aca7520.png">  We will divide these screens into the following View: New / Edit transaction, New / Edit category, Categories list, Transactions list, and the part responsible for working with transactions is transferred to a separate project.  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3D6ea65959da3149f3%26resid%3D6EA65959DA3149F3!873%26parid%3D6EA65959DA3149F3!865%26authkey%3D!AF1kFORWHwEmhrE">Solution on SkyDrive</a> . <br><br>  First of all, we need to implement the functionality of viewing the list of categories and adding categories.  There is nothing special in this, but as we try to focus on performance, we will need to refine our Database a bit.  The fact is that when viewing the list of categories, we are not going to edit anything - we just need to quickly get the list of categories as quickly as possible.  To do this, we will make this edit in <b>Database.cs</b> : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Database</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isReadOnly = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Database.DBConnectionString</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DatabaseExists()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CreateDatabase(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DeferredLoadingEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ObjectTrackingEnabled = !isReadOnly; }</code> </pre>  Thus, with isReadOnly == true, we disable tracking of context objects for changes, which on average increases the speed of simple reading by more than 10 times. <br><br>  When creating a UI, one of the problems we face is the inability to attach any Behavior to the ApplicationBarButton (we need it for binding to the team).  In Prism.Interactions there is a DependencyProperty ApplicationBarButtonCommand but for some reason it did not work for me.  Therefore, I had to use the quite convenient <a href="http://appbarutils.codeplex.com/">AppBarUtils</a> library. <br>  Interesting moments from <b>CategoriesView.xaml</b> <a href="http://pastebin.com/Kc5LdxDc"><img src="https://habrastorage.org/storage2/852/ddf/b7c/852ddfb7ca8a556a7b609de5671d7ac3.png"></a>  : <br><pre> <code class="cs hljs">&lt;phone:PhoneApplicationPage xmlns:i=<span class="hljs-string"><span class="hljs-string">"clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"</span></span> xmlns:appbar=<span class="hljs-string"><span class="hljs-string">"clr-namespace:AppBarUtils;assembly=AppBarUtils"</span></span>&gt; ‚Ä¶ &lt;phone:PhoneApplicationPage.ApplicationBar&gt; &lt;shell:ApplicationBar IsVisible=<span class="hljs-string"><span class="hljs-string">"True"</span></span> IsMenuEnabled=<span class="hljs-string"><span class="hljs-string">"False"</span></span> Mode=<span class="hljs-string"><span class="hljs-string">"Default"</span></span>&gt; &lt;shell:ApplicationBarIconButton IconUri=<span class="hljs-string"><span class="hljs-string">"/icons/appbar.add.rest.png"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"add new"</span></span>/&gt; &lt;/shell:ApplicationBar&gt; &lt;/phone:PhoneApplicationPage.ApplicationBar&gt; &lt;i:Interaction.Behaviors&gt; &lt;appbar:AppBarItemCommand Id=<span class="hljs-string"><span class="hljs-string">"add new"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"{Binding Path=AddCategoryCommand}"</span></span>/&gt; &lt;/i:Interaction.Behaviors&gt;</code> </pre>  Most often, the actions of the buttons will be transitions to other pages of the application and we need to make a convenient mechanism for working with navigation from the ViewModel.  A convenient and relatively familiar (I once worked with the desktop MVVM on a similar principle) the method is described <a href="http://blog.clauskonrad.net/2010/09/wp7-navigationservice-support-when.html">here</a> .  A similar principle we implement in our Common project by creating the ApplicationController class.  Also all our View's will be defined in the static KnownPages class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">KnownPages</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AddCategory = <span class="hljs-string"><span class="hljs-string">"/Views/CategoryAddEditView.xaml?mode=Add"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> EditCategory = <span class="hljs-string"><span class="hljs-string">"/Views/CategoryAddEditView.xaml?mode=Edit&amp;id={0}"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ListCategories = <span class="hljs-string"><span class="hljs-string">"/Views/CategoriesView.xaml"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> CategoryDetails = <span class="hljs-string"><span class="hljs-string">"/Views/CategoryDetailsView.xaml?id={0}"</span></span>; }</code> </pre>  , a NavigateTo () from ApplicationController (still a little left of the original) will look like this <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NavigateTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { Uri address = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(String.Format(url, data), UriKind.Relative); PhoneApplicationFrame root = Application.Current.RootVisual <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PhoneApplicationFrame; root.Navigate(address); }</code> </pre>  Now, since we are passing the <i>mode = Add</i> parameter to the AddEdit page, we need to catch the navigation event in the ViewModel and get the data from the string.  Unfortunately, at the moment I stopped at the option of overriding the OnNavigatedTo method in CodeBehind and calling the corresponding method in the ViewModel. <br>  <b>CategoryAddEditView.xaml.cs</b> : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Windows.Navigation.NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnNavigatedTo(e); ((CategoryAddEditViewModel)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.DataContext).OnNavigatedTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.NavigationContext, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.NavigationService.BackStack.First()); }</code> </pre>  As can be seen from the code, we transfer not only the navigation context (from where it is convenient to pull the parameters from the page address), but also the page from which we switched to the current one. <br>  Now it's time to implement the process of adding a category.  Normal View and Normal ViewModel.  But there are two but.  The first is that we will use the same MV-VM for editing categories (will be homework), respectively, we receive and process the parameter mode from the NavigationContext.  The second is that in WP7 for TextBox, a change in the value of a property occurs only when the element loses focus.  This is not implemented in native ways, so for this we use Prism (File CategoryAddEditView.xaml): <br><pre> <code class="cs hljs">xmlns:prism=<span class="hljs-string"><span class="hljs-string">"clr-namespace:Microsoft.Practices.Prism.Interactivity;assembly=Microsoft.Practices.Prism.Interactivity"</span></span> ... &lt;TextBox TextWrapping=<span class="hljs-string"><span class="hljs-string">"Wrap"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"{Binding Path=Category.Name, Mode=TwoWay}"</span></span>&gt; &lt;i:Interaction.Behaviors&gt; &lt;prism:UpdateTextBindingOnPropertyChanged /&gt; &lt;/i:Interaction.Behaviors&gt; &lt;/TextBox&gt;</code> </pre>  The process of category preservation looks like this: <br>  <b>CategoryAddEditViewMode.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveCategory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isEditMode) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.AddCategory(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Category); ApplicationController.Default.GoBack(); } }</code> </pre>  What you should pay attention to - we do not go to the CategoriesView page, but return to the previous page.  It is worth paying attention to similar transitions within the application so that the user is not at a loss where he suggested after clicking on the Back button. <br>  In <b>CategoryAddEditModel.cs,</b> saving looks like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCategory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Category cat</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Database db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Database()) { db.Categories.InsertOnSubmit(cat); db.SubmitChanges(); } }</code> </pre>  It can be seen that there are no checks and validations - and this is bad.  But for the first article there is already quite a lot of material, and now it is more important for us to finish the main functionality and start using the program - we'll do the rest between the articles or in the following. <br>  When returning to the list of categories, View and ViewModel are not re-created, so when going from the list page to the adding page we will set the flag IsReloadPending and after return we will process and reset it. <br>  <b>CategoriesViewModel.cs</b> : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCategory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isReloadPending = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ApplicationController.Default.NavigateTo(KnownPages.AddCategory); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationContext context, JournalEntry lastPage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isReloadPending) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isReloadPending = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Categories = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.model.GetCategoriesList(); } }</code> </pre> <br><img align="right" src="https://habrastorage.org/storage2/6f5/02c/1a1/6f502c1a19ba574a7ba3262d010530ab.png"><h5>  <b>Results</b> </h5>  Today we received all the necessary tools for working with WP7, tried working with the database, prepared the ground for the further development of the program and learning the programming techniques for Windows Phone.  We also ran into a couple of jambs (ApplicationBar, TextBox) and overcame them. <br>  Yes - we did not receive a program ready for use (just as a data collector), but we are separated from this stage in about 1-2 hours.  Who cares - try it yourself.  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3D6ea65959da3149f3%26resid%3D6EA65959DA3149F3!876%26parid%3D6EA65959DA3149F3!865%26authkey%3D!AMjYdovuqgijlYE">Solution on SkyDrive</a> . <br><br>  In parallel, those familiar with C # should have realized that Microsoft‚Äôs mobile platform is quite easy to learn and can easily be mastered by yourself. <br><br>  <font color="gray">At the same time, I realized that writing such an article takes quite a long time.</font>  <font color="gray">The article was written in the diary format in parallel with the writing of the application.</font> <br><br><h5>  <b>Future plans</b> </h5>  In the next article I would like to consider: <ul><li>  process of creating secondary tile </li><li>  application launch optimization </li><li>  prototyping an application in SketchFlow </li></ul><br><h5>  <b>Literature</b> </h5><ol><li>  <a href="http://bowdenweb.com/wp/2011/05/windows-phone-7-ui-ux-notes.html">WP7 UI / UX Notes</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/gg406140.aspx">Developer's Guide to Microsoft Prism</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/bb399408.aspx">Programming Guide (LINQ to SQL)</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/138117/">https://habr.com/ru/post/138117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138107/index.html">Postmaster.mail.ru - smart statistics</a></li>
<li><a href="../138111/index.html">Using GDB on the example of MaNGOS</a></li>
<li><a href="../138114/index.html">5 things you need to know if you're participating in a developer competition</a></li>
<li><a href="../138115/index.html">Yes-Credit.ru - a new service for online stores</a></li>
<li><a href="../138116/index.html">The search function of the remote control do it yourself</a></li>
<li><a href="../138118/index.html">Another way to use conditional comments</a></li>
<li><a href="../138122/index.html">Xdebug toolbar for debugging PHP in Opera</a></li>
<li><a href="../138123/index.html">Kiddy.me - your baby's diary</a></li>
<li><a href="../138125/index.html">Soofty. Our Windows app store</a></li>
<li><a href="../138126/index.html">Nikon D800 announced where is the Canon 5D Mark III?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>