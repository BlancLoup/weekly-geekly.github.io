<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>XXE: XML external entity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will explain what is the injection of external XML entities, describe some common examples, explain how to find and use different ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>XXE: XML external entity</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f3b/531/918/f3b531918a09a85fc1df23a7805721b2.svg" alt="image"><br>  In this article, we will explain what is the injection of external XML entities, describe some common examples, explain how to find and use different types of XXE injections, and also generalize how to prevent attacks with their help. <br><a name="habracut"></a><br><h3>  What is the injection of external XML entities? </h3><br>  Injection of external XML entities (also known as XXE) is a web security vulnerability that allows an attacker to interfere with the processing of XML data by the application.  It often allows an attacker to view files in the application server's file system and interact with any server or external systems that the application itself can access. <br><br>  In some situations, an attacker can leverage the XXE attack to compromise the back-end server or other internal infrastructure, using the XXE vulnerability to perform request forgery requests on the server side (SSRF). <br><br><h3>  How do XXE vulnerabilities arise? </h3><br>  Some applications use XML format to transfer data between the browser and the server.  Applications that do this almost always use a standard library or platform API to process XML data on the server.  XXE vulnerabilities arise from the fact that the XML specification contains various potentially dangerous functions, and standard analyzers support these functions even if they are not commonly used by the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      XML external entities are a type of custom XML entity whose specific values ‚Äã‚Äãare loaded from the DTD files in which they are written.  External entities are especially interesting from a security point of view, since they allow the entity to be determined based on the contents of the file path or URL. <br><br><h3>  What types of XXE attacks exist? </h3><br><ul><li>  Using XXE to retrieve files, where an external entity including the contents of the file is defined and returned in the application response. </li><li>  Using XXE to perform SSRF attacks, where the external entity is determined based on the URL of the internal system. </li><li>  Using blind extraction of XXE information over a control channel, where confidential data is transmitted from an application server to a system that is controlled by an intruder. </li><li>  Use XXE blind to return data from error messages when an attacker can cause an error message containing the necessary information. </li><li>  Using XXE to extract files </li></ul><br>  To perform an attack of the XXE-injection type, which extracts an arbitrary file from the server's file system, you must modify the submitted XML in one of two ways: <br><br><ul><li>  Enter (or change) the DOCTYPE element that defines the external entity containing the file path. </li><li>  Change the value of the data in the XML returned in the application response to use a specific external entity. </li></ul><br>  For example, suppose a shopping application checks the amount of product stocks by sending the following XML to the server: <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span>381<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span>      XXE,     XXE    /etc/passwd,    XXE: <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt; ]&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;xxe;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productId</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stockCheck</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This XXE structure defines an external &amp; xxe entity whose value is the contents of the / etc / passwd file, and uses an entity with the value of productId.  This causes the application's response to include the contents of the file: <br><br><pre> <code class="bash hljs">Invalid product ID: root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin ...</code> </pre> <br>  In the case of real XXE vulnerabilities, there will often be a large number of data values ‚Äã‚Äãin the submitted XML, any of which can be used in the application response.  To systematically test XXE vulnerabilities, it will usually be necessary to test each data node in XML separately, using a specific entity and see the status of the response. <br><br>  In addition to extracting sensitive data, another way to use attacks with XXE is to use them to fake requests on the server side (SSRF). <br><br>  This is a potentially serious vulnerability, with which the server application can be used to execute HTTP requests to any URL that the server can access. <br><br>  To use the XXE vulnerability to execute an SSRF attack, you need to define the external XML entity using the URL you want to access and use a specific entity with a data value.  If you can use a specific entity with a data value that is returned in the application response, you can view the response from the URL in the application response and thus get a two-way interaction with the server system.  If not, you can only perform blind SSRF attacks (which can also have critical consequences). <br><br>  In the following example, using XXE, the external entity will cause the server to perform an internal HTTP request to the internal system within the system infrastructure: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"&gt; ]&gt;</span></span></code> </pre> <br><h3>  Using XXE to perform SSRF attacks: </h3><br>  Many types of vulnerabilities XXE blind.  This means that the application does not return the values ‚Äã‚Äãof any specific external entities in its responses, and therefore it is not possible to directly search for files on the server side. <br><br>  XXE blind vulnerabilities can still be discovered and exploited, but more advanced methods are required.  Sometimes you can use external methods to search for vulnerabilities and use them to exfiltrate data.  It can also sometimes cause XML parsing errors that lead to the disclosure of sensitive data in error messages. <br><br><h3>  Finding and exploiting blind vulnerabilities XXE: </h3><br>  The ability to attack with the XXE injection is obvious in many cases, since the normal HTTP traffic of the application includes requests containing data in XML format.  In other cases, the ability to attack is less noticeable.  However, if you look in the right places, you will find an opportunity to attack XXE in queries that do not contain XML. <br><br><h3>  XInclude attacks </h3><br>  Some applications receive the data sent by the client, insert it on the server side into an XML document, and then analyze it.  An example of this is the case where client data is placed in a SOAP backend request, which is then processed by the SOAP backend service. <br><br>  In this case, you cannot execute the classic XXE attack because you do not control the entire XML document and therefore cannot define or change the DOCTYPE element.  However, you can use XInclude instead.  XInclude is part of the XML specification that allows you to create an XML document from nested documents.  You can place an XInclude attack in any data value in an XML document, so an attack can be performed in situations where you control only one data element placed in the XML document on the server side. <br><br>  To execute an XInclude attack, you must reference the XInclude namespace and specify the path to the file you want to involve.  For example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XInclude"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xi:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:///etc/passwd"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Some applications allow users to upload files, which are then processed on the server side.  Some common file formats use XML or contain XML subcomponents.  Examples of XML formats are Office document formats such as DOCX and image formats such as SVG. <br><br>  For example, an application may allow users to upload images and process or check them on the server after downloading.  Even if an application expects to receive a PNG or JPEG format, the image processing library used can support SVG images.  Since the SVG format uses XML, an attacker can send a malicious SVG image and thus be able to attack the XXE vulnerabilities. <br><br><h3>  Using XXE through downloading image files: </h3><br>  Most POST requests use the default content type created by HTML forms, such as application / x-www-form-urlencoded.  Some sites expect to receive requests in this format, but allow other types of content, including XML. <br><br>  For example, if a regular query contains the following: <br><br><pre> <code class="xml hljs">POST /action HTTP/1.0 Content-Type: application/x-www-form-urlencoded Content-Length: 7 foo=bar         : POST /action HTTP/1.0 Content-Type: text/xml Content-Length: 52 <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span>bar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">foo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  If an application accepts queries that contain XML in the body of the message, and parses the content as XML, you can get the ability to attack XXE by simply reformatting the queries to use the XML format. <br><br><h3>  How to find and test XXE vulnerabilities </h3><br>  The overwhelming majority of XXE vulnerabilities can be quickly and safely found using the Burp Suite web vulnerability scanner. <br><br><ul><li>  Manual testing of vulnerabilities of , as a rule, includes: </li><li>  Testing the extraction of files by determining the external entity based on the known operating system file and using this object in the data returned in the application response. </li><li>  Testing XXE blind vulnerabilities by defining an external entity based on the URL of the system you are managing and monitoring interaction with this system.  The Burp Collaborator client is ideal for this purpose. </li><li>  Testing for vulnerable inclusion of non-XML user data into a server-side XML document using an XInclude attack to attempt to retrieve a known operating system file. </li></ul><br><h3>  How to prevent XXE vulnerabilities </h3><br>  Virtually all XXE vulnerabilities arise because the XML parsing library supports potentially dangerous XML functions that the application does not need or is not intended to be used.  The easiest and most effective way to prevent XXE attacks is to disable these features. <br><br>  As a rule, it is enough to disable the resolution of external entities and disable support for XInclude.  This can usually be done using configuration settings or software overriding default behavior.  For more information about disabling unnecessary features, see the XML parsing library or API documentation. <br><br><hr><br>  You can use <a href="https://portswigger.net/web-security/xxe/lab-xxe-via-file-upload">specialized laboratories</a> as a training ground to test your exploitation skills for such vulnerabilities. <br><br><hr><br>  The latest dual-processor configurations of dedicated servers with Intel Scalable 2019 processors are available on <a href="https://dedic.sh/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D454614"><b>DEDIC.SH</b></a> : <br><ul><li>  2x Xeon Silver 4214 - a total of 24 cores </li><li>  2x Xeon Gold 5218 - total 32 cores </li><li>  2x Xeon Gold 6240 - configuration with 36 cores. </li></ul><br>  Server cost with two Xeon Silver 4214 - <a href="https://dedic.sh/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D454614"><b>from 15210 rub / month</b></a> <br>  We are also ready to collect <b>any configuration</b> for you - <b><a href="">write to us</a></b> ! <br><br>  If a large capacity of a dedicated server is not required - <b><a href="https://vds.sh/ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D454614">VDS from 150 rubles / month</a></b> - what you need! </div><p>Source: <a href="https://habr.com/ru/post/454614/">https://habr.com/ru/post/454614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454600/index.html">How we made a safe deal for freelance: give a choice, cut features, compare commissions</a></li>
<li><a href="../454604/index.html">Generate React application with GraphQL backend in minutes</a></li>
<li><a href="../454606/index.html">Features of the inputmode attribute for mobile OS and browsers</a></li>
<li><a href="../454608/index.html">Service Level Agreement: we write SLA for ... others, or conclude an SLA with a carrier</a></li>
<li><a href="../454610/index.html">Content marketing, SEO, tests and polls: 9 tools for promoting a startup abroad</a></li>
<li><a href="../454616/index.html">Using AI to improve the efficiency of knowledge workers</a></li>
<li><a href="../454618/index.html">Productivity Pit: How Slack Hurts Our Workflow</a></li>
<li><a href="../454620/index.html">#NoDeployFriday: helps or hurts?</a></li>
<li><a href="../454622/index.html">Kreisel EVEX 910e: Historical Model - New Life</a></li>
<li><a href="../454626/index.html">DevOops yesterday and today</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>