<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart home, as I sunk to such. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of years ago, when there was a question of finishing a new apartment, a seemingly trivial task arose. 
 Given: 


- Kitchen-studio (kitchen c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart home, as I sunk to such. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/732/4ea/3be/7324ea3be2b124aff523b91632615086.png" align="right"><br>  A couple of years ago, when there was a question of finishing a new apartment, a seemingly trivial task arose. <br>  <b>Given:</b> <br><ul><li>  Kitchen-studio (kitchen combined with a hall / corridor), three points of lighting. </li><li>  It is necessary to control the lighting from two points.  At the entrance to the apartment and the kitchen. </li></ul><br>  <b>Solution options:</b> <br><ul><li>  We buy the so-called walk-through switches, put three pieces in the kitchen, three in the hallway - this is happiness.  It just happened that you need to drive 9 cable wires from the corridor to the kitchen, ugly, there is no place to hide. </li><li>  We buy ready-made solutions for managing one source from several points. <br>  I don‚Äôt remember the exact numbers, but it turned out to be about 10000r for a lighting point + 1000r for each switch, for a total of 36000r.  Toad. </li><li>  Oddly enough, but this idea was expressed by the wife, in general, far from IT: ‚ÄúDo you remember, you <a href="http://habrahabr.ru/company/yandex/blog/81201/">did a traffic light in Yandex</a> ?  Maybe here, too, something you figure it out? ‚Äù <br>  In fact, why not, I thought? </li></ul><br>  But I am not an electronics engineer, I am a programmer, I never programmed controllers, only full-fledged servers.  So the brain must be a server.  And once the server is set up, then controlling three light bulbs is from a cannon on sparrows (even a nuclear charge on flies).  So you can still add functions. <br>  Then Ostap suffered (s), the capital moves to Vasyuki.  Three bulbs with switches turn into a control, monitoring, video surveillance system, etc. <br><a name="habracut"></a><br>  I will not talk about how I chose 1-wire for a long time, they wrote a lot about it before me. <br>  Bribed: <br><ul><li>  Low price </li><li>  Availability </li><li>  Thermal sensors from one chip on parasitic power </li><li>  Ease of installation </li><li>  Sufficient speed (compared to X10) </li><li>  Open standard </li></ul><br>  I‚Äôll say right away that I wasn‚Äôt going to solder the chips myself, I wanted to buy ready-made and adapt for myself. <br>  But at that time I worked together with <a href="http://geektimes.ru/users/barsmonster/" class="user_link">BarsMonster</a> and he ‚Äúput me on the <a href="http://geektimes.ru/users/barsmonster/" class="user_link">right</a> path‚Äù. <br><br>  When I needed to control 8 sources in one place (a ceiling with LED lights), I could buy four controllers (each with two points could control) 700 rubles already suffocating 700 rubles. <br>  And he suggested: "Let me make you a scheme, because everything is simple there."  ‚ÄúCome on,‚Äù I said. <br><br>  Somewhere in a week I received a fee and a set of components (I decided to solder myself, it was interesting).  I did, I liked it.  Then he himself spread the next board, <a href="http://geektimes.ru/users/barsmonster/" class="user_link">BarsMonster</a> only <a href="http://geektimes.ru/users/barsmonster/" class="user_link">erased</a> it, and then he mastered the process of manufacturing printed circuit boards at home and made the following boards himself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Computer layout -&gt; laser printer -&gt; iron -&gt; ferric chloride -&gt; soldering iron.  Voila! <br><br>  The first schemes were similar to those purchased, on a DS2413 chip, providing control of two sources.  But then I almost completely switched to DS2408, which gives eight channels.  But how to use them (to control or read the sensor) was decided in each case.  And of course everyone‚Äôs favorite DS18B20 thermometer. <br><br>  At the moment I have used: <br><ul><li>  Ten DS18B20 </li><li>  Four boards on DS2413 </li><li>  Five boards on DS2408 </li><li>  One purchase fee for humidity and light control with 1-wire interface </li></ul><br><br>  With the <b>DS18B20,</b> everything is quite simple, I connected two legs to the bus and forgot. <br><img src="https://habrastorage.org/getpro/habr/post_images/79f/224/371/79f2243717baeec7a9b3b48b635eb389.jpg" alt="image"><br>  Although, then it turned out the pitfalls.  On the parasitic power supply, the sensor blocks the entire bus for the time of temperature measurement, and the more accurate the measurement, the longer (from 0.3 to 1.5 seconds), which turned out to be critical for polling the sensors responsible for the switches.  So, if I did everything from scratch, I would either make power boards for them, or even throw a separate bus at all; there‚Äôs no point in asking them themselves more often than once every few minutes. <br><br>  Why so much?  But because it is easy to put;) <br><br><ul><li>  Temperature monitoring in each room, kitchen, bathroom and loggia </li><li>  Two sensors on the street (one near the house, but it can heat up from the house, the second on the spoke a meter away from the house, it can heat up from the sun, I take the final temperature as the minimum) </li><li>  Monitoring floor temperature </li><li>  Monitoring the temperature of the floor heating board (the floor power is about 700W and the board is significantly heated) </li><li>  Monitoring the server temperature (server of the smart home control, video surveillance, and backup server along the way) bricked up </li><li>  Monitoring the temperature of the shield with routers (closed space, a lot of warming electronics) </li></ul><br><br>  <b>DS2413 boards</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/815/396/16d/81539616de1135a44a67eb214eb2719c.jpg" alt="image"><br>  I bought the first three boards, then I made two: <br><ul><li>  Corridor lighting (two light sources) </li><li>  Temporary lighting in the future bedroom (repair is not finished) </li><li>  Manage warm floors (had to put a radiator on the triac) </li><li>  Ventilation shutter control </li><li>  Control of ventilation pump and lighting on the loggia </li></ul><br><br>  <b>DS2408 Boards</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/d90/472/2a2/d904722a2efe9d477789b91090963902.jpg" alt="image"><br>  The first DS2408 board was used to control all the lighting in the kitchen, since the house is smart, it is no longer interesting to be limited to three sources of lighting, as originally planned.  Eight channels?  Let there be eight sources.  At the moment, four and four are connected in the project (repair is not finished yet). <br><br>  The second board was entirely for reading sensors.  Namely, opening sensors on all windows and the door to the loggia.  All the windows face one side of the house, the board is marked out on the loggias, and on the outer wall stretched wires to all the windows.  Moreover, at the beginning I thought to pull the wire to each one separately, and then I found a more elegant solution.  Twisted pair, from which one pair is gradually moving away to the sensor. <br><br>  The third board is also entirely for sensors, but on the front door: <br><ul><li>  Motion sensor in the common corridor (to turn on the video camera and record all passing by). </li><li>  Middle motion sensor that responds only if you come close to the door.  (Why do we need a doorbell? You can understand that someone has come.) </li><li>  Sensor on the front door. </li><li>  Separate sensor on the heck and each of the locks. </li></ul><br><br>  As opening sensors, I used unmarked Soviet reed switches dug in the bins of my father-in-law.  Plus Neodymium magnets 1x10 mm <br><img src="https://habrastorage.org/getpro/habr/post_images/9c7/3d3/4cf/9c73d34cff33724d81ba18574c795f45.jpg" alt="image"><br><br>  The sensors on the locks are similar, only I placed the reed switches themselves inside the door frame, and glued the magnets to the bolts of the locks. <br><br>  Thus, almost all sensors turned out to be hidden. <br><br>  In the following two boards for DS2408, for the nursery and the bathroom, I made two channels for controlling the lighting, the rest for the sensors: <br><ul><li>  Main and peripheral lighting </li><li>  Switches (at the beginning it seemed that it was not always convenient for children to click on the touch panel) </li><li>  Motion Sensor </li><li>  Door sensor </li><li>  Two backup channels </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/31a/fc5/827/31afc58272e0bca2d5f9011deb84c40a.jpg" alt="image"><br>  In the backup channels, in the future, I want a story in the bathroom leakage sensors, and in the children's smoke sensor. <br><br>  By making the latest boards on the DS2408, I, trying to save space, made one mistake that complicates installation and maintenance.  I brought to the terminals one contact 5V, 12V, GND.  I had to connect several wires to one (for example, the reed switch is connected between 5V and the input contact, the same with the motion sensor, but it still needs 12V and GND), which is inconvenient and unreliable. <br><br>  With the iron finished, on the software part, I will stop in more detail the next time, but looking ahead, it turned out like this: <br>  Web: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/cb8/985/7e5cb89858f918674a91455c226ab811.png" alt="image"><br>  Touch screen: <br><img src="https://habrastorage.org/getpro/habr/post_images/3e7/d42/45c/3e7d4245c7371aa20ca5ea32c17b0b20.png" alt="image"><br><br>  UP: <br>  Continued here <br>  <a href="http://habrahabr.ru/post/167797/">Smart home, as I sunk to such.</a>  <a href="http://habrahabr.ru/post/167797/">Part 2</a> <br>  <a href="http://habrahabr.ru/post/198842/">Smart home, as I sunk to such.</a>  <a href="http://habrahabr.ru/post/198842/">Part 3</a> </div><p>Source: <a href="https://habr.com/ru/post/158911/">https://habr.com/ru/post/158911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158897/index.html">Should I use freemium model? Part 2</a></li>
<li><a href="../158903/index.html">Support the Motorola petition for opening the bootloader</a></li>
<li><a href="../158905/index.html">Centralized exception handling in Node.JS. Part 2</a></li>
<li><a href="../158907/index.html">Backups in my life</a></li>
<li><a href="../158909/index.html">Ebay Ukraine. About Customs and Shipping - 2012</a></li>
<li><a href="../158913/index.html">Mass hijacking accounts from EA Origin</a></li>
<li><a href="../158915/index.html">Fronteers 2012 - the best client development conference, part 2</a></li>
<li><a href="../158917/index.html">CSS animation on a real project</a></li>
<li><a href="../158919/index.html">Results Samsung Smart App Challenge 2012</a></li>
<li><a href="../158921/index.html">Wordpress.com started accepting bitcoins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>