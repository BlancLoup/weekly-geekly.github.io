<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>4. Metaprogramming patterns. 19 Kyu. Salvation of drowning business of the hands of drowning people</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose that you have a library method that sometimes throws operations. 
 This is a library method in the sense that you do not want to touch the fil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>4. Metaprogramming patterns. 19 Kyu. Salvation of drowning business of the hands of drowning people</h1><div class="post__text post__text-html js-mediator-article"> Suppose that you have a library method that sometimes throws operations. <br>  This is a library method in the sense that you do not want to touch the file where it is defined, since this file, for example, refers to a library that is regularly updated, and your changes after each update will be lost if you do not specifically take care of their preservation. <br>  Such methods are usually changed in your own code - in dynamic languages ‚Äã‚Äãyou can directly in your code rewrite the selected method of the selected class. <a name="habracut"></a>  For example: <br><br> <code><font><font color="#a020f0">require</font> <font color="#6a5acd">'</font> <font color="#ff00ff">net/http</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> <font color="#a020f0">module</font> <font color="#2e8b57"><b>Net</b></font> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>HTTP</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">get</font> (*args)&lt;br&gt; <br> <font color="#0000ff">#      </font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br></font></code> <br>  This technique is called <a href="http://en.wikipedia.org/wiki/Monkey_patch">monkey patching</a> .  The question is, where are the monkeys?  They have nothing to do with it.  Much closer to the cause of the gorilla.  But they are also not to blame.  And the guerrillas are to blame for everything!  Initially, this term was called ‚Äúguerrilla patch‚Äù, the English term was very similar in sound to the ‚Äúgorilla patch‚Äù, well, and then the booze went and it turned into a ‚Äúmonkey patch‚Äù (the programmers began to be offended at each other, ‚Äúthe monkey "Less offensive than the" gorilla ", that's all agreed). <br><br><h4>  On the interaction of guerrilla groups </h4><br>  What do the partisans do?  They are in secret, without long diplomatic negotiations, preliminary threats, agreements on the opening and closing of the humanitarian corridor, without agreements on the rules of warfare and other formalities begin to act. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There can be several guerrilla groups, they often know or guess about the existence of other guerrilla groups, but they do not have a single plan, and, in principle, one group can decide to rob a train with armaments, and the second one can decide to blow it up.  The consistency here will be important, but in principle, the global goal needed by the partisans will be achieved anyway.  It is unpleasant if the train explodes during the robbery, and their own will die. <br>  In programming single-threaded applications, simultaneity is absent as a phenomenon, especially when it comes to class initialization - it is customary to create threads after the necessary <code>require</code> and classes are created dynamically created / patched.  How to deal with <code>require</code> is a separate complex question ( <a href="http://redmine.ruby-lang.org/issues/show/920">1</a> , <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/20802">2</a> ).  It is not possible to lock the <code>require</code> (that is, not to give control to other threads until the <code>require</code> execution ends), since a <a href="http://en.wikipedia.org/wiki/Deadlock">dead lock</a> may occur. <br><br>  But programmers are still not partisans.  They do not rob enemy trains and do not blow up, but create and improve.  So you can hope for the best.  Gradually you get into the culture of partisan patches ‚Äî partisans, but do it in such a way that the semantics and signature of methods do not change, otherwise it will crumble. <br><br><h4>  Examples in the studio! </h4><br>  So, we can take any method of any class and override it.  It is said that classes in dynamic languages ‚Äã‚Äãare open. <br>  Oh, what kind of tricks you can pate using this openness: <br> <code><font><font color="#a020f0">class</font> <font color="#2e8b57"><b>Fixnum</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">*</font> (x)&lt;br&gt; <br> <font color="#ff00ff">42</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> puts <font color="#ff00ff">5</font> * <font color="#ff00ff">5</font> &lt;br&gt; <br> puts <font color="#ff00ff">5</font> * <font color="#ff00ff">14</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>Fixnum</b></font> &lt;br&gt; <br> <font color="#a020f0">alias</font> <font color="#008080">orig_div</font> <font color="#008080">/</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">/</font> (x)&lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">-:  - </font> <font color="#6a5acd">#{</font> <font color="#ff00ff">self</font> <font color="#6a5acd">}</font> <font color="#ff00ff"></font> <font color="#6a5acd">#{</font> x <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#ff00ff">self</font> .orig_div(x)     &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> puts <font color="#ff00ff">54</font> / <font color="#ff00ff">12</font> &lt;br&gt; <br> puts <font color="#ff00ff">13</font> / <font color="#ff00ff">0</font> <br></font></code> <br>  The last example uses the <code>alias</code> <i>language</i> construct, which stores the function body under a different name.  It is more correct to think about the <code>alias</code> operation as about the operation of copying the method body and assigning a new name to it.  Use <code>alias</code> before redefining the method in order to gain access to the previous unpatched version of the method by the selected new name. <br><br>  This approach is actively used in practice.  For example, you can write code like this: <br> <code><font><font color="#a020f0">require</font> <font color="#6a5acd">'</font> <font color="#ff00ff">net/http</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>HTTP</b></font> &lt;br&gt; <br> <font color="#a020f0">alias</font> <font color="#008080">get_orig</font> <font color="#008080">get</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">restore_connection</font> &lt;br&gt; <br> <font color="#804040"><b>begin</b></font> &lt;br&gt; <br> do_start&lt;br&gt; <br> <font color="#ff00ff">true</font> &lt;br&gt; <br> <font color="#804040"><b>rescue</b></font> &lt;br&gt; <br> <font color="#ff00ff">false</font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">get</font> (*args)&lt;br&gt; <br> attempts = <font color="#ff00ff">0</font> &lt;br&gt; <br> <font color="#804040"><b>begin</b></font> &lt;br&gt; <br> get_orig(*args, &amp;block)&lt;br&gt; <br> <font color="#804040"><b>rescue</b></font> <font color="#2e8b57"><b>Errno</b></font> :: <font color="#2e8b57"><b>ECONNABORTED</b></font> =&gt; e&lt;br&gt; <br> <font color="#804040"><b>if</b></font> (attempts += <font color="#ff00ff">1</font> ) &lt; <font color="#ff00ff">3</font> &lt;br&gt; <br> restore_connection&lt;br&gt; <br> <font color="#804040"><b>retry</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>raise</b></font> e&lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> <br></font></code> <br>  This code may seem like a breakthrough to someone, but it does not satisfy me.  I want to write like this: <br> <code><font>&lt;br&gt; <br> <font color="#a020f0">require</font> <font color="#6a5acd">'</font> <font color="#ff00ff">net/http</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>HTTP</b></font> &lt;br&gt; <br> make_rescued <font color="#ff00ff">:get</font> ,&lt;br&gt; <br> <font color="#ff00ff">:rescue</font> =&gt; [ <font color="#2e8b57"><b>Errno</b></font> :: <font color="#2e8b57"><b>ECONNABORTED</b></font> , <font color="#2e8b57"><b>Errno</b></font> :: <font color="#2e8b57"><b>ECONNRESET</b></font> , <font color="#2e8b57"><b>EOFError</b></font> , <font color="#2e8b57"><b>Timeout</b></font> :: <font color="#2e8b57"><b>Error</b></font> ],&lt;br&gt; <br> <font color="#ff00ff">:retry_attempts</font> =&gt; <font color="#ff00ff">3</font> ,&lt;br&gt; <br> <font color="#ff00ff">:on_success</font> =&gt; <font color="#804040"><b>lambda</b></font> {| <font color="#008080">obj</font> , <font color="#008080">args</font> , <font color="#008080">res</font> | puts <font color="#6a5acd">"</font> <font color="#ff00ff">We did it!:</font> <font color="#6a5acd">#{</font> args.inspect <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> },&lt;br&gt; <br> <font color="#ff00ff">:sleep_before_retry</font> =&gt; <font color="#ff00ff">1</font> ,&lt;br&gt; <br> <font color="#ff00ff">:ensure</font> =&gt; <font color="#804040"><b>lambda</b></font> {| <font color="#008080">obj</font> , <font color="#008080">args</font> | puts <font color="#6a5acd">"</font> <font color="#ff00ff">Finishing :</font> <font color="#6a5acd">#{</font> args.inspect <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> },&lt;br&gt; <br> <font color="#ff00ff">:timeout</font> =&gt; <font color="#ff00ff">3</font> ,&lt;br&gt; <br> <font color="#ff00ff">:retry_if</font> =&gt; <font color="#804040"><b>lambda</b></font> <font color="#804040"><b>do</b></font> | <font color="#008080">obj</font> , <font color="#008080">args</font> , <font color="#008080">e</font> , <font color="#008080">attempt</font> |&lt;br&gt; <br> obj.instance_eval <font color="#804040"><b>do</b></font> &lt;br&gt; <br> <font color="#804040"><b>case</b></font> e&lt;br&gt; <br> <font color="#804040"><b>when</b></font> <font color="#2e8b57"><b>Errno</b></font> :: <font color="#2e8b57"><b>ECONNABORTED</b></font> , <font color="#2e8b57"><b>Errno</b></font> :: <font color="#2e8b57"><b>ECONNRESET</b></font> &lt;br&gt; <br> <font color="#0000ff"># !  !</font> &lt;br&gt; <br> restore_connection&lt;br&gt; <br> <font color="#804040"><b>when</b></font> <font color="#2e8b57"><b>EOFError</b></font> , <font color="#2e8b57"><b>Timeout</b></font> :: <font color="#2e8b57"><b>Error</b></font> &lt;br&gt; <br> <font color="#0000ff">#   ?     </font> &lt;br&gt; <br> <font color="#ff00ff">true</font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br></font></code> <br>  Making methods more tolerant of exceptional situations is the most important, often arising task.  The code dedicated to handling exceptional situations gradually increases its share, and I dare say that in heuristic programming, in web programming and, in general, in modern programming, it already amounts to 30% or more and is an essential component of business logic.  And since this is important, why not write the general-purpose method <code>make_rescued</code> , which takes into account various options and solves the problem of salvation in full?  It's time to make a new pattern! <br><br>  Yes, Ruby metaprogramming patterns are often represented as modifying methods.  Other typical patterns are impurities, impurity use techniques themselves (extend &amp; include &amp; included), and <code>method_missing</code> method.  All this we will discuss in the following topics. <br><br>  <b>Approximation 1. We consider options: rescue,: retry_attempts</b> <br> <code><font><font color="#a020f0">module</font> <font color="#2e8b57"><b>MakeRescued</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">extract_options</font> (args)&lt;br&gt; <br> args.pop <font color="#804040"><b>if</b></font> args.last.is_a?( <font color="#2e8b57"><b>Hash</b></font> )&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">alias_method</font> (a, b)&lt;br&gt; <br> <font color="#804040"><b>class_eval</b></font> <font color="#6a5acd">"</font> <font color="#ff00ff">alias</font> <font color="#6a5acd">#{</font> a <font color="#6a5acd">}</font> <font color="#ff00ff">&nbsp;</font> <font color="#6a5acd">#{</font> b <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">make_rescued</font> (*methods)&lt;br&gt; <br> options = extract_options(methods)&lt;br&gt; <br> exceptions = options[ <font color="#ff00ff">:rescue</font> ] || [ <font color="#2e8b57"><b>Exception</b></font> ]&lt;br&gt; <br> methods.each <font color="#804040"><b>do</b></font> | <font color="#008080">method</font> |&lt;br&gt; <br> method_without_rescue = <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> method <font color="#6a5acd">}</font> <font color="#ff00ff">_without_rescue</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> alias_method  method_without_rescue, method&lt;br&gt; <br> define_method(method) <font color="#804040"><b>do</b></font> |* <font color="#008080">args</font> |&lt;br&gt; <br> retry_attempts = <font color="#ff00ff">0</font> &lt;br&gt; <br> <font color="#804040"><b>begin</b></font> &lt;br&gt; <br> send(method_without_rescue, *args)&lt;br&gt; <br> <font color="#804040"><b>rescue</b></font> <font color="#2e8b57"><b>Exception</b></font> =&gt; e&lt;br&gt; <br> retry_attempts += <font color="#ff00ff">1</font> &lt;br&gt; <br> <font color="#804040"><b>unless</b></font> options[ <font color="#ff00ff">:retry_attempts</font> ] &amp;&amp; retry_attempts &gt; options[ <font color="#ff00ff">:retry_attempts</font> ]&lt;br&gt; <br> <font color="#804040"><b>if</b></font> exceptions.any?{| <font color="#008080">klass</font> | klass===e}&lt;br&gt; <br> <font color="#804040"><b>retry</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>raise</b></font> e&lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br></font></code> <br><br>  <b>Approximation 2. We consider all the proposed options.</b> <br><br> <code><font><font color="#a020f0">require</font> <font color="#6a5acd">'</font> <font color="#ff00ff">timeout</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">module</font> <font color="#2e8b57"><b>MakeRescued</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">extract_options</font> (args)&lt;br&gt; <br> args.last.is_a?( <font color="#2e8b57"><b>Hash</b></font> ) ? args.pop : {}&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">alias_method</font> (a, b)&lt;br&gt; <br> <font color="#804040"><b>class_eval</b></font> <font color="#6a5acd">"</font> <font color="#ff00ff">alias</font> <font color="#6a5acd">#{</font> a <font color="#6a5acd">}</font> <font color="#ff00ff">&nbsp;</font> <font color="#6a5acd">#{</font> b <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">make_rescued</font> (*methods)&lt;br&gt; <br> options = extract_options(methods)&lt;br&gt; <br> exceptions = options[ <font color="#ff00ff">:rescue</font> ] || [ <font color="#2e8b57"><b>Exception</b></font> ]&lt;br&gt; <br> methods.each <font color="#804040"><b>do</b></font> | <font color="#008080">method</font> |&lt;br&gt; <br> method_without_rescue = <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> method <font color="#6a5acd">}</font> <font color="#ff00ff">_without_rescue</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> alias_method  method_without_rescue, method&lt;br&gt; <br> define_method(method) <font color="#804040"><b>do</b></font> |* <font color="#008080">args</font> |&lt;br&gt; <br> retry_attempts = <font color="#ff00ff">0</font> &lt;br&gt; <br> <font color="#804040"><b>begin</b></font> &lt;br&gt; <br> res = <font color="#ff00ff">nil</font> &lt;br&gt; <br> res = <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:timeout</font> ]&lt;br&gt; <br> <font color="#2e8b57"><b>Timeout</b></font> ::timeout( options[ <font color="#ff00ff">:timeout</font> ] ) <font color="#804040"><b>do</b></font> &lt;br&gt; <br> send(method_without_rescue, *args)&lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>else</b></font> &lt;br&gt; <br> send(method_without_rescue, *args)&lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> options[ <font color="#ff00ff">:on_success</font> ][ <font color="#ff00ff">self</font> ,args,res] <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:on_success</font> ]&lt;br&gt; <br> res&lt;br&gt; <br> <font color="#804040"><b>rescue</b></font> <font color="#2e8b57"><b>Exception</b></font> =&gt; e&lt;br&gt; <br> retry_attempts += <font color="#ff00ff">1</font> &lt;br&gt; <br> <font color="#804040"><b>unless</b></font> options[ <font color="#ff00ff">:retry_attempts</font> ] &amp;&amp; retry_attempts &gt; options[ <font color="#ff00ff">:retry_attempts</font> ]&lt;br&gt; <br> <font color="#804040"><b>if</b></font> exceptions.any?{| <font color="#008080">klass</font> | klass===e}&lt;br&gt; <br> <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:retry_if</font> ] &amp;&amp; options[ <font color="#ff00ff">:retry_if</font> ][ <font color="#ff00ff">self</font> ,args,e,retry_attempts]&lt;br&gt; <br> sleep options[ <font color="#ff00ff">:sleep_before_retry</font> ] <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:sleep_before_retry</font> ]&lt;br&gt; <br> <font color="#804040"><b>retry</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> options[ <font color="#ff00ff">:on_fail</font> ][ <font color="#ff00ff">self</font> ,args,e] <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:on_fail</font> ]&lt;br&gt; <br> <font color="#804040"><b>raise</b></font> e&lt;br&gt; <br> <font color="#804040"><b>ensure</b></font> &lt;br&gt; <br> options[ <font color="#ff00ff">:ensure</font> ][ <font color="#ff00ff">self</font> ,args,res] <font color="#804040"><b>if</b></font> options[ <font color="#ff00ff">:ensure</font> ]&lt;br&gt; <br> res&lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#804040"><b>end</b></font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#2e8b57"><b>Module</b></font> .module_eval { <font color="#a020f0">include</font> <font color="#2e8b57"><b>MakeRescued</b></font> } <br></font></code> <br><br>  This code can be developed further.  For example, add the <code>:default</code> option, which specifies the default value of the method if <code>Exception</code> dropped.  If this option is equal to a block (there is an object of class <code>Proc</code> ), then it means you need to call this block with parameters <code>(self, args)</code> and return the result of the calculation as a result of the method. <br><br>  Other suggestions for improving the <code>make_rescued</code> method <code>make_rescued</code> welcome. <br><br><h4>  Classic: <code>alias_method_chain</code> </h4><br>  This is a classic monkey patching.  She needs to know: <br><ul><li>  <a href="http://weblog.rubyonrails.org/2006/4/26/new-in-rails-module-alias_method_chain">weblog.rubyonrails.org/2006/4/26/new-in-rails-module-alias_method_chain</a> </li><li>  <a href="http://errtheblog.com/posts/48-aliasmethodbling">errtheblog.com/posts/48-aliasmethodbling</a> </li></ul><br>  and critically approach it: <br><ul><li>  <a href="http://blog.behindlogic.com/2007/09/rails-downfall-of-aliasmethodchain.html">blog.behindlogic.com/2007/09/rails-downfall-of-aliasmethodchain.html</a> </li></ul><br><br>  We will talk about the <code>alias_method_chain</code> method.  Now we only note that it would be possible to write this: <br><pre> ...
   def get_with_rescue (* args)
     ...
       get_without_rescue (* args)
     ...
   end

   alais_method_chain: get,: rescue
</pre><br>  where for modules the method is predefined <br> <code><font><font color="#a020f0">def</font> <font color="#008080">alias_method_chain</font> (target, feature)&lt;br&gt; <br> alias_method <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> target <font color="#6a5acd">}</font> <font color="#ff00ff">_without_</font> <font color="#6a5acd">#{</font> feature <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> , target&lt;br&gt; <br> alias_method target, <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> target <font color="#6a5acd">}</font> <font color="#ff00ff">_with_</font> <font color="#6a5acd">#{</font> feature <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br></font></code> <br>  Using the <code>method_with_feature</code> and <code>method_without_feature</code> naming notation allows programmers to understand by the call stack that there is a deepening in the methods patched by the partisans.  When <code>Exception</code> dropped, we see significant method names.  In addition, we have for each feature two methods - with this feature and without it, and sometimes there is a need to call them directly. <br> <code><font><font color="#a020f0">class</font> <font color="#2e8b57"><b>Module</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">alias_method</font> (a, b)&lt;br&gt; <br> <font color="#804040"><b>class_eval</b></font> <font color="#6a5acd">"</font> <font color="#ff00ff">alias</font> <font color="#6a5acd">#{</font> a <font color="#6a5acd">}</font> <font color="#ff00ff">&nbsp;</font> <font color="#6a5acd">#{</font> b <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">alias_method_chain</font> (target, feature)&lt;br&gt; <br> alias_method <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> target <font color="#6a5acd">}</font> <font color="#ff00ff">_without_</font> <font color="#6a5acd">#{</font> feature <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> , target&lt;br&gt; <br> alias_method target, <font color="#6a5acd">"</font> <font color="#6a5acd">#{</font> target <font color="#6a5acd">}</font> <font color="#ff00ff">_with_</font> <font color="#6a5acd">#{</font> feature <font color="#6a5acd">}</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#0000ff">#      : method_without_feature  method_with_feature</font> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>Abc</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello</font> &lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">hello</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#804040"><b>raise</b></font> <font color="#6a5acd">'</font> <font color="#ff00ff">Bang!</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello_with_attention</font> &lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">attention,</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> hello_without_attention&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> alias_method_chain <font color="#ff00ff">:hello</font> , <font color="#ff00ff">:attention</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello_with_name</font> (name)&lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">my darling</font> <font color="#6a5acd">#{</font> name <font color="#6a5acd">}</font> <font color="#ff00ff">,</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> hello_without_name&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> alias_method_chain <font color="#ff00ff">:hello</font> , <font color="#ff00ff">:name</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#2e8b57"><b>Abc</b></font> .new.hello( <font color="#6a5acd">'</font> <font color="#ff00ff">Liza</font> <font color="#6a5acd">'</font> )&lt;br&gt; <br></font></code> <br><pre> greck $ ruby ‚Äã‚Äãmethod_chain_sample_backtrace.rb
 method_chain.rb: 14: in `hello_without_attention ': Bang!  (RuntimeError)
	 from method_chain.rb: 19: in `hello_without_name '
	 from method_chain.rb: 25: in `hello '
	 from method_chain.rb: 30
 my darling Liza,
 attention,
 hello
 greck $ 
</pre><br>  There is another important bonus that is provided by such a technique: different IDEs can quickly throw you onto the right line of the desired method when clicking on a line from the backtrace of the drop-down action, because the methods do have different names, in contrast to the simplified alternative approach, where only <code>method_without_feature</code> methods are <code>method_without_feature</code> , and all definitions define the same method: <br> <code><font>&lt;br&gt; <br> <font color="#0000ff">#  ,      method_without_feature</font> &lt;br&gt; <br> <font color="#a020f0">class</font> <font color="#2e8b57"><b>Abc</b></font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello</font> &lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">hello</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> <font color="#804040"><b>raise</b></font> <font color="#6a5acd">'</font> <font color="#ff00ff">Bang!</font> <font color="#6a5acd">'</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">alias</font> <font color="#008080">hello_without_attention</font> <font color="#008080">hello</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello</font> &lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">attention,</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> hello_without_attention&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br> <font color="#a020f0">alias</font> <font color="#008080">hello_without_name</font> <font color="#008080">hello</font> &lt;br&gt; <br> <font color="#a020f0">def</font> <font color="#008080">hello</font> (name)&lt;br&gt; <br> puts <font color="#6a5acd">"</font> <font color="#ff00ff">my darling</font> <font color="#6a5acd">#{</font> name <font color="#6a5acd">}</font> <font color="#ff00ff">,</font> <font color="#6a5acd">"</font> &lt;br&gt; <br> hello_without_name&lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> <font color="#a020f0">end</font> &lt;br&gt; <br> &lt;br&gt; <br></font> <br></code> <br><br><h4>  Links </h4><br><ul><li>  <a href="http://en.wikipedia.org/wiki/Monkey_patch">en.wikipedia.org/wiki/Monkey_patch</a> </li><li>  <a href="http://greck.habrahabr.ru/blog/49951/">1. Metaprogramming patterns - 25 kyu.</a>  <a href="http://greck.habrahabr.ru/blog/49951/">Eval method</a> </li><li>  <a href="http://greck.habrahabr.ru/blog/50169/">2. Metaprogramming patterns - 22yu.</a>  <a href="http://greck.habrahabr.ru/blog/50169/">Reuse in small - bang!</a> </li><li>  <a href="http://habrahabr.ru/blogs/ruby/50665/">3. Metaprogramming patterns - 20 kyu.</a>  <a href="http://habrahabr.ru/blogs/ruby/50665/">Closures</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/50819/">https://habr.com/ru/post/50819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50812/index.html">Signals and Slots in Qt</a></li>
<li><a href="../50813/index.html">Parking winchester heads on a laptop under FreeBSD</a></li>
<li><a href="../50816/index.html">New light bulb</a></li>
<li><a href="../50817/index.html">New paid service on LovePlanet.ru - "Improving photos."</a></li>
<li><a href="../50818/index.html">Comments Ideas for the site.</a></li>
<li><a href="../50820/index.html">Mono brings C # to iPhone and Wii</a></li>
<li><a href="../50821/index.html">Modernization of the old-style telephone (telephone roulette).</a></li>
<li><a href="../50822/index.html">About attentiveness</a></li>
<li><a href="../50823/index.html">Mouse Control</a></li>
<li><a href="../50828/index.html">FreeBSD 7.1 - i386 -> amd64 migration via SSH only :)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>