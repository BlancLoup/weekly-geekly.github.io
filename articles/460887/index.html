<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Not another programming language. Part 3: Physics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The third and final part of a series of articles about lsFusion (links to the first and second parts) 

 It will focus on the physical model: everythi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Not another programming language. Part 3: Physics</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/4i/rl/y5/4irly5rc9xjxdf1v-zdadc_ijgg.png"><br><br>  The third and final part of a series of articles about lsFusion (links to the <a href="https://habr.com/ru/company/lsfusion/blog/458376/">first</a> and <a href="https://habr.com/ru/company/lsfusion/blog/460141/">second</a> parts) <br><br>  It will focus on the physical model: everything that is not connected with the system‚Äôs functionality, but is associated with its development and performance optimization, when there is too much data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article, like the previous ones, is not very suitable for entertaining reading, but, unlike the others, there will be more technical details and ‚Äúhot‚Äù topics (like typing or metaprogramming), plus this article will give a part of the answers to the question, how is it all works inside. <br><a name="habracut"></a><br>  In this article, we‚Äôll do without a picture (there‚Äôs no stack like this), but we‚Äôll do a table of contents, as requested in previous articles: <br><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Development of large projects</a> <br><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Item Identification</a> <br><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Namespaces</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Explicit typing</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Modularity</a> <br><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Extensions</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Modules</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Metaprogramming</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Integration</a> <br><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Appeal to an external system</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Appeal from an external system</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Appeal to the internal system</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Appeal from the internal system</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Migration</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Internationalization</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Optimize the performance of large data projects</a> <br><ul><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Materialization</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Indices</a> </li><li>  <a href="https://habr.com/ru/company/lsfusion/blog/460887/">Tables</a> </li></ul></li></ul></div></div><br><a name="id"></a><h2>  Item Identification </h2><br>  If the project consists of several small files, then problems with the naming of elements usually do not arise.  All names are in sight, and it's easy enough to make sure they don't overlap.  If the project, on the contrary, consists of many modules developed by a large number of different people, and abstractions in these modules from one domain domain, name conflicts become much more likely.  LsFusion has two mechanisms to solve these problems: <br><br><ul><li>  Namespaces - separation of a name into full and short, and the ability to use only a short name when accessing an element </li><li>  Explicit typing (to be more precise, function overloading) - the ability to name properties (and actions) in the same way, and then, when accessing them, depending on the classes of arguments, automatically determine which property the call is to </li></ul><br><a name="namespace"></a><h3>  Namespaces </h3><br>  Any complex project usually consists of a large number of elements that must be named.  And, if domain domains intersect, very often there is a need to use the same name in different contexts.  For example, we have the name of the class or form Invoice (invoice), and we want to use this name in various function blocks, for example: Purchase (Purchase), Sale (Sale), Return of purchase (PurchaseReturn), Return of sale (SaleReturn).  It is clear that you can call classes / forms PurchaseInvoice, SaleInvoice, and so on.  But, firstly, such names in themselves will be too bulky.  And secondly, in one functional block, calls, as a rule, go to the elements of the same functional block, which means that when developing, for example, the Purchase functional block from a constant repetition of the word Purchase, it will simply ripple in your eyes.  To prevent this from happening, the platform has such a concept as a namespace.  It works as follows: <br><br><ul><li>  every element in the platform is created in some namespace <br></li><li>  if other elements are being accessed during element creation, elements created in the same namespace take precedence <br></li></ul><div class="scrollable-table"><table><tbody><tr><td><code><font color="#a626a4">MODULE</font> PurchaseInvoice; <br> <font color="#a626a4">NAMESPACE</font> Purchase; <br> <font color="#a626a4">CLASS</font> Invoice <font color="#50a14f">' ()'</font> ; <br></code> </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">MODULE</font> SaleInvoice; <br> <font color="#a626a4">NAMESPACE</font> Sale; <br> <font color="#a626a4">CLASS</font> Invoice <font color="#50a14f">' ()'</font> ; <br></code> </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">MODULE</font> PurchaseShipment; <br> <font color="#a626a4">REQUIRE</font> PurchaseInvoice, SaleInvoice; <br> <font color="#a626a4">NAMESPACE</font> Purchase; <br> <font color="#808080"><i>//   Invoice    Purchase.Invoice,   Sale.invoice</i></font> <br> <font color="#808080"><i>//   namespace   Purchase    namespace Purchase </i></font> <br> shipment(Invoice invoice) = <font color="#a626a4">AGGR</font> ShipmentInvoce <font color="#a626a4">WHERE</font> createShipment(invoice); <br></code> </td></tr></tbody></table></div>  Namespaces in the current version of the language are set for the entire module immediately in the module header.  By default, if no namespace is specified, it is created implicitly with a name equal to the module name.  If you need to access an element from a non-priority namespace, you can do this by specifying the full name of the element (for example, Sale.Invoice). <br><br><a name="exptype"></a><h3>  Explicit typing </h3><br>  Namespaces are important, but not the only way to make code shorter and more readable.  In addition to them, when searching for properties (and actions), it is also possible to take into account the classes of arguments passed to them at the input.  For example: <br><div class="scrollable-table"><table><tbody><tr><td> <code>sum = <font color="#a626a4">DATA</font> <font color="#a626a4">NUMERIC</font> [ <font color="#986801">10</font> , <font color="#986801">2</font> ] (OrderDetail); <br> sum = <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> sum(OrderDetail od) <font color="#a626a4">BY</font> order(od); <br> <font color="#808080"><i>//     ,        Order</i></font> <br> <font color="#808080"><i>//             OrderDetail</i></font> <br> <font color="#a626a4">CONSTRAINT</font> sum(Order o) &lt; <font color="#986801">0</font> <font color="#a626a4">MESSAGE</font> <font color="#50a14f">'    '</font> ; <br></code> </td></tr></tbody></table></div>  Here, of course, the question may arise: what will happen if the namespace of the desired property is not a priority, but it is better suited for classes?  In fact, the general search algorithm is quite complicated (its full description is <a href="https://documentation.lsfusion.org/pages/viewpage.action%3FpageId%3D3014689">here</a> ) and there are a lot of such ‚Äúambiguous‚Äù cases, so in case of uncertainty it is recommended to either specify namespaces / classes of the desired property explicitly, or double-check in the IDE (using Go to Declaration - CTRL + B) that the property found is exactly what was meant. <br><br>  Also, it is worth noting that explicit typing in lsFusion is generally not necessary.  Parameter classes can be omitted, and if the platform has enough information to find the desired property, it will do so.  On the other hand, in really complex projects, it is still recommended to set the parameter classes explicitly, not only from the point of view of brevity of the code, but also from the point of view of various additional features, such as: early error diagnosis, smart auto-completion from the IDE and so on.  We had extensive experience working both with implicit typing (the first 5 years) and explicit (remaining time), and I must say that the times of implicit typing are now remembered with a shudder (although it may just ‚Äúwe did not know how to cook it‚Äù). <br><br><a name="moduleness"></a><h2>  Modularity </h2><br>  Modularity is one of the most important properties of the system, allowing to ensure its extensibility, reuse of code, as well as effective interaction of the development team. <br><br>  LsFusion provides modularity with the following two mechanisms: <br><br><ul><li>  Extensions - the ability to expand (change) the elements of the system after they are created. <br></li><li>  Modules - the ability to group some functionality together for its further reuse. <br></li></ul><br><a name="extend"></a><h3>  Extensions </h3><br>  lsFusion supports the ability to extend classes and forms, as well as properties and actions through the polymorphism mechanism described in the first article. <br><div class="scrollable-table"><table><tbody><tr><td> <code>sum = <font color="#a626a4">DATA</font> <font color="#a626a4">NUMERIC</font> [ <font color="#986801">10</font> , <font color="#986801">2</font> ] (OrderDetail); <br> sum = <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> sum(OrderDetail od) <font color="#a626a4">BY</font> order(od); <br> <font color="#808080"><i>//     ,        Order</i></font> <br> <font color="#808080"><i>//             OrderDetail</i></font> <br> <font color="#a626a4">CONSTRAINT</font> sum(Order o) &lt; <font color="#986801">0</font> <font color="#a626a4">MESSAGE</font> <font color="#50a14f">'    '</font> ; <br> <font color="#a626a4">CLASS</font> <font color="#a626a4">ABSTRACT</font> Shape; <br> <font color="#a626a4">CLASS</font> Box : Shape; <br> <br> <font color="#a626a4">CLASS</font> Quadrilateral; <br> <font color="#a626a4">EXTEND</font> <font color="#a626a4">CLASS</font> Box : Quadrilateral; <font color="#808080"><i>//  </i></font> <br> <br> <font color="#a626a4">CLASS</font> ShapeType { <br> point <font color="#50a14f">''</font> , <br> segment <font color="#50a14f">''</font> <br> } <br> <br> <font color="#a626a4">EXTEND</font> <font color="#a626a4">CLASS</font> ShapeType { <font color="#808080"><i>//   </i></font> <br> circle <font color="#50a14f">''</font> <br> } <br> <br> <font color="#a626a4">CLASS</font> ItemGroup; <br> name = <font color="#a626a4">DATA</font> <font color="#a626a4">ISTRING</font> [ <font color="#986801">100</font> ] (ItemGroup); <br> <br> itemGroup = <font color="#a626a4">DATA</font> ItemGroup (Item); <br> <br> <font color="#a626a4">EXTEND</font> <font color="#a626a4">FORM</font> items <br> <font color="#a626a4">PROPERTIES</font> (i) <font color="#a626a4">NEWSESSION</font> <font color="#a626a4">DELETE</font> <font color="#808080"><i>//     </i></font> <br> <br> <font color="#a626a4">OBJECTS</font> g = ItemGroup <font color="#a626a4">BEFORE</font> i <font color="#808080"><i>//        </i></font> <br> <font color="#a626a4">PROPERTIES</font> (g) <font color="#a626a4">READONLY</font> name <br> <font color="#a626a4">FILTERS</font> itemGroup(i) == g <font color="#808080"><i>//         ,       ,    </i></font> <br> ; <br></code> </td></tr></tbody></table></div>  Also, we note that almost all other platform designs (for example, navigator, form design) are extensible by definition, therefore there is no separate extension logic for them. <br><br><a name="module"></a><h3>  Modules </h3><br>  A module is some functionally complete part of a project.  In the current version of lsFusion, a module is a separate file consisting of the header and body of a module.  The title of the module, in turn, consists of: the name of the module, as well as, if necessary, a list of the modules used and the name of the namespace of this module.  The body of the module consists of declarations and / or extensions of system elements: properties, actions, restrictions, forms, metacodes and so on. <br><br>  Usually modules use elements from other modules to declare their own / expand existing elements.  Accordingly, if module B uses elements from module A, then it is necessary to indicate in module B that it depends on A. <br><br>  Based on their dependencies, all modules in the project are arranged in a certain order in which they are initialized (this order plays an important role when using the aforementioned extension mechanism).  It is guaranteed that if module B depends on module A, the initialization of module A will occur earlier than the initialization of module B. Cyclic dependencies between the modules in the project are not allowed. <br><br>  Dependencies between modules are transitive.  That is, if module C depends on module B, and module B depends on module A, then it is considered that module C also depends on module A. <br><br>  Any module always automatically depends on the system module System, regardless of whether it is indicated explicitly or not. <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">MODULE</font> EmployeeExample; <font color="#808080"><i>//   </i></font> <br> <br> <font color="#a626a4">REQUIRE</font> Authentication, Utils; <font color="#808080"><i>//  ,     Employee</i></font> <br> <font color="#a626a4">NAMESPACE</font> Employee; <font color="#808080"><i>//   </i></font> <br> <br> <font color="#a626a4">CLASS</font> Employee <font color="#50a14f">''</font> ; <font color="#808080"><i>//  </i></font> <br> <font color="#a626a4">CLASS</font> Position <font color="#50a14f">''</font> ; <font color="#808080"><i>//    </i></font> <br> <br> employeePosition(employee) = <font color="#a626a4">DATA</font> Position (Employee); <font color="#808080"><i>//  </i></font> <br></code> </td></tr></tbody></table></div><br><a name="meta"></a><h3>  Metaprogramming </h3><br>  Metaprogramming is a type of programming associated with writing program code that generates other program code as a result.  LsFusion uses so-called metacodes for metaprogramming. <br><br>  The metacode consists of: <br><br><ul><li>  metacode name </li><li>  metacode parameters </li><li>  body of a metacode - a code block consisting of declarations and / or extensions of system elements (properties, actions, events, other metacodes, etc.) </li></ul><br>  Accordingly, before starting the main processing of the code, the platform pre-processes it - replaces all uses of metacodes with the bodies of these metacodes.  In this case, all metacode parameters used in identifiers / string literals are replaced by the arguments passed to this metacode: <br><br>  Announcement: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">META</font> addActions(formName) <br> <font color="#a626a4">EXTEND</font> <font color="#a626a4">FORM</font> formName <br> <font color="#a626a4">PROPERTIES</font> () showMessage, closeForm <br> ; <br> <font color="#a626a4">END</font> <br></code> </td></tr></tbody></table></div>  Using: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#4078f2">@addActions</font> (documentForm); <br> <font color="#4078f2">@addActions</font> (orderForm); <br></code> </td></tr></tbody></table></div>  Resulting Code: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">EXTEND</font> <font color="#a626a4">FORM</font> documentForm <br> <font color="#a626a4">PROPERTIES</font> () showMessage, closeForm <br> ; <br> <font color="#a626a4">EXTEND</font> <font color="#a626a4">FORM</font> orderForm <br> <font color="#a626a4">PROPERTIES</font> () showMessage, closeForm <br> ; <br></code> </td></tr></tbody></table></div>  In addition to simply substituting metacode parameters, the platform also allows you to combine these parameters with existing identifiers / string literals (or with each other), for example: <br><br>  Announcement: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">META</font> objectProperties(object, caption) <br> object <font color="#4078f2">##</font> Name <font color="#50a14f">' '</font> <font color="#4078f2">##</font> caption = <font color="#a626a4">DATA</font> <font color="#a626a4">BPSTRING</font> [ <font color="#986801">100</font> ](object); <br> object <font color="#4078f2">##</font> Type <font color="#50a14f">' '</font> <font color="#4078f2">##</font> caption = <font color="#a626a4">DATA</font> Type (object); <br> object <font color="#4078f2">##</font> Value <font color="#50a14f">' '</font> <font color="#4078f2">##</font> caption = <font color="#a626a4">DATA</font> <font color="#a626a4">INTEGER</font> (object); <br> <font color="#a626a4">END</font> <br></code> </td></tr></tbody></table></div>  Using: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#4078f2">@objectProperties</font> (document, <font color="#50a14f">''</font> ); <br></code> </td></tr></tbody></table></div>  Resulting Code: <br><div class="scrollable-table"><table><tbody><tr><td> <code>DocumentName <font color="#50a14f">' '</font> = <font color="#a626a4">DATA</font> <font color="#a626a4">BPSTRING</font> [ <font color="#986801">100</font> ](Document); <br> DocumentType <font color="#50a14f">' '</font> = <font color="#a626a4">DATA</font> Type (Document); <br> DocumentValue <font color="#50a14f">' '</font> = <font color="#a626a4">DATA</font> <font color="#a626a4">INTEGER</font> (Document); <br></code> </td></tr></tbody></table></div>  Metacodes are very similar to macros in C, but, unlike the latter, they do not work at the text level (they cannot, for example, pass keywords in the parameter), but only at the level of identifiers / string literals (this restriction, in particular, allows parsing the metacode body in the IDE). <br><br>  In lsFusion, metacodes solve problems similar to generics in Java (passing classes as parameters) and lambda in FPs (passing functions as parameters), however, they do not do it very beautifully.  But, on the other hand, they do this in a much more general case (that is, for example, with the possibility of combining identifiers, use in any syntactic constructions - forms, designs, navigator, etc.) <br><br>  Note that the "deployment" of metacodes is supported not only in the platform itself, but also in the IDE.  So, in the IDE there is a special mode, Enable meta, which generates the resulting code directly in the sources and thereby allows this generated code to participate in the search for uses, auto-completion, etc.  In this case, if the body of the metacode changes, the IDE automatically updates all uses of this metacode. <br><br><img src="https://habrastorage.org/webt/_x/3p/xo/_x3pxoomnmxrrrxk7qinrjkmca4.gif"><br><br>  Also, metacodes can be used not only for automatic, but also for manual code generation (as templates).  To do this, it‚Äôs enough to write @@ instead of one @ and immediately after the metacode usage string has been completely entered (up to the semicolon), the IDE will replace this metacode usage with the code generated by this metacode: <br><br><img src="https://habrastorage.org/webt/bd/jr/lv/bdjrlvo5a2fkwgyosx07rg56-20.gif"><br><br><a name="integration"></a><h3>  Integration </h3><br>  Integration includes everything related to the interaction of the lsFusion system with other systems.  From the point of view of the direction of this interaction, integration can be divided into: <br><br><ul><li>  Accessing the lsFusion system from another system. </li><li>  Access from lsFusion system to another system. </li></ul><br>  From the point of view of the physical model, integration can be divided into: <br><br><ul><li>  Interaction with systems running in the ‚Äúsame environment‚Äù as the lsFusion system (that is, in the Java Virtual Machine (JVM) of the lsFusion server and / or using the same SQL server as the lsFusion system). </li><li>  Interaction with remote systems via network protocols. </li></ul><br>  Accordingly, the first systems will be called internal, the second - external. <br><br>  Thus, there are four different types of integration in the platform: <br><br><ul><li>  Appeal to an external system </li><li>  Appeal from an external system </li><li>  Appeal to the internal system </li><li>  Appeal from the internal system </li></ul><br><a name="toext"></a><h3>  Appeal to an external system </h3><br>  Access to external systems in lsFusion is in most cases implemented using the special EXTERNAL operator.  This operator executes the given code in the language / in the paradigm of the given external system.  In addition, this operator allows you to transfer objects of primitive types as parameters of such a call, as well as write the results of the call to the specified properties (without parameters). <br><br>  Currently, the platform supports the following types of interactions / external systems: <br><br>  <b>HTTP - Performs an http request from a web server.</b> <br><br>  For this type of interaction, you must specify a query string (URL), which simultaneously determines both the server address and the request that needs to be executed.  Parameters can be transmitted both in the query line (to refer to the parameter, the special character $ and the number of this parameter, starting with 1) are used, and in its body (BODY).  It is assumed that all parameters not used in the query string are passed to BODY.  If there is more than one parameter in BODY, the BODY content type during transmission is set to multipart / mixed, and the parameters are transferred as components of this BODY. <br><br>  When processing parameters of file classes (FILE, PDFFILE, etc.) in BODY, the content type of the parameter is determined depending on the file extension (in accordance with the following <a href="https://github.com/lsfusion/platform/blob/master/api/src/main/resources/MIMETypes.properties">table</a> ).  If the file extension is not in this table, the content type is set to application / &lt;file extension&gt;. <br><br>  If necessary, using the special option (HEADERS), you can set the headers of the executed request.  To do this, specify a property with exactly one parameter of the string class in which the title will be stored, and the value of the string class in which the value of this header will be stored. <br><br>  The result of the http-request is processed in the same way as its parameters, only in the opposite direction: for example, if the content type of the result is either present in the following <a href="https://github.com/lsfusion/platform/blob/master/api/src/main/resources/MIMETypes.properties">table</a> or equal to application / *, then it is considered that the result obtained is a file and should be written to a property with the value FILE .  The headers of the result of the http-request are processed by analogy with the headers of this request itself (with the only difference being that the option is called HEADERSTO, not HEADERS). <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">EXTERNAL</font> <font color="#a626a4">HTTP</font> <font color="#a626a4">GET</font> <font color="#50a14f">'https://www.cs.cmu.edu/~chuck/lennapg/len_std.jpg'</font> <font color="#a626a4">TO</font> exportFile; <br> open(exportFile()); <br> <br> <font color="#a626a4">LOCAL</font> headers = <font color="#a626a4">STRING</font> ( <font color="#a626a4">STRING</font> ); <br> headers( <font color="#50a14f">'Authentication : Bearer'</font> ) &lt;- <font color="#50a14f">'d43ks43ds343dd233'</font> '; <br> <font color="#a626a4">EXTERNAL</font> <font color="#a626a4">HTTP</font> <font color="#50a14f">'http://tryonline.lsfusion.org/exec?action=getExamples'</font> <br> <font color="#a626a4">HEADERS</font> headers <br> <font color="#a626a4">HEADERSTO</font> headers <br> <font color="#a626a4">PARAMS</font> <font color="#a626a4">JSONFILE</font> ( <font color="#50a14f">'\{"mode"=1\}'</font> ) <br> <font color="#a626a4">TO</font> exportFile; <br> <br> <font color="#a626a4">IMPORT</font> <font color="#a626a4">FROM</font> exportFile() <font color="#a626a4">FIELDS</font> () <font color="#a626a4">STRING</font> caption, <font color="#a626a4">STRING</font> code <font color="#a626a4">DO</font> <br> <font color="#a626a4">MESSAGE</font> <font color="#50a14f">'Example : '</font> + caption + <font color="#50a14f">', code : '</font> + code; <br> <font color="#a626a4">FOR</font> v = headers( <font color="#a626a4">STRING</font> s) <font color="#a626a4">DO</font> <br> <font color="#a626a4">MESSAGE</font> <font color="#50a14f">'Result Header is : Key - '</font> + s + <font color="#50a14f">', Value - '</font> + v; <br></code> </td></tr></tbody></table></div>  <b>SQL - executing a SQL server command.</b> <br><br>  For this type of interaction, the connection string and the SQL command (s) to be executed are specified.  Parameters can be passed both in the connection string and in the SQL command.  To access the parameter, the special character $ and the number of this parameter are used (starting from 1). <br><br>  Parameters of file classes (FILE, PDFFILE, etc.) can be used only in the SQL command.  At the same time, if any of the parameters at execution is a TABLE file (TABLEFILE or FILE with the table extension), then this parameter is considered a table in this case too: <br><br><ul><li>  before executing the SQL command, the value of each such parameter is loaded onto the server in a temporary table <br></li><li>  when substituting parameters, it is not the parameter value itself that is substituted, but the name of the created temporary table <br></li></ul><br>  The execution results are: for DML queries - numbers equal to the number of processed records, for SELECT queries - TABLE format files (FILE with the table extension) containing the results of these queries.  The order of these results coincides with the order of execution of the corresponding queries in the SQL command. <br><div class="scrollable-table"><table><tbody><tr><td> <code>externalSQL ()  { <br> <font color="#a626a4">EXPORT</font> <font color="#a626a4">TABLE</font> <font color="#a626a4">FROM</font> bc=barcode(Article a) <font color="#a626a4">WHERE</font> name(a) <font color="#a626a4">LIKE</font> <font color="#50a14f">'%%'</font> ; <font color="#808080"><i>//   -    </i></font> <br> <font color="#a626a4">EXTERNAL</font> <font color="#a626a4">SQL</font> <font color="#50a14f">'jdbc:mysql://$1/test?user=root&amp;password='</font> <br> <font color="#a626a4">EXEC</font> <font color="#50a14f">'select price AS pc, articles.barcode AS brc from $2 x JOIN articles ON x.bc=articles.barcode'</font> <br> <font color="#a626a4">PARAMS</font> <font color="#50a14f">'localhost'</font> ,exportFile() <br> <font color="#a626a4">TO</font> exportFile; <font color="#808080"><i>//     -</i></font> <br> <br> <font color="#808080"><i>//      -  </i></font> <br> <font color="#a626a4">LOCAL</font> price = <font color="#a626a4">INTEGER</font> ( <font color="#a626a4">INTEGER</font> ); <br> <font color="#a626a4">LOCAL</font> barcode = <font color="#a626a4">STRING</font> [ <font color="#986801">30</font> ] ( <font color="#a626a4">INTEGER</font> ); <br> <font color="#a626a4">IMPORT</font> <font color="#a626a4">FROM</font> exportFile() <font color="#a626a4">TO</font> price=pc,barcode=brc; <br> <font color="#a626a4">FOR</font> barcode(Article a) = barcode( <font color="#a626a4">INTEGER</font> i) <font color="#a626a4">DO</font> <br> price(a) &lt;- price(i); <br> } <br></code> </td></tr></tbody></table></div>  <b>LSF - call the action of another lsFusion server.</b> <br><br>  For this type of interaction, the connection string to the lsFusion server (or its web server, if any) is set, the action to be performed, as well as a list of properties (without parameters), in the values ‚Äã‚Äãof which the results of the call will be written.  The parameters to be transferred must coincide in number and class with the parameters of the action being performed. <br><br>  The method of setting the action in this type of interaction is fully consistent with the method of setting the action when accessing from an external system (about this type of access in the next section). <br><div class="scrollable-table"><table><tbody><tr><td> <code>externalLSF()  { <br> <font color="#a626a4">EXTERNAL</font> <font color="#a626a4">LSF</font> <font color="#50a14f">'http://localhost:7651'</font> <font color="#a626a4">EXEC</font> <font color="#50a14f">'System.testAction[]'</font> ; <br> } <br></code> </td></tr></tbody></table></div>  By default, this type of interaction is implemented using the HTTP protocol using the appropriate interfaces for accessing to / from an external system. <br><br>  In the event that you need to access the system using a protocol different from the above, you can always do this by creating an action in Java and implementing this call there (but more on that later in the section ‚ÄúAccessing Internal Systems‚Äù) <br><br><a name="fromext"></a><h3>  Appeal from an external system </h3><br>  The platform allows external systems to access the system developed on lsFusion using the HTTP network protocol.  The interface of this interaction is to call some action with the given parameters and, if necessary, return the values ‚Äã‚Äãof some properties (without parameters) as results.  It is assumed that all objects of parameters and results are objects of primitive types. <br><br>  The called action can be set in one of three ways: <br><br><ul><li>  / exec? action = &lt;action name&gt; - sets the name of the called action. </li><li>  / eval? script = &lt;code&gt; - sets the code in lsFusion.  It is assumed that in this code there is a declaration of an action with the name run, it is this action that will be called.  If the script parameter is not specified, it is assumed that the code is passed as the first BODY parameter. </li><li>  / eval / action? script = &lt;action code&gt; - sets the action code in lsFusion.  To access the parameters, you can use the special character $ and the parameter number (starting from 1). </li></ul><br>  In the second and third cases, if the script parameter is not specified, then it is assumed that the code is passed by the first BODY parameter. <br><br>  The processing of parameters and results is symmetric to accessing external systems using the HTTP protocol (with the only difference being that the parameters are processed as results, and, on the contrary, the results are processed as parameters), so we will not repeat ourselves much. <br><br>  For example, if we have an action: <br><div class="scrollable-table"><table><tbody><tr><td> <code>importOrder( <font color="#a626a4">INTEGER</font> no, <font color="#a626a4">DATE</font> date, <font color="#a626a4">FILE</font> detail) { <br> <font color="#a626a4">NEW</font> o = FOrder { <br> no(o) &lt;- no; <br> date(o) &lt;- date; <br> <font color="#a626a4">LOCAL</font> detailId = <font color="#a626a4">INTEGER</font> ( <font color="#a626a4">INTEGER</font> ); <br> <font color="#a626a4">LOCAL</font> detailQuantity = <font color="#a626a4">INTEGER</font> ( <font color="#a626a4">INTEGER</font> ); <br> <font color="#a626a4">IMPORT</font> <font color="#a626a4">FROM</font> detail <font color="#a626a4">TO</font> detailId, detailQuantity; <br> <font color="#a626a4">FOR</font> imported( <font color="#a626a4">INTEGER</font> i) <font color="#a626a4">DO</font> { <br> <font color="#a626a4">NEW</font> od = FOrderDetail { <br> id(od) &lt;- detailId(i); <br> quantity(od) &lt;- detailQuantity(i); <br> price(od) &lt;- <font color="#986801">5</font> ; <br> order(od) &lt;- o; <br> } <br> } <br> <font color="#a626a4">APPLY</font> ; <br> <font color="#a626a4">EXPORT</font> <font color="#a626a4">JSON</font> <font color="#a626a4">FROM</font> price = price(FOrderDetail od), id = id(od) <font color="#a626a4">WHERE</font> order(od) = o; <br> <font color="#a626a4">EXPORT</font> <font color="#a626a4">FROM</font> orderPrice(o), exportFile(); <br> } <br> } <br></code> </td></tr></tbody></table></div>  Then you can access it using a POST request which: <br><ul><li>  URL - http: // server_address / exec? Action = importOrder &amp; p = 123 &amp; p = 2019-01-01 </li><li>  BODY - json file with query strings </li></ul><br><div class="spoiler">  <b class="spoiler_title">Python call example</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests_toolbelt.multipart <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> decoder lsfCode = (<span class="hljs-string"><span class="hljs-string">"run(INTEGER no, DATE date, FILE detail) {\n"</span></span> <span class="hljs-string"><span class="hljs-string">" NEW o = FOrder {\n"</span></span> <span class="hljs-string"><span class="hljs-string">" no(o) &lt;- no;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" date(o) &lt;- date;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" LOCAL detailId = INTEGER (INTEGER);\n"</span></span> <span class="hljs-string"><span class="hljs-string">" LOCAL detailQuantity = INTEGER (INTEGER);\n"</span></span> <span class="hljs-string"><span class="hljs-string">" IMPORT JSON FROM detail TO detailId, detailQuantity;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" FOR imported(INTEGER i) DO {\n"</span></span> <span class="hljs-string"><span class="hljs-string">" NEW od = FOrderDetail {\n"</span></span> <span class="hljs-string"><span class="hljs-string">" id(od) &lt;- detailId(i);\n"</span></span> <span class="hljs-string"><span class="hljs-string">" quantity(od) &lt;- detailQuantity(i);\n"</span></span> <span class="hljs-string"><span class="hljs-string">" price(od) &lt;- 5;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" order(od) &lt;- o;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> <span class="hljs-string"><span class="hljs-string">" APPLY;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" EXPORT JSON FROM price = price(FOrderDetail od), id = id(od) WHERE order(od) == o;\n"</span></span> <span class="hljs-string"><span class="hljs-string">" EXPORT FROM orderPrice(o), exportFile();\n"</span></span> <span class="hljs-string"><span class="hljs-string">" }\n"</span></span> <span class="hljs-string"><span class="hljs-string">"}"</span></span>) order_no = <span class="hljs-number"><span class="hljs-number">354</span></span> order_date = <span class="hljs-string"><span class="hljs-string">'10.10.2017'</span></span> order_details = [dict(id=<span class="hljs-number"><span class="hljs-number">1</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">10</span></span>), dict(id=<span class="hljs-number"><span class="hljs-number">2</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">15</span></span>), dict(id=<span class="hljs-number"><span class="hljs-number">5</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">4</span></span>), dict(id=<span class="hljs-number"><span class="hljs-number">10</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">18</span></span>), dict(id=<span class="hljs-number"><span class="hljs-number">11</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">1</span></span>), dict(id=<span class="hljs-number"><span class="hljs-number">12</span></span>, quantity=<span class="hljs-number"><span class="hljs-number">3</span></span>)] order_json = json.dumps(order_details) url = <span class="hljs-string"><span class="hljs-string">'http://localhost:7651/eval'</span></span> payload = {<span class="hljs-string"><span class="hljs-string">'script'</span></span>: lsfCode, <span class="hljs-string"><span class="hljs-string">'no'</span></span>: str(order_no), <span class="hljs-string"><span class="hljs-string">'date'</span></span>: order_date, <span class="hljs-string"><span class="hljs-string">'detail'</span></span>: (<span class="hljs-string"><span class="hljs-string">'order.json'</span></span>, order_json, <span class="hljs-string"><span class="hljs-string">'text/json'</span></span>)} response = requests.post(url, files=payload) multipart_data = decoder.MultipartDecoder.from_response(response) sum_part, json_part = multipart_data.parts sum = int(sum_part.text) data = json.loads(json_part.text) <span class="hljs-comment"><span class="hljs-comment">############################################################## print(sum) for item in data: print('{0:3}: price {1}'.format(int(item['id']), int(item['price']))) ############################################################## # 205 # 4: price 5 # 18: price 5 # 3: price 5 # 1: price 5 # 10: price 5 # 15: price 5</span></span></code> </pre></div></div><br><a name="toint"></a><h3>  Appeal to the internal system </h3><br>  There are two types of internal interaction: <br><br>  <b>Java interoperability</b> <br><br>  This type of interaction allows you to call Java code inside the JVM lsFusion server.  To do this, you must: <br><br><ul><li>  ensure that the compiled Java class is available in the classpath of the application server.  It is also necessary that this class inherit lsfusion.server.physics.dev.integration.internal.to.InternalAction. <br><div class="spoiler">  <b class="spoiler_title">Java class example</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.data.sql.exception.SQLHandledException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.language.ScriptingErrorLog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.language.ScriptingLogicsModule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.action.controller.context.ExecutionContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.classes.ValueClass; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.property.classes.ClassPropertyInterface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.physics.dev.integration.internal.to.InternalAction; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigInteger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.SQLException; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalculateGCD</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InternalAction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateGCD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ScriptingLogicsModule LM, ValueClass... classes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(LM, classes); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ExecutionContext&lt;ClassPropertyInterface&gt; context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException, SQLHandledException </span></span>{ BigInteger b1 = BigInteger.valueOf((Integer)getParam(<span class="hljs-number"><span class="hljs-number">0</span></span>, context)); BigInteger b2 = BigInteger.valueOf((Integer)getParam(<span class="hljs-number"><span class="hljs-number">1</span></span>, context)); BigInteger gcd = b1.gcd(b2); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { findProperty(<span class="hljs-string"><span class="hljs-string">"gcd[]"</span></span>).change(gcd.intValue(), context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ScriptingErrorLog.SemanticErrorException ignored) { } } }</code> </pre></div></div></li><li>  register an action using the special internal call operator (INTERNAL) <br><div class="scrollable-table"><table><tbody><tr><td> <code>calculateGCD <font color="#50a14f">' '</font> <font color="#a626a4">INTERNAL</font> <font color="#50a14f">'CalculateGCD'</font> ( <font color="#a626a4">INTEGER</font> , <font color="#a626a4">INTEGER</font> ); <br></code> </td></tr></tbody></table></div></li><li>  a registered action, like any other, can be called using the call operator.  In this case, the executeInternal method (lsfusion.server.logics.action.controller.context.ExecutionContext context) of the specified Java class will be executed. <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#808080"><i>//  </i></font> <br> <font color="#a626a4">FORM</font> gcd <font color="#50a14f">''</font> <br> <font color="#a626a4">OBJECTS</font> (a = <font color="#a626a4">INTEGER</font> , b = <font color="#a626a4">INTEGER</font> ) <font color="#a626a4">PANEL</font> <br> <font color="#a626a4">PROPERTIES</font> <font color="#50a14f">'A'</font> = <font color="#a626a4">VALUE</font> (a), <font color="#50a14f">'B'</font> = <font color="#a626a4">VALUE</font> (b) <br> <br> <font color="#a626a4">PROPERTIES</font> gcd(), calculateGCD(a, b) <br> ; <br> <br> <font color="#808080"><i>//   </i></font> <br> run() { <br> calculateGCD( <font color="#986801">100</font> , <font color="#986801">200</font> ); <br> } <br></code> </td></tr></tbody></table></div></li></ul>  <b>SQL interaction</b> <br><br>  This type of interaction allows you to access the objects / syntax constructs of the SQL server used by the developed lsFusion system.  To implement this type of interaction, the platform uses a special operator - FORMULA.  This operator allows you to create a property that evaluates some formula in the SQL language.  The formula is specified as a string, inside which the special character $ and the number of this parameter are used to access the parameter (starting from 1).  Accordingly, the number of parameters of the obtained property will be equal to the maximum of the numbers of the parameters used. <br><div class="scrollable-table"><table><tbody><tr><td> <code>round(number, digits) = <font color="#a626a4">FORMULA</font> <font color="#50a14f">'round(CAST(($1) as numeric),$2)'</font> ; <font color="#808080"><i>//    :       </i></font> <br> jumpWorkdays = <font color="#a626a4">FORMULA</font> <font color="#a626a4">NULL</font> <font color="#a626a4">DATE</font> <font color="#a626a4">PG</font> <font color="#50a14f">'jumpWorkdays($1, $2, $3)'</font> , <font color="#a626a4">MS</font> <font color="#50a14f">'dbo.jumpWorkdays($1, $2, $3)'</font> ; <font color="#808080"><i>//         SQL</i></font> <br></code> </td></tr></tbody></table></div>  It is recommended to use this operator only in cases where the task cannot be solved with the help of other operators, as well as if it is guaranteed which specific SQL servers can be used, or the syntax constructs used comply with one of the latest SQL standards. <br><br><a name="fromint"></a><h3>  Appeal from the internal system </h3><br>  Everything is symmetrical to the appeal to the internal system.  There are two types of interaction: <br><br>  <b>Java interoperability</b> <br><br>  Within the framework of this type of interaction, the internal system can directly access the Java elements of the lsFusion system (like ordinary Java objects).  Thus, you can perform all the same operations as using network protocols, but at the same time avoid significant overhead of such interaction (for example, serialization of parameters / deserialization of the result, etc.).  In addition, this method of communication is much more convenient and efficient if the interaction is very close (that is, during the execution of one operation, constant contact is required in both directions - from the lsFusion system to another system and vice versa) and / or requires access to specific platform nodes. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to access Java elements of an lsFusion system directly, you first need to get a link to some object that will have interfaces for finding these Java elements. </font><font style="vertical-align: inherit;">This is usually done in one of two ways:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If initially the call comes from the lsFusion system (through the mechanism described above), then as the ‚Äúsearch object‚Äù you can use the action object ‚Äúthrough which‚Äù this call goes (the class of this action should be inherited from lsfusion.server.physics.dev.integration. internal.to.InternalAction, which, in turn, has all the necessary interfaces). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If the object from whose method it is necessary to access the lsFusion system is a Spring bean, then a link to the business logic object can be obtained using dependency injection (the bean is called businessLogics, respectively). </font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java class example</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.data.sql.exception.SQLHandledException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.data.value.DataObject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.language.ScriptingErrorLog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.language.ScriptingLogicsModule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.action.controller.context.ExecutionContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.classes.ValueClass; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.logics.property.classes.ClassPropertyInterface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lsfusion.server.physics.dev.integration.internal.to.InternalAction; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigInteger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.SQLException; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalculateGCDObject</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InternalAction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateGCDObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ScriptingLogicsModule LM, ValueClass... classes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(LM, classes); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">executeInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ExecutionContext&lt;ClassPropertyInterface&gt; context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException, SQLHandledException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { DataObject calculation = (DataObject)getParamValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, context); BigInteger a = BigInteger.valueOf((Integer)findProperty(<span class="hljs-string"><span class="hljs-string">"a"</span></span>).read(context, calculation)); BigInteger b = BigInteger.valueOf((Integer)findProperty(<span class="hljs-string"><span class="hljs-string">"b"</span></span>).read(context, calculation)); BigInteger gcd = a.gcd(b); findProperty(<span class="hljs-string"><span class="hljs-string">"gcd[Calculation]"</span></span>).change(gcd.intValue(), context, calculation); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ScriptingErrorLog.SemanticErrorException ignored) { } } }</code> </pre></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL interaction</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Systems that have access to the SQL server of an lsFusion system (one of such systems, for example, is the SQL server itself), can access directly the tables and fields created by the lsFusion system using SQL server tools. It should be borne in mind that if reading data is relatively safe (with the exception of the possible deletion / modification of tables and their fields), then no events will be triggered during data recording (and, accordingly, all elements using them - restrictions, aggregations, etc. n.), and also no materializations will be recounted. Therefore, writing data directly to the tables of the lsFusion system is highly discouraged, and if it is still necessary, it is important to take into account all of the above features.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that this direct interaction (but only for reading) is especially convenient for integration with various OLAP systems, where the whole process should occur with a minimal overhead.</font></font><br><br><a name="migration"></a><h2>  Migration </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In practice, situations often arise when for various reasons it is necessary to change the names of existing elements of the system. If the element to be renamed is not associated with any primary data, this can be done without any unnecessary gestures. But if this element is a primary property or class, then such a ‚Äúquiet‚Äù renaming will lead to the fact that the data of this primary property or class will simply disappear. To prevent this, the developer can create a special migration file migration.script, place it in the server classpath, and indicate in it how the old element names correspond to the new names. It all works as follows:</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration consists of blocks that describe the changes made in the specified version of the database structure. </font><font style="vertical-align: inherit;">When starting the server, all changes from the migration file that have a version higher than the version stored in the database are applied. </font><font style="vertical-align: inherit;">Changes are applied according to the version, from a smaller version to a larger one. </font><font style="vertical-align: inherit;">If the change in the database structure is successful, then the maximum version of all applied blocks is written to the database as the current one. </font><font style="vertical-align: inherit;">The syntax for the description of each block is as follows:</font></font><br><br><pre> <code class="plaintext hljs">V&lt; &gt; { 1 ... N }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Changes, in turn, are of the following types: </font></font><br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">DATA</font> <font color="#a626a4">PROPERTY</font> oldNS.oldName[class1,...,classN] -&gt; newNS.newName[class1,...,classN] <br> <font color="#a626a4">CLASS</font> oldNS.oldName -&gt; newNS.newName <br> <font color="#a626a4">OBJECT</font> oldNS.oldClassName.oldName -&gt; newNS.newClassName.newName <br> <br> <font color="#a626a4">TABLE</font> oldNS.oldName -&gt; newNS.newName <br> <font color="#a626a4">PROPERTY</font> oldNS.oldName[class1,...,classN] -&gt; newNS.newName[class1,...,classN] <br> <font color="#a626a4">FORM</font> <font color="#a626a4">PROPERTY</font> oldNS.oldFormName.oldName(object1,...,objectN) -&gt; newNS.newFormName.newName(object1,...,objectN) <br> <font color="#a626a4">NAVIGATOR</font> oldNS.oldName -&gt; newNS.newName <br></code> </td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the migration of user data, only the first three types of changes are relevant (changes in primary properties, classes, static objects). </font><font style="vertical-align: inherit;">The remaining four types of changes are needed:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for metadata migration (security policies, table settings, etc.) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to optimize the migration of user data (so as not to recalculate aggregations and not transfer data between tables once again). </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Accordingly, if the migration of metadata is not needed or there is not much data, such changes in the migration script can be omitted. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration example</font></font></b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td> <code>V0. <font color="#986801">3.1</font> { <br> <font color="#a626a4">DATA</font> <font color="#a626a4">PROPERTY</font> Item.gender[Item.Article] -&gt; Item.dataGender[Item.Article] <font color="#808080"><i>//   DATA </i></font> <br> <font color="#a626a4">PROPERTY</font> System.SIDProperty[Reflection.Property] -&gt; Reflection.dbNameProperty[Reflection.Property] <font color="#808080"><i>//          </i></font> <br> <font color="#a626a4">FORM</font> <font color="#a626a4">PROPERTY</font> Item.itemForm.name(i) -&gt; Item.itemForm.itemName(i) <br> } <br> <br> V0. <font color="#986801">4</font> { <br> <font color="#a626a4">FORM</font> <font color="#a626a4">PROPERTY</font> Document.documentForm.name(i) -&gt; Document.itemForm.itemName(i) <br> <font color="#a626a4">FORM</font> <font color="#a626a4">PROPERTY</font> Item.itemForm.itemName(i) -&gt; Item.itemForm.iname <font color="#808080"><i>//       : iname = itemName(i)</i></font> <br> <font color="#a626a4">CLASS</font> Date.DateInterval -&gt; Date.Interval <br> <font color="#a626a4">OBJECT</font> Geo.Direction.North -&gt; Geo.Direction.north <br> <font color="#a626a4">TABLE</font> User.oldTable -&gt; User.newTable <br> } <br></code> </td></tr></tbody></table></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth noting that usually most of the work on the generation of migration scripts is performed using the IDE. </font><font style="vertical-align: inherit;">So, when renaming most elements, you can specify the special checkbox Change migration file (enabled by default), and the IDE will generate all the necessary scripts automatically.</font></font><br><br><a name="internationalization"></a><h2>  Internationalization </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In practice, sometimes a situation arises when it is necessary to be able to use one application in different languages. </font><font style="vertical-align: inherit;">This task usually comes down to localizing all the string data that the user sees, namely: text messages, property headers, actions, forms, etc. </font><font style="vertical-align: inherit;">All this data in lsFusion is set using string literals (single-quoted strings, for example 'abc'), respectively, their localization is carried out as follows:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instead of the text to be localized, the string identifies the string data, enclosed in braces (for example, '{button.cancel}'). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when this line is transmitted to the client on the server, all identifiers found in the line are searched, then each of them is searched in all the </font></font><a href="https://en.wikipedia.org/wiki/Java_resource_bundle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ResourceBundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project files in the necessary locale (that is, the client locale), and when the right option is found, the identifier in brackets is replaced with the corresponding text.</font></font></li></ul><div class="scrollable-table"><table><tbody><tr><td> <code>script <font color="#50a14f">'{scheduler.script.scheduled.task.detail}'</font> = <font color="#a626a4">DATA</font> <font color="#a626a4">TEXT</font> (ScheduledTaskDetail); <br> <font color="#a626a4">CONSTRAINT</font> script(ScheduledTaskDetail d) <font color="#a626a4">AND</font> action(d) <font color="#a626a4">MESSAGE</font> <font color="#50a14f">'{scheduler.constraint.script.and.action}'</font> ; <br> <font color="#a626a4">FORM</font> scheduledTask <font color="#50a14f">'{scheduler.form.scheduled.task}'</font> ; <br></code> </td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ServerResourceBundle.properties: </font></font><br><pre> <code class="plaintext hljs">scheduler.script.scheduled.task.detail=Script scheduler.constraint.script.and.action=In the scheduler task property and script cannot be selected at the same time scheduler.form.scheduled.task=Tasks</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ServerResourceBundle_ru.properties </font></font><br><pre> <code class="plaintext hljs">scheduler.script.scheduled.task.detail= scheduler.constraint.script.and.action=           scheduler.form.scheduled.task=</code> </pre><br><a name="optimization"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Optimize the performance of large data projects </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the system is small and there is relatively little data in it, as a rule, it works quite efficiently without any additional optimizations. If the logic becomes quite complicated, and the amount of data increases significantly, sometimes it makes sense to tell the platform how best to store and process all this data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The platform has two main mechanisms for working with data: properties and actions. The first is responsible for storing and computing data, the second is for transferring the system from one state to another. And if the work of actions can be optimized quite limitedly (including due to the aftereffect), then for properties there is a whole set of features that allow you to both reduce the response time of specific operations and increase the overall system performance:</font></font><br><br><ul><li> .      ( ,  ),     ,   ,  . </li><li> .        ,  ,       . </li><li> .           /       ,         .       ¬´¬ª  . </li></ul><br><a name="materialized"></a><h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Almost any aggregated properties in the platform can be materialized. In this case, the property will be stored in the database constantly and automatically updated when the data on which this property depends is changed. Moreover, when reading the values ‚Äã‚Äãof such a materialized property, these values ‚Äã‚Äãwill be read directly from the database, as if the property was primary (and not calculated each time). Accordingly, all primary properties are materialized by definition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A property can be materialized if and only if for it there is a finite number of sets of objects for which the value of this property is not NULL </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generally, the topic of materialization was examined in sufficient detail in a </font></font><a href="https://habr.com/ru/company/lsfusion/blog/459066/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recent article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">about the balance of writing and reading in databases, so to dwell on it in detail here, in my opinion, does not make much sense.</font></font><br><br><a name="index"></a><h3>  Indices </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Building an index by property allows you to store in the database all the values ‚Äã‚Äãof this property in an ordered manner. Accordingly, the index is updated each time the value of the indexed property changes. Thanks to the index, if, for example, filtering by an indexed property is in progress, you can very quickly find the necessary objects, rather than view all existing objects in the system. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only materialized properties can be indexed (from the section above). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An index can also be built on several properties at once (this is effective if, for example, filtering is carried out immediately on these several properties). In addition, property parameters can be included in such a composite index. If the specified properties are stored in different tables, then an attempt to build the index will result in the corresponding error.</font></font><br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">INDEX</font> customer(Order o); <br> <br> date = <font color="#a626a4">DATA</font> <font color="#a626a4">DATE</font> (Order); <br> <font color="#a626a4">INDEX</font> date(Order o), o; <br> <br> <font color="#a626a4">INDEX</font> name(Sku s), price(s, <font color="#a626a4">DATE</font> d), d; <br></code> </td></tr></tbody></table></div><a name="table"></a><h3>  Tables </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LsFusion uses a relational database to store and calculate property values. All primary properties, as well as all aggregated properties that are marked as materialized, are stored in the fields of the database tables. For each table, there is a set of key fields with the names key0, key1, ..., keyN, in which the values ‚Äã‚Äãof objects are stored (for example, for custom classes, the identifiers of these objects). All other fields store property values ‚Äã‚Äãin such a way that in the corresponding field of each row is the property value for objects from key fields. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When creating a table, you must specify a list of classes of objects that will be the keys in this table.</font></font><br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">TABLE</font> book (Book); <br> <br> in = <font color="#a626a4">DATA</font> <font color="#a626a4">BOOLEAN</font> (Sku, Stock); <br> <font color="#a626a4">TABLE</font> skuStock (Sku, Stock); <font color="#808080"><i>//      in</i></font> <br> <br> price = <font color="#a626a4">DATA</font> <font color="#a626a4">NUMERIC</font> [ <font color="#986801">10</font> , <font color="#986801">2</font> ] (Sku, <font color="#a626a4">DATE</font> ); <br> <font color="#a626a4">TABLE</font> skuDate (Sku, <font color="#a626a4">DATE</font> ); <font color="#808080"><i>//      Sku</i></font> <br> <br> <font color="#a626a4">TABLE</font> sku (Sku); <br></code> </td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For each property, you can specify in which table it should be stored. </font><font style="vertical-align: inherit;">In this case, the number of table keys must match the number of property parameters, and parameter classes must match the key classes of this table. </font><font style="vertical-align: inherit;">If the table in which it is to be stored is not set explicitly for the property, the property will automatically be placed in the "nearest" table existing in the system (that is, the number of keys of which coincides with the number of property parameters, and whose key classes are closest to parameter classes ) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The names of tables and fields in which properties are stored in the DBMS are formed in accordance with the specified naming policy. </font><font style="vertical-align: inherit;">Currently, the platform supports three standard naming policies.</font></font><br><div class="scrollable-table"><table><tbody><tr><th>  Politics </th><th>  Table name </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Field name </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Full with signature (default) </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Space Name_NameTables </font></font></td><td> __1 <br> _2..._N </td></tr><tr><td>    </td><td> _ </td><td> _ </td></tr><tr><td>  </td><td>  </td><td>  </td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If necessary, for each property, the developer can explicitly specify the name of the field in which this property will be stored. In addition, it is possible to create your own policy for naming property fields if the above for some reason is not suitable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When choosing a naming policy, it is important to keep in mind that using too short a property naming policy, if the number of materialized properties is large enough, can greatly complicate the naming of these properties (so that it is unique), or, accordingly, lead to too often the need to explicitly name The fields in which these properties will be stored.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As they said in one famous cartoon: "we built, built, and finally built." It may, of course, be a bit superficial, but I think you can figure out the basic features of the lsFusion language / platform for these three articles. It's time to move on to the most interesting part - comparing with other technologies. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As experience and the format of the Habr showed, doing it more efficiently playing not on your own, but on a foreign field. That is, to go not from opportunities, but from problems and, accordingly, to talk not about their advantages, but about the disadvantages of alternative technologies, and in their own terminology. Such an approach is usually much better perceived in conservative markets, and it is such a market, in my opinion, that is the market for the development of information systems, at least in the post-Soviet space.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> So very soon there will be several more articles in the style of: ‚ÄúWhy not ...?‚Äù, And I‚Äôm sure they will be much more interesting than these very boring tutorials. </font></font><br></div><p>Source: <a href="https://habr.com/ru/post/460887/">https://habr.com/ru/post/460887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460875/index.html">How we at QIWI came to a common style of interaction between View and ViewModel within MVVM</a></li>
<li><a href="../460877/index.html">Kubernetes Dailymotion Adventure: Building Infrastructure in the Clouds + on-premises</a></li>
<li><a href="../460879/index.html">DUMP Kazan 2019 - Tatarstan Developers Conference. We accept applications for reports</a></li>
<li><a href="../460883/index.html">About life in a world of changing requirements and the benefits of small features</a></li>
<li><a href="../460885/index.html">Interesting reports on HighLoad ++ Siberia 2019 according to Plesk</a></li>
<li><a href="../460891/index.html">How to distinguish good SCRUM from bad, using the approach of the founder of quantum computing</a></li>
<li><a href="../460893/index.html">A look at relocation to Estonia from the inside out - pros, cons and pitfalls</a></li>
<li><a href="../460897/index.html">JUnit in GitLab CI with Kubernetes</a></li>
<li><a href="../460899/index.html">July 26, Deworkacy - DocOps from Rostelecom</a></li>
<li><a href="../4609/index.html">Full list of video services on the Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>