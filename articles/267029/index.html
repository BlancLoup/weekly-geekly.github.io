<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We make a network printer from HP LJ1000</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The HP LaserJet 1000 is a great workhorse, fast and trouble-free USB printer with a low print cost. In the article I will describe the complexity and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We make a network printer from HP LJ1000</h1><div class="post__text post__text-html js-mediator-article">  The HP LaserJet 1000 is a great workhorse, fast and trouble-free USB printer with a low print cost.  In the article I will describe the complexity and subtleties of setting up HP soft printers to work through a router over the network using the example of my LJ1000.  Well under the cat! <br><a name="habracut"></a><br>  There are a lot of articles on connecting printers via routers on the network, the essence of the majority comes down to a general algorithm - install alternative firmware on the router (for example, OpenWrt), install USB support, printers and p910nd daemon, then prescribe the demon configs and additional settings. <br><br>  The peculiarity of the HP 1000, 1005, 1006, 1007, 1007, 1018, 1020, 1505 soft printers is that they do not have a full-fledged control firmware on board, it is loaded by the driver every time the printer is turned on.  This article should be suitable for any of the listed printers, however, it is tested only on HP LJ1000. <br><br>  The main difficulty in connecting such a printer via a router is to load ‚Äúfirmware‚Äù into it, which almost no router with printer support ‚Äúout of the box‚Äù can do, as well as specialized ‚Äúprint servers‚Äù, although I admit that there are models that can do this, however I could not find them live. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Enhanced study of the issue gave two methods for solving the problem of downloading the firmware to the router - on the client side or on the router side.  <a href="http://forum.dlink.ru/viewtopic.php%3Ff%3D7%26t%3D143052%26view%3Dnext">In the first version, the</a> router is configured as for a regular printer, the ‚Äúfirmware‚Äù needs to be sent to print before using the printer for the first time from a computer: <br><br><pre><code class="dos hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>. --<span class="hljs-built_in"><span class="hljs-built_in">CMD</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>.    <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> :\__\.<span class="hljs-built_in"><span class="hljs-built_in">prn</span></span> \\dnsXXXX\lp (: <span class="hljs-built_in"><span class="hljs-built_in">COPY</span></span> c:\tmp\sihp1020.<span class="hljs-built_in"><span class="hljs-built_in">prn</span></span> \\dns323\lp)</code> </pre> <br>  I consider this method insolvent, for it is inconvenient.  The printer should work without additional gestures. <br><br>  The second method of solving the problem is to upload the firmware by the router itself.  Moreover, it is desirable that the firmware be loaded not only by turning on the router, but also by the printer's hotplug. <br><br>  Now I will describe the configuration process on the hardware I have.  In my case, the D-Link DIR-620 Rev A1 router is used.  I have already tried a lot of firmware with this router, Zyxel Keenetic v1 turned out to be very convenient, however HP LJ1000 does not work with Keenetic, dances with tambourines did not help.  As evidenced by technical support Zyxel: <a href="http://forum.zyxmon.org/topic160-keenetic-i-hp-lj-1000.html">http://forum.zyxmon.org/topic160-keenetic-i-hp-lj-1000.html</a> <br><br>  I used the latest available version of OpenWrt: <a href="http://wiki.openwrt.org/ru/toh/d-link/dir-620">14.07</a> . <br><br>  As a basis for customization, I used an article on the <a href="http://wiki.openwrt.org/ru/doc/howto/print-server-p910nd">OpenWrt wiki</a> .  The script is remade for a normal hotplag and a steady start for the p910nd daemon. <br><br>  After flashing the router, we change the default password, activate the SSH operation, configure the network interfaces.  It is most convenient to do all further settings through a terminal client, I used Putty.  The settings assume that the router has access to the Internet. <br><br>  So, let's go: <br><br><ol><li>  Install the necessary packages for the printer, plus a simple editor: <br><pre> <code class="bash hljs">opkg update opkg install kmod-usb-printer usbutils p910nd nano</code> </pre><br></li><li>  Write to the file system of the router firmware for the desired printer.  The easiest way to download the firmware from Oleg: <a href="http://oleg.wl500g.info/hplj">http://oleg.wl500g.info/hplj</a> .  In my case, I need the firmware for HP LJ1000 - and download it: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/lib/ wget http://oleg.wl500g.info/hplj/sihp1000.dl</code> </pre><br></li><li>  Create a script to handle the hotplug event so that the firmware is sent to the printer each time it is connected: <pre> <code class="bash hljs">nano /etc/hotplug.d/usb/20-printer</code> </pre><br>  Script code: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh FIRMWARE="/usr/lib/sihp1000.dl" DEVICE=/dev/usb/lp0 if [ "$PRODUCT" = "3f0/517/120" ] then case "$ACTION" in add) /etc/init.d/p910nd stop echo "`date`: Sending firmware to printer." &gt;&gt; /tmp/hl1000 cat $FIRMWARE &gt; $DEVICE sleep 15 echo "`date`: hl1000 added" &gt;&gt; /tmp/hl1000 /etc/init.d/p910nd start echo "Done." &gt;&gt; /tmp/hl1000 ;; remove) echo "`date`: hl1000 removed" &gt;&gt; /tmp/hl1000 /etc/init.d/p910nd stop echo "Done." &gt;&gt; /tmp/hl1000 ;; esac fi</span></span></code> </pre><br>  A little bit about script setup: first you need to make sure that your printer is located along the path / dev / usb / lp0: the <b>ls / dev / usb command</b> should give a list of devices among which there will be lp0.  Some firmware may create a printer's dexryptor at / dev / lp0. <br><br>  Next, you need to register the path to the file "firmware", and specify the VID / PID of the printer.  We look that is on USB: <br><br><pre> <code class="bash hljs">lsusb -v | grep <span class="hljs-string"><span class="hljs-string">"ID\|bcdUSB"</span></span></code> </pre><br><br>  Answer: <br><br><pre> <code class="bash hljs">Bus 001 Device 004: ID 030:0517 Hewlett-Packard LaserJet 1000 bcdUSB 1.20</code> </pre><br>  3f0 / 517 is the VID and PID of the HP LJ 1000 printer (the first zeros are deleted <s>0</s> 3f0).  120 is the BCD version without a dot. <br></li><li>  Open the p910nd configuration file: <br><br><pre> <code class="bash hljs">nano /etc/config/p910nd</code> </pre><br>  If there is already an entry for the printer, you need to make sure that the path to the printer descriptor is correct.  If not, copy this text: <br><br><pre> <code class="bash hljs">config p910nd option device /dev/usb/lp0 option port 0 option bidirectional 0 option enabled 1</code> </pre><br>  If only one printer is used with the router, then we leave this text as it is, but several printers can be used.  Then for each of them you will need to specify your port (by default 9100). <br></li><li>  In my case, the print daemon is started by the script after downloading the firmware to the printer, so make sure that it does not start itself when the router is turned on: <br><br><pre> <code class="bash hljs">/etc/init.d/p910nd <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span></code> </pre><br>  Otherwise, a daemon running too early fell with the following error: <br><br><pre> <code class="bash hljs">Tue Feb 4 02:29:43 2014 lpr.err p9100d[1207]: <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>: Cannot assign requested address Tue Feb 4 02:29:43 2014 lpr.err p9100d[1207]: accept: Bad file descriptor</code> </pre><br></li></ol><br>  Reboot the router.  If everything is configured correctly, then with the loading of the router the printer is reinitialized (you can hear how it restarts).  Just in case, we make sure that there are no p9100 errors in System Log, we connect via SSH, we check the hotplug script operation: <br><br><pre> <code class="bash hljs">nano /tmp/hl1000</code> </pre><br>  There should be a log like this: <br><br><pre> <code class="bash hljs">Sending firmware to printer. hl1000 added Done.</code> </pre><br>  Check that the daemon has started: <br><br><pre> <code class="bash hljs">ps | grep p910nd</code> </pre><br>  The process list for the command should be <b>p910nd</b> : <br><br><pre> <code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># ps | grep p910nd 1597 root 780 S {p910nd} /usr/sbin/p9100d -b -f /dev/usb/lp0 0 1849 root 1492 S grep p910nd</span></span></code> </pre><br>  At this setting on the side of the router can be considered complete. <br><br>  Further we set up the connection from the customers.  In my case, these were computers running Windows XP, where the drivers for the desired printer were already installed. <br><br>  Open the properties of the printer: <br><br><img src="https://habrastorage.org/files/536/5e4/967/5365e49673ac43efb600347268b86030.png"><br><br>  Add a new port -&gt; Standard TCP / IP Port -&gt; New port -&gt; Next -&gt; enter the IP address of the router -&gt; generic Network Card-&gt; Done. <br><br>  <b>Be sure</b> to uncheck "bidirectional exchange."  About this where few write.  Other models of printers except 1000 normally work with the installed one, but it was with my 1000 that the printing did not work until I unchecked and rebooted (it‚Äôs important that it will not work without rebooting). <br><br>  The print from Windows 7 is also configured in the same way, you also need to uncheck the ‚Äúbidirectional exchange‚Äù box.  I didn‚Äôt check it on newer ones, but I don‚Äôt see any obstacles for it to work. <br><br>  PS: Setting up bidirectional exchange in p910nd ( <b>bidirectional</b> ) does not affect operation, unlike setting up bidirectional exchange on the client side.  I tried with the flag turned on and off, the behavior of the printer did not change.  Therefore, it is important to observe the disconnection only on the client side. </div><p>Source: <a href="https://habr.com/ru/post/267029/">https://habr.com/ru/post/267029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267019/index.html">Joint action with ISPsystem: ISPmanager 5 Lite license free of charge to all cloud-based VPS, incident report dated August 31, 2015</a></li>
<li><a href="../267021/index.html">Zero Security: A - Beginner Ethical Hacking Courses</a></li>
<li><a href="../267023/index.html">Comparison of mobile applications for 3D reconstruction</a></li>
<li><a href="../267025/index.html">git punish - whose team I always lacked</a></li>
<li><a href="../267027/index.html">FZ-188: who will soon categorically not be able to buy foreign software, if there is a Russian equivalent</a></li>
<li><a href="../267033/index.html">Simple Optimization Technique Using Intel System Studio</a></li>
<li><a href="../267035/index.html">The time series forecasting model for the maximum similarity sample: an explanation and an example</a></li>
<li><a href="../267037/index.html">A simple algorithm for determining the intersection of two segments</a></li>
<li><a href="../267039/index.html">Private Cloud Appliance - the best virtualization and private cloud for data centers</a></li>
<li><a href="../267041/index.html">Dissect t-SNE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>