<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of creating a 2D character in Unity 3D 4.3. Part 3: jumping (and falling)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1: character preparation and animation of rest 
 Part 2: Running Character 
 Part 3: jumping (and falling) 

 Hello. We continue a series of less...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of creating a 2D character in Unity 3D 4.3. Part 3: jumping (and falling)</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/211472/">Part 1: character preparation and animation of rest</a> <br>  <a href="http://habrahabr.ru/post/211847/">Part 2: Running Character</a> <br>  <b>Part 3: jumping (and falling)</b> <br><br>  Hello.  We continue a series of lessons on the creation of a 2D character.  In the previous two parts, we made a character that can be in two states: peace and running left and right.  Perhaps for a very simple game this will be enough.  But we will not stop there and today we will teach our character to jump. <br><a name="habracut"></a><br>  Our goal sounds simple, but in its implementation there will be some subtleties.  First, we need to somehow determine that the character is in a jump state.  It will be a little more difficult than determining the state of running.  Secondly, you need to fasten the corresponding animation.  Here we could act in the same way as animations of rest and running - play the corresponding animation frames cyclically while the character is in the jump state.  But we are implementing a more flexible option.  The jump state actually consists of two states: takeoff and free fall.  In addition, there are special cases - only take-off and only fall.  If we fasten one common animation for these two states (for example, the cloak pulled up and waving in the wind) - it may look normal, but not quite realistic.  In reality, when a person jumps, the position of his body, arms, legs is different during takeoff and during a fall.  We will create such an animation, which will take into account the speed of the rise / fall and, depending on it, switch the corresponding frame of the animation. <br><br>  Download our project and scene.  In the <i>Assets</i> - <i>Sprites</i> folder, we have the last unused Sprite <i>Jump</i> .  Let's do with it the already familiar operation of cutting the sprite into a collection of images.  Then in the <i>Hierarchy</i> window, select <i>Character</i> and go to the <i>Animation</i> window.  To jump, we need several animation files, or rather, seven.  This is equal to the number of frames in the <i>Jump</i> sprite.  Let's create these animations, calling them <i>Jump1</i> , <i>Jump2</i> , etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/302/caa/4c6/302caa4c6a7ed4376f3519e00b312ab2.png"><br><br>  Now add to each animation one image from the <i>Jump</i> sprite, in order: the <i>Jump_0</i> sprite in the <i>Jump1</i> animation, the <i>Jump_1</i> sprite in the <i>Jump2</i> animation ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b4/c38/cf2/3b4c38cf2e2931e463dd409f5f2232c0.png"><br><br>  In the <i>Animator</i> window (not <i>Animation</i> !), We automatically created elements for new animations, but we will not need them anymore.  Select them and delete them with the <i>Delete</i> key (the animations will also be removed from the corresponding list in the <i>Animation</i> window, but we will return them later).  Create two new parameters in <i>Animator</i> : <i>Ground</i> with <i>Bool</i> type and <i>vSpeed</i> with <i>Float</i> type.  The first will indicate whether the character is on the ground or in a jump, and the second will store the current value of the speed of the character along the Y axis, that is, the speed of take-off / fall.  Depending on it, we will apply the appropriate animation from our seven jump animations. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7d/bda/df8/f7dbdadf82880b4a4d8430cd1c7ebe1e.png"><br><br>  Now right click on any free space in the <i>Animator</i> window and select <i>Create State</i> - <i>From New Blend Tree</i> .  In the <i>Inspector</i> window, rename the created element as <i>Jump</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0a/30c/af2/d0a30caf25759399182772b47edb1514.png"><br><br>  Create two transitions between animations: <i>Any State</i> -&gt; <i>Jump</i> and <i>Jump</i> -&gt; <i>Idle</i> .  That is, from any state we can go to the jump state, and from the jump state we can go to the rest state.  I remind you how the transitions are made: right click on the first animation, <i>Make Transition</i> , left click on the second animation.  For the first transition, set the <i>Ground</i> condition to <i>false</i> ; for the second <i>Ground</i> , set it to <i>true</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cff/1b2/0c8/cff1b20c88f5ba759f7a6dd5c1cf5aae.png"><br><br>  Now double click on the <i>Jump</i> .  The <i>Blend Tree</i> item opens.  We will add our seven jump animations to it, and switching between them will occur depending on the value of the <i>vSpeed</i> parameter.  By default, the <i>Speed</i> parameter is set in <i>Blend Tree</i> - change it to <i>vSpeed</i> in the <i>Inspector</i> window. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8da/755/b56/8da755b560e911b45cc7d84041dfd758.png"><br><br>  In the same window, click on the plus sign and select <i>Add Motion Field</i> .  This needs to be done seven times.  Seven fields will be created for our seven animations.  Remove the <i>Automate Thresholds</i> flag so that you can manually set the values ‚Äã‚Äãof the <i>vSpeed</i> parameter, upon reaching which the animation will be changed in the <i>Blend Tree</i> .  Drag and drop animations into each field and set <i>vSpeed</i> values.  This is what should happen (by the way, after these actions, those removed from the list in the <i>Animation</i> window of the animation <i>Jump1</i> - <i>Jump6</i> will appear again): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ae/bdd/400/1aebdd400758c1c337e589926a288b51.png"><br><br>  We'll finish with the animation for now.  Now we need to learn how to determine when a character is on the ground, and when - in the air, that is, in a jump.  Go to the <i>Scene</i> window.  Create an empty game object, let's call it <i>GroundCheck</i> .  Select it in the <i>Hierarchy</i> window and drag it to <i>Character</i> (all in the same <i>Hierarchy</i> window!).  Now the <i>GroundCheck</i> object will be a child of the <i>Character</i> and will move with it, and the <i>Character</i> object will acquire the corresponding arrow hiding the child objects.  Click on the arrow and again select the object <i>GroundCheck</i> .  Assign him an icon to see the object on the scene.  In the screenshot, I indicated how to do this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fd/4aa/3d7/4fd4aa3d776318d6bf7aac095908643c.png"><br><br>  In the <i>Scene</i> window, move <i>GroundCheck</i> to the character's legs.  Thus, we have made an object that will be used to determine the character‚Äôs location on the ground. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77f/8a1/872/77f8a1872a9f4107ef89514d6200deb6.png"><br><br>  Now we need to determine, and what is the earth?  Obviously, this is our platform, but the game does not yet know about it.  By the way, let's create a copy of the platform for testing the jump (the best way would be to create a prefab based on the platform, but for now let's just select <i>Platform</i> and press <i>Ctrl + D</i> ).  Place the second platform to the right and above the first. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/06b/2bc/006/06b2bc0069191c835ac3e29bfeb92266.png"><br><br>  Select any of the platforms and pay attention to the upper part of the <i>Inspector</i> window.  There is a <i>Layer</i> field with the value <i>Default</i> .  It means that an object belongs to a particular layer.  Click on <i>Default</i> , select <i>Add Layer</i> , set the name <i>Ground</i> in the <i>User Layer 8</i> field.  Select the platform again and set the <i>Ground</i> layer instead of the <i>Default</i> layer.  For the second platform, also set the <i>Ground</i> layer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a11/804/85b/a1180485b15a97f2fd928ece1cf82a83.png"><br><br>  Thus, we have determined that our platforms will be land.  The <i>GroundCheck</i> object will be checked for intersection with objects in the <i>Ground</i> layer, i.e.  with our platforms.  If an intersection is found, the character is on the ground.  This will be done in the <i>CharacterControlleScript</i> script created in the previous section.  Let's open it for editing. <br><br>  In the beginning of the script, add new variables in addition to the existing ones: <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//       ? private bool isGrounded = false; //   Transform  //     public Transform groundCheck; //     private float groundRadius = 0.2f; //  ,   public LayerMask whatIsGround;</span></span></code> </pre> <br><br>  And at the beginning of the <i>FixedUpdate</i> method the following lines: <br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//,     isGrounded = Physics2D.OverlapCircle(groundCheck.position, groundRadius, whatIsGround); //     anim.SetBool ("Ground", isGrounded); //     / anim.SetFloat ("vSpeed", rigidbody2D.velocity.y); //    -   ,    ,    if (!isGrounded) return;</span></span></code> </pre><br><br>  Now let's add the <i>Update</i> method to the script, in which we will handle the keystroke of the jump.  We will do this in the <i>Update</i> method for greater control accuracy - this method is called every frame of the game, unlike <i>FixedUpdate</i> , which is called after the same specific time and usually, with a good FPS, calls occur less frequently than <i>Update</i> calls. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      ... if (isGrounded &amp;&amp; Input.GetKeyDown (KeyCode.Space)) { //     false anim.SetBool("Ground", false); //  ,    rigidbody2D.AddForce(new Vector2(0, 600)); } }</span></span></code> </pre><br><br>  So the whole script will look like this: <br><div class="spoiler">  <b class="spoiler_title">CharacterControllerScript</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CharacterControllerScript</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   .   public float maxSpeed = 10f; //     / private bool isFacingRight = true; //    private Animator anim; //       ? private bool isGrounded = false; //   Transform  //     public Transform groundCheck; //     private float groundRadius = 0.2f; //  ,   public LayerMask whatIsGround; /// &lt;summary&gt; ///   /// &lt;/summary&gt; private void Start() { anim = GetComponent&lt;Animator&gt;(); } /// &lt;summary&gt; ///     FixedUpdate, . .   Animator  ///   Animate Physics = true       /// &lt;/summary&gt; private void FixedUpdate() { //,     isGrounded = Physics2D.OverlapCircle(groundCheck.position, groundRadius, whatIsGround); //     anim.SetBool ("Ground", isGrounded); //     / anim.SetFloat ("vSpeed", rigidbody2D.velocity.y); //    -   ,    ,    if (!isGrounded) return; // Input.GetAxis   .        -1  1. //    //-1        (  ), //1        (  D) float move = Input.GetAxis("Horizontal"); //      Speed    . //     anim.SetFloat("Speed", Mathf.Abs(move)); //    RigidBody2D.      , //       .  rigidbody2D.velocity = new Vector2(move * maxSpeed, rigidbody2D.velocity.y); //     ,     if(move &gt; 0 &amp;&amp; !isFacingRight) //   Flip(); // .    else if (move &lt; 0 &amp;&amp; isFacingRight) Flip(); } private void Update() { //      ... if (isGrounded &amp;&amp; Input.GetKeyDown (KeyCode.Space)) { //     false anim.SetBool("Ground", false); //  ,    rigidbody2D.AddForce(new Vector2(0, 600)); } } /// &lt;summary&gt; ///           /// &lt;/summary&gt; private void Flip() { //    isFacingRight = !isFacingRight; //   Vector3 theScale = transform.localScale; //      theScale.x *= -1; //   ,  ,    transform.localScale = theScale; } }</span></span></code> </pre><br></div></div><br><br>  Save the script, return to Unity.  In the <i>Hierarchy</i> select <i>Character</i> .  Drag the <i>GroundCheck</i> object into the <i>Ground Check</i> field of the <i>CharacterControllerScript</i> script, and in the <i>What Is Ground</i> field set the <i>Ground</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc6/430/5bc/fc64305bc7ea8342005eb1040cace0e5.png"><br><br>  So, in our script, in the <i>FixedUpdate</i> method, the intersection of a <i>GroundCheck</i> object with objects belonging to the <i>Ground</i> layer is checked.  This is achieved using the <i>Physics2D.OverlapCircle</i> method.  The arguments of this method also specify the radius of the intersection definition.  Then, in the variable of the animator <i>Ground</i> , the result of determining the location on the ground is set, and in the variable <i>vSpeed</i> - the current speed of the character along the Y axis. Depending on this speed, one or another animation of the jump from seven animations in the <i>Blend Tree</i> is applied.  The jump itself is set in the <i>Update</i> method when you press the spacebar, by giving vertical force to the <i>Rigidbody2D</i> component. <br>  Before starting the game, let's change the value of gravity a bit, otherwise the speed of jumps will be slow, like on the Moon.  Go to the menu <i>Edit</i> - <i>Project Settings</i> - <i>Physics 2D</i> .  In the <i>Inspector</i> window set the value <i>Gravity</i> <i>Y</i> = -30.  Run the game!  If everything is done correctly, we will see something like the following: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ZKnenb2asPw%3Ffeature%3Doembed&amp;xid=17259,15700021,15700043,15700186,15700190,15700253&amp;usg=ALkJrhh0yYg-Vj3X3iI_9lnfadTr_q50FQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Captain Kogot can run and jump.  When jumping, depending on the state (rise / fall) and speed, the corresponding animation is applied.  The video clearly shows that when jumping in the <i>Animator</i> window, switching between animations in the <i>Blend Tree</i> element occurs.  At the same time, if the character just falls off the platform (i.e. there is no takeoff phase in the jump, no space was pressed) - only those animations work, for switching which negative speed values ‚Äã‚Äãare set, which makes the character's behavior more realistic.  Of course, for better effect, more animations and more fine-tuning of speed values ‚Äã‚Äãare needed. <br><br>  Well, that's all.  The basis for the 2D character is created.  What additional features to fasten to it depends on the particular game.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/212309/">https://habr.com/ru/post/212309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212299/index.html">DigitalOcean opens data center in Singapore</a></li>
<li><a href="../212301/index.html">Angular Light: Lazy directive hookup and preprocessor</a></li>
<li><a href="../212303/index.html">Nokia will introduce its Android phone on February 24</a></li>
<li><a href="../212305/index.html">London has completed the construction of the world's largest bridge with solar panels</a></li>
<li><a href="../212307/index.html">A criminal case was opened in Belarus for hijacking a virtual tank</a></li>
<li><a href="../212311/index.html">Sweden is building a whole data center for mining Bitcoin</a></li>
<li><a href="../212317/index.html">Three hundred and ninety four dollars</a></li>
<li><a href="../212319/index.html">InfoTeKS Academy opened the acceptance of applications for the contest "Fast cryptographer"</a></li>
<li><a href="../212321/index.html">About data openness in Android applications</a></li>
<li><a href="../212323/index.html">Five ways to burn for a programmer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>