<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Improvements in the caching subsystem of Internet Explorer 9</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The network plays a key role in the overall performance of a web browser. The best way to increase network performance is to reduce the amount of traf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Improvements in the caching subsystem of Internet Explorer 9</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/34a/HeaderLeft_1__af7f68ac-8518-4986-b125-36cadf758c50.png" alt="image"><br>  The network plays a key role in the overall performance of a web browser.  The best way to increase network performance is to reduce the amount of traffic transmitted over the network using HTTP compression and browser caching. <br><br>  We have made a huge amount of improvements in how Internet Explorer 9 caches data in order to increase the use of resources from the cache.  This post describes these improvements that are already available in the <a href="http://www.ietestdrive.com/" rel="nofollow">third version of the IE9 Platform Preview</a> , which was released <a href="http://blogs.msdn.com/b/ie/archive/2010/06/23/html5-native-third-ie9-platform-preview-available-for-developers.aspx" rel="nofollow">last month</a> . <br><br><a name="habracut"></a><h4>  The essence of caching </h4><br>  Let's start with a quick description of how browser caching works.  At the highest level, browsers perform two types of HTTP (S) requests ‚Äî conditional requests and unconditional requests. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unconditional requests are created when the browser does not have a cached copy of the resource.  In this case, it is expected that the server will return a resource with an <strong>HTTP / 200 OK</strong> response <strong>.</strong>  If the response headers do not specifically prohibit this, the client may cache the content and use it in the future. <br><br>  If in the future the browser needs a resource that is in the local cache, then the resource headers are checked to see if the resource remains relevant.  If the cached copy is up-to-date, no requests to the resource on the network will be made and the client simply uses the cached copy. <br><br>  If the cached resource is outdated (older than the <strong>max-age</strong> header or later than the <strong>Expires</strong> date), the client will make a conditional request to the server to determine if the previously cached resource is relevant and can be used.  A conditional request contains <b>If-Modified-Since</b> and / or <strong>If-None-Match</strong> headers that show the server what version of content is already on the client.  The server can determine that the client version is still up to date by returning an empty response with the <strong>HTTP / 304 Not Modified</strong> header, or it can indicate to the client that its version is out of date by returning the response with the <strong>HTTP / 200 OK</strong> header and new content. <br><br>  Obviously, conditional requests lead to better performance compared to unconditional requests (because the server does not need to send a resource if the client already has an up-to-date version), but better performance is achieved when the client knows which version in its cache is relevant and the conditional revalidation is not performed . <br><br><h4>  Headers with extremely long life spans </h4><br>  Although RFC2616 recommends that servers limit the lifespan of content to one year, some servers specify Cache-Control directives with a significantly longer period.  <a href="http://blogs.msdn.com/b/ieinternals/archive/2010/01/26/use-max-age-values-less-than-maxint.aspx" rel="nofollow">Prior to IE9,</a> Internet Explorer recognized as obsolete all resources whose lifetime ( <b>Cache-Control: max-age</b> value) was more than 2147483648 (2 ^ 31) seconds, approximately 68 years. <br><br>  In the ninth version of IE, we accept any set max-age up to 2 ^ 63, although inside we reduce it to 2 ^ 31 seconds. <br><br><h4>  Vary parameter improvements </h4><br>  The HTTP / 1.1 <strong>Vary</strong> response header allows the server to indicate that the actual cached resource can be used without revalidation only if the headers specified in Vary match the request headers. <br><br>  For example, this allows the server to return content in English with the heading <strong>Vary: Accept-Language.</strong>  If the user later changes the <b>Accept-Language</b> value from <b>en-US</b> to <strong>ja-JP</strong> in his browser, the previously cached content will not be used, since the Accept-Language header no longer matches the value that was saved when caching the resource in English. <br><br>  In IE9, we have improved support for key Vary usage scenarios.  So, IE9 no longer requires server revalidation for responses that contain the <strong>Vary</strong> directive <strong>: Accept-Encoding</strong> and <b>Vary: Host.</b> <br><br>  We can safely support these two directives for the following reasons: <ol><li>  all requests are explicitly dependent on Host, because the host is a component of the request URL; </li><li>  IE always unpacks HTTP responses into a cache, which makes <strong>Vary: Accept-Encoding</strong> redundant. </li></ol>  Like IE6 and higher, IE9 also ignores the <b>Vary: User-Agent</b> directive <b>.</b> <br><br>  If the response contains a Vary directive that specifies a header or a combination of headers other than <strong>Accept-Encoding</strong> , <b>Host,</b> or <strong>User-Agent</strong> , then Internet Explorer will continue to cache the response <em>if the</em> response contains an ETAG header.  However, such a response will be marked as obsolete and a conditional HTTP request will be made before its use in order to determine the relevance of the cached copy. <br><br><h4>  Caching redirects </h4><br>  IE9 now supports caching responses with HTTP redirects, as described in RFC2616.  Answers with permanent redirect (with status 301) will be cached until they contain headers that prohibit it (for example, <b>Cache-Control: no-cache</b> ) and those requests that have a temporary redirect status (302 or 207) will also be cached if the headers allow it (for example, <b>Cache-Control: max-age = 120</b> ). <br><br>  Despite significant improvements in performance, web applications that are mis-configured may not work as expected after these improvements.  For example, we found several public sites that use templates similar to the following: <br><br>  <em>&gt; GET / HTTP / 1.1</em> <em><br><br></em>  <em>&lt;301 Redirect to / SetCookie.asp</em> <br><br>  <em>&gt; GET /SetCookie.asp HTTP / 1.1</em> <em><br><br></em>  <em>&lt;301 Redirect to /</em> <br><br>  Here, the purpose of the site is to set a cookie using a helper page if it is not set.  The problem is that the server chose 301 for this task and 301 is cached.  As a result, IE will simply perform redirects on the client side without accessing the server until the user is bored and he closes the browser.  Please note that this infinite loop will be also if cookies are disabled in the user's browser. <br><br>  If your site creates redirects, you must make sure that they are configured to avoid looping and verify that specific redirects (for example, to set cookies) are marked as non-cacheable. <br><br><h4>  HTTPS caching enhancements </h4><br>  A few months ago, <a href="https-content.aspx" rel="nofollow">I mentioned</a> that IE would not reuse previously cached resources obtained via HTTPS until at least one secure connection was established for the current process.  This can lead to the fact that previously saved resources will be ignored, which will lead to unconditional network requests for content, although it is already in the cache. <br><br>  In IE9, optional HTTPS cross-host requests will now be conditional, so the server can simply return an <strong>HTTP / 304 Not Modified</strong> response for unchanged content.  Although there is still a need for a request, a significant increase in performance can be achieved since the server will not need to transfer the resource to the client. <br><br><h4>  Optimization of functions Forward / Back </h4><br>  In IE9, we made a number of improvements so that the ‚ÄúForward‚Äù and ‚ÄúBack‚Äù buttons lead to a quick load. <br><br>  RFC2616 specifically indicates that the forward / backward mechanism of browsers should not be cached: <br><blockquote>  History and caching mechanisms are different mechanisms.  In practice, history mechanisms <strong>should not</strong> attempt to show the current state of a resource.  On the contrary, the mechanisms of history should show exactly what the user saw during the time when he visited the resource. <br><br>  By default, the expiration time of the resource‚Äôs relevance should not be relevant to the history mechanisms.  If an entity remains in the repository, the history mechanism <strong>must</strong> display it, even if the entity is expired, unless the user specifically configures the agent to update expired documents. <br></blockquote><br>  In previous versions of IE, when a user went forward or backward, IE checked for resource updates if they were sent with the <strong>must-revallidate</strong> cache directive and depending on some other parameters of how the resource was obtained.  In IE9, the <a href="http://msdn.microsoft.com/en-us/library/aa383661(VS.85).aspx" rel="nofollow">INTERNET_FLAG_FWD_BACK</a> flag is used and IE will not check the relevance of cached resources when the user goes forward / backward. <br><br>  As a result of this optimization, Internet Explorer 9 can perform significantly fewer conditional HTTP requests while the functions are running forward / backward.  For example, the following table shows the increase in performance compared to previous behavior: <br><br><table border="1"><tbody><tr><td>  - </td><td width="154">  <b>IE8</b> <br></td><td width="173">  <b>IE9</b> <br></td><td width="201">  <b>Improvement</b> <br></td></tr><tr><td width="133">  <b>Navigation forward / backward</b> <br></td><td width="154">  Number of requests: <br><br>  21 <br><br>  Bytes are transferred: <br><br>  12,475 <br><br>  Bytes received: <br><br>  216,580 <br></td><td width="173">  Number of requests: <br><br>  one <br><br>  Bytes are transferred: <br><br>  325 <br><br>  Bytes received: <br><br>  144,617 <br></td><td width="201">  Number of requests: <br><br>  -20 <b>(-95%)</b> <br><br>  Bytes are transferred: <br><br>  -12,150 <b>(-97.4%)</b> <br><br>  Bytes received: <br><br>  -71,963 <b>(-33.3%)</b> <br></td></tr></tbody></table><br>  After I talked about the fact that we ignore caching directives while navigating forward / backward, attentive readers may ask why IE9 still produces one request when the user presses the back button.  The reason is that IE does not send any cached resources to the cache.  Resources that are prohibited for caching are delivered with the <b>Cache-Control</b> directive <b>: no-cache</b> or with the <b>Expires</b> date value in the past or when the Expires date is not later than the <strong>Date</strong> header value.  For this reason, the browser has to reload such resources when the user goes forward / backward.  To increase performance and create the ability to load a resource into the cache while navigating forward / backward, simply replace <strong>Cache-Control: no-cache</strong> with <strong>Cache-Control: max-age = 0,</strong> in this case, revalidation will occur in all cases except forward / backward navigation <strong>.</strong> <br><br>  Unlike other improvements that we have described, the improvement in the ‚Äúforward / backward‚Äù operation cannot be observed in the preview version of Internet Explorer 9 Platform Preview, since it <a href="http://ie.microsoft.com/testdrive/info/WhyNoBackButton/Default.html" rel="nofollow">does not have ‚Äúforward / backward‚Äù buttons</a> . <br><br><h4>  Improvements in caching heuristics </h4><br>  According to the <a href="http://developer.yahoo.com/performance/rules.html" rel="nofollow">recommendations,</a> web developers should explicitly indicate the expiration time of their resource in order for browsers to reuse resources without having to make conditional HTTP requests for revalidation to the server.  However, many sites deliver content without information about the expiration of relevance, leaving the browser to care about the relevance of the resource. <br><br>  IE allows users to configure what should happen to content that is received without information about the expiration of relevance.  In the Tools&gt; Internet Options&gt; Browsing history&gt; Settings settings, you can find four options: <br><br><img title="image" alt="image" src="http://microgeek.ru/upload/blog/ie/255/255c2be1856f8563936999c4289bc8e4.png" width="324" height="135"><br><br>  These options offer the following behavior: <br><br><table border="1" cellpadding="2" width="600"><tbody><tr><td width="200">  Every time I visit the webpage <br></td><td width="200">  Resources with no explicit time information of relevance are marked as outdated and will be reloaded with the server before each use. </td></tr><tr><td width="200">  Every time I start Internet Explorer <br></td><td width="200">  Any resource without explicit information about the time of relevance validates with the server at least once per session (and every 12 hours in this session) </td></tr><tr><td width="200">  Automatically (Default) <br></td><td width="200">  IE will use the heuristics mechanism to determine relevance. </td></tr><tr><td width="200">  Never <br></td><td width="200">  Any cached resource will be flagged as relevant and will not be reevaluated. </td></tr></tbody></table><br>  These options control the behavior of the browser <em>only</em> when the content is received without information about the period of relevance.  If the content is specified with an explicit rule (for example, <b>Cache-Control: max-age = 3600</b> or <b>Cache-Control: no-cache</b> ), then the browser will use these server rules and these options will have no effect. <br><br>  In previous versions of IE, automatic heuristics were simple and <a href="http://msdn.microsoft.com/en-us/library/bb250442.aspx" rel="nofollow">only</a> affected <a href="http://msdn.microsoft.com/en-us/library/bb250442.aspx" rel="nofollow">cached images</a> , but IE9 made improvements in heuristics according to RFC2616: <br><blockquote>  If the answer contains the Last-Modified value, then the heuristic value of the time of relevance <strong>must</strong> not be greater than the interval from this value of time.  A typical value should be 10% of this interval. <br></blockquote><br>  If IE9 obtains a resource that can be cached without a fixed relevance lifetime value, the heuristic validity period is calculated as follows: <br><br>  <em>max-age = (DownloadTime - LastModified) * 0.1</em> <br><br>  If the Last-Modified header is not in the server's response, then IE will apply the ‚ÄúOnce per browser session‚Äù revalidation behavior (once per session). <br><br>  As a result of improved heuristic caching, IE9 can produce fewer conditional HTTP requests when reloading most pages.  For example, the following table shows the improvement obtained when visiting a regular article on a popular site: <br><br><table border="1" cellpadding="2" width="600"><tbody><tr><td>  - </td><td width="100">  IE8 <br></td><td width="100">  IE9 <br></td><td width="100">  Improvement <br></td></tr><tr><td width="100">  Re-visit to new browser session (PLT2) </td><td width="100">  Number of requests: <br><br>  42 <br><br>  Bytes are transferred: <br><br>  26050 <br><br>  Bytes received: <br><br>  220681 </td><td width="100">  Number of requests: <br><br>  2 <br><br>  Bytes are transferred: <br><br>  1134 <br><br>  Bytes received: <br><br>  145217 </td><td width="100">  Number of requests: <br><br>  <strong>-40 (-95.3%)</strong> <br><br>  Bytes are transferred: <br><br>  <strong>-24916 (-95.6%)</strong> <br><br>  Bytes received: <br><br>  <strong>-75464 (-34.2%)</strong> </td></tr></tbody></table><br>  The caching inspector in Fiddler will show you when the answer loses relevance based on the response headers.  For example, below is what you see in the response, which contains the ETAG and the Last-Modified header, but does not contain information about the relevance period: <br><br><img title="image" alt="image" src="http://microgeek.ru/upload/blog/ie/46d/46d0fd6869778d06b2bef2286047ad3d.png" width="551" height="218"><br><br><h4>  Other network improvements </h4><br>  In this post, I have listed the improvements in the Internet Explorer caching code that help make sure the best use of the network by websites.  Of course, web developers should continue to follow the recommendations and specify the behavior for caching using the Expires and Cache-Control headers, but even if sites don't do this, they will still load much faster in IE9. <br><br>  In the following articles, I will describe the other improvements that we made in the IE9 network stack for even faster loading pages. </div><p>Source: <a href="https://habr.com/ru/post/99432/">https://habr.com/ru/post/99432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99423/index.html">Pissing off 2.0</a></li>
<li><a href="../99425/index.html">On a laptop in heat in the sun? Will it survive the iron?</a></li>
<li><a href="../99426/index.html">Brief history of computer iconography</a></li>
<li><a href="../99430/index.html">Overview of the GPS navigator NEC GPS 434B</a></li>
<li><a href="../99431/index.html">Correct PHP error handling</a></li>
<li><a href="../99435/index.html">How much time does it usually take you to go to work (one way)?</a></li>
<li><a href="../99437/index.html">Laptop Lenovo W701 or Why do I need a steam locomotive at home</a></li>
<li><a href="../99439/index.html">Connecting Sberbank Internet Client to Ubuntu via rdesktop</a></li>
<li><a href="../99440/index.html">500 million Facebook users</a></li>
<li><a href="../99441/index.html">Readers do not want to pay for electronic Times</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>