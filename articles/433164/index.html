<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast & Furious: Forza Horizon 4 acceleration due to window shaders</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gareth Harwood - Technical Art Director of the Playground Games 

 The action of Forza Horizon 4 takes place in beautiful Britain, filled with instant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast & Furious: Forza Horizon 4 acceleration due to window shaders</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33d/7eb/d63/33d7ebd6329f3c8d50c3f25d84501c06.jpg" alt="image"></div><br>  <em><strong>Gareth Harwood - Technical Art Director of the Playground Games</strong></em> <br><br>  The action of <em>Forza Horizon 4</em> takes place in beautiful Britain, filled with instantly recognizable places and sights, including the model of the city of Edinburgh in the Playground Games version. <br><br>  In most open world games, particular attention needs to be paid to the speed of data streaming, and <em>Forza Horizon 4</em> with its detailed and variegated city is no exception.  Edinburgh buildings needed new resources for assembling resources, rendering, and engine functionality to load models while driving at 300 miles per hour. <br><a name="habracut"></a><br><h1>  A modular solution that reduces memory load </h1><br>  The buildings were created by reference from the real world.  To do this, it was necessary to take a picture and make a lot of houses, but we can create and physically store a limited number of buildings on the disk.  To cope with this limitation, while maintaining the variability, <strong>we created an interchangeable modular set of objects that are added to buildings</strong> ;  These include objects such as window frames, entrances, antennas and security alarms.  We also provided the ability to change the colors and shades of parts of these objects.  Such a system was ideal for creating a series of houses with terraces, each of which has a door of its own color. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d2/bcb/fc0/9d2bcbfc023261b85c8a76d53c48f8b5.jpg"></div><br>  In Edinburgh, we needed to create a huge number of buildings in a relatively small area.  Loading these buildings for a small part of our open world significantly increased the amount of memory required.  To cope with this, we built buildings from modules taken from first-floor libraries, upper floors, and roofs, which could be connected in various ways, obtaining variability and an interesting picture with low memory requirements. <br><br>  In addition, it allowed us to shift the complexity of the models closer to the first floors;  The windows next to which the player passes are more detailed than the roofs, which are visible only from a distance.  Unique buildings like the Scott Monument and the National Gallery in combination with modular buildings <strong>reduce the monotony of the picture, while at the same time maximizing reuse of resources and variability</strong> . <br><br><h1>  Implement parallax textures </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/710/9b0/506/7109b05063cf8eeff856b8b8e2fff196.jpg"></div><br>  Realistic worlds have always been a strong feature of <em>Forza Horizon</em> games, and one of the ways to create them was to add interiors to buildings. <br><br>  We knew that in <em>Forza Horizon 4,</em> Edinburgh would be so densely built and detailed that physically modeled interiors would create an overload.  Therefore, we decided to use another technique called ‚Äúparallax textures‚Äù.  <strong>They gave us a huge advantage when creating interiors.</strong>  <strong>When baking them in texture, they are not limited by the number of polygons and the complexity of the materials</strong> .  Rendering such textures is less expensive than creating geometry, so there can be more interiors in the game.  Previously, it was necessary to close the windows with curtains or shade them, but now we have completely parallax interiors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/029/05f/5ef/02905f5ef40802b0ebaf3e722d186834.jpg"></div><br>  The materials of the parallax interiors consist of three layers, each of which is individually chosen by the artists for each of the windows.  Since each layer has several different variations, they create hundreds of possible external views for each window, even if a small amount of texture atlases is used. <br><br>  The first layer is simple, it contains only the window frame and glass.  He adds such nuances as stained glass and lead glass, typical of old British architecture.  This layer has diffuse, alpha, roughness, metalness and normal pass.  The normal pass contains a variation of each stained glass to add a realistic variation of the angles of reflection of glass, which is particularly noticeable in old stained glass windows. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35d/0dd/fd8/35d0ddfd863eebaad7e5d2a279750a52.jpg"></div><br>  The second layer is used for curtains or curtains.  They have diffuse and alpha, as well as a light-transmitting texture, which is used at night to show the thickness of the curtains.  We have thick curtains that do not let in light, translucent curtains, and even curtains with decorations that we created from holes that partially let in light. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/162/91c/fde/16291cfde7ef2bc0842a9e4d084f2c4a.jpg"></div><br>  In the last layer, all the shader magic is created - it consists of a flat texture imitating a three-dimensional interior.  The interiors are first modeled in 3D at the same scale, and then rendered in a unique texture format supported by our shaders of parallax interiors.  As in all other layers, we in this layer create atlases containing up to eight different interiors of the same style in order to reduce the number of draw calls. <br><br>  We have several village atlases that are rendered on village houses, atlases for town houses, as well as several atlases of commercial establishments that are superimposed on shops, restaurants, and classic British pubs.  We also have two main depths of interiors.  One is for standard rooms, the other is for shallow windows.  Artists can choose which part of the atlas they want to use for each window of the building, and then set the materials using the properties of the polygonal model of each window. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f22/9d5/380/f229d53800397bbb5c05f54ba5078ef5.jpg"></div><br>  <strong>The shader calculates the angle at which the player looks into the room, and changes the UV coordinates so that he sees only that part of the interior that would be visible at this angle.</strong>  This technique has several limitations that we dealt with. <br><br>  First, the shader trick becomes noticeable at very sharp corners.  In such boundary cases, we increased the natural Fresnel effect of glass to show more reflected image than the interior.  Second, as the corners increase, the details in the center of the room begin to distort.  We reduced this effect by shifting accents to walls and corners, darkening the floor.  As in real life, the parallax effect allows you to reduce lines that fall into one focal point.  In our images, we took advantage of this by maximizing the use of parallel lines: in tiles, bookshelves, wooden flooring and wallpaper patterns. <br><br>  Each interior texture also has a lighting texture for evening light.  Thanks to the benefits of baking the texture, we could use any number of light sources, because as a result they all turn out to be written into the texture.  Each building has variations with lights on and off. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33d/7eb/d63/33d7ebd6329f3c8d50c3f25d84501c06.jpg"></div><br>  Artists were free to choose any combination of windows, curtains, and interior, but they followed simple rules: bedrooms are usually located on the upper floors, you cannot use the same rooms in each window, and there are no stairs leading up on the upper floors.  We also considered how convincing each room is.  For example, we could not have a small two-bedroom cottage in which ten or more windows lead to different rooms, so the artists created the windows so that they looked like different parts of the same room. <br><br>  Finally, to improve performance when the player was removed from the building, we needed to reduce not only the complexity of the mesh, but also the complexity of the shaders and materials.  To do this, we turned off the parallax effect and replaced the window with a flat image containing in one layer a window, curtains and an interior.  Replacement occurs when the window takes up little space on the screen and is unnoticeable to the player. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e10/1e3/58b/e101e358be34bbcb93d21fcbc2fc96d5.jpg"></div><br>  Regardless of whether you are traveling leisurely around Edinburgh in your vintage roadster, looking at each storefront, or traveling at a speed of 300 miles per hour on a supercar for one million pounds, <em>Forza Horizon 4</em> will recreate a beautiful, realistic and interesting environment.  Each technology, rendering method, shader and texture work in harmony, creating one of the most technically complex parts of the <em>Forza Horizon 4</em> card. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cc/3ca/a08/8cc3caa080fa7f58fa6507c8a3fc2457.jpg"></div><br><br>  <i>From the translator: for greater clarity, I found a video that shows the interiors of the game.</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/J77tEV369G4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/433164/">https://habr.com/ru/post/433164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433146/index.html">[Competition] Top 25 game consoles (shake old)</a></li>
<li><a href="../433152/index.html">Transferring Zimbra from a single server to a multi-server infrastructure</a></li>
<li><a href="../433154/index.html">User experience in 5G NR networks expected in real conditions</a></li>
<li><a href="../433156/index.html">Dell goes to the exchange and heading for a hybrid cloud</a></li>
<li><a href="../433158/index.html">Musical parodies from SUSE about Kubernetes, Linus Torvalds and others</a></li>
<li><a href="../433166/index.html">Predicting the time to solve a ticket using machine learning</a></li>
<li><a href="../433168/index.html">Why does a programmer have an internship in the kitchen - a conversation with ‚ÄúDodo Pizza‚Äù about gembu, .NET and openness</a></li>
<li><a href="../433170/index.html">How did we fail to remake the architecture of the company</a></li>
<li><a href="../433172/index.html">Screwing multiplayer to the mobile game "Make a word from a word" on iOS and Android, written in C ++</a></li>
<li><a href="../433176/index.html">Docker Remote API with certificate authentication with revocation checking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>