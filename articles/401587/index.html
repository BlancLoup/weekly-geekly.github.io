<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operator Panel (HMI) with I2C Bus for Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of working with some kind of arduino-compatible equipment (about him at the end) I needed a screen with buttons to control and display current...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operator Panel (HMI) with I2C Bus for Arduino</h1><div class="post__text post__text-html js-mediator-article">  As part of working with some kind of arduino-compatible equipment (about him at the end) I needed a screen with buttons to control and display current information.  That is, the operator panel was needed, it is HMI. <br><br>  It was decided to make the HMI independently, and use the ‚Äúsquare‚Äù i2c bus as the interface. <br><br><img src="https://habrastorage.org/files/3e6/4e6/24e/3e64e624ed5741d9a37eea535359c671.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are interested in the process of developing and programming such devices, welcome to Cat. <br><a name="habracut"></a><br>  Specifications: <br><br><ul><li>  Display 1602, monochrome 16x2 characters </li><li>  5 buttons: up, down, cancel, enter, edit </li><li>  I2c interface </li><li>  DB9F Connector </li><li>  Dimensions 155x90x44 mm </li></ul><br>  There will be obvious questions: <br><br><div class="spoiler">  <b class="spoiler_title">Why not buy ready shild?</b> <div class="spoiler_text">  Of course, it was possible for the same Chinese to buy a ready-made shield with a display and keyboard and the type of this: <br><img src="https://habrastorage.org/files/c7b/06a/03d/c7b06a03dff44d12bf25dddc779b2a82.jpg"><br>  To this shield you can solder 2 FC-113 scarves and it will functionally the same as mine: a display with a keyboard, working on i2c.  Price set from $ 4. <br><br>  But on this board, the size of the buttons does not suit me, but I wanted big ones, with the ability to install multi-colored caps.  I wanted to connect the Arduino to the HMI not on snot, but through a normal DB9F connector, which means it was necessary to make a connection board.  And in this case, what's the difference, to make one board or two?  In addition, I already had a few 1602 displays in stock, and therefore I only needed to spend $ 1.02 to buy the FC-113 board ($ 0.55) and the PCF8574P port extender ($ 0.47) on Aliexpress. <br><br>  Well, and most importantly, if you are dealing with Arduino, then making shields yourself is a matter of course for him, right? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Why bus i2c, is not it easier to connect the buttons directly?</b> <div class="spoiler_text">  In the field of automated process control systems where I work, HMIs use RS-232, RS-485, CAN, etc. interfaces to communicate with devices.  Therefore, it is logical for me that my self-made HMI will <i>all</i> work on the data interface, in this case on i2c. <br><br>  If I had made a device where the display runs on a square bus, and the buttons go directly to the Arduino entrance, this would give me a feeling of deep dissatisfaction.  How to present this picture: from the panel sticks out a separate lace on the interface, separate wires at the entrance, brrrr ... <br><br>  In addition, the difference between the button board, which goes directly to the Arduino inputs, and the button board with the i2c interface, is only in the PCF8574P chip ($ 0.47), a capacitor, and two resistors. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Why are the buttons located so and not otherwise?</b> <div class="spoiler_text">  The buttons on my left to right have the following functions: up, down, cancel, enter, edit. <br>  The ‚Äúedit‚Äù button is moved away from the rest slightly to emphasize its function ‚Äî changing the values ‚Äã‚Äãof logical parameters (on / off) or switching to editing mode in the case of numeric parameters. <br><br>  Total buttons 5, although the chip on the keyboard board allows you to connect up to 8 pieces. <br>  It would be enough to do with four buttons and the functionality would not hurt, ‚Äúinput‚Äù and ‚Äúediting‚Äù can be combined in one button.  But I just felt sorry that half of the 8 legs of the port extender chip will not be used. <br>  Another separate ‚Äúediting‚Äù button can be useful if I decide to display several parameters on one line.  Then this button will be able to switch between the parameters, indicating which one needs to be changed.  This is how the SET button works in the popular Chinese HMI OP320. <br><br>  If the first two buttons mean up and down, then why not place them vertically, as, for example, done in the above Chinese shield? <br><br>  For me personally, it is more convenient when all the buttons are horizontally, then during operation, the fingers move only in one plane. <br></div></div><br><h4>  <b>Iron</b> </h4><br><img src="https://habrastorage.org/files/fdf/110/dee/fdf110deea844523baaf7fed5e5d7f67.jpg"><br><br><img src="https://habrastorage.org/files/d2e/39d/084/d2e39d0848924a5b9d2d3e1e8952462c.jpg"><br><br>  1. Homemade interconnect board with DB9F connector.  So, as we take + 5V power supply for port and display extenders, we take it from Arduino, put a fuse 0.1 A on the board. <br><br>  2. We all know the well-known 1602 display with a soldered FC-113 board, which connects the display to the i2c bus. <br><br>  3. A homemade keyboard card with a PCF8574P microchip that will read the states of the buttons and transfer them over the i2c bus.  By the way, the FC-113 ‚Äúdisplay‚Äù board is also based on the PCF8574 chip, only with the T index, i.e.  planar, not DIP, like PCF8574P. <br><br>  I put the buttons 12x12mm with a square pusher; you can put on them large multi-colored caps. <br><br><div class="spoiler">  <b class="spoiler_title">Photos and homemade circuit boards</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d9a/41d/043/d9a41d0435244acc995795055522501c.jpg"><br><br><img src="https://habrastorage.org/files/a8a/faa/a15/a8afaaa15f16482a8eac22c8a99f5db2.jpg"><br><br><img src="https://habrastorage.org/files/693/76e/475/69376e475bc4455da8658553b0edbd1c.jpg"><br></div></div><br>  It should say a few words about the PCF8574P microcircuit, on the basis of which I made a keyboard board. <br>  PCF8574P is a port extender with i2c interface.  In total there are 8 ports, each of which can be configured to work as an input or output.  For this chip and strapping as such is not required (remember, for example, max232), I just in case put a capacitor on the power supply. <br><br>  The address of the PCF8574P chip is set using the address legs A0, A1, A2, which pull to the ground or to the power through a 10 kŒ© resistor. <br><br>  On the keyboard board, I put all the address feet of the PCF8574P on the ground, so the address is hard-coded as 0x20 and cannot be changed. <br><br>  As I already wrote, I chose the DB9F as the connector for the HMI.  Arduino receives signals from it +5 V, GND, SDA, SCL. <br><br><img src="https://habrastorage.org/files/b9b/46d/b11/b9b46db117ea4418acc54be7f35db069.jpg"><br><br>  The wire for communication on i2c Arduino and HMI made 1.4 m long, works without glitches. <br><br>  He drew the boards in Sprint Layout 6, transferred it by LUT to textolite and etched it in a solution of peroxide and citric acid. <br><br><div class="spoiler">  <b class="spoiler_title">Little about etching</b> <div class="spoiler_text">  There are many recipes for etching citric acid boards on foiled fiberglass laminate online. <br><br>  I made such a solution: 100 ml of hydrogen peroxide 3%, 50 g of citric acid, 3 teaspoons of salt.  A jar of peroxide was heated in a saucepan with water to a temperature of about 70 degrees. <br><br>  We immerse the board in the solution by drawing down, as recommended by etching with peroxide. <br>  After a couple of tens of seconds, the rapid process begins.  There is a lot of steam, which is not recommended to inhale.  Probably. <br><br><img src="https://habrastorage.org/files/54a/f92/248/54af9224862547c1a6e41f57d73c0794.jpg"><br><br>  Then the process subsides.  Turn over the board. <br><br><img src="https://habrastorage.org/files/e84/801/c1a/e84801c1a7bc43e998f586b8241b202a.jpg"><br><br>  Is done. <br><br><img src="https://habrastorage.org/files/101/9ec/44e/1019ec44edc945559d4f6b02514077c5.jpg"><br></div></div><br>  The body made a friend of plexiglass 4 mm on a laser cutting machine. <br><br><div class="spoiler">  <b class="spoiler_title">Lyrical digression about the corps</b> <div class="spoiler_text">  Buy a finished case or do it yourself?  A little thought, I decided to do it myself.  Those that I saw on sale did not suit me either for the price, or for aesthetic reasons, or were on a DIN-rail, which also did not suit me. <br><br>  Initially, the body wanted to cut out of plywood.  But then I remembered that I have a wonderful friend and, for my great joy, the director of the company for the production of sports awards.  He has all sorts of machines there, including for laser cutting. <br><br>  I asked for help and my friend did not refuse; in a couple of minutes the laser cut the parts. <br><br>  Taking this opportunity, I want to say, thank you, Kolya!  Otherwise, I would have to cut and grind plywood for a whole day, and the result would hardly have been so brilliant. </div></div><br>
<h4>  <b>Programming</b> </h4><br>  From the point of view of Arduino, this HMI consists of 2 devices that operate on the i2c bus: a display (LCD) with the address 0x27 and a keyboard with the address 0x20.  Accordingly, the Arduino will work separately with the keyboard and separately with the LCD. <br><br>  Work with LCD is carried out through a special library "LiquidCrystal_I2C.h", it must be installed in the Aduino IDE. <br><br>  The keyboard is handled through the standard Wire.h library, which is originally available in the Aduino IDE. <br><br>  Connect HMI to Ardiuno. <br><br><img src="https://habrastorage.org/files/cd7/c58/0c1/cd7c580c192e4cac95a2eda6d5cd8756.jpg"><br><br>  1. First, check to see if Arduino sees our HMI.  To do this, we load into it a program that will scan the i2c bus for the presence of devices on it. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch 1, i2c tire scan</b> <div class="spoiler_text"><pre><code class="hljs pgsql">//i2c_scaner #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; String stringOne; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-type"><span class="hljs-type">Serial</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { byte error, address; <span class="hljs-type"><span class="hljs-type">int</span></span> nDevices; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Scanning..."); nDevices = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(address = <span class="hljs-number"><span class="hljs-number">1</span></span>; address &lt; <span class="hljs-number"><span class="hljs-number">127</span></span>; address++ ) { Wire.beginTransmission(address); error = Wire.endTransmission(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error == <span class="hljs-number"><span class="hljs-number">0</span></span>) { String stringOne = String(address, HEX); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0x"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(stringOne); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" - "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0F") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1E") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'HMC5883 3-Axis Digital Compass'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5C") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BH1750FVI digital Light Sensor' OR 'Touch Sensor" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="20") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter' "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="21") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="22") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="23") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'BH1750FVI digital Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="24") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="25") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="26") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="27") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter '"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="39") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'TSL2561 Ambient Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="40") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor'" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="48") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="49") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit' OR 'SPI-to-UART'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="50") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'AT24C32 EEPROM'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="53") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="68") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'DS3231 real-time clock' OR 'MPU-9250 Nine axis sensor module'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="7A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="76") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="77") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor' OR 'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="78") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'" ); nDevices++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error==<span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Unknow error at address 0x"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(address,HEX); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nDevices == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("No I2C devices found\n"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("done\n"); delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>); }</code> </pre> <br></div></div><br>  During the execution of this program, Arduino will write the i2c bus scan results to the serial port.  To view this data, go to Tools-&gt; Port Monitor in the Arduino IDE. <br><br><img src="https://habrastorage.org/files/cb1/fe9/19c/cb1fe919c65f484bb7d431cae64e87ec.jpg"><br><br>  We see that Arduino on the i2c bus has identified two devices with addresses 0x20 and 0x27, this is the keyboard and LCD, respectively. <br><br>  2. Now let's see how our keyboard works.  Create a program that will poll the state of the buttons and display it on the LCD. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch 2, displaying the status of buttons</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     i2c LCD    FC-113,  0x27      PCF8574P,  0x20 */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; #define led <span class="hljs-number"><span class="hljs-number">13</span></span> #define ADDR_KBRD <span class="hljs-number"><span class="hljs-number">0x20</span></span> #define ADDR_LCD <span class="hljs-number"><span class="hljs-number">0x27</span></span> byte dio_in; <span class="hljs-type"><span class="hljs-type">bool</span></span> b; <span class="hljs-type"><span class="hljs-type">bool</span></span> key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; LiquidCrystal_I2C lcd(ADDR_LCD,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(led, OUTPUT); // lcd.init(); lcd.backlight();//    // Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); Wire.beginTransmission(ADDR_KBRD); Wire.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(B11111111); //   PCF8574P     Wire.endTransmission(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { Wire.requestFrom(ADDR_KBRD,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Wire.available()); byte dio_in = Wire.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //   PCF8574P() //      byte mask=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>;i++) { key[i]=!(dio_in &amp; mask); mask=mask&lt;&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>; } b=!b; digitalWrite(led, b); //    //    LCD lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(key[<span class="hljs-number"><span class="hljs-number">0</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">1</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">2</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">3</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">4</span></span>])+" "); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/450/92f/cf3/45092fcf30ff4986bacf1bf3891ff58e.jpg"><br><br>  The keyboard works. <br><br>  3. Finally, you can move on to what it was all about ‚Äî the creation of a multi-level menu in Arduino.  Through the menu we will not only look at the information, but also manage the outputs of the Arduino itself. <br><br><img src="https://habrastorage.org/files/570/c95/a3b/570c95a3b830423e827c7ac3b68605bf.jpg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xBZAx9ewLq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Nete ‚Äã‚Äãhas a lot of information on creating a multi-level menu in C ++, and for Arduino I even saw some libraries.  But I decided in my program to write the menu myself.  First, the smaller the left libraries in the project, the calmer.  And secondly, it's easy. <br><br>  I got another variation of the tree menu.  The menu allows you to display in each line both static text and a variable value.  For example, you can display the name of the parameter and its value. <br><br>  To display variables on the screen, I apply the principle of tags - in a certain way decorated text labels in the text, instead of which, when the text is displayed, a value is displayed on the screen. <br><br>  Parameters can be changed by pressing the ‚ÄúEdit‚Äù button.  Moreover, the tag of each parameter indicates whether it is available for editing or only for reading.  If the current parameter is read-only, at the beginning of the line the pointer will be '*', if editing the parameter is allowed, the pointer will become '+'. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch 3, multi-level menu</b> <div class="spoiler_text"><pre> <code class="hljs markdown">/<span class="hljs-bullet"><span class="hljs-bullet">*  ,    LCD   i2c LCD    FC-113,  0x27      PCF8574P,  0x20 *</span></span>/ #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LiquidCrystal_I2C.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wire.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #define led 13 //    ;  ,  ,     #define ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD 0x20 #define ADDR_</span></span>LCD 0x27 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2 2 #define PORT_</span></span>D3 3 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4 4 #define POINT_</span></span>ON<span class="hljs-emphasis"><span class="hljs-emphasis">_ROOT_</span></span>MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM 0 // 0/1= /   (*  +)     byte dio_</span></span>in; bool b; byte i; //bool ,      bool BoolVal[<span class="hljs-string"><span class="hljs-string">9</span></span>]={0,0,0, 0,0,0, 0,0,0}; #define ValSvet1 BoolVal[<span class="hljs-string"><span class="hljs-string">0</span></span>] #define ValSvet2 BoolVal[<span class="hljs-string"><span class="hljs-string">1</span></span>] #define ValSvet3 BoolVal[<span class="hljs-string"><span class="hljs-string">2</span></span>] #define ValRozetka1 BoolVal[<span class="hljs-string"><span class="hljs-string">3</span></span>] #define ValRozetka2 BoolVal[<span class="hljs-string"><span class="hljs-string">4</span></span>] #define ValRozetka3 BoolVal[<span class="hljs-string"><span class="hljs-string">5</span></span>] #define ValClapan1 BoolVal[<span class="hljs-string"><span class="hljs-string">6</span></span>] #define ValClapan2 BoolVal[<span class="hljs-string"><span class="hljs-string">7</span></span>] #define ValClapan3 BoolVal[<span class="hljs-string"><span class="hljs-string">8</span></span>] // struct STRUCT<span class="hljs-emphasis"><span class="hljs-emphasis">_KEY{ bool StateCur; //   bool StateOld; //     bool Imp; //   (  0  1) }; // STRUCT_</span></span>KEY Key[<span class="hljs-string"><span class="hljs-string">5</span></span>]={0,0,0, 0,0,0, 0,0,0, 0,0,0, 0,0,0 }; //--- /<span class="hljs-emphasis"><span class="hljs-emphasis">*   *</span></span>  , : <span class="hljs-bullet"><span class="hljs-bullet">* '#A1' bool ,  *</span></span> '#'-   bool, <span class="hljs-bullet"><span class="hljs-bullet">* 'A'- (HEX)    BoolVal, *</span></span> '1'-    <span class="hljs-bullet"><span class="hljs-bullet">*   ,       *</span></span>/ String StrNull=" "; //  String StrRoot1="COMP-MAN.INFO"; String StrRoot2="PLC-BLOG.COM.UA"; String StrSvet= ""; // String StrSvet1=" 1 #01"; String StrSvet2=" 2 #10"; String StrSvet3=" 3 #21"; String StrRozetka=""; // String StrRozetka1=" 1 #30"; String StrRozetka2=" 2 #40"; String StrRozetka3=" 3 #50"; String StrClapan=""; // String StrClapan1=" 1 #60"; // String StrClapan2=" 2 #70"; String StrClapan3=" 3 #80"; struct MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM // (),   2        { byte KeyUp; //‚Ññ  ,     "" byte KeyDwn; //‚Ññ  ,     "" byte KeyCancel; //‚Ññ  ,     ""(cancel) byte KeyEnter; //‚Ññ  ,     ""(enter) byte KeyEdit; // "edit",  String *pstr1; //    () String *pstr2; //    () }; // MENU_</span></span>ITEM Menu[<span class="hljs-string"></span><span class="hljs-string"></span>]={0,0,0,1,0, &amp;StrRoot1,&amp;StrRoot2, //0   1,8,0,2,0, &amp;StrSvet,&amp;StrRozetka, //1  2,3,1,2,0, &amp;StrSvet1,&amp;StrSvet2, //2 2,4,1,3,0, &amp;StrSvet2,&amp;StrSvet3, //3 3,4,1,4,0, &amp;StrSvet3,&amp;StrNull, //4 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //5  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //6 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //7 1,15,0,9,0, &amp;StrRozetka,&amp;StrClapan, //8  9,10,8,9,0, &amp;StrRozetka1, &amp;StrRozetka2, //9 9,11,8,10,0, &amp;StrRozetka2, &amp;StrRozetka3, //10 10,11,8,11,0, &amp;StrRozetka3, &amp;StrNull, //11 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //12  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //13 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //14 8,15,0,16,0, &amp;StrClapan, &amp;StrNull, //15  16,17,15,0,0, &amp;StrClapan1,&amp;StrClapan2, //16 16,18,15,0,0, &amp;StrClapan2,&amp;StrClapan3, //17 17,18,15,0,0, &amp;StrClapan3,&amp;StrNull, //18 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //19  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //20 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //21 }; byte PosMenu=0; //  LiquidCrystal<span class="hljs-emphasis"><span class="hljs-emphasis">_I2C lcd(ADDR_</span></span>LCD,16,2); //   //   void ReadKey(byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in) { //      byte mask=1; for(i=0; i&lt;5; i++) { Key[i].StateCur=!(dio_</span></span>in &amp; mask); mask=mask<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">!Key[i].StateOld</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateCur</span></span></span></span><span class="xml"><span class="hljs-tag">; //   (  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateOld</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Key[i].StateCur;</span></span></span></span><span class="xml"><span class="hljs-tag"> } } /* *  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">UTF-8</span></span></span></span><span class="xml"><span class="hljs-tag">   ( )   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LCD</span></span></span></span><span class="xml"><span class="hljs-tag"> *       */ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag">]= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">144</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x41</span></span></span></span><span class="xml"><span class="hljs-tag">, // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">145</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">146</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x42</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">147</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">148</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">149</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x45</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">129</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">150</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa3</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">151</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">152</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa5</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">153</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa6</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">154</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4b</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">155</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa7</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">156</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">157</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x48</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">158</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4f</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">159</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa8</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">160</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x50</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">161</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x43</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">162</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x54</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">163</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa9</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">164</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">165</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x58</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">166</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">167</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xab</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">168</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xac</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">169</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xad</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">171</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xae</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">172</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xc4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">173</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaf</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">174</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">175</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb1</span></span></span></span><span class="xml"><span class="hljs-tag"> // }; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">RusStrLCD</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrIn</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.length();</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">128</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(b1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">else</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208)</span></span></span></span><span class="xml"><span class="hljs-tag"> //==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208,</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2-</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag">  { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i+1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">b1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(MasRus[y][1]);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">break</span></span></span></span><span class="xml"><span class="hljs-tag">; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">; } //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---------------------------</span></span></span></span><span class="xml"><span class="hljs-tag"> //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ASCII</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">HEX</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> dec byte StrHexToByte(char val) { byte dec=0; switch (val) { case '0': dec=0; break; case '1': dec=1; break; case '2': dec=2; break; case '3': dec=3; break; case '4': dec=4; break; case '5': dec=5; break; case '6': dec=6; break; case '7': dec=7; break; case '8': dec=8; break; case '9': dec=9; break; case 'A': dec=10; break; case 'B': dec=11; break; case 'C': dec=12; break; case 'D': dec=13; break; case 'E': dec=14; break; case 'F': dec=15; break; default: dec=0; break; } return dec; } //     void WriteLCD(byte num) { String str[]={"<span class="hljs-emphasis"><span class="hljs-emphasis">*"+*</span></span>Menu[num].pstr1,<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[num].pstr2}; if (num==0 &amp;&amp; POINT_ON_ROOT_MENU_ITEM==0) //     ? str[0].setCharAt(0,' '); // ,   //     byte NumVal; byte l; for(byte y=0; y&lt;2; y++) { l=str[y].length(); for(i=0; i&lt;l; i++) { if (str[y].charAt(i)=='#') //# bool,  off/ON { if(StrHexToByte(str[y].charAt(i+2))==1 &amp;&amp; y==0) //  ? str[y].setCharAt(0,'+'); NumVal=StrHexToByte(str[y].charAt(i+1)); str[y]=str[y].substring(0,i)+String(NumVal) ; if(BoolVal[NumVal]==0) str[y]=str[y].substring(0,i)+"off" ; if(BoolVal[NumVal]==1) str[y]=str[y].substring(0,i)+"ON" ; } if (str[y].charAt(i)=='$') //$ int,     ,      { ; } if (str[y].charAt(i)=='~') //~ ,     ,      { ; } } } //--- lcd.clear(); lcd.setCursor(0, 0); lcd.print(str[0]); lcd.setCursor(1, 1); lcd.print(str[1]); } //,       byte GoMenu(byte key) { byte PosMenuNew=PosMenu; switch (key) { case 0: PosMenuNew=Menu[PosMenu].KeyUp; break; case 1: PosMenuNew=Menu[PosMenu].KeyDwn; break; case 2: PosMenuNew=Menu[PosMenu].KeyCancel; break; case 3: PosMenuNew=Menu[PosMenu].KeyEnter; break; case 4: ; break; default: break; } return PosMenuNew; } //    "Edit" void Edit(byte posmenu) { byte NumVal; bool *</span></span>pval; String str=<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[posmenu].pstr1; byte l=str.length(); for(i=0; i&lt;l; i++) if (str.charAt(i)=='#') //#- bool,  off/ON { if(StrHexToByte(str.charAt(i+2))==1) //  ? { pval= &amp;(BoolVal[StrHexToByte(str.charAt(i+1))]); // ,    .   *</span></span>pval=!(*pval); //     } } } //     void ValToPort() { digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2,ValSvet1); digitalWrite(PORT_</span></span>D3,ValSvet2); digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4,ValSvet3); } void setup() { pinMode(led, OUTPUT); //     pinMode(PORT_</span></span>D2, OUTPUT); pinMode(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D3, OUTPUT); pinMode(PORT_</span></span>D4, OUTPUT); //    LCD StrSvet=RusStrLCD(StrSvet); StrSvet1=RusStrLCD(StrSvet1); StrSvet2=RusStrLCD(StrSvet2); StrSvet3=RusStrLCD(StrSvet3); StrRozetka=RusStrLCD(StrRozetka); StrRozetka1=RusStrLCD(StrRozetka1); StrRozetka2=RusStrLCD(StrRozetka2); StrRozetka3=RusStrLCD(StrRozetka3); StrClapan=RusStrLCD(StrClapan); StrClapan1=RusStrLCD(StrClapan1); StrClapan2=RusStrLCD(StrClapan2); StrClapan3=RusStrLCD(StrClapan3); // lcd.init(); lcd.backlight();//    WriteLCD(PosMenu); Wire.begin(); Wire.beginTransmission(ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD); Wire.write(B11111111); //   PCF8574P     Wire.endTransmission(); } void loop() { Wire.requestFrom(ADDR_</span></span>KBRD,1); while (!Wire.available()); byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in = Wire.read(); //   PCF8574P() ReadKey(dio_</span></span>in); //   //,    ;  ,      int KeyImp=-1; for (i=0; i<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">5;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>-1) //  ? { if (KeyImp==4) // "Edit" Edit(PosMenu); PosMenu=GoMenu((KeyImp)); WriteLCD(PosMenu); } b=!b; digitalWrite(led, b); //    ValToPort(); //  delay(50); }</code> </pre><br></div></div><br><h4>  <b>LCD 1602 and language issue</b> </h4><br>  Separately, you need to address the issue of Russification. <br><br>  In the character generator of some LCD 1602, there are no Russian letters, and instead of them, Japanese cracks are stitched.  Reflash character generator is not possible.  Therefore, it is necessary either to write words on the screen in Latin letters, or in the program to form Russian letters yourself, since  LCD 1602 has the ability to create and store your own characters in the LCD RAM.  But, in the latter case, you can display no more than eight ‚Äúhomemade‚Äù characters at a time. <br><br><div class="spoiler">  <b class="spoiler_title">Character Charts LCD 1602</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/91b/eed/92f/91beed92f6f0487f922c3f9834ae9a8f.png"><br><br><img src="https://habrastorage.org/files/ecf/799/4a5/ecf7994a50584faba9805df1550d6157.png"><br></div></div><br>  In principle, there is nothing terrible if you write Russian words in LCD in English letters.  Vaughn, even the venerable French company Shneider Electric (the same one that sold howitzers to the king before the revolution) for a decade and a half did not allow herself to introduce Russian into their famous Zelio programmable relays.  But this does not prevent them from actively trading in the entire CIS.  Moreover, the channel, Spanish and Portuguese have entered. <br><br>  At many of our factories, these Zelio communicate with staff with phrases like ‚ÄúNASOS 1 VKL‚Äù. <br><br>  When it is unclear whether there are Russian letters in a particular LCD, you need to display all the characters of its character generator.  If there is a Cyrillic alphabet, it begins with the 160 position. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch 4, displaying all characters from the character generator LCD 1602 table</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     * LCD    i2c */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0x27</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // put your setup code here, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run once: lcd.init(); lcd.clear(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">int</span></span> i,y; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>; i++) { lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>)+" - "+String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>)); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>;y&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;y++) lcd.print(<span class="hljs-type"><span class="hljs-type">char</span></span>(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+y)); delay(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } } }</code> </pre><br></div></div><br>  But even if your LCD 1602 is Russified, displaying Russian words is not so easy.  At least using the ‚ÄúLiquidCrystal_I2C.h‚Äù library when working with LCDs on the i2c bus. <br><br>  If you simply display the Russian text, for example, the lcd.print instruction (‚ÄúHello !!!‚Äù), then instead of ‚ÄúHello !!!‚Äù some sort of rubbish will appear on the screen. <br><br>  This is because the Arduino IDE translates the Russian letters into a two-byte UTF-8 code, and in the LCD all the characters are single-byte. <br><br>  The same problem, by the way, is observed when transferring Russian texts from Arduino to the monitor of the Arduino IDE port.  Arduino transmits Russian letters in a two-byte UTF-8 encoding to the serial port, and the Arduino IDE port monitor attempts to read them in the single-byte Windows-1251 encoding (cp1251).  Although cp1251 is also 8-bit, like the LCD encoding 1602, but it does not match. <br><br>  You can create Russian texts through character codes.  For example, the line "LCD display" on the Russified LCD will be displayed as follows: <br><br><pre> <code class="hljs swift">lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\243K \343\270c\276\273e\271"</span></span>);</code> </pre> <br>  But I do not like this approach. <br><br>  In order to correctly display the Russian text on the Russified LCD 1602, several libraries were invented for Arduino.  But after reading the reviews, I saw that many complain about glitches when using them. <br><br>  Therefore, in my multi-level menu program I myself wrote a simple function to transform UTF-8 into LCD codes.  True, he did it only for the capital Russian letters, which suits me perfectly. <br><br><div class="spoiler">  <b class="spoiler_title">The function of converting capital Russian letters UTF-8 to single-byte code LCD 1602</b> <div class="spoiler_text"><pre> <code class="hljs lua">/* *  UTF<span class="hljs-number"><span class="hljs-number">-8</span></span>   ( )   LCD *       */ <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> MasRus[<span class="hljs-number"><span class="hljs-number">33</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]= { <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, // <span class="hljs-number"><span class="hljs-number">145</span></span>, <span class="hljs-number"><span class="hljs-number">0xa0</span></span>, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">0x42</span></span>, <span class="hljs-number"><span class="hljs-number">147</span></span>, <span class="hljs-number"><span class="hljs-number">0xa1</span></span>, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">0xe0</span></span>, <span class="hljs-number"><span class="hljs-number">149</span></span>, <span class="hljs-number"><span class="hljs-number">0x45</span></span>, <span class="hljs-number"><span class="hljs-number">129</span></span>, <span class="hljs-number"><span class="hljs-number">0xa2</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0xa3</span></span>, <span class="hljs-number"><span class="hljs-number">151</span></span>, <span class="hljs-number"><span class="hljs-number">0xa4</span></span>, <span class="hljs-number"><span class="hljs-number">152</span></span>, <span class="hljs-number"><span class="hljs-number">0xa5</span></span>, <span class="hljs-number"><span class="hljs-number">153</span></span>, <span class="hljs-number"><span class="hljs-number">0xa6</span></span>, <span class="hljs-number"><span class="hljs-number">154</span></span>, <span class="hljs-number"><span class="hljs-number">0x4b</span></span>, <span class="hljs-number"><span class="hljs-number">155</span></span>, <span class="hljs-number"><span class="hljs-number">0xa7</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>, <span class="hljs-number"><span class="hljs-number">0x4d</span></span>, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">158</span></span>, <span class="hljs-number"><span class="hljs-number">0x4f</span></span>, <span class="hljs-number"><span class="hljs-number">159</span></span>, <span class="hljs-number"><span class="hljs-number">0xa8</span></span>, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">0x50</span></span>, <span class="hljs-number"><span class="hljs-number">161</span></span>, <span class="hljs-number"><span class="hljs-number">0x43</span></span>, <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-number"><span class="hljs-number">0x54</span></span>, <span class="hljs-number"><span class="hljs-number">163</span></span>, <span class="hljs-number"><span class="hljs-number">0xa9</span></span>, <span class="hljs-number"><span class="hljs-number">164</span></span>, <span class="hljs-number"><span class="hljs-number">0xaa</span></span>, <span class="hljs-number"><span class="hljs-number">165</span></span>, <span class="hljs-number"><span class="hljs-number">0x58</span></span>, <span class="hljs-number"><span class="hljs-number">166</span></span>, <span class="hljs-number"><span class="hljs-number">0xe1</span></span>, <span class="hljs-number"><span class="hljs-number">167</span></span>, <span class="hljs-number"><span class="hljs-number">0xab</span></span>, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">0xac</span></span>, <span class="hljs-number"><span class="hljs-number">169</span></span>, <span class="hljs-number"><span class="hljs-number">0xe2</span></span>, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">0xad</span></span>, <span class="hljs-number"><span class="hljs-number">171</span></span>, <span class="hljs-number"><span class="hljs-number">0xae</span></span>, <span class="hljs-number"><span class="hljs-number">172</span></span>, <span class="hljs-number"><span class="hljs-number">0xc4</span></span>, <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-number"><span class="hljs-number">0xaf</span></span>, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">0xb0</span></span>, <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-number"><span class="hljs-number">0xb1</span></span> // }; String RusStrLCD(String StrIn) { String StrOut=<span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> b1; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> y; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> l=StrIn.length(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;l; i++) { b1=StrIn.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1&lt;<span class="hljs-number"><span class="hljs-number">128</span></span>) StrOut=StrOut+<span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(b1); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1==<span class="hljs-number"><span class="hljs-number">208</span></span>) //==<span class="hljs-number"><span class="hljs-number">208</span></span>,     <span class="hljs-number"><span class="hljs-number">2</span></span>-  .  { b1=StrIn.charAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>; y&lt;<span class="hljs-number"><span class="hljs-number">33</span></span>; y++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(MasRus[y][<span class="hljs-number"><span class="hljs-number">0</span></span>]==b1) { StrOut=StrOut+<span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(MasRus[y][<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } i++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StrOut; }</code> </pre><br></div></div><br>  On this about homemade HMI with i2c bus, I have everything. <br><br>  Oh yeah, at the beginning of the article I wrote that I was doing HMI not entirely for Arduino, but for arduino-compatible equipment.  This is me about the <a href="https://controllino.biz/">CONTROLLINO MAXI</a> PLC, which is programmed from the Arduino IDE (and many others). <br><br><img src="https://habrastorage.org/files/e62/97f/16b/e6297f16bfa84a449fe1d34f629ed061.jpg"><br><br>  CONTROLLINO MAXI is actually an Arduino + a bunch of shields and everything is designed as an industrial PLC.  But about him next time. <br><br>  <b>Links</b> <br><br>  ‚Üí <a href="">Archive</a> with layouts, sketches and a printed circuit board in lay6 format <br>  ‚Üí <a href="https://controllino.biz/">Arduino-compatible PLC CONTROLLINO</a> , work with which inspired the creation of the HMI i2c <br>  ‚Üí <a href="http://adatum.ru/pcf8574-kak-legko-uvelichit-chislo-pinov-na-arduino.html">Port Expander PCF8574</a> and connect it to Arduino <br>  ‚Üí <a href="http://soltau.ru/index.php/arduino/item/372-kak-podklyuchit-lcd-displej-s-i2c-modulem-k-arduino">FC-113 board</a> for running LCD 1602 over i2c bus and connecting it to Arduino <br>  ‚Üí <a href="http://easyelectronics.ru/organizaciya-drevovidnogo-menyu.html">Multi-level tree menu</a> , general principles of creation in C <br>  ‚Üí <a href="http://i.voenmeh.ru/kafi5/Kam.loc/inform/UTF-8.htm">UTF-8 Encoding</a> <br>  ‚Üí <a href="https://ru.wikipedia.org/wiki/Windows-1251">Encoding Windows-1251</a> </div><p>Source: <a href="https://habr.com/ru/post/401587/">https://habr.com/ru/post/401587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../401575/index.html">Experts point to the failure of most of the norms of the package of laws of the Spring-Ozerov</a></li>
<li><a href="../401577/index.html">Unofficial benchmarks and prices for Ryzen processors</a></li>
<li><a href="../401579/index.html">The Supreme Court denied Google to consider the appeal on the dispute with the FAS</a></li>
<li><a href="../401583/index.html">Why was I harmful? Because I did not have an SSD! Does it make sense to put a solid-state drive in an old computer?</a></li>
<li><a href="../401585/index.html">The Council for the modernization of the economy will consider a plan for the creation of "smart" plants</a></li>
<li><a href="../401591/index.html">What is a planet?</a></li>
<li><a href="../401593/index.html">Automotive Digest: Repair, Insurance and New Technologies</a></li>
<li><a href="../401595/index.html">Physicists have learned to tighten the screws with a magnetic field</a></li>
<li><a href="../401597/index.html">Companies practice surveillance methods in the workplace</a></li>
<li><a href="../401599/index.html">How to find a job in your favorite specialty</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>