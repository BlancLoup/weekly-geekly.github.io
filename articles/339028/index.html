<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote browser 3D football. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 That was the continuation of my story about writing browser 3D football. I apologize for the long break, the blame for the work, the prod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote browser 3D football. Part 2</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  That was the continuation of my story about writing browser 3D football.  I apologize for the long break, the blame for the work, the production of borscht and other edibles for your beloved husband, the repair and everything else.  But the article itself will not write and do not read.  Therefore, all interested and have not forgotten about the first part - you are welcome under the cat. <br><br><img src="https://habrastorage.org/web/f06/37d/8f2/f0637d8f2d014d66aa0546640c39d9dd.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Just in case, the link to the first part - <a href="https://habrahabr.ru/post/337500/">As I wrote browser-based 3D football.</a>  <a href="https://habrahabr.ru/post/337500/">Part 1</a> <br><a name="habracut"></a><br>  So, the previous part ended with the fact that we had a football field and gate.  This is absolutely not enough for a full-fledged football event - <s>people</s> need football players.  Let's start with this, but first work with mistakes. <br><br><h2>  Bug work </h2><br>  In the comments to the first part, it was rightly noted that there is some violation of perspective.  I noticed it too, but I blamed it on the imperfection of Three.js itself. <br>  However, having played with the parameters of the <i>THREE.PerspectiveCamera</i> method, <i>we</i> managed to achieve a digestible result. <br><br><h4>  Before: </h4><br><pre><code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.camera = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.PerspectiveCamera(<span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth / <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre> <br><img src="https://habrastorage.org/webt/59/cf/a2/59cfa2b3d9c2c710984892.png"><br><br><h4>  After: </h4><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.camera = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.PerspectiveCamera(<span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerWidth / <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.innerHeight, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><img src="https://habrastorage.org/webt/59/cf/a2/59cfa2b3e3ab2349973821.png"><br><br>  Those.  The problem was in the first argument, which is responsible for the vertical field of view of the camera and is given in degrees.  But I want to note that the call to this method is copied from the official tutorial on Three.js - <a href="https://threejs.org/docs/">Creating a scene</a> , in which 75 is also passed. <br><br><h2>  Football Player - Static </h2><br>  But let's get back to the creation of football players.  In the previous section, the abstract class <i>FootballObject</i> was described.  It is from him that we will inherit the <i>Player</i> class: <br><br>  <b>Player.ts</b> <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Field } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./field'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FootballObject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./object'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BASE_URL } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./const'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Mesh, MeshBasicMaterial, Scene, Texture } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'three'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> enum PlayerType { DEFENDER, MIDFIELDER, FORWARD } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface IPlayerOptions { <span class="hljs-attr"><span class="hljs-attr">isCpu</span></span>: boolean; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MIN_SPEED = <span class="hljs-number"><span class="hljs-number">0.03</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_SPEED = <span class="hljs-number"><span class="hljs-number">0.07</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FootballObject</span></span></span><span class="hljs-class"> </span></span>{ protected options: IPlayerOptions; protected mesh: Mesh; protected type: PlayerType; protected startX: number; protected startZ: number; protected targetX: number; protected targetZ: number; protected speed: number; public isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; public isRun = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; public isCurrent = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ready: <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;any&gt;; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> mesh: Mesh; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(scene: Scene, options: IPlayerOptions) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(scene); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options = options; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Math</span></span></span></span><span class="hljs-function"><span class="hljs-params">.random(</span></span></span><span class="hljs-function">) * (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MAX_SPEED - MIN_SPEED</span></span></span><span class="hljs-function">) + </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MIN_SPEED</span></span></span><span class="hljs-function">); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">static</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scene: Scene</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Promise</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">any</span></span></span><span class="hljs-function">&gt; { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">if</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">!Player.ready</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Player</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ready</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Promise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.SEA3D({ <span class="hljs-attr"><span class="hljs-attr">autoPlay</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">container</span></span>: scene, <span class="hljs-attr"><span class="hljs-attr">multiplier</span></span>: <span class="hljs-number"><span class="hljs-number">.6</span></span> }); loader.onComplete = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mesh: Mesh = loader.getMesh(<span class="hljs-string"><span class="hljs-string">'Player'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hat = loader.getMesh(<span class="hljs-string"><span class="hljs-string">'Hat'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hat) { hat.visible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } mesh.scale.set(<span class="hljs-number"><span class="hljs-number">.02</span></span>, <span class="hljs-number"><span class="hljs-number">.02</span></span>, <span class="hljs-number"><span class="hljs-number">.02</span></span>); mesh.position.y = <span class="hljs-number"><span class="hljs-number">2</span></span>; mesh.visible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Player.mesh = mesh; resolve(); }; loader.load(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ BASE_URL }</span></span></span><span class="hljs-string">/resources/models/player1.sea`</span></span>); }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Player.ready; } }</code> </pre><br>  First of all, the types of football players are announced - <i>PlayerType</i> : <br><br><ul><li>  DEFENDER - Defender </li><li>  MIDFIELDER - midfielder </li><li>  FORWARD - forward </li></ul><br><br>  Next, an interface for options is defined, in this case consisting of a single field - <i>IsCpu</i> - whether this player is a member of a computer-controlled team. <br><br>  A bit about the members of the class <i>Player</i> : <br><br><ul><li>  <i>startX, startZ, targetX, targetZ</i> - determine the coordinates of the start and goal, respectively, when moving, initiated by the <i>moveTo</i> method (about it a little later) </li><li>  <i>isActive</i> - activity, allows you to "turn off" the player </li><li>  <i>isRun</i> - whether the player is running </li><li>  <i>isCurrent</i> - whether the player is the current active player of his team (in the case of the team the user is playing for - whether the player is exactly who the user is currently controlling from the keyboard) </li></ul><br>  There are two interesting points here: <br><br>  <b>The first moment</b> is that the model loading is rendered into a static method.  Initially, for each player, I downloaded my own model, because it was still cached and there was no overhead in the form of hikes on the network for each player.  And the fact that its own model was instantiated for each player was not particularly scary, except that it consumed more memory, but it was quite possible to live with it.  However, for reasons that are unclear to me, each next created instance of the <i>Player</i> class increasingly "discolored" all instances.  So much so that after creating all the instances, they became completely white, as if they had no texture: <br><br><img src="https://habrastorage.org/webt/59/d0/39/59d039ba6b700996587435.png"><br><br>  I tried different boot options, different ways to set textures, all in vain.  And then I remembered that I had read somewhere about the method of optimizing work with models in case of repeated use on the stage.  It was recommended not to load the model every time, but to clone it, which allows to reduce the amount of memory models allocated for storage.  I started to see if there is such an opportunity in Three.js and it turned out that there is - <a href="https://threejs.org/docs/index.html">Mesh (see the clone method)</a> . <br>  Add our <i>player</i> 's clone method: <br><br><pre> <code class="hljs kotlin">clone() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh = Player.mesh.clone(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene.add(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh); }</code> </pre><br>  And, lo and behold, the models ceased to ‚Äúbleach‚Äù - the problem is solved. <br><br>  <b>The second moment</b> - looking at this code <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hat = loader.getMesh(<span class="hljs-string"><span class="hljs-string">'Hat'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hat) { hat.visible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  you might think, ‚Äúhat?  Hat?  What else is a hat?  And you will be right, the hat is out of place here at all.  But I will explain to you where she came from.  Even in the first part of this article, a bit of righteous anger poured out of me about the difficulty of finding 3D models.  In particular, I looked for a football player model for a very long time, found it in formats that were not supported by Three.js, searched for a converter, converted it, loaded it onto the stage, and then it turned out that either the conversion process or the model ‚Äúbeat‚Äù and now it‚Äôs probably not football player, and a huge mantis. <br><br>  My <a href="https://threejs.org/examples/">joy knew</a> no bounds when a suitable model was found, and not somewhere, but in the section with examples of Three.js itself - <a href="https://threejs.org/examples/">loader / sea3d / skinning</a> .  This meant that the model is guaranteed, without registration and SMS you can upload to the Three.js scene and not get the artifacts generated by the converters.  But with all of this, there was one important nuance - the football player was wearing a huge straw hat: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/d0/40/59d0409058c07685002568.png" height="250"></div><br><br>  Fortunately, as can be seen from the code above, the hat was hidden and turned out to be an ordinary football player. <br><br>  In order for teams to differ in color, the player needs to be able to set a texture that is different from the one that is loaded with the model.  For these purposes we will use the <i>setTexture</i> method: <br><br><pre> <code class="hljs javascript">setTexture(textureName: string) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.TextureLoader(); loader.load(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ BASE_URL }</span></span></span><span class="hljs-string">/resources/textures/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${textureName}</span></span></span><span class="hljs-string">`</span></span>, (texture: Texture) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.material = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.material.clone(); texture.flipY = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; (<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MeshBasicMaterial</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> this.mesh.material).map = texture; }); }</span></span></code> </pre><br><h2>  Football Player - Dynamics </h2><br>  Let's make our footballers run!  This phrase could say the coach of the Russian national football team, but I pronounce it.  Therefore, my players will run guaranteed, but with our team is not so simple. <br><br>  In my case, all the players are divided into two types: <br><br><ul><li>  football player controlled by a user </li><li>  all other players </li></ul><br>  With a player who is controlled by the user, everything is clear - he moves there and then where and when the user indicates it.  If the user is inactive, then the football player is standing still. <br><br>  The rest of the players need to specify where and when they should move.  It is implemented by two methods: <i>moveTo</i> and <i>animate</i> .  The first saves the coordinates of the point to which the player must move, the second realizes this movement and is called along with the redrawing of the scene. <br><br><pre> <code class="hljs kotlin">moveTo(x: number, z: number) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startX = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startZ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.z; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetX = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetZ = z; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isRun = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } animate(options: any) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isCurrent &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isRun &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.isCpu) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.run(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isRun) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distanceX = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetX - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startX; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distanceZ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetZ - <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startZ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newX = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.x + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed * (distanceX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span> : -<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newZ = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.z + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.speed * (distanceZ &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span> : -<span class="hljs-number"><span class="hljs-number">1</span></span>); let isRun = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Field.isInsideByX(newX) &amp;&amp; ((distanceX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.x &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetX) || (distanceX &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.x &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetX))) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.x = newX; isRun = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Field.isInsideByZ(newZ) &amp;&amp; ((distanceZ &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.z &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetZ) || (distanceZ &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.z &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.targetZ))) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mesh.position.z = newZ; isRun = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isRun = isRun; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.run(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.isStarted) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleStatic(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.idleDynamic(); } }</code> </pre><br>  In animate, coordinates are calculated for the current iteration of the redraw, taking into account the speed of the player, it is checked whether the player is out of the field and the necessary animation is started - running or waiting. <br><br><h2>  Team, without which we can not live </h2><br>  Now we have the players and we can finally collect a team from them: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Player, PlayerType } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./player'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FIELD_WIDTH, FIELD_HEIGHT } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./field'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Utils } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Scene } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'three'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FootballObject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./object'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Team</span></span></span><span class="hljs-class"> </span></span>{ protected scene: Scene; protected options: ITeamOptions; protected players: Player[] = []; protected currentPlayer: Player; protected score = <span class="hljs-number"><span class="hljs-number">0</span></span>; withBall = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  The <i>players</i> array will contain all the players on the team. <br>  <i>currentPlayer</i> - link to the current active player. <br>  <i>score</i> - the number of goals scored by the team. <br>  <i>withBall</i> - a flag that determines if the team owns the ball. <br><br>  Our teams play according to the 4-4-2 scheme: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPlayersType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): PlayerType[]</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ PlayerType.DEFENDER, PlayerType.DEFENDER, PlayerType.DEFENDER, PlayerType.DEFENDER, PlayerType.MIDFIELDER, PlayerType.MIDFIELDER, PlayerType.MIDFIELDER, PlayerType.MIDFIELDER, PlayerType.FORWARD, PlayerType.FORWARD ] }</code> </pre><br>  those.  4 defenders, 4 midfielders and 2 forwards. <br><br>  Now fill our team with footballers: <br><br><pre> <code class="hljs javascript">createPlayers() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { Player.init(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> types: PlayerType[] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getPlayersType(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> promises = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Player(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scene, { <span class="hljs-attr"><span class="hljs-attr">isCpu</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.isCpu }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promise = player.clone() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.side === <span class="hljs-string"><span class="hljs-string">'left'</span></span>) { player.setRotateY(<span class="hljs-number"><span class="hljs-number">90</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { player.setRotateY(<span class="hljs-number"><span class="hljs-number">-90</span></span>); } player.setType(types[i]); player.show(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players.push(player); }); promises.push(promise); } <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(promises) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setStartPositions()); resolve(); }); }); }</code> </pre><br>  Here it can be noted that, depending on the side of the field occupied by the team (the left / right is passed in options), the players turn 90 or -90 degrees to face to the opponent's gates. <br><br>  Upon completion of the creation of all instances, the <i>setStartPositions</i> method is <i>called</i> , which places the players on the starting positions. <br><br><pre> <code class="hljs kotlin">setStartPositions() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startPositions = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getStartPositions(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players.forEach((item: Player, index: number) =&gt; { item.isRun = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (startPositions[index]) { item.setPositionX(startPositions[index].x); item.setPositionZ(startPositions[index].z); } }) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> getStartPositions() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> halfFieldWidth = FIELD_WIDTH / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> halfFieldHeight = FIELD_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.side === <span class="hljs-string"><span class="hljs-string">'left'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">1</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">4</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">7</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">9</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">1</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">4</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">7</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">9</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">2</span></span>), z: <span class="hljs-number"><span class="hljs-number">0</span></span> }, { x: <span class="hljs-number"><span class="hljs-number">0</span></span>, z: <span class="hljs-number"><span class="hljs-number">0</span></span> } ]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: - halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">1</span></span> }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: - halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">4</span></span> }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: - halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">7</span></span> }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">6</span></span>), z: - halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">9</span></span> }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">1</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">4</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">7</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">4</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">9</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">2</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">3</span></span>) }, { x: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(halfFieldWidth * .<span class="hljs-number"><span class="hljs-number">2</span></span>), z: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPosition(- halfFieldHeight + FIELD_HEIGHT * .<span class="hljs-number"><span class="hljs-number">7</span></span>) }, ]; } }</code> </pre><br>  As you can see, in determining the position on the field, an element of chance is used, implemented by the <i>getRandomPosition</i> method: <br><br><pre> <code class="hljs matlab">protected getRandomPosition(n: number, <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>?: number): number { <span class="hljs-built_in"><span class="hljs-built_in">size</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">size</span></span> || <span class="hljs-number"><span class="hljs-number">2</span></span>; const <span class="hljs-built_in"><span class="hljs-built_in">min</span></span> = n - <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>; const <span class="hljs-built_in"><span class="hljs-built_in">max</span></span> = n + <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.random() * (<span class="hljs-built_in"><span class="hljs-built_in">max</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">min</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">min</span></span>; } protected getRandomPositionX(x: number, <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>?: number) { let position = this.getRandomPosition(x, <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>); position = Math.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(position, FIELD_WIDTH / <span class="hljs-number"><span class="hljs-number">2</span></span>); position = Math.<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(position, - FIELD_WIDTH / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; } protected getRandomPositionZ(z: number, <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>?: number) { let position = this.getRandomPosition(z, <span class="hljs-built_in"><span class="hljs-built_in">size</span></span>); position = Math.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(position, FIELD_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>); position = Math.<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(position, - FIELD_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre><br>  The <i>getRandomPositionX</i> and <i>getRandomPositionZ methods</i> return a position with an element of randomness for the x and z coordinates, taking into account the size of the field, and will be used later. <br><br>  In addition, these two methods will be useful for the future: <br><br><pre> <code class="hljs javascript">getNearestPlayer(point: FootballObject): Player { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> min: number = <span class="hljs-literal"><span class="hljs-literal">Infinity</span></span>, <span class="hljs-attr"><span class="hljs-attr">nearest</span></span>: Player = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item !== point &amp;&amp; item.isActive) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distance = Utils.getDistance(item, point); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance &lt; min) { min = distance; nearest = item; } } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nearest; } getNearestForwardPlayer(point: FootballObject): Player { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> min: number = <span class="hljs-literal"><span class="hljs-literal">Infinity</span></span>, <span class="hljs-attr"><span class="hljs-attr">nearest</span></span>: Player = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item !== point &amp;&amp; item.isActive &amp;&amp; item.getPositionX() &gt; point.getPositionX()) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distance = Utils.getDistance(item, point); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance &lt; min) { min = distance; nearest = item; } } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nearest || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getNearestPlayer(point); }</code> </pre><br>  <i>getNearestPlayer</i> - returns the football player who is closest to the specified point. <br>  <i>getNearestForwardPlayer</i> - does the same thing, but with one nuance - the nearest player is searched for among them, the coordinate on X, which exceeds the coordinate on X of the given point.  This method is useful when looking for a football player who should pass.  Moreover, if such a player is not found (i.e., a given point along the X coordinate exceeds all players of the team), then the nearest player will be found, even if its X coordinate is less than that of the given point. <br><br>  To determine the distance, use the <i>Utils.getDistance</i> method: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj1: FootballObject, obj2: FootballObject</span></span></span><span class="hljs-function">): number</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj1 &amp;&amp; obj2) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distanceX = obj1.getPositionX() - obj2.getPositionX(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> distanceZ = obj1.getPositionZ() - obj2.getPositionZ(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.sqrt(distanceX * distanceX + distanceZ * distanceZ); } }</code> </pre><br><h2>  The best defense is offense. </h2><br>  It's time to think about the strategy of the team.  In order not to complicate things, I decided that my teams would only be able to attack or defend, i.e.  will have two strategies - <b>defense</b> and <b>attack</b> .  When one team with the ball - it attacks, and the enemy team defends itself, and vice versa.  At the same time, each of the types of football players must strive to a certain point of the field (not without an element of chance, naturally). <br><br>  For example, when a team attacks, defenders tend to the center of the field, midfielders to the middle of the middle of the opponent's field (3/4 of the field), attacking closer to the opponent's goal. <br>  And in approximately the same proportions, the players retreat to their half of the field when defending: the defenders strive for their goal, the midfielders by the middle of their half of the field (1/4 of the field), the attackers remain in the center of the field. <br><br>  This logic is implemented in the <i>team</i> class <i>setStrategy</i> method: <br><br><pre> <code class="hljs javascript">setStrategy(strategy: string) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isLeft = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.side === <span class="hljs-string"><span class="hljs-string">'left'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RND_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (strategy) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'defense'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players .filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.FORWARD &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-number"><span class="hljs-number">0</span></span>, RND_SIZE), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionZ(item.getPositionZ(), RND_SIZE)); }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.players .filter(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.MIDFIELDER &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isLeft ? - FIELD_WIDTH : FIELD_WIDTH</span></span></span><span class="hljs-function">) / 2) * .4, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getRandomPositionZ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item.getPositionZ(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">)); }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">players</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.DEFENDER &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isLeft ? - FIELD_WIDTH : FIELD_WIDTH</span></span></span><span class="hljs-function">) / 2) * .6, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getRandomPositionZ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item.getPositionZ(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">)); }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">break</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> '</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">attack</span></span></span><span class="hljs-function">': </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">players</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.FORWARD &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isLeft ? FIELD_WIDTH : - FIELD_WIDTH</span></span></span><span class="hljs-function">) / 2) * .7, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getRandomPositionZ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item.getPositionZ(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">)); }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">players</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.MIDFIELDER &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isLeft ? FIELD_WIDTH : - FIELD_WIDTH</span></span></span><span class="hljs-function">) / 2) * .5, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getRandomPositionZ</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item.getPositionZ(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RND_SIZE</span></span></span><span class="hljs-function">)); }); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">players</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> item.getType() === PlayerType.DEFENDER &amp;&amp; item !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentPlayer) .forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item: Player</span></span></span><span class="hljs-function">) =&gt;</span></span> { item.moveTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionX(<span class="hljs-number"><span class="hljs-number">0</span></span>, RND_SIZE), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getRandomPositionZ(item.getPositionZ(), RND_SIZE)); }); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  On this, perhaps, I will complete the second part of the article on "self-made" football. <br><br>  In the third (and final) part I will talk about the game mechanics, the control interface, as well as add the ball and begin to score goals. <br><br>  And I remind you that in order not to spoil and keep the intrigue to the end, I‚Äôll post the source code and demo in the last part of the article. <br><br>  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/339028/">https://habr.com/ru/post/339028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339018/index.html">"Tulipmania": the stock bubble, which was not</a></li>
<li><a href="../339020/index.html">Security Week 39: An Evening of Delightful Stories on How Business Can't Care About Security</a></li>
<li><a href="../339022/index.html">Uneducated youth</a></li>
<li><a href="../339024/index.html">Zyxel Nebula: an overview of the key capabilities of the cloud network ecosystem</a></li>
<li><a href="../339026/index.html">How to run a Java application with multiple versions of the same library in 2017</a></li>
<li><a href="../339030/index.html">Continued fasting from schoolchildren. How could Habrahabr change our destiny?</a></li>
<li><a href="../339034/index.html">DevOps coming to our home? Home Minecraft server in Azure using modern DevOps practices</a></li>
<li><a href="../339036/index.html">[CppCon 2017] Bjorn Stroustrup: Learning and teaching modern C ++</a></li>
<li><a href="../339038/index.html">How to debug small programs</a></li>
<li><a href="../339044/index.html">How to bring the first project to the end. Part 2. Myths, mistakes and failures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>