<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii and multilingual site. Correct URL and flexibility</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When writing one project, it became necessary to organize multilingualism on the site. Moreover, the number of languages ‚Äã‚Äãshould not be limited to tw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii and multilingual site. Correct URL and flexibility</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img13.imageshost.ru/img/2012/03/07/image_4f574e28b90e9.png" width="400" height="64" hspace="7" align="left"><br>  When writing one project, it became necessary to organize multilingualism on the site.  Moreover, the number of languages ‚Äã‚Äãshould not be limited to two, and the URL should be human-friendly and SEO optimized.  Ie links on the site should be of the form: <br>  <a href="https://habr.com/ru/post/139689/">http://mysupersite.ru/ru/contacts</a> for the Russian language <br>  <a href="https://habr.com/ru/post/139689/">http://mysupersite.ru/en/contacts</a> for the English language <br>  Since my experience is not very big, I began to ask Google.  As it turned out, there are a lot of options, but of all I liked one option that I used and slightly modified. <br><a name="habracut"></a><br><h4>  1. Extend CUrlManager. </h4><br>  Create the file 'components / UrlManager.php' with the following contents: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CUrlManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($route,$params=array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">,$ampersand=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'&amp;'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($params[<span class="hljs-string"><span class="hljs-string">'language'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Yii::app()-&gt;user-&gt;hasState(<span class="hljs-string"><span class="hljs-string">'language'</span></span>)) Yii::app()-&gt;language = Yii::app()-&gt;user-&gt;getState(<span class="hljs-string"><span class="hljs-string">'language'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(Yii::app()-&gt;request-&gt;cookies[<span class="hljs-string"><span class="hljs-string">'language'</span></span>])) Yii::app()-&gt;language = Yii::app()-&gt;request-&gt;cookies[<span class="hljs-string"><span class="hljs-string">'language'</span></span>]-&gt;value; $params[<span class="hljs-string"><span class="hljs-string">'language'</span></span>]=Yii::app()-&gt;language; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::createUrl($route, $params, $ampersand); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  According to our condition, the selected language should be part of the URL.  This means that $ _GET ['language'] must be defined.  To implement this, we override the createUrl () function of the CUrlManager class.  If the language in the string is not specified, then we are looking for it in the session variable, then in the cookies, and if the user has not changed the language before, we set the default application language.  And then we form the correct URL string already with the language as a parameter. <br><br><h4>  2. Editing our Controller </h4><br>  Add the following code to 'components / Controller.php' <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id,$module=null)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($id,$module); <span class="hljs-comment"><span class="hljs-comment">// If there is a post-request, redirect the application to the provided url of the selected language if(isset($_POST['language'])) { $lang = $_POST['language']; $MultilangReturnUrl = $_POST[$lang]; $this-&gt;redirect($MultilangReturnUrl); } // Set the application language if provided by GET, session or cookie if(isset($_GET['language'])) { Yii::app()-&gt;language = $_GET['language']; Yii::app()-&gt;user-&gt;setState('language', $_GET['language']); $cookie = new CHttpCookie('language', $_GET['language']); $cookie-&gt;expire = time() + (60*60*24*365); // (1 year) Yii::app()-&gt;request-&gt;cookies['language'] = $cookie; } else if (Yii::app()-&gt;user-&gt;hasState('language')) Yii::app()-&gt;language = Yii::app()-&gt;user-&gt;getState('language'); else if(isset(Yii::app()-&gt;request-&gt;cookies['language'])) Yii::app()-&gt;language = Yii::app()-&gt;request-&gt;cookies['language']-&gt;value; } public function createMultilanguageReturnUrl($lang='en'){ if (count($_GET)&gt;0){ $arr = $_GET; $arr['language']= $lang; } else $arr = array('language'=&gt;$lang); return $this-&gt;createUrl('', $arr); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  We extend the class constructor and add the language for the application.  Since all controllers will be inherited from this controller, the application language will be set explicitly for each request. <br>  If Yii :: app () -&gt; language is not set explicitly for each request in the URL, it will be taken from the application configuration file.  If it is not specified in the configuration file, it will be identical to Yii :: app () -&gt; sourceLanguage, which is by default 'en_us'. <br>  All these parameters can be changed in the protected \ config \ main.php configuration file. <br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'sourceLanguage'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'ru'</span></span>,</code> </pre><br><h4>  3. Create a Language Selector Widget </h4><br>  Create a file in 'components / widgets / LanguageSelector.php' with the following contents: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguageSelector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $currentLang = Yii::app()-&gt;language; $languages = Yii::app()-&gt;params-&gt;languages; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'languageSelector'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'currentLang'</span></span> =&gt; $currentLang, <span class="hljs-string"><span class="hljs-string">'languages'</span></span>=&gt;$languages)); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And the view for our widget 'components / widgets / views / languageSelector.php': <br><br><pre> <code class="php hljs">&lt;div id=<span class="hljs-string"><span class="hljs-string">"language-select"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sizeof($languages) &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//     -    //           foreach($languages as $key=&gt;$lang) { if($key != $currentLang) { echo CHtml::link( '&lt;img src="/images/'.$key.'.gif" title="'.$lang.'" style="padding: 1px;" width=16 height=11&gt;', $this-&gt;getOwner()-&gt;createMultilanguageReturnUrl($key)); }; } //         /* $lastElement = end($languages); foreach($languages as $key=&gt;$lang) { if($key != $currentLang) { echo CHtml::link( $lang, $this-&gt;getOwner()-&gt;createMultilanguageReturnUrl($key)); } else echo '&lt;b&gt;'.$lang.'&lt;/b&gt;'; if($lang != $lastElement) echo ' | '; } */ } else { // Render options as dropDownList echo CHtml::form(); foreach($languages as $key=&gt;$lang) { echo CHtml::hiddenField( $key, $this-&gt;getOwner()-&gt;createMultilanguageReturnUrl($key)); } echo CHtml::dropDownList('language', $currentLang, $languages, array( 'submit'=&gt;'', ) ); echo CHtml::endForm(); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;/div&gt;</span></span></code> </pre><br>  To display flags, it is necessary to place in the / images / folder of languages ‚Äã‚Äãwith names like en.gif, ru.gif, ua.gif, md.gif. <br><br><h4>  4. We place Widget on the site </h4><br>  Add the following code inside the header-div to 'views / layouts / main.php' <br><pre> <code class="php hljs">&lt;div id=<span class="hljs-string"><span class="hljs-string">"language-selector"</span></span> style=<span class="hljs-string"><span class="hljs-string">"float:right; margin:5px;"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;widget(<span class="hljs-string"><span class="hljs-string">'application.components.widgets.LanguageSelector'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/div&gt;</code> </pre><br><h4>  5. Edit the application configuration file </h4><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-string"><span class="hljs-string">'components'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( ... <span class="hljs-string"><span class="hljs-string">'request'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'enableCookieValidation'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'enableCsrfValidation'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ), <span class="hljs-string"><span class="hljs-string">'urlManager'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'application.components.UrlManager'</span></span>, <span class="hljs-string"><span class="hljs-string">'urlFormat'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'path'</span></span>, <span class="hljs-string"><span class="hljs-string">'showScriptName'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'rules'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'&lt;language:(ru|ua|en)&gt;/'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'site/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;language:(ru|ua|en)&gt;/&lt;action:(contact|login|logout)&gt;/*'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'site/&lt;action&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;language:(ru|ua|en)&gt;/&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/view'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;language:(ru|ua|en)&gt;/&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/&lt;action&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;language:(ru|ua|en)&gt;/&lt;controller:\w+&gt;/&lt;action:\w+&gt;/*'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'&lt;controller&gt;/&lt;action&gt;'</span></span>, ), ), ), <span class="hljs-string"><span class="hljs-string">'params'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'languages'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ru'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'ua'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'—ó'</span></span>, <span class="hljs-string"><span class="hljs-string">'en'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'English'</span></span>), ), <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><h4>  6. Add .htaccess </h4><br><pre> <code class="bash hljs">RewriteEngine on <span class="hljs-comment"><span class="hljs-comment"># if a directory or a file exists, use it directly RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d # otherwise forward it to index.php RewriteRule . index.php</span></span></code> </pre><br><br>  That seems to be all.  It worked for me and glitches have not yet been noticed.  I will answer questions. <br>  I took most of the information from here: <a href="http://www.yiiframework.com/wiki/294/seo-conform-multilingual-urls-language-selector-widget-i18n/">SEO-conform Multilingual URLs + Language Selector Widget (i18n)</a> </div><p>Source: <a href="https://habr.com/ru/post/139689/">https://habr.com/ru/post/139689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139680/index.html">My CMS Story</a></li>
<li><a href="../139682/index.html">Adapt graphics to the Retina screen.</a></li>
<li><a href="../139683/index.html">Startups: how much money did you create a prototype?</a></li>
<li><a href="../139685/index.html">Blocker classmates and other sites</a></li>
<li><a href="../139687/index.html">International Space Apps Challenge, 21-22 april 2012</a></li>
<li><a href="../139691/index.html">Centos 5.8 released</a></li>
<li><a href="../139693/index.html">Stephen Wolfram has analyzed his life</a></li>
<li><a href="../139695/index.html">Nvidia joins Linux Foundation</a></li>
<li><a href="../139696/index.html">Organization of work with IT contractors</a></li>
<li><a href="../139697/index.html">Emacs for beginners: introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>