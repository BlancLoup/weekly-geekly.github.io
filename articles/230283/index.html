<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Time versus memory using Java hash tables</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article illustrates the so-called. speed and memory tradeoff ‚Äî a rule that runs in many areas of CS ‚Äî using different implementations of hash tab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Time versus memory using Java hash tables</h1><div class="post__text post__text-html js-mediator-article">  This article illustrates the so-called.  <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BC%25D0%25BF%25D1%2580%25D0%25BE%25D0%25BC%25D0%25B8%25D1%2581%25D1%2581_%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B8_%25D0%25B8_%25D0%25BF%25D0%25B0%25D0%25BC%25D1%258F%25D1%2582%25D0%25B8">speed and memory tradeoff</a> ‚Äî a rule that runs in many areas of CS ‚Äî using different implementations of hash tables in Java as an example.  The more memory a hash table takes, the faster operations are performed on it (for example, taking a value by key). <br><img src="https://habrastorage.org/getpro/habr/post_images/c6c/b25/12a/c6cb2512a8eff31783d346a39be52b23.png"><br><a name="habracut"></a><br><br><h2>  How to measure </h2><br>  We tested hash maps with intovy keys and values. <br><br>  A measure of memory use is the relative amount of memory additionally occupied in excess of the theoretical minimum for a given size map.  For example, 1000 intovy key-value pairs occupy (4 (inta size) + 4) * 1000 = 8000 bytes.  If a map of this size occupies 20,000 bytes, its measure of memory usage will be (20,000 - 8,000) / 8,000 = 1.5. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Each implementation was tested at 9 load factors.  Each implementation at each level was run on 10 sizes, logarithmically evenly distributed between 1000 and 10 000 000. Then the memory utilization figures and average operation times were independently averaged: by the three smallest sizes (‚Äúsmall sizes‚Äù on the charts), the three largest (large sizes ) and all ten from 1000 to 10 000 000 (all sizes). <br><br>  Implementations: <br><ul><li>  <a href="https://github.com/OpenHFT/hftc">Higher Frequency Trading Collections (HFTC)</a> </li><li>  <a href="http://labs.carrotsearch.com/hppc.html">High Performance Primitive Collections (HPPC)</a> </li><li>  <a href="http://fastutil.di.unimi.it/">fastutil collections</a> </li><li>  <a href="https://github.com/goldmansachs/gs-collections">Goldman Sachs Collections (GS)</a> </li><li>  <a href="http://trove.starlight-systems.com/">Trove collections</a> </li><li>  <a href="https://mahout.apache.org/users/basics/mahout-collections.html">Mahout Collections</a> </li><li> <code>java.util.HashMap</code> for comparison.  All other implementations are primitive specializations, and <code>HashMap</code> bauxite values, so the comparison is notoriously unfair, but nonetheless. </li></ul><br><br><h2>  Taking value by key (successful search) </h2><br>  Only by looking at these pictures can we assume that HFTC, Trove and Mahout on the one hand, fastutil, HPPC and GS on the other, use the same hashing algorithm.  (Actually, this is not quite the case.) The more sparse hash tables on average check fewer slots before finding the key, so less reads from memory occur, so the operation is faster.  It can be noted that on small sizes the most unloaded maps are also the fastest for all six implementations, but on large sizes and when averaged over all sizes, starting with the memory reuse rate of ~ 4, the acceleration is not visible.  This is because if the total size of the map exceeds the cache capacity of any level, the cache misses become more frequent as the size of the mapa grows.  This effect compensates for the theoretical gain from a smaller number of tested slots. <br><img src="https://habrastorage.org/getpro/habr/post_images/41d/c91/4b4/41dc914b41ce54693c26e2e4840e8715.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/9a1/a6b/10f/9a1a6b10f27bb0dd02d92be0a92d4f6e.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/526/ac6/ac6/526ac6ac610e48ed148ad3cba1261135.png"><br><br><h2>  Update (increment) values ‚Äã‚Äãby key </h2><br>  The update is quite similar to taking on a key.  The implementation of fastutil was not tested, because there is no special optimized method for this operation (for the same reason, some implementations are missing when testing other operations). <br><img src="https://habrastorage.org/getpro/habr/post_images/009/a57/ef4/009a57ef463d95b0e7273477b0c19428.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/c51/dea/45a/c51dea45a84ed0be8cbef3dc9f3bd488.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/766/62f/273/76662f2736151746807e276a729274ba.png"><br><br><h2>  Writing a key-value pair (the key was not in the map) </h2><br>  To measure this operation, the maps were filled from zero to the target size (1000 - 10 000 000).  Rebuilding hash tables should not have happened, because the maps were initialized by the target size in the constructors. <br><br>  On small sizes, the graphics are still similar to hyperbolas, but I do not have a clear explanation for such a dramatic change in the image when switching to large sizes and the difference between HFTC and other primitive implementations. <br><img src="https://habrastorage.org/getpro/habr/post_images/339/c1d/256/339c1d256cf80f5b42d444468605be3c.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/0fa/f88/175/0faf88175fe3688d77c6f82d1e3fcf24.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/4eb/02a/3b9/4eb02a3b970d74c57f523c20449a2706.png"><br><br><h2>  Internal Iteration (forEach) </h2><br>  The iteration becomes slower with decreasing memory efficiency, in contrast to individual key operations.  It is also interesting that for all implementations with open hashing, the speed depends <i>only</i> on the reuse of memory, and not on the theoretical table load, because it differs for different implementations at the same reuse level.  Also, unlike other operations, forEach speed is practically independent of the size of the table. <br><img src="https://habrastorage.org/getpro/habr/post_images/262/25d/809/26225d809e9c8710e5d57b526fd3b8cc.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/37a/7fd/b11/37a7fdb116a8846d8293f1225345f8ff.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/6e2/e46/04d/6e2e4604d0bb7b202b1564817578a79d.png"><br><br><h2>  External iteration (via iterator or cursor) </h2><br>  The speed of the outer iteration is dancing a lot more than the internal one, because there is more space for optimizations (more precisely, there are more opportunities to do something that is not optimal).  HFTC and Trove use their own interfaces, other implementations are <code>java.util.Iterator</code> . <br><img src="https://habrastorage.org/getpro/habr/post_images/ded/0d3/740/ded0d3740efbb4c93100c9d3095d0313.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/72f/4bf/de8/72f4bfde82c864b07a82a0f0888fbaf1.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/d5e/949/a16/d5e949a169a55d56b51cca770dcdf674.png"><br><br><hr><br>  <a href="https://gist.github.com/leventov/bc14ea790b4d3cfd238d">Raw results of measurements</a> on which the pictures were built in this post.  There, in the description, there is a link to the benchmark code and information about the runtime environment. <br><br>  PS <a href="http://java.dzone.com/articles/time-memory-tradeoff-example">This article is in English</a> . </div><p>Source: <a href="https://habr.com/ru/post/230283/">https://habr.com/ru/post/230283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230267/index.html">Juniper tincture: Prepare Juniper SRX. Part 2: IPSec</a></li>
<li><a href="../230269/index.html">Building Reliable Web Applications with React: Part 4, Server Generation</a></li>
<li><a href="../230273/index.html">British special services Swiss knife: a set of tools for doing cyber war</a></li>
<li><a href="../230279/index.html">Facebook is testing the Buy button</a></li>
<li><a href="../230281/index.html">Bing has become the next search engine where you can request the removal of search results.</a></li>
<li><a href="../230285/index.html">Creating a script for publishing</a></li>
<li><a href="../230287/index.html">The interplanetary station Rosetta sent the clearest picture of the nucleus of comet Churyumov-Gerasimenko: the nucleus of the comet was doubled</a></li>
<li><a href="../230291/index.html">Testing the layout of the news site with responsive design</a></li>
<li><a href="../230293/index.html">The dark side of Google Play</a></li>
<li><a href="../230295/index.html">The next generation Raspberry Pi will be released no earlier than 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>