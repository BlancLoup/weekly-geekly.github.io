<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use HTML and WebBrowser control as a UI for ordinary windows applications in C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you know, the WebBrowser control is just a wrapper over the ActiveX component of Internet Explorer. Therefore, it provides access to a full-fledged...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use HTML and WebBrowser control as a UI for ordinary windows applications in C #</h1><div class="post__text post__text-html js-mediator-article">  As you know, the WebBrowser control is just a wrapper over the ActiveX component of Internet Explorer.  Therefore, it provides access to a full-fledged layout engine with all the modern buns.  And if so, then we will try (I don‚Äôt know why) on its basis, to make a user interface for a regular windows application. <br><br>  You could, of course, run a mini web server in the same process (for example, on HttpListener) and catch requests through it, but this is too easy, boring and unsportsmanlike.  Let's try to do without network components, just for fun. <br><a name="habracut"></a><br>  So, the task is simple - it is necessary to intercept the sending of HTML forms and display a new HTML document generated by the application logic depending on the POST parameters. <br><br>  First of all, we need a Windows Forms Application with a single form on which there will be a single control - WebBrowser occupying all the space. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, we draw a couple of simple interface pages (with minimal content for short, and add scripts and styles to taste). <br><br>  First page: <br><br><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=11"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TEXT1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Some text"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Open page 2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Second page: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=11"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>%TEXT1%<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Back to page 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <i>Note: X-UA-Compatible is required for correct display of some styles, in this example they are not used, but there is a problem.</i>  <i>I will not go into details, but without this the component draws pages in compatibility mode with something very old, with all the ensuing consequences.</i> <br><br>  WebBrowser provides several events, for example, Navigating, which is triggered before submitting a form or following a link. <br>  Practically what is needed, but this event does not provide any information about post-parameters.  GET-parameters cannot be used because our HTML-forms have no action attribute, which means that the URL will always be about: blank and there will be no information about the GET parameters. <br>  For more detailed information about the request, you must subscribe to the BeforeNavigate2 event (read more <a href="https://msdn.microsoft.com/en-us/library/aa768283(v%3Dvs.85).aspx">here</a> ) from the browser's internal COM object, since it is available through the ActiveXInstance property. <br>  The easiest way to do this is through dynamic, so as not to mess with declaring COM interfaces: <br>  We declare the delegate: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeforeNavigate2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pDisp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TargetFrameName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] PostData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Headers, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Cancel</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  Then we subscribe to the event (in the form constructor, the WebXrowser ActiveXInstance property will be null, because this is best done after the window is loaded, that is, in OnLoad for example): <br><br><pre> <code class="hljs cs">((<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>)webBrowser.ActiveXInstance).BeforeNavigate2 += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeforeNavigate2(OnBeforeNavigate2);</code> </pre><br>  So, in PostData are post-parameters in the form of a string consisting of pairs of <i>key</i> = <i>value</i> combined by &amp;.  Separate them and put them into the dictionary: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters = (PostData == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? string.Empty : Encoding.UTF8.GetString(PostData)) .Split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>) .Select(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.Split(<span class="hljs-string"><span class="hljs-string">'='</span></span>)) .Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.Length == <span class="hljs-number"><span class="hljs-number">2</span></span>) .ToDictionary(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> WebUtility.UrlDecode(x[<span class="hljs-number"><span class="hljs-number">0</span></span>]), x =&gt; WebUtility.UrlDecode(x[<span class="hljs-number"><span class="hljs-number">1</span></span>]));</code> </pre><br>  In addition, in this handler, it is better to cancel the action via the Cancel parameter, so as not to fall for about: blank once again. <br><br>  Having parameters we generate the text of the new page.  Theoretically, a handler manager is screwed here, choosing the necessary handler depending on the parameters, which by some patterns will collect pages from pieces, but for short, for the sake of brevity, just for an example, just open the first page using the page2 button ( It is necessary to indicate the buttons in the markup, otherwise it is impossible to determine which button was pressed from the post-parameters, and also we will replace all the lines in parentheses with the values ‚Äã‚Äãof the parameters with the following names: <br><br><pre> <code class="hljs pgsql"> private static string <span class="hljs-keyword"><span class="hljs-keyword">Handler</span></span>(IReadOnlyDictionary&lt;string, string&gt; parameters) { // <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">some</span></span> useful stuff here var newPage = "Not found"; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.ContainsKey(nameof(page1))) newPage = page1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.ContainsKey(nameof(page2))) newPage = page2; parameters.ToList().<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>(x =&gt; newPage = newPage.Replace("{" + x.Key + "}", x.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newPage; }</code> </pre><br>  The resulting string with HTML text is written to the DocumentText property of the WebBrowser. <br>  And here we will get an infinite page reload cycle, since setting this property will trigger a new call to OnBeforeNavigate2. <br>  It is not possible to temporarily unsubscribe from this event, since it is called from somewhere in the message loop after the DocumentText installation returns control. <br>  So  You should always ignore every second call to the handler, since the first response is a form submission as a result of user actions that need to be processed, and the second is the display of the result that is not needed.  For simplicity, we will switch the bool variable at the beginning of the OnBeforeNavigate2 handler. <br><br><pre> <code class="hljs kotlin">ignore = !ignore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ignore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre><br><br>  And here is the result: <br><br><img src="https://habrastorage.org/files/9cc/61a/94f/9cc61a94fc444d93bee49c81d5367cb0.gif"><br><br>  This is all that is needed for a minimal application.  But not everything will work this way - for example, getting data about files for input type = ‚Äúfile‚Äù, as well as working with XMLHttpRequest for correct operation of scripts with all kinds of ajax there, is left out of the box. <br><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Forms; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TestHtmlUI</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainForm</span></span> : <span class="hljs-title"><span class="hljs-title">Form</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> page1 = <span class="hljs-string"><span class="hljs-string">@"&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;&lt;meta http-equiv=""X-UA-Compatible"" content=""IE=11""&gt;&lt;/head&gt; &lt;body&gt; &lt;form method = ""post"" &gt; &lt;input type=""text"" name=""TEXT1"" value=""Some text"" /&gt; &lt;input type=""submit"" value=""Open page 2"" name="""</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(page2) + <span class="hljs-string"><span class="hljs-string">@""" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> page2 = <span class="hljs-string"><span class="hljs-string">@"&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;&lt;meta http-equiv=""X-UA-Compatible"" content=""IE=11""&gt;&lt;/head&gt; &lt;body&gt; &lt;div&gt;{TEXT1}&lt;/div&gt; &lt;form method=""post""&gt; &lt;input type=""submit"" value=""Back to page 1"" name="""</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(page1) + <span class="hljs-string"><span class="hljs-string">@""" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeforeNavigate2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pDisp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TargetFrameName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] PostData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Headers, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Cancel</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> WebBrowser webBrowser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebBrowser { Dock = DockStyle.Fill }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ignore = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainForm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { StartPosition = FormStartPosition.CenterScreen; Controls.Add(webBrowser); Load += (sender, e) =&gt; ((<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>)webBrowser.ActiveXInstance).BeforeNavigate2 += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeforeNavigate2(OnBeforeNavigate2); webBrowser.DocumentText = Handler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; { { <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(page1), <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeforeNavigate2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pDisp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TargetFrameName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] PostData, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Headers, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Cancel</span></span></span><span class="hljs-function">)</span></span> { ignore = !ignore; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ignore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Cancel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameters = (PostData == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty : Encoding.UTF8.GetString(PostData)) .Split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>) .Select(x =&gt; x.Split(<span class="hljs-string"><span class="hljs-string">'='</span></span>)) .Where(x =&gt; x.Length == <span class="hljs-number"><span class="hljs-number">2</span></span>) .ToDictionary(x =&gt; WebUtility.UrlDecode(x[<span class="hljs-number"><span class="hljs-number">0</span></span>]), x =&gt; WebUtility.UrlDecode(x[<span class="hljs-number"><span class="hljs-number">1</span></span>])); webBrowser.DocumentText = Handler(parameters); } [STAThread] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Application.EnableVisualStyles(); Application.Run(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainForm()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IReadOnlyDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; parameters</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPage = <span class="hljs-string"><span class="hljs-string">"Not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.ContainsKey(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(page1))) newPage = page1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameters.ContainsKey(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(page2))) newPage = page2; <span class="hljs-comment"><span class="hljs-comment">// do dome usefull stuff here parameters.ToList().ForEach(x =&gt; newPage = newPage.Replace("{" + x.Key + "}", x.Value)); return newPage; } } }</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/302432/">https://habr.com/ru/post/302432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302422/index.html">Reflections on the evaluation of commits and robot programmers</a></li>
<li><a href="../302424/index.html">The final release of the browser Vivaldi 1.2</a></li>
<li><a href="../302426/index.html">Broadcaster for MacBook. Facebook Edition</a></li>
<li><a href="../302428/index.html">Model-View in QML. Part Four: C ++ Models</a></li>
<li><a href="../302430/index.html">Habrahabr articles citation graph</a></li>
<li><a href="../302438/index.html">Creating a blog on symfony 2.8 lts [Part 3]</a></li>
<li><a href="../302442/index.html">Deployer - convenient and flexible application deployment</a></li>
<li><a href="../302448/index.html">‚ÄúNo longer means better‚Äù: counterintuitive case from Google</a></li>
<li><a href="../302456/index.html">Haordic Organization Visa (Part 3)</a></li>
<li><a href="../302458/index.html">We write our malware. Part 1: Learn to write a completely ‚Äúundetectable‚Äù keylogger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>