<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debugging Hadoop Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No matter how much they say that the logs are able to completely replace debugging, alas, and ah - this is not quite so, and sometimes - not at all. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debugging Hadoop Applications</h1><div class="post__text post__text-html js-mediator-article">  No matter how much they say that the logs are able to completely replace debugging, alas, and ah - this is not quite so, and sometimes - not at all.  Indeed, sometimes it does not even occur to me that it was <em>this</em> variable that had to be written to the log ‚Äî at the same time, in debug mode, you can often view several data structures at once;  you can, in the end, stumble on a problem area completely by accident.  Therefore, sometimes debugging is inevitable, and often it can save a lot of time. <br><br>  Debugging a single-threaded Java application is simple.  Debugging a multi-threaded Java application is a bit more complicated, but still easy.  To debug a multiprocess Java application?  With processes running on different machines?  It is definitely more difficult.  That is why all the Hadoop manuals recommend turning to debugging <em>only and exclusively</em> when the other options (read: logging) are exhausted and do not help.  The situation is often complicated by the fact that on large clusters you may not have access to specific map / reduce nodes (this is exactly what I encountered).  But let's solve the problem in parts.  So‚Ä¶ <br><br><h2>  Scenario One: Local Hadoop </h2><br>  The easiest option of all.  Local installation of Hadoop - everything is performed on the same machine, and moreover - in the same process, but in different threads.  Debugging is equivalent to debugging a regular multithreaded Java application - what could be more trivial? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How to achieve this?  We go to the directory where we have our local Hadoop deployed (I suppose that you can do this or can read the corresponding <a href="http://hadoop.apache.org/common/docs/current/quickstart.html">instructions</a> and can deal with it now). <br><br><pre>     $ cd ~ / dev / hadoop
     $ cp bin / hadoop bin / hdebug
     $ vim bin / hdebug </pre> <br>  Our task is to add another JVM option, somewhere around the 282-283 line (depending on the version, the number may change) right after the script has finished creating <code>$HADOOP_OPTS</code> : <br><a name="habracut"></a><br><pre>     HADOOP_OPTS = "$ HADOOP_OPTS -Xdebug -Xrunjdwp: transport = dt_socket, address = 1044, server = y, suspend = y" </pre><br>  What did we say with this spell?  We said that we want to start a Java machine with support for a remote debugger, which will have to connect to port 1044, and until it connects, the program will be suspended (immediately after the start).  It's simple, right?  It remains to go to Eclipse (or any other Java IDE) and add a remote debugging session there.  Well, for example, like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/848/a0e/07d/848a0e07d2a950794ae1e94a1a10471c.png"><br><br>  If you start debugging not on the local machine, but on some server (which is quite normal and usually I do it - do I need it, load my laptop with such things when there are special server devs with a wild amount of memory and many processors? ), then just change <code>localhost</code> to the required host.  Next, set breakpoint in the program code (for the beginning, in the main body, the so-called gateway code), and start Hadoop: <br><pre>     bin / hadoop jar myApplication.jar com.company.project.Application param1 param2 param3
</pre><br>  Hadup starts and does nothing, the JVM reports that it is waiting for a connection: <br><pre>     Listening for transport dt_socket at address: 1044
</pre><br>  Everything, now connect to the debugging session with Eclipse - and wait for your breakpoint to ‚Äúpop up‚Äù.  Debugging of map / reduce classes does not differ in anything (within the framework of this scenario) from debugging gateway code. <br><br><h2>  Scenario Two: pseudo-distributed mode </h2><br>  In <a href="http://hadoop.apache.org/common/docs/current/quickstart.html">pseudo-distributed</a> mode, Hadoop is closer to the state in which it will work in production (and we, accordingly, are closer to the headache that we will have when something does break).  The difference is that map / reduce tasks are performed in separate processes, HDFS is already ‚Äúreal‚Äù (and not imitated by the local file system - although it is located on just one node), and it is harder to debug.  That is, you can, of course, apply the approach described above to the start of new processes, but I did not try to do this and there is a suspicion that without modifying the code of Hadoop itself, it simply will not work. <br><br>  There are two main approaches to solving the debugging problem in this mode - one of them is using a local task tracker, and the other is <code>IsolationRunner</code> .  At once, we say that the first option can only give very approximate results, since the nodes will be different and all the code will be executed in one process (as in the previous version).  The second option gives a very accurate approximation of the real work, but - alas, it is not possible if you do not have access to specific Task Nodes (which is very, very likely in the case of large production clusters). <br><br>  So, <a href="http://hadoop.apache.org/common/docs/r0.18.3/mapred_tutorial.html">IsolationRunner</a> is an auxiliary class that allows you to simulate as accurately as possible the process of performing a specific task (Task), in fact, <em>repeating</em> its execution.  In order to use it, you need to make a few gestures: <br><ol><li>  Set the <code>keep.failed.tasks.files</code> value to <code>true</code> in the job configuration.  Depending on how you form your task, this can be done either by editing the XML file, or in the program text, but, in any case, it is not difficult.  This way you give instructions to the task tracker that if the task was completed with an error, it is not necessary to delete its configuration and data. </li><li>  The official guide further recommends that you go to the node where the task was completed with an error.  In our case, this is still our local (or not very local, but still only one) host;  The directory where taskTracker is located depends on the configuration, but in the ‚Äúdefault‚Äù mode it will most likely have <code>hadoop/bin</code> .  Brazenly copy the example from the manual: <br><br><pre>     $ cd &lt;local path&gt; / taskTracker / $ {taskid} / work 
     $ bin / hadoop org.apache.hadoop.mapred.IsolationRunner ../job.xml </pre><br>  In our case, we can and should replace <code>bin/hadoop</code> with <code>bin/hdebug</code> , which we created above (well, it is clear that the relative path will be some other way ;-)).  As a result - we are debugging the fallen task, working with exactly the data that led to its fall.  Simple, beautiful, comfortable. </li><li>  We are connected by a debugger, we act, we find an error, we are happy </li></ol><br><br>  As I noted above, this method will work in pseudo-distributed mode, but it will also work fine if you have access to the map / reduce nodes (this is almost an ideal situation).  But there is also a third scenario, the most difficult ... <br><br><h2>  Scenario Three: production cluster </h2><br>  You are on a real, "militant" cluster, in which there are over a thousand machines, and no one will give you the right to log in to one of them, except gateways machines specially designed for this purpose (hence the name gateway code, because it is used for ).  All grown-up, although you are still working on a test ‚Äúsmall‚Äù data set of half a terabyte, but the headache with debugging is already getting up to its full height.  Here, perhaps, it would be appropriate to repeat the advice about logging - if you have not done it yet, do it.  At a minimum, this will allow you to partially localize the gap, and perhaps you will be able to use one of the above two methods to identify and solve it.  There is no simple debugging method that will give predictable results.  Strictly speaking, all you can do is make your task run locally, on the gateway ‚Äî in this case, you will work with real production HDFS, but you will most likely not be able to reproduce the behavior on specific nodes. <br><br>  All you need to do to perform a local task is to set <code>mapred.job.tracker</code> to <code>local</code> (in the task configuration).  Now with some luck, you can connect with a debugger (however, most likely not with your favorite Eclipse, but with something console running on the same network - or running through an SSH tunnel, if available) and run your code on the gateway.  From the pros - you work with real data on this HDFS.  Of the minuses - if the error is floating and is reproduced, God forbid, only on one or two nodes of the cluster, the line with two you will find it.  The bottom line is the best thing you can do without communicating with the cluster support team and requesting temporary access to a specific node. <br><br><h2>  Conclusion </h2><br>  So, here is a little bit of information to think about how difficult debugging map / reduce applications can be.  Without denying all of the above, I would recommend the following strategy: <br><ol><li>  Arrange debugging messages throughout the task code - first rarely (approximately), then more often, when it becomes clear that the task is falling, say, between lines 100 and 350 </li><li>  Try to reproduce the problem on the local Hadup - very often it will succeed, and you can figure out what's wrong. </li><li>  Check whether you have access to specific map / reduce nodes.  Find out whether it is realistic to get it (at least temporarily and not at all) </li><li>  Use debugging with a close look!  Seriously, it works - only better if the look is not yours: often a third-party person can see a bug in three seconds, when you have already ‚Äúlooked narrowly‚Äù at it and you don‚Äôt notice at close range </li><li>  If all else fails, use different combinations of the above techniques.  At least one of them will work necessarily. </li></ol><br><br>  Successful debugging! <br><br>  PS written based on my old <a href="http://sigizmund.com/debugging-hadoop-applications-using-your-eclipse/">post</a> and weekly debugging hadoop applications, java library and JNI supporting it.  In addition, greetings to Umputun and Bobuk, who, with their release of 179 RT and the tale of map / reduce, reminded me that there are things (even a few of them) that I understand and can tell about them ;-) </div><p>Source: <a href="https://habr.com/ru/post/89365/">https://habr.com/ru/post/89365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../89350/index.html">NexentaStor 3.0.0 CE released with a limit of 12 TB</a></li>
<li><a href="../89352/index.html">Belarusian television</a></li>
<li><a href="../89356/index.html">29th issue of Russian Full Circle Magazine</a></li>
<li><a href="../89360/index.html">Why I love Microsoft. Zombie notes</a></li>
<li><a href="../89361/index.html">Buxter: a new application on Facebook</a></li>
<li><a href="../89366/index.html">News from RIT ++ fields: Jonathan Worthington will replace Patrick Michaud and tell Perl 6. Machey Dobzhanski will tell about Sphinx</a></li>
<li><a href="../89367/index.html">Ext Designer released</a></li>
<li><a href="../89368/index.html">The Big Picture - Almost Perfect Task Tracker</a></li>
<li><a href="../89369/index.html">Video reviews of software pre-installed on iPad</a></li>
<li><a href="../89370/index.html">A special vest will allow gamers to feel gunshot wounds.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>