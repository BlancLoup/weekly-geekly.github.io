<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kodogenerator-based music generator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrayuzer! In this topic I will talk about my idea of ‚Äã‚Äãgenerating musical compositions. Let's create a language for describing the rhythm of mus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kodogenerator-based music generator</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habrayuzer!  In this topic I will talk about my idea of ‚Äã‚Äãgenerating musical compositions.  Let's create a language for describing the rhythm of music based on python, write the compiler of this language in the wave files and get a pretty nehilno electronic composition. <br><br>  Welcome under cat. <br><a name="habracut"></a><br>  Who can not wait to listen to muzonchik now, here's online: <a href="https://soundcloud.com/solid-coder/out">clickable</a> (the first couple of seconds are unsuccessful, the next is quite normal). <br><br>  <b>Instead of intro</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I read here on Habr√© article about the generation of music ( <i>google.ru&gt; generation of music site: habrahabr.ru</i> ), I liked it.  And then I came across thrashgens (garbage code generators).  All this time I was listening to music and noticed that in each composition there are repetitive notes. <br><br>  For example: <br><br>  <i>tynts tynts, pam pam, couples pam pam tynts tynts, pam pam, couples pam pam tynts tynts, pam pam, couples pam pam</i> <br><br>  And I got the idea to represent all these sequences of sounds, like cycles, in the body of which these sounds are encoded.  This is somewhat similar to the "school data compression" algorithms, when before repeating data we write the number of their repetitions. <br><br>  So, we have a task: <br><br>  1) Design a rhythm description language <br>  2) Write a compiler in the byte code (sequence of sounds) <br>  3) Digitize and write to wave file <br><br>  Let's get started <br><br><h4>  Rhythm description language </h4><br>  After much research into compiler theory, writing lexers and breaking into tokens, I got tired of this.  It was decided to use the attention syntax of the Python language.  Yes yes exactly.  This language supports expressions such as the yield statement. <br><br>  The topic of yield is quite extensive and if you are not familiar with it and wish to familiarize yourself, then I send you to the article <a href="https://habrahabr.ru/post/132554/">‚ÄúHow yield works‚Äù</a> . <br><br>  We will continue.  So let's agree. <br><br>  To represent a sound signal (hereinafter - the frame) we will use a function of the form n (diap [0], diap [1]), where n is the numeric number of this function.  Where diap is a list or tuple of the initial value and the final range of generated frequencies. <br><br>  We will use the following expression to encode its calls: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"n(diap[0], diap[1])"</span></span></code> </pre> <br><br>  To give clarity, here is an example from the generator's exhaust somewhere in the center of the code: <br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"19(400,800)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">7</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"20(400,800)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"21(400,800)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"22(400,800)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span></code> </pre><br><br>  In this source code there is a yield of "0", meaning that in this place there will be a zero byte sequence to give pauses between frames (so that the music does not come out as a solid sound). <br><br>  This means (from the ripped out context) the following sequence: <br><br> <code>19(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 21(400,800); 22(400,800); 0 <br></code> <br><br>  Now consider <b>what</b> the frame function is. <br><br>  When calling n (diap [0], diap [1]), the key n is added to the associative array with a random value r, where diap [0] &lt;= r &lt;= diap [1] <br>  This will be required for the virtual machine to execute our frame byte code. <br><br><h4>  <b>Compiling bytecode frames and building in .wav</b> </h4><br>  So, it is time to compile. <br><br>  How are we going to do this? <br><br>  First we need to go through our generated code and compile a dictionary in which the keys are the function number and the value is a random variable from the range.  You can do this when parsing the code, but you can right during the generation.  I have exactly the second option. <br><br>  Our code for the description of the rhythm (hereinafter KOR) we can present in the form: <br><pre> <code class="python hljs">code = <span class="hljs-string"><span class="hljs-string">""" def temp():    """</span></span></code> </pre><br>  Warning: the code uses <u>three</u> <i>double</i> quotes " <br><br>  Now we store our code as a string.  Python has an exec function that allows you to execute code.  Let's see its application: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cd)</span></span></span><span class="hljs-function">:</span></span> namespace = {} exec(cd,namespace) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> namespace[<span class="hljs-string"><span class="hljs-string">"temp"</span></span>]()</code> </pre><br><br>  When you call my_code and pass it as a parameter string with the code, we get a list generator that generates a bytecode sequence, that is: <br><br><pre> <code class="python hljs"> print(<span class="hljs-string"><span class="hljs-string">"Compiling..."</span></span>) lst = list(my_code(out.code)) print(<span class="hljs-string"><span class="hljs-string">"Compiled!"</span></span>)</code> </pre><br><br>  In lst there will be a list of consecutive calls to the frame functions of our COR. <br><br>  That is, as the same example, <br><br> <code>19(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 20(400, 800); 0; 21(400,800); 22(400,800); 0 <br></code> <br><br>  We already have an associative array (I generated it during code generation), we just have to go through lst, tear out the function numbers (keys for the dictionary), and get their values ‚Äã‚Äãby referring to our dictionary. <br><br>  Here there is this process and digitization with a record in the wave: <br><div class="spoiler">  <b class="spoiler_title">Link to wave file</b> <div class="spoiler_text"><pre> <code class="python hljs">music = wave.open(<span class="hljs-string"><span class="hljs-string">'out.wav'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) music.setparams((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, freq, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'NONE'</span></span>, <span class="hljs-string"><span class="hljs-string">'not compressed'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lst: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-string"><span class="hljs-string">"0"</span></span>): packed_value = wave.struct.pack(<span class="hljs-string"><span class="hljs-string">'h'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>): music.writeframes(packed_value) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> key = i[<span class="hljs-number"><span class="hljs-number">0</span></span>:i.find(<span class="hljs-string"><span class="hljs-string">"("</span></span>)] frame = Syntax.struc.num[int(key)] duration = <span class="hljs-number"><span class="hljs-number">0.05</span></span> samplerate = freq <span class="hljs-comment"><span class="hljs-comment"># Hz samples = duration * samplerate frequency = frame #Hz period = samplerate / float(frequency) # in sample points omega = N.pi * 2 / period xaxis = N.arange(int(period), dtype=N.float) * omega ydata = 16384 * N.sin(xaxis) signal = N.resize(ydata, samples) # 2-  -  ssignal = b'' for i in range(len(signal)): ssignal += wave.struct.pack('h', int(signal[i])) # transform to binary music.writeframes(signal) music.close()</span></span></code> </pre><br></div></div><br><br>  All code is available on the <a href="https://github.com/solidminus/Music-Intelligence-writer">githab</a> ( <b>attention</b> : there is a govnod in the generator, since I rewrote this code 20 times and juggled the syntax of the language until I came to an ideal consensus. <b>There was no refactoring</b> ). <br><br>  PS Run the Main.py module, saving the generator result in out.py (because of the crutches, only this name is accepted). </div><p>Source: <a href="https://habr.com/ru/post/304496/">https://habr.com/ru/post/304496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304484/index.html">VDI for all: VMware Horizon 7 specification</a></li>
<li><a href="../304486/index.html">iMessage in iOS 10: New Opportunities for Developers</a></li>
<li><a href="../304488/index.html">Shake Detector for Android on RxJava</a></li>
<li><a href="../304490/index.html">Why do video surveillance developers love retail more than production?</a></li>
<li><a href="../304492/index.html">Translation of C ++ project for development with unit testing / TDD</a></li>
<li><a href="../304502/index.html">Mathematical notation: Past and Future</a></li>
<li><a href="../304504/index.html">CRM communications</a></li>
<li><a href="../304506/index.html">Intel Edison, Windows Phone and Microsoft Azure: Cloud Console and LED Union</a></li>
<li><a href="../304508/index.html">Windocks - SQL Server and .NET containers on Windows Server 2012 R2 with docker api support</a></li>
<li><a href="../304510/index.html">Latest C ++ Development News</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>