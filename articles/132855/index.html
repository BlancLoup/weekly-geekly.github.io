<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous Cramped ruby ‚Äã‚Äãframework: architecture and usage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cramp is a fully asynchronous real-time framework written by Pratik Naik, a developer at 37signals and a member of the Rails core-team. This framework...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous Cramped ruby ‚Äã‚Äãframework: architecture and usage</h1><div class="post__text post__text-html js-mediator-article">  Cramp is a fully asynchronous real-time framework written by Pratik Naik, a developer at 37signals and a member of the Rails core-team.  This framework is primarily intended for organizing bidirectional communication between the client and the server and has built-in support for WebSockets and Server-Sent Events.  In this article we will discuss the main things related to the use of this tool, as well as try to understand its architecture and understand how it works. <br><a name="habracut"></a><br>  Perhaps the main drawback of the framework is the small number of articles and examples, there is only a small page of documentation on the <a href="http://cramp.in/">official website</a> and the actual <a href="https://github.com/lifo/cramp">code of the project on the github</a> .  From there, basically everything written below was taken. <br><br><h4>  Architecture </h4><br>  Cramp is based on EventMachine, ActiveSupport and Thor and runs on a Thin or Rainbows server. <br><br>  Thor is used to generate an application ‚Äî Cramp :: Generators :: Application.start is called in the binary, which sequentially executes all the public methods of the Application class, whose names: create_root, create_config, create_models, speak for themselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further, when the server starts, the EventMachine cycle starts, which catches all the events, launching the callbacks attached to them.  That is why Cramp only works on Rainbows or Thin (by default), which are built on EM. <br><br>  The key concept in the Cramp philosophy is Action (classes Action and Abstract).  Action is somewhere between the controller and the actual action in Rails (if it is at all appropriate to compare asynchronous and synchronous frameworks).  Each action processes one request or, it would be more correct to say, one entry point, because for example a connection through a web socket cannot be called a single request. <br><br>  A typical query is conditionally divided into 4 stages: <br><ul><li>  Initialization of the request - callbacks before_start are called. <br>  At this stage, the headers have not yet been sent, you can redirect the user somewhere or interrupt the processing of the request.  The documentation says that it is recommended to use before_start to check the request or user access rights.  On before_start, you can hang several methods that will be executed sequentially, but each of them must call yield or halt to continue or terminate the processing of the request, respectively. </li><li>  Initialization of the response - corresponds to the function respond_with. <br>  It is used to form headers and usually use the standard header with the code 200: <br><br><pre><code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_headers</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">status</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">headers</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">respond_to?</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:respond_with</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> ? respond_with.dup : [<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>}] headers[<span class="hljs-string"><span class="hljs-string">'Connection'</span></span>] <span class="hljs-params"><span class="hljs-params">||</span></span>= <span class="hljs-string"><span class="hljs-string">'keep-alive'</span></span> [status, headers] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </li><li>  The request is running - running on_start. <br>  Here is the formation of the answer.  On on_start, you can also hang several callbacks that will be executed <u>at the same time</u> , and each of them can call the render method and not just once. </li><li>  Request completed - on_finish is called. <br>  It is executed after the formation of the answer and serves to clean up something, close open connections, etc. </li></ul><br>  The killer feature of this framework is WebSockets.  They are supported out of the box and do not require a separate server.  To use web sockets it is enough to create an on_data handler method in your action. All other questions will be decided by the server implementing the receive_data EM method, which is triggered when a message is received from the connection and calls the user handler: <br><br>  Thin <br><pre> <code class="ruby hljs">callback = @request.env[Thin::Request::WEBSOCKET_RECEIVE_CALLBACK] callback.call(data) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> callback</code> </pre> <br><br>  Rainbows <br><pre> <code class="ruby hljs">callback = @env[WEBSOCKET_RECEIVE_CALLBACK] callback.call(data) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> callback</code> </pre> <br><br>  On it we will finish with architecture and we will pass to use. <br><br><h4>  Using </h4><br>  To work with Cramp, it is recommended to use Ruby branches 1.9 to use faybayra that with the presence of tools such as rvm or rbenv should not be a problem even if you are still sitting on 1.8.7. <br><br>  Installing Cramp should not cause any difficulties: <br><pre> <code class="bash hljs">gem install cramp</code> </pre> <br><br>  Next, run <br><pre> <code class="bash hljs">cramp new project_name</code> </pre> <br>  and the aforementioned Thor generates the skeleton of your application. <br>  Then, being in the project folder, we execute bundle install, which tightens all dependencies. <br><br>  We have already created one action - app / actions / home_action.rb, with the following content: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeAction</span></span></span><span class="hljs-class"> &lt; Cramp::Action </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">start</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hello</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">World!</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">finish</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  As it is easy to understand from this code, the start handler forms the answer in the form of the string ‚ÄúHello World!‚Äù And finishes the processing of the request.  Check this assumption by running the server: <br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> thin start</code> </pre> <br>  and indeed, everything works as expected.  As far as I understand, Thin itself picks up the file config.ru, which lies in the project folder, but for fidelity you can run this command in the following form: <br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> thin --max-persistent-conns 1024 --timeout 0 -R config.ru start</code> </pre> <br>  or <br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> thin --max-persistent-conns 1024 --timeout 0 -V -R config.ru start</code> </pre> <br>  for debugging in verbose mode. <br><br>  Naturally, we do not need to render static text and html markup directly, for this we must use the views (views) that are in separate files.  Create an app / views folder and in it an index.erb file with the following simple content: <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Hello World!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheets/styles.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Hello World!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And in the public / stylesheets folder we create the styles.css file with just one line: <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span>{<span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red}</code> </pre> <br><br>  As you can see from the extension, in this example the Erb engine is used, but of course you can use Haml, Slim or whatever your heart desires, after having included the corresponding entry in the Gemfile. <br><br>  In order for action to render the contents from the erb-file, first we will connect the engine itself: <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span></code> </pre> <br><br>  You can add this line to the action itself, but in order to use Erb in the whole project, it is more convenient to connect it to application.rb. <br><br>  Next, change home_action.rb: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeAction</span></span></span><span class="hljs-class"> &lt; Cramp::Action </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">start</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">page</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ERB</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">File</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleProject::Application</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">views</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">erb</span></span></span><span class="hljs-class">'))) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">page</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binding</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">finish</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  Here ExampleProject is the name of the project itself.  But where is our css?  In order for css-files to be available, you need to allow distribution of static content from the folder containing them in the config.ru file: <br><pre> <code class="ruby hljs">use Rack::Static, <span class="hljs-symbol"><span class="hljs-symbol">:urls</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"/javascripts"</span></span>, <span class="hljs-string"><span class="hljs-string">"/stylesheets"</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">:root</span></span> =&gt; CrampArticle::Application.root(<span class="hljs-symbol"><span class="hljs-symbol">:public</span></span>)</code> </pre> <br><br>  Well, the headline turned red, as expected. <br>  Now let's go ahead and create a new action WsAction, which will communicate with the client via web sockets.  First, let's establish which server the web sockets will work on: <br><pre> <code class="ruby hljs">Cramp::Websocket.backend = <span class="hljs-symbol"><span class="hljs-symbol">:thin</span></span></code> </pre> <br><br>  Again, instead of Thin, you can use Rainbows, I personally prefer Thin just because it lies on the Github and the docks on it are more. <br>  Next, in the app / actions folder, create the ws_action.rb file and add the following code to it: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WsAction</span></span></span><span class="hljs-class"> &lt; Cramp::Action </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">transport</span></span></span><span class="hljs-class"> = :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">websocket</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">on_data</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">process_data</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">process_data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hello</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> /^</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hello</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i</span></span></span><span class="hljs-class"> =~ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><br>  It is enough to add the line self.transport =: websocket to the class text so that it receives and sends messages via WebSockets.  Then we set up a message handler and send a greeting if a message was received starting with ‚Äúhello‚Äù. <br><br>  To try this in action, first you need to add a route (route) for the WsAction class (config / routes.rb file): <br><pre> <code class="ruby hljs">get(<span class="hljs-string"><span class="hljs-string">'socket/'</span></span>).to(WsAction)</code> </pre> <br><br>  And secondly, we add to client index.erb a code like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> ws = </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> WebSocket(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"ws://localhost:3000/socket/"</span></span></span><span class="actionscript">); ws.onopen = </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ ws.send(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"Hello!"</span></span></span><span class="actionscript">); }; ws.onmessage = </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ alert(e.data); }; ws.onclose = </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ alert(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"closed"</span></span></span><span class="actionscript">); }; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  For Firefox, the latest versions of WebSocket are replaced by MozWebSocket.  The client code is very simple and is presented solely for demonstration (like the server one itself), therefore the condition for the web socket class or background on the flash is not included in it, do it yourself. <br><br>  That's all, if you want to explore Cramp in more depth, there are a few more topics not covered in this article: Server-Side Events, filers, working with ActiveRecord.  And of course you can help the development of the project with the help of bug reports and pull requests on the githaba. <br><br><h4>  Additional links </h4><br>  Project code <br>  <a href="https://github.com/lifo/cramp">github.com/lifo/cramp</a> <br><br>  Project site (documentation, links to examples) <br>  <a href="http://cramp.in/">cramp.in</a> <br><br>  What is EventMachine and how to use it <br>  <a href="https://github.com/eventmachine/eventmachine/wiki">github.com/eventmachine/eventmachine/wiki</a> <br><br>  Websockets with Cramp <br>  <a href="http://vinsol.com/blog/2011/05/09/websockets-with-cramp/">vinsol.com/blog/2011/05/09/websockets-with-cramp</a> <br><br>  Another small article about Cramp and WebSockets <br>  <a href="http://boldr.net/html5-websockets-cramp">boldr.net/html5-websockets-cramp</a> </div><p>Source: <a href="https://habr.com/ru/post/132855/">https://habr.com/ru/post/132855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132847/index.html">Cloud4Y has launched a new cloud!</a></li>
<li><a href="../132848/index.html">Efficiency of antivirus companies or the history of a single virus report</a></li>
<li><a href="../132850/index.html">Robots for agriculture</a></li>
<li><a href="../132851/index.html">X Neural Switcher - Cookbook (Part 2). Algorithms</a></li>
<li><a href="../132852/index.html">Automatic backlight for TV</a></li>
<li><a href="../132856/index.html">Flash vs HTML5. Our version</a></li>
<li><a href="../132857/index.html">College IT infrastructure. What is, what I would like and how to</a></li>
<li><a href="../132858/index.html">Tomorrow the Internet will start to die.</a></li>
<li><a href="../132859/index.html">ITJump 2011 competition ended - $ 40,000 prize pool</a></li>
<li><a href="../132861/index.html">New Skype 5.4 Beta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>