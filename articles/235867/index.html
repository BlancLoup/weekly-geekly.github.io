<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we made a studio to record online courses</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In short, Stepic is a platform where each user can create and host his own online course. Last year, Stepic was used in the Bioinformatics Algorithms ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we made a studio to record online courses</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/0bc/ccd/cf0/0bcccdcf0c624318a66a951b1d3611d9.jpg" align="right">  In short, Stepic is a platform where each user can create and host his own online course.  Last year, Stepic was used in the <a href="http://habrahabr.ru/company/stepic/blog/196870/">Bioinformatics Algorithms</a> course on Coursera as an engine for testing programming and data analysis tasks. <br><br>  After some time, we realized that it was worth helping to develop online education in Russia.  What is needed for that?  Good teachers and a good studio where you can record video.  Since we love programming, we decided to start with courses that are somehow related to programming, these are <a href="https://stepic.org/course/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC%25D1%258B-%25D0%25B8-%25D1%2581%25D1%2582%25D1%2580%25D1%2583%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D1%258B-%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585-63">algorithms and data structures</a> , <a href="https://stepic.org/course/%25D0%2592%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5-%25D0%25B2-%25D0%25B0%25D1%2580%25D1%2585%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BA%25D1%2582%25D1%2583%25D1%2580%25D1%2583-%25D0%25AD%25D0%2592%25D0%259C-%25D0%25AD%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D1%258B-%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585-%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC-65">operating systems</a> and <a href="https://stepic.org/course/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-%25D0%25BD%25D0%25B0-%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA%25D0%25B5-%25D0%25A1%2B%2B-7">C ++ language</a> from teachers at the Computer Science Center. <br><br>  And after some time we realized that <b>the more good recording studios there are, the better for all of us and education in general</b> .  Therefore, we decided to tell, show and put in open-source all those small developments that currently exist in Stepic in terms of video courses and their production. <br><a name="habracut"></a><br><h4>  Studio and equipment </h4><br>  This diagram shows the automated video lecture recording process to which we arrived: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/0c5/e7b/fcd/0c5e7bfcda5ee1e0ccdc6111c9eb80d5.gif" alt="image"><br><br>  We decided not to reinvent the wheel, but to see how similar projects are equipped abroad.  The starting point was the <a href="http://moocs.epfl.ch/production">studio in the Swiss EPFL</a> , where the EMOOCs 2014 conference took place in the winter. A video about the studio in EPFL <a href="http://www.youtube.com/watch%3Fv%3DnmLcxftaU5Q">can be viewed here</a> . <br><br>  A list of necessary equipment was made (approximate prices in Russia are indicated): <br><ol><li>  2 stands for the background (3'000 rub. Per piece) </li><li>  4 racks for 4 light sources (1'500 rubles apiece) </li><li>  2 sources of FalconEyes with 5 energy saving lamps of cold light on a background light (5'500 rub apiece) </li><li>  2 sources with cold light lamps for lecturer lighting (DFL-556) (11'000 rub. Per piece) </li><li>  White and green background (1'500 rub. Per piece) </li><li>  Canon XA25 camcorder (90'000 rubles) </li><li>  Tripod under the camera Libec TH-950DV (10'000 rub.) </li><li>  Audio-Technica AT2031 microphone (8'000 rub.), Stuck into the camera </li><li>  Stand under the microphone Samson MB1 Mini Boom Stand (2'500 rub.) </li><li>  Microphone mount for AT8410a Microphone Shock Mount (3'500 rub.) </li><li>  Wacom Cintiq 24HD Interactive Pen Display DTK-2400 (120'000 rub.) - a monitor on which you can draw by hand on the slides </li><li>  Apple Mac mini: i5, 2.5HGz (Late 2012) (~ 25'000 rub.) - the teacher's computer, which is connected to the monitor Wacom </li><li>  PC (Server): i7, 3 TB HDD, 16 GB RAM, Win (~ 25'000 rub.) - a computer on which the server is running and where video streams flow </li><li>  AJA ROI (35'000 rub.) </li><li>  BlackMagic DeckLink Duo (18'000 rub.) </li></ol><br>  Total, approximately: 385 thousand rubles. <br><br>  I think the choice of all items, with the exception of three, does not cause questions.  But about why we chose this canon and why AJA ROI and DeckLink are needed, I would like to tell you below. <br><br><h4>  AJA ROI and DeckLink Duo </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/6d0/1e2/5ce/6d01e25ce8efea114d8bad0dd35803a3.png" alt="AJA ROI"><img src="https://habrastorage.org/getpro/habr/post_images/73b/dc4/979/73bdc4979133751a5521c61f715755ca.jpg" alt="Decklink Duo"><br><br>  In our studio (as in the studio of the Swiss), we use BNC wires that come out of the camera and AJA ROI and come to Decklink Duo on the PC.  Which, at a certain point, at the request of the teacher, begins to record two streams and carefully fold them into a daddy on the server.  AJA ROI serves as a signal splitter, it is installed between Mac mini and Wacom, it duplicates the channel that Mac mini receives and sends it to the server. <br><br>  Above was presented a schematic view of the studio so that you can understand how we have the light sources and how the wires are drawn. <br><br><h4>  Camera </h4><br>  Camera Canon XA25 was not chosen by chance.  The fact is that this model is the only one on the market in a similar price segment that has SDI output, and this is very important. <br><br>  What kind of SDI channel is this and why is it so rarely heard about it if it is so good? <br><br>  SDI is an image transmission standard that is still used in television and the transmission medium of this channel is the usual 75-ohm coaxial cable found in every radio store.  That's all.  So why use this SDI?  It's very simple, if you have 2 SDI channels encoded in real time, you have no problems, if you use the HDMI protocol instead of SDI, then you may already need additional equipment capable of processing these streams in real time. <br><br>  Also advantages SDI is the relative lack of restrictions imposed on the length of the cable and its secure attachment <br><br>  So, everything has arrived, everything has been collected, let's launch and see what problems we face. <br><br><h4>  Problems </h4><br>  The first unpleasant surprise that awaited us was the restriction on the format of the image via the SDI channel from the camera.  As I already mentioned, the camera is the only one in this price segment that can produce HD video through an analog interface.  But the fly in the ointment is that the SDI image is broadcast in 1080i format ( <a href="https://tech.ebu.ch/docs/techreports/tr005.pdf">here you can read about the differences between 1080i and 1080p</a> ). <br><br>  The second problem: there is no signal!  The fact is that the SDI interface is very sensitive to the frame rate and resolution, so if the camera gives you 1080i and 50 frames per second (the camera canon gives this format), then the server should have exactly 1080i and 50, otherwise You will see a black screen and you will think that the problem is not in the settings. <br><br>  Even if the settings on the camera and the server are the same, sometimes it may happen that there is no image - it may be in the wires themselves.  In this case, you just need to check all contacts and find the weak link.  Although the SDI mounts themselves are very reliable and never fall out, the problem may be somewhere in the middle of the cable.  We encountered such a problem and by trial and error found and eliminated a weak spot. <br><br><h4>  Well, if everything works, let's move on. </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/547/5ee/d6f/5475eed6f03c153e1873cee5a2d6a5a2.jpg" alt="Studio"><br><br>  How now to write lectures on the server?  I want some simple solution.  However, the most obvious solution (using the software that comes bundled with the BlackMagic DeckLink capture card) is far from the most convenient. <br><br>  First of all, the lecturer himself cannot start recording, which means he needs a person who will do it. <br><br>  Secondly, DeckLink Studio does not allow encoding in real time, which means we will receive uncompressed video = 1 minute about 1 GB ... <br><br>  Well, the last inconvenience is that it is necessary to open two copies of the application from different users.  This is of course solved by writing a bat-script (I remind you: Windows server), but by pressing the recording in two different channels manually, we get 2 unsynchronized files. <br><br><h4>  Synchronous recording of two video streams </h4><br>  The obvious solution is to use a Mac server and buy a <a href="http://www.softronmedia.com/products/movierecorder.html">Movie Recorder</a> for $ 1000 per channel.  This is exactly what was done by our colleagues in Switzerland.  But we decided to go the other way.  Of course, there were ideas to implement a custom interface using the DeckLink SDK, but then we got a wonderful device that really helps us to this day.  So, meet: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a17/dd9/fe2/a17dd9fe2d29749cdc6bb9a812ccdf5f.jpg" alt="ATEM Television Studio"><br><br>  ATEM Television Studio.  In general, the purpose of this card: in real-time encode video from different cameras and allow the operator to switch between them.  As usual, the software supplied is not very convenient.  However, on the Internet, a ready-made software ( <a href="http://mxlight.co.uk/">MXLight</a> ) was found which has a command line interface and allows you to record an image from the channel connected to this card. <br><br>  So, we have a bat-file that can start recording from the camera, and another bat-file that can stop this process: <br><br><pre><code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> name=D:\VIDEO\CPP_Course\Week3\Professor\Step4 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> TIMESTAMP=<span class="hljs-variable"><span class="hljs-variable">%TIME:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIME:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIME:~6,2%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> <span class="hljs-variable"><span class="hljs-variable">%name%</span></span>.TS ( <span class="hljs-built_in"><span class="hljs-built_in">START</span></span> D:\VIDEO\MXLight\MXLight.exe record-to-file=<span class="hljs-variable"><span class="hljs-variable">%name%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIMESTAMP%</span></span>.TS record=on ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">START</span></span> D:\VIDEO\MXLight\MXLight.exe record-to-file=<span class="hljs-variable"><span class="hljs-variable">%name%</span></span>.TS record=on )</code> </pre> <br>  It remains to deal with the interface card DeckLink.  The solution was found very quickly - ffmpeg for Windows supports DirectShow, and the DeckLink card is nothing more than a DirectShow device. <br><br>  And voila - here it is a bat-file which starts the screen recording: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> name=D:\VIDEO\CPP_Course\Week3\ScreenCast\Final_ScreenCast_LAST <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> EXT=mp4 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> TIMESTAMP=<span class="hljs-variable"><span class="hljs-variable">%TIME:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIME:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIME:~6,2%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> <span class="hljs-variable"><span class="hljs-variable">%name%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%EXT%</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">START</span></span> D:\VIDEO\ffmpeg\bin\ffmpeg.exe -y -video_size <span class="hljs-number"><span class="hljs-number">1920</span></span>x1080 -pixel_format uyvy422 -rtbufsize <span class="hljs-number"><span class="hljs-number">702000</span></span>k -framerate <span class="hljs-number"><span class="hljs-number">24</span></span> -f dshow -i video="Decklink Video Capture" <span class="hljs-variable"><span class="hljs-variable">%name%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%TIMESTAMP%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%EXT%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">START</span></span> D:\VIDEO\ffmpeg\bin\ffmpeg.exe -y -video_size <span class="hljs-number"><span class="hljs-number">1920</span></span>x1080 -pixel_format uyvy422 -rtbufsize <span class="hljs-number"><span class="hljs-number">702000</span></span>k -framerate <span class="hljs-number"><span class="hljs-number">24</span></span> -f dshow -i video="Decklink Video Capture" <span class="hljs-variable"><span class="hljs-variable">%name%</span></span>.<span class="hljs-variable"><span class="hljs-variable">%EXT%</span></span> )</code> </pre><br>  But with the stop recording screen had to tinker a bit, the fact is that you can not just take and close ffmpeg.  In this case, the capture file will be damaged, and may be reproduced with interference.  For correct completion of the video capture mode, we need to send a keypressed event "q" from the keyboard. <br><br>  Thus, you still need a person who starts the recording and stops it correctly. <br>  I really didn't like it, and I decided to raise a simple Node.js server as an experiment, and since I never wrote JS, I would kill two birds with one stone. <br><br>  This is how the epicStudio application was born, the launch of which is carried out by the lecturer himself from a browser opened on Wacom (Mac mini).  Link to Gihtab - <a href="https://github.com/StepicOrg/epicStudio">epicStudio</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab0/6c5/fae/ab06c5fae9d40473d707325174a93526.png" alt="epicStudio"><br><br>  After starting, the teacher begins to tell a lecture and draw on slides.  At the end of the lecture, the teacher stops recording himself and can start recording a new topic.  At the end of the day I can only download files from the server and glue the lecture. <br><br>  This process, we also tried to optimize.  So, I have written various tools for automatically cutting out unnecessary pieces, overlaying watermark and bringing all videos to the same volume.  I think they will be briefly told about them next time, in any case, I post my tools in <a href="https://github.com/StepicOrg/epicTools">this repository</a> and you can see them there. <br><br><h4>  Finally, examples of the resulting video: </h4><br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/105479103&amp;xid=17259,15700021,15700186,15700190,15700253,15700256&amp;usg=ALkJrhhmoLu7MRy1nuLGeI0Lo61cI8SVSg" width="560" height="315" frameborder="0" title="1-3-04" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/105491967&amp;xid=17259,15700021,15700186,15700190,15700253,15700256&amp;usg=ALkJrhha1gAw_XHFq3rzhCLPiaB9qni2ng" width="560" height="315" frameborder="0" title="C_00_02" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><br>  <b>UPD:</b> In January 2015, we updated the configuration of our studio - it became more convenient, better and ... cheaper.  We will write more details on the post, but if you are urgently interested in the configuration and equipment list, ask at <a href="">team@stepic.org</a> .  We are also building a similar studio in Moscow, which will be open to teachers who host <a href="https://stepic.org/">MOOCs</a> on <a href="https://stepic.org/">Stepic</a> .  So if you would like to record a course with us, please contact us. <br><br>  <b>UPD2:</b> Continued (April 2015): <a href="http://habrahabr.ru/company/stepic/blog/255053/">habrahabr.ru/company/stepic/blog/255053</a> </div><p>Source: <a href="https://habr.com/ru/post/235867/">https://habr.com/ru/post/235867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235853/index.html">Yandex is visiting Alfa Laboratories</a></li>
<li><a href="../235855/index.html">Two beautiful tasks on algorithms</a></li>
<li><a href="../235857/index.html">Official announcement of MEGAsync client for Linux</a></li>
<li><a href="../235861/index.html">Preparing for the exam on computer science in 1C: Club programmers</a></li>
<li><a href="../235863/index.html">How we conducted the Summer School for High Performance Computing</a></li>
<li><a href="../235869/index.html">We write under TSD. Connecting a barcode scanner as a form component</a></li>
<li><a href="../235873/index.html">Bold AngularJS for Team Development [1/2]</a></li>
<li><a href="../235875/index.html">WebMoney updated interfaces</a></li>
<li><a href="../235877/index.html">Physical and biological satellites of the series "Foton" and "Bion"</a></li>
<li><a href="../235879/index.html">Senseit L301 - when the smartphone takes care of you</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>