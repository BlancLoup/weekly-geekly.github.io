<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Progress Indicator with HTML5 Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 
 More and more articles appear about Canvas, and this is good news. The basics , hopefully, have already been studied, and I would like to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Progress Indicator with HTML5 Canvas</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br>  More and more articles appear about Canvas, and this is good news.  <a href="http://habrahabr.ru/blogs/html5/111308/">The basics</a> , hopefully, have already been studied, and I would like to share an example of the possible practical use of canvas, namely, to create an animated progress indicator. <br><br>  For impatient experiment results you can see here: <a href="http://pastehtml.com/view/1d7z824.html">http://pastehtml.com/view/1d7z824.html</a> , as well as a screenshot of the final result: <br><img src="https://habrastorage.org/storage/492369bb/675ecef7/8463261e/b66e810b.png"><br><br>  The progress bar turned out pretty simple, but at the same time in the style of web 2.0 - rounded (of course!), With elements of depth and volume: that is, shadows and gradients. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For details, I ask under the cat. <br><a name="habracut"></a><br><h3>  Substrate </h3><br>  Let's start with drawing the substrate, which will be filled with progress.  We will make roundings at the ends of the rectangle using the <a href="https://developer.mozilla.org/en/Canvas_tutorial/Drawing_shapes">arc ()</a> function, so in this case the rectangle will always be rounded at the ends by semi-circles, to create an arbitrary rounding (as when using border-radius), it‚Äôs enough to use 2 <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B0%25D1%258F_%25D0%2591%25D0%25B5%25D0%25B7%25D1%258C%25D0%25B5">Bezier</a> <a href="https://developer.mozilla.org/en/Canvas_tutorial/Drawing_shapes">curves</a> and segment between them (degenerating to a point with a semicircle, as in our case).  So, the function of creating a filled outline of the substrate will look like this: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roundRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, x, y, width, height, radius</span></span></span><span class="hljs-function">) </span></span>{ ctx.beginPath(); ctx.moveTo(x + radius, y); ctx.lineTo(x + width - radius, y); ctx.arc(x+width-radius, y+radius, radius, -<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); ctx.lineTo(x + radius, y + height); ctx.arc(x+radius, y+radius, radius, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); ctx.closePath(); ctx.fill(); }</code> </pre> <br><br>  Add a background shadow and volume.  The volume will be created using a linear gradient with three stops, the shadows using the standard context properties: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">progressLayerRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, x, y, width, height, radius</span></span></span><span class="hljs-function">) </span></span>{ ctx.save(); <span class="hljs-comment"><span class="hljs-comment">//   ctx.shadowOffsetX = 2; ctx.shadowOffsetY = 2; ctx.shadowBlur = 5; ctx.shadowColor = '#666'; //    ctx.fillStyle = 'rgba(189,189,189,1)'; roundRect(ctx, x, y, width, height, radius); //     //   ctx.shadowColor = 'rgba(0,0,0,0)'; var lingrad = ctx.createLinearGradient(0,y+height,0,0); lingrad.addColorStop(0, 'rgba(255,255,255, 0.1)'); lingrad.addColorStop(0.4, 'rgba(255,255,255, 0.7)'); lingrad.addColorStop(1, 'rgba(255,255,255,0.4)'); ctx.fillStyle = lingrad; roundRect(ctx, x, y, width, height, radius); ctx.restore(); }</span></span></code> </pre><br><br>  Here two layers are used - the bottom one in solid gray and the top white with transparency gradients.  In my opinion, this allows you to get a clearer border of the substrate and looks more realistic, in any case, you can always experiment with all the color settings. <br><br>  If everything was done correctly, you should get something like the following: <img src="https://habrastorage.org/storage/85989c54/e3912223/b604b2bf/f9c54874.png"><br><br><h4>  Progress indicator </h4><br>  We now turn to the creation of progress-making progress. <br>  Progress is the same rectangle with rounded edges, only in a different color.  However, it has a feature that distinguishes it from the substrate and which must be taken into account when drawing - when the width of the progress is less than the radius of rounding and when the width is more than the length of the substrate minus the radius.  In these cases, it is necessary to additionally calculate the angles of drawing the rounding and the position of the <a href="http://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25BE%25D1%2580%25D0%25B4%25D0%25B0_%2528%25D0%25B3%25D0%25B5%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2582%25D1%2580%25D0%25B8%25D1%258F%2529">chord of the circle</a> , all calculations are made on the basis of the school geometry course, for clarity, they are shown in the figure below: <br><img src="https://habrastorage.org/storage/cea3f178/a2650ddd/058783e6/1330644f.png"><br><br>  Plus, add a shadow from the right edge of the progress to give it a volume effect. <br>  As a result, we get the following progress rendering code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">progressBarRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, x, y, width, height, radius, max</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     var offset = 0; ctx.beginPath(); if (width&lt;radius) { offset = radius - Math.sqrt(Math.pow(radius,2)-Math.pow((radius-width),2)); //   var left_angle = Math.acos((radius - width) / radius); ctx.moveTo(x + width, y+offset); ctx.lineTo(x + width, y+height-offset); ctx.arc(x + radius, y + radius, radius, Math.PI - left_angle, Math.PI + left_angle, false); } else if (width+radius&gt;max) { offset = radius - Math.sqrt(Math.pow(radius,2)-Math.pow((radius - (max-width)),2)); //   var right_angle = Math.acos((radius - (max-width)) / radius); ctx.moveTo(x + radius, y); ctx.lineTo(x + width, y); ctx.arc(x+max-radius, y + radius, radius, -Math.PI/2, -right_angle, false); ctx.lineTo(x + width, y+height-offset); ctx.arc(x+max-radius, y + radius, radius, right_angle, Math.PI/2, false); ctx.lineTo(x + radius, y + height); ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false); } else { ctx.moveTo(x + radius, y); ctx.lineTo(x + width, y); ctx.lineTo(x + width, y + height); ctx.lineTo(x + radius, y + height); ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false); } ctx.closePath(); ctx.fill(); //   if (width&lt;max-1) { ctx.save(); ctx.shadowOffsetX = 1; ctx.shadowBlur = 1; ctx.shadowColor = '#666'; if (width+radius&gt;max) offset = offset+1; ctx.fillRect(x+width,y+offset,1,total_height-offset*2); ctx.restore(); } }</span></span></code> </pre><br><br>  Here, unlike the previous function, we do not save and restore the context as in the case of the substrate, because we are going to set global progress attributes for progress. <br><br><h4>  Progress text </h4><br>  It remains to add a text describing the progress in percent.  The text will be located directly at the right border of the progress if the length of the text is less than the length of the progress, or at the left margin of the progress otherwise.  To measure the test length, we use the <a href="https://developer.mozilla.org/en/drawing_text_using_a_canvas">measureText ()</a> function: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">progressText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, x, y, width, height, radius, max</span></span></span><span class="hljs-function">) </span></span>{ ctx.save(); ctx.fillStyle = <span class="hljs-string"><span class="hljs-string">'white'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(width/max*<span class="hljs-number"><span class="hljs-number">100</span></span>)+<span class="hljs-string"><span class="hljs-string">"%"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text_width = ctx.measureText(text).width; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text_x = x+width-text_width-radius/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (width&lt;=radius+text_width) { text_x = x+radius/<span class="hljs-number"><span class="hljs-number">2</span></span>; } ctx.fillText(text, text_x, y+<span class="hljs-number"><span class="hljs-number">22</span></span>); ctx.restore(); }</code> </pre><br><br><h4>  Full progress indicator </h4><br>  Now it remains to connect all the parts together and set the animation, which fills the progress from 0 to 100%.  For animation, we use the functions <a href="https://developer.mozilla.org/en/DOM/window.setInterval">setInterval ()</a> and <a href="https://developer.mozilla.org/en/DOM/window.clearInterval">clearInterval ()</a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      var i = 0; var res = 0; var context = null; var total_width = 300; var total_height = 34; var initial_x = 20; var initial_y = 20; var radius = total_height/2; window.onload = function() { //   canvas var elem = document.getElementById('myCanvas'); //   canvas  if (!elem || !elem.getContext) { return; } context = elem.getContext('2d'); if (!context) { return; } //    context.font = "16px Verdana"; //    var progress_lingrad = context.createLinearGradient(0,initial_y+total_height,0,0); progress_lingrad.addColorStop(0, '#4DA4F3'); progress_lingrad.addColorStop(0.4, '#ADD9FF'); progress_lingrad.addColorStop(1, '#9ED1FF'); context.fillStyle = progress_lingrad; //   res = setInterval(draw, 50); } function draw() { //    1    i+=1; //    context.clearRect(initial_x-5,initial_y-5,total_width+15,total_height+15); progressLayerRect(context, initial_x, initial_y, total_width, total_height, radius); progressBarRect(context, initial_x, initial_y, i, total_height, radius, total_width); progressText(context, initial_x, initial_y, i, total_height, radius, total_width ); //     100% if (i&gt;=total_width) { clearInterval(res); } }</span></span></code> </pre><br><br>  That's all, it remains to place the javascript code in the <i>&lt;script&gt; tag</i> , and add it to the <i>&lt;body&gt; of the</i> document: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myCanvas"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"150"</span></span></span><span class="hljs-tag">&gt;</span></span>Your browser does not have support for canvas.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Once again the link to the result: <a href="http://pastehtml.com/view/1d7z824.html">http://pastehtml.com/view/1d7z824.html</a> <br><br><h4>  Inset shadow </h4><br>  In conclusion, I prepared a different substrate style using inset shadow, in which case the substrate would appear pressed inward.  The original idea is taken from here: <a href="http://weblog.bocoup.com/can-i-draw-an-inset-shadow-with-the-html5-canvas-api">http://weblog.bocoup.com/can-i-draw-an-inset-shadow-with-the-html5-canvas-api</a> <br><br>  The fact is that in canvas there are no means for creating inset shadow as easily as in css, and the essence of the above method is to use a technique called ‚ÄúOpposite winding‚Äù, which also applies to canvas. <br><br>  To achieve the desired effect, first draw a sufficiently large outer rectangle with a counterclockwise direction, and then an inside figure with a clockwise direction.  If everything is done correctly, we will end up with an inset shadow for the inner shape. <br>  To get the inset shadow effect, create a new <i>roundInsetRect ()</i> function and modify the <i>progressLayerRect ()</i> function as follows: <br><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roundInsetRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, x, y, width, height, radius</span></span></span><span class="hljs-function">) </span></span>{ ctx.beginPath(); <span class="hljs-comment"><span class="hljs-comment">//       ctx.moveTo(1000, 1000); ctx.lineTo(1000, -1000); ctx.lineTo(-1000, -1000); ctx.lineTo(-1000, 1000); ctx.lineTo(1000, 1000); ctx.moveTo(x + radius, y); ctx.lineTo(x + width - radius, y); ctx.arc(x+width-radius, y+radius, radius, -Math.PI/2, Math.PI/2, false); ctx.lineTo(x + radius, y + height); ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false); ctx.closePath(); ctx.fill(); } function progressLayerRect(ctx, x, y, width, height, radius) { ctx.save(); //   ctx.shadowOffsetX = 2; ctx.shadowOffsetY = 2; ctx.shadowBlur = 5; ctx.shadowColor = '#666'; //    ctx.fillStyle = 'rgba(189,189,189,1)'; roundRect(ctx, x, y, width, height, radius); ctx.fillStyle = 'white'; roundInsetRect(ctx, x, y, width, height, radius); ctx.restore(); }</span></span></code> </pre><br><br>  How it looks you can see here: <a href="http://pastehtml.com/view/1d80e6t.html">http://pastehtml.com/view/1d80e6t.html</a> <br><br>  I will hear comments / additions on the implementation, I hope it will be useful. </div><p>Source: <a href="https://habr.com/ru/post/113782/">https://habr.com/ru/post/113782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113776/index.html">Communication of the future</a></li>
<li><a href="../113777/index.html">Need experts</a></li>
<li><a href="../113778/index.html">The guy laid out his genome on Github under an open license</a></li>
<li><a href="../113779/index.html">[Webinar] Representation of hierarchical structures in relational databases: Materialized Path</a></li>
<li><a href="../113780/index.html">Earn on content</a></li>
<li><a href="../113783/index.html">Distree XXL: Blu-ray player on Intel Atom, keyboard for tablet PCs and others</a></li>
<li><a href="../113784/index.html">The future of the Windows Phone platform is revealed: multitasking, IE9 and GPU acceleration of web pages, integration with Kinect, and more.</a></li>
<li><a href="../113785/index.html">20 years of the company Blizzard Entertainment</a></li>
<li><a href="../113786/index.html">VKontakte privacy panic - explanations</a></li>
<li><a href="../113787/index.html">Who needs me?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>