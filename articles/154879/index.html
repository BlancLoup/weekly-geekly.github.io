<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco IOS ACLs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all! 

 In this article, I would like to talk about the capabilities of Cisco IOS Access Control Lists (ACLs). The topic of many of you sh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco IOS ACLs</h1><div class="post__text post__text-html js-mediator-article">  Good day to all! <br><br>  In this article, I would like to talk about the capabilities of Cisco IOS Access Control Lists (ACLs).  The topic of many of you should be familiar, so I want to summarize information on different types of ACLs.  I will briefly go over the basics and then talk about special types of ACLs: time-based (time-based), reflexive (reflective), dynamic (dynamic).  So, let's begin‚Ä¶ <a name="habracut"></a><br><br><h4>  The basics: Recall everything ... </h4><br>  Quickly run through the basic concepts, syntax, so that later you can easily move on to more interesting things.  ACLs on Cisco routers allow you to solve two groups of tasks: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  traffic filtering; </li><li>  traffic classification. </li></ul><br>  This article is mainly about filtering, i.e.  using ACL as a firewall.  The classification allows you to select packages for further processing.  For example, encrypt only certain traffic when creating a VPN, apply quality of service policies, broadcast only certain addresses, etc. <br><br>  ACLs can be attributed to packet filtering firewalls.  Those.  they allow you to filter packets by five parameters: <br><br><ul><li>  Source ip address </li><li>  Destination ip address </li><li>  IP encapsulated protocol </li><li>  Source port </li><li>  Port of destination </li></ul><br>  ACLs are divided into 2 types: <br><br><ul><li>  Standard </li><li>  Extended (Extended) </li></ul><br>  Standard ACLs allow filtering traffic by a single criterion - the source IP address.  Extended ACLs filter by all five parameters listed. <br><br>  ACL consists of a set of rules.  In each rule, you define the filtering parameters (addresses, ports, etc.) and the action performed on the packet, if it meets all the criteria of the rule.  There are two actions: permit and deny.  When enabled, the packet is processed further; if disabled, it is discarded.  The rules are checked sequentially until the one that matches the packet is found.  An action is taken over the packet (permit / deny) and further verification of the rules is terminated.  At the end of any ACL, there is an implicit rule that prohibits all traffic.  Those.  restrictive access control is used: everything that is not explicitly allowed is prohibited. <br><br><h5>  Syntax </h5><br>  Two ways to create an ACL: <br><br><ul><li>  ‚ÄúOld‚Äù syntax.  To identify the ACL numbers are used.  Standard ACLs are assigned numbers 1-99 and 1300-1999, and extended ACL numbers are 100-199 and 2000-2699. </li><li>  Named ACL syntax.  For identification, use the name selected by the administrator. </li></ul><br>  The second method is more convenient.  First, to identify the ACL, you use the name, not the number, i.e.  by name it will be possible to understand why you use the ACL.  Secondly, named sheets use their own configuration mode, which allows you to more conveniently edit ACLs. <br><br>  Here are some examples of standard ACLs: <br><br><pre><code class="bash hljs">access-list 1 permit 192.168.1.0 0.0.0.255 ! access-list 2 permit any ! access-list 3 permit host 10.1.1.1 ! access-list 4 permit 10.1.1.0 0.0.0.15 access-list 4 permit 192.168.0.0 0.0.31.255</code> </pre> <br>  The first ACL (1) allows traffic from the 192.168.1.0/24 network.  The second (2) ACL allows all traffic.  The third (3) allows traffic from the host 10.1.1.1.  And the last fourth, in the first line allows traffic from hosts 10.1.1.0 to 10.1.1.15, in the second line allows traffic from networks 192.168.0.0 - 192.168.31.0.  I note that here are examples of four different ACLs, and not 5 rules of a single ACL. <br><br>  And a few extended ACLs: <br><br><pre> <code class="bash hljs">access-list 100 permit tcp 10.1.1.0 0.0.0.255 any eq 80 access-list 101 permit udp host 1.1.1.1 eq 500 host 2.2.2.2 eq 555 access-list 102 permit icmp any any <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> access-list 103 permit ip any any</code> </pre><br>  ACL 100 allows TCP traffic from a 10.1.1.0/24 network to any network, destination port 80. That is,  allow web surfing from the local network.  ACL 101 allows UDP traffic from host 1.1.1.1, port 500 to host 2.2.2.2, port 555. ACL 102 allows pings from anywhere to anywhere.  And finally, the last ACL 103 allows all traffic. <br><br>  Similar standard and extended ACLs, but using the new syntax: <br><br><pre> <code class="bash hljs">ip access-list standard LIST1 permit 192.168.1.0 0.0.0.255 ! ip access-list standard LIST2 permit any ! ip access-list standard LIST3 permit host 10.1.1.1 ! ip access-list standard LIST1 permit 10.1.1.0 0.0.0.15 permit 192.168.0.0 0.0.31.255 ! ip access-list extended LIST100 permit tcp 10.1.1.0 0.0.0.255 any eq 80 ! ip access-list extended LIST101 permit udp host 1.1.1.1 eq 500 host 2.2.2.2 eq 555 ! ip access-list extended LIST102 permit icmp any any <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ! ip access-list extended LIST103 permit ip any any</code> </pre><br>  Editing ACLs has become much easier starting I iOS 12.3 ,.  If you give the command: <br><br><pre> <code class="bash hljs">show access-list</code> </pre><br>  You will see a list of ACLs and their contents: <br><br><pre> <code class="bash hljs">R0(config-ext-nacl)<span class="hljs-comment"><span class="hljs-comment">#do sh access-li Standard IP access list LIST1 &lt;b&gt; 10&lt;/b&gt; permit 192.168.1.0, wildcard bits 0.0.0.255 &lt;b&gt; 20&lt;/b&gt; permit 10.1.1.0, wildcard bits 0.0.0.15 &lt;b&gt; 30&lt;/b&gt; permit 192.168.0.0, wildcard bits 0.0.31.255 Standard IP access list LIST2 10 permit any Standard IP access list LIST3 10 permit 10.1.1.1 Extended IP access list LIST100 10 permit tcp 10.1.1.0 0.0.0.255 any eq www Extended IP access list LIST101 10 permit udp host 1.1.1.1 eq isakmp host 2.2.2.2 eq 555 Extended IP access list LIST102 10 permit icmp any any echo Extended IP access list LIST103 10 permit ip any any</span></span></code> </pre><br>  Notice that the ACL lines are numbered.  To add new lines to a specific position, enter the edit mode of the desired ACL and enter the line number before entering a new rule: <br><br><pre> <code class="bash hljs">ip access-list standard LIST1 25 permit ‚Ä¶</code> </pre><br>  And it does not matter how you created the ACL - with the help of the old syntax or in a new way, just specify the number of the ACL instead of the name.  Adding and deleting lines is done in exactly the same way. <br><br>  To delete lines, use the no command with the line number: <br><br><pre> <code class="bash hljs">ip access-list standard LIST103 no 25</code> </pre><br>  You can renumber the lines: <br><br><pre> <code class="bash hljs">ip access-list resequence LIST103 10 50</code> </pre><br>  In the example above, the ACL named LIST103 will be renumbered and the first line number will be 10, and the subsequent lines will be numbered in increments of 50. That is,  10, 60, 110, 160 ... <br><br>  Finally, after creating the ACL, you will need to apply it in accordance with your goals and objectives.  As for filtering, the ACL is applied on the interface.  When applying, you will need to specify the direction of filtering: in (input) - traffic comes from the wire to the router interface, out (exit) - traffic from the interface goes to the wire.  In the example, the ACL is used to filter inbound traffic: <br><br><pre> <code class="bash hljs">interface fa0/0 ip access-group LIST103 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span></code> </pre><br>  All this, I hope, famous things.  If you have any questions, ask, I will try to answer.  If there are a lot of questions, you can make a separate post.  Now let's look at the additional features that ACLs have on Cisco routers. <br><br><h4>  Time-based ACLs </h4><br>  Let's start with ACLs in which you can use time as an additional criterion by which traffic will be filtered or classified.  For example, during working hours, web surfing is prohibited, and at lunchtime and after work - please.  What is required to create a time-based ACL?  Everything is very simple: <br><br><ol><li>  Create one or more "calendars" - time ranges; </li><li>  Use these "calendars" in the extended ACL rules. </li></ol><br>  To create a "calendar", use the <b>time-range</b> command, in which you specify an arbitrary name assigned to the calendar.  You will later refer to this name in your ACL rules.  In the example, I create a ‚Äúcalendar‚Äù named WORK_DAYS: <br><br><pre> <code class="bash hljs">time-range WORK_DAYS absolute start 00:00 01 January 2012 end 23:59 31 December 2012 periodic weekdays 9:00 to 18:00 periodic ? Friday Friday Monday Monday Saturday Saturday Sunday Sunday Thursday Thursday Tuesday Tuesday Wednesday Wednesday daily Every day of the week weekdays Monday thru Friday weekend Saturday and Sunday</code> </pre><br>  In the calendar configuration mode, you define time ranges.  Two types of ranges: <br><br><ul><li>  Absolute (specific dates and times are indicated). </li><li>  Periodic (indicate the days of the week, working days or weekends, but without reference to a specific date). </li></ul><br>  In the example above, two time intervals are created: absolute (determines the time from 00:00 January 01, 2012 to 23:59 December 31, 2012) and relative (determines days from Monday to Friday, from 9:00 to 18:00).  For periodic intervals, as you can see, you can use the names of the days of the week, daily - daily, weekdays - weekdays, weekend - weekends. <br>  To view the created "calendars" give the <b>show time-tange command</b> : <br><br><pre> <code class="bash hljs">R0<span class="hljs-comment"><span class="hljs-comment">#sh time-range time-range entry: WORK_DAYS &lt;b&gt;(active)&lt;/b&gt; absolute start 00:00 01 January 2012 end 23:59 31 December 2012</span></span></code> </pre><br>  The word <b>active</b> next to the name of the calendar means that it is active, i.e.  The ‚Äúcalendar‚Äù time now corresponds to the current time on the router. <br><br>  Now let's use our ‚Äúcalendar‚Äù in the ACL rules: <br><br><pre> <code class="bash hljs">ip access-list extended TIME_BASED_ACL permit tcp 10.0.0.0 0.255.255.255 any eq www &lt;b&gt;time-range WORK_DAYS&lt;/b&gt; permit tcp 10.0.0.0 0.255.255.255 any eq ftp-data &lt;b&gt;time-range ANOTHER_RANGE&lt;/b&gt;</code> </pre><br>  As you can see, you can use different ‚Äúcalendars‚Äù for different rules of one ACL.  Calendars can only be used in extended ACLs. <br><br><h4>  Reflexive ACL </h4><br>  Reflective or mirrored ACLs allow some filtering to be extended.  In effect, they turn the ACL from packet filtering into a stateful inspection firewall.  Those.  Now the router will monitor the status of sessions initiated from the company's internal network and create appropriate return rules. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e2/7d2/1e1/8e27d21e10a8af0d89f779f8889f2101.jpg" alt="image"><br><br>  Let me explain with an example of a typical situation.  There is an internal network 192.168.1.0/24.  We allow access from this network to the Internet (http) - a ‚Äúgreen‚Äù ACL.  Those.  With this ACL, we define exit policies from the internal network to the external network.  With the help of a second, ‚Äúred‚Äù ACL, we protect the internal network from outside intrusions.  But it is necessary to allow responses to sessions initiated from the internal network, so we allow return traffic.  It seems to be all logical: they allowed requests there, allowed answers from there.  But with this configuration, we strongly reveal the internal network.  Any TCP packet from port 80 easily gets into the internal network.  Welcome to SYN Flood attacks and more.  This problem is easily solved using a stateful inspection firewall (CBAC or IOS Firewall), but what if your IOS edition does not support this functionality?  Mirror ACLs come to the rescue. <br><br>  The idea is that now from one ACL (usually, ‚Äúgreen‚Äù - internal), packets that pass the test will be mirrored or reflected in the rules of a special temporary ACL, which in turn will be checked by an external (‚Äúred‚Äù) ACL. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e2/7d2/1e1/8e27d21e10a8af0d89f779f8889f2101.jpg" alt="image"><br><br>  See an example.  For certain rules in the green ACL, we use the reflect parameter and specify the name of the temporary ACL (in the example, MIRROR) where the rules will be reflected.  In the "red" ACL, we check the temporary mirror ACL: the evaluate command.  You can view this command as an opportunity to check one ACL inside another, i.e.  the command will be replaced by the rule set from the temporary ACL. <br><br>  While sessions from the internal network are not open, the mirror ACL is empty and does not contain any rules: <br><br><pre> <code class="bash hljs">Extended IP access list EXTERNAL 10 evaluate MIRROR 20 deny ip any any <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> Extended IP access list INTERNAL 10 permit ip any any reflect MIRROR (2 matches) Reflexive IP access list MIRROR</code> </pre><br>  But as soon as sessions open, the mirror ACL will begin to fill: <br><br><pre> <code class="bash hljs">R1<span class="hljs-comment"><span class="hljs-comment">#sh access-li Extended IP access list EXTERNAL 10 evaluate MIRROR 20 deny ip any any log (5 matches) Extended IP access list INTERNAL 10 permit ip any any reflect MIRROR (36 matches) Reflexive IP access list MIRROR permit icmp host 2.2.2.2 host 192.168.1.1 (19 matches) (time left 289) permit tcp host 192.168.2.1 eq telnet host 192.168.1.1 eq 62609 (30 matches) (time left 286) permit ospf host 224.0.0.5 host 192.168.1.1 (6 matches) (time left 297)</span></span></code> </pre><br><br>  In the example from the internal network, the ping to the address 2.2.2.2 was launched from the address 192.168.1.1, then the telnet connection from the internal address 192.168.1.1 to the external address 192.168.2.1 was opened.  On the example of a telnet connection, the sequence of actions performed is clearly visible: <br><br><ol><li>  The internal host initiates a connection from the address 192.168.1.1 and randomly selected port 62609 to the address of the external host 192.168.2.1, port 23 (telnet). </li><li>  Packets are checked by the INTERNAL ACL, allowed by the line: <b>10 permit ip any any reflect MIRROR</b> </li><li>  Reflected in the MIRROR ACL: <b>permit tcp host 192.168.2.1 eq telnet host 192.168.1.1 eq 62609</b> </li><li>  External responses are checked by an EXTERNAL ACL containing a link to the MIRROR ACL: <b>evaluate MIRROR</b> . </li></ol><br>  Return traffic is ultimately allowed.  If there was an attempt to open any connection to the internal network from the outside, then it would be forbidden: <b>deny ip any any log</b> . <br><br>  In general, with a flick of the wrist, the ACL has almost become a stateful inspection firewall. <br><br><h4>  Dynamic (Lock-and-Key) ACLs </h4><br>  The next category of ACL is dynamic.  Basically, these ACLs are used for remote connections to the company's network, but you can also use them when connecting to various resources requires pre-authentication.  Imagine that administrators need constant connections to the company's network, but they will connect from different places, from different IP addresses.  The idea of ‚Äã‚Äãdynamic ACLs is that a person must first authenticate and only if successful will an ACL be applied allowing access to network resources.  The algorithm is as follows: <br><br><pre> <code class="bash hljs">      () .   .   ,       ACL.        .</code> </pre><br>  What is required for configuring dynamic ACLs: <br><br><ul><li>  Create an extended ACL allowing telnet or SSH connections to the router.  These protocols will be used to connect to the router. </li><li>  Define authentication parameters.  Local authentication, AAA, password on vty ports are supported. </li><li>  Configure dynamic ACL settings. </li></ul><br>  Let's take everything into the following example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/668/14e/073/66814e0739fb70019d7b0dafb48d9ef9.jpg" alt="image"><br><br>  The user needs to connect to the server 192.168.1.1 on port 80 on the internal network.  The addresses from which the connection will be made are not known to us.  First of all, we create an extended ACL that allows telnet connections to the router (address 1.1.1.1) and contains dynamic ACL entries, then use it on the desired interface: <br><br><pre> <code class="bash hljs">ip access-list extended TELNET-IN permit tcp any host 1.1.1.1 eq telnet (1) dynamic DYNAMIC-ACL-NAME permit tcp any host 192.168.1.1 eq www (4) deny ip any any ! int s0/0 description CONNECTED TO EXTERNAL NETWORK ip address 1.1.1.1 255.255.255.0 ip access-group TELNET-IN <span class="hljs-keyword"><span class="hljs-keyword">in</span></span></code> </pre><br>  The next step is setting up authentication.  I will use local authentication, so I create a root user and enable local authentication on vty ports: <br><br><pre> <code class="bash hljs">username root secret USERS_PASSWORD (2) ! line vty 0 4 login <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> (2) autocommand access-enable host timeout 10 (3)</code> </pre><br>  The <b>autocommand access-enable</b> command <b>enables</b> authentication and enables dynamic ACL entries.  The <b>host</b> parameter is optional.  When using it, <b>any</b> as the source IP address in a dynamic ACL will be replaced with the address from which the user connects.  The timeout parameter defines the period of inactivity in minutes for this session, the default is infinite. <br><br>  How will the access process in the above example: <br><br><ul><li>  The user opens a telnet connection to the router to the address 1.1.1.1.  Allowed by extended ACL rule (1). </li><li>  Local Authentication Phase (2). </li><li>  In case of successful authentication, the access-enable (3) command is automatically executed, activating dynamic ACL rules (4).  Telnet connection is closed. </li><li>  The user is accessed according to the rules of dynamic ACL. </li></ul><br><br><h4>  Conclusion </h4><br>  As you can see ACLs in Cisco IOS have very interesting features, given that this is the basic functionality of virtually any IOS.  Of course, much is left behind the scenes: ACL and QoS, rate limits.  And even more so, such topics as CBAC, Zone-based Firewall and others.  Thanks for reading. </div><p>Source: <a href="https://habr.com/ru/post/154879/">https://habr.com/ru/post/154879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154865/index.html">Delivering Kohana ORM from unnecessary database queries</a></li>
<li><a href="../154867/index.html">Illustrations in video design</a></li>
<li><a href="../154869/index.html">IP telephony: modern technology of free calls</a></li>
<li><a href="../154871/index.html">Competition of student projects InterSystems CIS Student Innovator Awards 2012</a></li>
<li><a href="../154875/index.html">The FBI operation "Site Down" against warez-scene. Do we find out the truth?</a></li>
<li><a href="../154883/index.html">IPv4 crash, myths about the need to use dedicated IP</a></li>
<li><a href="../154887/index.html">Deferred call to Asterisk</a></li>
<li><a href="../154889/index.html">From November 1, payments in rubles will appear in PayPal</a></li>
<li><a href="../154891/index.html">Dynamic interpretation of metamodels</a></li>
<li><a href="../154895/index.html">Google Play introduced a new Developer Console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>