<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to ensure the performance of Microsoft SQL Server databases hosted in the cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A source 


 Hello! Today we want to talk about cloud databases, and more precisely about those proactive and one-time events that directly provide th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to ensure the performance of Microsoft SQL Server databases hosted in the cloud</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/640/099/172/640099172af94d01908556aee565008d.jpg"><br><p>  <a href=""><em>A source</em></a> </p><br><p>  Hello!  Today we want to talk about cloud databases, and more precisely about those proactive and one-time events that directly provide their performance. </p><br><p>  Cloud databases have long ago resolved the issue of rapid growth in capacity and the launch of new databases, and today they have become an almost urgent need for companies of any size, thanks to the transfer of administrative and monitoring tasks to the provider. </p><br><p>  We have done a lot of work, launching and optimizing our new <a href="https://ts-cloud.ru/service/oblachnaya-baza-dannykh/%3Futm_source%3Dhabr_post%26utm_medium%3Dsocial%26utm_campaign%3DDBaaS_productivity">cloud database</a> service on our own platform <a href="https://ts-cloud.ru/%3Futm_source%3Dhabr_post%26utm_medium%3Dsocial%26utm_campaign%3DDBaaS_productivity">Technoserv Cloud</a> and, of course, we faced a number of problems and developed our approaches to solving them.  Now that the service has been tested and is working, we want to share our experience with you - we are sure that by reading this material you will be able to avoid repeating other people's mistakes or discover something new. </p><a name="habracut"></a><br><p>  Today, businesses have to deal with constantly growing volumes of data, so there is a need to somehow ease the task of managing all these huge information files.  The solution was found through the introduction of cloud computing platforms and the creation of <a href="https://ts-cloud.ru/service/oblachnaya-baza-dannykh/">cloud databases</a> . </p><br><p>  According to calculations, the volumes of both structured and unstructured data increase by an average of 60% per year.  Until now, traditional databases have served as a storage place for all this information, but this was not enough, and then cloud technologies came to the rescue.  They relieved users of the need to allocate their own computing power for the database, placing this responsibility on cloud service providers.  This approach has proven to be extremely productive in terms of improving the performance and availability of databases, as well as improving their scalability. </p><br><p>  In our article we decided to make a small overview of the most optimal settings and mechanisms to ensure the performance of MS SQL Server databases.  This list is by no means exhaustive, since the recommendations of the developers and the ‚Äúbest industry practices‚Äù are adjusted over time.  Only a team of professional DBAs (database administrators) can track all these changes and correctly implement them.  It is this staff of specialists that has a cloud database service provider and, most likely, the majority of customers cannot boast of having such a team. </p><br><p>  To ensure high availability and high performance of MS SQL Server databases hosted in the cloud, in accordance with Microsoft recommendations and best practices, we conduct the following events. </p><br><p>  <em>Note: Although most of the recommendations are general, their application on each specific server depends on very many factors.</em>  <em>Therefore, below are links to relevant Microsoft documents with more detailed information.</em> </p><br><img src="https://habrastorage.org/web/156/818/4e4/1568184e4e094b4ebedfb8c6f5307b6c.png"><br><h1 id="optimiziruem-nastroyki-ms-sql-server">  Optimize MS SQL Server settings </h1><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ustanavlivaem-na-vse-ms-sql-servery-poslednie-service-packs--cumulative-updates--security-updates"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Install the latest Service Packs / Cumulative Updates / Security Updates on all MS SQL servers: </h3><br><p>  <a href="https://blogs.msdn.microsoft.com/sqlreleaseservices/announcing-updates-to-the-sql-server-incremental-servicing-model-ism/">Since 2016, the update scheme for Microsoft SQL Server has been simplified</a> - now updates are released regularly. </p><br><p>  The general sequence of installing updates is given below (all updates before installation on Production servers ‚Äî initially we test in the Test environment): </p><br><p>  ‚Ä¢ Install the latest Service Pack (SP). <br>  ‚Ä¢ Install the latest cumulative update for the Service Pack - Cumulative Update (CU). <br>  ‚Ä¢ In the case of Security Updates - also install them. <br>  ‚Ä¢ In case of problems, look for and use Critical On-Demand (COD) - fix to fix them. </p><br><p>  <em>Note: Although Microsoft recommends installing the latest CUs as soon as they are released, often most companies install only the last SP, and CUs are installed only if the CU includes a fix for the problem on the server.</em>  <em>We will coordinate this process with the download in accordance with its internal instructions, but always suggest that we first consider the official recommendations of Microsoft.</em> </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-nastraivaem-optimalnye-parametry-ispolzovaniya-pamyati-ms-sql-server-i-optimalnye-parametry-maxdop"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We configure the optimal parameters for using MS SQL Server memory and the optimal parameters for MaxDOP: </h3><br><p>  By default, MS SQL Server can dynamically change memory requirements based on the availability of system resources.  By default, min server memory is 0, and max server memory is 2,147,483,647 MB.  You can read about choosing the optimal parameters for using MS SQL Server memory <a href="https://technet.microsoft.com/ru-ru/library/ms178067(v%3Dsql.105).aspx">here</a> . </p><br><p>  If MS SQL Server runs on a multiprocessor computer, it determines the optimal degree of parallelism, that is, the number of processors used to execute one instruction for each of the parallel execution plans.  To limit the number of processors in terms of parallel execution, the max degree of parallelism parameter can be used.  You can read about choosing the optimal MaxDOP parameters <a href="https://docs.microsoft.com/ru-ru/sql/database-engine/configure-windows/configure-the-max-degree-of-parallelism-server-configuration-option">here</a> . </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ispolzuem-pri-neobhodimosti-trace-flags"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Use trace flags if necessary: </h3><br><p>  The trace flags in MS SQL Server are a kind of ‚Äúswitch‚Äù of server behavior from the default to the other.  Information on trace flags can be found <a href="https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql">here</a> . </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-optimiziruem-nastroyki-bazy-tempdb-i-drugih-sistemnyh-baz"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We optimize the settings of the ‚ÄúTempDB‚Äù database and other system databases: </h3><br><p>  MS SQL Server includes the following system databases: </p><br><p>  ‚Ä¢ ‚Äúmaster‚Äù - this system stores all system-level data for an instance of MS SQL Server; <br>  ‚Ä¢ ‚Äúmsdb‚Äù - used by MS SQL Server Agent for scheduling alerts and tasks; <br>  ‚Ä¢ ‚Äúmodel‚Äù - used as a template for all databases created in an instance of MS SQL Server.  Changing the size, sorting parameters, recovery model and other parameters of the model database leads to a change in the corresponding parameters of all databases created after the change; <br>  ‚Ä¢ ‚ÄúResource‚Äù is a read-only database.  Contains system objects that are included with MS SQL Server.  System objects are physically stored in the Resource database, but are logically displayed in the sys schema of any database; <br>  ‚Ä¢ ‚ÄúTempDB‚Äù - workspace for temporary objects or interaction of result sets. </p><br><p>  Recommendations for tuning the optimal performance of the ‚ÄúTempDB‚Äù database can be found <a href="https://technet.microsoft.com/ru-ru/library/ms175527(v%3Dsql.105).aspx">here</a> . </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-korrektno-nastraivaem-parametry-defoltnyh-raspolozheniy-data-faylovlog-faylov"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Correctly configure the default settings of the data files / log files: </h3><br><p>  When a new database is created in MS SQL Server without explicitly specifying the location for the data file / s and the log file, MS SQL Server creates these files in the default location.  This default location is configured when installing MS SQL Server.  You can read about setting the parameters of the default locations of data files / log files <a href="https://msdn.microsoft.com/ru-ru/library/dd206993(v%3Dsql.120).aspx">here</a> . </p><br><h1 id="optimiziruem-nastroyki-windows-server">  Optimizing Windows Server Settings </h1><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ispolzuem-optimalnye-nastroyki-diskovoy-podsistemy-bystrye-nakopiteli-ssd-otformatirovannye-s-razmerom-klastera-64k"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We use the optimal settings of the disk subsystem (fast SSD drives formatted with a cluster size of 64K): </h3><br><p>  MS SQL Server has its own data storage features.  In this regard, the preparation of the disk subsystem at both the physical and logical levels, taking into account these features, will have a serious impact on performance.  Read more about it <a href="https://msdn.microsoft.com/en-us/library/dd758814(SQL.100).aspx">here</a> . </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-nastraivaem-mgnovennuyu-inicializaciyu-faylov-bazy-dannyh"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Configure ‚ÄúInstant Database Database Initialization‚Äù: </h3><br><p>  In MS SQL Server, data files can be initialized instantly.  Instant file initialization frees up disk space without filling the space with zeros.  Instead, the disk contents are overwritten, as new data is written to the files.  Log files cannot be initialized instantly.  Details are <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/databases/database-instant-file-initialization">here</a> . </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ispolzuem-raznye-setevye-interfeysy-dlya-polzovatelskoy-i-dlya-sistemnoy-nagruzok"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We use different network interfaces for ‚Äúuser‚Äù and ‚Äúsystem‚Äù loads: </h3><br><p>  Our servers have several network interfaces and each individual interface can be used for some dedicated task, for example, for periodic backup traffic.  Such a configuration has its advantages, for example, it makes it possible to differentiate between the use of interfaces for specific tasks and tasks as strictly as possible. </p><br><h1 id="optimiziruem-nastroyki-polzovatelskih-baz-dannyh">  Optimizing custom database settings </h1><br><img src="https://habrastorage.org/web/56c/af4/def/56caf4deff5e473d9d024ce1802f7935.jpg"><br><p>  <a href=""><em>A source</em></a> </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-proveryaem-chtoby-parametry-auto-shrink-i-auto-close-byli-vyklyucheny"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Check that the ‚ÄúAuto Shrink‚Äù and ‚ÄúAuto Close‚Äù parameters are turned off: </h3><br><p>  ‚ÄúAuto Shrink‚Äù (Automatic Compression) indicates that MS SQL Server will periodically compress database files (in more detail <a href="https://blogs.msdn.microsoft.com/sqlserverstorageengine/2007/03/28/turn-auto_shrink-off/">here</a> ). <br>  ‚ÄúAuto Close‚Äù indicates that the database will be closed after all its resources are released and all users are disconnected (in more detail <a href="https://support.microsoft.com/en-us/help/2160685/recommendations-and-guidelines-for-setting-the-auto-close-database-opt">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-proveryaem-chtoby-parametry-auto-create-statistics-i-auto-update-statistics-byli-vklyucheny"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Check that the ‚ÄúAuto Create Statistics‚Äù and ‚ÄúAuto Update Statistics‚Äù options are enabled: </h3><br><p>  If the ‚ÄúAuto Create Statistics‚Äù option is enabled, the query optimizer, if necessary, creates statistics for individual columns in the query predicate to improve the estimate of the number of items for the query plan (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/statistics/statistics">here</a> ). </p><br><p>  If the ‚ÄúAuto Update Statistics‚Äù option is enabled, the query optimizer determines when the statistics may be outdated and updates it if it is used in the query (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/statistics/statistics">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ispolzuem-pri-neobhodimosti-read-committed-snapshot-isolation"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Use the ‚ÄúRead Committed Snapshot Isolation‚Äù if necessary: </h3><br><p>  The term ‚ÄúSnapshot‚Äù reflects the fact that all requests in a transaction detect the same version, or database snapshot, that corresponds to the state of the database at the time the transaction starts.  The snapshot transaction does not require locking of the base lines or data pages, which allows you to perform another transaction without locking it with a previous unfinished transaction.  Transactions that change data do not block transactions in which data is read, and transactions that read data do not block transactions in which data is recorded, which is usually also observed when using the ‚ÄúRead Committed‚Äù default level set in MS SQL Server.  The use of such an approach involving the rejection of locks contributes to a significant reduction in the likelihood of deadlocks in complex transactions. </p><br><p>  Enabling the ‚ÄúRead Committed Snapshot Isolation‚Äù parameter provides access to versions of the lines from under the default isolation level of ‚ÄúRead Committed‚Äù.  If the ‚ÄúRead Committed Snapshot Isolation‚Äù parameter is set to OFF, then to gain access to row versions you will need to explicitly set the isolation level of the snapshot for each session (in more detail <a href="https://msdn.microsoft.com/ru-ru/library/tcbchxcb(v%3Dvs.110).aspx">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-proveryaem-chtoby-parametr-page-verify-byla-vystavlena-v-checksum"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Check that the ‚ÄúPage Verify‚Äù parameter is set to ‚ÄúCHECKSUM‚Äù: </h3><br><p>  If the ‚ÄúPage Verify‚Äù database parameter is set to ‚ÄúCHECKSUM‚Äù, then MS SQL Server calculates a checksum for the page content as a whole and stores the value in the page header when the page is written to disk.  When a page is read from disk, the checksum is recalculated and compared to the value from the header.  This helps to ensure a high level of data integrity in the files (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/policy-based-management/set-the-page-verify-database-option-to-checksum">here</a> ). </p><br><h1 id="optimalno-upravlyaem-data-faylomami-i-log-faylom-bd">  Optimally manage data file / s and database log file </h1><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-data-fayly-i-log-fayl-bd-razmeschaem-na-otdelnyh-fizicheskih-diskah"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  The data file / s and database log file is placed on separate physical disks: </h3><br><p>  Placing data files and log files on the same device can lead to contention, which will result in poor performance.  Placing files on different disks allows you to perform I / O operations for data files and log files in parallel (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/policy-based-management/place-data-and-log-files-on-separate-drives">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-sozdaem-tolko-odin-log-fayl-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Create only one database log file: </h3><br><p>  The log file is used by MS SQL Server sequentially, not in parallel, and there is no performance gain in having several log files (in more detail <a href="https://www.sqlskills.com/blogs/paul/multiple-log-files-and-why-theyre-bad/">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ne-dopuskaem-poyavleniya-fragmentacii-virtualnogo-log-fayla-vlf-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We do not allow the fragmentation of the ‚ÄúVirtual Log File (VLF)‚Äù database: </h3><br><p>  The database log file is internally divided into sections called Virtual Log Files (VLF), and the higher the fragmentation in the log file, the greater the number of VLFs.  After the VLF number in the log file exceeds 200, the performance of log-related operations such as reading the log file (say, for transactional replication / rollback), backing up the log file, etc., may deteriorate.  (more detail <a href="https://blogs.msdn.microsoft.com/saponsqlserver/2012/02/22/too-many-virtual-log-files-vlfs-can-cause-slow-database-recovery/">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-vybiraem-korrektnye-nachalnye-razmery-data-faylaov-i-log-fayla-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Choose the correct initial sizes of the data file / s and database log file: </h3><br><p>  When creating a database, data files should be made as large as possible, in accordance with the largest estimated amount of data in the database.  For example, if we know that now we will have 50 GB of data, and another half GB will be added in six months, then the initial size of the data file should be immediately set to 100 GB (in more detail <a href="https://msdn.microsoft.com/ru-ru/library/ms190970.aspx">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-vybiraem-korrektnye-parametry-avto-rosta-dlya-data-faylaov-i-log-fayla-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Select the correct parameters ‚ÄúAuto-growth‚Äù for the data file / s and the database log file: </h3><br><p>  It is not recommended to use ‚ÄúAuto-growth‚Äù in percentages, since if the size of the database files is large, the process of increasing the database itself can cause a significant decrease in performance, therefore, it is more preferable to increase the base by a fixed size in MB (in more detail <a href="https://blogs.msdn.microsoft.com/batuhanyildiz/2013/03/02/autogrowth-option-for-sql-server-database-files/">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-postoyanno-otslezhivaem-razmery-data-faylaov-i-log-fayla-bd-i-pri-neobhodimosti-proaktivno-ih-uvelichivaem-vo-vremya-minimalnoy-nagruzki-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We constantly monitor the sizes of the data file / s and the log file of the database and, if necessary, proactively increase them during the minimum load of the database: </h3><br><p>  In the production system, the ‚ÄúAuto-Growth‚Äù function should only be used as a means of increasing the size of files in an emergency.  It is not recommended to use it for daily management of the growth of database data files.  Alerts or monitoring programs are usually used to monitor file sizes and proactively.  This allows you to avoid fragmentation and to transfer the execution of these maintenance operations to the hours when the load is minimal (in more detail <a href="https://support.microsoft.com/ru-ru/help/315512/considerations-for-the-autogrow-and-autoshrink-settings-in-sql-server">here</a> ). </p><br><h1 id="optimalno-obsluzhivaem-bd">  Optimally serving database </h1><br><img src="https://habrastorage.org/web/30a/fce/f24/30afcef24f3f46909eb2e0a71d8bf88e.jpg"><br><p>  <a href=""><em>A source</em></a> </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-vypolnyaem-proverku-celostnosti-dannyh-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We perform database integrity check: </h3><br><p>  We check the logical and physical integrity of all objects in the database by performing the following operations (in more detail <a href="https://msdn.microsoft.com/ru-ru/library/ms176064(v%3Dsql.110).aspx">here</a> ): </p><br><p>  ‚Ä¢ executing DBCC CHECKALLOC for a database; <br>  ‚Ä¢ executing DBCC CHECKTABLE for each table and each view in the database; <br>  ‚Ä¢ executing DBCC CHECKCATALOG for a database; <br>  ‚Ä¢ checking the contents of each indexed view in the database; <br>  ‚Ä¢ checking consistency between files and file system directories and table metadata at the link level when varbinary (max) data is stored in the file system using FILESTREAM; <br>  ‚Ä¢ Verification of Service Broker data in the database. </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-vypolnyaem-kastomnyy-index-rebuildreorganize-v-zavisimosti-ot-fragmentacii-indeksov"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Perform custom index rebuild / reorganize depending on index fragmentation: </h3><br><p>  MS SQL Server automatically maintains the state of the indices when performing insert, update, or delete operations on the underlying data.  Over time, these changes may cause the data in the index to be scattered across the database (fragmented).  Fragmentation occurs when indexes contain pages for which a logical order based on the key value does not match the physical order in the data file.  Significantly fragmented indexes can seriously degrade query performance and cause slower application responses.  You can eliminate fragmentation by reorganizing or rebuilding the index (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/indexes/reorganize-and-rebuild-indexes">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-obnovlyaem-statistiku"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Update statistics: </h3><br><p>  By default, the query optimizer updates statistics as needed to improve the query plan.  Updating statistics ensures that queries will be compiled with up-to-date statistics.  However, updating statistics causes recompilation of queries.  It is recommended not to update the statistics too often, since it is necessary to find a balance between performance gains due to improved query plans and loss of time to recompile queries.  The criteria for choosing a compromise solution depend on the application (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/statistics/update-statistics">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-ne-ispolzuem-nikakie-plohie-praktiki-naprimer-takie-kak-regulyarnoe-szhatie"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We do not use any ‚Äúbad‚Äù practices, for example, such as ‚Äúregular compression‚Äù: </h3><br><p>  Data transferred during file compression can be scattered around any available places in the file.  This causes index fragmentation and may increase the execution time for queries that perform searches in the index range (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/databases/shrink-a-database">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-pri-neobhodimosti-organizovyvaem-regulyarnuyu-ochistku-bd-ot-staryh-dannyh"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  If necessary, we organize regular cleaning of the database from the ‚Äúold‚Äù data: </h3><br><p>  Often, companies must store data for a period of time in order to comply with the requirements of current legislation and their internal requirements.  After the data is no longer needed - it is usually recommended to delete it, which improves the performance of MS SQL Server and allows you to more accurately predict the possible increase in requirements for server hardware (in more detail <a href="https://blogs.msdn.microsoft.com/bartd/2010/06/01/purging-data/">here</a> ). </p><br><h1 id="osuschestvlyaem-optimalnoe-rezervnoe-kopirovanie-bd">  We perform optimal database backup </h1><br><img src="https://habrastorage.org/web/0dd/a1a/be6/0dda1abe695943e28cfdfc701b5936a6.gif"><br><p>  <a href=""><em>A source</em></a> </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-opredelyaem-luchshuyu-strategiyu-bekapirovaniya-bd-v-sootvetstvii-s-trebovaniyami-zakazchika-po-rtorpo-i-luchshimi-mirovymi-praktikami"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We determine the best database backup strategy in accordance with customer requirements for RTO / RPO and the best international practices: </h3><br><p>  MS SQL Server provides the necessary protection for sensitive data that is stored in databases.  In order to minimize the risk of irreversible data loss, it is necessary to regularly create backup copies of databases in which the changes made to the data will be saved.  A well-thought-out backup and recovery strategy protects the database from data loss due to damage resulting from various failures (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-vypolnyaem-regulyarnoe-testovoe-vosstanovlenie-bekapov-bd"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  We perform regular test restoration of database backups: </h3><br><p>  It can be said that a recovery strategy is missing until backups are not tested.  It is very important to fully test the backup strategy for each database, restoring a copy of the database to the test system.  You need to test restoring each type of backup you plan to use (in more detail <a href="https://technet.microsoft.com/ru-ru/library/ms191239(v%3Dsql.105).aspx">here</a> ). </p><br><h1 id="ispolzuem-optimalnuyu-tehnologiyu-vysokoy-dostupnosti-bd-v-zavisimosti-ot-trebovaniy">  We use the optimal technology of high availability database (depending on requirements) </h1><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-always-on-failover-cluster-instances"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Always On Failover Cluster Instances: </h3><br><p>  AlwaysOn failover clustering instances use the Windows Server failover clustering (WSFC) functionality to provide high availability of local resources through redundancy at the server instance level - a cluster failover instance (FCI).  A Failover Cluster Instance (FCI) is the only instance of MS SQL Server installed on all Windows Server Failover Clustering nodes (WSFC) and, possibly, on several subnets.  An instance of a failover cluster appears on the network as an instance of MS SQL Server running on one computer, but an instance of a failover cluster provides failover with the transition of one WSFC node to another node if the current node becomes unavailable (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-always-on-availability-groups"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Always On availability groups: </h3><br><p>  AlwaysOn Availability Groups is a high availability and disaster recovery solution that is an alternative to database mirroring (‚Äúdatabase mirroring‚Äù).  An availability group maintains a fault-tolerant environment for a set of user databases, known as availability databases, which together make a transition to another resource.  An availability group maintains a set of primary databases for reading / writing and from one to eight sets of corresponding secondary databases.  In addition, secondary databases can be made available only for reading and / or for some backup operations (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-database-mirroring"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Database mirroring: </h3><br><p>  Database mirroring is a solution aimed at improving the availability of an MS SQL Server database.  Each database is mirrored separately and works only with those databases that use the full recovery model (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/database-engine/database-mirroring/database-mirroring-sql-server">here</a> ). </p><br><h3 id="img-srchttpshabrastorageorgweb772a65631772a6563158c4c1aa2d9353dcc27914cjpg-log-shipping"><img src="https://habrastorage.org/web/772/a65/631/772a6563158c4c1aa2d9353dcc27914c.jpg">  Log shipping: </h3><br><p>  MS SQL Server allows you to automatically send backup copies of transaction logs from the source database of the source server instance to one or more recipient databases of other instances of the recipient server.  Transaction log backups are applied to each of the recipient databases individually (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/database-engine/log-shipping/about-log-shipping-sql-server">here</a> ). </p><br><h1 id="osuschestvlyaem-postoyannyy-monitoring-sostoyaniya-servera-ms-sql--windows">  We constantly monitor the server status (MS SQL + Windows) </h1><br><p>  Server monitoring is categorized as vital events.  Effective observation involves regularly taking snapshots of current performance to detect processes that are causing problems, and continuously collecting data to track growth trends or performance changes. </p><br><img src="https://habrastorage.org/web/e70/878/eae/e70878eaea214761b5485fcab81d1368.gif"><br><p>  <a href=""><em>A source</em></a> </p><br><p>  Continuously assessing database performance helps achieve optimal performance by minimizing response times and maximizing throughput.  Approximate network traffic, disk I / O and CPU utilization are key factors affecting performance.  You should carefully analyze the requirements of the application, understand the logical and physical structure of the data, evaluate the use of the database and achieve a compromise between such conflicting workloads as online transaction processing (OLTP) and decision support (in more detail <a href="https://docs.microsoft.com/ru-ru/sql/relational-databases/performance/monitor-and-tune-for-performance">here</a> ). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336070/">https://habr.com/ru/post/336070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336060/index.html">10 working methods in the terminal Linux, which very few people know</a></li>
<li><a href="../336062/index.html">Use PowerShell for IT security. Part II: File Access Analysis</a></li>
<li><a href="../336064/index.html">Conquering China: how to bring the application to the Chinese market</a></li>
<li><a href="../336066/index.html">Python-selvpcclient library</a></li>
<li><a href="../336068/index.html">5 fresh examples of parsing and improving the design in simple ways</a></li>
<li><a href="../336072/index.html">Gamers in life: what we know about generation Y</a></li>
<li><a href="../336074/index.html">Modern methods of web application security research: toolkit</a></li>
<li><a href="../336076/index.html">Reefs settings Mikrotik SXT LTE</a></li>
<li><a href="../336078/index.html">A brief history of Connected Cars: what is considered ‚Äúconnected machines‚Äù and why the near future is not in drones?</a></li>
<li><a href="../336080/index.html">Creating a programming language using LLVM. Part 6: Language Extension: User Defined Operators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>