<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WannaCry and Petya - how does the center for monitoring and response to cyber attacks in case of global incidents work?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the light of the latest story with the Petya encryption virus, we don‚Äôt want to tell you again how to protect against it, there are already dozens ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WannaCry and Petya - how does the center for monitoring and response to cyber attacks in case of global incidents work?</h1><div class="post__text post__text-html js-mediator-article">  In the light of the latest story with the Petya encryption virus, we don‚Äôt want to tell you again how to protect against it, there are already dozens of such recommendations on the Internet.  We would like to share how SOC works in this case, what steps it should take to prevent and respond to global incidents. <br><br><img src="https://habrastorage.org/web/246/660/1b5/2466601b522e4506b952dfb771d1e43c.jpg"><br><a name="habracut"></a><br><h3>  Preventive measures <br></h3><br>  Petya, like its predecessor WannaCry, exploits the EternalBlue vulnerability, but is not limited to it, so those companies that have installed the appropriate updates from Microsoft have increased their security level. <br><br><h3>  Attack and response <br></h3><br>  <b>15:00 MSK</b>  The first reports of an attack on large organizations.  Solar JSOC analysts begin monitoring in search of details, and at the same time analyzing the situation with customers.  The first line is switched to a state of heightened vigilance, manual monitoring of IPS, WAF, Anti-DDoS and perimeter network devices is carried out to detect anomalies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In parallel, through partner channels and from the side of anti-virus vendors, fragmentary information begins to arrive that the malicious product Petya is running.  The distribution channel is presumably EternalBlue. <br><br>  The work was divided into several areas: <br><br><ul><li>  Alert customers on the first appeared work indicators and events. </li><li>  Focus communication with technology and technical partners to share first results on virus analyzes. </li><li>  And - somewhat atypically - active tracking of media and vendor forums and CERT to search for additional information and indicators.  This part of the work attracted, among other things, our marketing, which monitored the Facebook feed, ‚Äúexploded‚Äù with information about infections. </li></ul><br>  <b>15:30 Moscow time</b> .  The first indicators were obtained - the initial infection of the organization went through mail phishing, there are network indicators and MD5 of the virus body.  This information is promptly verified on all customers within 30 minutes.  In parallel, service managers make calls to the responsible specialists of the customer. <br><br>  Retrospective verification for all customers did not give positive positives.  Also, all indicators were added to active rules and lists for further tracking of attempts to contact (including unsuccessful ones) at the detected malicious domain and for the rapid detection of infected machines.  All network indicators of compromise are set to control access through firewalls and proxies, DNS queries are monitored. <br><br>  Customers received an alert about the need to block the specified addresses on the network equipment. <br><br>  <b>15:50 Moscow time</b> .  An instruction is created to minimize the risks associated with the spread of Petya.  The instructions indicate the main measures: <br><br><ol><li>  Update Windows and ABC databases. </li><li>  Closing TCP port 445 where it is possible and does not violate the normal functioning of the services. </li><li>  In some cases, it may be effective to protect the MBR from being overwritten. </li></ol><br>  It is sent to customers. <br><br>  <b>Gizar Shakirov, Head of IB BASHKOMSNABBANK (PJSC):</b> <br>  <i>At 15:40, we received the first call from the analyst with a warning that there was a massive contamination of the infrastructures of large energy, oil and gas, financial sector and retail companies.</i>  <i>The epidemic is very similar to WannaCry, but new distribution channels are possible.</i>  <i>The channel of entry, according to the first assumptions, is mail.</i>  <i>The service manager warned that further distribution in the infrastructure may occur not only through the operation of EternalBlue, which we were upgraded to.</i> <i><br><br></i>  <i>Also within 10 minutes, a mailing was received from Solar JSOC with the results of the retrospective analysis and network indicators that had to be blacklisted on the perimeter protection.</i>  <i>We notified the responsible specialists of the bank in advance, therefore, as soon as the notification came, the external addresses were blocked for 5 minutes.</i> <br><br>  <b>16:30 Moscow time</b> .  The first conclusions about the work of malware. <br><br>  A dropper consisting of several components initially gets to the host: <br><br><ul><li>  A modified version of the crypto-fiber Misha and Petya. </li><li>  A scanner module that detects hosts that are potentially vulnerable to EternalBlue. </li><li>  A module that uses the PsExec + Mimikatz bundle for distribution (dumping passwords and distributing to windows machines on the network via the Microsoft remote administration utility, which requires an open 445 port to work). </li></ul><br>  Getting to the host, the virus tries to elevate privileges to the System.  In case of success - restart and MFT encryption.  In the case of failure - file encryption (as a standard crypter). <br><br>  After some time, the second distribution channel in the infrastructure is revealed - PsExec + Mimikatz.  A little later another is remote access to the WMI (Windows Management Instrumentation) console. <br><br>  The instruction is supplemented with the following information: <br><br><ol><li>  Blocking the launch of the software "PSEXEC.EXE" on potentially vulnerable machines. </li><li>  As a temporary measure, disable remote access to WMI. </li></ol><br>  <b>Gizar Shakirov, Head of IB BASHKOMSNABBANK (PJSC):</b> <br>  <i>After receiving information about additional distribution methods, critical segments and hosts were temporarily isolated at 135, 445, 1024-1035 ports or placed under special control.</i>  <i>Solar JSOC announced that the anti-virus vendor, whose solution is used in the bank, has released signatures to detect well-known Petya samples.</i>  <i>A forced update was promptly performed on the entire fleet of protected machines and a full scan was run on critical hosts.</i> <br><br>  During the following hours, we received information about the functionality of other malware builds.  New indicators of compromise were checked in retrospect and put on active control.  The duty analyst promptly interacted with the technical specialists of the customers, including at night.  All suspicious email attachments were checked with special care. <br><br>  <b>Gizar Shakirov, Head of IB BASHKOMSNABBANK (PJSC):</b> <br>  <i>At night, we agreed with the colleagues from JSOC an abnormal mode of operation, during which, in addition to incidents related to abnormal network or host activity and virus infections, in addition to the regular notification of the responsible bank specialists, I would immediately call me to organize a quick response and conduct fact checking incident.</i> <br><br>  Even after the WannaCry epidemic, it became clear that the use of vulnerabilities promulgated (and planned to be published) by a well-known hacker group would be the trend of the near future, and any measures related to monitoring, custom signatures and antivirus work should be considered only as compensating.  Therefore, the Solar JSOC operation service continued to work even more intensively with system upgrades, including legacy, for which actual patches appeared in the customer‚Äôs infrastructures. <br><br>  Thanks to all the measures listed above and the active interaction of client specialists and the Solar JSOC team, we managed to avoid any active infections with the Petya epidemic, like the WannaCry epidemic a month earlier. </div><p>Source: <a href="https://habr.com/ru/post/331860/">https://habr.com/ru/post/331860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331846/index.html">Deskun update: from the ticket system inside Gmail to the multi-channel support system</a></li>
<li><a href="../331848/index.html">How NVIDIA and AMD earn on the rise in cryptocurrency popularity</a></li>
<li><a href="../331852/index.html">Browser online game development</a></li>
<li><a href="../331854/index.html">PETYA malware. Recovery is possible</a></li>
<li><a href="../331858/index.html">How to beat the Petya virus</a></li>
<li><a href="../331862/index.html">Secure USB flash drive. Myth or Reality</a></li>
<li><a href="../331864/index.html">Sizes of raster images: pixels, DPI, PPI, centimeters - you do not confuse anything?</a></li>
<li><a href="../331866/index.html">Using Pinba in Badoo: what you don't know yet</a></li>
<li><a href="../331868/index.html">IBM Bluemix in universities: examples of implemented projects from students and teachers</a></li>
<li><a href="../331870/index.html">Cobian Backup and sending messages to Telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>