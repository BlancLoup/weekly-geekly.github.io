<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AngularJS + PHP. We force $ http-service to be like jQuery.ajax ()</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Newbies in Angulyar are often confused due to the fact that the fast functions of the $ http service (eg, $http.post() ) are not interchangeable with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AngularJS + PHP. We force $ http-service to be like jQuery.ajax ()</h1><div class="post__text post__text-html js-mediator-article"> Newbies in Angulyar are often confused due to the fact that the fast functions of the $ http service (eg, <code>$http.post()</code> ) are not interchangeable with the equivalent functions of Jikveri (eg, <code>jQuery.post()</code> ), despite that the relevant manuals describe their use in a similar way.  That is, if the code in Jikvery had the following form: <a name="habracut"></a><br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">) </span></span>{ jQuery.post(<span class="hljs-string"><span class="hljs-string">'/endpoint'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">'bar'</span></span> }).success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }); })(jQuery);</span></span></code> </pre><br>  You may find that the following is exactly the same does not work out of the box in Angulyar: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MainCtrl = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, $http</span></span></span><span class="hljs-function">) </span></span>{ $http.post(<span class="hljs-string"><span class="hljs-string">'/endpoint'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">'bar'</span></span> }).success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }); };</span></span></code> </pre><br>  The problem you may encounter is that the server cannot receive <code>{ foo: 'bar' }</code> parameters from Angulyar‚Äôs request. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The difference is in how Jikvery and Angulyar serialize and transmit data.  Basically, the problem lies in the language in which the server part is written and which simply does not understand the transfer of Angulyar with the default settings - it's a hell of a shame because Angulyar, of course, does not do anything wrong.  By default, Jikvery transfers data using <code>Content-Type: x-www-form-urlencoded</code> and the usual string <code>foo=bar&amp;baz=moe</code> .  Angulyar, however, transmits data using <code>Content-Type: application/json</code> and <code>{ "foo": "bar", "baz": "moe" }</code> JSON strings, which, unfortunately, some server languages ‚Äã‚Äã‚Äî especially PHP ‚Äî were not originally transform into an object. <br><br>  Fortunately, Angulyar‚Äôs developers took care of supporting this method with a $ http-service in order to install <code>x-www-form-urlencoded</code> for all our broadcasts.  There are many solutions offered on the forums and StackOverflow, but they are not perfect, because they require either to change the server code or the $ http usage pattern.  Therefore, I present to you the best possible solution that does not require any changes to the server or client code, but suggests making some minor changes to the work of $ http in the settings of the application module: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ... angular.module('MyModule', [], function($httpProvider) { //  x-www-form-urlencoded Content-Type $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8'; //   transformRequest  $http- $httpProvider.defaults.transformRequest = [function(data) { /** *  ;    x-www-form-urlencoded . * @param {Object} obj * @return {String} */ var param = function(obj) { var query = ''; var name, value, fullSubName, subValue, innerObj, i; for(name in obj) { value = obj[name]; if(value instanceof Array) { for(i=0; i&lt;value.length; ++i) { subValue = value[i]; fullSubName = name + '[' + i + ']'; innerObj = {}; innerObj[fullSubName] = subValue; query += param(innerObj) + '&amp;'; } } else if(value instanceof Object) { for(subName in value) { subValue = value[subName]; fullSubName = name + '[' + subName + ']'; innerObj = {}; innerObj[fullSubName] = subValue; query += param(innerObj) + '&amp;'; } } else if(value !== undefined &amp;&amp; value !== null) { query += encodeURIComponent(name) + '=' + encodeURIComponent(value) + '&amp;'; } } return query.length ? query.substr(0, query.length - 1) : query; }; return angular.isObject(data) &amp;&amp; String(data) !== '[object File]' ? param(data) : data; }]; });</span></span></code> </pre><br>  <i>Note: The large snippet above should always be used with the <code>param()</code> function.</i>  <i>Do NOT use <code>jQuery.param()</code> instead;</i>  <i>which will cause chaos when you try to use Angular‚Äôs ‚Äã‚Äã$ resource, because <code>jQuery.param()</code> will reject every $ resource class method passed to it!</i>  <i>(This is a jQuery feature due to which the properties of the object to parameterize that contain functions are called and the value returned by them is used as a parameterized, but in the case of Angular, this can be detrimental, since we usually pass "real" instances of objects with .d.)</i> <i><br><br></i>  <i>Just use the above snippet and everything will be fine!</i> <br><br>  Now you can move on using <code>$http.post()</code> and other similar methods, assuming that the existing server code is expecting <code>x-www-form-urlencoded</code> data.  Here are some examples of the final result for everyday, complete code (an example of what you hoped and dreamed of): <br><br>  <b>Html template</b> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyModule"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainCtrl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"loading"</span></span></span><span class="hljs-tag">&gt;</span></span>Loading...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-hide</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"loading"</span></span></span><span class="hljs-tag">&gt;</span></span>Response: {{response}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>Client Code (AngularJS)</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MainCtrl = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, $http</span></span></span><span class="hljs-function">) </span></span>{ $scope.loading = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; $http.post(<span class="hljs-string"><span class="hljs-string">'/endpoint'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">'bar'</span></span> }).success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ $scope.response = response; $scope.loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); };</code> </pre><br>  <b>Server code (PHP)</b> <br><pre> <code class="php hljs">&lt; ? header(<span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -! $_POST  ; PHP   //      echo json_encode($_POST); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  <b>Other notes</b> <br>  This begs the question, is it still possible to read Angular's JSON request in PHP?  Well, of course, if you read the PHP input stream and decode JSON: <br><br><pre> <code class="php hljs">&lt; ? $params = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  ,     PHP  (. ) $params = json_decode(trim(file_get_contents('php://input')), true); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  The obvious drawback is that the code is a bit less intuitive (we are used to $ _POST, after all), and if the server handlers are already written using $ _POST, you will have to rewrite the server code.  If a good framework is used, you can probably make global changes so that the input handler transparently identifies JSON requests, but I digress. <br><br>  <i>Translator's note: If possible, it is better to configure the server to accept <code>Content-Type: application/json</code> , which is more logical.</i>  <i>The article describes the approach for extreme cases when nothing can be done on the server.</i> <br><br>  <b>Additive.</b>  Supplement from <a href="https://habrahabr.ru/users/nervgh/" class="user_link">nervgh</a> <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.extend( angular, { <span class="hljs-attr"><span class="hljs-attr">toParam</span></span>: toParam }); <span class="hljs-comment"><span class="hljs-comment">/** *  ,      , *       url *   [url]http://api.jquery.com/jQuery.param/[/url] *  [url]http://stackoverflow.com/questions/1714786/querystring-encoding-of-a-javascript-object/1714899#1714899[/url] * * @param object * @param [prefix] * @returns {string} */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toParam</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> object, prefix </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stack = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> object ) { value = object[ key ]; key = prefix ? prefix + <span class="hljs-string"><span class="hljs-string">'['</span></span> + key + <span class="hljs-string"><span class="hljs-string">']'</span></span> : key; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( value === <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { value = <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>( key ) + <span class="hljs-string"><span class="hljs-string">'='</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>( value ) !== <span class="hljs-string"><span class="hljs-string">'object'</span></span> ) { value = <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>( key ) + <span class="hljs-string"><span class="hljs-string">'='</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>( value ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { value = toParam( value, key ); } stack.push( value ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stack.join( <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span> ); } }());</code> </pre><br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// change default settings var app = angular.module( 'app', [ ... ]); app .config( function( $httpProvider ) { // [url]http://habrahabr.ru/post/181009/[/url] $httpProvider.defaults.headers.post[ 'Content-Type' ] = 'application/x-www-form-urlencoded;charset=utf-8'; $httpProvider.defaults.transformRequest = function( data ) { return angular.isObject( data ) &amp;&amp; String( data ) !== '[object File]' ? angular.toParam( data ) : data; }; });</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/181009/">https://habr.com/ru/post/181009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180997/index.html">The collapse of anonymous payments. At rest goes LibertyReserve. Or not</a></li>
<li><a href="../181/index.html">"Optimist" earned?</a></li>
<li><a href="../1810/index.html">Finns again chopped off the Internet in St. Petersburg</a></li>
<li><a href="../181003/index.html">Housing with oil cooled components</a></li>
<li><a href="../181007/index.html">Authorization in PhoneGap application through Facebook, Vkontakte and Habrahabr</a></li>
<li><a href="../18101/index.html">Hello</a></li>
<li><a href="../181011/index.html">ARM as the basis for new supercomputers</a></li>
<li><a href="../181013/index.html">A 17-year-old teen published 0day XSS at PayPal after he was denied a reward.</a></li>
<li><a href="../181019/index.html">Authors competition "Just about the difficult"</a></li>
<li><a href="../181021/index.html">The smallest crash program in C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>