<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SendGrid Chinese is not a decree</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I would like to tell you about a story related to using SendGrid . In the process of investigating the reasons, I had to talk with the support s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SendGrid Chinese is not a decree</h1><div class="post__text post__text-html js-mediator-article"><img align="left" title="noplace" src="https://habrastorage.org/storage3/be0/a86/5ed/be0a865eda494103a90ab96acde4ab75.png" alt="SendGrid logo"><br>  Today I would like to tell you about a story related to using <a href="http://www.sendgrid.com/">SendGrid</a> .  In the process of investigating the reasons, I had to talk with the support service, and the problem, in general, did not dare, but I continue to understand and hope that someone from the readers will offer a good solution to this problem.  Well, and those who are just going to use systems that advertise themselves as transactional mail delivery ( <a href="http://en.wikipedia.org/wiki/Email_marketing">transactional email</a> - SendGrid, MailGun, Mandrill), I hope this post will help you understand what problems they help to solve and which not, and will give an understanding about the expediency of using such systems in principle. <br><br>  Since last year, we have been developing and supporting one of the project management systems with a team of developers located in America, Australia, Bulgaria and Ukraine.  SendGrid is used to send notifications.  It is quite obvious what kind of notifications are sent by such a system ‚Äî registration, confirmation of mail, password recovery ‚Äî but basically they are notifications about system updates by other users ‚Äî a new comment, a new task, etc.  etc.  I have to say that we had some experience with SendGrid.  When adding the functionality of functional monitoring in <a href="http://nerrvana.com/">Nerrvana,</a> we began to use SendGrid, but the amount of mail sent by us is incommensurably less than that sent by the project management system, and therefore here we first encountered problems when using it. <br><a name="habracut"></a><br>  The client is located in China, and, ironically, is the leading email marketing company.  Domain .asia  Twenty employees from this company are registered in our project management system.  Some employees complained that they did not receive the notification.  Then I got into the SendGrid interface and began my investigation. <div class="spoiler">  <b class="spoiler_title">Here is what I saw (screenshot):</b> <div class="spoiler_text"><div style="text-align:center;"><img title="Problem we are facing" src="https://habrastorage.org/storage3/241/ac3/442/241ac344235a1fe9f45bfebbfdd314f9.png" alt=",    "></div><br></div></div><br>  It turned out that some users receive notifications, others do not.  Unsent notifications SendGrid puts a mark ‚ÄúDrop‚Äù with the cause ‚ÄúBounce‚Äù.  It was very strange - how are these users different for the mail server of this domain from others?  The concept of "Bounce" turned out to be new for me and I also decided to first understand what it means.  If this is a generally accepted standard, understand it; if not, then read the meaning of SendGrid. <br><br>  It turned out that <a href="http://en.wikipedia.org/wiki/Bounce_message">‚ÄúBounce‚Äù</a> means that the mail server accepted the mail, but could not deliver it.  It remains to find out why these ‚ÄúBounce‚Äù occur, and I contacted the support service of SendGrid asking why this happens and how the two types of Bounce differ, which I found on the <a href="http://sendgrid.com/logs/index">sendgrid.com/logs/index</a> page, playing with filters: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img title="SendGrid's bounces" src="https://habrastorage.org/storage3/ea5/a40/b2f/ea5a40b2f262ac7cf80f0757c8e72cda.jpg" alt="SendGrid's bounces"></div><br><br>  In response, I received a link to the documentation page - <a href="http://sendgrid.com/docs/Delivery_Metrics/index.html">sendgrid.com/docs/Delivery_Metrics/index.html</a> , and also learned that SendGrid divides Bounces into soft (soft) and hard (hard).  I was also pointed to the <a href="http://sendgrid.com/bounces">sendgrid.com/bounces</a> page, which I had not reached by that time.  You can find it on it, when the address is in the Bounce list, and you can delete the addresses in this list.  Here, for the first time, I thought that there should be an automatic way to do this, since it would be unrealistic for our volumes to look through the lists, analyze and clean them manually.  I was told that SendGrid does not send all subsequent letters to addresses that are in such a list until we ourselves remove it from this list.  ‚ÄúGee!‚Äù - I thought in a non-literary form, and again wrote to the support service.  There were a lot of questions - although, it would seem, SendGrid could also describe it in detail in the documentation.  The lack of means, as it were, they should not be, according to <a href="http://www.crunchbase.com/company/sendgrid">CrunchBase</a> . <br><br>  In my opinion, it would be quite logical to say this in the activity log: <br>  - this attempt to send to the addressee ‚Äúbruce.lee@our_client_domain.asia‚Äù led to the answer ‚Äúsuch and such‚Äù -&gt; I put the address in the ‚ÄúHard bounce‚Äù list <br>  - this attempt to send to the addressee ‚Äúbruce.lee@our_client_domain.asia‚Äù is ignored with the status ‚ÄúDrop‚Äù, since the address is already in the ‚ÄúHard bounce‚Äù list.  In order to view all attempts that were dropped and the primary response of the server, go to <a href="">sendgrid.com/bounces/bruce.lee@our_client_domain.asia</a> . <br><br>  Then everything is simple and clear - you can see why, when and where everything has got and how much is already there.  You can see how soft and hard bounce is indicated and as the interface shows the result of past hitting one of the bad lists.  A link will appear between the activity log and the invalid, bounce, spam lists available on the Email Reports page.  That is, in all cases there is a root cause and consequences.  So show it humanly!  The questions that I have, just will not appear in this case. <br><br>  To prevent the mail from falling into the list, I was advised to add domains to the <a href="http://sendgrid.com/docs/Apps/address_whitelisting.html">Address Whitelist</a> application, available for our subscription level - Silver, but this is also not an option.  Continue to send mail to the provider who added you to the black listed (black listed you) without clarifying the reasons for how the approach did not suit us. <br><br>  Further it was even more interesting.  In the reports I found the root cause - ‚Äú550 Connection frequency limited‚Äù.  From the client, I knew that their <abbr title="Email Service Provider">ESP</abbr> is the largest <abbr title="Internet Service Provider">ISP</abbr> in China, QQ.com, and also that the client added our domain to the white list, and that did not help.  The client threatened to go to Basecamp (which, of course, is unpleasant).  Further, the client shared the information that QQ has a limit on the amount of mail received by each user.  This explained why some users received mail from us and others did not.  The client explained that QQ does not allow small ESPs (in this case, us) to send large amounts of mail to their users.  There was a reasonable question - who is ESP in this case, we or SendGrid?  It turned out that we, and this is completely our problem.  QQ found, for example, that all senders (except those they consider large) can send no more than 10 letters per day to each user.  Apparently, as soon as one of our users receives these normalized QQ-Kovka 10 letters from us, we get further [550 Connection frequency limited] a ‚Äúlittle sabbat‚Äù, as Erast Fandorin's servant Mas would say, and wait for the new day in the Celestial to send another ten.  In addition to this, we also fall into the SendGrid bounce list and the sending of mail to this user stops until we remove the address from this list (we know that we will go there regularly). <br><br>  By the way, if you make a search for the string ‚Äú550 Connection frequency limited‚Äù in Google, then you will immediately see that all the links either mention QQ.com, or are pages of QQ.com itself.  That is a known problem.  One would like to say - "I will recognize a nice gait, and QQ - by Connection frequency limited". <br><br><div style="text-align:center;"><img title="Ku-ku dot com" src="https://habrastorage.org/storage3/1d9/e4a/98e/1d9e4a98e1d74b27a67b29f069c1e0e6.png" alt="-  "></div><br><br>  Why does SendGrid not know anything about it and not warn - ‚Äúyou guys send QQ mail, damn it, mean what ....‚Äù?  Why SendGrid does not agree with QQ that for their (SendGrid-a) clients QQ accepts mail without restrictions, or at least assumes the role of an intermediary, being a major player in this market? <br><br>  Further, a client from China advised us to forecast (?!) The amount of mail sent to all our clients serviced by QQ so as not to send many emails to the same users.  How do you imagine that?  I - no way.  Or ask SendGrid for help, which we did. <br><br>  SendGrid replied that, unfortunately, the QQ page is in Chinese (that is, they first learned from us about this problem, but they still don‚Äôt know about the existence of online translators).  They also said that we ourselves need to contact QQ and send them our outgoing IP address, and ask them to remove restrictions on incoming emails from us.  Another SendGrid offered to buy additional IP addresses for $ 20 a month in order to send part of the mail from them.  ‚ÄúGood‚Äù solution, only what is the probability of blocking by IP from QQ (maybe they block by domain)?  That was the end of it. <br><br>  I wrote to QQ, but no one answered from there and nothing changed on their part.  I added this client‚Äôs domain to the White list in SendGrid so that bounce errors do not add recipient mail to stop lists.  As you understand, this did not solve the problem.  We just try to send QQ users after receiving the ‚Äú550 Connection frequency limited‚Äù in the hope that at least something will come when the QQ counter is reset for this user to zero. <br><br>  It is this and other cases that led us to the decision to keep mail sending status for analysis and future automation of problem solving.  It became clear that you need to collect information about the status of sent letters in your database, and then return to the issue of automating the solution of postal problems on your own. <br><br>  What conclusions can be drawn from the situation described above: <br><br>  1) Sendrgid does not protect you from blocking on the side of the user's mail server at all.  If your customers complain that they are not receiving notifications, check to see if their ESP has restrictions like QQ. <br><br>  2) Sendgrid employees do not know Chinese <br><br>  3) When sending emails via Sendgrid, you must use the <a href="http://sendgrid.com/docs/API_Reference/Webhooks/event.html">Event webhook</a> , or regularly check your account in the service in order to respond quickly to placing your users on the Bounced list. </div><p>Source: <a href="https://habr.com/ru/post/193536/">https://habr.com/ru/post/193536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193518/index.html">Happy programmer!</a></li>
<li><a href="../193524/index.html">786,432 cores of the IBM MIRA supercomputer began to model the early Universe</a></li>
<li><a href="../193528/index.html">Analytics. Cat. Friday</a></li>
<li><a href="../193530/index.html">[contest] DevOps Brainwashing</a></li>
<li><a href="../193534/index.html">Product Manager through the eyes of developers</a></li>
<li><a href="../193538/index.html">Telegraph history in summary</a></li>
<li><a href="../193540/index.html">Em :: Blocks 1.20</a></li>
<li><a href="../193542/index.html">How to optimize the vote count on election day</a></li>
<li><a href="../193550/index.html">NASA has identified three suitable asteroids to capture</a></li>
<li><a href="../193554/index.html">Great move, QIWI!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>