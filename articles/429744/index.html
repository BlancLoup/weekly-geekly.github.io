<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn OpenGL. Lesson 6.4 - IBL. Mirror irradiance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous lesson, we prepared our PBR model to work together with the IBL method ‚Äî for this we needed to prepare in advance an irradiance map th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn OpenGL. Lesson 6.4 - IBL. Mirror irradiance</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="Ogl3" width="300"><br>  In the <a href="https://habr.com/post/426987/">previous lesson,</a> we prepared our PBR model to work together with the IBL method ‚Äî for this we needed to prepare in advance an irradiance map that describes the diffuse part of the indirect illumination.  In this lesson we will pay attention to the second part of the expression of reflectivity - the mirror: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">p</span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-8">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">g</span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-15" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-18">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">t</span><span class="MJXp-mtext" id="MJXp-Span-22">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">t</span><span class="MJXp-msubsup" id="MJXp-Span-28"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-30" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-31">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">a</span></span></span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-38"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-40" style="vertical-align: -0.4em;">d</span></span><span class="MJXp-mtext" id="MJXp-Span-41">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">c</span><span class="MJXp-mrow" id="MJXp-Span-46"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">c</span></span><span class="MJXp-mrow" id="MJXp-Span-48"><span class="MJXp-mtext" id="MJXp-Span-49">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">i</span></span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-53"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-55" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">c</span><span class="MJXp-mrow" id="MJXp-Span-61"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">G</span></span><span class="MJXp-mrow" id="MJXp-Span-65"><span class="MJXp-mn" id="MJXp-Span-66">4</span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-68">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">g</span><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-76">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">n</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-84">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">g</span><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-91" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-92">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">n</span><span class="MJXp-mo" id="MJXp-Span-98" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-102" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-103" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">p</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-106">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">g</span><span class="MJXp-msubsup" id="MJXp-Span-111"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-113" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">n</span><span class="MJXp-mtext" id="MJXp-Span-116">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">t</span><span class="MJXp-mtext" id="MJXp-Span-121">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">g</span><span class="MJXp-msubsup" id="MJXp-Span-126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-128" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">d</span><span class="MJXp-mtext" id="MJXp-Span-130">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">g</span><span class="MJXp-msubsup" id="MJXp-Span-135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-137" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="133.846ex" height="2.78ex" viewBox="0 -832 57628 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="16413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="16963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="17415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="17944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="18378" y="0"></use><g transform="translate(18811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2B" x="20132" y="0"></use><g transform="translate(21133,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="22337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="22887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="23339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="23868" y="0"></use><g transform="translate(24302,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(26666,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="13946" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="41002" y="0"></use><g transform="translate(41392,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="42417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="42807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="43310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="44006" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="44491" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="45370" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="45836" y="0"></use><g transform="translate(46317,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="47190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="47580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="48430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="48864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="49387" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="49873" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="50484" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="50970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="51848" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="52315" y="0"></use><g transform="translate(52795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="53669" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="54443" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="54928" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="55807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="56273" y="0"></use><g transform="translate(56754,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_d \ frac {c} {\ pi} + k_s \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n )}) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Part 1. Start <br><br><ol><li>  <a href="https://habrahabr.ru/post/310790/">Opengl</a> </li><li>  <a href="https://habrahabr.ru/post/311198/">Creating a window</a> </li><li>  <a href="https://habrahabr.ru/post/311234/">Hello window</a> </li><li>  <a href="https://habrahabr.ru/post/311808/">Hello triangle</a> </li><li>  <a href="https://habrahabr.ru/post/313380/">Shaders</a> </li><li>  <a href="https://habrahabr.ru/post/315294/">Textures</a> </li><li>  <a href="https://habrahabr.ru/post/319144/">Transformations</a> </li><li>  <a href="https://habrahabr.ru/post/324968/">Coordinate systems</a> </li><li>  <a href="https://habrahabr.ru/post/327604/">Camera</a> </li></ol><br>  Part 2. Basic lighting <br><br><ol><li>  <a href="https://habrahabr.ru/post/329592/">Colors</a> </li><li>  <a href="https://habrahabr.ru/post/333932/">Lighting Basics</a> </li><li>  <a href="https://habrahabr.ru/post/336166/">Materials</a> </li><li>  <a href="https://habrahabr.ru/post/337550/">Texture Cards</a> </li><li>  <a href="https://habrahabr.ru/post/337642/">Sources of light</a> </li><li>  <a href="https://habrahabr.ru/post/338254/">Multiple light sources</a> </li></ol><br>  Part 3. Loading 3D Models 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/338436/">Assimp library</a> </li><li>  <a href="https://habrahabr.ru/post/338436/">Mesh mesh class</a> </li><li>  <a href="https://habrahabr.ru/post/338998/">3D model class</a> </li></ol><br>  Part 4. OpenGL advanced features <br><br><ol><li>  <a href="https://habrahabr.ru/post/342610/">Depth test</a> </li><li>  <a href="https://habrahabr.ru/post/344238/">Stencil test</a> </li><li>  <a href="https://habrahabr.ru/post/343096/">Mixing colors</a> </li><li>  <a href="https://habrahabr.ru/post/346964/">Face clipping</a> </li><li>  <a href="https://habrahabr.ru/post/347354/">Frame buffer</a> </li><li>  <a href="https://habrahabr.ru/post/347750/">Cubic cards</a> </li><li>  <a href="https://habrahabr.ru/post/350008/">Advanced data handling</a> </li><li>  <a href="https://habrahabr.ru/post/350156/">Advanced GLSL</a> </li><li>  <a href="https://habrahabr.ru/post/350782/">Geometric shader</a> </li><li>  <a href="https://habrahabr.ru/post/352962/">Instancing</a> </li><li>  <a href="https://habrahabr.ru/post/351706/">Smoothing</a> </li></ol><br>  Part 5. Advanced Lighting <br><br><ol><li>  <a href="https://habrahabr.ru/post/353054/">Advanced lighting.</a>  <a href="https://habrahabr.ru/post/353054/">Model Blinna-Phong.</a> </li><li>  <a href="https://habrahabr.ru/post/353632/">Gamma Correction</a> </li><li>  <a href="https://habrahabr.ru/post/353956/">Shadow maps</a> </li><li>  <a href="https://habr.com/post/354208/">Omnidirectional shadow maps</a> </li><li>  <a href="https://habr.com/post/415579/">Normal mapping</a> </li><li>  <a href="https://habr.com/post/416163/">Parallax mapping</a> </li><li>  <a href="https://habr.com/post/420409/">Hdr</a> </li><li>  <a href="https://habr.com/post/420375/">Bloom</a> </li><li>  <a href="https://habr.com/post/420565/">Deferred rendering</a> </li><li>  <a href="https://habr.com/post/421385/">SSAO</a> </li></ol><br>  Part 6. PBR <br><br><ol><li>  <a href="https://habr.com/post/426123/">Theory</a> </li><li>  <a href="https://habr.com/post/424453/">Analytical light sources</a> </li><li>  <a href="https://habr.com/post/426987/">IBL.</a>  <a href="https://habr.com/post/426987/">Diffuse irradiation.</a> </li><li>  <b>IBL.</b>  <b>Mirror irradiance.</b> </li></ol><br></div></div><br>  It can be noted that the Cook‚Äôs-Torrens mirror component (the subexpression with the multiplier <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-138"><span class="MJXp-msubsup" id="MJXp-Span-139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-141" style="vertical-align: -0.4em;">s</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.215ex" height="2.419ex" viewBox="0 -780.1 953.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="737" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> k_s </script>  ) is not constant and depends on the direction of the incident light, <b>as well as</b> on the direction of observation.  The solution of this integral for all possible directions of incidence of light, together with all possible directions of observation in real time, is simply not feasible.  Therefore, Epic Games researchers have proposed an approach called <i>split sum approximation</i> , which allows partial data to be prepared for the mirror component in advance, subject to certain conditions. <br><br>  In this approach, the mirror component of the expression of reflectivity is divided into two parts, which can be pre-convolved separately, and then combined into a PBR shader, to be used as a source of indirect mirror radiation.  As with the formation of an irradiance map, the convolution process accepts an HDR environment map at its entrance. <br><br>  To understand the method of approximation by a separate sum, look again at the expression of reflectivity, leaving only the subexpression for the mirror component in it (the diffuse part was considered separately in the <a href="https://habr.com/post/426987/">previous lesson</a> ): <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-142"><span class="MJXp-msubsup" id="MJXp-Span-143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-145" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-146" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">p</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-149">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">g</span><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-156" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-157" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-158" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-159">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">t</span><span class="MJXp-mtext" id="MJXp-Span-163">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">t</span><span class="MJXp-msubsup" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-171" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-172">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">a</span></span></span><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-181" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-182">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">c</span><span class="MJXp-mrow" id="MJXp-Span-187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">G</span></span><span class="MJXp-mrow" id="MJXp-Span-191"><span class="MJXp-mn" id="MJXp-Span-192">4</span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-194">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">g</span><span class="MJXp-msubsup" id="MJXp-Span-199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-201" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-202">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">n</span><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-209" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-210">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">g</span><span class="MJXp-msubsup" id="MJXp-Span-215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-217" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">n</span><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-msubsup" id="MJXp-Span-225"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-227" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">p</span><span class="MJXp-mo" id="MJXp-Span-230" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-231">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">g</span><span class="MJXp-msubsup" id="MJXp-Span-236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-238" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">n</span><span class="MJXp-mtext" id="MJXp-Span-241">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">t</span><span class="MJXp-mtext" id="MJXp-Span-246">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-248">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">g</span><span class="MJXp-msubsup" id="MJXp-Span-251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-253" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">d</span><span class="MJXp-mtext" id="MJXp-Span-255">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">g</span><span class="MJXp-msubsup" id="MJXp-Span-260"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-262" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-264">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">t</span><span class="MJXp-mtext" id="MJXp-Span-268">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273">t</span><span class="MJXp-msubsup" id="MJXp-Span-274"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-276" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-277">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">a</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-285" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-286" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">p</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-289">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">g</span><span class="MJXp-msubsup" id="MJXp-Span-294"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-296" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-298">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">g</span><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-307"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-309" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-310" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">p</span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-313">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">g</span><span class="MJXp-msubsup" id="MJXp-Span-318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-320" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">n</span><span class="MJXp-mtext" id="MJXp-Span-323">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">t</span><span class="MJXp-mtext" id="MJXp-Span-328">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">g</span><span class="MJXp-msubsup" id="MJXp-Span-333"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-334" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-335" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">d</span><span class="MJXp-mtext" id="MJXp-Span-337">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341">g</span><span class="MJXp-msubsup" id="MJXp-Span-342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-344" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="199.648ex" height="2.78ex" viewBox="0 -832 85959.2 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="16374" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="16925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="17376" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="17906" y="0"></use><g transform="translate(18339,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(20704,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="13946" y="0"></use></g><g transform="translate(35040,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="36066" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="36455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="36959" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="37654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="38139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="39018" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="39484" y="0"></use><g transform="translate(39965,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="40839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="41228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="42079" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="42512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="43036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="43521" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="44133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="44618" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="45497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="45963" y="0"></use><g transform="translate(46444,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="47318" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="48091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="48577" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="49455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="49922" y="0"></use><g transform="translate(50402,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-3D" x="51554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="52860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="53205" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="53806" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6C" x="54417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="54716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="55061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="55940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="56285" y="0"></use><g transform="translate(56647,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(59672,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="60581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="60971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="61474" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="62170" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="62655" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="63534" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="64000" y="0"></use><g transform="translate(64481,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="65354" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="66049" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="66535" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="67413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="67880" y="0"></use><g transform="translate(68360,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="69333" y="0"></use><g transform="translate(69723,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="70749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="71138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="71642" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="72337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="72822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="73701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="74167" y="0"></use><g transform="translate(74648,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="75522" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="75911" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="76762" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="77195" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="77719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="78204" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="78816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="79301" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="80180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="80646" y="0"></use><g transform="translate(81127,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="82000" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="82774" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="83259" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="84138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="84604" y="0"></use><g transform="translate(85085,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_s \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n)} L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i = \ int \ limits _ {\ Omega} f_r (p, \ omega_i, \ omega_o) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br>  As in the case of preparing the irradiance map, this integral has no possibility to solve in real time.  Therefore, it is desirable to predistin a map in the same way for the mirror component of the expression of reflectivity, and in the main render cycle you can do with a simple sample of this map based on the surface normal.  However, everything is not so simple: the irradiance map was obtained relatively easily due to the fact that the integral depended only on <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-345"><span class="MJXp-mtext" id="MJXp-Span-346">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-350">g</span><span class="MJXp-msubsup" id="MJXp-Span-351"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.978ex" height="1.817ex" viewBox="0 -520.7 3434.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2080" y="0"></use><g transform="translate(2561,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> \ omega_i </script>  , and the constant subexpression for the Lambert diffuse component could be taken out of the integral sign.  In this case, the integral depends not only on <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-354"><span class="MJXp-mtext" id="MJXp-Span-355">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">g</span><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.978ex" height="1.817ex" viewBox="0 -520.7 3434.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2080" y="0"></use><g transform="translate(2561,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-5"> \ omega_i </script>  , which is easy to understand from the BRDF formula: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-363"><span class="MJXp-msubsup" id="MJXp-Span-364"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-365" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-366" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-367" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">p</span><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-370"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-371" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-372" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-376" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-378" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-379">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-381">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-382">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">c</span><span class="MJXp-mrow" id="MJXp-Span-384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-387">G</span></span><span class="MJXp-mrow" id="MJXp-Span-388"><span class="MJXp-mn" id="MJXp-Span-389">4</span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-391">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-394">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395">g</span><span class="MJXp-msubsup" id="MJXp-Span-396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-398" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-399">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-401">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-402">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-403">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">n</span><span class="MJXp-mo" id="MJXp-Span-405" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-407">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411">g</span><span class="MJXp-msubsup" id="MJXp-Span-412"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-414" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-415">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-416">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-418">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">n</span><span class="MJXp-mo" id="MJXp-Span-421" style="margin-left: 0em; margin-right: 0em;">)</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="59.349ex" height="2.66ex" viewBox="0 -832 25552.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="693" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="909" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="1299" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="1802" y="0"></use><g transform="translate(2247,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="3308" y="0"></use><g transform="translate(3753,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="4913" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-3D" x="5580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="6887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="7437" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="7889" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="8418" y="0"></use><g transform="translate(8852,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(11216,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="13946" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> f_r (p, w_i, w_o) = \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n)} </script></p><br>  The expression under the integral also depends on <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-422"><span class="MJXp-mtext" id="MJXp-Span-423">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427">g</span><span class="MJXp-msubsup" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-430" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.208ex" height="1.817ex" viewBox="0 -520.7 3533.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2080" y="0"></use><g transform="translate(2561,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-7"> \ omega_o </script>  - it is practically impossible to select from a previously prepared cube map using two direction vectors.  Point position <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> p </script>  in this case, you can ignore - why it was so considered in the previous lesson.  Preliminary calculation of the integral for all possible combinations <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-433"><span class="MJXp-mtext" id="MJXp-Span-434">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-435">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-437">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">g</span><span class="MJXp-msubsup" id="MJXp-Span-439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-441" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.978ex" height="1.817ex" viewBox="0 -520.7 3434.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2080" y="0"></use><g transform="translate(2561,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-9"> \ omega_i </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-442"><span class="MJXp-mtext" id="MJXp-Span-443">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">g</span><span class="MJXp-msubsup" id="MJXp-Span-448"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-449" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-450" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.208ex" height="1.817ex" viewBox="0 -520.7 3533.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2080" y="0"></use><g transform="translate(2561,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-10"> \ omega_o </script>  impossible in real-time tasks. <br><br>  The split-sum method from Epic Games solves this problem by splitting the preliminary calculation task into two independent parts, the results of which can be combined later to get the total predicted value.  The split sum method extracts two integrals from the source expression for the mirror component: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-451"><span class="MJXp-msubsup" id="MJXp-Span-452"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-453" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-454" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-455" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">p</span><span class="MJXp-mo" id="MJXp-Span-457" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-458">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-460">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462">g</span><span class="MJXp-msubsup" id="MJXp-Span-463"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-464" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-465" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-467" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-468">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-469">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-471">t</span><span class="MJXp-mtext" id="MJXp-Span-472">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-473">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-476">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477">t</span><span class="MJXp-msubsup" id="MJXp-Span-478"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-479" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-480" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-481">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">a</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-487"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-488" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-489" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">p</span><span class="MJXp-mo" id="MJXp-Span-492" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-493">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-494">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-496">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-497">g</span><span class="MJXp-msubsup" id="MJXp-Span-498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-500" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-501" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">d</span><span class="MJXp-mtext" id="MJXp-Span-503">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-505">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-507">g</span><span class="MJXp-msubsup" id="MJXp-Span-508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-510" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-511" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mtext" id="MJXp-Span-512">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-515">t</span><span class="MJXp-mtext" id="MJXp-Span-516">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-518">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-520">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">t</span><span class="MJXp-msubsup" id="MJXp-Span-522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-524" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-525">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-527">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-530">a</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-531"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-533" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-534" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-535">p</span><span class="MJXp-mo" id="MJXp-Span-536" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-537">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-540">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-541">g</span><span class="MJXp-msubsup" id="MJXp-Span-542"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-543" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-544" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-546">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-547">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-548">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-549">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">g</span><span class="MJXp-msubsup" id="MJXp-Span-551"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-553" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-554" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555">n</span><span class="MJXp-mtext" id="MJXp-Span-556">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-557">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-558">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-559">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560">t</span><span class="MJXp-mtext" id="MJXp-Span-561">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-563">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-564">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">g</span><span class="MJXp-msubsup" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-568" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569">d</span><span class="MJXp-mtext" id="MJXp-Span-570">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-573">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574">g</span><span class="MJXp-msubsup" id="MJXp-Span-575"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-577" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="123.176ex" height="2.78ex" viewBox="0 -832 53033.9 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(14781,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="15807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="16197" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="16700" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="17395" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="17881" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="18759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="19226" y="0"></use><g transform="translate(19706,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="20580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="20970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="21743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="22229" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="23107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="23574" y="0"></use><g transform="translate(24054,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2217" x="25150" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="26123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="26468" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="27069" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6C" x="27680" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="27979" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="28324" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="29203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="29548" y="0"></use><g transform="translate(29910,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(32935,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-72" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-28" x="33844" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-70" x="34234" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="34737" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="35433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="35918" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="36797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="37263" y="0"></use><g transform="translate(37744,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-2C" x="38617" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="39312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="39798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="40676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="41143" y="0"></use><g transform="translate(41623,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMAIN-29" x="42596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6E" x="42986" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-63" x="43836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="44270" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="44793" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-74" x="45279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="45890" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="46376" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="47254" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="47721" y="0"></use><g transform="translate(48201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-64" x="49075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6F" x="49849" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-6D" x="50334" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-65" x="51213" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-67" x="51679" y="0"></use><g transform="translate(52160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/429744/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjztZbVQr001BvcEDu1dER2-VH0Aw#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} L_i (p, \ omega_i) d \ omega_i * \ int \ limits _ {\ Omega} f_r (p, \ omega_i, \ omega_o) n \ cdot \ omega_i d \ omega_i </script></p><br>  The result of the calculation of the first part is usually called the <i>pre-filtered environment map</i> , and is the environment map subjected to the convolution process specified by this expression.  All this is similar to the process of obtaining an irradiance map, but in this case the convolution is carried out taking into account the roughness value.  High roughness values ‚Äã‚Äãlead to the use of more disparate sampling vectors during the convolution process, which leads to more blurred results.  The result of the convolution for each next selected level of roughness is stored in the next mip level of the prepared map of the environment.  For example, an environment map that has been convolved for five different levels of roughness contains five mip levels and looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/nt/vq/adntvqtgc_vkrufypnzxeoayx4m.png"></div><br>  Sample vectors and their spread values ‚Äã‚Äãare determined based on the normal distribution function ( <i>NDF</i> ) of the BRDF Cook-Torrens model.  This function takes the normal vector and the direction of observation as input parameters.  Since the direction of observation is not known in advance at the time of preliminary calculation, the developers of Epic Games had to make one more assumption: the direction of gaze (and hence the direction of mirror reflection) is always identical to the output direction of the sample <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-578"><span class="MJXp-mtext" id="MJXp-Span-579">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-580">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-581">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-582">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583">g</span><span class="MJXp-msubsup" id="MJXp-Span-584"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-586" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> \ omega_o </script>  .  In the form of code: <br><br><pre><code class="cpp hljs">vec3 N = normalize(w_o); vec3 R = N; vec3 V = R;</code> </pre> <br>  In such conditions, the direction of gaze is not required in the process of convolving the environment map, which makes the calculation feasible in real time.  But on the other hand, we lose the characteristic distortion of the mirror reflections when observed at an acute angle to the reflecting surface, as seen in the image below (from the publication <a href="https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf">Moving Frostbite to PBR</a> ).  In general, such a compromise is considered acceptable. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/qu/8y/qwqu8yar2slqk93dchfih4laxse.png"></div><br>  The second part of the split sum expression contains the BRDF of the original expression for the mirror component.  Assuming that the incoming energy brightness is spectrally represented by white light for all directions (i.e., <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-587"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">L</span><span class="MJXp-mo" id="MJXp-Span-589" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590">p</span><span class="MJXp-mo" id="MJXp-Span-591" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-592">x</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-594" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-595">1.0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> L (p, x) = 1.0 </script>  ), it is possible to pre-calculate the value for BRDF with the following input parameters: material roughness and honey angle normal <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-596"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> n </script>  and the direction of light <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-598"><span class="MJXp-mtext" id="MJXp-Span-599">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-601">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603">g</span><span class="MJXp-msubsup" id="MJXp-Span-604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-605" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-606" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> \ omega_i </script>  (or <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-607"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-608">n</span><span class="MJXp-mtext" id="MJXp-Span-609">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">t</span><span class="MJXp-mtext" id="MJXp-Span-614">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-617">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-618">g</span><span class="MJXp-msubsup" id="MJXp-Span-619"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-620" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-621" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> n \ cdot \ omega_i </script>  ).  The Epic Games approach involves storing the results of a BRDF calculation for each combination of roughness and angle between the normal and the direction of light in the form of a two-dimensional texture known as <i>the BRDF</i> ( <i>BRDF integration map</i> ), which is later used as a <i>look-up table</i> .  This reference texture uses red and green output channels to store the scale and offset to calculate the surface Fresnel coefficient, which ultimately allows us to solve the second part of the expression for the split sum: <br><br><img src="https://habrastorage.org/webt/5s/so/fw/5ssofwhkncncu263tegajwxm15k.png"><br>  This auxiliary texture is created as follows: horizontal texture coordinates (ranging from [0., 1.]) are considered as values ‚Äã‚Äãof the input parameter <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623">n</span><span class="MJXp-mtext" id="MJXp-Span-624">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-627">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628">t</span><span class="MJXp-mtext" id="MJXp-Span-629">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">g</span><span class="MJXp-msubsup" id="MJXp-Span-634"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-636" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> n \ cdot \ omega_i </script>  BRDF functions;  Texture coordinates on a vertical are considered as input roughness values. <br><br>  As a result, having such an integration map and a pre-processed environment map, you can combine samples from them to get the total value of the integral expression of the mirror component: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lod = getMipLevelFromRoughness(roughness); vec3 prefilteredColor = textureCubeLod(PrefilteredEnvMap, refVec, lod); vec2 envBRDF = texture2D(BRDFIntegrationMap, vec2(NdotV, roughness)).xy; vec3 indirectSpecular = prefilteredColor * (F * envBRDF.x + envBRDF.y)</code> </pre><br>  This review of the split-sum method from Epic Games should help create an impression of the process of approximate calculation of the part of the reflectivity that is responsible for the mirror component.  Now we will try to prepare these maps on our own. <br><br><h2>  Pre-filtering HDR environment maps </h2><br>  The pre-filtering of the environment map proceeds in a similar way to what was done to obtain an irradiance map.  The only difference is that now we take into account the roughness and save the result for each level of roughness in the new mip-level cubic map. <br><br>  To begin with, you will have to create a new cubic map that will contain the result of the preliminary filtering.  In order to create the required number of mip levels, we simply call <i>glGenerateMipmaps ()</i> - the necessary memory will be allocated for the current texture: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prefilterMap; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;prefilterMap); glBindTexture(GL_TEXTURE_CUBE_MAP, prefilterMap); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i) { glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB16F, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, GL_FLOAT, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR); glGenerateMipmap(GL_TEXTURE_CUBE_MAP);</code> </pre><br>  Note: since the <i>prefilterMap selection</i> will be conducted taking into account the existence of mip levels, it is necessary to set the reduction filter mode to <i>GL_LINEAR_MIPMAP_LINEAR</i> mode to enable trilinear filtering.  Pre-processed images of mirror reflections are stored in separate faces of a cube map with a resolution at the base mip level of only 128x128 pixels.  For most materials, this is quite enough, however, if you have an increased amount of smooth, shiny surfaces in your scene (for example, a new car), you may need to increase this resolution. <br><br>  In the previous lesson, we convolved the environment map by creating sample vectors that are evenly distributed in the hemisphere. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-637"><span class="MJXp-mtext" id="MJXp-Span-638">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-639">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> \ Omega </script>  using spherical coordinates.  For obtaining irradiance, this method is quite effective, which cannot be said about the calculations of specular reflections.  The physics of specular highlights tells us that the direction of specularly reflected light is adjacent to the reflection vector. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-644"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> r </script>  for surface with normal <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-646"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647">n</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> n </script>  , even if the roughness is not zero: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mh/fx/xq/mhfxxqxaglsggbtfz_1klwkmbga.png"></div><br>  The generalized form of the possible outgoing directions of reflection is called the <i>mirror</i> <i>lobe</i> ; the ‚Äú <i>specular lobe of the</i> mirror pattern‚Äù is perhaps too verbose, the <i>reference point</i> ).  As the roughness increases, the petal grows and expands.  Also, its shape changes depending on the direction of light falling.  Thus, the shape of the petal strongly depends on the properties of the material. <br><br>  Returning to the model of microsurfaces, you can imagine the shape of the mirror lobe as describing the orientation of the reflection relative to the median vector of the micro-surfaces, taking into account some given direction of light incidence.  Realizing that most of the rays of the reflected light lies inside the mirror petal, oriented on the basis of the median vector, it makes sense to create a vector of the sample, oriented in a similar way.  Otherwise, many of them will be useless.  This approach is called <i>importance sampling</i> . <br><br><h4>  Monte Carlo integration and sampling by significance </h4><br>  To fully understand the essence of the sample in terms of significance, you will first have to become familiar with such a mathematical apparatus as the Monte-Carlo integration method.  This method is based on a combination of statistics and probability theory and helps to carry out a numerical solution of a certain statistical problem on a large sample without the need to consider <i>each</i> element of this sample. <br><br>  For example, you want to calculate the average growth of a country's population.  To obtain an accurate and reliable result, one would have to measure the growth of <i>every</i> citizen and average the result.  However, since the population of most countries is quite large, this approach is practically unrealizable, since it requires too many resources for implementation. <br>  Another approach is to create a smaller subsample filled with truly random (unbiased) elements of the original sample.  Next, you also measure growth and average the result for this subsample.  You can take at least a hundred people and get a result, though not absolutely accurate, but still close enough to the real situation.  The explanation for this method lies in the consideration of the law of large numbers.  And its essence is described as follows: the result of a certain dimension in a smaller subsample size <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-648"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> N </script>  , composed of truly random elements of the original set, will be close to the control result of the measurement carried out on the entire original set.  Moreover, the approximate result tends to true with increasing <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-650"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> N </script>  . <br>  Monte-Carlo integration is an application of the law of large numbers to solve integrals.  Instead of solving the integral taking into account the whole (possibly infinite) set of values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-652"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> x </script>  , we use <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-654"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> N </script>  random sampling points and averaging the result.  With growth <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-656"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> N </script>  the approximate result is guaranteed to approach the exact solution of the integral. <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-658"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">O</span><span class="MJXp-mo" id="MJXp-Span-660" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-661">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664">t</span><span class="MJXp-mtext" id="MJXp-Span-665">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-667">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-669">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-670">t</span><span class="MJXp-msubsup" id="MJXp-Span-671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672" style="margin-right: 0.05em;">s</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-675"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-676">b</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-673"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">a</span></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">f</span><span class="MJXp-mo" id="MJXp-Span-678" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679">x</span><span class="MJXp-mo" id="MJXp-Span-680" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-681">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-682">x</span><span class="MJXp-mo" id="MJXp-Span-683" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-684">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-685">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-688">c</span><span class="MJXp-mrow" id="MJXp-Span-689"><span class="MJXp-mn" id="MJXp-Span-690">1</span></span><span class="MJXp-mrow" id="MJXp-Span-691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">N</span></span><span class="MJXp-mtext" id="MJXp-Span-693">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695">u</span><span class="MJXp-msubsup" id="MJXp-Span-696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-702"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-703">N</span><span class="MJXp-mo" id="MJXp-Span-704">‚àí</span><span class="MJXp-mn" id="MJXp-Span-705">1</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699">i</span><span class="MJXp-mo" id="MJXp-Span-700">=</span><span class="MJXp-mn" id="MJXp-Span-701">0</span></span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-706">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-710">c</span><span class="MJXp-mrow" id="MJXp-Span-711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712">f</span><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714">x</span><span class="MJXp-mo" id="MJXp-Span-715" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mrow" id="MJXp-Span-716"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-717">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">f</span><span class="MJXp-mo" id="MJXp-Span-720" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-721">x</span><span class="MJXp-mo" id="MJXp-Span-722" style="margin-left: 0em; margin-right: 0em;">)</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-26"> O = \ int \ limits_ {a} ^ {b} f (x) dx = \ frac {1} {N} \ sum_ {i = 0} ^ {N-1} \ frac {f (x)} { pdf (x)} </script></p><br>  To solve the integral, we obtain the value of the integrand for <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> N </script>  random points from a sample within [a, b], the results are summarized and divided by the total number of points taken for averaging.  Element <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> pdf </script>  describes <i>the</i> <i>probability density function</i> , which shows how likely each selected value is found in the original sample.  For example, this function for the growth of citizens would look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2j/yh/zd/2jyhzdv02d8-zu_5sjgop6aahac.png"></div><br>  It can be seen that when using random sampling points, we have a much higher chance of meeting the height value of 170 cm than someone with a height of 150 cm. <br><br>  It is clear that when carrying out Monte Carlo integration, some sample points are more likely to appear in sequence than others.  Therefore, in any expression for the Monte Carlo estimate, we divide or multiply the selected value by the probability of its occurrence, using the probability density function.  At the moment, when evaluating the integral, we created a set of uniformly distributed sampling points: the chance of obtaining any of them was the same.  Thus, our estimate was <i>unbiased</i> , which means that as the number of sample points grows, our estimate will converge to the exact solution of the integral. <br><br>  However, there are evaluation functions that are <i>biased</i> , i.e.  implying the creation of sampling points not in a truly random manner, but with a predominance of a certain value or direction.  Such evaluation functions allow Monte-Carlo evaluation to converge to an exact solution <i>much faster</i> .  On the other hand, due to the bias of the evaluation function, the solution may never converge.  In the general case, this is considered an acceptable compromise, especially in computer graphics tasks, since the estimate is very close to the analytical result and is not required if its effect looks quite reliably.  As we will soon see sampling by significance (using an offset estimation function) allows you to create sample points shifted in a certain direction, which is taken into account by multiplying or dividing each selected value by the corresponding value of the probability density function. <br><br>  Monte-Carlo integration is quite common in computer graphics tasks, since it is a fairly intuitive method for estimating the value of continuous integrals by a numerical method, which is quite effective.  It is enough to take some area or volume in which the sample is taken (for example, our hemisphere <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-729"><span class="MJXp-mtext" id="MJXp-Span-730">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-732">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-733">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> \ Omega </script>  ) create <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-736"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> N </script>  random sample points lying inside, and conduct a weighted summation of the obtained values. <br><br>  The Monte Carlo method is a very extensive topic for discussion, and here we will no longer go into details, but one more important detail remains: there is not a single way to create <i>random samples</i> .  By default, each sample point is completely (random) random - which is what we expect.  But, using certain properties of quasi-random sequences, it is possible to create sets of vectors that, although random, have interesting properties.  For example, when creating random samples for the integration process, you can use the so-called <i>low mismatch sequences</i> ( <i>low-discrepancy sequences</i> ), which ensure the randomness of the created sample points, but in the total set they are more evenly <i>distributed</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3v/wm/eq/3vwmeqom0d-sq_r0nqrobj0tspq.png"></div><br>  Using low-inconsistency sequences to create a set of sample vectors for the integration process is a <i>quasi-Monte Carlo method</i> ( <i>Quasi-Monte Carlo intergration</i> ).  Monte Carlo quasi-methods converge much faster than the general approach, which is a very attractive feature for applications with high performance requirements. <br><br>  So, we know about the general and quasi-Monte-Carlo method, but there is one more detail which will provide even greater convergence rate: sampling by significance. <br>  As already noted in the lesson, for specular reflections, the direction of the reflected light is enclosed in a mirror lobe, the size and shape of which depends on the roughness of the reflecting surface.  Understanding that any (quasi) random sampling vectors that are outside the mirror lobe will not affect the integral expression of the mirror component, i.e.  are useless.  It makes sense to focus the generation of sampling vectors in the region of the mirror lobe using the offset estimation function for the Monte Carlo method. <br><br>  This is the essence of sampling by importance: the creation of sampling vectors lies in a certain area, oriented along the median vector of micro-surfaces, and the shape of which is determined by the roughness of the material.  Using a combination of the quasi-Monte Carlo method, low-mismatch sequences and the displacement of the process of creating sample vectors due to sampling by significance, we achieve very high convergence rates.  Since the convergence to the solution is fast enough, we can use a smaller number of sample vectors while still achieving a fairly reasonable estimate.  The combination of methods described, in principle, allows graphic applications to even solve the integral of the mirror component in real time, although a preliminary calculation still remains a much more advantageous approach. <br><br><h4>  Low mismatch sequence </h4><br>  In this lesson, we still use the preliminary calculation of the mirror component of the expression of reflectivity for indirect radiation.  And we will use the sampling by significance using a random sequence of low discrepancy and the quasi-Monte Carlo method.  The sequence used is known as <i>the Hammersley sequence</i> ( <i>Hammersley sequence</i> ), a detailed description of which is given by <a href="http://holger.dammertz.org/stuff/notes_HammersleyOnHemisphere.html">Holger Dammertz</a> .  This sequence, in turn, is based on <i>the van der Corput sequence</i> ( <i>van der Corput sequence</i> ), which uses a special binary transform of the decimal relative to the decimal point. <br><br>  Using cunning tricks of bitwise arithmetic, one can effectively define the van der Corput sequence directly in the shader and use it to create the i-th element of the Hammersley sequence from the sample to <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> N </script>  items: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RadicalInverse_VdC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bits</span></span></span><span class="hljs-function">)</span></span> { bits = (bits &lt;&lt; <span class="hljs-number"><span class="hljs-number">16u</span></span>) | (bits &gt;&gt; <span class="hljs-number"><span class="hljs-number">16u</span></span>); bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x55555555</span></span>u) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1u</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xAAAAAAAA</span></span>u) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1u</span></span>); bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x33333333</span></span>u) &lt;&lt; <span class="hljs-number"><span class="hljs-number">2u</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xCCCCCCCC</span></span>u) &gt;&gt; <span class="hljs-number"><span class="hljs-number">2u</span></span>); bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x0F0F0F0F</span></span>u) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4u</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xF0F0F0F0</span></span>u) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4u</span></span>); bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x00FF00FF</span></span>u) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8u</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xFF00FF00</span></span>u) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8u</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(bits) * <span class="hljs-number"><span class="hljs-number">2.3283064365386963e-10</span></span>; <span class="hljs-comment"><span class="hljs-comment">// / 0x100000000 } // ---------------------------------------------------------------------------- vec2 Hammersley(uint i, uint N) { return vec2(float(i)/float(N), RadicalInverse_VdC(i)); }</span></span></code> </pre><br>  The <i>Hammersley ()</i> function returns the i-th element of the low mismatch sequence from a set of size samples <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-740"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> N </script>  . <br><blockquote>  Not all OpenGL drivers support bitwise operations (WebGL and OpenGL ES 2.0, for example), so some environments might require an alternative implementation of their use: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VanDerCorpus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">base</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> invBase = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> denom = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> result = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> i = <span class="hljs-number"><span class="hljs-number">0u</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">32u</span></span>; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n &gt; <span class="hljs-number"><span class="hljs-number">0u</span></span>) { denom = mod(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(n), <span class="hljs-number"><span class="hljs-number">2.0</span></span>); result += denom * invBase; invBase = invBase / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; n = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(n) / <span class="hljs-number"><span class="hljs-number">2.0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-comment"><span class="hljs-comment">// ---------------------------------------------------------------------------- vec2 HammersleyNoBitOps(uint i, uint N) { return vec2(float(i)/float(N), VanDerCorpus(i, 2u)); }</span></span></code> </pre> <br>  I note that due to certain restrictions on the loop operators in the old hardware, this implementation runs through all 32 bits.  As a result, this version is not as productive as the first option - but it works on any hardware and even in the absence of bit operations. </blockquote><br><h4>  Sampling by importance in the GGX model </h4><br>  Instead of a uniform or random (Monte Carlo) distribution of the generated sample vectors within the hemisphere <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-742"><span class="MJXp-mtext" id="MJXp-Span-743">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-745">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-746">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> \ Omega </script>  , appearing in the integral we are solving, we will try to create vectors so that they reflect the main direction of reflection of light, characterized by a median vector of microsurfaces and depending on the surface roughness.  The sampling process itself will be similar to the previously considered one: open a cycle with a sufficiently large number of iterations, create an element of the low discrepancy sequence, use it to create a sampling vector in tangent space, transfer this vector to world coordinates and use it to sample the scene's energy brightness.  In principle, the changes relate only to the fact that the element of the sequence of low discrepancies is now used to define the new sampling vector: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uint SAMPLE_COUNT = <span class="hljs-number"><span class="hljs-number">4096u</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint i = <span class="hljs-number"><span class="hljs-number">0u</span></span>; i &lt; SAMPLE_COUNT; ++i) { vec2 Xi = Hammersley(i, SAMPLE_COUNT);</code> </pre><br>  In addition, for the complete formation of the sample vector, it will be necessary in some way to orient it in the direction of the mirror petal corresponding to a given level of roughness.  You can take the NDF (normal distribution function) from the <a href="https://habr.com/post/426123/">lesson</a> devoted to the theory and combine with the GGX NDF for the method of defining the vector of the sample in the field sponsored by Epic Games: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">vec3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImportanceSampleGGX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec2 Xi, vec3 N, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = roughness*roughness; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> phi = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * PI * Xi.x; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cosTheta = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>((<span class="hljs-number"><span class="hljs-number">1.0</span></span> - Xi.y) / (<span class="hljs-number"><span class="hljs-number">1.0</span></span> + (a*a - <span class="hljs-number"><span class="hljs-number">1.0</span></span>) * Xi.y)); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sinTheta = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - cosTheta*cosTheta); <span class="hljs-comment"><span class="hljs-comment">//       vec3 H; Hx = cos(phi) * sinTheta; Hy = sin(phi) * sinTheta; Hz = cosTheta; //        vec3 up = abs(Nz) &lt; 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0); vec3 tangent = normalize(cross(up, N)); vec3 bitangent = cross(N, tangent); vec3 sampleVec = tangent * Hx + bitangent * Hy + N * Hz; return normalize(sampleVec); }</span></span></code> </pre><br>  The result is a sample vector, approximately oriented along the median vector of microsurfaces, for a given roughness and element of the sequence of low mismatch <i>Xi</i> .  Note that Epic Games uses the square of the roughness value for greater visual quality, which is based on Disney‚Äôs original work on the PBR method. <br><br>  After completing the implementation of the Hammersley sequence and the sample vector generation code, we can quote the prefilter and convolution shader code: <br><br><pre> <code class="hljs mel">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core out vec4 FragColor; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 localPos; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> samplerCube environmentMap; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness; const <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159265359</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RadicalInverse_VdC(uint bits); vec2 Hammersley(uint i, uint N); vec3 ImportanceSampleGGX(vec2 Xi, vec3 N, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness); void main() { vec3 N = <span class="hljs-keyword"><span class="hljs-keyword">normalize</span></span>(localPos); vec3 R = N; vec3 V = R; const uint SAMPLE_COUNT = <span class="hljs-number"><span class="hljs-number">1024</span></span>u; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> totalWeight = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; vec3 prefilteredColor = vec3(<span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint i = <span class="hljs-number"><span class="hljs-number">0</span></span>u; i &lt; SAMPLE_COUNT; ++i) { vec2 Xi = Hammersley(i, SAMPLE_COUNT); vec3 H = ImportanceSampleGGX(Xi, N, roughness); vec3 L = <span class="hljs-keyword"><span class="hljs-keyword">normalize</span></span>(<span class="hljs-number"><span class="hljs-number">2.0</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(V, H) * H - V); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotL = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(N, L), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(NdotL &gt; <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { prefilteredColor += texture(environmentMap, L).rgb * NdotL; totalWeight += NdotL; } } prefilteredColor = prefilteredColor / totalWeight; FragColor = vec4(prefilteredColor, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); }</code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We pre-filter the environment map based on some specified roughness, the level of which varies for each mip level of the resulting cubic map (from 0.0 to 1.0), and the result of the filter is stored in the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prefilteredColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Further, the variable is divided by the total weight for the entire sample, and samples with a smaller contribution to the final result (having a smaller </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NdotL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">) also increase the final weight less.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preservation of pre-filtering data in mip levels </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It remains to write the code directly instructing OpenGL to filter the environment map with different levels of roughness and then save the results in a series of mip levels of the target cubic map. Here, the code already prepared from the lesson on the calculation of the </font></font><a href="https://habr.com/post/426987/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">irradiance</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> map will come in handy </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cpp hljs">prefilterShader.use(); prefilterShader.setInt(<span class="hljs-string"><span class="hljs-string">"environmentMap"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); prefilterShader.setMat4(<span class="hljs-string"><span class="hljs-string">"projection"</span></span>, captureProjection); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxMipLevels = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mip = <span class="hljs-number"><span class="hljs-number">0</span></span>; mip &lt; maxMipLevels; ++mip) { <span class="hljs-comment"><span class="hljs-comment">//        - unsigned int mipWidth = 128 * std::pow(0.5, mip); unsigned int mipHeight = 128 * std::pow(0.5, mip); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, mipWidth, mipHeight); glViewport(0, 0, mipWidth, mipHeight); float roughness = (float)mip / (float)(maxMipLevels - 1); prefilterShader.setFloat("roughness", roughness); for (unsigned int i = 0; i &lt; 6; ++i) { prefilterShader.setMat4("view", captureViews[i]); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, prefilterMap, mip); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); renderCube(); } } glBindFramebuffer(GL_FRAMEBUFFER, 0);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The process is similar to the convolution of the irradiance map, but this time it is necessary at each step to clarify the size of the frame buffer, reducing it twice to match the mip levels. </font><font style="vertical-align: inherit;">Also, the mip level to which the render will be conducted at the moment must be specified as a parameter of the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">glFramebufferTexture2D ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The result of the execution of this code should be a cubic map containing more and more blurred images of reflections on each subsequent mip level. </font><font style="vertical-align: inherit;">You can use such a cubic map as a data source for a skybox and take a sample from any mip level to below zero:</font></font><br><br><pre> <code class="cpp hljs">vec3 envColor = textureLod(environmentMap, WorldPos, <span class="hljs-number"><span class="hljs-number">1.2</span></span>).rgb;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The result of this action will be the following picture: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f7/la/6t/f7la6ts6ewslfr8fg2kfvtdzuly.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Looks like a very blurred source environment map. </font><font style="vertical-align: inherit;">If you have a similar result, then, most likely, the process of pre-filtering the HDR environment map is correct. </font><font style="vertical-align: inherit;">Try experimenting with a selection of different mip levels and observe a gradual increase in blurring with each level.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prefilter convolution artifacts </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For most tasks, the described approach works quite well, but sooner or later you will have to meet with various artifacts that the pre-filtering process generates. </font><font style="vertical-align: inherit;">Here are the most common and methods of dealing with them.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The manifestation of the seams of the cubic card </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sampling values ‚Äã‚Äãfrom a pre-filtered cubic map for surfaces with high roughness leads to reading data from the mip level somewhere near the end of their chain. </font><font style="vertical-align: inherit;">When sampling from a cube map, OpenGL does not, by default, perform linear interpolation between the faces of a cube map. </font><font style="vertical-align: inherit;">Since high mip-levels have a lower resolution, and the environment map has been convolved, taking into account the very large mirror lobe, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lack of texture filtering between the faces</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> becomes obvious:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mh/dk/dq/mhdkdq1uolf6wc2lzhhrtxxghsy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fortunately, OpenGL has the ability to activate such filtering with a simple flag: </font></font><br><br><pre> <code class="cpp hljs">glEnable(GL_TEXTURE_CUBE_MAP_SEAMLESS);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is enough to set the flag somewhere in the application initialization code and this artifact is over. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The appearance of bright spots </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the specular reflections in general contain high-frequency details, as well as areas with very different brightness, their convolution requires the use of a large number of sample points to correctly take into account the large scatter of values ‚Äã‚Äãwithin the HDR reflections from the environment. In the example, we already take a sufficiently large number of samples, but for certain scenes and high levels of roughness of the material, this still will not be enough, and you will witness the appearance of many spots around bright areas:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/av/eu/1eaveuoooowy4vsfibkyw_bwqos.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can continue to increase the number of samples, but it will not be a universal solution and in some conditions it will still allow an artifact. </font><font style="vertical-align: inherit;">But you can refer to the method </font></font><a href="https://chetanjags.wordpress.com/2015/08/26/image-based-lighting/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chetan Jags</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which allows to reduce the manifestation of the artifact. </font><font style="vertical-align: inherit;">To do this, at the preliminary convolution stage, the sample from the environment map should not be directly taken, but from one of its mip levels, based on the value obtained from the probability distribution function of the integrand expression and roughness:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> D = DistributionGGX(NdotH, roughness); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pdf = (D * NdotH / (<span class="hljs-number"><span class="hljs-number">4.0</span></span> * HdotV)) + <span class="hljs-number"><span class="hljs-number">0.0001</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        float resolution = 512.0; float saTexel = 4.0 * PI / (6.0 * resolution * resolution); float saSample = 1.0 / (float(SAMPLE_COUNT) * pdf + 0.0001); float mipLevel = roughness == 0.0 ? 0.0 : 0.5 * log2(saSample / saTexel);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Just do not forget to enable trilinear filtering for the environment map in order to successfully sample from mip levels: </font></font><br><br><pre> <code class="cpp hljs">glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Also, do not forget to create the texture mip levels directly using OpenGL, but only after the main mip level is fully formed: </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  HDR      ... [...] //  - glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); glGenerateMipmap(GL_TEXTURE_CUBE_MAP);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This method works surprisingly well, removing almost all (and often all) spots on the filtered map, even at high levels of roughness. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preliminary calculation of BRDF </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we have successfully processed the environment map with a filter and now we can concentrate on the second part of the approximation in the form of a separate amount, which is BRDF. </font><font style="vertical-align: inherit;">To refresh your memory, look again at the complete record of the approximate solution:</font></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-749"><span class="MJXp-msubsup" id="MJXp-Span-750"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-752" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-753" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-755" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-756"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-758" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-759" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="MJXp-mo" id="MJXp-Span-760" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-munderover" id="MJXp-Span-761"><span class=""><span class="MJXp-mo" id="MJXp-Span-762" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-763" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-764"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ©</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-765"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-767" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-768" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-770" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-772" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-773" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-774" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-777" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-778" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-779" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font></font></span><span class="MJXp-munderover" id="MJXp-Span-780"><span class=""><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-782" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-783"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ©</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-786" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-787" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-788"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-790"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-792" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-793" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-795" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-796" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-797" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-798"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-799" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-800"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-801" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-802" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-806" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-34">L_o(p,\omega_o) = \int\limits_{\Omega} L_i(p,\omega_i) d\omega_i * \int\limits_{\Omega} f_r(p, \omega_i, \omega_o) n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We preliminarily calculated the left part of the sum and wrote the results for different levels of roughness into a separate cubic map. </font><font style="vertical-align: inherit;">The right side will require convolving the BDRF expression together with the following parameters: angle</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-808"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-809" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-811" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-812" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , surface roughness and Fresnel coefficient</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35">n \cdot \omega_i</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-813"><span class="MJXp-msubsup" id="MJXp-Span-814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-816" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36">F_0</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A process similar to the integration of a mirrored BRDF for a completely white environment or with constant energy brightness </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-817"><span class="MJXp-msubsup" id="MJXp-Span-818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-819" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-820" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-821" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mn" id="MJXp-Span-822"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.0</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37">L_i = 1.0</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BRDF convolution for three variables is not a trivial task, but in this case </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-823"><span class="MJXp-msubsup" id="MJXp-Span-824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-826" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be derived from an expression describing a BRDF mirror:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38">F_0</script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-827"><span class="MJXp-munderover" id="MJXp-Span-828"><span class=""><span class="MJXp-mo" id="MJXp-Span-829" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-830" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-831"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ©</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-833" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-834" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-835" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-837" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-838"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-839" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-840" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-841" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-842"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-844" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-845" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-846"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-847" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-848"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-850" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-852"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-853" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-854" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><span class="MJXp-munderover" id="MJXp-Span-856"><span class=""><span class="MJXp-mo" id="MJXp-Span-857" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-858" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-859"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ©</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-860"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-861" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-862" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-863" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-866"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-867" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-868" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-869" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-870"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-872" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-873" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mfrac" id="MJXp-Span-874" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> F </font></font></span><span class="MJXp-mo" id="MJXp-Span-876" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-877"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-879" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-884" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-887" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-888" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-890" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n</font></font></span><span class="MJXp-mo" id="MJXp-Span-892" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-895" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-896"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-899" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-39">\int\limits_{\Omega} f_r(p, \omega_i, \omega_o) n \cdot \omega_i d\omega_i = \int\limits_{\Omega} f_r(p, \omega_i, \omega_o) \frac{F(\omega_o, h)}{F(\omega_o, h)} n \cdot \omega_i d\omega_i</script></p><br>  Here <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-901"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a function describing the calculation of the Fresnel kit. </font><font style="vertical-align: inherit;">By moving the divisor to the expression for BRDF, you can go to the following equivalent entry:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> F </script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-902"><span class="MJXp-munderover" id="MJXp-Span-903"><span class=""><span class="MJXp-mo" id="MJXp-Span-904" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-905" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-906"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ© </font></font></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-907" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-908"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-910" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-911" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-912"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-913" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-915" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-916" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-917" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-918"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-919" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-920" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-921" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-922"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-923" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-924"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-925" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-926" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-927" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-929" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> F</font></font></span><span class="MJXp-mo" id="MJXp-Span-931" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-932"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-933" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-934" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></span><span class="MJXp-mo" id="MJXp-Span-937" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-939" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-940"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-941" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-942" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-944"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-946" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-41">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} F(\omega_o, h) n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Replacing the right entry </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the Fresnel-Schlick approximation, we get:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> F </script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-949"><span class="MJXp-munderover" id="MJXp-Span-950"><span class=""><span class="MJXp-mo" id="MJXp-Span-951" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-952" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-953"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ© </font></font></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-954" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-955"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-956" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-957" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-958" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-959"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-960" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-961"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-962" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-963" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-964" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-966" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-967" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-968" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-969"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-970" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-971"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-972" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-973" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-974" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-976" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-977" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-979" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-980" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-981" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></span><span class="MJXp-mo" id="MJXp-Span-982" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mn" id="MJXp-Span-983"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span><span class="MJXp-mo" id="MJXp-Span-984" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-985"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-987" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-988" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-989"><span class="MJXp-mrow" id="MJXp-Span-990" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-991" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mn" id="MJXp-Span-992"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span><span class="MJXp-mo" id="MJXp-Span-993" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-996" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-997" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h</font></font></span><span class="MJXp-mo" id="MJXp-Span-999" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1000" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1001" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1002"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-1003" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1006" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1007"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1008"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1009" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1010" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-43">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (F_0 + (1 - F_0){(1 - \omega_o \cdot h)}^5) n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Denote the expression </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1011"><span class="MJXp-msubsup" id="MJXp-Span-1012"><span class="MJXp-mrow" id="MJXp-Span-1013" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1014" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mn" id="MJXp-Span-1015"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-1016" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1017"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1018" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1019" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1020" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚ãÖ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-1022" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1023" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44">{(1 - \omega_o \cdot h)}^5</script>  as <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1024"><span class="MJXp-mrow" id="MJXp-Span-1025"><span class="MJXp-mo" id="MJXp-Span-1026" style="margin-left: 0.111em; margin-right: 0.111em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1028"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1029"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1031"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to simplify the decision regarding</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45">/alpha</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1032"><span class="MJXp-msubsup" id="MJXp-Span-1033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1035" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46">F_0</script>  : <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1036"><span class="MJXp-munderover" id="MJXp-Span-1037"><span class=""><span class="MJXp-mo" id="MJXp-Span-1038" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int">‚à´</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1039" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1040">Œ©</span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1041" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1043" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1044" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1045" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046">p</span><span class="MJXp-mo" id="MJXp-Span-1047" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1048"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1049" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1050" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1051" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1052"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1053" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1054" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1055" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1056">F</span><span class="MJXp-mo" id="MJXp-Span-1057" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1058"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1059" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1060" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1061" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1062">h</span><span class="MJXp-mo" id="MJXp-Span-1063" style="margin-left: 0em; margin-right: 0em;">)</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1064" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1065"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1066" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1067" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1068" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1069" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1070">1</span><span class="MJXp-mo" id="MJXp-Span-1071" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-1072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1074" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1075" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076">Œ±</span><span class="MJXp-mo" id="MJXp-Span-1077" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1078">n</span><span class="MJXp-mo" id="MJXp-Span-1079" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-msubsup" id="MJXp-Span-1080"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1082" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1083">d</span><span class="MJXp-msubsup" id="MJXp-Span-1084"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1085" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1086" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-47">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (F_0 + (1 - F_0)\alpha) n \cdot \omega_i d\omega_i</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1087"><span class="MJXp-munderover" id="MJXp-Span-1088"><span class=""><span class="MJXp-mo" id="MJXp-Span-1089" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int">‚à´</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1090" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1091">Œ©</span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1092" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1093"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1095" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1096" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1097">p</span><span class="MJXp-mo" id="MJXp-Span-1098" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1099"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1101" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1102" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1104" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1105" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1106" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1107">F</span><span class="MJXp-mo" id="MJXp-Span-1108" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1111" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1112" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1113">h</span><span class="MJXp-mo" id="MJXp-Span-1114" style="margin-left: 0em; margin-right: 0em;">)</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1115" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1116"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1117" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1118" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1119" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-1120">1</span><span class="MJXp-mo" id="MJXp-Span-1121" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">Œ±</span><span class="MJXp-mo" id="MJXp-Span-1123" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-1124"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1125" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1126" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-1127" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1128">Œ±</span><span class="MJXp-mo" id="MJXp-Span-1129" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130">n</span><span class="MJXp-mo" id="MJXp-Span-1131" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-msubsup" id="MJXp-Span-1132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1134" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">d</span><span class="MJXp-msubsup" id="MJXp-Span-1136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1138" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-48">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (F_0 + 1*\alpha - F_0*\alpha) n \cdot \omega_i d\omega_i</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1139"><span class="MJXp-munderover" id="MJXp-Span-1140"><span class=""><span class="MJXp-mo" id="MJXp-Span-1141" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int">‚à´</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1142" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1143">Œ©</span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1144" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1146" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1147" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1148" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1149">p</span><span class="MJXp-mo" id="MJXp-Span-1150" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1151"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1152" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1153" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1154" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1156" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1157" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1158" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-1160" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1162" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1163" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1164" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1165"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-1166" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1167" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1169" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1170" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1171" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó</font></font></span><span class="MJXp-mo" id="MJXp-Span-1172" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mn" id="MJXp-Span-1173"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span><span class="MJXp-mo" id="MJXp-Span-1174" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ±</font></font></span><span class="MJXp-mo" id="MJXp-Span-1176" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mo" id="MJXp-Span-1177" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ±</font></font></span><span class="MJXp-mo" id="MJXp-Span-1179" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-1181" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1182"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1183" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1184" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1185"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1188" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-49">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (F_0 * (1 - \alpha) + \alpha) n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Further function </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1190"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we divide into two integrals:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> F </script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1191"><span class="MJXp-munderover" id="MJXp-Span-1192"><span class=""><span class="MJXp-mo" id="MJXp-Span-1193" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´ </font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1194" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1195"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ© </font></font></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1196" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1199" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1200" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1201"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-1202" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1205" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1206" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1208" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1209" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1210" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-1212" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1214" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1215" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1216" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1217"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-1218" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1219" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1220"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1222" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1223" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó</font></font></span><span class="MJXp-mo" id="MJXp-Span-1224" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mn" id="MJXp-Span-1225"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span><span class="MJXp-mo" id="MJXp-Span-1226" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1227"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ±</font></font></span><span class="MJXp-mo" id="MJXp-Span-1228" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mo" id="MJXp-Span-1229" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1230"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-1231" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1233" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1234" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1235"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1236"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1237" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1238" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1239" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+</font></font></span><span class="MJXp-munderover" id="MJXp-Span-1240"><span class=""><span class="MJXp-mo" id="MJXp-Span-1241" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚à´</font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1242" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1243"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ©</font></font></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-1244" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1246" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1247" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1248" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1249"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-1250" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1252" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1253" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1254" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1256" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1257" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1258" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-1260" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1262" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1263" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1264" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1265"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-1266" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1267" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1268"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ±</font></font></span><span class="MJXp-mo" id="MJXp-Span-1269" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1270"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span><span class="MJXp-mo" id="MJXp-Span-1271" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1272"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1273" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1274" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1277" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1278" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-51">\int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (F_0 * (1 - \alpha)) n \cdot \omega_i d\omega_i + \int\limits_{\Omega} \frac{f_r(p, \omega_i, \omega_o)}{F(\omega_o, h)} (\alpha) n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this way </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1279"><span class="MJXp-msubsup" id="MJXp-Span-1280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1282" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will be constant under the integral, and we can take it beyond the integral sign. </font><font style="vertical-align: inherit;">Next, we will reveal</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52">F_0</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1283"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1284"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ±</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the original expression and get the final entry for BRDF as a split amount:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53">\alpha</script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1285"><span class="MJXp-msubsup" id="MJXp-Span-1286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1287" style="margin-right: 0.05em;">F</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1288" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-munderover" id="MJXp-Span-1289"><span class=""><span class="MJXp-mo" id="MJXp-Span-1290" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int">‚à´</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1291" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1292">Œ©</span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1293"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1294" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1295" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1296" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297">p</span><span class="MJXp-mo" id="MJXp-Span-1298" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1301" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1302" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1304" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1305" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1306" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-1307" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1308">1</span><span class="MJXp-mo" id="MJXp-Span-1309" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-1310"><span class="MJXp-mrow" id="MJXp-Span-1311" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1312" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1313">1</span><span class="MJXp-mo" id="MJXp-Span-1314" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-1315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1316" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1317" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1318" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1319">h</span><span class="MJXp-mo" id="MJXp-Span-1320" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1321" style="vertical-align: 0.5em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-1322" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1323">n</span><span class="MJXp-mo" id="MJXp-Span-1324" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-msubsup" id="MJXp-Span-1325"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1326" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1327" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1328">d</span><span class="MJXp-msubsup" id="MJXp-Span-1329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1330" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1331" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1332" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-munderover" id="MJXp-Span-1333"><span class=""><span class="MJXp-mo" id="MJXp-Span-1334" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int">‚à´</span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-1335" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-1336">Œ©</span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1338" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1339" style="vertical-align: -0.4em;">r</span></span><span class="MJXp-mo" id="MJXp-Span-1340" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1341">p</span><span class="MJXp-mo" id="MJXp-Span-1342" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1343"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1344" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1345" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-1346" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1347"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1348" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1349" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1350" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-1351"><span class="MJXp-mrow" id="MJXp-Span-1352" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-1353" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1354">1</span><span class="MJXp-mo" id="MJXp-Span-1355" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-1356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1357" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1358" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mo" id="MJXp-Span-1359" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1360">h</span><span class="MJXp-mo" id="MJXp-Span-1361" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1362" style="vertical-align: 0.5em;">5</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1363">n</span><span class="MJXp-mo" id="MJXp-Span-1364" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-msubsup" id="MJXp-Span-1365"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1366" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1367" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1368">d</span><span class="MJXp-msubsup" id="MJXp-Span-1369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1370" style="margin-right: 0.05em;">œâ</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1371" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-54">F_0 \int\limits_{\Omega} f_r(p, \omega_i, \omega_o)(1 - {(1 - \omega_o \cdot h)}^5) n \cdot \omega_i d\omega_i + \int\limits_{\Omega} f_r(p, \omega_i, \omega_o) {(1 - \omega_o \cdot h)}^5 n \cdot \omega_i d\omega_i</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The resulting two integrals represent the scale and offset for the value </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1372"><span class="MJXp-msubsup" id="MJXp-Span-1373"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1374" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1375" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55">F_0</script>  respectively.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Notice that </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1376"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1377"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f </font></font></span><span class="MJXp-mo" id="MJXp-Span-1378" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1379"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-1380" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1381"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1382" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1383" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1384" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1385"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1386" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1387" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-1388" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contains the occurrence</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56">f(p, \omega_i, \omega_o)</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1389"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1390"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , therefore these occurrences cancel each other out and disappear from the expression. </font><font style="vertical-align: inherit;">Using the already developed approach, we can carry out the BRDF convolution together with the input data: roughness and angle between vectors</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> F </script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1391"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1392"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-58-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-58">n</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1393"><span class="MJXp-msubsup" id="MJXp-Span-1394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1396" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-59">w_o</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Write the result in the 2D texture - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">card complexation BRDF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BRDF integration map</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), which will serve as an auxiliary table values for use in the final shader, which will form the final result of the indirect specular lighting. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The BRDF convolution shader works on a plane, directly using two-dimensional texture coordinates as inputs to the convolution process ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NdotV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">roughness</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). The code is noticeably similar to the convolution convolution, but here the sample vector is processed taking into account the BRDF geometric function and the Fresnel-Schlick approximation expression:</font></font><br><br><pre> <code class="hljs mel">vec2 IntegrateBRDF(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotV, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness) { vec3 V; Vx = <span class="hljs-keyword"><span class="hljs-keyword">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - NdotV*NdotV); Vy = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; Vz = NdotV; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> A = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> B = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; vec3 N = vec3(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); const uint SAMPLE_COUNT = <span class="hljs-number"><span class="hljs-number">1024</span></span>u; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint i = <span class="hljs-number"><span class="hljs-number">0</span></span>u; i &lt; SAMPLE_COUNT; ++i) { vec2 Xi = Hammersley(i, SAMPLE_COUNT); vec3 H = ImportanceSampleGGX(Xi, N, roughness); vec3 L = <span class="hljs-keyword"><span class="hljs-keyword">normalize</span></span>(<span class="hljs-number"><span class="hljs-number">2.0</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(V, H) * H - V); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotL = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(Lz, <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotH = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(Hz, <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> VdotH = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">dot</span></span>(V, H), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(NdotL &gt; <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> G = GeometrySmith(N, V, L, roughness); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> G_Vis = (G * VdotH) / (NdotH * NdotV); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Fc = <span class="hljs-keyword"><span class="hljs-keyword">pow</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - VdotH, <span class="hljs-number"><span class="hljs-number">5.0</span></span>); A += (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - Fc) * G_Vis; B += Fc * G_Vis; } } A /= <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(SAMPLE_COUNT); B /= <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(SAMPLE_COUNT); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vec2(A, B); } <span class="hljs-comment"><span class="hljs-comment">// ---------------------------------------------------------------------------- void main() { vec2 integratedBRDF = IntegrateBRDF(TexCoords.x, TexCoords.y); FragColor = integratedBRDF; }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As can be seen, the BRDF convolution is implemented in the form of a practically literal arrangement of the above mathematical calculations. </font><font style="vertical-align: inherit;">Take the input parameters of roughness and angle</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1397"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1398"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ∏</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the sample vector is generated based on a sample of significance, processed using the geometry function and the converted Fresnel expression for BRDF. </font><font style="vertical-align: inherit;">As a result, for each sample, we obtain the magnitude of the scaling and offset values</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-60-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-60">\theta</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1399"><span class="MJXp-msubsup" id="MJXp-Span-1400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1402" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which at the end are averaged and returned as</font><i><font style="vertical-align: inherit;">vec2</font></i><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the</font><a href="https://habr.com/post/426123/"><font style="vertical-align: inherit;">theoretical</font></a><font style="vertical-align: inherit;">lesson it was mentioned that the geometric component of BRDF is slightly different in the case of calculating IBL, since the coefficient</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-61-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-61">F_0</script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="https://habr.com/post/426123/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1403"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1404"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is set differently:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-62-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-62"> k </script><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1405"><span class="MJXp-msubsup" id="MJXp-Span-1406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1407" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1408" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1409"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1410"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1411"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1413"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1415" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mfrac" id="MJXp-Span-1416" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mo" id="MJXp-Span-1417" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1418"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ± </font></font></span><span class="MJXp-mo" id="MJXp-Span-1419" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><span class="MJXp-mn" id="MJXp-Span-1420"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-1421"><span class="MJXp-mo" id="MJXp-Span-1422" style="margin-left: 0em; margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1423" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-1424"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eight</font></font></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-63-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-63">k_{direct} = \frac{(\alpha + 1)^2}{8}</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1425"><span class="MJXp-msubsup" id="MJXp-Span-1426"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1427" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1428" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1429"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1430"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1431"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-1432" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-mfrac" id="MJXp-Span-1433" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-msubsup" id="MJXp-Span-1434"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1435" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ± </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1436" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-1437"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-64-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-64">k_{IBL} = \frac{\alpha^2}{2}</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since the BRDF convolution is part of the solution of the integral in the case of calculating IBL, we will use the coefficient </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1438"><span class="MJXp-msubsup" id="MJXp-Span-1439"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1440" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1441" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1442"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1443"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1444"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to calculate the geometry function in the Schlick-GGX model:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-65-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-65">k_{IBL}</script><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">float</span></span> GeometrySchlickGGX(<span class="hljs-built_in"><span class="hljs-built_in">float</span></span> NdotV, <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> roughness) { <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> a = roughness; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> k = (a * a) / 2.0; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> nom = NdotV; <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> denom = NdotV * (1.0 - k) + k; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> nom / denom; } // ---------------------------------------------------------------------------- <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> GeometrySmith(vec3 N, vec3 V, vec3 L, <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> roughness) { <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> NdotV = max(dot(N, V), 0.0); <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> NdotL = max(dot(N, L), 0.0); <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ggx2 = GeometrySchlickGGX(NdotV, roughness); <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> ggx1 = GeometrySchlickGGX(NdotL, roughness); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> ggx1 * ggx2; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Note that the coefficient </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1446"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k is</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> calculated based on the parameter</font><i><font style="vertical-align: inherit;">a</font></i><font style="vertical-align: inherit;">. In this case, the</font><i><font style="vertical-align: inherit;">roughness</font></i><font style="vertical-align: inherit;">parameter is</font><font style="vertical-align: inherit;">not squared when describing the parameter</font><i><font style="vertical-align: inherit;">a</font></i><font style="vertical-align: inherit;">, which was done in other places where this parameter was applied. Not sure where the problem lies here: the Epic Games or in the original work by Disney, but it is worth saying that it is a direct assignment of the value of</font><i><font style="vertical-align: inherit;">roughness</font></i><font style="vertical-align: inherit;">parameter</font><i><font style="vertical-align: inherit;">a</font></i><font style="vertical-align: inherit;">leads to the creation of maps integration BRDF identical, presented in the publication of Epic Games.</font><font style="vertical-align: inherit;">Further, the preservation of the BRDF convolution results will be provided in the form of a 2D texture of size 512x512:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-66-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-66"> k </script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> brdfLUTTexture; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;brdfLUTTexture); <span class="hljs-comment"><span class="hljs-comment">//   ,     glBindTexture(GL_TEXTURE_2D, brdfLUTTexture); glTexImage2D(GL_TEXTURE_2D, 0, GL_RG16F, 512, 512, 0, GL_RG, GL_FLOAT, 0); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As recommended by Epic Games, the 16-bit floating point format is used here. </font><font style="vertical-align: inherit;">Be sure to set the repeat mode to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GL_CLAMP_TO_EDGE to</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avoid sampling artifacts from the edge. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, we use the same frame buffer object and execute the shader on the full-screen quad surface:</font></font><br><br><pre> <code class="cpp hljs">glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, <span class="hljs-number"><span class="hljs-number">512</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, brdfLUTTexture, <span class="hljs-number"><span class="hljs-number">0</span></span>); glViewport(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>); brdfShader.use(); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); RenderQuad(); glBindFramebuffer(GL_FRAMEBUFFER, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As a result, we obtain a texture map that stores the result of the convolution of the part of the expression for the separate amount responsible for BRDF: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5s/so/fw/5ssofwhkncncu263tegajwxm15k.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Having on hand the results of the preliminary filtering of the environment map and the texture with the results of the BRDF convolution, we will be able to restore the result of calculating the integral for indirect specular illumination based on approximation by a separate sum. </font><font style="vertical-align: inherit;">The recovered value will subsequently be used as indirect or background specular radiation.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The final calculation of reflectivity in the IBL model </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, to get the value that describes the indirect mirror component in the general expression of reflectivity, it is necessary to ‚Äúglue‚Äù the calculated approximation components into a single whole by a separate sum. </font><font style="vertical-align: inherit;">First, add the appropriate samplers for the pre-calculated data to the final shader:</font></font><br><br><pre> <code class="cpp hljs">uniform samplerCube prefilterMap; uniform sampler2D brdfLUT;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, we obtain the value of indirect mirror reflection on the surface by sampling from a previously processed environment map based on the reflection vector. </font><font style="vertical-align: inherit;">Note that here the selection of the mip level for sampling is based on the surface roughness. </font><font style="vertical-align: inherit;">For rougher surfaces, the reflection will be </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more blurred</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { [...] vec3 R = reflect(-V, N); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> MAX_REFLECTION_LOD = <span class="hljs-number"><span class="hljs-number">4.0</span></span>; vec3 prefilteredColor = textureLod(prefilterMap, R, roughness * MAX_REFLECTION_LOD).rgb; [...] }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the preliminary convolution stage, we prepared only 5 mip levels (from zero to fourth); the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAX_REFLECTION_LOD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constant </font><font style="vertical-align: inherit;">serves to limit the sample of the generated mip levels. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, we make a sample of the BRDF integration map based on the roughness and angle between the normal and the direction of gaze:</font></font><br><br><pre> <code class="cpp hljs">vec3 F = FresnelSchlickRoughness(max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), F0, roughness); vec2 envBRDF = texture(brdfLUT, vec2(max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), roughness)).rg; vec3 specular = prefilteredColor * (F * envBRDF.x + envBRDF.y);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The value obtained from the map contains the scaling and offset factors for the value </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1447"><span class="MJXp-msubsup" id="MJXp-Span-1448"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1449" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1450" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (here the value</font><i><font style="vertical-align: inherit;">F</font></i><font style="vertical-align: inherit;">is</font><font style="vertical-align: inherit;">taken</font><font style="vertical-align: inherit;">- Fresnel coefficient). The converted value</font><i><font style="vertical-align: inherit;">F is</font></i><font style="vertical-align: inherit;">then combined with the value obtained from the pre-filtering map to obtain an approximate solution to the original integral expression ‚Äî</font><i><font style="vertical-align: inherit;">specular</font></i><font style="vertical-align: inherit;">.</font><font style="vertical-align: inherit;">In this way, we get a solution for the part of the reflectivity that is responsible for the specular reflection. To obtain a complete solution of the PBR IBL model, it is necessary to combine this value with the solution for the diffuse part of the reflectivity we received in the</font><a href="https://habr.com/post/426987/"><font style="vertical-align: inherit;">last</font></a><font style="vertical-align: inherit;">lesson:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-67-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-67">F_0</script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="https://habr.com/post/426987/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs">vec3 F = FresnelSchlickRoughness(max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), F0, roughness); vec3 kS = F; vec3 kD = <span class="hljs-number"><span class="hljs-number">1.0</span></span> - kS; kD *= <span class="hljs-number"><span class="hljs-number">1.0</span></span> - metallic; vec3 irradiance = texture(irradianceMap, N).rgb; vec3 diffuse = irradiance * albedo; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> MAX_REFLECTION_LOD = <span class="hljs-number"><span class="hljs-number">4.0</span></span>; vec3 prefilteredColor = textureLod(prefilterMap, R, roughness * MAX_REFLECTION_LOD).rgb; vec2 envBRDF = texture(brdfLUT, vec2(max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), roughness)).rg; vec3 specular = prefilteredColor * (F * envBRDF.x + envBRDF.y); vec3 ambient = (kD * diffuse + specular) * ao;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I note that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specular</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value </font><font style="vertical-align: inherit;">does not multiply by </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since it already contains the Fresnel coefficient. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let us launch our test application with a familiar set of spheres with varying metallicity and roughness characteristics and take a look at their appearance in full magnificence of PBR:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eb/wi/sm/ebwismvfoqyrfymot9i4ab1jtp0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can go even further and download a set of textures corresponding to the PBR model and get the spheres from </font></font><a href="http://freepbr.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">real materials</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dn/0c/0c/dn0c0ctjrjf1o3uzwl7b0eyinwm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Or even download a smart model along with </font></font><a href="http://artisaverb.info/PBT.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrew Maximov‚Äôs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prepared PBR textures </font><font style="vertical-align: inherit;">:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/op/x7/22/opx722vdxpwml-woff07gtfn1rc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I think that no one should be particularly convinced that the current lighting model looks much more convincing. Moreover, the lighting looks physically correct, regardless of the environment map. Below are used several completely different HDR environment maps that completely change the nature of the lighting - but all the images look physically reliable, despite the fact that no parameters were needed in the model! (In principle, this simplification of work with materials is the main plus of the PBR pipeline, and a better picture can be said to be a pleasant consequence. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Approx. Per.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/76/wa/yd/76waydpu8cbudb6igel20llh3ig.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phew, our journey into the essence of the PBR render came out pretty voluminous. We went through the whole series of short steps to the result and, of course, a lot can go wrong with the first approaches. Therefore, in case of any problems, I advise you to carefully understand the code of examples for </font></font><a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/2.2.1.ibl_specular/ibl_specular.cpp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">monochrome</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/2.2.2.ibl_specular_textured/ibl_specular_textured.cpp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texturized</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spheres (and the shader code, of course!). Or ask for advice in the comments.</font></font><br><br><h2>  What's next? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope that by reading these lines you have already made out for yourself an understanding of the work of the PBR model of the render, and also figured out and successfully launched a test application. In these lessons, all the necessary auxiliary texture maps for the PBR model were calculated in our application in advance, before the main render cycle. For learning tasks, this approach is suitable, but not for practical use. First, such preliminary preparation should occur once, and not every application launch. Secondly, if you decide to add some more environment maps, they will also have to be processed at startup. And if some more cards are added? This snowball.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is why, in general, the irradiance map and the pre-processed environment map are prepared once and then saved on disk (the BRDF integration map does not depend on the environment map, so that it can be calculated or loaded once). It follows that you will need a format for storing HDR cubic cards, including their mip levels. Well, or you can store and load them using one of the widespread formats (this way </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.dds</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> supports saving mip levels).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another important point: in order to give a deep understanding of the PBR pipeline in these lessons, I gave a description of the full process of preparing for the PBR renderer, including preliminary calculations of auxiliary cards for IBL. However, in your practice, you might as well use one of the great utilities that will prepare these cards for you: for example, </font></font><a href="https://github.com/dariomanesku/cmftStudio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmftStudio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><a href="https://github.com/derkreature/IBLBaker"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IBLBaker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We also did not consider the process of preparing cubic </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reflection reflection samples</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reflection probes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and the associated processes of interpolation of cubic maps and parallax correction. Briefly, this technique can be described as follows: we place in our scene a set of objects of reflection samples, which form a local environment picture in the form of a cubic map, and then on the basis of it all the necessary auxiliary maps for the IBL model are formed. By interpolating data from several samples based on the distance from the camera, you can get highly detailed lighting based on the image, the quality of which is essentially limited only by the number of samples that we are ready to place in the scene. This approach allows the lighting to change correctly, for example, when moving from a brightly lit street to the dusk of a certain room. I‚Äôll probably write a lesson about reflection samples in the future,however, at the moment I can only recommend for review the article by Chetan Jags, given below.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Implementation of samples, and much more can be found in the raw materials of the author of the author of tutorials </font></font><a href="https://github.com/JoeyDeVries/Cell"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comment. Per.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br><br><h2>  Additional materials </h2><br><ol><li> <a href="http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Real Shading in Unreal Engine 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Clarification of the Epic Games approach to approximating the expression for the mirror component by a separate sum. </font><font style="vertical-align: inherit;">Based on this article, the code for the IBL PBR lesson was designed.</font></font></li><li> <a href="http://www.trentreed.net/blog/physically-based-shading-and-image-based-lighting/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Physically Based Shading and Image Based Lighting</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : An excellent article describing the process of incorporating the calculation of the mirror component of IBL into a PBR Pipeline interactive application.</font></font></li><li> <a href="https://chetanjags.wordpress.com/2015/08/26/image-based-lighting/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image Based Lighting</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : a very voluminous and detailed post about mirror IBL and related issues, including the task of light probe interpolation.</font></font></li><li> <a href="https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf">Moving Frostbite to PBR</a> :       ,     PBR     ¬´AAA¬ª. </li><li> <a href="https://jmonkeyengine.github.io/wiki/jme3/advanced/pbr_part3.html">Physically Based Rendering ‚Äì Part Three</a> :  ,  IBL  PBR   JMonkeyEngine. </li><li> <a href="https://placeholderart.wordpress.com/2015/07/28/implementation-notes-runtime-environment-map-filtering-for-image-based-lighting/">Implementation Notes: Runtime Environment Map Filtering for Image Based Lighting</a> :       HDR  ,       . </li></ol></div><p>Source: <a href="https://habr.com/ru/post/429744/">https://habr.com/ru/post/429744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429730/index.html">Large supercomputer to be built on Elbrus processors in Russia</a></li>
<li><a href="../429732/index.html">You Gonna Hate This, or a Tale of How a Good Code Should Look</a></li>
<li><a href="../429734/index.html">Dream to fly with electrotechnical bias</a></li>
<li><a href="../429736/index.html">Hogweed Sosnowski. In MO introduced fines for distribution</a></li>
<li><a href="../429738/index.html">The optimal location of shards in a petabyte cluster Elasticsearch: linear programming</a></li>
<li><a href="../429750/index.html">Developer Cookbook: DDD Recipes (Part 3, Application Architecture)</a></li>
<li><a href="../429754/index.html">Fatal errors in hardware integration</a></li>
<li><a href="../429756/index.html">How to configure the setting of Nuxt.js environment variables in runtime, or How to do everything differently and do not regret</a></li>
<li><a href="../429758/index.html">Why SRE is important documentation. Part 1</a></li>
<li><a href="../429760/index.html">How to change your life by starting the development of the OpenSource project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>