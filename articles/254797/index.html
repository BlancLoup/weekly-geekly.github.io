<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The taste and color or coloring for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day again all. In this article I would like to continue the theme of custom View, namely the color selection dialog. 

 A small digression: Antic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The taste and color or coloring for Android</h1><div class="post__text post__text-html js-mediator-article">  Good day again all.  In this article I would like to continue the theme of custom View, namely the color selection dialog. <br><br>  A small digression: Anticipating negative reviews, I want to warn in advance - the article is designed for beginners in programming.  Starting to get acquainted with the development under Android, I ran into (and now I regularly come across) an interesting fact: on the Internet, a cart and a small information cart dedicated to installing and configuring Eclipse, then colorfully describe how to click New - Android Application Project and get your first HelloWord.  And then immediately services - streams - binders - handlers and all sorts of other databases.  In the middle is emptiness.  I try to fill this emptiness, to facilitate the transition from a kettle at least to a coffee pot, so to speak.  I really hope that I will help someone to find something necessary without unnecessary suffering.  And I can not once again not to mention another feature of the Runet: Not so long ago, once again I <s>stepped on a rake</s> , I ran into a problem, one might say funny for a knowledgeable person, but unfamiliar to me.  I quickly found a solution on some English-speaking forum.  The topic consisted of two posts.  Question and answer.  Everything!  If anyone is interested, I will find a link.  Yes, by the way, the question that has arisen also applies to this article, so further I will mention this.  So, but look at our forums - horror.  Each question generates several pages of flooding on the topic ‚Äúread the documentation,‚Äù but in most cases there is still no answer. <br><br>  Well, sorry for the verbosity, sad, so to speak.  We continue under the cut. <br><a name="habracut"></a><br>  So, in the next project I encountered the need to change the colors of some elements in the program.  That is, we need the appropriate control, let's call it ColorPicker.  In the standard set such is absent, that is, each is perverted as it can.  What can I say, even at Microsoft on BB there is no unity, look at the color selection dialogs in Word, say in the same Paint. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On a smartphone, it is not so easy to get a finger to the desired point; manually entering values ‚Äã‚Äãis also not very convenient.  An Internet search, however, offers either some similarity to the aforementioned smartphone-like Paint-like dialogs, or the most simplified options for the three sliders type for RGB, a separate slider for the alpha channel, or a fixed set of several color tiles.  And I don‚Äôt like to push other people's libraries into my projects, so the search was pretty quick.  And I wanted everything at once.  And in one place. <br><br>  In the end, after long deliberation, this was born: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f7/532/f94/9f7532f9401dc3974b2bca16c1cff100.png" alt="image"><br><br>  That is, everything is quite simple.  The first (outer) ring represents the GRB gradient.  The second in the lower half adjusts the saturation of the selected color, then turning into shades of gray.  Well, the third ring is transparency.  Everything is at hand at the same time.  The center circle directly displays the currently selected color and in parallel serves as the OK button. <br><br>  Well, now, if anyone liked this colorful monster, let's try to hook the whole thing. <br><br>  Since there is not much to draw, and the rendering speed is not critical, we‚Äôll follow the View and draw on Canvas.  For the correct positioning of our arts, you need to know the dimensions, the dimensions of the View itself also want to be controlled, so we will override the onMeasure () method.  It turns out here such preparation: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cx; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cy; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(context, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(context, attrs, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defStyle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs, defStyle); init(context); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,   -     } @Override protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) { int mWidth = measure(widthMeasureSpec); int mHeight = measure(heightMeasureSpec); size = Math.min(mWidth, mHeight); setMeasuredDimension(size, size); //    ,    //     View       //        . //  Math.min     getConfiguration, //  size    - , //   View   .  : /*int orient = getResources().getConfiguration().orientation; switch (orient) { case Configuration.ORIENTATION_PORTRAIT: size = (int) (measureHeight * port); break; case Configuration.ORIENTATION_LANDSCAPE: size = (int) (measureHeight * land); break; }*/ calculateSizes(); //         } private int measure(int measureSpec) { int result = 0; int specMoge = MeasureSpec.getMode(measureSpec); int specSize = MeasureSpec.getSize(measureSpec); if (specMoge == MeasureSpec.UNSPECIFIED) result = 200; else result = specSize; return result; } private void calculateSizes() { cx = size * 0.5f; cy = cx; //       . } @Override protected void onDraw(Canvas c) { super.onDraw(c); //      //   ,    ‚Äì    c.drawColor(Color.BLUE); //invalidate()    } }</span></span></code> </pre> <br><br>  Now our class must appear in the Custom &amp; Library Views section of the element palette.  Drag it to the markup of our HelloWord. <br><br>  It should get something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e5/15c/f93/6e515cf93e940ea261895da3967b1118.png" alt="image"><br><br>  Happened?  Great coming out. <br><br>  Go to the drawing.  Let's start outside.  We need a ring with a gradient of colors.  The ring, who does not know, is drawn like this: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(c); c.drawCircle(cx, cy, rad_1, p_color); }</code> </pre><br><br>  That is, we need a radius of the circle and a brush (or paint, as there Paint is translated). <br>  Add to our code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Paint p_color = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paint(Paint.ANTI_ALIAS_FLAG);</code> </pre><br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateSizes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ cx = size * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; cy = cx; <span class="hljs-comment"><span class="hljs-comment">//   rad_1 = size * 0.44f; // 0.44 ‚Äì     .    //  : p_color.setStrokeWidth(size * 0.08f); //      0.08  size //     }</span></span></code> </pre><br><br>  If now to start all this, it will be like with that gopher - the ring is not visible, but it is.  We just did not ask him the color.  Not him, or rather, and our Paint p_color. <br><br>  With color we will do the following.  Remember, there are such shaders.  And gradients.  We define an array of four colors: <br>  int [] mColors = new int [] {Color.RED, Color.GREEN, Color.BLUE, Color.RED}; <br><br>  (Of the four - so that there was no abrupt transition. From the red they started and returned to the red). <br>  Apply a gradient to a shader, a shader to a brush, a brush to a circle, an <s>egg in a duck, a duck in a hare</s> ... <br><br><pre> <code class="java hljs"> Shader s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SweepGradient(cx, cy, mColors, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); p_color.setShader(s);</code> </pre><br><br>  We look: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47f/dd8/ff3/47fdd8ff37998d25aaee2f7b0e9495f4.png" alt="image"><br><br>  Pretty good, right? <br><br>  But the second ring to draw is still too early.  As we remember, there should be drawn a gradient of saturation of the selected color.  Nothing has been selected yet.  We must make our View respond to the extremities of the user.  That is, use the OnTouch method.  And in order for our class to be completely self-sufficient, we will depict OnTouch directly inside the class: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      init()  setOnTouchListener(this); //  ,     public class ColorPicker extends View implements OnTouchListener</span></span></code> </pre><br><br>  Then Eclipse thoughtfully suggests adding a method: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.getAction()) { <span class="hljs-comment"><span class="hljs-comment">//   ,    case MotionEvent.ACTION_DOWN: //      -       break; case MotionEvent.ACTION_MOVE: //       break; } invalidate(); return true; }</span></span></code> </pre><br><br>  It seems everything is simple, but here came the very rake mentioned at the beginning of the article.  Eclipse stubbornly demanded something.  As it turned out, he wanted to add onTouch: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_UP: v.performClick(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  And accordingly the method: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.performClick(); }</code> </pre><br><br>  After that, everyone calmed down.  Now we boldly get the coordinates in onTouch: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = Math.abs(event.getX() - cx); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = Math.abs(event.getY() - cy); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_MOVE: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = event.getX() - cx; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = event.getY() - cy; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  And go ahead - calculate colors.  This is where the scope for criticism opens, because I am not on friendly terms with mathematics.  Therefore, I propose to continue in the <a href="http://habrahabr.ru/post/254895/">next article</a> . </div><p>Source: <a href="https://habr.com/ru/post/254797/">https://habr.com/ru/post/254797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254787/index.html">Perl 6: nextsame and its relatives</a></li>
<li><a href="../254789/index.html">Translation of hours in Russia, again ... and php5-intl</a></li>
<li><a href="../254791/index.html">Aspect-oriented programming. The basics</a></li>
<li><a href="../254793/index.html">Two worlds of virtual machines</a></li>
<li><a href="../254795/index.html">Worst API ever created</a></li>
<li><a href="../254799/index.html">Development of MMO RPG - a practical guide. Episode 1</a></li>
<li><a href="../254801/index.html">Android Volley custom Loader</a></li>
<li><a href="../254803/index.html">About interfaces</a></li>
<li><a href="../254805/index.html">Import data from YouTube and Vimeo to Google.Docs</a></li>
<li><a href="../254811/index.html">Updated Windows VPS from Infobox with triple data replication and Enterprise SSD caching. We test disk performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>