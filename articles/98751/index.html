<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using ActiveRecord without Rails</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The library for working with ActiveRecord databases can also be used outside of Rails. 

 Task  Our test project will take the time of the rising of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using ActiveRecord without Rails</h1><div class="post__text post__text-html js-mediator-article">  The library for working with ActiveRecord databases can also be used outside of Rails. <br><a name="habracut"></a><br><h4>  Task </h4>  Our test project will take the time of the rising of the moon with <a href="http://pogoda.yandex.ru/26063/details/">Yandex. Weather</a> and save it to the database using ActiveRecord.  At the same time we will look at working with Nokogiri (a good replacement for <a href="http://habrahabr.ru/blogs/starting_programming/51610/">hpricot</a> ). <br><br><h4>  Project structure </h4>  We will use migrations, the configuration file database.yaml, Rakefile, the sqlite database (development.sqlite3), in general, an environment close to our favorite rails. <br><br>  View on <a href="http://github.com/alexbaumgertner/ActiveRecord-without-Rails">github</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/a19/ad9/e64/a19ad9e643505744966fdedec88f287b.png" alt="image"><br><br><h4>  Setting up a database connection and creating a table using migrations </h4>  For convenience, the configuration of the database connection is placed in a separate file <b>lib / config / database.yml</b> : <br><blockquote><ol><li>  <font color="blue"><b>adapter:</b></font> sqlite3 </li><li>  <font color="blue"><b>database:</b></font> lib / db / development.sqlite3 </li></ol></blockquote>  And the connection to the database in <b>lib / config / environment.rb</b> : <br><blockquote><ol><li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> <li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> <li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><i><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> #       dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><i><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> #         () <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><i><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> #    <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> <font color="#008000"><i>#      </i></font> dbconfig = <font color="#cc00ff"><b>YAML</b></font> :: <font color="#cc0066"><b>load</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'database.yml'</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>)</b></font> <font color="#008000"><i>#         ()</i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">logger</font> = <font color="#cc00ff"><b>Logger</b></font> . <font color="#9900cc">new</font> <font color="#006600"><b>(</b></font> STDERR <font color="#006600"><b>)</b></font> <font color="#008000"><i># Simple logging utility. logger.rb -- standart lib</i></font> <font color="#008000"><i>#   </i></font> <font color="#6666ff"><b>ActiveRecord::Base</b></font> . <font color="#9900cc">establish_connection</font> <font color="#006600"><b>(</b></font> dbconfig <font color="#006600"><b>)</b></font></font></code> </li> </ol></blockquote><br>  Let's prepare the database migration for creating the table.  For simplicity, it only has two string fields: day and time: <br><blockquote><ol><li>  <font color="#9966cc"><b>class</b></font> CreateMoonRiseTimes <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Migration</b></font> </li><li>  <font color="#9966cc"><b>def</b></font> <font color="#0000ff"><b>self</b></font> .  <font color="#9900cc">up</font> </li><li>  create_table <font color="#ff3333"><b>: moon_rise_times</b></font> <font color="#9966cc"><b>do</b></font> <font color="#006600"><b>|</b></font>  t <font color="#006600"><b>|</b></font> </li><li>  t.  <font color="#cc0066"><b>string</b></font> <font color="#ff3333"><b>: day</b></font> </li><li>  t.  <font color="#cc0066"><b>string</b></font> <font color="#ff3333"><b>: time</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li></li><li>  <font color="#9966cc"><b>def</b></font> <font color="#0000ff"><b>self</b></font> .  <font color="#9900cc">down</font> </li><li>  drop_table <font color="#ff3333"><b>: moon_rise_times</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li></ol></blockquote>  To perform the migration, create a rake file. <br><blockquote> <code><a href="http://docs.rubyrake.org/"></a> <a href="http://rake.rubyforge.org/classes/Rake/NameSpace.html"></a></code> <ol><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'lib / config / environment.rb'</font> </li><li></li><li>  <font color="#008000"><i>Documentation on rake docs.rubyrake.org</i></font> </li><li>  <font color="#008000"><i># namespace - rake.rubyforge.org/classes/Rake/NameSpace.html</i></font> </li><li></li><li>  namespace <font color="#ff3333"><b>: db</b></font> <font color="#9966cc"><b>do</b></font> </li><li>  desc <font color="#996600">"Migrate the database"</font> </li><li>  task <font color="#ff3333"><b>: migrate</b></font> <font color="#9966cc"><b>do</b></font> </li><li>  <font color="#008000"><i># performing all migrations from lib / db / migrate,</i></font> </li><li>  <font color="#008000"><i># method takes parameters: migrate (migrations_path, target_version = nil)</i></font> </li><li>  <font color="#008000"><i># in our case</i></font> </li><li>  <font color="#008000"><i># migrations_path = lib / db / migrate</i></font> </li><li>  <font color="#008000"><i># target_version = ENV ["VERSION"]?</i></font>  <font color="#008000"><i>ENV ["VERSION"]. To_i: nil</i></font> </li><li>  <font color="#008000"><i># migration starts as rake db: migrate VERSION = version_number</i></font> </li><li>  <font color="#6666ff"><b>ActiveRecord :: Migrator</b></font> .  <font color="#9900cc">migrate</font> <font color="#006600"><b>(</b></font> <font color="#996600">'lib / db / migrate'</font> , ENV <font color="#006600"><b>[</b></font> <font color="#996600">"VERSION"</font> <font color="#006600"><b>]</b></font> ? ENV <font color="#006600"><b>[</b></font> <font color="#996600">"VERSION"</font> <font color="#006600"><b>]</b></font> . <font color="#9900cc">to_i</font> : <font color="#0000ff"><b>nil</b></font> <font color="#006600"><b>)</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li></ol></blockquote><br><br>  Let's migrate: <br><blockquote><ol><li>  <strong>$ rake db: migrate <font color="#007800">version</font> = <font color="#000000">1</font></strong> <strong><font color="#000000"><br><br></font></strong> </li><li>  <font color="#7a0874"><b>(</b></font> <font color="#000000"><b>in</b></font> <font color="#000000"><b>/</b></font> home <font color="#000000"><b>/</b></font> data <font color="#000000"><b>/</b></font> projects <font color="#000000"><b>/</b></font> ActiveRecord-without-Rails <font color="#7a0874"><b>)</b></font> <font color="#7a0874"><b><br></b></font> </li><li>  == CreateMoonRiseTimes: migrating ============================================ </li><li>  <font color="#660033">-</font> create_table <font color="#7a0874"><b>(</b></font> : moon_rise_times <font color="#7a0874"><b>)</b></font> </li><li>  SQL <font color="#7a0874"><b>(</b></font> 1.0ms <font color="#7a0874"><b>)</b></font> <strong>CREATE TABLE <font color="#ff0000">"moon_rise_times"</font> <font color="#7a0874">(</font> <font color="#ff0000">"id"</font> INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, <font color="#ff0000">"day"</font> varchar <font color="#7a0874">(</font> <font color="#000000">255</font> <font color="#7a0874">)</font> , <font color="#ff0000">"time"</font> varchar <font color="#7a0874">(</font> <font color="#000000">255</font> <font color="#7a0874">)</font> <font color="#7a0874">)</font></strong> </li><li>  - <font color="#000000"><b>&gt;</b></font> 0.0019s </li><li>  == CreateMoonRiseTimes: migrated <font color="#7a0874"><b>(</b></font> 0.0020s <font color="#7a0874"><b>)</b></font> =================================== </li><li>  SQL <font color="#7a0874"><b>(</b></font> 0.1ms <font color="#7a0874"><b>)</b></font> INSERT INTO schema_migrations <font color="#7a0874"><b>(</b></font> version <font color="#7a0874"><b>)</b></font> VALUES <font color="#7a0874"><b>(</b></font> <font color="#ff0000">'1'</font> <font color="#7a0874"><b>)</b></font> </li></ol></blockquote><br><br>  Fine.  Migration 001_create_moon_rise_times.rb created the moon_rise_times table with the day and time fields. <br><br><h4>  Extracting data and storing it in the database </h4>  Now you need to find some useful data to save to the database.  For example, we will take from the site Yandeks.Pogoda time of the rising of the moon.  You can also catch currency rates, news, the value of karma, etc ... <br><br>  First of all, let's create a test file <b>lib / test_search.rb that is</b> looking for the necessary data on Yandex.Pagoda: <br><blockquote> <code><a href="http://pogoda.yandex.ru/26063/details/%2522"></a> <a href="http://wiki.github.com/tenderlove/nokogiri/"></a></code> <ol><li>  <font color="#008000"><i># A file with a small script for testing the work of nokogiri.</i></font> </li><li></li><li>  <font color="#ff6633"><b>$ KCODE</b></font> = <font color="#996600">"u"</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'jcode'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'open-uri'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'iconv'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'nokogiri'</font> </li><li></li><li></li><li>  <font color="#008000"><i># Download html document</i></font> </li><li>  source = <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#996600">"pogoda.yandex.ru/26063/details/"</font> <font color="#006600"><b>)</b></font> </li><li></li><li>  <font color="#008000"><i># Create a nokogiri object from the loaded document</i></font> </li><li>  data = <font color="#6666ff"><b>Nokogiri :: HTML</b></font> <font color="#006600"><b>(</b></font> source <font color="#006600"><b>)</b></font> </li><li>  <font color="#008000"><i># Extract all html table rows using the search method and simple xpath expression</i></font> </li><li>  <font color="#008000"><i># wiki.github.com/tenderlove/nokogiri</i></font> </li><li></li><li></li><li>  <font color="#000080"><i>= begin</i></font> </li><li>  <font color="#000080"><i>Fragment of the source html-file, in which you need to find the date of the rising of the moon :)</i></font> </li><li></li><li>  <font color="#000080"><i>&lt;th class = "date" rowspan = "4"&gt; &lt;b title = ""&gt; 9 &lt;/ b&gt; &lt;span&gt; July &lt;/ span&gt; &lt;/ th&gt;</i></font> </li><li></li><li>  <font color="#000080"><i>= end</i></font> </li><li></li><li>  data_html = data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"th [@class = date] // b"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> <font color="#006600"><b>+</b></font> <font color="#996600">""</font> <font color="#006600"><b>+</b></font> data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"th [@class = date] // span"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> </li><li>  <font color="#cc0066"><b>puts</b></font> data_html </li><li></li><li>  <font color="#000080"><i>= begin</i></font> </li><li>  <font color="#000080"><i>A fragment of the source html file, in which you need to find the time of the rising of the moon on the day defined above :)</i></font> </li><li></li><li>  <font color="#000080"><i>&lt;td class = "dawn-dark" rowspan = "4"&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;dl&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;dt&gt; Sunrise &lt;/ dt&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;dd&gt; 04:52 &lt;/ dd&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;dt&gt; Sunset &lt;/ dt&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;dd&gt; 23:15 &lt;/ dd&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;/ dl&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;img src = "// i.yandex.st/weather/i/moon/07.gif" alt = "The Waning Moon" title = "The Waning Moon"&gt;</i></font> </li><li>  <font color="#000080"><i>&lt;/ td&gt;</i></font> </li><li></li><li>  <font color="#000080"><i>= end</i></font> </li><li></li><li>  time_html = data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"td [@class = dawn-dark] // dl // dd"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> </li><li>  <font color="#cc0066"><b>puts</b></font> time_html </li></ol></blockquote><br><br>  We get: <br><blockquote><ol><li>  <strong>$ ruby ‚Äã‚Äãlib <font color="#000000">/</font> test_search.rb</strong> </li><li>  July <font color="#000000">10</font> </li><li>  04: <font color="#000000">53</font> </li></ol></blockquote><br>  Ok, what we need. <br>  Now you need to save the data in the database.  There is a <a href="http://www.railsbrain.com/api/rails-2.3.2/doc/index.html%3Fa%3DM002319%26amp%3Bname%3Dcreate">create</a> method for this in ActiveRecord :: Base <br><br>  The file that does the main work, <strong>lib / main.rb:</strong> <br><blockquote> <code><a href="http://pogoda.yandex.ru/26063/details/%2522"></a> <a href="http://nokogiri.org/Nokogiri/XML/Node.html"></a></code> <ol><li>  <font color="#ff6633"><b>$ KCODE</b></font> = <font color="#996600">"u"</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'jcode'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'rubygems'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'active_record'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'yaml'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'logger'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'open-uri'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'iconv'</font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#996600">'nokogiri'</font> </li><li></li><li></li><li>  <font color="#008000"><i># load the environment.rb file settings and connect to the database</i></font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#cc00ff"><b>file</b></font> .  <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'config / environment.rb'</font> <font color="#006600"><b>)</b></font> </li><li></li><li>  <font color="#008000"><i># Create a MoonRiseTime class that wraps the moon_rise_times table</i></font> </li><li>  <font color="#008000"><i># Table cells: day - data type, rise_times - time type</i></font> </li><li>  <font color="#008000"><i>#</i></font> </li><li></li><li>  <font color="#9966cc"><b>class</b></font> MoonRiseTime <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Base</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li></li><li>  MoonRiseTime.  <font color="#9900cc">create</font> <font color="#9966cc"><b>do</b></font> <font color="#006600"><b>|</b></font>  moon_rise_time <font color="#006600"><b>|</b></font> </li><li>  <font color="#008000"><i># Download html document</i></font> </li><li>  source = <font color="#cc0066"><b>open</b></font> <font color="#006600"><b>(</b></font> <font color="#996600">"pogoda.yandex.ru/26063/details/"</font> <font color="#006600"><b>)</b></font> </li><li></li><li>  <font color="#008000"><i># Create a nokogiri object from the loaded document</i></font> </li><li>  data = <font color="#6666ff"><b>Nokogiri :: HTML</b></font> <font color="#006600"><b>(</b></font> source <font color="#006600"><b>)</b></font> </li><li>  <font color="#008000"><i># Extract all html table rows using the search method and simple xpath expression</i></font> </li><li>  <font color="#008000"><i># nokogiri.org/Nokogiri/XML/Node.html#method-i-inner_html</i></font> </li><li></li><li>  <font color="#008000"><i>#: TODO: Cast data types to data and time</i></font> </li><li>  <font color="#008000"><i># Find the original html date</i></font> </li><li>  data_moon_rise = data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"th [@class = date] // b"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> </li><li>  month_moon_rise = data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"th [@class = date] // span"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> </li><li></li><li>  <font color="#008000"><i># pass the data found to the methods of the database wrapper class</i></font> </li><li>  moon_rise_time.  <font color="#9900cc">day</font> = data_moon_rise <font color="#006600"><b>+</b></font> <font color="#996600">""</font> <font color="#006600"><b>+</b></font> month_moon_rise </li><li></li><li>  moon_rise_time.  <font color="#9900cc">time</font> = data.  <font color="#9900cc">search</font> <font color="#006600"><b>(</b></font> <font color="#996600">"td [@class = dawn-dark] // dl // dd"</font> <font color="#006600"><b>)</b></font> .  <font color="#9900cc">first</font> .  <font color="#9900cc">inner_html</font> </li><li>  <font color="#9966cc"><b>end</b></font> </li></ol></blockquote><br>  Run it: <br><blockquote><ol><li>  ruby lib <font color="#000000"><b>/</b></font> main.rb </li><li>  MoonRiseTime Create <font color="#7a0874"><b>(</b></font> 0.4ms <font color="#7a0874"><b>)</b></font> INSERT INTO <font color="#ff0000">"moon_rise_times"</font> <font color="#7a0874"><b>(</b></font> <font color="#ff0000">"time"</font> , <font color="#ff0000">"day"</font> <font color="#7a0874"><b>)</b></font> VALUES <font color="#7a0874"><b>(</b></font> <font color="#ff0000">'04: 53 '</font> , <font color="#ff0000">'10 July'</font> <font color="#7a0874"><b>)</b></font> </li></ol></blockquote><br><br>  It feels good. <br><br>  Let's see what was saved in the database using a small script <strong>lib / test_fetch_data.rb</strong> : <br><blockquote><ol><li>  <font color="#008000"><i># File with a small script for testing</i></font> </li><li>  <font color="#008000"><i># extracting data from the moon_rise_times table.</i></font> </li><li></li><li>  <font color="#008000"><i># load the configuration file and connect to the database in the file environment.rb</i></font> </li><li>  <font color="#cc0066"><b>require</b></font> <font color="#cc00ff"><b>file</b></font> .  <font color="#9900cc">join</font> <font color="#006600"><b>(</b></font> <font color="#cc00ff"><b>File</b></font> . <font color="#9900cc">dirname</font> <font color="#006600"><b>(</b></font> <font color="#0000ff"><b>__FILE__</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">'config / environment.rb'</font> <font color="#006600"><b>)</b></font> </li><li></li><li>  <font color="#008000"><i># Create a MoonRiseTime class that wraps the moon_rise_times table</i></font> </li><li>  <font color="#008000"><i># Table cells: day, time - type string</i></font> </li><li></li><li>  <font color="#9966cc"><b>class</b></font> MoonRiseTime <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Base</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li><li></li><li>  <font color="#008000"><i># Extract all records from the database in fetch_result</i></font> </li><li>  fetch_result = MoonRiseTime.  <font color="#9900cc">all</font> </li><li></li><li>  <font color="#008000"><i># Displaying fetch_result</i></font> </li><li>  fetch_result.  <font color="#5a0a0a"><b>each</b></font> <font color="#9966cc"><b>do</b></font> <font color="#006600"><b>|</b></font>  result_item <font color="#006600"><b>|</b></font> </li><li>  <font color="#cc0066"><b>puts</b></font> result_item.  <font color="#9900cc">id</font> </li><li>  <font color="#cc0066"><b>puts</b></font> result_item.  <font color="#9900cc">time</font> </li><li>  <font color="#cc0066"><b>puts</b></font> result_item.  <font color="#5a0a0a"><b>day</b></font> </li><li>  <font color="#9966cc"><b>end</b></font> </li></ol></blockquote><br>  Conclusion: <br><blockquote><ol><li>  <strong>$ ruby ‚Äã‚Äãlib <font color="#000000">/</font> test_fetch_data.rb</strong> </li><li>  MoonRiseTime Load <font color="#7a0874"><b>(</b></font> 0.5ms <font color="#7a0874"><b>)</b></font> SELECT <font color="#000000"><b>*</b></font> FROM <font color="#ff0000">"moon_rise_times"</font> </li><li>  <font color="#000000">one</font> </li><li>  04: <font color="#000000">53</font> </li><li>  July <font color="#000000">10</font> </li></ol></blockquote><br>  OK!  Now, starting our program every day, you can follow the time of the moon rising! <br><br><h4>  Used materials </h4><ul><li>  <a href="http:// ">http://blog.aizatto.com/2007/05/21/activerecord-without-rails/</a> </li><li>  <a href="http:// ">http://blog.aizatto.com/2007/05/27/activerecord-migrations-without-rails/</a> </li><li>  <a href="http:// ">http://en.wikibooks.org/wiki/Ruby_on_Rails/ActiveRecord/Migrations</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/98751/">https://habr.com/ru/post/98751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../98740/index.html">The idea is only a multiplier when implementing</a></li>
<li><a href="../98742/index.html">Combining multiple sections into one without losing information</a></li>
<li><a href="../98743/index.html">Simple overlay of 2 images</a></li>
<li><a href="../98745/index.html">JCUKEN phonetic keyboard layout</a></li>
<li><a href="../98747/index.html">Short links in Google Maps</a></li>
<li><a href="../98752/index.html">Filter the bazaar: write a simple and functional data filter</a></li>
<li><a href="../98756/index.html">A plugin for Vim that provides easy keyboard layout switching on Mac OS X</a></li>
<li><a href="../98758/index.html">Great Belarusian Firewall</a></li>
<li><a href="../98759/index.html">Galaxy S vs HTC Desire: Quake2 running test</a></li>
<li><a href="../98762/index.html">Media Player PowerZest HD-500</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>