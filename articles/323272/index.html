<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deep Learning Libraries Theano / Lasagne</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 


 In parallel with the publication of open-source machine learning articles, we decided to launch another series - on working with popular...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deep Learning Libraries Theano / Lasagne</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/795/d6b/948/795d6b94837647e27a8b9087f7d4903f.png" align="right" height="300">  Hi, Habr! </p><br><p>  In parallel with the publication of <a href="https://habrahabr.ru/search/%3Fq%3D%255Bmlcourse_open%255D%26target_type%3Dposts">open-source machine learning</a> articles, we decided to launch another series - on working with popular frameworks for neural networks and deep learning. </p><br><p>  I will open this cycle with an article about Theano, a library that is used to develop machine learning systems both by itself and as a computational backend for higher-level libraries, such as <a href="http://lasagne.readthedocs.io/en/latest/">Lasagne</a> , <a href="https://keras.io/">Keras,</a> or <a href="http://blocks.readthedocs.io/en/latest/">Blocks</a> . </p><br><p>  Theano has been developed since 2007 mainly by the <a href="https://mila.umontreal.ca/en/">MILA</a> group from the University of Montreal and is named after the ancient Greek philosopher and mathematician Feano (allegedly depicted in the picture).  The main principles are: integration with numpy, transparent use of various computing devices (mainly GPU), dynamic generation of optimized C-code. </p><a name="habracut"></a><br><h2 id="budem-priderzhivatsya-sleduyuschego-plana">  We will adhere to the following plan: </h2><br><ul><li>  Preface or lyrical digression about libraries for deep learning </li><li>  Introduction <br><ul><li>  Installation </li><li>  Customization </li></ul></li><li>  The basics <br><ul><li>  The first steps </li><li>  Variables and Functions </li><li>  Shared variables and more about functions </li><li>  Debugging </li></ul></li><li>  Machine learning at Theano <br><ul><li>  Logistic regression </li><li>  SVM </li><li>  Nonlinear signs </li></ul></li><li>  Lasagne <br><ul><li>  Multilayer perceptron </li></ul></li><li>  Conclusion </li></ul><br><p>  Code with examples from this post can be found <a href="https://github.com/dudevil/theano-tutorial">here</a> . </p><br><h2 id="predislovie-ili-liricheskoe-otstuplenie-o-bibliotekah-dlya-glubokogo-obucheniya">  Preface or lyrical digression about libraries for deep learning </h2><br><p>  Currently, dozens of libraries have been developed for working with neural networks, all of them, sometimes significantly, differ in implementation, but two main approaches can be identified: imperative and symbolic.  <a href="https://habr.com/ru/company/ods/blog/323272/"><sup>one</sup></a> <a name="src1"></a></p><br><p>  Let's look at an example of how they differ.  Suppose we want to evaluate a simple expression </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="noError" id="MJXp-Span-2" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ begin {array} {rcl} \ vec a &amp;: = &amp; \ left [10, 10, \ ldots, 10 \ right] ^ T \\ \ vec b &amp;: = &amp; 2 \ cdot \ vec a \\ \ vec c &amp; = &amp; \ vec a \ otimes \ vec b \\ \ vec d &amp; = &amp; \ vec c + 1 \ end {array}</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;begin&nbsp;{array}&nbsp;{rcl}&nbsp;\&nbsp;vec&nbsp;a&nbsp;&amp;:&nbsp;=&nbsp;&amp;&nbsp;\&nbsp;left&nbsp;[10,&nbsp;10,&nbsp;\&nbsp;ldots,&nbsp;10&nbsp;\&nbsp;right]&nbsp;^&nbsp;T&nbsp;\\&nbsp;\&nbsp;vec&nbsp;b&nbsp;&amp;:&nbsp;=&nbsp;&amp;&nbsp;2&nbsp;\&nbsp;cdot&nbsp;\&nbsp;vec&nbsp;a&nbsp;\\&nbsp;\&nbsp;vec&nbsp;c&nbsp;&amp;&nbsp;=&nbsp;&amp;&nbsp;\&nbsp;vec&nbsp;a&nbsp;\&nbsp;otimes&nbsp;\&nbsp;vec&nbsp;b&nbsp;\\&nbsp;\&nbsp;vec&nbsp;d&nbsp;&amp;&nbsp;=&nbsp;&amp;&nbsp;\&nbsp;vec&nbsp;c&nbsp;+&nbsp;1&nbsp;\&nbsp;end&nbsp;{array}</span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ begin {array} {rcl} \ vec a &: = & \ left [10, 10, \ ldots, 10 \ right] ^ T \\ \ vec b &: = & 2 \ cdot \ vec a \\ \ vec c & = & \ vec a \ otimes \ vec b \\ \ vec d & = & \ vec c + 1 \ end {array} </script></p><br><p>  This is how it would look in an imperative presentation in python: </p><br><pre><code class="hljs swift">a = np.ones(<span class="hljs-number"><span class="hljs-number">10</span></span>) b = np.ones(<span class="hljs-number"><span class="hljs-number">10</span></span>) * <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = b * a d = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  The interpreter executes the code line by line, storing the results in the variables <code>a</code> , <code>b</code> , <code>c</code> and <code>d</code> . <br>  The same program in the symbolic paradigm would look like this: </p><br><pre> <code class="hljs vhdl"> A = <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'A</span></span>') B = <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'B</span></span>') C = B * A D = C + <span class="hljs-keyword"><span class="hljs-keyword">Constant</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) #   f = compile(D) #  d = f(A=np.ones(<span class="hljs-number"><span class="hljs-number">10</span></span>), B=np.ones(<span class="hljs-number"><span class="hljs-number">10</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/files/718/0b2/64c/7180b264c0d048f1af760c73c7b62758.png" align="right">  The essential difference is that when we declare <code>D</code> , execution does not occur, we just set the calculation graph, which we then compile and finally execute. </p><br><p>  Both approaches have advantages and disadvantages.  First of all, imperative programs are more flexible, clearer and easier to debug.  We can use all the richness of the programming language used, for example, cycles and branching, display intermediate results for debugging purposes.  This flexibility is achieved, first of all, by small restrictions imposed on the interpreter, which should be ready for any subsequent use of variables. </p><br><p>  On the other hand, the symbolic paradigm imposes more restrictions, but the calculations are more efficient both in memory and execution speed: at the compilation stage, you can apply a number of optimizations, identify unused variables, perform part of the calculations, reuse memory, and so on.  A distinctive feature of symbolic programs is the separate stages of graph declaration, compilation, and execution. </p><br><p>  We dwell on it in such detail, because the imperative paradigm is familiar to most programmers, while the symbolic may seem unusual, and Theano is just a clear example of a symbolic framework. </p><br><p>  For those who want to understand this issue in more detail, I recommend reading the relevant section of the <a href="http://mxnet.io/architecture/program_model.html">MXNet</a> documentation (we will write a separate post about this library), but the key point for understanding the rest of the text is that programming with Theano we write to the python program, which then compile and execute. <br>  But enough theory, let's deal with Theano examples. </p><br><h2 id="ustanovka">  Installation </h2><br><p>  For installation, we need: python versions older than 2.6 or 3.3 (better dev version), C ++ compiler (g ++ for Linux or Windows, clang for MacOS), <a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">linear algebra library primitives</a> (for example ATLAS, OpenBLAS, Intel MKL), NumPy and SciPy. </p><br><p>  To perform computations on a GPU, CUDA will be needed, and a number of operations occurring in neural networks can be accelerated using CuDNN.  Starting with version 0.8.0, Theano developers recommend using <a href="https://github.com/Theano/libgpuarray">libgpuarray</a> , which also makes it possible to use multiple GPUs. </p><br><p>  When all dependencies are installed, you can install Theano via <code>pip</code> : </p><br><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta">#   pip install Theano #   </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  pip install --upgrade https:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//github.com/Theano/Theano/archive/master.zip</span></span></span></span></code> </pre> <br><h2 id="nastroyka">  Customization </h2><br><p>  Theano can be configured in three ways: </p><br><ul><li>  Setting the attributes of the <code>theano.config</code> object to the desired value. </li><li>  Through the environment variable <code>THEANO_FLAGS</code> </li><li>  Through the <code>$HOME/.theanorc</code> configuration file (or <code>$HOME/.theanorc.txt</code> under Windows) </li></ul><br><p>  I usually use something like this configuration file: </p><br><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>] device = gpu #  ,       - GPU  CPU floatX = float32 optimizer_including=cudnn allow_gc = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> # ,     #exception_verbosity=high #optimizer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> #    #profile = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> #profile_memory = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> config.dnn.conv.algo_fwd = time_once #         config.dnn.conv.algo_bwd = time_once [lib] Cnmem = <span class="hljs-number"><span class="hljs-number">0.95</span></span> #   CNMeM (https://github.com/NVIDIA/cnmem) -  CUDA-</code> </pre> <br><p>  More information about the configuration can be found in the <a href="http://deeplearning.net/software/theano/library/config.html">documentation</a> . </p><br><h2 id="osnovy">  The basics </h2><br><h3 id="pervye-shagi">  The first steps </h3><br><p>  Now that everything is installed and configured, let's try to write some code, for example, calculate the value of a polynomial <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-msubsup" id="MJXp-Span-4"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-6" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-8">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">x</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-11">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.719ex" height="2.539ex" viewBox="0 -935.7 5045.8 1093.4" role="img" focusable="false" style="vertical-align: -0.366ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-32" x="809" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="1248" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-32" x="2249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-78" x="2749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="3544" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="4545" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> x ^ 2 + 2x + 1 </script>  at point 10: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> theano <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> theano.tensor <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T <span class="hljs-comment"><span class="hljs-comment">#  theano- a = T.lscalar() #   expression = 1 + 2 * a + a ** 2 #  theano- f = theano.function( inputs=[a], #  outputs=expression #  ) #   f(10) &gt;&gt;&gt; array(121)</span></span></code> </pre> <br><p>  Here we performed 4 things: defined a scalar variable <code></code> type <code>long</code> , created an expression containing our polynomial, defined and compiled the function <code>f</code> , and also executed it, passing the number 10 to the input. </p><br><p>  Pay attention to the fact that the variables in Theano are typed, and the type of the variable contains information about both the data type and its dimension, i.e.  to calculate our polynomial at several points at once, we need to define <code></code> as a vector: </p><br><pre> <code class="python hljs">a = T.lvector() expression = <span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * a + a ** <span class="hljs-number"><span class="hljs-number">2</span></span> f = theano.function( inputs=[a], outputs=expression ) arg = arange(<span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) res = f(arg) plot(arg, res, c=<span class="hljs-string"><span class="hljs-string">'m'</span></span>, linewidth=<span class="hljs-number"><span class="hljs-number">3.</span></span>)</code> </pre> <br><img src="https://habrastorage.org/files/dd0/cb7/5f2/dd0cb75f24c34c11b438012bc7c7179c.png" align="right" height="250"><br><p>  In this case, we only need to specify the number of dimensions of the variable upon initialization: the size of each dimension is automatically calculated at the stage of the function call. </p><br><p>  <strong>UPD:</strong> It is no secret that the apparatus of linear algebra is universally used in machine learning: examples are described by feature vectors, model parameters are written in the form of matrices, images are presented in the form of 3-dimensional tensors.  Scalar quantities, vectors and matrices can be considered as a special case of tensors, therefore, we will call these objects of linear algebra in the future.  By a tensor we mean <code>N</code> dimensional arrays of numbers. <br>  <code>theano.tensor</code> package contains the most commonly used <a href="http://deeplearning.net/software/theano/library/tensor/basic.html">types of tensors</a> , however, it is not difficult to <a href="http://deeplearning.net/software/theano/library/tensor/basic.html">determine your type</a> . </p><br><p>  If the types do not match, Theano will throw an exception.  To fix this, by the way, as well as change much more in the work of functions, you can, by passing the argument <code>allow_input_downcast=True</code> constructor: </p><br><pre> <code class="python hljs">x = T.dmatrix(<span class="hljs-string"><span class="hljs-string">'x'</span></span>) v = T.fvector(<span class="hljs-string"><span class="hljs-string">'v'</span></span>) z = v + x f = theano.function( inputs=[x, v], outputs=z, allow_input_downcast=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) f_fail = theano.function( inputs=[x, v], outputs=z ) print(f(ones((<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), dtype=float64), ones((<span class="hljs-number"><span class="hljs-number">4</span></span>,), dtype=float64)) &gt;&gt;&gt; [[ <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span>] &gt;&gt;&gt; [ <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span>] &gt;&gt;&gt; [ <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">2.</span></span>]] print(f_fail(ones((<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), dtype=float64), ones((<span class="hljs-number"><span class="hljs-number">4</span></span>,), dtype=float64)) &gt;&gt;&gt; --------------------------------------------------------------------------- &gt;&gt;&gt; TypeError Traceback (most recent call last)</code> </pre> <br><p>  We can also evaluate several expressions at once, the optimizer in this case can reuse intersecting parts, in this case the sum <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">x</span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.326ex" height="2.178ex" viewBox="0 -676.4 2292.9 937.7" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="1795" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> x + y </script>  : </p><br><pre> <code class="python hljs">x = T.lscalar(<span class="hljs-string"><span class="hljs-string">'x'</span></span>) y = T.lscalar(<span class="hljs-string"><span class="hljs-string">'y'</span></span>) square = T.square(x + y) sqrt = T.sqrt(x + y) f = theano.function( inputs=[x, y], outputs=[square, sqrt] ) print(f(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)) &gt;&gt;&gt; [array(<span class="hljs-number"><span class="hljs-number">81</span></span>), array(<span class="hljs-number"><span class="hljs-number">3.0</span></span>)] print(f(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)) &gt;&gt;&gt; [array(<span class="hljs-number"><span class="hljs-number">16</span></span>), array(<span class="hljs-number"><span class="hljs-number">2.0</span></span>)]</code> </pre> <br><p>  For the exchange of states between functions, special shared variables are used: </p><br><pre> <code class="python hljs">state = theano.shared(<span class="hljs-number"><span class="hljs-number">0</span></span>) i = T.iscalar(<span class="hljs-string"><span class="hljs-string">'i'</span></span>) inc = theano.function([i], state, <span class="hljs-comment"><span class="hljs-comment">#    updates=[(state, state+i)]) dec = theano.function([i], state, updates=[(state, state-i)]) #         print(state.get_value()) inc(1) inc(1) inc(1) print(state.get_value()) dec(2) print(state.get_value()) &gt;&gt;&gt; 0 &gt;&gt;&gt; 3 &gt;&gt;&gt; 1</span></span></code> </pre> <br><p>  The values ‚Äã‚Äãof such variables, as opposed to tensor variables, can be obtained and modified outside of the Theano-functions from the usual python-code: </p><br><pre> <code class="python hljs">state.set_value(<span class="hljs-number"><span class="hljs-number">-15</span></span>) print(state.get_value()) &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">-15</span></span></code> </pre> <br><p>  Values ‚Äã‚Äãin shared variables can be ‚Äúsubstituted‚Äù in tensor variables: </p><br><pre> <code class="python hljs">x = T.lscalar(<span class="hljs-string"><span class="hljs-string">'x'</span></span>) y = T.lscalar(<span class="hljs-string"><span class="hljs-string">'y'</span></span>) i = T.lscalar(<span class="hljs-string"><span class="hljs-string">'i'</span></span>) expression = (x - y) ** <span class="hljs-number"><span class="hljs-number">2</span></span> state = theano.shared(<span class="hljs-number"><span class="hljs-number">0</span></span>) f = theano.function( inputs=[x, i], outputs=expression, updates=[(state, state+i)], <span class="hljs-comment"><span class="hljs-comment">#    state    y givens={ y : state } ) print(f(5, 1)) &gt;&gt;&gt; 25 print(f(2, 1)) &gt;&gt;&gt; 1</span></span></code> </pre> <br><h2 id="otladka">  Debugging </h2><br><p>  Theano provides a variety of tools to display a graph of computation and debugging.  However, debugging symbolic expressions is still not an easy task.  We briefly list the most commonly used approaches here, for more information on debugging, see the documentation: <a href="http://deeplearning.net/software/theano/tutorial/printing_drawing.html">http://deeplearning.net/software/theano/tutorial/printing_drawing.html</a> </p><br><p>  We can print a calculation graph for each function: </p><br><pre> <code class="python hljs">x = T.lscalar(<span class="hljs-string"><span class="hljs-string">'x'</span></span>) y = T.lscalar(<span class="hljs-string"><span class="hljs-string">'y'</span></span>) square = T.square(x + y) sqrt = T.sqrt(x + y) f = theano.function( inputs=[x, y], outputs=[square, sqrt] ) <span class="hljs-comment"><span class="hljs-comment">#       theano.printing.debugprint(f)</span></span></code> </pre> <br><p>  Note that the amount is calculated only once: </p><br><pre> <code class="hljs cs">Elemwise{Sqr}[(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] [id A] <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> |Elemwise{<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>,no_inplace} [id B] <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> |x [id C] |y [id D] Elemwise{sqrt,no_inplace} [id E] <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> |Elemwise{<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>,no_inplace} [id B] <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Expressions can also be displayed in a more concise form: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   W = T.fmatrix('W') b = T.fvector('b') X = T.fmatrix('X') expr = T.dot(X, W) + b prob = 1 / (1 + T.exp(-expr)) pred = prob &gt; 0.5 #    theano.pprint(pred) &gt;&gt;&gt; 'gt((TensorConstant{1} / (TensorConstant{1} + exp((-((X \\dot W) + b))))), TensorConstant{0.5})'</span></span></code> </pre> <br><p>  Or in the form of a graph: </p><br><pre> <code class="hljs pgsql">theano.printing.pydotprint(pred, outfile=<span class="hljs-string"><span class="hljs-string">'pics/pred_graph.png'</span></span>, var_with_name_simple=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/files/321/cfb/800/321cfb80040d4409bd2b971030a7dcfd.png" alt="theano graph"><br>  Unfortunately, the readability of such graphs drops sharply with increasing complexity of expression.  In fact, something can only be understood through toy examples. </p><br><h2 id="mashinnoe-obuchenie-na-theano">  Machine learning at Theano </h2><br><h3 id="logisticheskaya-regressiya">  Logistic regression </h3><br><p>  Let's look at the example of logistic regression, how you can develop machine learning algorithms using Theano.  Intentionally, we will not go into details of how this model is structured (let's leave it until the corresponding article in the open course), but recall that the posterior probability of the class <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-16"><span class="MJXp-msubsup" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-19" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.716ex" height="2.298ex" viewBox="0 -780.1 1169.4 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1011" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> C_1 </script>  has the appearance <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">p</span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mrow" id="MJXp-Span-26"><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">X</span><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-31">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">t</span><span class="MJXp-mrow" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">y</span></span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-38">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">a</span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-45"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-47" style="vertical-align: 0.5em;">T</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">X</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">b</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.293ex" height="2.901ex" viewBox="-38.5 -935.7 16056.6 1249" role="img" focusable="false" style="vertical-align: -0.728ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-70" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="503" y="0"></use><g transform="translate(893,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1011" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-7C" x="2062" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-58" x="2340" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="3193" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="3860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-68" x="5166" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="5743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-74" x="6272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="6634" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="7409" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-73" x="8716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-69" x="9185" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="9531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6D" x="10011" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="10890" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="11419" y="0"></use><g transform="translate(11809,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-54" x="1013" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-58" x="13123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="14198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-62" x="15199" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="15628" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> p (C_1 | X) = \ hat {y} = \ sigma (w ^ TX + b) </script></p><br><p>  Let's define the parameters of the model, for convenience, we introduce a separate parameter for the offset: </p><br><pre> <code class="python hljs">W = theano.shared( value=numpy.zeros((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>),dtype=theano.config.floatX), name=<span class="hljs-string"><span class="hljs-string">'W'</span></span>) b = theano.shared( value=numpy.zeros((<span class="hljs-number"><span class="hljs-number">1</span></span>,), dtype=theano.config.floatX), name=<span class="hljs-string"><span class="hljs-string">'b'</span></span>)</code> </pre> <br><p>  And we will get character variables for attributes and class labels: </p><br><pre> <code class="python hljs">X = T.matrix(<span class="hljs-string"><span class="hljs-string">'X'</span></span>) Y = T.imatrix(<span class="hljs-string"><span class="hljs-string">'Y'</span></span>)</code> </pre> <br><p>  Let's now define the expressions for the posterior probability and the model predictions: </p><br><pre> <code class="python hljs">linear = T.dot(X, W) + b p_y_given_x = T.nnet.sigmoid(linear) y_pred = p_y_given_x &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span></code> </pre> <br><p>  And we define the loss function of the form: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-52"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">L</span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">c</span><span class="MJXp-mrow" id="MJXp-Span-61"><span class="MJXp-mn" id="MJXp-Span-62">1</span></span><span class="MJXp-mrow" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">N</span></span><span class="MJXp-mtext" id="MJXp-Span-65">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">u</span><span class="MJXp-msubsup" id="MJXp-Span-68"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-74"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-70"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">n</span><span class="MJXp-mo" id="MJXp-Span-72">=</span><span class="MJXp-mn" id="MJXp-Span-73">1</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-76" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">y</span><span class="MJXp-mtext" id="MJXp-Span-78">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">g</span><span class="MJXp-mrow" id="MJXp-Span-82"><span class="MJXp-mtext" id="MJXp-Span-83">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">t</span><span class="MJXp-mrow" id="MJXp-Span-87"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">y</span></span></span><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-90" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-91">1</span><span class="MJXp-mo" id="MJXp-Span-92" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">y</span><span class="MJXp-mo" id="MJXp-Span-94" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mtext" id="MJXp-Span-95">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">g</span><span class="MJXp-mrow" id="MJXp-Span-99"><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-101">1</span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-103">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">t</span><span class="MJXp-mrow" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">y</span></span><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.614ex" height="3.021ex" viewBox="0 -883.9 25236.4 1300.8" role="img" focusable="false" style="vertical-align: -0.969ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-4C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="959" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="2015" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-66" x="3044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-72" x="3594" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="4046" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-63" x="4575" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="5009" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-4E" x="5509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-73" x="6648" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-75" x="7117" y="0"></use><g transform="translate(7690,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-4E" x="1242" y="488"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1379" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-5B" x="9997" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="10276" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="11023" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6F" x="11322" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="11807" y="0"></use><g transform="translate(12288,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-68" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-74" x="1356" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="1717" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="14725" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="15726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="16115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="16838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="17838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="18336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="18975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6F" x="19274" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="19759" y="0"></use><g transform="translate(20240,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-68" x="2362" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="2939" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-74" x="3468" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-79" x="3830" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="4327" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-5D" x="24957" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> L = - \ frac {1} {N} \ sum_ {n = 1} ^ {N} [y \ log {\ hat {y}} + (1-y) \ log {(1 - \ hat {y })}] </script></p><br><pre> <code class="python hljs">loss = T.nnet.binary_crossentropy(p_y_given_x, Y).mean()</code> </pre> <br><p>  We did not explicitly write out the expressions for sigmoids and cross-entropies explicitly, but used the functions from the <code>theano.tensor.nnet</code> package, which provides optimized implementations of a number of functions popular in machine learning.  In addition, features from this package usually include additional tricks for numerical stability. </p><br><p>  To optimize the loss function, let's use the gradient descent method, each step of which is given by the expression: </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-111"><span class="MJXp-mtext" id="MJXp-Span-112">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">e</span><span class="MJXp-msubsup" id="MJXp-Span-118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119" style="margin-right: 0.05em;">w</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-120" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">n</span><span class="MJXp-mo" id="MJXp-Span-122">+</span><span class="MJXp-mn" id="MJXp-Span-123">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-127" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-129">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">a</span><span class="MJXp-mtext" id="MJXp-Span-133">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">c</span><span class="MJXp-mrow" id="MJXp-Span-138"><span class="MJXp-mn" id="MJXp-Span-139">1</span></span><span class="MJXp-mrow" id="MJXp-Span-140"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">n</span></span><span class="MJXp-mtext" id="MJXp-Span-142">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">E</span><span class="MJXp-mo" id="MJXp-Span-149" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-152" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.585ex" height="2.66ex" viewBox="0 -832 18765.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="548" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-72" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="1529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-65" x="2010" y="0"></use><g transform="translate(2476,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><g transform="translate(716,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1379" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="4899" y="0"></use><g transform="translate(5956,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="7419" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-65" x="8670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-74" x="9136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="9498" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-66" x="10277" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-72" x="10828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="11279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-63" x="11809" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="12242" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="12743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="13593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="14194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-62" x="14723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="15153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="15451" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-45" x="15981" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="16745" y="0"></use><g transform="translate(17135,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="18376" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ large w_ {n + 1} = w_n - \ eta \ frac {1} {n} \ nabla E (w_n) </script></p><br><p>  Let's put it in code: </p><br><pre> <code class="python hljs">g_W = T.grad(loss, W) g_b = T.grad(loss, b) updates = [(W, W - <span class="hljs-number"><span class="hljs-number">0.04</span></span> * g_W), (b, b - <span class="hljs-number"><span class="hljs-number">0.08</span></span> * g_b)]</code> </pre> <br><p>  Here we used the wonderful opportunity of Theano - automatic <a href="https://habr.com/ru/company/ods/blog/323272/"><sup>2</sup></a> <a name="src2"></a>  differentiation.  The call to <code>T.grad</code> returned to us an expression that would contain the gradient of the first argument in the second.  This may seem redundant for such a simple case, but it helps a lot when building large, multi-layered models. </p><br><p>  When the gradients are obtained, we just need to compile the Theano functions: </p><br><pre> <code class="python hljs">train = theano.function( inputs=[X, Y], outputs=loss, updates=updates, allow_input_downcast=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) predict_proba = theano.function( [X], p_y_given_x, allow_input_downcast=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> )</code> </pre> <br><p>  And run an iterative process: </p><br><pre> <code class="python hljs">sgd_weights = [W.get_value().flatten()] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> iter_ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">4001</span></span>): loss = train(x, y[:, np.newaxis]) sgd_weights.append(W.get_value().flatten()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> iter_ % <span class="hljs-number"><span class="hljs-number">100</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(<span class="hljs-string"><span class="hljs-string">"[Iteration {:04d}] Train loss: {:.4f}"</span></span>.format(iter_, float(loss)))</code> </pre> <br><p>  For the data I generated, the process converges to this dividing line: <br><img src="https://habrastorage.org/files/d07/50f/dd6/d0750fdd64ad40bba74abb28ac62a686.png" alt="logreg decision boundary"></p><br><p>  It looks good, but it seems that for such a simple task, 4000 iterations are a bit too much ... Let's try to speed up the optimization and use <a href="https://en.wikipedia.org/wiki/Newton%2527s_method_in_optimization">the Newton method</a> .  This method uses the second derivatives of the loss function and is a sequence of such steps: </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-154"><span class="MJXp-mtext" id="MJXp-Span-155">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">e</span><span class="MJXp-msubsup" id="MJXp-Span-161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162" style="margin-right: 0.05em;">w</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-163" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">n</span><span class="MJXp-mo" id="MJXp-Span-165">+</span><span class="MJXp-mn" id="MJXp-Span-166">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-170" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173" style="margin-right: 0.05em;">H</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-174" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-175">‚àí</span><span class="MJXp-mn" id="MJXp-Span-176">1</span></span></span><span class="MJXp-mtext" id="MJXp-Span-177">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">E</span><span class="MJXp-mo" id="MJXp-Span-184" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-187" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="36.586ex" height="3.021ex" viewBox="0 -987.6 15752.3 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="548" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-72" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="1529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-65" x="2010" y="0"></use><g transform="translate(2476,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><g transform="translate(716,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1379" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="4899" y="0"></use><g transform="translate(5956,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="7419" y="0"></use><g transform="translate(8420,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-48" x="0" y="0"></use><g transform="translate(905,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="778" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="10580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="11180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-62" x="11710" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="12139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="12438" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-45" x="12967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="13732" y="0"></use><g transform="translate(14121,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="15362" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> \ large w_ {n + 1} = w_n - H ^ {- 1} \ nabla E (w_n) </script></p><br><p>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">H</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-48" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-9"> H </script>  - <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D1%2581%25D1%2581%25D0%25B8%25D0%25B0%25D0%25BD_%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B8">Hesse matrix.</a> </p><br><p>  To calculate the Hessian matrix, create one-dimensional versions of the parameters of our model: </p><br><pre> <code class="python hljs">W_init = numpy.zeros((<span class="hljs-number"><span class="hljs-number">2</span></span>,),dtype=theano.config.floatX) W_flat = theano.shared(W_init, name=<span class="hljs-string"><span class="hljs-string">'W'</span></span>) W = W_flat.reshape((<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) b_init = numpy.zeros((<span class="hljs-number"><span class="hljs-number">1</span></span>,), dtype=theano.config.floatX) b_flat = theano.shared(b_init, name=<span class="hljs-string"><span class="hljs-string">'b'</span></span>) b = b_flat.reshape((<span class="hljs-number"><span class="hljs-number">1</span></span>,))</code> </pre> <br><p>  And we define the optimizer step: </p><br><pre> <code class="python hljs">h_W = T.nlinalg.matrix_inverse(theano.gradient.hessian(loss, wrt=W_flat)) h_b = T.nlinalg.matrix_inverse(theano.gradient.hessian(loss, wrt=b_flat)) updates_newton = [(W_flat, W_flat - T.dot(h_W , g_W)), (b_flat, b_flat - T.dot(h_b, g_b))]</code> </pre> <br><p>  Although we have come to the same results, <br><img src="https://habrastorage.org/files/665/998/71d/66599871d0b84c69bca2240bbc176201.png" alt="logreg newton decision boundary">  , <br>  Newton's method required only 30 steps (against 4000 at the gradient descent). </p><br><p>  The ways of both methods can be viewed on this chart: <br><img src="https://habrastorage.org/files/c03/076/2e7/c030762e7ae347a0aa49862476347cba.png" alt="loptimizers path"></p><br><h3 id="svc">  Svc </h3><br><p>  We can also easily implement the support vector method, for this it is enough to present the loss function in the following form: </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-191"><span class="MJXp-mtext" id="MJXp-Span-192">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">C</span><span class="MJXp-mtext" id="MJXp-Span-199">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">u</span><span class="MJXp-msubsup" id="MJXp-Span-202"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">N</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">n</span><span class="MJXp-mo" id="MJXp-Span-206">=</span><span class="MJXp-mn" id="MJXp-Span-207">1</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-211">1</span><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-215" style="vertical-align: 0.5em;">T</span></span><span class="MJXp-mtext" id="MJXp-Span-216">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">i</span><span class="MJXp-mo" id="MJXp-Span-220" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">x</span><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-223" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">b</span><span class="MJXp-msubsup" id="MJXp-Span-225"><span class="MJXp-mo" id="MJXp-Span-226" style="margin-left: 0em; margin-right: 0.05em;">]</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-227" style="vertical-align: -0.4em;">+</span></span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-229"><span class="MJXp-mo" id="MJXp-Span-230" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-231"><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">w</span><span class="MJXp-mrow" id="MJXp-Span-234"><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-236"><span class="MJXp-mrow" id="MJXp-Span-237" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-239" style="vertical-align: 0.5em;">2</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="44.754ex" height="3.383ex" viewBox="0 -1039.5 19268.9 1456.5" role="img" focusable="false" style="vertical-align: -0.969ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6C" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-61" x="548" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-72" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-67" x="1529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-65" x="2010" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-43" x="2476" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-73" x="3487" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-75" x="3956" y="0"></use><g transform="translate(4529,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-4E" x="1242" y="488"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-3D" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="1379" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-5B" x="6836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-31" x="7115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2212" x="7837" y="0"></use><g transform="translate(8838,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-54" x="1013" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-70" x="10403" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-68" x="10906" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-69" x="11483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-28" x="11828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-78" x="12218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-29" x="12790" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="13402" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-62" x="14403" y="0"></use><g transform="translate(14832,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="393" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-2B" x="15983" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-7C" x="16984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-7C" x="17262" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-77" x="17541" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-7C" x="18257" y="0"></use><g transform="translate(18536,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMAIN-32" x="393" y="675"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> \ large C \ sum_ {n = 1} ^ {N} [1 - w ^ T \ phi (x) + b] _ + + || w || ^ 2 </script></p><br><p>  In terms of Theano, this can be written by replacing several lines in the previous example: </p><br><pre> <code class="python hljs">C = <span class="hljs-number"><span class="hljs-number">10.</span></span> loss = C * T.maximum(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> - linear * (Y * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>)).mean() + T.square(W).sum() predict = theano.function( [X], linear &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, allow_input_downcast=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> )</code> </pre> <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-240"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">C</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.766ex" height="2.057ex" viewBox="0 -780.1 760.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323272/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhBXSycIja6HeGHgFe60qFKnGrZEw#MJMATHI-43" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-11"> C </script>  this is a hyperparameter that regularizes the model, and the expression <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-242"><span class="MJXp-mo" id="MJXp-Span-243" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">Y</span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mn" id="MJXp-Span-246">2</span><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-248">1</span><span class="MJXp-mo" id="MJXp-Span-249" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> (Y * 2 - 1) </script>  just translates tags into a range <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-250"><span class="noError" id="MJXp-Span-251" style="display: inline-block;">\&nbsp;{-&nbsp;1,&nbsp;1&nbsp;\}</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> \ {- 1, 1 \} </script><br><p>  For selected C, the classifier will divide the space as follows: </p><br><p><img src="https://habrastorage.org/files/2f8/d33/ce6/2f8d33ce6b01442b8cce8794d8637b3c.png" alt="svc decision boundary"></p><br><h3 id="nelineynye-priznaki">  Nonlinear signs </h3><br><p>  Cycles are one of the most commonly used constructs in programming.  Cycle support in Theano is provided by the <a href="http://deeplearning.net/software/theano/library/scan.html">scan</a> function  Let's get acquainted with how it works.  I think it is already obvious to readers that the linear function of the signs is not the best candidate for the separation of the generated data.  This disadvantage can be corrected by adding polynomial signs to the original ones (this technique is described in detail in <a href="https://habrahabr.ru/company/ods/blog/322076/">another article of</a> our blog).  So, I want to get a view conversion <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-252"><span class="noError" id="MJXp-Span-253" style="display: inline-block;">\&nbsp;{x_1,&nbsp;x_2&nbsp;\}&nbsp;\&nbsp;rightarrow&nbsp;\&nbsp;bigcup&nbsp;\&nbsp;limits_&nbsp;{i&nbsp;=&nbsp;0}&nbsp;^&nbsp;{i&nbsp;=&nbsp;K}&nbsp;\&nbsp;{x_1&nbsp;^&nbsp;i,&nbsp;x_2&nbsp;^&nbsp;i&nbsp;\}</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> \ {x_1, x_2 \} \ rightarrow \ bigcup \ limits_ {i = 0} ^ {i = K} \ {x_1 ^ i, x_2 ^ i \} </script>  .  In python, we could implement it, for example, like this: </p><br><pre> <code class="python hljs">poly = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(K): poly.extend([x**i <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> features])</code> </pre> <br><p>  In Theano, it looks like this: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poly</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, degree=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> result, updates = theano.scan( <span class="hljs-comment"><span class="hljs-comment">#  ,      fn=lambda prior_result, x: prior_result * x, #    outputs_info=T.ones_like(x), # ,  x       fn non_sequences=x, #   n_steps=degree) #      N x M*degree return result.dimshuffle(1, 0, 2).reshape((result.shape[1], result.shape[0] * result.shape[2]))</span></span></code> </pre> <br><p>  The first in <code>scan</code> is the function that will be called at each iteration, its first argument is the result at the previous iteration, the next are all <code>non_sequences</code> ;  <code>outputs_info</code> initializes the output tensor of the same dimension and type as <code>x</code> , and fills it with units;  <code>n_steps</code> indicates the required number of iterations. </p><br><p>  <code>scan</code> will return the result in the form of a size tensor <code>(n_steps, ) + outputs_info.shape</code> , so we will convert it into a matrix in order to get the necessary attributes. </p><br><p>  We illustrate the operation of the resulting expression with a simple example: </p><br><pre> <code class="hljs json">[[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], -&gt; [[ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>], [<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>], -&gt; [ <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>], [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]] -&gt; [ <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>]]</code> </pre> <br><p>  To reap the benefits of your efforts, it is enough to change the definition of the model and add parameters (there are more signs): </p><br><pre> <code class="python hljs">W = theano.shared( value=numpy.zeros((<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>),dtype=theano.config.floatX), name=<span class="hljs-string"><span class="hljs-string">'W'</span></span>) linear = T.dot(poly(X, degree=<span class="hljs-number"><span class="hljs-number">4</span></span>), W) + b</code> </pre> <br><p>  New features make it much better to divide classes: <br><img src="https://habrastorage.org/files/cb2/e5b/7c7/cb2e5b7c791a45218490b6dfc92dfd4e.png" alt="svc decision boundary"></p><br><h2 id="neyronnye-seti-i-lasagnea-href3sup3supaanchorsrc3anchor">  Neural Networks and Lasagne <a href="https://habr.com/ru/company/ods/blog/323272/"><sup>3</sup></a> <a name="src3"></a></h2><br><p>  At this point, we have already discussed the main stages of creating Theano machine learning systems: initializing input variables, defining a model, compiling Theano functions, a cycle with optimizer steps.  This could be the end of it, but I really want to acquaint readers with <a href="https://github.com/Lasagne/Lasagne">Lasagne</a> - a wonderful library for neural networks running on top of Theano.  Lasagne provides a set of ready-made components: layers, optimization algorithms, loss functions, initialization of parameters, etc., while not hiding Theano behind numerous layers of abstractions. </p><br><p>  Consider what a typical code on Theano / Lasagne might look like using the MNIST classification as an <a href="http://yann.lecun.com/exdb/mnist/">example</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Sample images from MNIST, if you haven't seen them yet.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c97/1a7/c91/c971a7c91ea2492eabc2713fe0dfd524.jpg"></div></div><br><p>  We construct a multilayer perceptron with two hidden layers of 800 neurons each, for regularization we will use a dropout and place this code in a separate function: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build_mlp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(input_var=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  ,    # (  minibatch'a, 1 , 28   28 ) #        , #        network = lasagne.layers.InputLayer( shape=(None, 1, 28, 28), input_var=input_var) # dropout  20%    network = lasagne.layers.DropoutLayer(network, p=0.2) #    800   ReLU    #    ,  Xavier Glorot  Yoshua Bengio network = lasagne.layers.DenseLayer( network, num_units=800, nonlinearity=lasagne.nonlinearities.rectify, W=lasagne.init.GlorotUniform()) #  dropout   50%: network = lasagne.layers.DropoutLayer(network, p=0.5) #      network = lasagne.layers.DenseLayer( network, num_units=800, nonlinearity=lasagne.nonlinearities.rectify) network = lasagne.layers.DropoutLayer(network, p=0.5) # ,    10 : network = lasagne.layers.DenseLayer( network, num_units=10, nonlinearity=lasagne.nonlinearities.softmax) return network</span></span></code> </pre> <br><p>  We get just such a simple mesh network: </p><br><img src="https://habrastorage.org/files/08e/ad3/d95/08ead3d95552495985cecd768d93022b.png"><br><p><br>  Initialize the tensor variables and compile the Theano functions for learning and validation: </p><br><pre> <code class="python hljs">input_var = T.tensor4(<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>) target_var = T.ivector(<span class="hljs-string"><span class="hljs-string">'targets'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#      network = build_mlp(input_var) #      ,   prediction = lasagne.layers.get_output(network) #    loss = lasagne.objectives.categorical_crossentropy(prediction, target_var).mean() #     L1  L2 , . lasagne.regularization. #        #    keyword ,      #     trainable  regularizable params = lasagne.layers.get_all_params(network, trainable=True) #         updates = lasagne.updates.nesterov_momentum( loss, params, learning_rate=0.01, momentum=0.9) #        . #       deterministic=True, #   dropout test_prediction = lasagne.layers.get_output(network, deterministic=True) test_loss = T.nnet.categorical_crossentropy(test_prediction, target_var).mean() #     test_acc = T.mean( T.eq(T.argmax(test_prediction, axis=1), target_var), dtype=theano.config.floatX) #     train = theano.function( inputs=[input_var, target_var], outputs=loss, updates=updates) #   ‚Äî   #  Theano  ,        #      validate = theano.function( inputs=[input_var, target_var], outputs=[test_loss, test_acc])</span></span></code> </pre> <br><p>  Now create a learning cycle: </p><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"| Epoch | Train err | Validation err | Accuracy | Time |"</span></span>) print(<span class="hljs-string"><span class="hljs-string">"|------------------------------------------------------------------------|"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>): <span class="hljs-comment"><span class="hljs-comment">#         train_err = 0 train_batches = 0 start_time = time.time() for batch in iterate_minibatches(X_train, y_train, 500, shuffle=True): inputs, targets = batch train_err += train(inputs, targets) train_batches += 1 #     val_err = 0 val_acc = 0 val_batches = 0 for batch in iterate_minibatches(X_val, y_val, 500, shuffle=False): inputs, targets = batch err, acc = validate(inputs, targets) val_err += err val_acc += acc val_batches += 1 print("|{:05d} | {:4.5f} | {:16.5f} | {:10.2f} | {:7.2f} |".format (epoch, train_err / train_batches, val_err / val_batches, val_acc / val_batches * 100, time.time() - start_time)) except KeyboardInterrupt: print("The training was interrupted on epoch: {}".format(epoch))</span></span></code> </pre> <br><p>  The resulting learning curves: </p><br><img src="https://habrastorage.org/files/2a5/010/fdd/2a5010fddddb45d1b7d4319c89d356cd.png"><br><p><br>  Our model achieves an accuracy of more than 98%, which can undoubtedly be improved using, for example, convolutional neural networks, but this topic is already beyond the scope of this article. </p><br><p>  It is convenient to save and load weights with the help of helpers: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   savez('model.npz', *lasagne.layers.get_all_param_values(network)) network = build_mlp() #  ,  : with np.load('model.npz') as f: param_values = [f['arr_%d' % i] for i in range(len(f.files))] lasagne.layers.set_all_param_values(network, param_values)</span></span></code> </pre> <br><p>  Documentation for Lasagne is available <a href="http://lasagne.readthedocs.io/en/latest/">here</a> , a lot of examples and pre-trained models are in a separate <a href="https://github.com/Lasagne/Recipes">repository</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  In this post, we are quite superficially acquainted with the possibilities of Theano, you can learn more: </p><br><ul><li>  referring to the documentation: <a href="http://deeplearning.net/software/theano/tutorial/">1</a> , <a href="http://deeplearning.net/software/theano/index.html">2</a> </li><li>  looking at <a href="http://deeplearning.net/tutorial/">code samples</a> </li><li>  communicating with the <a href="https://groups.google.com/forum/">community</a> </li><li>  looking at the <a href="https://github.com/Theano/Theano">source code</a> . </li></ul><br><p>  Big thanks to <a href="https://habrahabr.ru/users/bauchgefuehl/" class="user_link">bauchgefuehl</a> for help in preparing the post. </p><br><hr><br><a name="1"></a>  <a href="https://habr.com/ru/company/ods/blog/323272/">1.</a> The border between the two approaches is rather blurred, and not everything said below is strictly true, there are always exceptions and borderline cases.  Our task here is to convey the main idea. <br><a name="2"></a>  <a href="https://habr.com/ru/company/ods/blog/323272/">2.</a> The Theano developers in the technical <a href="https://arxiv.org/abs/1605.02688">report</a> and documentation call character differentiation.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, the use of this term in one of the previous articles on Habr caused a </font></font><a href="https://habrahabr.ru/company/microsoft/blog/313318/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Based on the Theano source code and the </font></font><a href="https://en.wikipedia.org/wiki/Automatic_differentiation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definition</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on Wikipedia, the author believes that the correct term is still ‚Äúautomatic differentiation‚Äù.</font></font><br><a name="3"></a> <a href="https://habr.com/ru/company/ods/blog/323272/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. The</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> material in this section is mostly based on </font><font style="vertical-align: inherit;">Lasagne </font></font><a href="http://lasagne.readthedocs.io/en/latest/user/tutorial.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/323272/">https://habr.com/ru/post/323272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323260/index.html">Women's Day Gift by FPGA</a></li>
<li><a href="../323262/index.html">Implementing HQoS on Juniper MX80 / MX104 fixed ports</a></li>
<li><a href="../323266/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ252 (March 27 - 5, 2017)</a></li>
<li><a href="../323268/index.html">8 best extensions for WordPress to improve the menu on your site</a></li>
<li><a href="../323270/index.html">Forms and custom input fields in Angular 2+</a></li>
<li><a href="../323276/index.html">Discipline, Accuracy, Attention to Detail</a></li>
<li><a href="../323278/index.html">Visual Studio 2017 Launch Live Webcast</a></li>
<li><a href="../323280/index.html">The work of the writer in video games</a></li>
<li><a href="../323284/index.html">Release of 3CX V15 SP5 and client updates for macOS and iOS</a></li>
<li><a href="../323286/index.html">IBM will add deep learning for mainframes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>