<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Uploading data to Sharepoint lists</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing SharePoint solutions, there is often a task, in addition to automatically expanding the site structure (fields, content types, lists),...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Uploading data to Sharepoint lists</h1><div class="post__text post__text-html js-mediator-article"> When developing SharePoint solutions, there is often a task, in addition to automatically expanding the site structure (fields, content types, lists), and also to fill it with basic content.  These can be mainly reference lists.  But, in addition to this, there may be a need to fill them with some kind of test data in order to test the solution, including the load one. <br><br>  There is a way to fill lists with data, specifying them in an XML file to ListInstance.  But this approach is less convenient than that considered in the article.  ListDefinitions are not always practical to use for creating lists, besides there may be a need to fill lists that already exist on the site, rather than being expanded from a solution. <br><br>  So, the idea is in the following logic: <br><a name="habracut"></a><br>  creating tables with data in Excel, <br>  export data from Excel to XML, <br>  adding XML files to a Visual Studio project, <br>  parsing XML file contents and adding data to the lists in the receiver features for activation. <br>  Using Excel is quite convenient.  First, the data there is easy to fill;  You can create copies of different lines by simply stretching them with the mouse;  You can write different formulas to give randomness values ‚Äã‚Äãfor testing purposes, etc.  And most importantly, it is in this form that the reference information is usually sent by the customer, that is, it will be much easier for him to prepare information on your request in Excel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sequencing: <br><br>  1. Create in Excel-book on a separate sheet a table with data. <br><br>  2. Create an .xsd file that will represent the data schema in the following format: <br><br> <code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; <br> &lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt; <br> &lt;xs:element name="Currencies"&gt; <br> &lt;xs:complexType&gt; <br> &lt;xs:sequence&gt; <br> &lt;xs:element ref="Currency" minOccurs="0" maxOccurs="unbounded"/&gt; <br> &lt;/xs:sequence&gt; <br> &lt;/xs:complexType&gt; <br> &lt;/xs:element&gt; <br> &lt;xs:element name="Currency"&gt; <br> &lt;xs:complexType&gt; <br> &lt;xs:sequence&gt; <br> &lt;xs:element name="Title" type="xs:string"/&gt; <br> &lt;xs:element name="Currency_IsNational" type="xs:string"/&gt; <br> &lt;/xs:sequence&gt; <br> &lt;/xs:complexType&gt; <br> &lt;/xs:element&gt; <br> &lt;/xs:schema&gt; <br></code> <br>  For convenience, call the root element as your list is called on the site (or as the main part of its address).  I called this element Currencies.  When parsing XML you can immediately use this name to access the desired list. <br><br>  Specify the name of the fields in accordance with the InternalName of the fields in the desired list (in the example above, this is Title and Currency_IsNational). <br><br>  Also do not be embarrassed that the value type is ‚Äúxs: string‚Äù.  When parsing XML, you will still receive string values, which will be converted to the correct type when writing to the SPListItem object. <br><br>  If you need to use more complex types, like User, then specify in the Excel table, for example, the login name, and in the code perform additional conversion in SPFieldUserValue.  This will be further demonstrated. <br><br>  3. Activate the tab "Developer" in Excel. <br><br>  4. On this tab, click the "Source" button: <br><br>  5. In the panel that appears, click the "XML Maps" button: <br><br>  6. Click the Add button and add the .xsd file you created earlier: <br><br>  7. After adding the scheme, select the table header in Excel and click in the panel on the right in the data tree ‚ÄúMatch Element‚Äù: <br><br>  This way you map your data schema to your table.  Now it can be exported to XML. <br><br>  8. Click ‚ÄúExport‚Äù and save the .xml file: <br><br>  The exported file will look something like this: <br><br>  9. Follow the steps above for all the tables that you are going to upload to the site. <br><br>  10. Create a Module in your Visual Studio project and add all .xml files with data created this way to it.  Call it for example InitialData. <br><br>  Do not forget to include the module in the feature. <br><br>  11. When a feature is activated, a folder with the name InitialData will be created on the site, where the .xml files will be added. <br><br>  12. Next, in the receiver of feature activation, add logic for parsing these xml files and creating items in the necessary lists. <br><br>  By the time these actions are completed, the lists should already exist on the site with all the required fields.  In this case, you can fill with data lists that already contain other data. <br><br>  The method below goes through all the xml files in the InitialData folder and calls the ImportToSPList method for each. <br><br> <code>public void Import() <br> { <br> // _siteUrl -    <br> using (SPSite site = new SPSite(_siteUrl)) <br> { <br> SPWeb web = site.RootWeb; <br> // _initialDataFolderName -   (,   ) <br> SPFolder initialDataFolder = web.RootFolder.SubFolders[_initialDataFolderName]; <br> <br> foreach (SPFile file in initialDataFolder.Files) <br> { <br> if (file.Name.EndsWith(".xml", StringComparison.CurrentCultureIgnoreCase)) <br> { <br> using (MemoryStream inStream = new MemoryStream(file.OpenBinary())) <br> { <br> using (XmlTextReader reader = new XmlTextReader(inStream)) <br> { <br> XmlDocument xd = new XmlDocument(); <br> xd.Load(reader); <br> <br> ImportToSPList(web, xd); <br> } <br> } <br> } <br> } <br> } <br> } <br> <br>   ImportToSPList         xml,    .     , ,  ,   SPListItem,           SPListItem'. <br> <br> private void ImportToSPList(SPWeb web, XmlDocument xd) <br> { <br> XmlElement root = xd.DocumentElement; <br> //  .       <br> string rootName = root.LocalName; <br> string listUrl = String.Format("Lists/{0}/AllItems.aspx", rootName); <br> SPList list = web.GetListFromUrl(listUrl); <br> <br> foreach (XmlNode item in root.ChildNodes) <br> { <br> SPListItem spListItem = list.AddItem(); <br> //    <br> foreach (XmlNode field in item.ChildNodes) <br> { <br> //         <br> DataImportSpecialRule specialRule = <br> _diSpecialRules.FirstOrDefault(x =&gt; x.ListUrl == listUrl &amp;&amp; x.FieldName == field.LocalName); <br> if (specialRule == null) <br> { <br> //   ,     <br> spListItem[field.LocalName] = field.InnerText; <br> } <br> else <br> { <br> //      - <br> spListItem[field.LocalName] = specialRule.Converter(web, field.InnerText); <br> } <br> } <br> //   <br> spListItem.Update(); <br> } <br> } <br></code> <br>  Also note the auxiliary class DataImportSpecialRule, which is needed to convert string values ‚Äã‚Äãfrom xml to a more complex type, if required. <br><br>  Here is the DataImportSpecialRule class itself, which stores the address of the list, the name of the field, and the function to convert: <br><br> <code>public delegate object GetTypedValue(SPWeb web, string value); <br> <br> class DataImportSpecialRule <br> { <br> public string ListUrl { get; set; } <br> public string FieldName { get; set; } <br> public GetTypedValue Converter { get; set; } <br> }</code> <br>  The function has the signature described in the GetTypedValue delegate.  It accepts SPWeb and a string value as input, and returns an object to be recorded in the SPListItem field. <br><br>  Initially, you can describe all the rules that should be applied to all your directories, as shown in the example: <br><br> <code><code>_diSpecialRules = new List() <br> { <br> new DataImportSpecialRule() <br> { <br> ListUrl = "Lists/BusinessBlocks/AllItems.aspx", <br> FieldName = "BusinessBlock_Group", <br> Converter = (SPWeb web, string value) =&gt; <br> { <br> SPGroup group = web.SiteGroups[value]; <br> return new SPFieldUserValue(web, group.ID, group.Name); <br> } <br> } <br> //     <br> }; <br> <br>   ,      ,    xml ,    ,     SPListItem  . <br> <br>       .        .   ,   -        . <br> <br> private SPFieldMultiChoiceValue MultiChoiceConverter(SPWeb web, string value) <br> { <br> SPFieldMultiChoiceValue fValue = new SPFieldMultiChoiceValue(); <br> foreach (string choice in value.Split(';')) fValue.Add(choice.Trim()); <br> return fValue; <br> }</code> <br> <br>    ,   .       ,     . <br> <br> : <br> <br>  ,    -,    .   ,        ,        xml ,   ,       . <br>             . <br> <br>   <a href="http://sharepoint-channel.com/">SharePoint Channel</a></code> <habracut> <code><code>_diSpecialRules = new List() <br> { <br> new DataImportSpecialRule() <br> { <br> ListUrl = "Lists/BusinessBlocks/AllItems.aspx", <br> FieldName = "BusinessBlock_Group", <br> Converter = (SPWeb web, string value) =&gt; <br> { <br> SPGroup group = web.SiteGroups[value]; <br> return new SPFieldUserValue(web, group.ID, group.Name); <br> } <br> } <br> //     <br> }; <br> <br>   ,      ,    xml ,    ,     SPListItem  . <br> <br>       .        .   ,   -        . <br> <br> private SPFieldMultiChoiceValue MultiChoiceConverter(SPWeb web, string value) <br> { <br> SPFieldMultiChoiceValue fValue = new SPFieldMultiChoiceValue(); <br> foreach (string choice in value.Split(';')) fValue.Add(choice.Trim()); <br> return fValue; <br> }</code> <br> <br>    ,   .       ,     . <br> <br> : <br> <br>  ,    -,    .   ,        ,        xml ,   ,       . <br>             . <br> <br>   <a href="http://sharepoint-channel.com/">SharePoint Channel</a></code> </habracut></div><p>Source: <a href="https://habr.com/ru/post/194800/">https://habr.com/ru/post/194800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194786/index.html">The rules of a "good" IT company</a></li>
<li><a href="../194790/index.html">Economic globalization or how IT is made today</a></li>
<li><a href="../194792/index.html">As I site on powershell parsil</a></li>
<li><a href="../194794/index.html">Student Magazine</a></li>
<li><a href="../194798/index.html">Taxonomy of creative expression</a></li>
<li><a href="../194802/index.html">How to speed up the development of your project with COLT?</a></li>
<li><a href="../194804/index.html">City Electronic Libraries</a></li>
<li><a href="../194806/index.html">SmartProgress 2.0. We have turned goal achievement into an exciting activity.</a></li>
<li><a href="../194808/index.html">Incredible new polymer that heals itself with 97% efficiency.</a></li>
<li><a href="../194810/index.html">Broadcast launch RAD Studio XE5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>