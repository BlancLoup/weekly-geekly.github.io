<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CTFzone write-ups - Shall I reverse it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Friends, the stormy weekend has passed, and we are ready to present you with a new batch of WTAs - this time we will analyze the tasks of the Reverse ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CTFzone write-ups - Shall I reverse it?</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/ad0/1b0/833/ad01b08334d140658e7534783f298066.jpg" alt="image"></p><br><p>  Friends, the stormy weekend has passed, and we are ready to present you with a new batch of WTAs - this time we will analyze the tasks of the <strong>Reverse</strong> branch in detail.  We hope you have already dealt with two tasks from OSINT and are ready to fully immerse yourself in the reverse engineering process.  We promise, it will be interesting;) </p><br><p>  This direction was very popular among the participants - 103 people alone decided on 100 tasks.  However, the task for 1000 remained unresolved.  Therefore, as in the case of OSINT, the kit for the <em>most difficult task CTFzone</em> will be published later in a separate post.  Now drop all your business, and full speed ahead! </p><br><a name="habracut"></a><br><h4 id="reverse_50-console-version-1337">  Reverse_50.  Console version 1.337 </h4><br><blockquote>  <em><strong>AURORA:</strong> SCI430422 LED lights are blinking in hypnotic patterns.</em>  <em>As you know, this system is renowned for its top-notch security measures.</em>  <em>Only the most expert or resourceful hackers are available.</em> </blockquote><p><br>  <strong>Decision:</strong> </p><br><p>  In this task, we needed to get into the console system.  To begin, run the file for execution and see a window with a greeting and an invitation to enter a password: </p><br><p><img src="https://habrastorage.org/files/afc/167/b65/afc167b65ecf4199ad8cc50f72698260.png" alt="image"></p><br><p>  What to do?  Open the file in the OllyDbg debugger and find the line ‚ÄúPlease enter password:‚Äù - in the main window, scroll up to the address 004010F9: </p><br><p><img src="https://habrastorage.org/files/033/a4a/050/033a4a050da541e9b8ed3212ce08ce3e.png" alt="image"></p><br><p>  As you can see, the entered password is checked in the function located at 00401000. Let's try to set a breakpoint at this address (F2 key in OllyDbg), then press F9 (continue execution) and for example, enter some line in the program window: </p><br><p><img src="https://habrastorage.org/files/92c/4d4/4bb/92c4d44bb2ec4df2b342853a26c9c6b9.png" alt="image"></p><br><p>  Press "Enter", and the breakpoint is triggered.  Next, go to OllyDbg and press the F7 key to go inside the function at 00401000: </p><br><p><img src="https://habrastorage.org/files/3a3/61d/4d6/3a361d4d65a249ff88c7b5e386d13805.png" alt="image"></p><br><p>  It can be immediately noticed that at the address 004010CF, the function strcmp () is called from the standard C library. This function compares two strings and returns 0 if the strings are the same.  We set a breakpoint on the function call (F2 key), press F9 (continue execution) and see which other string, besides the ‚Äúpassword123‚Äù entered by us, will be passed to it: </p><br><p><img src="https://habrastorage.org/files/07f/b82/f8e/07fb82f8e65d45e58e455de20be5ef01.png" alt="image"></p><br><p>  In the stack window (and in the register window) we see that the string s1 is equal to "ctfzone {l33t_haxx0r_is_you !! 1}" (without quotes). </p><br><p><img src="https://habrastorage.org/files/2d9/160/b02/2d9160b02c44472bbfb6762b0ca58de0.png" alt="image"></p><br><p>  Here is the flag! </p><br><p>  <strong>Answer:</strong> <em>ctfzone {l33t_haxx0r_is_you !! 1}</em> </p><br><h3 id="reverse_100-the-doors-of-dorun">  Reverse_100.  The doors of dorun </h3><br><blockquote>  * <strong>AURORA:</strong> Lieutenant, your co-pilot was abducted by prison.  They are out for free!  Doors couldn‚Äôt be seen. </blockquote><p>  The inscription on the archivolt read: </p><br><p>  "The Doors of Dorun, Lord of Omega. Speak, friend, and enter. I, Norvy, made them. Calabrimbor of Alpha Centauri drew these signs." </p><br><p>  But be careful and hurry up.  They can be back any moment. * </p><br><p><img src="https://habrastorage.org/files/36c/a24/e26/36ca24e263a54af6afedad64f298eba8.png" alt="image"></p><br><p>  <strong>Decision:</strong> </p><br><p>  In this task, we had to pick up the password to the gate, behind which our co-pilot was held captive.  First of all, we launch CrackMe, and the following window appears on the screen: </p><br><p><img src="https://habrastorage.org/files/09a/3bd/d73/09a3bdd736434248a50d173fef8ac646.png" alt="image"></p><br><p>  Let's try to enter any word and click "Try", but the password does not fit, and we see the following message: </p><br><p><img src="https://habrastorage.org/files/d46/a0c/24c/d46a0c24cbd04c5780a48325b238540d.png" alt="image"></p><br><p>  CrackMe itself is a 64-bit executable file of PE format.  Open it in IdaPro and try to find the line ‚Äúthe door is still closed!‚Äù: </p><br><p><img src="https://habrastorage.org/files/1f8/cc5/1f0/1f8cc51f0758498f9a437601b013b39d.png" alt="image"></p><br><p>  There is only one cross reference to this line: </p><br><p><img src="https://habrastorage.org/files/48e/5ba/a42/48e5baa42b8b43479a55e3bd99113c50.png" alt="image"></p><br><p>  Here is the function in which IdaPro found references to this line: </p><br><p><img src="https://habrastorage.org/files/01d/d8f/508/01dd8f508b8b4e8bac8dd2a9f51cfa5d.png" alt="image"></p><br><p>  Here we also see the encrypted flag (it is easy to make sure that the sub_140001160 function is engaged in decryption) and the function determining the correctness of the password: "sub_1400012C0".  Using GetDlgItemTextW, the string entered in the password field is passed to this function.  Let's analyze this function: </p><br><p><img src="https://habrastorage.org/files/15d/065/dae/15d065dae0e44147a3ceb2ff2696adf6.png" alt="image"></p><br><p>  There is a cycle and two arrays of five elements.  It also checks the length of the entered password: </p><br><p><img src="https://habrastorage.org/files/197/3f1/09d/1973f109d30a4cb086f7dcf4e53d5a3d.png" alt="image"></p><br><p>  After analyzing this function, we see that the four-character password in UTF-16 encoding (encoding for WideChar in Windows) consists of two numbers with the size of DWORD.  Further, we see that the residuals from dividing these numbers by the numbers <em>((1 &lt;&lt; (1 &lt;&lt; i)) + 1) are</em> compared with hard-hitting values. </p><br><p>  It can be noted that <em>((1 &lt;&lt; (1 &lt;&lt; i)) + 1) = 2 ^ (2 ^ i) + 1</em> , and that these are Fermat numbers: 3, 5, 17, 257, 65537. The password check algorithm is further can be reduced to two systems of comparisons: </p><br><pre><code class="bash hljs">X1 % 3 = 0 X1 % 5 = 0 X1 % 17 = 1 X1 % 257 = 241 X1 % 65537 = 995</code> </pre> <br><pre> <code class="bash hljs">X2 % 3 = 1 X2 % 5 = 4 X2 % 17 = 6 X2 % 257 = 104 X2 % 65537 = 413</code> </pre> <br><p>  The Chinese Residue Theorem will help us restore the original numbers.  Solvers of such comparisons can be found on the Internet: </p><br><p><img src="https://habrastorage.org/files/2a3/e91/1d4/2a3e911d41a04670908823b5ca32a248.png" alt="image"></p><br><p><img src="https://habrastorage.org/files/505/b4a/d82/505b4ad825eb4ad4a07edded5785d8b5.png" alt="image"></p><br><p>  So we got two numbers that now need to be converted to the string UTF16.  To do this, you can use Python (while not forgetting the reverse order of bytes): </p><br><p><img src="https://habrastorage.org/files/ef0/4bd/b9f/ef04bdb9fce84f848c05cd7f0c1fa764.png" alt="image"></p><br><p>  Now it remains to verify the result.  Enter this line in the password entry box. </p><br><p><img src="https://habrastorage.org/files/3d8/1e3/fce/3d81e3fceec44748a2201e0c979142ba.png" alt="image"></p><br><p><img src="https://habrastorage.org/files/904/a9d/4bc/904a9d4bc967431ba1973c46c16252bb.png" alt="image"></p><br><p>  That's all!  We opened the gate. </p><br><p>  <strong>Answer:</strong> <em>ctfzone {ch1n4_t0wn}</em> </p><br><h4 id="reverse_300-pythons-urn">  Reverse_300.  Python's urn </h4><br><blockquote>  <em><strong>AURORA:</strong> Lieutenant, the Doors</em>  <em>But we don‚Äôt get it.</em> </blockquote><p><br>  <strong>Decision:</strong> </p><br><p>  After we opened the gate, it turned out that we face the next door.  A new task - a new key :) Let's go! </p><br><p>  Run the file for execution, enter the key, but nothing comes out. </p><br><p><img src="https://habrastorage.org/files/b6b/b71/966/b6bb71966e094753a3e05ab562a97e3e.png" alt="image"></p><br><p>  Let's try to figure it out.  First of all, we should find out what we are dealing with.  To determine the type of executable file, you can use the CFF explorer: </p><br><p><img src="https://habrastorage.org/files/8e9/e80/57e/8e9e8057e534469e8a8cc969432248fc.png" alt="image"></p><br><p>  Obviously, .Net Assembly, Ida and traditional debuggers are powerless in this case.  At this point, you could recall dnSpy - one of the tools that can help in the study of code that uses .Net.  We load into it an executable file. </p><br><p><img src="https://habrastorage.org/files/ec1/630/4e0/ec16304e0ae24189a47f55c651e8ee39.png" alt="image"></p><br><p>  By the name of the main class (PythonMain) and the name of the resources, it can be concluded that this program was written in IronPython.  In the main function, only the .NET assembly from the IPDll.WFCrackMe resource occurs.  You will have to extract a resource with this name and load it into dnSpy. </p><br><p><img src="https://habrastorage.org/files/4a7/cb9/61c/4a7cb961c14a483093b5115ebabf56ff.png" alt="image"></p><br><p>  Everything is much more interesting here, there are even function names.  Immediately suppose that a function with the name ‚ÄúverifyPassword‚Äù checks the password we entered, and to verify this, it is enough to test in the debugger which string will be passed to it as an argument. <br>  Next, we need to understand how the password is verified.  The biggest problem when analyzing code is to deal with the functioning of ‚ÄústrongBox‚Äù and ‚ÄúglobalArrayFromContext‚Äù.  These variables are actually filled in the " <code>__main__</code> " function. </p><br><p>  Consider the reversePassword reversal process using the example of a small piece of code with branching: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((arg = (CallSite&lt;Func&lt;CallSite, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">37</span></span>]).Target(arg, (arg2 = (CallSite&lt;Func&lt;CallSite, CodeContext, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">38</span></span>]).Target(arg2, globalContext, globalArrayFromContext[<span class="hljs-number"><span class="hljs-number">26</span></span>].get_CurrentValue(), password), <span class="hljs-number"><span class="hljs-number">81</span></span>)) { num = <span class="hljs-number"><span class="hljs-number">73</span></span>; num = <span class="hljs-number"><span class="hljs-number">73</span></span>; result = globalArrayFromContext[<span class="hljs-number"><span class="hljs-number">16</span></span>].get_CurrentValue(); }</code> </pre> <br><p>  First of all, we need to substitute the values ‚Äã‚Äãin the places ‚ÄústrongBox‚Äù and ‚ÄúglobalArrayFromContext‚Äù.  Values ‚Äã‚Äãare taken from the following lines " <code>__main__</code> ": </p><br><pre> <code class="cs hljs">strongBox.Value[<span class="hljs-number"><span class="hljs-number">38</span></span>] = CallSite&lt;Func&lt;CallSite, CodeContext, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;.Create(PythonOps.MakeInvokeAction($globalContext, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallSignature(<span class="hljs-number"><span class="hljs-number">1</span></span>))); strongBox.Value[<span class="hljs-number"><span class="hljs-number">37</span></span>] = CallSite&lt;Func&lt;CallSite, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;.Create(PythonOps.MakeComboAction($globalContext, PythonOps.MakeBinaryOperationAction($globalContext, ExpressionType.NotEqual), PythonOps.MakeConversionAction($globalContext, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>)));</code> </pre> <br><p>  If there is no confidence in the correctness of the value obtained for ‚ÄústrongBox‚Äù, it can be checked in the debugger.  Substitute the values ‚Äã‚Äãinto the code section under study and simplify it: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NotEqual(len(password), <span class="hljs-number"><span class="hljs-number">81</span></span>)) { result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len(password) != <span class="hljs-number"><span class="hljs-number">81</span></span>) result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><p>  Thus, we found that the password length should be equal to 81 characters.  Further analysis of the function is difficult, since  the function is quite large, but, due to superficial analysis and debugging, we can draw several conclusions: </p><br><ol><li>  With further analysis, we immediately notice the table 9x9 of 81 numbers. </li><li>  When you try to enter as a password a string of 81 characters that contains not only numbers, we will get to handle the exception: ‚ÄúIronPython.Runtime.Exceptions.ValueErrorException: Invalid integer literal‚Äù.  Therefore, it is necessary to enter only numbers. </li><li>  Also, one of the branches will indicate to us that all digits, except 0, must coincide with the digits from the array. </li><li>  Zero cells of the table are filled with the corresponding cells in the entered line. </li></ol><br><p>  Then we get into branching with a terrible, at first glance, condition: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((arg49 = (CallSite&lt;Func&lt;CallSite, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">59</span></span>]).Target(arg49, (!(arg50 = (CallSite&lt;Func&lt;CallSite, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">60</span></span>]).Target(arg50, obj9 = (arg51 = (CallSite&lt;Func&lt;CallSite, CodeContext, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">61</span></span>]).Target(arg51, globalContext, globalArrayFromContext[<span class="hljs-number"><span class="hljs-number">11</span></span>].get_CurrentValue(), obj))) ? obj9 : ((!(arg52 = (CallSite&lt;Func&lt;CallSite, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">62</span></span>]).Target(arg52, obj10 = (arg53 = (CallSite&lt;Func&lt;CallSite, CodeContext, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">63</span></span>]).Target(arg53, globalContext, globalArrayFromContext[<span class="hljs-number"><span class="hljs-number">12</span></span>].get_CurrentValue(), obj))) ? obj10 : (arg54 = (CallSite&lt;Func&lt;CallSite, CodeContext, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;)strongBox.Value[<span class="hljs-number"><span class="hljs-number">64</span></span>]).Target(arg54, globalContext, globalArrayFromContext[<span class="hljs-number"><span class="hljs-number">13</span></span>].get_CurrentValue(), obj))))</code> </pre> <br><p>  After substituting the corresponding values ‚Äã‚Äãand simplifying this condition turns into a simple test: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BoolConvert((!BoolConvert(obj9 = CheckLines(obj))) ? obj9 : ((!BoolConvert(obj10 = checkColumns(obj))) ? obj10 : CheckSquares(obj))))    BoolConvert    ¬´a?b:c¬ª.   : <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(CheckLines(obj) &amp;&amp; heckColumns(obj) &amp;&amp; CheckSquares(obj))</code> </pre> <br><p>  We need to get to the true branch of this condition, i.e.  all functions should return ‚ÄúTrue‚Äù. <br>  Now let's analyze the CheckLines function.  It is quite simple - the function checks that each row contains numbers from 1 to 9. The CheckColumns and CheckSquares functions are more complicated, but at this stage you can already guess that we are dealing with Sudoku: </p><br><p><img src="https://habrastorage.org/files/77e/efd/fcd/77eefdfcd2df417fad966b31fce3f51b.png" alt="image"></p><br><p>  On the Internet, you can find a lot of solvers, so you can practice on your own;) </p><br><p>  So, using the solver, we get the desired key. </p><br><p><img src="https://habrastorage.org/files/720/2b7/250/7202b725028845b0a22cf5bb3517aa75.png" alt="image"></p><br><p>  The door is open! </p><br><p>  <strong>Answer:</strong> <em>ctfzone {1_v3ry_l1k3_5ud0ku_9arm3!}</em> </p><br><p><br></p><br><h4 id="reverse_500-bridge-repair">  Reverse_500.  Bridge repair </h4><br><blockquote>  <em><strong>AURORA:</strong> Lieutenant, watch your step!</em>  <em>There is a pit infested with worms down the road.</em>  <em>It was destroyed.</em>  <em>I have to go and repair the bridge.</em>  <em>Hurry up, we have to save our pilot!</em> </blockquote><p><br>  <strong>Decision:</strong> </p><br><p>  So, in this task you need to save the pilot, but you can only reach it by overcoming the destroyed bridge.  We need to restore it.  The ‚ÄúBridge.txt‚Äù file is proposed as a ‚Äúbridge‚Äù. </p><br><p>  By opening the "Bridge.txt" file in a hex editor, we can make sure that it is encrypted.  From the job description, it is clear that we were provided with a program that encrypted this file, and we need to decrypt it. </p><br><p>  Next, check what is wrong with the file "reverse500.exe".  Run the file, and in response to the console a message appears - "you must specify the file for encryption": </p><br><p><img src="https://habrastorage.org/files/348/323/09c/34832309c6d64544af7ec6a57448b1c4.png" alt="image"></p><br><p>  With the help of cross references, look for the use of this line in the executable file.  To do this, open the file in the IdaPro compiler.  Obviously, the file that is passed as a command line argument is encrypted. </p><br><p><img src="https://habrastorage.org/files/80d/e67/9fe/80de679feb0945bf81bc7fba541e5442.png" alt="image"></p><br><p>  From the above code snippet, you can see that function 401F60 performs encryption. <br>  Having examined this function in a superficial way, we can highlight the functions of allocating memory, reading a file, encrypting the contents of a file, and writing encrypted content to the source file: </p><br><p><img src="https://habrastorage.org/files/2c3/f5d/f05/2c3f5df0559445fb8a2f06a35cf7c3a1.png" alt="image"></p><br><p>  Next, we will try to understand the structure of the encrypted file by examining the simple ‚ÄúWriteCryptedData‚Äù function: </p><br><p><img src="https://habrastorage.org/files/f83/181/7ef/f831817efd894eefbc22f555a3d53e8b.png" alt="image"></p><br><p>  Of course, you can determine the type of hash used, but this is optional.  However, for further work, we need to understand how the hash sums are calculated.  Looking at the ‚ÄúHashCalculate‚Äù function in detail, it becomes obvious that when calculating the hash, 8 bytes of the ‚ÄúIV‚Äù vector are used. <br>  So, we found out that the encrypted file has the following structure: </p><br><p><img src="https://habrastorage.org/files/54e/893/6a0/54e8936a0dc4496eaeb054cb8c4ce7f0.png" alt="image"></p><br><p>  Let's look at the ‚ÄúBridge.txt‚Äù file: </p><br><p><img src="https://habrastorage.org/files/def/b66/297/defb662972d244388f9cc0347ab6ba77.png" alt="image"></p><br><p>  Next, we define the last byte of the vector "IV".  To do this, open the program in the debugger, specifying any file as an argument, and put a breakpoint at the address of the WriteCryptedData function.  After that, having previously corrected the assembler code a little, let's organize the search of the last byte of the vector ‚ÄúIV‚Äù.  The result of the search is shown in the screenshot: </p><br><p><img src="https://habrastorage.org/files/473/15c/f7f/47315cf7f5db4e27a0e6d99ecdf5d122.png" alt="image"></p><br><p>  Now we have the complete vector ‚ÄúIV‚Äù: <em>[47 08 8F E7 C4 C0 E9 AB]</em> . </p><br><p>  Next, you need to check the encryption mode and the symmetry of the cipher used. <br>  Let's go back to the ‚ÄúCryptData‚Äù function in the debugger by submitting a test file to the program (in my case the file contained the string ‚ÄúHelloWorld!‚Äù).  Next, we write the ‚ÄúIV‚Äù vector (located in EAX before calling CryptData) and the encryption result (located in EAX after calling CryptData). </p><br><p><img src="https://habrastorage.org/files/b35/690/a96/b35690a96b404d22bad6c861daefd5be.png" alt="image"></p><br><p>  Verify the identity of the decryption and encryption procedure.  To do this, restart the program under the debugger and re-set the breakpoint on ‚ÄúCryptData‚Äù.  Only now, before its execution, we fix the vector ‚ÄúIV‚Äù and the encrypted buffer. </p><br><p><img src="https://habrastorage.org/files/78a/e61/f5c/78ae61f5cd3147029e4087a7b8a7d620.png" alt="image"></p><br><p>  As a result of re-encryption of encrypted data, we get the source text! </p><br><p>  Now you can decrypt the file from the job.  To do this, remove the first 15 bytes from it and run the program under the debugger, specifying the file with encrypted data as a parameter.  Again, we set the breakpoint on ‚ÄúCryptData‚Äù and, before calling the function, correct the ‚ÄúIV‚Äù vector to [47 08 8F E7 C4 C0 E9 AB].  After correcting the ‚ÄúIV‚Äù vector, press the F9 key, as a result of which the program will encrypt the data.  Delete the first 15 bytes from the resulting file and open it in a text editor: </p><br><p><img src="https://habrastorage.org/files/157/a2c/98a/157a2c98aeb94b898100aad1c7458b48.png" alt="image"></p><br><p>  Flag found! </p><br><p>  <strong>Answer:</strong> <em>ctfzone {3RR4dIC473_7HIS_WORM!}</em> </p><br><p>  <em>PS For those who are interested, we used in this task the Salsa encryption algorithm and the CubeHash hashing algorithm.</em>  <em>But it can be noticed only by an experienced eye;)</em> </p><br><p>  It seems now everything fell into place.  If you have any questions or requests - write to <a href="https://telegram.me/joinchat/Aj-l2UC2XdOvF_ogMsQE0w">our chat in the telegraph</a> and leave comments.  And new knowledge in the field of reverse engineering can be demonstrated at <a href="https://tasks.bi.zone/">this link</a> - tasks will be available until December 15. </p><br><p>  Good luck to everyone and see you soon! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/316420/">https://habr.com/ru/post/316420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316408/index.html">As I recalled the school geometry course</a></li>
<li><a href="../316412/index.html">Remote backup of VMware cloud resources via self-service portal</a></li>
<li><a href="../316414/index.html">Grep all you can</a></li>
<li><a href="../316416/index.html">Global objects and their habitats</a></li>
<li><a href="../316418/index.html">We search and analyze errors in the Orchard CMS code.</a></li>
<li><a href="../316422/index.html">8 tools for creating personal or business chat bot</a></li>
<li><a href="../316426/index.html">Quick Guide how to become a Google Certified Associate Android Developer</a></li>
<li><a href="../316428/index.html">Demo database for PostgreSQL</a></li>
<li><a href="../316430/index.html">The implementation of the protocol MIL-STD-1553 on STM32</a></li>
<li><a href="../316432/index.html">Three simple tips to help improve your icon design.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>