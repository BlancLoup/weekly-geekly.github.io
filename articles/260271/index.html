<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Salad "Microsoft Guide for SymbolTable with a delicate aftertaste Antlr4"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Is it always necessary to use what is offered? 

 Having dealt with the visitor and listener, it's time to try "Bicycle". Studying ways to build exter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Salad "Microsoft Guide for SymbolTable with a delicate aftertaste Antlr4"</h1><div class="post__text post__text-html js-mediator-article">  Is it always necessary to use what is offered? <br><br>  Having dealt with the visitor and listener, it's time to try "Bicycle".  Studying ways to build external DSL, I was faced with the problem of getting practice.  I will not go far to the book Fowler about how to build a dream language "DSL", unfortunately, turned out to be not at all anesthetic, but rather on the back footpath in nettle bushes. <br><br>  Chapter 12 Symbol Table <br><blockquote>  Storage space during the parsing of all <br>  identifiable objects to resolve links. </blockquote><br>  Clear?  Of course it is clear that there are no complaints about the description. <br><blockquote>  Many languages ‚Äã‚Äãhave to refer to objects at many points in the code.  If there is <br>  a language that defines the configuration of tasks and their dependencies means that you need a way <br>  to which one task could refer to dependent tasks in its definition. </blockquote><br><a name="habracut"></a><br>  The book presents the task of collecting for work <br><pre><code class="cs hljs">go_to_work -&gt; drink_coffee dress drink_coffee -&gt; make_coffee wash dress -&gt; wash</code> </pre> <br>  And here‚Äôs the DSL magic, what it is created for, namely, the code does not need to be commented, it‚Äôs enough just to read to determine the dependencies between the tasks. <br>  But I do not drink coffee, and the book ‚ÄúMicrosoft's Guide to Designing Application Architecture‚Äù turned up.  Excellent task - Develop an application for Windows, and now let's do it. <br>  And so MS assures 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This guide will help: <br>  ‚Ä¢ Understand the basic principles and patterns of building architecture and design to develop successful solutions on the Microsoft platform. <br>  ‚Ä¢ Choose the right strategies and design patterns that will help in the design of layers, components, and solution services. <br>  ‚Ä¢ Identify and implement key technical solutions. <br>  ‚Ä¢ Identify and implement key quality indicators and end-to-end functions for the solution. <br>  ‚Ä¢ Choose the right technology to implement the solution. <br>  ‚Ä¢ Create a possible version of the basic solution architecture. <br>  ‚Ä¢ Choose the solutions and guidance offered by the patterns &amp; practices group that will help in the implementation of the solution. <br><br>  Fine.  We have a free to-do list, which after reorganization looks like <br>  1. Understand base principles <br>  2. Select_strategies_and_shavals <br>  3. Implement_key_technical_resolutions <br>  4. Implement_main_quality indicators <br>  5. Select_technology <br>  6. Create_based_variable_base_architecture <br>  7. Choose_of_proposals_and_guides <br><br>  Well, the dependencies between them <br>  6 -&gt; 3 4 5 <br>  2 -&gt; 1 7 <br>  5 -&gt; 7 <br>  7 -&gt; 1 <br>  3 -&gt; 2 5 <br>  4 -&gt; 3 <br><br>  So far, so good. <br><blockquote>  The grammar of this DSL is exceptionally simple. <br><pre> <code class="cs hljs">grammar file... network : SEP? dependency (SEP dependency)* SEP?; dependency : lhs=ID <span class="hljs-string"><span class="hljs-string">'-&gt;'</span></span> rhs+=ID+ {helper.recognizedDependency($lhs, $rhs);} ;</code> </pre></blockquote><br>  And it's all?  What is SEP, what is ID?  Well, not really, I just recently started to deal with grammar, but generally with an external DSL that is different from simple XML.  Behind this came the pit.  After 60 pages of paging, I saw <br><pre> <code class="cs hljs">SEP : (<span class="hljs-string"><span class="hljs-string">'-'</span></span> | <span class="hljs-string"><span class="hljs-string">' '</span></span> );</code> </pre><br>  Through another 50 <br><pre> <code class="cs hljs">fragment LETTER : (<span class="hljs-string"><span class="hljs-string">'a'</span></span>.<span class="hljs-number"><span class="hljs-number">.'</span></span>z<span class="hljs-string"><span class="hljs-string">' | '</span></span>A<span class="hljs-string"><span class="hljs-string">'..'</span></span>Z<span class="hljs-string"><span class="hljs-string">' | '</span></span>_<span class="hljs-string"><span class="hljs-string">'); fragment DIGIT : ('</span></span><span class="hljs-number"><span class="hljs-number">0'.</span></span><span class="hljs-number"><span class="hljs-number">.'9'</span></span>); ID : LETTER (LETTER | DIGIT)* ;</code> </pre><br>  Tasks are described in Russian, oh and let DSL be on it! <br>  Putting it all together and pretty danced around the encoding for Cyrillic support <br><pre> <code class="cs hljs">grammar WorkGrammar; network : SEP? dependency (SEP dependency)* SEP?; dependency : lhs=ID <span class="hljs-string"><span class="hljs-string">'-&gt;'</span></span> rhs+=ID+; ID : LETTER (LETTER | DIGIT)* ; fragment LETTER : ( <span class="hljs-string"><span class="hljs-string">''</span></span>.<span class="hljs-number"><span class="hljs-number">.'</span></span><span class="hljs-string"><span class="hljs-string">' | '</span></span><span class="hljs-string"><span class="hljs-string">'..'</span></span><span class="hljs-string"><span class="hljs-string">' | '</span></span>_<span class="hljs-string"><span class="hljs-string">' ); fragment DIGIT : ('</span></span><span class="hljs-number"><span class="hljs-number">0'.</span></span><span class="hljs-number"><span class="hljs-number">.'9'</span></span>); SEP : (<span class="hljs-string"><span class="hljs-string">'-'</span></span> | <span class="hljs-string"><span class="hljs-string">' '</span></span> ); WS : [\t\r]+-&gt;skip;</code> </pre><br>  Of course, I‚Äôm not a writer (not a developer), but a reader (user), and as a user, this was not the most pleasant problem (and you don‚Äôt call for those in support; you‚Äôve heard beeps in Google requests, nor did anyone take it). <br>  With grammar apparently all!  F5 spawned Lexer and Parser! <br>  Task something to call the class well, not very good, so just Work <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Work</span></span> { List&lt;Work&gt; _dep; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name </span></span></span><span class="hljs-function">)</span></span> { Name = name; _dep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Work&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;Work&gt; Dependencies { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dep; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Completed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddDependency</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Work dep </span></span></span><span class="hljs-function">)</span></span> { _dep.Add( dep ); } }</code> </pre><br>  As it turned out in the <a href="http://habrahabr.ru/post/259691/">Battle ‚ÄúListener vs Visitor‚Äù at the antlr4 stadium, the</a> visitor and the listener are quite small and heavy (although it is possible to use them), as well as for self-education, we try to bypass the tree on the ‚ÄúBicycle‚Äù. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WorksLoader</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, Work&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> WorkGrammarParser.NetworkContext context </span></span></span><span class="hljs-function">)</span></span> { Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Work&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Work&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dep <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> context.dependency() ) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> work = GetWork( dep.lhs.Text, result ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dep._rhs ) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> depWork = GetWork( right.Text, result ); work.AddDependency( depWork ); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-function">Work </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWork</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Work&gt; works </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !works.ContainsKey( name ) ) works[name] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Work( name ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> works[name]; } }</code> </pre><br>  The possibilities of Antlr4 to generate contexts are encouraging, it greatly simplifies the traversal. <br>  A class with the Load method that returns a table of characters (a dictionary of jobs) with already defined dependencies. <br>  The time has come for the most interesting source code. <br><pre> <code class="cs hljs">____ -&gt; ___ ___ _ ___ -&gt; __ ____ _ -&gt; ____ ____ -&gt; __ ___ -&gt; ___ _ ___ -&gt; ___</code> </pre><br>  Not very readable delimiters (if you shorten the names of the works, it is quite) well, okay, this is many times better A -&gt; BC <br>  Defining the text of our language in the resources, you can get a list of works <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args </span></span></span><span class="hljs-function">)</span></span> { AntlrInputStream input = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AntlrInputStream(Resource.Input); WorkGrammarLexer lexer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WorkGrammarLexer( input ); CommonTokenStream tokens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommonTokenStream( lexer ); WorkGrammarParser parser = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WorkGrammarParser( tokens ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> works = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WorksLoader().Load( parser.network()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ready = GetReadyWorks(works); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, Work&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReadyWorks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Work&gt; works </span></span></span><span class="hljs-function">)</span></span> { Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Work&gt; ready = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Work&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentWork <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> works.Select(e=&gt;e.Value) ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( currentWork.Dependencies.Count() == <span class="hljs-number"><span class="hljs-number">0</span></span> || currentWork.Dependencies.All( e =&gt; e.Completed ) ) ready[currentWork.Name] = currentWork; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ready; } }</code> </pre><br>  F5!  Works!  If ... The result is not the one that was expected.  Having spent a fair amount of time identifying the problem -&gt; the ambush settled where no one expected it -&gt; grammar.  In general, it‚Äôs not real, not only is it not complete and there are no source materials, it‚Äôs also with errors.  Outrageous! <br>  Working grammar <br><pre> <code class="cs hljs">grammar WorkGrammar; network : SEP? dependency (<span class="hljs-string"><span class="hljs-string">'\n'</span></span> dependency)*; dependency : lhs=ID <span class="hljs-string"><span class="hljs-string">'-&gt;'</span></span> rhs+=ID+; ID : LETTER (LETTER | DIGIT)* ; fragment LETTER : ( <span class="hljs-string"><span class="hljs-string">''</span></span>.<span class="hljs-number"><span class="hljs-number">.'</span></span><span class="hljs-string"><span class="hljs-string">' | '</span></span><span class="hljs-string"><span class="hljs-string">'..'</span></span><span class="hljs-string"><span class="hljs-string">' | '</span></span>_<span class="hljs-string"><span class="hljs-string">' ); fragment DIGIT : ('</span></span><span class="hljs-number"><span class="hljs-number">0'.</span></span><span class="hljs-number"><span class="hljs-number">.'9'</span></span>); SEP : (<span class="hljs-string"><span class="hljs-string">'-'</span></span> | <span class="hljs-string"><span class="hljs-string">' '</span></span> ); WS : [\t\r]+-&gt;skip;</code> </pre><br><br>  When developing DSL on Antlr4 from the book of Fowler, the feelings are two-sided, taste with bitterness, description on one side, text at a height, on the other, besides the fact that you cannot find examples in C #, it‚Äôs also difficult to study the search for parts of the description in these sections, Bugs that the developer carefully scattered here and there. <br><br><h4>  PS </h4><br>  Is it always necessary to use what is offered? <br>  My opinion is that if time permits, then it is better to write your own classes to crawl trees!  Although much depends on the task itself. </div><p>Source: <a href="https://habr.com/ru/post/260271/">https://habr.com/ru/post/260271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260253/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ164 (June 8 - 14, 2015)</a></li>
<li><a href="../260255/index.html">"Big battalions" in continuous time (battle simulation)</a></li>
<li><a href="../260257/index.html">PHP Digest 64 - interesting news, materials and tools (June 1 - 14, 2015)</a></li>
<li><a href="../260259/index.html">Ingredients of IoT Fast Food Delicacies: Intel Edison + Intel XDK + JavaScript + Grove Kit</a></li>
<li><a href="../260269/index.html">Antivirus Self-Defense</a></li>
<li><a href="../260273/index.html">Challenge the tradition of hi-fi. Digital potentiometers in detail. Part two</a></li>
<li><a href="../260275/index.html">How we made the best release tracker tracker</a></li>
<li><a href="../260277/index.html">That the site did not fall: an economical method</a></li>
<li><a href="../260279/index.html">Do we really need start-ups for large corporations</a></li>
<li><a href="../260285/index.html">Analysis of the tasks of the qualifying round of RCC 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>