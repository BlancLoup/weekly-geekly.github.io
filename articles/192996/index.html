<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We go for mushrooms after Cppcheck</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After hot discussions about the ‚Äú Big Calculator ‚Äù, I wanted to check out some of the research related projects. The first thing that was found was th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We go for mushrooms after Cppcheck</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/4a6/1b7/b5d/4a61b7b5d6ed4b01e0ff89ce60710c0e.png" alt="PVS-Studio, OpenMS"><br><br>  After hot discussions about the ‚Äú <a href="http://habrahabr.ru/company/pvs-studio/blog/192624/">Big Calculator</a> ‚Äù, I wanted to check out some of the research related projects.  The first thing that was found was the open-source project OpenMS associated with protein mass spectrometry.  This project turned out to be written with a serious approach.  When developing it is used at least Cppcheck.  So there was nothing sensational to wait for.  However, there was interest, what errors can PVS-Studio find after Cppcheck.  Interested invite to continue reading the article. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is an OpenMS project.  For what it is, I do not undertake to retell in my own words.  More lyapnu stupidity.  Just to quote a fragment of the description from the site Wikipedia: <br><br>  <i>This is an open-source 2-clause BSD license.</i>  <i>OpenMS has been used for data processing, feature (s), visualization in 1D (spectra or chromatogram), 2D and 3D, map mapping and peptide identification.</i>  <i>It supports label-free and isotopic-label based quantification (such as iTRAQ and TMT and SILAC).</i>  <i>Furthermore, it also supports metabolomics workflows and DIA / SWATH targeted analysis.</i> <br><br>  <i>Original Source: Wikipedia.</i>  <a href="http://www.viva64.com/go.php%3Furl%3D1298">OpenMS</a> <br><br>  The project is medium in size but very complex.  The size of the source code is more than 20 megabytes.  Plus a large number of third-party libraries (Boost, Qt, Zlib, and so on).  The project is very actively used templates.  The source code of the project can be <a href="http://www.viva64.com/go.php%3Furl%3D1300">downloaded from the site SourceForge</a> . <br><br>  When developing an OpenMS project, static code analysis is used.  The presence of "cppcheck.cmake" and comments in the spirit of: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i != peptide.size()) <span class="hljs-comment"><span class="hljs-comment">// added for cppcheck</span></span></code> </pre> <br>  indicates that at least Cppcheck is used.  There is also a mention <a href="http://www.viva64.com/go.php%3Furl%3D1301">Cpplint</a> and there is a file "cpplint.py".  Professional approach.  Well done. <br><br>  Now let's see what can be found with the help of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer. <br><br>  <b><i>Note.</i></b>  <i>For some reason, C ++ files have the extension '* .c'.</i>  <i>So do not be embarrassed when you see a sample code in C ++ located in the '* .c' file.</i> <br><br><h2>  1. Shortcomings with OpenMP </h2><br>  I very rarely come across projects that use <a href="http://www.viva64.com/ru/t/0037/">OpenMP</a> technology.  In general, I sometimes attend thoughts, remove these diagnostics from the analyzer.  Therefore, I was genuinely surprised when I saw the warnings related to OpenMP.  Over the past year, having checked dozens of projects, I have never seen a single warning on that topic.  Wow, someone still uses this technology. <br><br>  Among the warnings issued are false positives, but there were warnings in the case. <br><pre> <code class="cpp hljs">DoubleReal ILPDCWrapper::compute(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... DoubleReal score = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for schedule(dynamic, 1) for (SignedSize i = 0; i &lt; (SignedSize)bins.size(); ++i) { score += computeSlice_(fm, pairs, bins[i].first, bins[i].second, verbose_level); } return score; }</span></span></code> </pre> <br>  PVS-Studio warning: V1205 Data race risk.  Unprotected concurrent operation with the 'score' variable.  ilpdcwrapper.c 213 <br><br>  Incorrectly counted amount.  The variable 'score' is not protected from simultaneous use in different streams. <br><br>  Other comments are not so critical, but still they should pay attention.  Inside parallel sections, all exceptions must be intercepted.  Exceeding the exception outside the parallel section is most likely to lead to the emergency termination of the program.  You can read more about this topic in the notes: " <a href="http://www.viva64.com/ru/b/0008/">OpenMP and exceptions</a> ", " <a href="http://www.viva64.com/ru/b/0024/">Exception handling inside parallel sections</a> ". <br><br>  An exception can be generated explicitly using the throw operator.  It can also occur when calling the operator new (std :: bad_alloc). <br><br>  <b>First option.</b>  The getTheoreticalmaxPosition () function may throw an exception. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Size </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTheoreticalmaxPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;size()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> Exception::Precondition(__FILE__, __LINE__, __PRETTY_FUNCTION__, <span class="hljs-string"><span class="hljs-string">"There must be at least one trace to ......"</span></span>); } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for (SignedSize i = 0; i &lt; (SignedSize)seeds.size(); ++i) { .... f.setMZ( traces[traces.getTheoreticalmaxPosition()].getAvgMZ()); .... } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V1301 The 'throw' keyword cant be try..catch block in a parallel section.  featurefinderalgorithmpickedhelperstructs.h 199 <br><br>  <b>The second option.</b>  Calling the 'new' operator may result in an exception. <br><pre> <code class="cpp hljs">TraceFitter&lt;PeakType&gt;* chooseTraceFitter_(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&amp; tau) { <span class="hljs-comment"><span class="hljs-comment">// choose fitter if (param_.getValue("feature:rt_shape") == "asymmetric") { LOG_DEBUG &lt;&lt; "use asymmetric rt peak shape" &lt;&lt; std::endl; tau = -1.0; return new EGHTraceFitter&lt;PeakType&gt;(); } .... } virtual void run() { .... #pragma omp parallel for for (SignedSize i = 0; i &lt; (SignedSize)seeds.size(); ++i) { .... TraceFitter&lt;PeakType&gt;* fitter = chooseTraceFitter_(egh_tau); .... } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V1302 Try it out.  featurefinderalgorithmpicked.h 1926 <br><br>  Other similar warnings: <ul><li>  V1301 featurefinderalgorithmpicked.h 1261 </li><li>  V1301 mzmlfile.h 114 </li><li>  V1301 rawmssignalsimulation.c 598 </li><li>  V1301 rawmssignalsimulation.c 1152 </li><li>  V1301 chromatogramextractor.h 103 </li><li>  V1301 chromatogramextractor.h 118 </li><li>  V1302 featurefinderalgorithmpicked.h 1931 </li><li>  V1302 rawmssignalsimulation.c 592 </li><li>  V1302 rawmssignalsimulation.c 601 </li><li>  V1302 openswathanalyzer.c 246 </li></ul><br><h2>  2. Typos </h2><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt; &gt; spectra_offsets; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt; &gt; chromatograms_offsets; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> MapType&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MzMLHandler&lt;MapType&gt;::writeFooter_(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ostream&amp; os) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> indexlists; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (spectra_offsets.empty() &amp;&amp; spectra_offsets.empty() ) { indexlists = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!spectra_offsets.empty() &amp;&amp; !spectra_offsets.empty() ) { indexlists = <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { indexlists = <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br>  PVS-Studio warnings: <br><br>  V501 There are identical sub-expressions 'spectra_offsets.empty ()' to the left.  mzmlhandler.h 5288 <br><br>  V501 There are identical sub-expressions "! Spectra_offsets.empty ()"  mzmlhandler.h 5292 <br><br>  Very strange checks.  The container 'spectra_offsets' is checked twice.  Most likely, this is a typo and you should check two different containers: spectra_offsets and chromatograms_offsets. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> MapType&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MzMLHandler&lt;MapType&gt;::characters( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> XMLCh* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> chars, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> XMLSize_t) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (optionalAttributeAsString_(data_processing_ref, attributes, s_data_processing_ref)) { data_.back().meta.setDataProcessing( processing_[data_processing_ref]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { data_.back().meta.setDataProcessing( processing_[data_processing_ref]); } .... }</code> </pre> <br>  PVS-Studio warning: V523 The 'then' statement is equivalent to the 'else' statement.  mzmlhandler.h 534 <br><br>  If you look at similar code fragments, you can conclude that it was necessary to use: <ul><li>  processing_ [data_processing_ref] </li><li>  processing_ [default_processing_] </li></ul><br>  Many typos were associated with the generation of exceptions.  Errors are commonplace.  The 'throw' keyword is forgotten.  It simply creates a temporary object and is immediately destroyed.  An example of such an error: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> UInt </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asUInt_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String &amp; in)</span></span></span><span class="hljs-function"> </span></span>{ UInt res = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Int tmp = in.toInt(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tmp &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { Exception::ConversionError( __FILE__, __LINE__, __PRETTY_FUNCTION__, <span class="hljs-string"><span class="hljs-string">""</span></span>); } res = UInt(tmp); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception::ConversionError) { error(LOAD, String(<span class="hljs-string"><span class="hljs-string">"UInt conversion error of \""</span></span>) + in + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> <br>  PVS-Studio warning: V596 The object was not created.  The 'throw' keyword could be missing: throw ConversionError (FOO);  xmlhandler.h 247 <br><br>  Identical typos here: <ul><li>  inclusionexclusionlist.c 281 </li><li>  inclusionexclusionlist.c 285 </li><li>  precursorionselectionpreprocessing.c 257 </li><li>  modificationsdb.c 419 </li><li>  modificationsdb.c 442 </li><li>  svmtheoreticalspectrumgeneratorset.c 103 </li><li>  logconfighandler.c 285 </li><li>  logconfighandler.c 315 </li><li>  suffixarraytrypticcompressed.c 488 </li><li>  tooldescription.c 147 </li><li>  tofcalibration.c 147 </li></ul><br>  And the last typo I noticed: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Value&lt;Pipe&gt;::Type <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*() { tmp.i1 = *in.in1; tmp.i2 = *in.in2; tmp.i3 = *in.in2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br>  PVS-Studio warning: V525 The code containing the collection of similar blocks.  Check items 'in1', 'in2', 'in2' in lines 112, 113, 114. pipe_joiner.h 112 <br><br>  It should be written: <br><pre> <code class="cpp hljs">tmp.i1 = *in.in1; tmp.i2 = *in.in2; tmp.i3 = *in.in3;</code> </pre> <br><h2>  3. Strange condition </h2><br><pre> <code class="cpp hljs">CompressedInputSource::CompressedInputSource( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String &amp; file_path, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * header, MemoryManager * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> manager) : xercesc::InputSource(manager) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(header) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { head_[<span class="hljs-number"><span class="hljs-number">0</span></span>] = header[<span class="hljs-number"><span class="hljs-number">0</span></span>]; head_[<span class="hljs-number"><span class="hljs-number">1</span></span>] = header[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { head_[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; head_[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br>  PVS-Studio warning: V514 Dividing sizeof a pointer 'sizeof (header)' by another value.  There is a possibility of logical error presence.  compressedinputsource.c 52 <br><br>  If we divide the size of the pointer by the size of a byte, then we always get a value greater than one.  At least I don‚Äôt know the quaint architecture where it‚Äôs not.  So there is some kind of mistake. <br><br>  A similar strange test is available here: compressedinputsource.c 104 <br><br><h2>  4. Returning a link to a local object </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> TStringSet, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> TSpec&gt; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> Iter&lt;TStringSet, ConcatVirtual&lt;TSpec&gt; &gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(Iter&lt;TStringSet, ConcatVirtual&lt;TSpec&gt; &gt; &amp; me, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { Iter&lt;TStringSet, ConcatVirtual&lt;TSpec&gt; &gt; before = me; goNext(me); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> before; }</code> </pre> <br>  PVS-Studio warning: V558 Function returns temporary reference object: before.  iter_concat_virtual.h 277 <br><br>  The function returns a reference to the temporary variable 'before'.  When exiting a function, this variable will be destroyed.  Using a reference to a destroyed object will lead to unpredictable consequences. <br><br>  I think it was necessary not to create a new iterator, but to save the link: <br><pre> <code class="cpp hljs">Iter&lt;TStringSet, ConcatVirtual&lt;TSpec&gt; &gt; &amp;before = me;</code> </pre> <br>  [PS Wrong.  See the comments.] <br><br>  The operator has a similar problem: '-': iter_concat_virtual.h 310 <br><br><h2>  5. Rough calculations </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> Size; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> DoubleReal; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateMeanEstimate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DoubleReal &amp; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">x_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">, DoubleReal &amp; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mean_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Size t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">DoubleReal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mean_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; tmp = <span class="hljs-keyword"><span class="hljs-keyword">mean_t</span></span> + (<span class="hljs-number"><span class="hljs-number">1</span></span> / (t + <span class="hljs-number"><span class="hljs-number">1</span></span>)) * (<span class="hljs-keyword"><span class="hljs-keyword">x_t</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">mean_t</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">mean_t</span></span> = tmp; }</code> </pre> <br>  PVS-Studio warning: V636 The '1 / (t + 1)' expression was implicitly casted from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  masstracedetection.c 129 <br><br>  The expression "(1 / (t + 1))" is always zero or one.  This is due to the fact that this expression is an integer.  Perhaps it was intended to get a completely different result.  I do not know the logic of the program, but I think the following was meant: <br><pre> <code class="cpp hljs">tmp = <span class="hljs-keyword"><span class="hljs-keyword">mean_t</span></span> + (<span class="hljs-number"><span class="hljs-number">1.0</span></span> / (t + <span class="hljs-number"><span class="hljs-number">1</span></span>)) * (<span class="hljs-keyword"><span class="hljs-keyword">x_t</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">mean_t</span></span>);</code> </pre> <br>  I also did not like that instead of the constant M_PI, explicit values ‚Äã‚Äãare used, and not very accurate ones.  This is certainly not a mistake, but not very good.  Example: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> PosteriorErrorProbabilityModel::fit( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; &amp; search_engine_scores) { .... incorrectly_assigned_fit_param_.A = <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">3.14159</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(incorrectly_assigned_fit_param_.sigma, <span class="hljs-number"><span class="hljs-number">2</span></span>)); .... }</code> </pre> <br>  PVS-Studio warning: V624 The constant 3.14159 is being utilized.  The resulting value could be inaccurate.  Consider using the M_PI constant from &lt;math.h&gt;.  posteriorerrorprobabilitymodel.c 92 <br><br>  Similarly: <ul><li>  posteriorerrorprobabilitymodel.c 101 </li><li>  posteriorerrorprobabilitymodel.c 110 </li><li>  posteriorerrorprobabilitymodel.c 155 </li><li>  posteriorerrorprobabilitymodel.c 162 </li></ul><br><h2>  6. Going beyond the array boundary </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Int CHANNELS_FOURPLEX[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Int CHANNELS_EIGHTPLEX[<span class="hljs-number"><span class="hljs-number">8</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-function"><span class="hljs-function">ExitCodes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itraq_type == ItraqQuantifier::FOURPLEX) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Size i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; ++i) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;String, DoubleReal&gt; &gt; one_label; one_label.push_back(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_pair&lt;String, DoubleReal&gt;( String(<span class="hljs-string"><span class="hljs-string">"Channel "</span></span>) + String(ItraqConstants::CHANNELS_FOURPLEX[i][<span class="hljs-number"><span class="hljs-number">0</span></span>]), DoubleReal(ItraqConstants::CHANNELS_FOURPLEX[i][<span class="hljs-number"><span class="hljs-number">0</span></span>]))); labels.push_back(one_label); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">//ItraqQuantifier::EIGHTPLEX { for (Size i = 0; i &lt; 8; ++i) { std::vector&lt;std::pair&lt;String, DoubleReal&gt; &gt; one_label; one_label.push_back(std::make_pair&lt;String, DoubleReal&gt;( String("Channel ") + String(ItraqConstants::CHANNELS_FOURPLEX[i][0]), DoubleReal(ItraqConstants::CHANNELS_FOURPLEX[i][0]))); labels.push_back(one_label); } } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V557 Array overrun is possible.  Itraqanalyzer.c 232 <br><br>  In fact, this error could be attributed to Copy-Paste errors.  But let it be "going beyond the border of the array."  It sounds more frightening.  Anyway, this division is very conditional.  The same error can be classified in different ways. <br><br>  Here, in the 'else' branch, we had to work with the 'CHANNELS_EIGHTPLEX' arrays.  This is evidenced by the comment: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">//ItraqQuantifier::EIGHTPLEX</span></span></code> </pre> <br>  However, the copied code snippet is not completely changed.  As a result, it uses the CHANNELS_FOURPLEX array, which is smaller in size. <br><br>  A similar error here (another Copy-Paste): tmtanalyzer.c 225 <br><br>  Consider another example. <br><pre> <code class="cpp hljs">DoubleReal masse_[<span class="hljs-number"><span class="hljs-number">255</span></span>]; <span class="hljs-comment"><span class="hljs-comment">///&lt; mass table EdwardsLippertIterator::EdwardsLippertIterator(const EdwardsLippertIterator &amp; source) : PepIterator(source), f_file_(source.f_file_), actual_pep_(source.actual_pep_), spec_(source.spec_), tol_(source.tol_), is_at_end_(source.is_at_end_), f_iterator_(source.f_iterator_), f_entry_(source.f_entry_), b_(source.b_), e_(source.e_), m_(source.m_), massMax_(source.massMax_) { for (Size i = 0; i &lt; 256; i++) { masse_[i] = source.masse_[i]; } }</span></span></code> </pre> <br>  PVS-Studio warning: V557 Array overrun is possible.  The value of 'i' index could reach 255. edwardslippertiterator.c 134 <br><br>  The copy constructor does not work correctly with the masse_ array.  It consists of 255 elements.  And copied 256 elements. <br><br>  The correct cycle: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Size i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>; i++) { masse_[i] = source.masse_[i]; }</code> </pre> <br>  Better yet, never use magic constants. <br><br><h2>  7. Obsolete call to the 'new' operator </h2><br><pre> <code class="cpp hljs">svm_problem * LibSVMEncoder::encodeLibSVMProblem(....) { .... node_vectors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> svm_node *[problem-&gt;l]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node_vectors == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] problem-&gt;y; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> problem; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } .... }</code> </pre> <br>  PVS-Studio warning: V668 it was no use.  The exception will be generated in the case of memory allocation error.  libsvmencoder.c 177 <br><br>  The ‚Äúif (node_vectors == NULL)‚Äù check does not make sense.  If you fail to allocate memory, an exception will be raised.  As a result, the program will behave differently than the programmer planned.  For example, a memory leak will occur. <br><br>  Similar outdated revisions: <ul><li>  file_page.h 728 </li><li>  libsvmencoder.c 160 </li></ul><br><h2>  Conclusion </h2><br>  I think it will be useful to use not only Cppcheck, Cpplint, but PVS-Studio.  Especially if you do it regularly.  I invite project developers to write to us at <a href="">support@viva64.com</a> .  For a while we will allocate a key for more detailed verification of OpenMS. </div><p>Source: <a href="https://habr.com/ru/post/192996/">https://habr.com/ru/post/192996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192982/index.html">Launch of LADEE was a sensation in the eastern United States.</a></li>
<li><a href="../192984/index.html">Horizontal scaling of a real project database using SQL Azure Federations</a></li>
<li><a href="../192986/index.html">Update windows 8.1 in RTM and to any "side", with any language and version</a></li>
<li><a href="../192990/index.html">Another "Boilers 2.0", an option with KickStarter`a</a></li>
<li><a href="../192994/index.html">Installing Os X Mountain Lion 10.8.3 on ESXi</a></li>
<li><a href="../192998/index.html">Responsive Android application or 1001 ways to upload a picture</a></li>
<li><a href="../193000/index.html">Artificial Intelligence and Why My Computer Doesn't Understand Me?</a></li>
<li><a href="../193004/index.html">Alternative .sortable - a new solution for sorting the list on jQuery</a></li>
<li><a href="../193008/index.html">Happy Tester!</a></li>
<li><a href="../193016/index.html">New cloud storage feature: creating links to download files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>