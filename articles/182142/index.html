<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The beauty and power of the Qt Graphics View Framework by example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my opinion, Qt Graphics Scene FrameWork is a powerful tool, unfairly deprived of attention on Habr√©. I will try to rectify the situation by devotin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The beauty and power of the Qt Graphics View Framework by example</h1><div class="post__text post__text-html js-mediator-article">  In my opinion, Qt Graphics Scene FrameWork is a powerful tool, unfairly deprived of attention on Habr√©.  I will try to rectify the situation by devoting a series of articles to him.  And in this pilot article, I will show you how to program with this wonderful framework using the example of a more or less real task. <br><a name="habracut"></a><br>  And as such a task, I chose to build graphs.  It has everything: <br><ul><li>  Different types of objects: both text and various combinations of primitives </li><li>  The task of the composition: it is necessary to arrange the title, the captions to the axes, and the coordinate area itself with graphs </li><li>  The tasks of converting from one coordinate to another: from the frame of reference associated with the data into the displayed </li><li>  The interaction between the elements: at least when adding, deleting and changing the schedule update the legend. </li></ul><br>  At once I will make a reservation that the code provided below demonstrates only the main chips used.  The full version, if anyone is curious can take <a href="http://github.com/DancingOnWater/GraphicsScenePlot">here</a> . <br>  The first convenience of the framework opens already at the design stage.  So, the work plan, which is prompted by the architecture of our tool: <br><ol><li>  Let's create a scene on which we will draw graphs: compose axis labels and a coordinate area. </li><li>  Create a grid (And here we decide what we do with the graphs). </li><li>  Create an Item for the chart. </li><li>  Create a legend. </li></ol><br><h5>  First stage.  Creating a composition. </h5><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphicsPlotNocksTube</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QGraphicsItem { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: GraphicsPlotNocksTube(QGraphicsItem *parent): QGraphicsItem(parent){} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateNocks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QList&lt;QGraphicsSimpleTextItem*&gt;&amp; nocks)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QRectF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boundingRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_boundRect;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QPainter *, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStyleOptionGraphicsItem *, QWidget *)</span></span></span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QFont &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">font</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_NocksFont;} <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: QList&lt;QGraphicsSimpleTextItem*&gt; m_nocks; QFont m_NocksFont; QPen m_nockPen; QRectF m_boundRect; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Graphics2DPlotGrid</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QGraphicsItem { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Graphics2DPlotGrid(QGraphicsItem * parent); <span class="hljs-function"><span class="hljs-function">QRectF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boundingRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QRectF &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> axisNumber, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMainGrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> axisNumber, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zero, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSecondaryGrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> axisNumber, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zero, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMainGridPen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPen &amp; pen)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSecondaryGridPen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPen &amp;pen)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> QPen </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mainGridPen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_mainPen;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> QPen </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">secondaryGridPen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_secondaryPen;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QPainter *painter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStyleOptionGraphicsItem *option, QWidget *widget)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AxisGuideLines</span></span></span><span class="hljs-class"> {</span></span> AxisGuideLines(): showLines(<span class="hljs-literal"><span class="hljs-literal">true</span></span>){} QVector&lt;QLineF&gt; lines; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> showLines; }; AxisGuideLines abscissMainLines; AxisGuideLines abscissSecondaryLines; AxisGuideLines ordinateMainLines; AxisGuideLines ordinateSecondaryLines; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paintAxeGuidLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AxisGuideLines&amp; axe, QPainter *painter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPen &amp;linePen)</span></span></span></span>; QPen m_mainPen; QPen m_secondaryPen; QRectF m_rect; }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Graphics2DPlotGrid::paint(QPainter *painter, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStyleOptionGraphicsItem *option, QWidget *widget) { Q_UNUSED(option) Q_UNUSED(widget) paintAxeGuidLines(abscissSecondaryLines, painter, m_secondaryPen); paintAxeGuidLines(abscissMainLines, painter, m_mainPen); paintAxeGuidLines(ordinateSecondaryLines, painter, m_secondaryPen); paintAxeGuidLines(ordinateMainLines, painter, m_mainPen); painter-&gt;setPen(m_mainPen); painter-&gt;drawRect(m_rect); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphicsPlotItemPrivate</span></span></span><span class="hljs-class"> {</span></span> Q_DECLARE_PUBLIC(GraphicsPlotItem) GraphicsPlotItem* q_ptr; GraphicsPlotItemPrivate(GraphicsPlotItem* parent); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateAndSetTransForm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">autoSetRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">autoSetGrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateOrdinateGrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateAbscissGrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAxisRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> axisNumber, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span></span>; Graphics2DPlotGrid * gridItem; QGraphicsSimpleTextItem * abscissText; QGraphicsSimpleTextItem * ordinateText; QGraphicsSimpleTextItem *titleText; QFont titleFont; QFont ordinaateFont; QFont abscissFont; QRectF rect; QRectF m_sceneDataRect; GraphicsPlotLegend *m_legend; GraphicsPlotNocksTube* ordinateMainNocks; GraphicsPlotNocksTube* ordinateSecondaryNocks; GraphicsPlotNocksTube* abscissSecondaryNocks; GraphicsPlotNocksTube* abscissMainNocks; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Range</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> min; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AxisGuideLines</span></span></span><span class="hljs-class"> {</span></span> AxisGuideLines():baseValue(<span class="hljs-number"><span class="hljs-number">0.0</span></span>), step(<span class="hljs-number"><span class="hljs-number">0.0</span></span>){} <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> baseValue; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> step; }; AxisGuideLines abscissMainLines; AxisGuideLines abscissSecondaryLines; AxisGuideLines ordinateMainLines; AxisGuideLines ordinateSecondaryLines; Range abscissRange; Range ordinateRange; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isAutoGrid; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isAutoSecondaryGrid; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> axisNumber, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *max)</span></span></span></span>; };</code> </pre> <br></div></div><br><br>  We compose: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GraphicsPlotItemPrivate::compose() { titleText-&gt;setFont(titleFont); abscissText-&gt;setFont(abscissFont); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(titleText-&gt;boundingRect().width() &gt; rect.width()){ <span class="hljs-comment"><span class="hljs-comment">//TODO case when titleText too long } //Composite by height qreal dataHeight = rect.height() - 2*titleText-&gt;boundingRect().height() - 2*(abscissText-&gt;boundingRect().height()); if(dataHeight &lt; 0.5*rect.height()){ //TODO decrease font size } titleText-&gt;setPos((rect.width()-titleText-&gt;boundingRect().width())/2.0, rect.y()); //Compose by width qreal dataWidth = rect.width()-2*ordinateText-&gt;boundingRect().height(); if(dataWidth&lt; 0.5*rect.width()){ //TODO decrease font size } ordinateMainNocks-&gt;setPos(-ordinateMainNocks-&gt;boundingRect().width(), -5*ordinateMainNocks-&gt;font().pointSizeF()/4.0); m_sceneDataRect.setRect(rect.width()-dataWidth, 2*titleText-&gt;boundingRect().height() , dataWidth, dataHeight); abscissText-&gt;setPos( (dataWidth - abscissText-&gt;boundingRect().width())/2.0 + m_sceneDataRect.y(), rect.bottom() - abscissText-&gt;boundingRect().height()); ordinateText-&gt;setPos(0, (dataHeight - ordinateText-&gt;boundingRect().width())/2.0 + m_sceneDataRect.y()); calculateAndSetTransForm(); q_ptr-&gt;update() }</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Creating a grid </h5><br><br>  Now let's start drawing the grid.  It should be noted that initially it seemed that the labels should be drawn along with the coordinate lines.  However, this approach goes against the declarative ideology of the framework: to describe how an item should look like in the simplest case, and then tell the scene how it should deal with it, and get the perfect picture in any conditions at the output.  And in the end, the layout of the serif was moved to compose. <br><br>  For now, let's do without them and draw a simple grid.  Our main idea: gridItem to draw in the same scale as the data graphs, and let Qt do the translation into the displayed coordinates.  If we now make the schedule a descendant of the gridItem, then we have a ready-made solution: <br><ul><li>  We just need to draw the lines of the graph in the data scale.  They themselves will be displayed in the desired area, and if you add <pre> <code class="cpp hljs">gridItem-&gt;setFlag(QGraphicsItem::ItemClipsChildrenToShape)</code> </pre>  this solves the problem of cropping the graphics </li><li>  All scene events (such as keyboard events or mouse events will automatically be transferred to the data scale, which simplifies their processing. </li></ul><br><br>  Implementation: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Graphics2DPlotGrid::paint(QPainter *painter, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStyleOptionGraphicsItem *option, QWidget *widget) { Q_UNUSED(option) Q_UNUSED(widget) paintAxeGuidLines(abscissSecondaryLines, painter, m_secondaryPen); paintAxeGuidLines(abscissMainLines, painter, m_mainPen); paintAxeGuidLines(ordinateSecondaryLines, painter, m_secondaryPen); paintAxeGuidLines(ordinateMainLines, painter, m_mainPen); painter-&gt;setPen(m_mainPen); painter-&gt;drawRect(m_rect); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Graphics2DPlotGrid::paintAxeGuidLines(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AxisGuideLines&amp; axe, QPainter *painter, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPen &amp;linePen) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(axe.showLines){ painter-&gt;setPen(linePen); painter-&gt;drawLines(axe.lines); } } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GraphicsPlotItemPrivate::calculateAndSetTransForm() { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> scaleX = m_sceneDataRect.width()/gridItem-&gt;rect().width(); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> scaleY = m_sceneDataRect.height()/gridItem-&gt;rect().height(); QTransform transform = QTransform::fromTranslate( - gridItem-&gt;rect().x()*scaleX + m_sceneDataRect.x(), - gridItem-&gt;rect().y()*scaleY +m_sceneDataRect.y()); transform.scale(scaleX, -scaleY); gridItem-&gt;setTransform(transform); ordinateMainNocks-&gt;setTransform(transform); <span class="hljs-comment"><span class="hljs-comment">// ordinateSecondaryNocks-&gt;setTransform(transform); abscissMainNocks-&gt;setTransform(transform); // abscissSecondaryNocks-&gt;setTransform(transform); }</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">calculate the grid</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> GraphicsPlotItemPrivate::calculateOrdinateGrid() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QRectF r = gridItem-&gt;boundingRect(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(r.width()) &lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;::min()*<span class="hljs-number"><span class="hljs-number">5.0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(r.height()) &lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;::min()*<span class="hljs-number"><span class="hljs-number">5.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; QList&lt;QGraphicsSimpleTextItem*&gt; nocksList; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> calculteLine = [&amp;] (AxisGuideLines* guides, QVector&lt;QLineF&gt; *lines) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> minValue; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count; nocksList.clear(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(guides-&gt;step) &gt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;::min()*<span class="hljs-number"><span class="hljs-number">5.0</span></span> ) { k = (ordinateRange.min - guides-&gt;baseValue)/guides-&gt;step; minValue = k*guides-&gt;step+guides-&gt;baseValue; count = (ordinateRange.max - minValue)/guides-&gt;step; <span class="hljs-comment"><span class="hljs-comment">//TODO   ,     if( count &gt;0){ lines-&gt;resize(count); nocksList.reserve(count); double guidCoordinate; for(int i = 0; i&lt; count; i++){ guidCoordinate = minValue+i*guides-&gt;step; lines-&gt;operator[](i) = QLineF(abscissRange.max, guidCoordinate, abscissRange.min, guidCoordinate); nocksList.append(new QGraphicsSimpleTextItem(QString::number(guidCoordinate))); nocksList.last()-&gt;setPos(abscissRange.min, guidCoordinate); } } else lines-&gt;clear(); } else lines-&gt;clear(); }; calculteLine(&amp;ordinateMainLines, &amp;(gridItem-&gt;ordinateMainLines.lines)); ordinateMainNocks-&gt;updateNocks(nocksList); calculteLine(&amp;ordinateSecondaryLines, &amp;(gridItem-&gt;ordinateSecondaryLines.lines)); ordinateSecondaryNocks-&gt;updateNocks(nocksList); }</span></span></code> </pre><br></div></div><br><br>  There is one subtle point: when you increase our gridItem using QTransform, the brush size also grows, so that this does not happen, you need to set QPen as a cosmetic: <br><pre> <code class="cpp hljs"> m_secondaryPen.setCosmetic(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); m_mainPen.setCosmetic(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><br><h5>  Item Graphics </h5><br><div class="spoiler">  <b class="spoiler_title">Class declaration</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphicsDataItem</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QGraphicsObject { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: GraphicsDataItem(QGraphicsItem *parent =<span class="hljs-number"><span class="hljs-number">0</span></span>); ~GraphicsDataItem(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPen&amp; pen)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QPen </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBrush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QBrush &amp; brush)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QBrush </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ordinateRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *max)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abscissRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *max)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp; title)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GraphicsPlot::DataType;} Q_SIGNALS: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataItemChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">penItemChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">titleChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOrdinateRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAbscissRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: Q_DECLARE_PRIVATE(GraphicsDataItem) GraphicsDataItemPrivate *d_ptr; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Graphics2DGraphItem</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GraphicsDataItem { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Graphics2DGraphItem(QGraphicsItem *parent =<span class="hljs-number"><span class="hljs-number">0</span></span>); Graphics2DGraphItem(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *absciss, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *ordinate, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length, QGraphicsItem *parent =<span class="hljs-number"><span class="hljs-number">0</span></span>); ~Graphics2DGraphItem(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *absciss, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ordinate, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; absciss, QList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ordinate)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QVector&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; absciss, QVector&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ordinate)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QRectF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boundingRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QPainter *painter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStyleOptionGraphicsItem *option, QWidget *widget)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: Q_DECLARE_PRIVATE(Graphics2DGraphItem) Graphics2DGraphItemPrivate *d_ptr; };</code> </pre><br></div></div><br>  The implementation of the graph is extremely simple and most of the code is taken up by finding the boundRect boundaries. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Graphics2DGraphItemPrivate</span></span></span><span class="hljs-class"> {</span></span> Q_DECLARE_PUBLIC(Graphics2DGraphItem) Graphics2DGraphItem *q_ptr; Graphics2DGraphItemPrivate(Graphics2DGraphItem *parent):q_ptr(parent){} QVector&lt;QLineF&gt; m_lines; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T absciss, T ordinate, qint32 length)</span></span></span><span class="hljs-function"> </span></span>{ q_ptr-&gt;prepareGeometryChange(); --length; m_lines.resize(length); Range ordinateRange; ordinateRange.min = ordinate[<span class="hljs-number"><span class="hljs-number">0</span></span>]; ordinateRange.max = ordinate[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Range abscissRange; abscissRange.min = absciss[<span class="hljs-number"><span class="hljs-number">0</span></span>]; abscissRange.max = absciss[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i =<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; length; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ordinate[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; ordinateRange.max) ordinateRange.max = ordinate[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ordinate[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; ordinateRange.min ) ordinateRange.min = ordinate[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(absciss[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; abscissRange.max) abscissRange.max = absciss[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(absciss[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; abscissRange.min ) abscissRange.min = absciss[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]; m_lines[i].setLine(absciss[i], ordinate[i], absciss[i+<span class="hljs-number"><span class="hljs-number">1</span></span>], ordinate[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]); } m_boundRect.setRect(abscissRange.min, ordinateRange.min, abscissRange.max - abscissRange.min, ordinateRange.max - abscissRange.min); q_ptr-&gt;setOrdinateRange(ordinateRange.min, ordinateRange.max); q_ptr-&gt;setAbscissRange(abscissRange.min, abscissRange.max); q_ptr-&gt;update(); QMetaObject::invokeMethod(q_ptr, <span class="hljs-string"><span class="hljs-string">"dataItemChange"</span></span>); } QRect m_boundRect; }; QRectF Graphics2DGraphItem::boundingRect() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d_ptr-&gt;m_boundRect; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Graphics2DGraphItem::paint(QPainter *painter, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStyleOptionGraphicsItem *option, QWidget *widget) { Q_UNUSED(option) Q_UNUSED(widget) painter-&gt;setBrush(brush()); painter-&gt;setPen(pen()); painter-&gt;drawLines(d_ptr-&gt;m_lines); }</code> </pre><br><br><h5>  Legend and class interaction </h5><br><br>  In fact, we already have a solution, it is obvious if we pay attention to the fact that <i>GraphicsDataItem is</i> inherited from <i>QGraphicsObject</i> and that signals are already declared in the class body.  Those.  interaction between the objects of the scene occurs in the usual way - through signals and slots. <br><br><h5>  Subjective result </h5><br>  And what do we have in the subjective result? <br><ol><li>  Trouble-free development of architecture, if you follow the logic of the framework. </li><li>  All elements are written in declarative style and the main code refers to the essence and to a large extent to the dancing around. </li><li>  Prostate create item-s to display data </li></ol><br><br><h4>  Qwt comparison and calibration. </h4><br><br>  To evaluate the real convenience and calibrate our subjective feeling let's compare the amount of work done by us and what the respected developers of qwt did: <br><ul><li>  The first thing that catches your eye is the huge listings in drawItem.  Ours much shorter.  We do not need to worry about optimizing the rendering of each member.  We do it once and in one place - when we set the viewport .. </li><li>  A lot of papers are invested in QwtLegendData, QwtLegendLabel, QwtPainter, QwtPainterCommand, QwtPlotDirectPainter, etc.  We did not do all this and the reasons for why we should implement all this in our situation are not clear. </li><li>  We don‚Äôt need to write our own transformation and recalculation classes from one system to another, and we don‚Äôt need to manually transform coordinates. </li><li>  We have achieved much more abstraction of iems with data. </li><li>  Our class hierarchy is an order of magnitude simpler.  And with further expansion there are no reasons why it should become more difficult. </li></ul><br><br><h4>  Links </h4><br>  <a href="http://qt-project.org/doc/qt-5.0/qtwidgets/graphicsview.html">Documentation</a> expanded with examples. <br>  <a href="http://qt-project.org/videos">Video</a> , if you can not download from the off site, then quietly located on youtube <br>  <a href="http://github.com/DancingOnWater/GraphicsScenePlot">The project</a> . <br><br>  PS The project is a demonstration, but if bugs are found, or who helps with the improvement, I will be only too happy. <br>  <sub>PPS Just in case: the text is published under the license CC-BY 3.0</sub> <br><br>  <b>UPD</b> totals: <br><img src="https://habrastorage.org/storage2/4cf/f31/1f9/4cff311f9a0ee89a2ee44917187c6084.png"></div><p>Source: <a href="https://habr.com/ru/post/182142/">https://habr.com/ru/post/182142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182132/index.html">Tips for beginners in the design of modular production systems</a></li>
<li><a href="../182134/index.html">PhoneJS - New HTML5 framework for mobile applications</a></li>
<li><a href="../182136/index.html">Why does the comparison ‚Äúbehaves like a robot‚Äù mean ‚Äúbehaves like a fool‚Äù?</a></li>
<li><a href="../182138/index.html">As I have not slept a year or the creation of a social Android application</a></li>
<li><a href="../182140/index.html">POP3 and IMAP: history of mail protocols and collection of IMAP letters in Yandex. Mail</a></li>
<li><a href="../182144/index.html">Disaster recovery: Network sandbox based on vSphere and Hyper-V in Veeam Backup & Replication v7</a></li>
<li><a href="../182146/index.html">Justify Grid - a new word in the markup</a></li>
<li><a href="../182148/index.html">DevConf 2013 June 14th - the PHP section program is published, the PHP author will tell you about PHP acceleration 6 times</a></li>
<li><a href="../182150/index.html">The FSB Public Council proposes banning Tor and anonymizing sites, bringing their creators to justice.</a></li>
<li><a href="../182152/index.html">Perform transactions on the PCI bus. Implementation on VHDL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>