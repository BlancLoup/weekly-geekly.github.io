<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Risk Protection Machine Learning System Architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our business is largely built on mutual trust between Airbnb, homeowners and travelers. Therefore, we try to create one of the most trusted communitie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Risk Protection Machine Learning System Architecture</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c4f/51c/aba/c4f51caba45546ec89cd2d7b25a0ca50.jpeg"><br><br>  Our business is largely built on mutual trust between Airbnb, homeowners and travelers.  Therefore, we try to create one of the <a href="https://www.airbnb.ru/trust">most trusted communities</a> .  One of the tools for building such a community has become a review system that helps users find members who have earned a high reputation. <br><a name="habracut"></a><br>  We all know that users periodically come across the net trying to deceive other people.  Therefore, in Airbnb, a separate development team deals with security.  The tools they create are aimed at protecting our user community from deceivers, with a lot of attention being paid to ‚Äúquick response‚Äù mechanisms so that these people don‚Äôt have time to harm the community. <br><br>  Any networked business faces a wide variety of risks.  Obviously, they need to be protected, otherwise you risk the very existence of your business.  For example, Internet providers make great efforts to protect users from spam, and payment services - from fraudsters. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We also have a number of opportunities to protect our users from malicious intent. <br><ol><li>  <b>Changes in the product</b> .  Some problems can be avoided by introducing additional user verification.  For example, requiring confirmation of your mail account or implementing two-factor authentication to prevent account theft. </li><li>  <b>Deviation detection</b> .  Some attacks can often be detected by changing some parameters during a short time span.  For example, an unexpected 1000% increase in booking volumes may be the result of either an excellent marketing campaign or a scam. </li><li>  <b>Model built on the basis of heuristics and machine learning</b> .  Fraudsters often act on some well-known schemes.  Knowing some kind of scheme, you can apply heuristic analysis to recognize such situations and prevent them.  In complex and multi-stage schemes, the heuristic becomes too cumbersome and inefficient, so machine learning should be used here. </li></ol><br>  If you are interested in a deeper look at online risk management, then you can refer to the <a href="http://www.ohadsamet.com/introduction-to-online-payments-risk-management-an-oreilly-ebook/">book by</a> Ohad Samet. <br><br><h4>  Machine learning architecture </h4><br>  Different risk vectors may require different architectures.  For example, for a number of situations, time is not critical, but for detection it is necessary to use large computational resources.  In such cases, the offline architecture is best suited.  However, within the framework of this post we will consider only systems operating in real time and close to it.  In general, a machine learning pipeline for these types of risks depends on two conditions: <br><ol><li>  <b>The framework should be fast and reliable</b> .  It is necessary to reduce to zero the possible downtime and inoperability, and the framework itself should constantly provide feedback.  Otherwise, fraudsters may take advantage of insufficient performance or the glitchiness of the framework by simultaneously launching several attacks or continuously attacking in some relatively simple way, waiting for an imminent overload or system shutdown.  Therefore, the framework should work, ideally, in real time, and the choice of model should not depend on the speed of evaluation or other factors. </li><li>  <b>The framework must be flexible</b> .  Since fraud vectors are constantly changing, it is necessary to be able to quickly test and implement new detection and response models.  The process of building models should allow engineers to freely solve problems. </li></ol><br>  Optimizing real-time computing during transactions primarily concerns speed and reliability, while optimizing model building and iteration should be more focused on flexibility.  Our engineering and data processing teams jointly developed a framework that meets the above requirements: it is fast, reliable in detecting attacks and has a flexible model building pipeline. <br><br><h4>  Feature highlighting </h4><br><img src="https://habrastorage.org/files/984/9b6/915/9849b6915bfe4746a6bc95458d9a536c.jpg"><br><br>  In order to preserve our service-oriented architecture, we have created a separate fraud forecasting service, which highlights all the necessary features for a particular model.  When the system registers any critical event, for example, housing is reserved, a processing request is sent to the fraud forecasting service.  After that, the event highlights the signs in accordance with the ‚Äúhousing reservation‚Äù model and sends them to our <a href="https://github.com/jpmml/openscoring">Openscoring-</a> service.  That gives an assessment and the decision on the basis of the put criteria.  All this information can use the forecasting service. <br><br>  These processes must proceed quickly in order to have time to react in case of danger.  The forecasting service is written in Java, like many of our other back-end services for which performance is critical.  Database queries are parallelized.  At the same time, we need freedom in cases when heavy calculations are made in the process of feature extraction.  Therefore, the prediction service is executed asynchronously, so as not to block the booking procedures, etc.  The asynchronous model works well in cases where a delay of a few seconds does not play a special role.  However, there are situations when you need to instantly respond and block the transaction.  In these cases, apply synchronous requests and evaluation of pre-calculated signs.  Therefore, the forecasting service consists of <a href="httpjson-services-in-modern-java/">various modules</a> and an internal API that allows you to easily add new events and models. <br><br><h4>  Openscoring </h4><br>  This is a Java service that provides the JSON REST interface for the <a href="https://github.com/jpmml/jpmml-evaluator">JPMML-Evaluator</a> .  JPMML and Openscoring are open source projects and are <a href="http://openscoring.io/">distributed</a> under the AGPL 3.0 license.  The JPMML backend uses <a href="https://ru.wikipedia.org/wiki/%25D0%25AF%25D0%25B7%25D1%258B%25D0%25BA_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BA%25D0%25B8_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D0%25BD%25D0%25BE%25D0%25B7%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BC%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">PMML</a> , an XML language that encodes several common machine learning models, including tree-like, logit, SVM, and neural networks.  We implemented Openscoring in our production-environment, adding additional features: logging Kafka, monitoring statsd, etc. <br><br>  What, from our point of view, are the advantages of Openscoring: <br><ul><li>  <b>Open project</b> .  This allows us to modify it to your requirements. </li><li>  <b>Supports various sets of trees</b> .  We tested several training methods and found that random aggregates provide a suitable level of accuracy. </li><li>  <b>High speed and reliability</b> .  During load testing, most of the responses were received in less than 10 ms. </li><li>  <b>Multiple models</b> .  After our refinement, Openscoring allows you to simultaneously run many different models. </li><li>  <b>PMML format</b> .  PMML allows our analysts and developers to use any compatible machine learning packages (R, Python, Java, etc.).  The same PMML files can be used with the <a href="http://www.cascading.org/projects/pattern/">Cascading Pattern</a> to evaluate groups of large-scale distributed models. </li></ul><br>  But Openscoring has drawbacks: <br><ul><li>  <b>PMML does not support some kinds of models</b> .  Only relatively standard ML models are supported, so we cannot launch new models or significantly modify the standard ones. </li><li>  <b>There is no native support for online learning</b> .  Models cannot train themselves on the fly.  An additional mechanism is needed for automatic access to new situations. </li><li>  <b>Rudimentary error handling</b> .  PMML is difficult to debug, manual editing of the XML file is a risky job.  JPMML is known for giving cryptic error messages when experiencing problems with PMML. </li></ul><br><br><h4>  Model building conveyor </h4><br><img src="https://habrastorage.org/files/1ae/fb9/cad/1aefb9cad6d04bb2b2f97aa2abd22c1f.jpg"><br><br>  Above is a diagram of our model building pipeline using PMML.  First, from the data stored on the site, highlighted the signs.  Since the combinations of features that give the optimal signal are constantly changing, we store them in JSON format.  This allows you to generalize the process of loading and transforming features based on their names and types.  Then the signs are grouped, and to improve the signal instead of the missing variables are inserted suitable.  Statistically unimportant signs are discarded.  All these operations take considerable time, so you have to sacrifice many details for the sake of increased productivity.  The transformed attributes are then used to train and cross-check the model using our favorite PMML-compatible machine learning library.  After that, the resulting model is loaded into Openscoring.  The final result is tested and used to make decisions if it shows the best results. <br><br>  The model training stage can be performed in any language that has a PMML library.  For example, <a href="http://cran.r-project.org/web/packages/pmml/pmml.pdf">the R PMML package</a> is often used.  It supports many types of transformations and ways to manipulate data, but it cannot be called a universal solution.  We deploy the model in a separate stage, after its training, so you have to check it manually, which can take a lot of time.  Another disadvantage of R is the low rate of implementation of the PMML exporter with a large number of features and trees.  However, we found that simply rewriting the function export in C ++ reduces the execution time by about 10,000 times, from a few days to a few seconds. <br><br>  We are quite able to bypass the disadvantages of R, while at the same time using its advantages in building a pipeline based on Python and <a href="http://scikit-learn.org/stable/">scikit-learn</a> .  Scikit-learn is a package that supports many standard machine learning models.  It also includes useful utilities for checking models and performing feature transformations. <br><br>  For us, Python has become a more suitable language than R for situational data management and feature extraction.  The automated extraction process relies on a set of rules encoded in the names and types of variables in JSON, so new features can be embedded in the pipeline without changing the existing code.  Deployment and testing can also be performed automatically in Python using standard web libraries for interacting with Openscoring.  Performance tests of the standard model (precision-recall, ROC curves, etc.) are performed using sklearn.  It does not support out of box PMML export, so I had to rewrite the internal export mechanism for certain classifiers.  When the PMML file is uploaded to Openscoring, it is automatically tested for the compliance of the model it presents to scikit-learn.  Since all stages, such as transforming features, building a model and testing it, deploying and testing, are performed in a single script, developers can quickly iterate over a model based on new features or more recent data, and then quickly deploy it to production. <br><br><h4>  The main stages: the situation -&gt; signs -&gt; the choice of the algorithm </h4><br>  The process we have built has shown excellent results for some models, but with the rest we have a poor level of precision recall.  At first we decided that the reason was the presence of errors, and tried to use more data and more signs.  However, there was no improvement.  We analyzed the data more deeply and found out that the problem was that the situations themselves were incorrect. <br><br>  Take, for example, cases with the requirements of return payment.  Reasons for returns may be situations where the product "does not match the description" (Not As Described, NAD) or <a href="http://www.cardfellow.com/blog/chargebacks/">fraud</a> .  But it was a mistake to group both of these reasons in the same model, since bona fide users can document the validity of NAD returns.  This problem is solved easily, like a number of others.  However, in many cases it is quite difficult to separate the behavior of fraudsters from the activities of normal users, it is necessary to create additional data warehouses and logging pipelines. <br><br>  For most specialists working in the field of machine learning, they will consider it obvious, but we still want to emphasize once again: if your analyzed situations are not entirely correct, then you have already set the upper limit of accuracy of accuracy and completeness of the classification.  If the situations are essentially erroneous, then this limit turns out to be rather low. <br>  Sometimes it happens that until you come across a new type of attack, you don‚Äôt know what data you need to determine it, especially if you didn‚Äôt work in the conditions of possible risks.  Or they worked, but in another field.  In this case, you can advise to log everything that is possible.  In the future, this information may not just be useful, but even prove invaluable for protection against a new attack vector. <br><br><h4>  Future prospects </h4><br>  We are constantly working to further improve and develop our fraud forecasting system.  The current stage of the company's development and the amount of available resources are reflected in the current architecture.  Often, smaller companies can afford to use only a few ML-models and a small team of analysts in production; they have to manually process the data and train the models in unusual cases.  Larger firms can afford to create numerous models, widely automate processes and get substantial returns from training models online.  Work in an extremely fast-growing company gives you the opportunity to work in a radically changing landscape from year to year, so the training pipelines need to be constantly modified. <br><br>  With the development of our tools and techniques, investing in further improving learning algorithms is becoming increasingly important.  Probably, our efforts will shift towards testing new algorithms, wider introduction of online learning models and modernizing the framework so that it can work with more voluminous data sets.  Some of the most significant opportunities for improving models are based on the uniqueness of the information we accumulate, the sets of features and other aspects that we cannot voice for understandable reasons.  Nevertheless, we are interested in sharing experience with other development teams.  Write to us! </div><p>Source: <a href="https://habr.com/ru/post/252697/">https://habr.com/ru/post/252697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252671/index.html">Pseudo-identification of the cello</a></li>
<li><a href="../252673/index.html">Open-source instant messenger for autistic children</a></li>
<li><a href="../252675/index.html">Administering through the eyes of a C ++ programmer</a></li>
<li><a href="../252677/index.html">Oberon Interpreter on Go</a></li>
<li><a href="../252683/index.html">"- Hello, tech support. Have you tried to turn it off and on?"</a></li>
<li><a href="../252699/index.html">Protection against cheating in online games</a></li>
<li><a href="../252703/index.html">Recognition of the RF Passport on a mobile phone. (UPD: 03/28/2015 + posted the program on the App Store)</a></li>
<li><a href="../252705/index.html">NoScript is now for Android</a></li>
<li><a href="../252707/index.html">Weekly build Vivaldi 1.0.124.2</a></li>
<li><a href="../252711/index.html">Microsoft incorrectly fixed the vulnerability that the Stuxnet worm used</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>