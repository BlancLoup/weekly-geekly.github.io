<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attacking WLAN users through rogue services, or why PSK is not the best choice for a hotel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post I want to share the story of one brilliantly simple attack, which I observed last year, and discuss the consequences. There will be no ‚Äúm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attacking WLAN users through rogue services, or why PSK is not the best choice for a hotel</h1><div class="post__text post__text-html js-mediator-article">  In this post I want to share the story of one brilliantly simple attack, which I observed last year, and discuss the consequences.  There will be no ‚Äúmeat‚Äù for hackers, but there will be: <br><ul><li>  Plus one instructive bike to the collection ‚Äúfor conversations with users‚Äù for admins and security guards. </li><li>  Why do you need to protect not only LAN from WLAN in wireless networks, and why do we need so-called?  Wireless Firewall. </li><li>  Recommendations on how to build a public Wi-Fi network to avoid such problems. </li><li>  Why in hotels and other public networks, even an unencrypted Captive Portal may be preferable to encrypting with PSK. </li></ul><br>  In principle, everything is relevant for corporate networks, but for them I already <a href="http://ko.com.ua/wired_vs_wireless_firewall_56582">wrote</a> .  And then the <a href="http://habrahabr.ru/post/149495/">next post</a> made me look at the problem from a slightly different angle. <br><a name="habracut"></a><br>  <i>First of all, I do not impose and do not urge to urgently run and buy cool Wi-Fi with WIPS and RTLS.</i>  <i>Each situation will have its own nuances and priorities: some will be covered by a user agreement, some will simply not care about users, in some countries there will be no responsibility, some rather partial measures, someone else will have some nuances.</i>  <i>I describe - everyone chooses himself.</i> <br><br><h4>  Prehistory </h4><br>  The story happened to my colleague in the hotel where we stayed.  I did not fall under the distribution just because by that time I had not connected to the hotel WLAN.  The hotel provides free Wi-Fi to all its guests.  The network is password-protected, PSK is issued on a piece of paper and changes every few months. <br><br><h4>  Story </h4><br>  A colleague connects a laptop to the network, opens Firefox, writes the address of a well-known site.  Instead of a site, a beautiful page appears with the header of the hotel‚Äôs site and a message like ‚ÄúYour browser is incompatible with the site you are trying to open.  Install the patch <u>from here</u> . ‚Äù  A colleague is impressed, launches Chrome - the same page.  We connect to the network of Android and iPod Touch - the same.  At the same time, the ‚Äúpatch‚Äù is always the same :) Downloading the ‚Äúpatch‚Äù - it is quite expected that the antivirus curses (we found 3 different types of malware). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, the plot is obvious - <a href="http://www.luisi.ru/prikol_207.php">Albanian virus</a> spreading phishing and a small hack on the network.  The virus itself is of no interest - it is of interest to understand how all this works in order to get access to the Internet without a ‚Äúpatch‚Äù. <br><br><h4>  We understand </h4><br>  Through some simple research (at the level of ipconfig / ping) it was found out that sites can be accessed via IP.  So the problem is in the DNS.  By registering DNS 8.8.8.8 we got a fully functioning Internet.  Now you can figure out how the attack works. <br><br>  The following was clarified: <br><ul><li>  In WLAN, there was another DHCP server (rogue DHCP), which issued the correct IP / mask / GW, but gave out its ‚Äúown‚Äù DNS server instead of the correct provider. </li><li>  On the same host, the same DNS server was raised, which rezolvil all names in the same IP (which "by an incredible coincidence of circumstances" coincided with the IP of the DNS server). </li><li>  On the same IP, a web server was raised, which, in fact, showed the page and gave the file. </li></ul><br>  As you can see, everything is very simple and does not require special skills for implementation.  <b>Question: how many ‚Äúordinary people‚Äù will lead to this?</b> <br>  Also, it is strange that the attacker limited himself to a ‚Äúpatch‚Äù and did not draw the head pages of GMail / Bing / Facebook, etc.  - it would be possible to gather up accounts, even with HTTPS: how many people pay attention to certificate curves or to the fact that they have just been redirected from HTTPS to HTTP?  Although, if there are three Trojans in a car, they already gather everything together ... <br><br><h4>  Conclusions and solutions </h4><br>  When building any access network, it is important not only to protect this network and the wired infrastructure from the ‚Äúexcessive interest‚Äù of users, but also to protect some users from other, less decent ones.  This is true for corporate (private) networks, and for public networks (hotspots, hotels, cafe-bars, restaurants, etc.).  It should be remembered that ‚Äúwireless security‚Äù is not only encryption: there must also be identification, authentication, traffic separation and much more.  The attack described above is not the only pure wireless attack that no Firewall or IPS in the wired segment can detect.  What to do to such a problem does not arise? <br><br>  The simplest solution is to prohibit communication between users.  Usually, this is done by turning on / off one tick in the WLAN settings (‚ÄúDisable MU-to-MU communication‚Äù, Cisco PSPF and analogues).  However, hotspot users do not always like this and may conflict with the goals of using the network (gaming parties, VoWLAN in corporate networks, etc.).  Although - if it does not contradict - as has already been said, the easiest way to do this is to write this clause in the ‚Äúterms of use‚Äù. <br><br>  The best way is to disable DHCP, DNS, and (per company) and ARP responses in a wireless network.  To do this, you need to have a firewall directly on the access point that can filter WLAN-to-WLAN traffic (periodically it is called the Wireless Firewall to emphasize differences from traditional FWs).  For me, at one time it was a great surprise that some eminent vendors do not know how (and to this day). <br>  DNS and DHCP responses are resolved only from wired hosts.  ARP responses from clients are not needed at all - the dot still knows all the MAC addresses of clients (with association) and will be able to respond to requests through Proxy ARP, so at the same time the amount of spurious traffic on the network decreases. <br>  Thus, we get rid of DHCP / DNS / ARP-spoofing, rogue DHCP / DNS, APR-poisoning, MiTM-attacks associated with them (and, probably, a lot more - add in comments). <br><br>  Now, let's turn our attention to another aspect.  So I found a fake server on the network.  I can block it by MAC.  But if the attacker is not a fool and periodically checks the activity of his mousetrap, he will notice, change the MAC, and everything will continue.  In addition, knowing PSK, an attacker can throw packets into the network to users without even being connected to access points, and even with WPA2.  For this you need to try hard, because  in WPA / WPA2, key distribution is more complicated than in WEP, <a href="http://www.aircrack-ng.org/doku.php%3Fid%3Dcracking_wpa">but it is possible</a> .  The only way to get rid of the adversary is to change the PSK.  And then change it for all customers!  And this, although it will repel the attack, will not allow to find and punish the attacker (if you do not use the positioning system).  And what can we say about open hotspots? <br>  Thus, in public networks, even if they are protected by PSK, as a network of our hotel, the attacker goes unpunished almost always. <br><br>  Another thing is to use Captive Portal (only competently use) or 802.1x (at the same time it solves the problem with traffic injection, but in public networks it is difficult to use 802.1x).  Each user receives an individual name and password to which the MAC address is associated with the login, the account runs for a limited time (in hotel systems, they build automation to bind to the list-statement).  Thus, we can always figure out who is having fun, or, at least, who leaked the identification data. <br><br>  Both of these nuances are extremely important in such a dangerous and exciting game as shifting responsibility.  If you do not have a disclaimer in the user agreement (and not always this can be done, plus, you need to make sure that the user cannot access the network without agreeing with the rules for using the resource), if through your network there is hacking, porn, racism / violence propaganda and so forth, and if you cannot find the extreme one, they will appoint you to the extreme.  That is why, as a result of violent rampant phishing on hotspots in Europe, mandatory identification of each user at the legislative level was introduced (most often, you need to enter a mobile number that receives SMS with an individual access code).  It is clear that it is also possible to hide from this, but in this way the hotspot provider shifts the responsibility to the SIM card provider.  Even without using authentication, the Captive Portal can, before giving access, show a screensaver with ‚Äúresource usage rules‚Äù and force the user to tick ‚ÄúI accept the conditions‚Äù, which in many cases is enough from a legal point of view (and the user will not get rid of did not see the agreement).  So, sometimes an open network with a Captive Portal can be safer than a closed network with PSK - for its owners :) <br><br>  As an alternative, some vendors (Aerohive, Ruckus) implement non-standard ‚Äúindividual PSK‚Äù technology, where each client is given a unique key.  Thus, the problems of user identification and mass change of PSK in case of its leakage are also solved.  However, their availability in the CIS countries is very limited, and compatibility problems are sometimes observed. <br><br><h4>  Conclusion </h4><br>  In wireless networks, protecting wireless users from entire wireless attacks is just as important as protecting a wired segment.  With the help of fairly simple technical tools, you can set up industrial-scale phishing and other attacks - and no wired Firewall / IPS will help. <br><br>  There are technical measures to restrict the access of wireless users to other wireless users: <br><ul><li>  Prohibit communication between them in general (supported by almost all manufacturers, but not always acceptable on the network) </li><li>  Prevent wireless users from sending replies to important network services: DHCP, DNS, ARP (much better, but not supported by all and may not save from more complex attacks) </li><li>  Use Captive Portal / 802.1x / PPSK to identify sources of attack or user data leaks </li><li>  Specialized Wireless IPS will help hide from other attacks. </li><li>  Positioning System (RTLS) allows you to determine the approximate physical location of the source </li></ul><br>  All of the above is relevant for any network (no one has canceled insider hacking), but it is especially important for public networks (hotspots, hotels, Cabaret, etc.) in terms of <br><ul><li>  Attractiveness for clientele: ‚ÄúI / a friend hacked there - I won't go there anymore,‚Äù etc. </li><li>  Organizational questions: you can quickly solve a problem and find the culprit;  perhaps one of his employees decided to "earn some money", etc. </li><li>  Legal issues: you can shift the responsibility if it presses. </li></ul><br>  I hope it was interesting. </div><p>Source: <a href="https://habr.com/ru/post/149661/">https://habr.com/ru/post/149661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149647/index.html">Ridual is a new file manager for Ubuntu.</a></li>
<li><a href="../149653/index.html">Another interesting cloud service with 15Gb of free disk space</a></li>
<li><a href="../149655/index.html">Flashcache, or I / O on steroids</a></li>
<li><a href="../149656/index.html">Nokia's Antenna Testing Labs</a></li>
<li><a href="../149660/index.html">Some ideas for increasing web developer‚Äôs personal productivity.</a></li>
<li><a href="../149662/index.html">The study of malicious Internet activity: Russia again in the lead</a></li>
<li><a href="../149665/index.html">Noty is an unusually flexible jQuery plugin for displaying notifications.</a></li>
<li><a href="../149667/index.html">Can you hack the rover Curiosity?</a></li>
<li><a href="../149669/index.html">Flash Player goes with Android, users are asked to remove the plugin</a></li>
<li><a href="../149670/index.html">Windows 8 RTM is available for download to TechNet and MSDN subscribers.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>