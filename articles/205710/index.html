<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New database module for PHPixie completed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I wrote the last test for version 3.0 of the database access module for PHPixie . When I started it seemed that it would take only a few weeks, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New database module for PHPixie completed</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/569/c06/29e/569c0629ee6175216f0057afd1463dd2.png" alt="image" align="right"><br>  Today I wrote the last test for version 3.0 of the database access module for <a href="http://phpixie.com/">PHPixie</a> .  When I started it seemed that it would take only a few weeks, but in fact it all took about 2 months because of the huge amount of refactoring and rewriting from the beginning.  But now we have an expandable library that can be used even outside the framework itself (that is, if you are forced to write on some other framework or CMS, you can take your favorite library with you). <br><br>  I will make a release after finishing the ORM module and correcting the existing modules for working with the new API.  But if you are interested, you can look into <a href="http://phpixie.com/blog/new-phpixie-database-module-finished/">the 3.0 branch on the githab</a> (however, you should be warned that the documentation is not there yet, it will appear along with the ORM).  And now let's look at the new features. <br><a name="habracut"></a><br><h5>  From the point of view of the average user </h5><br>  I‚Äôve already written about advanced query support with logical conditions for MongoDB <a href="http://phpixie.com/blog/mongodb-driver-almost-here/">here</a> , but if you‚Äôre too lazy to click on this link, here‚Äôs a brief explanation: MongoDB does not use indices when using queries like ‚Äú <i>(A or B) OR (C and (D or E ))</i> ‚Äù, So PHPixie itself will lead requests to such forms that will use them. <br><br>  Several approaches for building queries have become available: <br><pre><code class="php hljs">$query -&gt;where(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Trixie'</span></span>) -&gt;or_where(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Tinkerbell'</span></span>) -&gt;where_not(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>) -&gt;having(<span class="hljs-string"><span class="hljs-string">'count'</span></span>,<span class="hljs-string"><span class="hljs-string">'&lt;'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) -&gt;or_having(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-comment"><span class="hljs-comment">// : $query -&gt;where('name', 'Trixie') -&gt;_or('name', 'Tinkerbell') -&gt;_and_not('id', '&gt;', 7) -&gt;having('count', '&lt;', 5) -&gt;_or('count', 7); //   _or      //(     'where'    'having')</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Several approaches to nested logic: <br><pre> <code class="php hljs">$query -&gt;where(<span class="hljs-string"><span class="hljs-string">'name'</span></span>,<span class="hljs-string"><span class="hljs-string">'Trixie'</span></span>) -&gt;_or(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($builder)</span></span></span></span>{ $builder -&gt;_and(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>) -&gt;_or(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>) }); <span class="hljs-comment"><span class="hljs-comment">//WHERE name = 'Trixie' OR ( id = 7 OR id = 5 ) //      //(     ,   EXT JS ) $query-&gt;where('name','Trixie'); $query -&gt;start_where_group('or') -&gt;_and('id',7) -&gt;_or('id',5) -&gt;end_where_group();</span></span></code> </pre><br><br>  Special operators for column comparison: <br><pre> <code class="php hljs">$query-&gt;where(<span class="hljs-string"><span class="hljs-string">'fairies.id'</span></span>,<span class="hljs-string"><span class="hljs-string">'*='</span></span>,<span class="hljs-string"><span class="hljs-string">'pixies.id'</span></span>);</code> </pre><br><br>  Ability to use SQL code inserts with separate parameters: <br><pre> <code class="php hljs">$expr = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;expr(<span class="hljs-string"><span class="hljs-string">'concat(name, ?)'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); $query-&gt;where($expr, <span class="hljs-string"><span class="hljs-string">'Trixietest'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//WHERE concat(name, ?) = 'Trixietest';</span></span></code> </pre><br><br>  Search strings by NULL value, not knowing in advance that this is NULL: <br><pre> <code class="php hljs">$category_id = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'category_id'</span></span>, $category_id); <span class="hljs-comment"><span class="hljs-comment">// WHERE category_id IS NULL //  WHERE category_id = NULL</span></span></code> </pre><br><br>  Difficult conditions for JOIN .... ON using the familiar syntax: <br><pre> <code class="php hljs">$query-&gt;join(<span class="hljs-string"><span class="hljs-string">'pixies'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     $query-&gt;on('fairies.id','pixies.id'); //     $query-&gt;on('fairies.count','*&gt;','pixies.count');</span></span></code> </pre><br><br><h5>  From the perspective of an advanced developer </h5><br><br><ul><li>  Incredibly lightweight, only 57 kilobytes of code </li><li>  Query builders do not contain any logic related to their parsing (for example, in SQL code).  Instead, each driver uses its Parser service, making the request objects themselves easy and cheap in terms of memory.  Using parsers as services makes debugging and expanding them with trivial tasks.  By the way, each parser will be created in memory only once for all requests. </li><li>  Each parser is divided into parsers of individual conditions and condition groups (Condition Group Parser).  This separation makes it easy to add your custom operators. </li><li>  The binding of dependencies is rendered into separate classes of drivers, that is, in no case (except throwing exceptions), no class creates objects by itself using the <i>new</i> command.  This makes it easy to replace any class with its own implementation. </li><li>  Requests to MongoDB are parsed into special Runner objects that are easily debugged in case of an error. </li><li>  SQL databases that work through PDO have their own individual adapters and parsers, which makes it easy to add support for any database that PDO works with using minimal code. </li></ul><br><br>  <b>The code is fully covered with PHPUnit tests, which gives 166 tests and 1151 comparisons.</b> <br><br>  I hope that this post will convey my joy with the work done and that the final release of the ORM module is not far away. </div><p>Source: <a href="https://habr.com/ru/post/205710/">https://habr.com/ru/post/205710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205696/index.html">Script for fixing the date of setting the user's password in AD</a></li>
<li><a href="../205698/index.html">Porting an extension from Chrome to Firefox</a></li>
<li><a href="../205700/index.html">Hesperbot targets Germany and Australia</a></li>
<li><a href="../205702/index.html">A small intermediate result of the year of great work</a></li>
<li><a href="../205704/index.html">All participants of the DARPA robot competition have been identified.</a></li>
<li><a href="../205720/index.html">New Google Sheets: Faster, More Powerful and Work Offline</a></li>
<li><a href="../205724/index.html">Everything is ready to ship!</a></li>
<li><a href="../205726/index.html">From amber to polymer</a></li>
<li><a href="../205728/index.html">High-quality mobile application localization. 5 simple tips and 12 links</a></li>
<li><a href="../205730/index.html">Deploying node.js applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>