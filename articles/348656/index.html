<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dive into Ethereum development. Part 4: warmth and debug in truffle, ganache, infura</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article we looked at the developed application on Ethereum. But bypassed the question of how the development process. Clearly, this is not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dive into Ethereum development. Part 4: warmth and debug in truffle, ganache, infura</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/339080/">last article</a> we looked at the developed application on Ethereum.  But bypassed the question of how the development process.  Clearly, this is not just writing code that works right away.  Most of the time will have to spend on bringing the code, which is ‚Äúalmost ready‚Äù, to a working state.  Depla, testing, debugging - all this has been touched upon to some extent here, for example, in these quite good articles: <a href="https://habrahabr.ru/post/342534/">one</a> , <a href="https://habrahabr.ru/post/335710/">two</a> , <a href="https://habrahabr.ru/post/327236/">three</a> (the list is not complete).  In this article we will give a small overview and perhaps we will repeat something, but we will try to focus on those points that seemed important or unsaid to us.  Plus, lately, some things have changed, and a huge number of instructions turned out to be outdated.  We will try to correct the situation a little. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7x/eg/ti/7xegti0dfglmjeevkvbasvrjyos.png"></div><br><a name="habracut"></a><br><h2>  Project in truffle </h2><br>  For testing and deploying smart contracts, we use <a href="http://truffleframework.com/">Truffle</a> , it hides some of the low-level work behind the abstractions, which is very convenient.  The described version is 4.0.6.  This is not the only framework, <a href="https://embark.readthedocs.io/">Embark</a> and <a href="https://dapple.readthedocs.io/en/master/">Dapple</a> are still <a href="https://embark.readthedocs.io/">there</a> , but we cannot say anything about them, we did not have to work.  To initialize the project, you need to execute the command (it will be executed in the current folder, so first create a project folder and navigate to it): <br><br><pre><code class="bash hljs">$ truffle init</code> </pre> <br>  Only the base structure is created from the <code>contracts</code> , <code>migrations</code> and <code>tests</code> folders.  In <code>contracts</code> and <code>migrations</code> you can see the smart contract <code>Migrations</code> , which is responsible for the deployment logic (in terms of truffle - migration).  And the logic is something like this: in the <code>migrations</code> folder you add scripts and name them by the pattern <code>1_description.js</code> , <code>2_another_one.js</code> ... <code>n_etc.js</code> .  The most important thing in the title is the index that goes at the beginning, after which you can add any description that is needed only for readability.  The index is used to perform migrations in the order of numbering.  Smart contract <code>Migrations</code> used to save which of the migration scripts have already been executed.  So, if in the process of development we add new contracts and a new deployment logic, then the previous successful progress should not be redone.  Personally, we do not use it, instead we have a fixed number of migrations, edit and run them again each time with the help of <code>truffle migration --reset</code> . <br>  You can manually create contract, migration, and test files, but there are special commands in the truffle: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">$ truffle create contract ExampleContract $ truffle create migration ExampleMigration $ truffle create <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ExampleContract</code> </pre> <br>  You can check that you have created the appropriate files.  But the content is very basic, so while in this feature there is no particular advantage compared to manually creating the same files. <br><br><h2>  Work with the project </h2><br>  In earlier versions, the initialization of <code>truffle init</code> immediately created a small example (Metacoin and ConvertLib).  In order to see this and other examples in recent versions, you can use features called Truffle Boxes.  Boxes are designed to get a full-fledged example of a Truffle project and its interaction with various web-based tools, such as ReactJS.  <a href="http://truffleframework.com/boxes/">Here</a> is a list of boxes, both official and created by the community.  Create a directory for the new project and navigate to it.  Then execute the command: <br><br><pre> <code class="bash hljs">$ truffle unbox metacoin</code> </pre> <br>  get the project structure, which in the old versions was created by default after <code>truffle init</code> .  This is an example with the basic token Metacoin, which can be sent from user to user and with the help of the ConvertLib library you can watch the balance in the air at a fixed exchange rate.  In addition, it shows how to create and use a smart contract and library, there is also an example of tests for JavaScript and Solidity (for more information on writing tests, read <a href="https://habrahabr.ru/post/321362/">here</a> , note that there is just considered an older version of Truffle).  Let's take a quick look at how to build and test this project in test mode.  First, start the development console: <br><br><pre> <code class="bash hljs">$ truffle develop</code> </pre> <br>  See similar text: <br><br><pre> <code class="bash hljs">Truffle Develop started at http://localhost:9545/ Accounts: (0) 0x627306090abab3a6e1400e9345bc60c78a8bef57 (1) 0xf17f52151ebef6c7334fad080c5704d77216b732 (2) 0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef (3) 0x821aea9a577a9b44299b9c15c88cf3087f3b5544 (4) 0x0d1d4e623d10f9fba5db95830f7d3839406c6af2 (5) 0x2932b7a2355d6fecc4b5c0b6bd44cc31df247a2e (6) 0x2191ef87e392377ec08e7c08eb105ef5448eced5 (7) 0x0f4f2ac550a1b4e2280d04c21cea7ebd822934b5 (8) 0x6330a553fc93768f612722bb8c2ec78ac90b3bbc (9) 0x5aeda56215b167893e80b4fe645ba6d5bab767de Mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat truffle(develop)&gt;</code> </pre> <br>  What does this team do?  It raises the test environment and gives access to it through the console.  The test environment is what you could see in older manuals called TestRPC.  In fact, this is it, just the Truffle team took it under its control and renamed it to <a href="http://truffleframework.com/ganache/">Ganache</a> .  But let's write about this further, but for now let's move on to the console.  Perform a full cycle of commands for compiling, migrating, and testing: <br><br><pre> <code class="bash hljs">truffle(develop)&gt; compile</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="bash hljs">Compiling ./contracts/ConvertLib.sol... Compiling ./contracts/MetaCoin.sol... Compiling ./contracts/Migrations.sol... Writing artifacts to ./build/contracts</code> </pre> </div></div><br><pre> <code class="bash hljs">truffle(develop)&gt; migrate</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="bash hljs">Using network <span class="hljs-string"><span class="hljs-string">'develop'</span></span>. Running migration: 1_initial_migration.js Deploying Migrations... ... 0x29619f8ba9b9e001bef885c8ca2fbee45beab738adc41c7f9e2e8273fbc67e9f Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0 Saving successful migration to network... ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956 Saving artifacts... Running migration: 2_deploy_contracts.js Deploying ConvertLib... ... 0x02318651545ac96670af626ef7795cb928d7504afc3f856258058ce579d47fe6 ConvertLib: 0x345ca3e014aaf5dca488057592ee47305d9b3e10 Linking ConvertLib to MetaCoin Deploying MetaCoin... ... 0x486c572bbb2df30bb166f5507423d394807b5b92041860968a7d5eb162e42e48 MetaCoin: 0xf25186b5081ff5ce73482ad761db0eb0d25abfbf Saving successful migration to network... ... 0x059cf1bbc372b9348ce487de910358801bbbd1c89182853439bec0afaee6c7db Saving artifacts...</code> </pre> </div></div><br><pre> <code class="bash hljs">truffle(develop)&gt; <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><pre> <code class="bash hljs">Using network <span class="hljs-string"><span class="hljs-string">'develop'</span></span>. Compiling ./contracts/ConvertLib.sol... Compiling ./contracts/MetaCoin.sol... Compiling ./<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/TestMetacoin.sol... Compiling truffle/Assert.sol... Compiling truffle/DeployedAddresses.sol... TestMetacoin ‚úì testInitialBalanceUsingDeployedContract (62ms) ‚úì testInitialBalanceWithNewMetaCoin (47ms) Contract: MetaCoin ‚úì should put 10000 MetaCoin <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the first account ‚úì should call a <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> that depends on a linked library (54ms) ‚úì should send coin correctly (117ms) 5 passing (796ms)</code> </pre> <br></div></div><br>  It is possible to invoke methods of secured contracts manually, for example: <br><br><pre> <code class="javascript hljs">truffle(develop)&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> metaCoin truffle(develop)&gt; MetaCoin.deployed().then( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">instance</span></span></span><span class="hljs-function">) </span></span>{ metaCoin = instance } ); truffle(develop)&gt; metaCoin.getBalance(web3.eth.coinbase) BigNumber { <span class="hljs-attr"><span class="hljs-attr">s</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">e</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>: [ <span class="hljs-number"><span class="hljs-number">10000</span></span> ] } truffle(develop)&gt; _.toNumber() <span class="hljs-number"><span class="hljs-number">10000</span></span> truffle(develop)&gt; metaCoin.sendCoin( web3.eth.accounts[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">3000</span></span> ) { <span class="hljs-attr"><span class="hljs-attr">tx</span></span>: <span class="hljs-string"><span class="hljs-string">'0x9f59085a9f22c0bd691b890370bcffd7eedce1327a3bb525a2de3edf9db0d279'</span></span>, <span class="hljs-attr"><span class="hljs-attr">receipt</span></span>: { <span class="hljs-attr"><span class="hljs-attr">transactionHash</span></span>: <span class="hljs-string"><span class="hljs-string">'0x9f59085a9f22c0bd691b890370bcffd7eedce1327a3bb525a2de3edf9db0d279'</span></span>, <span class="hljs-attr"><span class="hljs-attr">transactionIndex</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">blockHash</span></span>: <span class="hljs-string"><span class="hljs-string">'0x24e8913b6f707bb5e5acbaa054fef9dabd548a561dc988763209f0aeed9a57b5'</span></span>, <span class="hljs-attr"><span class="hljs-attr">blockNumber</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">gasUsed</span></span>: <span class="hljs-number"><span class="hljs-number">51024</span></span>, <span class="hljs-attr"><span class="hljs-attr">cumulativeGasUsed</span></span>: <span class="hljs-number"><span class="hljs-number">51024</span></span>, <span class="hljs-attr"><span class="hljs-attr">contractAddress</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">logs</span></span>: [ [<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>] ] }, <span class="hljs-attr"><span class="hljs-attr">logs</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">logIndex</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">transactionIndex</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">transactionHash</span></span>: <span class="hljs-string"><span class="hljs-string">'0x9f59085a9f22c0bd691b890370bcffd7eedce1327a3bb525a2de3edf9db0d279'</span></span>, <span class="hljs-attr"><span class="hljs-attr">blockHash</span></span>: <span class="hljs-string"><span class="hljs-string">'0x24e8913b6f707bb5e5acbaa054fef9dabd548a561dc988763209f0aeed9a57b5'</span></span>, <span class="hljs-attr"><span class="hljs-attr">blockNumber</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: <span class="hljs-string"><span class="hljs-string">'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'mined'</span></span>, <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'Transfer'</span></span>, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: [<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>] } ] } truffle(develop)&gt; metaCoin.getBalance(web3.eth.coinbase) BigNumber { <span class="hljs-attr"><span class="hljs-attr">s</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">e</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>: [ <span class="hljs-number"><span class="hljs-number">7000</span></span> ] } truffle(develop)&gt; _.toNumber() <span class="hljs-number"><span class="hljs-number">7000</span></span></code> </pre> <br>  As you can see everything is done instantly and you can track the changes: you sent 3000 from the main address to another, we see that the balance has decreased.  Exit the console with the command: <br><br><pre> <code class="bash hljs">truffle(develop)&gt; .<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br><h2>  Connection to node </h2><br>  Truffle development is a mode with its own test node.  To connect to a real network or testnet, the <code>truffle console</code> command is used, which is completely analogous to <code>develop</code> , but does not raise the test environment.  To demonstrate this, it is not necessary to run <code>geth</code> , for example, you can use the already mentioned <a href="https://github.com/trufflesuite/ganache-cli">Ganache</a> , which replaced TestRPC.  Run the command: <br><br><pre> <code class="bash hljs">$ ganache-cli</code> </pre> <br>  There is also a <a href="http://truffleframework.com/ganache/">GUI version</a> .  There is no fundamental difference, but in this version you can immediately see all the information, events and balances.  It can be very convenient in some situations.  You can use any of these versions. <br><br>  But if you just made a <code>truffle unbox metacoin</code> and haven‚Äôt changed the configuration files yet, you won‚Äôt be able to connect <br><br><pre> <code class="bash hljs">$ truffle console No network available. Use `truffle develop` or add network to truffle.js config.</code> </pre><br>  Therefore, add the following to <code>truffle.js</code> : <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> = { networks: { development: { host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, port: <span class="hljs-number"><span class="hljs-number">8545</span></span>, network_id: <span class="hljs-string"><span class="hljs-string">"*"</span></span> } } };</code> </pre> <br>  You can also see <code>truffle-config.js</code> .  This is the same, but for Windows.  Extra file for your system can be deleted. <br>  This config will allow the truffle to connect to any network accessible on localhost: 8545.  These are the default values ‚Äã‚Äãfor geth and ganache-cli.  If you are using the GUI version of Ganache, go to the settings and, if necessary, change the port and restart (the ‚Äúsave and restart‚Äù button). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/xf/3f/vnxf3flkmdpl5ph_pitjbh-yvzc.png"></div><br>  If you are stuck on a window with a logo, then most likely you have something running on the same port, geth, ganache-cli / testrpc or something else <br><br>  Now you can connect, run the command: <br><br><pre> <code class="bash hljs">$ truffle console</code> </pre> <br>  And you can try for example to do: <br><br><pre> <code class="bash hljs">truffle(development)&gt; migrate --reset</code> </pre> <br>  In the GUI version, you can immediately see the change in the balance of the account from which it was deployed, if you go to the blocks tab, you will see smined blocks and how much gas was spent on transactions in them.  Clicking on each of them can get even more information.  The transactions tab in the same way will show you all past transactions. <br><div class="spoiler">  <b class="spoiler_title">Many screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/t2/0x/zu/t20xzuzu3kmepnccn9ncfbfv60e.png"><br><img src="https://habrastorage.org/webt/40/1y/wo/401ywogh1g-gngzsyhzumvvvnr0.png"><br><img src="https://habrastorage.org/webt/wk/rp/tp/wkrptpmbpehgcbq3ostdykkrha0.png"><br><img src="https://habrastorage.org/webt/_l/2z/rm/_l2zrm4r9ryfagc6l0hd6ykhlh8.png"><br><img src="https://habrastorage.org/webt/wp/-w/fi/wp-wfirqoffhi0l6q1shbaoqukw.png"><br><img src="https://habrastorage.org/webt/o8/ht/lu/o8htlub9ifzinddansirij3xxx0.png"><br></div></div><br>  In the console version will be the same information, but in the form of a wall of logs: <br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="bash hljs">net_version eth_accounts eth_accounts net_version net_version eth_sendTransaction Transaction: 0x29619f8ba9b9e001bef885c8ca2fbee45beab738adc41c7f9e2e8273fbc67e9f Contract created: 0x922194d35a507e5905fa4f2c9e7172ee8535272a Gas usage: 269607 Block Number: 1 Block Time: Mon Feb 05 2018 10:28:17 GMT+0300 (MSK) eth_newBlockFilter eth_getFilterChanges eth_getTransactionReceipt eth_getCode eth_uninstallFilter eth_sendTransaction Transaction: 0xfafc4352cc1dde57e46954d7ebd3a59232599081a253dd8705847a380ae5b06b Gas usage: 41981 Block Number: 2 Block Time: Mon Feb 05 2018 10:28:17 GMT+0300 (MSK) eth_getTransactionReceipt eth_accounts net_version net_version eth_sendTransaction</code> </pre> <br></div></div><br>  Use what you think is more convenient. <br>  By the way, if you read other instructions on the same topic, you probably already know that it is not necessary to call the console to compile and deploy, you can simply call for example <br><br><pre> <code class="bash hljs">truffle migrate --reset</code> </pre> <br>  And it will be a complete analogue of what we have done above.  The same principle for all other teams of truffles.  Full list of commands <a href="http://truffleframework.com/docs/advanced/commands">here</a> . <br><br><h2>  Packages </h2><br>  In any language you will not manage only core-functionality.  Inventing bicycles is unproductive and dangerous, and with smart contracts, where you risk other people's money, this is especially critical.  Therefore, the question arises where to get this already proven additional functionality.  Truffle has a system of packages for this, which are available in two installation options (aside from the usual copy-paste): using npm and using ethpm. <br><br>  Prior to this, using the example of Metacoin, we saw the simplest token.  Tokens are used quite often, even Crypto Kitties are essentially tokens, although the original standard.  The main standard for tokens right now is <a href="https://theethereum.wiki/w/index.php/ERC20_Token_Standard">ERC20</a> .  To comply with the standard, a token must implement a set of functions that can provide universal and safe use in wallets, exchanges, etc.  The <a href="https://github.com/OpenZeppelin/zeppelin-solidity">zeppelin-solidity package from OpenZeppelin</a> turns out to be very useful <a href="https://github.com/OpenZeppelin/zeppelin-solidity">here</a> - a set of libraries for frequently used patterns in smart contracts.  In <a href="https://habrahabr.ru/post/335710/">this article,</a> for example, the use of this package has already been described.  Consider not use, and methods of installation and connection.  For starters, the one described in the instructions on the project github.  At the root of the truffle project: <br><br><pre> <code class="bash hljs">$ npm init -y $ npm install -E zeppelin-solidity</code> </pre> <br>  After that, in the <code>node_modules</code> folder, you will have <code>zeppelin-solidity</code> , from which you can connect the required files in the smart contract, for example, ownable, with the line <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'zeppelin-solidity/contracts/ownership/Ownable.sol'</span></span>;</code> </pre> <br>  But there is another way to install packages, which is designed specifically for packages in Ethereum: EthPM.  Packages are stored on IPFS.  The list of packages is available <a href="https://www.ethpm.com/registry/packages">here</a> .  It is integrated into the truffle and to install the same zeppelin-solidity you can run: <br><br><pre> <code class="bash hljs">$ truffle install zeppelin</code> </pre> <br>  The installed_contracts folder is added, its contents are connected in the same way as from the <code>node_modules</code> folder: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'zeppelin/contracts/ownership/Ownable.sol'</span></span>;</code> </pre> <br>  But if you compare the versions that are installed one way or the other, you will find that they are different.  And at the very moment, the npm version is newer (at the time of writing 1.6.0 versus 1.3.0 in EthPm).  So EthPM is ideologically even more interesting, but for now it's probably better to install packages using npm <br><br><h2>  Debugging </h2><br>  Usually when an error occurs during the execution of a smart contract, the messages are very uninformative.  For example, let's make a contract with an intentional error: <br><br><pre> <code class="bash hljs">$ mkdir FaultyContract &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> FaultyContract $ truffle init $ truffle create contract FaultyContract $ truffle create migration deploy</code> </pre> <br>  In the contracts / FaultyContract.sol file add the missing code: <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>; contract FaultyContract { int public result; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divideXbyY</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> int x, int y </span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span></span>{ y -= y; result = x/y; } }</code> </pre> <br>  As you see, division by 0 is inevitable. <br><br>  In the <code>migration/xxxx_deploy.js</code> (xxxx - generated id, can be different) add the missing code for the deployment: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FaultyContract = artifacts.require(<span class="hljs-string"><span class="hljs-string">"./FaultyContract.sol"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> deployer </span></span></span><span class="hljs-function">) </span></span>{ deployer.deploy( FaultyContract ); }</code> </pre> <br>  Open the develop console, build and contract our contract. <br><br><pre> <code class="bash hljs">$ truffle develop truffle(develop)&gt; migrate</code> </pre> <br>  Get a contract and call the problematic function: <br><br><pre> <code class="javascript hljs">truffle(develop)&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> faultyContract; truffle(develop)&gt; FaultyContract.deployed().then( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">instance</span></span></span><span class="hljs-function">) </span></span>{ faultyContract = instance } ); truffle(develop)&gt; faultyContract.divideXbyY(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>: VM Exception <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> processing transaction: invalid opcode at <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.InvalidResponse (<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">43303</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>) at /usr/lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">331156</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span> at /usr/lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">314196</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span> at XMLHttpRequest.request.onreadystatechange (<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">329855</span></span>:<span class="hljs-number"><span class="hljs-number">7</span></span>) at XMLHttpRequestEventTarget.dispatchEvent (<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">70159</span></span>:<span class="hljs-number"><span class="hljs-number">18</span></span>) at XMLHttpRequest._setReadyState (<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">70449</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>) at XMLHttpRequest._onHttpResponseEnd (<span class="hljs-regexp"><span class="hljs-regexp">/usr/</span></span>lib/node_modules/truffle/build/cli.bundled.js:<span class="hljs-number"><span class="hljs-number">70604</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>)</code> </pre> <br>  As you can see, it is not very informative, it is not known where the error is and what the <code>invalid opcode</code> means.  In Truffle, the <code>debug</code> command is available from version 4 (beta), allowing the transaction to be re-executed line by line.  But for this you need to get a transaction hash, and there is not even an error in it.  To see the hash, run another instance of <code>truffle develop</code> with the <code>--log</code> flag: <br><br><pre> <code class="bash hljs">$ truffle develop --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br>  This command allows you to see the logs of what is happening in the main develop-console, and you can also find the transaction hash there.  Run the function again <br><br><pre> <code class="javascript hljs">truffle(develop)&gt; faultyContract.divideXbyY(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  In the window with the log will be something like <br><br><pre> <code class="bash hljs">develop:testrpc eth_sendTransaction +0ms develop:testrpc +27ms develop:testrpc Transaction: 0x21073e12e7c8fb785347d7bd5d974d4954379dcace7b53d452c03b39ca007b9e +1ms develop:testrpc Gas usage: 6721975 +0ms develop:testrpc Block Number: 6 +0ms develop:testrpc Block Time: Tue Feb 06 2018 10:32:27 GMT+0300 (MSK) +0ms develop:testrpc Runtime Error: invalid opcode +0ms develop:testrpc +0ms</code> </pre> <br>  Take the transaction hash and pass it to the debug command: <br><br><pre> <code class="javascript hljs">truffle(develop)&gt; debug <span class="hljs-number"><span class="hljs-number">0x21073e12e7c8fb785347d7bd5d974d4954379dcace7b53d452c03b39ca007b9e</span></span></code> </pre> <br>  You should get hints for further commands.  To understand at least in which line of the error, you can use the command <code>n</code> (step next): <br><br><pre> <code class="bash hljs">debug(develop:0x21073e12...)&gt; n FaultyContract.sol | 0x345ca3e014aaf5dca488057592ee47305d9b3e10: 8: int public result; 9: 10: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> divideXbyY( int x, int y ) public { ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ debug(develop:0x21073e12...)&gt;</code> </pre> <br>  Each step will display several lines from the code and underline the part that is currently being executed.  It is possible to go to a very low level and execute each opcode in turn (commands from the Ethereum virtual machine) and watch the stack status.  We take one more step and try to display the stack state: <br><br><pre> <code class="bash hljs">debug(develop:0x21073e12...)&gt; FaultyContract.sol | 0x345ca3e014aaf5dca488057592ee47305d9b3e10: 9: 10: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> divideXbyY( int x, int y ) public { 11: y -= y; ^ debug(develop:0x21073e12...)&gt; p FaultyContract.sol | 0x345ca3e014aaf5dca488057592ee47305d9b3e10: (55) DUP1 00000000000000000000000000000000000000000000000000000000c6329782 000000000000000000000000000000000000000000000000000000000000009b 0000000000000000000000000000000000000000000000000000000000000010 0000000000000000000000000000000000000000000000000000000000000004 (top)</code> </pre> <br>  We see that the last ones in the stack are our x and y, 16 and 4. This is certainly not a very convenient way and you need to deal with opcodes and how they are executed in the Ethereum virtual machine.  If interested - you can look for example <a href="http://gavwood.com/paper.pdf">yellow paper</a> (H.2. Instruction Set).  But our task is simply to find a line with an error.  Continue to perform the <code>next step</code> until we get something like this: <br><br><pre> <code class="bash hljs">10: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> divideXbyY( int x, int y ) public { 11: y -= y; 12: result = x/y; ^^^ debug(develop:0x21073e12...)&gt; Transaction halted with a RUNTIME ERROR. This is likely due to an intentional halting expression, like assert(), require() or revert(). It can also be due to out-of-gas exceptions. Please inspect your transaction parameters and contract code to determine the meaning of this error. truffle(develop)&gt;</code> </pre> <br>  Here at least you can see that the error occurred somewhere in the division part.  And you can look at the stack and instructions, if you understand.  This is unfortunately all that offers truffle on the part of debag.  Well, at least something. <br><br>  In this regard, for single contracts and simple connections, we can advise <a href="https://remix.ethereum.org/">Remix IDE</a> (in <a href="https://habrahabr.ru/post/341466/">this article,</a> for example, the author uses it for deployment), there is almost a full-fledged debug with the ability to see the values ‚Äã‚Äãof variables at each step.  The interface is intuitive, see how the example already discussed can be debugged there: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cy/ot/y8/cyoty8sqlj0ggxdraokpxbo-z2w.png"></div><br>  In the console below we see an error, click debag: <br><br><img src="https://habrastorage.org/webt/c6/22/tf/c622tf6nhsw2hadwgrqw9davbpq.png"><br>  And we can scroll back and forth and see the values ‚Äã‚Äãof variables in the human form. <br><br><h2>  Remote nodes Infura </h2><br>  In the last article, we looked at the Metamask plugin, which allows you to connect to the blockchain without using a local synchronized Ethereum client.  This is possible thanks to the <a href="https://infura.io/">Infura</a> service.  You can also access the infura nodes and connect to them through a truffle.  To do this, first you need to <a href="https://infura.io/signup">register on their website</a> , the letter will contain links with personal tokens for access.  Let's try to close the Metacoin example on Ropsten without a local node. <br>  Create a test project as usual: <br><br><pre> <code class="bash hljs">$ mkdir metacoin &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> metacoin $ truffle unbox metacoin</code> </pre> <br>  Next, we need an additional <a href="https://github.com/trufflesuite/truffle-hdwallet-provider">HDWalletProvider</a> package, through which Truffle can sign transactions <br><br><pre> <code class="bash hljs">$ npm init $ npm install $ npm install truffle-hdwallet-provider</code> </pre> <br>  Add the provider to the truffle settings with the following code: <br><br><pre> <code class="bash hljs">var HDWalletProvider = require(<span class="hljs-string"><span class="hljs-string">"truffle-hdwallet-provider"</span></span>); var mnemonic = <span class="hljs-string"><span class="hljs-string">"correct horse battery staple correct horse battery staple correct horse battery staple"</span></span> module.exports = { networks: { development: { host: <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, port: 8545, network_id: <span class="hljs-string"><span class="hljs-string">"*"</span></span> }, ropsten: { provider: <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> new HDWalletProvider(mnemonic, <span class="hljs-string"><span class="hljs-string">"https://ropsten.infura.io/&lt;   &gt;"</span></span>) }, network_id: 3, gas: 4000000, gasPrice: 21000000000 } } };</code> </pre> <br>  We had to set gas and gasPrice, because at least our default values ‚Äã‚Äãdid not fit.  Do not forget to insert the token from the letter, but also invent your mnemonic from 12 different (and not like in the example) words - it is used to generate accounts and if someone takes possession of it, you can generate the same accounts and use them without your knowledge. .  For example, if you try to use the mnemonic in this article, you can use the ether (0.3) that we have sent there (if someone else does not use it).  In this config is also left for <code>development</code> , you can choose between these two networks by launching a truffle with the appropriate name after the <code>--network</code> flag: <br><br><pre> <code class="javascript hljs"> $ truffle <span class="hljs-built_in"><span class="hljs-built_in">console</span></span> --network ropsten</code> </pre> <br>  Before calling <code>migrate</code> , you need to replenish the balance of the generated account.  Find out the address and balance commands: <br><br><pre> <code class="javascript hljs">truffle(ropsten)&gt; web3.eth.getAccounts( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,r</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(r[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } ); <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> <span class="hljs-number"><span class="hljs-number">0x0bb542704819b5e6a28deb2b73245be57ce0e78b</span></span> truffle(ropsten)&gt; web3.eth.getBalance(<span class="hljs-string"><span class="hljs-string">'0x0bb542704819b5e6a28deb2b73245be57ce0e78b'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e, r</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( web3.fromWei( r.toNumber() ) ); }) <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  Send to your account a little Ropsten-air in order to be able to pay for the deployment.  After it has arrived (you can check with the previous command), you can try <code>migrate</code> : <br><br><pre> <code class="bash hljs">truffle(ropsten)&gt; migrate</code> </pre> <br>  The result should be: <br><br><pre> <code class="bash hljs">Compiling ./contracts/ConvertLib.sol... Compiling ./contracts/MetaCoin.sol... Compiling ./contracts/Migrations.sol... Writing artifacts to ./build/contracts Using network <span class="hljs-string"><span class="hljs-string">'ropsten'</span></span>. Running migration: 1_initial_migration.js Deploying Migrations... ... 0x93cf7dbde8c362534dc912926fc4d7df54c9c1f5e0a7dcfd964a0177b42bc7be Migrations: 0x02519d13f61bdcad838d938611e6722c3d1f8034 Saving successful migration to network... ... 0xec501a78cc11c723ab60186167765aa7c422177153cd72a976e66441db2b5b95 Saving artifacts... Running migration: 2_deploy_contracts.js Deploying ConvertLib... ... 0xf172d9a9ff9f1fdfdfabc816d89f5a5e710ba26e3a2ad9e1661c9dea56564f04 ConvertLib: 0xd04bffb73bf546985938a596565141d3a3bf7f0d Linking ConvertLib to MetaCoin Deploying MetaCoin... ... 0x4d9814f1d9a959e83828bf26319dd91d73be977395d88e9e8239bb4c4ed5b0eb MetaCoin: 0x20fd16643d857ce544a91ae4c80385af99dad196 Saving successful migration to network... ... 0x0dff866460d24d56d94dcf5f833aa4fa8ae289cb708ff5c9012ce21447575ce8 Saving artifacts... truffle(ropsten)&gt;</code> </pre> <br>  We see the transaction hash, you can check that they really hit Ropsten via etherscan.io (for example <a href="https://ropsten.etherscan.io/tx/0x93cf7dbde8c362534dc912926fc4d7df54c9c1f5e0a7dcfd964a0177b42bc7be">ropsten.etherscan.io/tx/0x93cf7dbde8c362534dc912926fc4d7df54c9c1f5e0a7dcfd964a0177b42bc7be</a> ) <br><br><h2>  What's next? </h2><br>  We hope you learned something new from this article, or at least refreshed knowledge. <br>  As for the next article, as practice has shown, it is difficult to make a real useful project without communication with the outside world through Oraclize and IPFS.  About this and plan to write. <br><br>  Ethereum development: <br>  <a href="https://habrahabr.ru/post/336132/">Part 1: introduction</a> <br>  <a href="https://habrahabr.ru/post/336770/">Part 2: Web3.js and gas</a> <br>  <a href="https://habrahabr.ru/post/339080/">Part 3: user application</a> </div><p>Source: <a href="https://habr.com/ru/post/348656/">https://habr.com/ru/post/348656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348644/index.html">How we make video content in Puzzle English: from the chromakey on the wall to a full-fledged video recording studio</a></li>
<li><a href="../348646/index.html">We invite you to MosCode Festival and analyze the tasks of past years.</a></li>
<li><a href="../348648/index.html">Seminar "Data Storage Systems for the Cloud and in the Cloud", February 15, Moscow</a></li>
<li><a href="../348650/index.html">Who to contact for design: freelancers, design studios, branding agencies</a></li>
<li><a href="../348652/index.html">Professionals vs Lovers</a></li>
<li><a href="../348658/index.html">Throw expressions in C # 7</a></li>
<li><a href="../348660/index.html">Blazor: Technical Introduction</a></li>
<li><a href="../348662/index.html">Magical 90%. What are we talking about when we talk about performance?</a></li>
<li><a href="../348664/index.html">Animations in Android on the shelves (Part 3. "Low-level" animation)</a></li>
<li><a href="../348666/index.html">Work and life in Bulgaria - 3. Interviews, visa, working moments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>