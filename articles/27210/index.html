<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Caching js gzip compression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cache - temporary data or device for their storage, created to speed up reading / writing. All programmers know this. Accelerating web site loading is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Caching js gzip compression</h1><div class="post__text post__text-html js-mediator-article"> Cache - temporary data or device for their storage, created to speed up reading / writing.  All programmers know this.  Accelerating web site loading is an extensive topic, starting with the server and ending with the client.  Unfortunately, I did not find more or less suitable solutions for combining and caching js-code, so I wrote my own scheme for my blog, which I will briefly describe .. <br>  There is a ‚Äú <a href="http://dean.edwards.name/packer/">packer</a> ‚Äù compression that removes all formatting characters and renames the names of functions and variables in js and provides so-called  minified version of the script.  Everyone is very familiar with this by the example of large jQuery, TinyMCE, prototype libraries.  Besides the fact that the code becomes completely unreadable, it can cause the inoperability of the code when the variable names are dynamic. <br>  My idea is simple - developers need to divide js / css by files to maintain a modular structure.  Usually I create a list of files in the controller that need to be attached to this document, instead of manually registering it in the template.  But now we need to make it so that before the template is displayed, the caching function is called, which would go through the list, check local files from them for the duration of the change, merge into one file and create or rewrite a gz file with the name formed from md5-hash names of incoming files. <br>  Everything is simple and in total it took 4 hours to think.  I give the cache_js method from the Controller class. <br><a name="habracut"></a><br><pre> <code class="hljs perl">function cache_js(){ $arrNewJS=array(); $strHash=<span class="hljs-string"><span class="hljs-string">''</span></span>; $strGzipContent=<span class="hljs-string"><span class="hljs-string">''</span></span>; $intLastModified=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ((array)$this-&gt;scripts as $file){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>($file,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>)==<span class="hljs-string"><span class="hljs-string">'http'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($file[<span class="hljs-number"><span class="hljs-number">0</span></span>]==<span class="hljs-string"><span class="hljs-string">'/'</span></span>) $strFilename=sys_root.$file; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $strFilename=sys_root.<span class="hljs-string"><span class="hljs-string">'app/front/view/'</span></span>.$file; $strHash.=$file; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     $strGzipContent.=file_get_contents($strFilename); $intLastModified=$intLastModified&lt;filemtime($strFilename) ? filemtime($strFilename) : $intLastModified; } $strGzipHash=md5($strHash); $strGzipFile=sys_root.<span class="hljs-string"><span class="hljs-string">'app/front/view/js/bin/'</span></span>.$strGzipHash.<span class="hljs-string"><span class="hljs-string">'.gz'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    gz- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($strGzipFile) &amp;&amp; $intLastModified&gt;filemtime($strGzipFile) || !file_exists($strGzipFile)){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($strGzipFile)) touch($strGzipFile); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    php  zlib   $gz = gzopen($strGzipFile,<span class="hljs-string"><span class="hljs-string">'w9'</span></span>); gzputs ($gz, $strGzipContent); gzclose($gz); } //     $arrNewJS[]=<span class="hljs-string"><span class="hljs-string">'js/bin/'</span></span>.$strGzipHash.<span class="hljs-string"><span class="hljs-string">'.gz'</span></span>; $this-&gt;scripts=$arrNewJS; }</code> </pre> <br>  I will not write about css, the idea is similar.  The only question is in automating caching and in order of incoming files.  However, as a result of compression, 5 requests turned into 1, and the total size decreased by 3 times. <br>  Read the same <br><ul><li>  <a href="http://javascript.ru/optimize/cache-versioning">Smart caching and versioning</a> in js / css </li><li>  <a href="http://webo.in/articles/habrahabr/07-gzip-all/">Practical JS / CSS</a> : we archive everything </li><li>  <a href="http://vectora.ru/articles-and-tutorials/49-web-technologies/117-css-js-compression-without-performance-penalties">Css and js compression</a> without performance loss </li></ul><br><br><br>  <a href="http://kurapov.name/technology/web/cache_js_with_gzip/">Original</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/27210/">https://habr.com/ru/post/27210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../27209/index.html">The first truly working mobile TV service in Russia</a></li>
<li><a href="../272091/index.html">Payment conversion: 4 reasons that reduce the success of payment on your site and how to eliminate them</a></li>
<li><a href="../272093/index.html">Network equipment at risk? Let's understand ...</a></li>
<li><a href="../272095/index.html">Corporate use of Android 5.0: security recommendations</a></li>
<li><a href="../272099/index.html">PHP 7.0.0</a></li>
<li><a href="../272101/index.html">SQLi is still in service</a></li>
<li><a href="../272105/index.html">What we should parse site. Webdriver API Basics</a></li>
<li><a href="../272107/index.html">Server administration Resource Management with PowerShell</a></li>
<li><a href="../27211/index.html">Eco-friendly modular PC. Amateur version</a></li>
<li><a href="../272115/index.html">Haskell "terrible" abstractions without mathematics and without code (almost). Part I</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>